var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertyNames,r=Object.getOwnPropertySymbols,i=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=Reflect.get,c=(t,s,n)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n,d=(e,t)=>{for(var s in t||(t={}))a.call(t,s)&&c(e,s,t[s]);if(r)for(var s of r(t))o.call(t,s)&&c(e,s,t[s]);return e},u=(e,n)=>t(e,s(n)),h=(e,t)=>{var s={};for(var n in e)a.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(null!=e&&r)for(var n of r(e))t.indexOf(n)<0&&o.call(e,n)&&(s[n]=e[n]);return s},m=(e,t,s)=>c(e,"symbol"!=typeof t?t+"":t,s),p=(e,t,s)=>l(i(e),s,t),g=(e,t,s)=>new Promise((n,r)=>{var i=e=>{try{o(s.next(e))}catch(t){r(t)}},a=e=>{try{o(s.throw(e))}catch(t){r(t)}},o=e=>e.done?n(e.value):Promise.resolve(e.value).then(i,a);o((s=s.apply(e,t)).next())});import{r as f,a as x,R as y}from"./vendor-BXk_ma1u.js";import{S as v,a as b,C as w,M as N,T as j,b as _,c as k,U as S,d as T,e as I,F as E,A as C,f as A,g as P,H as D,h as R,P as O,i as L,j as M,k as F,l as U,L as V,m as B,n as K,o as z,p as q,X as $,q as H,r as G,E as J,s as W,t as Q,u as Y,v as X,w as Z,Z as ee,x as te,y as se,z as ne,B as re,D as ie,G as ae,I as oe,J as le,K as ce,N as de,O as ue,Q as he,R as me,V as pe,W as ge,Y as fe,_ as xe,$ as ye,a0 as ve,a1 as be,a2 as we}from"./ui-BROVawAS.js";var Ne,je,_e=(Ne={"assets/index-C67iQI9i.js"(e){!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var t={exports:{}},s={},n=f,r=Symbol.for("react.element"),i=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,s){var n,i={},c=null,d=null;for(n in void 0!==s&&(c=""+s),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)a.call(t,n)&&!l.hasOwnProperty(n)&&(i[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===i[n]&&(i[n]=t[n]);return{$$typeof:r,type:e,key:c,ref:d,props:i,_owner:o.current}}s.Fragment=i,s.jsx=c,s.jsxs=c,t.exports=s;var Ne,je=t.exports,_e=x;Ne=_e.createRoot,_e.hydrateRoot;class ke{static initializeApp(){console.log("ðŸš€ Initializing Azzahra Fashion Muslim App..."),localStorage.getItem(this.KEYS.USERS)||this.initializeUsers(),localStorage.getItem(this.KEYS.ORDERS)||this.initializeOrders(),localStorage.getItem(this.KEYS.CART)||localStorage.setItem(this.KEYS.CART,JSON.stringify([])),console.log("âœ… App initialized successfully!")}static initializeProducts(){const e=[{id:"1",name:"Hijab Segi Empat Premium",description:"Hijab segi empat berbahan premium dengan kualitas terbaik. Nyaman dipakai sehari-hari.",category:"hijab",images:["https://images.pexels.com/photos/3184291/pexels-photo-3184291.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["Regular"],colors:["Navy","Maroon","Black","Cream","Pink","Mint","Gray"]},retailPrice:85e3,resellerPrice:7e4,costPrice:55e3,stock:50,status:"ready",salesCount:15,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"2",name:"Gamis Syari Elegant",description:"Gamis syari dengan desain elegant dan bahan adem. Cocok untuk acara formal maupun casual.",category:"gamis",images:["https://images.pexels.com/photos/3184338/pexels-photo-3184338.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["S","M","L","XL","XXL"],colors:["Black","Navy","Maroon","Army","Dusty"]},retailPrice:285e3,resellerPrice:25e4,costPrice:2e5,stock:25,status:"ready",salesCount:8,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"3",name:"Khimar Instant Modern",description:"Khimar instant dengan pad antem dan material berkualitas. Praktis dan syari.",category:"khimar",images:["https://images.pexels.com/photos/3184461/pexels-photo-3184461.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["Regular","Jumbo"],colors:["Black","White","Cream","Silver","Pink"]},retailPrice:95e3,resellerPrice:8e4,costPrice:65e3,stock:40,status:"ready",salesCount:12,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"4",name:"Tunik Kasual Modern",description:"Tunik dengan desain modern yang cocok untuk OOTD harian. Nyaman dan stylish.",category:"tunik",images:["https://images.pexels.com/photos/3184315/pexels-photo-3184315.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["S","M","L","XL"],colors:["Blue","Pink","White","Black","Mustard"]},retailPrice:165e3,resellerPrice:14e4,costPrice:11e4,stock:30,status:"ready",salesCount:6,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"5",name:"Setelan Celana Kulot",description:"Setelan atasan dengan celana kulot yang nyaman. Modern dan syari.",category:"setelan",images:["https://images.pexels.com/photos/3184339/pexels-photo-3184339.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["S","M","L","XL"],colors:["Army","Navy","Maroon","Gray","Beige"]},retailPrice:225e3,resellerPrice:19e4,costPrice:15e4,stock:20,status:"ready",salesCount:4,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"6",name:"Rok Plisket Premium",description:"Rok plisket dengan bahan premium yang jatuh dan nyaman. Elegan dan modis.",category:"rok",images:["https://images.pexels.com/photos/3184340/pexels-photo-3184340.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["S","M","L","XL"],colors:["Black","Navy","Maroon","Gray","Cream"]},retailPrice:145e3,resellerPrice:12e4,costPrice:95e3,stock:35,status:"ready",salesCount:9,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"7",name:"Blouse Kekinian",description:"Blouse dengan desain kekinian yang nyaman dipakai sehari-hari.",category:"atasan",images:["https://images.pexels.com/photos/3184359/pexels-photo-3184359.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["S","M","L","XL"],colors:["Pink","Blue","White","Yellow","Green"]},retailPrice:125e3,resellerPrice:105e3,costPrice:85e3,stock:28,status:"ready",salesCount:7,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"8",name:"Abaya Simple Elegant",description:"Abaya dengan desain simple namun elegant. Cocok untuk acara formal.",category:"abaya",images:["https://images.pexels.com/photos/3184365/pexels-photo-3184365.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["S","M","L","XL"],colors:["Black","Navy","Gray","Maroon"]},retailPrice:325e3,resellerPrice:28e4,costPrice:22e4,stock:15,status:"ready",salesCount:3,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0}];this.saveData(this.KEYS.PRODUCTS,e),console.log("ðŸ“¦ Products initialized:",e.length)}static initializeUsers(){const e=[{id:"1",name:"Customer",email:"customer@azzahra.com",phone:"08123456789",role:"customer",createdAt:new Date},{id:"2",name:"Admin",email:"admin@azzahra.com",phone:"08123456780",role:"admin",createdAt:new Date},{id:"3",name:"Owner",email:"owner@azzahra.com",phone:"08123456781",role:"owner",createdAt:new Date}];this.saveData(this.KEYS.USERS,e),console.log("ðŸ‘¥ Users initialized:",e.length)}static initializeOrders(){this.saveData(this.KEYS.ORDERS,[]),console.log("ðŸ“‹ Orders initialized: 0")}static saveData(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(s){console.error(`âŒ Error saving data to ${e}:`,s)}}static loadData(e){try{const t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(t){return console.error(`âŒ Error loading data from ${e}:`,t),null}}static getProducts(){return(this.loadData(this.KEYS.PRODUCTS)||[]).map(e=>u(d({},e),{createdAt:new Date(e.createdAt)}))}static saveProducts(e){this.saveData(this.KEYS.PRODUCTS,e)}static getFeaturedProducts(){try{const e=this.getProducts().filter(e=>!0===e.isFeatured).sort((e,t)=>(e.featuredOrder||0)-(t.featuredOrder||0));return console.log(`ðŸŒŸ AppStorage: Found ${e.length} featured products`),e.forEach((e,t)=>{console.log(`  ${t+1}. ${e.name} (Order: ${e.featuredOrder})`)}),e}catch(e){return console.error("ðŸš¨ AppStorage: Error getting featured products:",e),[]}}static reorderFeatured(e,t){const s=this.getProducts(),n=s.filter(e=>e.isFeatured).sort((e,t)=>(e.featuredOrder||0)-(t.featuredOrder||0)),r=n.findIndex(t=>t.id===e);if(-1===r)return s;const i="up"===t?r-1:r+1;if(i<0||i>=n.length)return s;const[a]=n.splice(r,1);n.splice(i,0,a);const o=s.map(e=>{const t=n.findIndex(t=>t.id===e.id);return-1!==t?u(d({},e),{featuredOrder:t+1}):e});return this.saveProducts(o),o}static toggleFeatured(e){const t=this.getProducts(),s=t.find(t=>t.id===e);if(!s)return t;let n;if(s.isFeatured)n=t.map(t=>t.id===e?u(d({},t),{isFeatured:!1,featuredOrder:0}):t.isFeatured&&t.featuredOrder>s.featuredOrder?u(d({},t),{featuredOrder:t.featuredOrder-1}):t);else{const s=t.filter(e=>e.isFeatured);if(s.length>=4)return alert("Maksimal 4 produk unggulan!"),t;n=t.map(t=>t.id===e?u(d({},t),{isFeatured:!0,featuredOrder:s.length+1}):t)}return this.saveProducts(n),"undefined"!=typeof window&&window.dispatchEvent(new CustomEvent("featuredProductsUpdated",{detail:{action:s.isFeatured?"removed":"added",productId:e,featuredProducts:n.filter(e=>e.isFeatured)}})),n}static validateAndSyncFeaturedProducts(){try{const e=this.getProducts(),t=e.filter(e=>e.isFeatured).sort((e,t)=>(e.featuredOrder||0)-(t.featuredOrder||0)),s=e.map(e=>{const s=t.findIndex(t=>t.id===e.id);return-1!==s?u(d({},e),{featuredOrder:s+1}):e});return JSON.stringify(e)!==JSON.stringify(s)&&(this.saveProducts(s),console.log("ðŸ”§ AppStorage: Fixed featured products order consistency")),s}catch(e){return console.error("ðŸš¨ AppStorage: Error validating featured products:",e),this.getProducts()}}static refreshFeaturedProductsCache(){this.getFeaturedProducts(),"undefined"!=typeof window&&window.dispatchEvent(new CustomEvent("featuredProductsRefreshed",{detail:{timestamp:(new Date).toISOString()}}))}static getOrders(){return(this.loadData(this.KEYS.ORDERS)||[]).map(e=>u(d({},e),{createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}))}static saveOrder(e){const t=this.getOrders();t.push(e),this.saveData(this.KEYS.ORDERS,t),console.log("ðŸ’¾ Order saved:",e.id)}static updateOrderStatus(e,t){const s=this.getOrders().map(s=>s.id===e?u(d({},s),{status:t,updatedAt:new Date}):s);this.saveData(this.KEYS.ORDERS,s),console.log("ðŸ“‹ Order status updated:",e,"â†’",t)}static getUsers(){return(this.loadData(this.KEYS.USERS)||[]).map(e=>u(d({},e),{createdAt:new Date(e.createdAt)}))}static saveUser(e){const t=this.getUsers(),s=t.findIndex(t=>t.id===e.id);s>=0?t[s]=e:t.push(e),this.saveData(this.KEYS.USERS,t)}static getCart(){return this.loadData(this.KEYS.CART)||[]}static saveCart(e){this.saveData(this.KEYS.CART,e)}static exportAllData(){const e={products:this.getProducts(),orders:this.getOrders(),users:this.getUsers(),cart:this.getCart(),exportedAt:(new Date).toISOString()};return JSON.stringify(e,null,2)}static importAllData(e){try{const t=JSON.parse(e);return t.products&&this.saveData(this.KEYS.PRODUCTS,t.products),t.orders&&this.saveData(this.KEYS.ORDERS,t.orders),t.users&&this.saveData(this.KEYS.USERS,t.users),t.cart&&this.saveData(this.KEYS.CART,t.cart),console.log("ðŸ“¥ Data imported successfully"),!0}catch(t){return console.error("âŒ Error importing data:",t),!1}}static clearAllData(){Object.values(this.KEYS).forEach(e=>{localStorage.removeItem(e)}),console.log("ðŸ—‘ï¸ All data cleared"),this.initializeApp()}static getStorageInfo(){const e={};return Object.entries(this.KEYS).forEach(([t,s])=>{const n=localStorage.getItem(s);e[t]={size:n?n.length:0,items:n?JSON.parse(n).length:0}}),e}}m(ke,"KEYS",{PRODUCTS:"azzahra_products",ORDERS:"azzahra_orders",USERS:"azzahra_users",CART:"azzahra_cart",FLASH_SALES:"azzahra_flash_sales",APP_STATE:"azzahra_app_state"}),"undefined"!=typeof window&&(window.AppStorage=ke);const Se=f.createContext(void 0),Te=({children:e})=>{const[t,s]=f.useState([]),[n,r]=f.useState([]);return f.useEffect(()=>{const e=ke.getOrders();s(e),console.log("ðŸ“‹ Orders loaded from AppStorage:",e.length)},[]),f.useEffect(()=>{const e=()=>{const e=ke.getOrders();s(e),console.log("ðŸ“‹ Orders updated:",e.length)};return window.addEventListener("orderUpdated",e),()=>window.removeEventListener("orderUpdated",e)},[]),je.jsx(Se.Provider,{value:{orders:t,flashSales:n,addOrder:e=>{const t=u(d({},e),{createdAt:new Date,updatedAt:new Date});ke.saveOrder(t),s(e=>[t,...e]),console.log("ðŸ’¾ Order saved permanently:",t.id),window.dispatchEvent(new CustomEvent("orderUpdated",{detail:t}))},updateOrderStatus:(e,t)=>{ke.updateOrderStatus(e,t),s(s=>s.map(s=>s.id===e?u(d({},s),{status:t,updatedAt:new Date}):s)),console.log("ðŸ“‹ Order status updated:",e,"â†’",t),window.dispatchEvent(new CustomEvent("orderUpdated",{detail:{orderId:e,status:t}}))},updateOrderPayment:(e,n,r="pending")=>{const i=t.map(t=>t.id===e?u(d({},t),{paymentProof:n,paymentProofUrl:"https://images.pexels.com/photos/4386321/pexels-photo-4386321.jpeg?auto=compress&cs=tinysrgb&w=400",status:r,updatedAt:new Date}):t);localStorage.setItem("azzahra_orders",JSON.stringify(i)),s(i),console.log("ðŸ’³ Order payment updated:",e),window.dispatchEvent(new CustomEvent("orderUpdated",{detail:{orderId:e,paymentProof:n,status:r}}))},deleteOrder:e=>{const n=t.filter(t=>t.id!==e);localStorage.setItem("azzahra_orders",JSON.stringify(n)),s(n),console.log("ðŸ—‘ï¸ Order deleted permanently:",e),window.dispatchEvent(new CustomEvent("orderUpdated",{detail:{orderId:e,deleted:!0}}))},getOrdersByStatus:e=>t.filter(t=>t.status===e),getTotalRevenue:()=>t.filter(e=>"delivered"===e.status).reduce((e,t)=>e+t.finalTotal,0),getTodayOrders:()=>{const e=new Date;return e.setHours(0,0,0,0),t.filter(t=>t.createdAt>=e)},createFlashSale:e=>{const t=u(d({},e),{id:"FS"+Date.now().toString(),createdAt:new Date});console.log("Creating flash sale:",t),console.log("Flash sale products:",e.productIds),console.log("Discount:",e.discountType,e.discountValue),r(e=>{const s=[t,...e];return console.log("Updated flash sales:",s),s}),setTimeout(()=>{console.log("Dispatching flashSaleCreated event");const e=new CustomEvent("flashSaleCreated",{detail:t,bubbles:!0});window.dispatchEvent(e),console.log("Event dispatched")},100)},updateFlashSale:(e,t)=>{r(s=>s.map(s=>s.id===e?d(d({},s),t):s)),console.log("Updating flash sale:",e,t);const s=n.find(t=>t.id===e);s&&window.dispatchEvent(new CustomEvent("flashSaleUpdated",{detail:d(d({},s),t)}))},deleteFlashSale:e=>{const t=n.find(t=>t.id===e);t&&(console.log("Deleting flash sale:",t),window.dispatchEvent(new CustomEvent("flashSaleDeleted",{detail:t}))),r(t=>t.filter(t=>t.id!==e))},getActiveFlashSales:()=>{const e=new Date;return n.filter(t=>t.isActive&&t.startDate<=e&&t.endDate>=e)}},children:e})},Ie=()=>{const e=f.useContext(Se);if(void 0===e)throw new Error("useAdmin must be used within an AdminProvider");return e};class Ee extends y.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e,t)}render(){return this.state.hasError?this.props.fallback||je.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:je.jsxs("div",{className:"text-center",children:[je.jsx("div",{className:"text-red-500 mb-4",children:je.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:je.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),je.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Terjadi Kesalahan"}),je.jsx("p",{className:"text-gray-600 mb-4",children:"Mohon muat ulang halaman atau coba lagi nanti."}),je.jsx("button",{onClick:()=>window.location.reload(),className:"bg-pink-500 text-white px-6 py-2 rounded-lg hover:bg-pink-600 transition-colors",children:"Muat Ulang"})]})}):this.props.children}}const Ce=({product:e,onProductClick:t,onAddToCart:s,isFlashSale:n=!1,isFeatured:r=!1,user:i})=>{var a;const[o,l]=f.useState(!1),[c,d]=f.useState(e.isFlashSale);f.useEffect(()=>{const t=()=>{const t=localStorage.getItem("azzahra-flashsale");if(t)try{const s=JSON.parse(t),n=(new Date).getTime(),r=new Date(s.endTime).getTime(),i=e.isFlashSale&&s.isActive&&n<r;d(i)}catch(s){console.error("Error checking flash sale status:",s),d(!1)}else d(!1)};t();const s=setInterval(t,2e3),n=()=>{console.log("ðŸ”¥ ProductCard received flash sale ended event"),d(!1)};return window.addEventListener("flashSaleEnded",n),()=>{clearInterval(s),window.removeEventListener("flashSaleEnded",n)}},[e.isFlashSale]);const u=e=>{e.stopPropagation(),"reseller"!==(null==i?void 0:i.role)&&l(!o)},h=t=>{t.stopPropagation();const s=encodeURIComponent(`Halo Admin, saya tertarik dengan produk ${e.name} dan ingin menanyakan tentang harga reseller. Mohon info lebih lanjut. Terima kasih.`);window.open(`https://wa.me/6287815990944?text=${s}`,"_blank"),l(!1)};return je.jsxs("div",{onClick:()=>t(e),className:"bg-white rounded-lg shadow-md hover:shadow-lg transition-all duration-300 cursor-pointer group overflow-hidden "+(r?"ring-2 ring-yellow-400 shadow-lg":""),children:[je.jsxs("div",{className:"relative",children:[je.jsx("img",{src:e.image||(null==(a=e.images)?void 0:a[0])||"/placeholder-product.jpg",alt:e.name,className:"w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300",onError:e=>{const t=e.target;t.style.display="none";const s=t.parentElement;s&&(s.style.background="linear-gradient(135deg, #667eea 0%, #764ba2 100%)",s.innerHTML='<div class="flex items-center justify-center h-full text-white text-center p-4"><div><div class="text-2xl mb-2">ðŸ“¦</div><div class="text-sm">No Image</div></div></div>')}}),(()=>{const t="ready"===e.status?`Ready (${e.stock})`:`PO (${e.stock})`;return je.jsx("div",{className:"absolute top-2 left-2 text-xs px-2 py-1 rounded font-medium "+("ready"===e.status?"bg-green-500 text-white":"bg-orange-500 text-white"),children:t})})(),r&&je.jsx("div",{className:"absolute top-2 right-2 bg-yellow-400 text-white p-1.5 rounded-full shadow-lg",children:je.jsx(v,{className:"w-4 h-4 fill-current"})}),je.jsx("div",{className:"absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:je.jsx("button",{onClick:t=>{t.stopPropagation(),s(e)},className:"bg-pink-500 text-white p-2 rounded-full hover:bg-pink-600 transition-colors shadow-lg",children:je.jsx(b,{className:"w-4 h-4"})})})]}),je.jsxs("div",{className:"p-4",children:[je.jsx("h3",{className:"font-semibold text-gray-800 mb-2 line-clamp-2 group-hover:text-pink-600 transition-colors",children:e.name}),je.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:e.description}),c&&e.flashSalePrice>0?je.jsxs("div",{className:"space-y-1",children:[je.jsxs("div",{className:"flex items-center space-x-2",children:[je.jsxs("span",{className:"text-lg font-bold text-red-600",children:["Rp ",e.flashSalePrice.toLocaleString("id-ID")]}),je.jsxs("span",{className:"bg-red-100 text-red-600 text-xs px-2 py-1 rounded",children:["-",Math.round(100*(1-e.flashSalePrice/(e.originalRetailPrice||e.retailPrice))),"%"]})]}),je.jsxs("div",{className:"text-sm text-gray-500 line-through",children:["Rp ",(e.originalRetailPrice||e.retailPrice).toLocaleString("id-ID")]})]}):je.jsxs("div",{className:"space-y-1 relative",children:[je.jsxs("div",{className:"text-lg font-bold text-pink-600",children:["Rp ",e.retailPrice.toLocaleString("id-ID")]}),je.jsxs("div",{className:"relative",children:["reseller"===(null==i?void 0:i.role)?je.jsxs("div",{className:"text-sm text-pink-600",children:["Reseller: Rp ",e.resellerPrice.toLocaleString("id-ID")]}):je.jsxs("button",{onClick:u,className:"text-sm text-pink-600 hover:text-pink-700 font-medium transition-colors flex items-center space-x-1",children:[je.jsxs("span",{children:["Reseller: Rp ",e.resellerPrice.toLocaleString("id-ID")]}),je.jsx(w,{className:"w-3 h-3 transition-transform "+(o?"rotate-180":"")})]}),o&&"reseller"!==(null==i?void 0:i.role)&&je.jsxs("div",{className:"absolute bottom-full left-0 right-0 mb-2 bg-white rounded-lg shadow-lg border border-gray-200 z-10",children:[je.jsxs("button",{onClick:h,className:"w-full px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors flex items-center space-x-2 rounded-t-lg",children:[je.jsx(N,{className:"w-4 h-4 text-green-600"}),je.jsx("span",{children:"Info Reseller via WhatsApp"})]}),je.jsx("div",{className:"text-xs text-gray-500 px-3 pb-2 text-center",children:"Hubungi admin untuk harga reseller"})]})]})]})]})]})},Ae=({onBannerClick:e})=>{const[t,s]=f.useState(0),[n,r]=f.useState([]),i=[];return f.useEffect(()=>{const e=localStorage.getItem("azzahra-banners");if(e)try{const t=JSON.parse(e);r([...i,...t])}catch(t){r(i)}else r(i)},[]),f.useEffect(()=>{if(n.length<=1)return;const e=setInterval(()=>{s(e=>(e+1)%n.length)},3e3);return()=>clearInterval(e)},[n.length]),0===n.length?null:je.jsxs("div",{className:"relative w-full h-48 md:h-56 lg:h-64 overflow-hidden rounded-lg",children:[je.jsx("div",{className:"relative h-full",children:n.map((s,n)=>je.jsx("div",{className:"absolute inset-0 transition-opacity duration-500 "+(n===t?"opacity-100":"opacity-0"),children:je.jsx("div",{className:"w-full h-full cursor-pointer "+("flashsale"===s.type?"bg-gradient-to-r from-red-500 to-pink-500":"bg-gradient-to-r from-purple-500 to-pink-500"),onClick:()=>(t=>{e&&e(t)})(s),children:je.jsx("div",{className:"flex items-center justify-center h-full p-8 text-white",children:je.jsxs("div",{className:"text-center",children:["flashsale"===s.type&&je.jsx(j,{className:"w-8 h-8 mx-auto mb-2"}),je.jsx("h2",{className:"text-2xl md:text-3xl font-bold mb-2",children:s.title}),"flashsale"===s.type&&je.jsx("p",{className:"text-red-100",children:"Diskon terbatas! Buruan sebelum kehabisan!"}),"promo"===s.type&&je.jsx("p",{className:"text-purple-100",children:"Promo spesial untuk Anda!"})]})})})},s.id))}),n.length>1&&je.jsxs(je.Fragment,{children:[je.jsx("button",{onClick:()=>{s(e=>(e-1+n.length)%n.length)},className:"absolute left-4 top-1/2 transform -translate-y-1/2 bg-white/20 hover:bg-white/30 rounded-full p-2 transition-colors",children:je.jsx(_,{className:"w-5 h-5 text-white"})}),je.jsx("button",{onClick:()=>{s(e=>(e+1)%n.length)},className:"absolute right-4 top-1/2 transform -translate-y-1/2 bg-white/20 hover:bg-white/30 rounded-full p-2 transition-colors",children:je.jsx(k,{className:"w-5 h-5 text-white"})})]}),n.length>1&&je.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2",children:n.map((e,n)=>je.jsx("button",{onClick:()=>s(n),className:"w-2 h-2 rounded-full transition-colors "+(n===t?"bg-white":"bg-white/50")},n))})]})};function Pe(e){return e&&"object"==typeof e&&e.id&&e.name?d({id:String(e.id),name:String(e.name),description:e.description?String(e.description):"",category:e.category?String(e.category):"other",images:Array.isArray(e.images)?e.images:[],variants:e.variants&&"object"==typeof e.variants?{sizes:Array.isArray(e.variants.sizes)?e.variants.sizes:[],colors:Array.isArray(e.variants.colors)?e.variants.colors:[]}:{sizes:[],colors:[]},retailPrice:"number"==typeof e.retailPrice?e.retailPrice:0,resellerPrice:"number"==typeof e.resellerPrice?e.resellerPrice:0,costPrice:"number"==typeof e.costPrice?e.costPrice:0,stock:"number"==typeof e.stock?e.stock:0,status:"ready"===e.status||"po"===e.status?e.status:"ready",isFlashSale:Boolean(e.isFlashSale),flashSalePrice:"number"==typeof e.flashSalePrice?e.flashSalePrice:0,createdAt:e.createdAt?e.createdAt instanceof Date?e.createdAt:new Date(e.createdAt):new Date,salesCount:"number"==typeof e.salesCount?e.salesCount:0,isFeatured:Boolean(e.isFeatured),featuredOrder:"number"==typeof e.featuredOrder?e.featuredOrder:void 0},Object.keys(e).reduce((t,s)=>(["id","name","description","category","images","variants","retailPrice","resellerPrice","costPrice","stock","status","isFlashSale","flashSalePrice","createdAt","salesCount","isFeatured","featuredOrder"].includes(s)||(t[s]=e[s]),t),{})):null}var De={};
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Re=function(e){const t=[];let s=0;for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r<128?t[s++]=r:r<2048?(t[s++]=r>>6|192,t[s++]=63&r|128):55296==(64512&r)&&n+1<e.length&&56320==(64512&e.charCodeAt(n+1))?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++n)),t[s++]=r>>18|240,t[s++]=r>>12&63|128,t[s++]=r>>6&63|128,t[s++]=63&r|128):(t[s++]=r>>12|224,t[s++]=r>>6&63|128,t[s++]=63&r|128)}return t},Oe={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let r=0;r<e.length;r+=3){const t=e[r],i=r+1<e.length,a=i?e[r+1]:0,o=r+2<e.length,l=o?e[r+2]:0,c=t>>2,d=(3&t)<<4|a>>4;let u=(15&a)<<2|l>>6,h=63&l;o||(h=64,i||(u=64)),n.push(s[c],s[d],s[u],s[h])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(Re(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let s=0,n=0;for(;s<e.length;){const r=e[s++];if(r<128)t[n++]=String.fromCharCode(r);else if(r>191&&r<224){const i=e[s++];t[n++]=String.fromCharCode((31&r)<<6|63&i)}else if(r>239&&r<365){const i=((7&r)<<18|(63&e[s++])<<12|(63&e[s++])<<6|63&e[s++])-65536;t[n++]=String.fromCharCode(55296+(i>>10)),t[n++]=String.fromCharCode(56320+(1023&i))}else{const i=e[s++],a=e[s++];t[n++]=String.fromCharCode((15&r)<<12|(63&i)<<6|63&a)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const s=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let r=0;r<e.length;){const t=s[e.charAt(r++)],i=r<e.length?s[e.charAt(r)]:0;++r;const a=r<e.length?s[e.charAt(r)]:64;++r;const o=r<e.length?s[e.charAt(r)]:64;if(++r,null==t||null==i||null==a||null==o)throw new Le;const l=t<<2|i>>4;if(n.push(l),64!==a){const e=i<<4&240|a>>2;if(n.push(e),64!==o){const e=a<<6&192|o;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class Le extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Me=function(e){return function(e){const t=Re(e);return Oe.encodeByteArray(t,!0)}(e).replace(/\./g,"")},Fe=function(e){try{return Oe.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null},Ue=()=>
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */().__FIREBASE_DEFAULTS__,Ve=()=>{try{return Ue()||(()=>{if("undefined"==typeof process)return;const e=De.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(s){return}const t=e&&Fe(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},Be=e=>{var t,s;return null==(s=null==(t=Ve())?void 0:t.emulatorHosts)?void 0:s[e]},Ke=e=>{const t=Be(e);if(!t)return;const s=t.lastIndexOf(":");if(s<=0||s+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const n=parseInt(t.substring(s+1),10);return"["===t[0]?[t.substring(1,s-1),n]:[t.substring(0,s),n]},ze=()=>{var e;return null==(e=Ve())?void 0:e.config},qe=e=>{var t;return null==(t=Ve())?void 0:t[`_${e}`]};
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class $e{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,s))}}}
/**
     * @license
     * Copyright 2025 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function He(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch(t){return!1}}function Ge(e){return g(this,null,function*(){return(yield fetch(e,{credentials:"include"})).ok})}
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Je(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s=t||"demo-project",n=e.iat||0,r=e.sub||e.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const i=d({iss:`https://securetoken.google.com/${s}`,aud:s,iat:n,exp:n+3600,auth_time:n,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},e);return[Me(JSON.stringify({alg:"none",type:"JWT"})),Me(JSON.stringify(i)),""].join(".")}const We={};let Qe=!1;function Ye(e,t){if("undefined"==typeof window||"undefined"==typeof document||!He(window.location.host)||We[e]===t||We[e]||Qe)return;function s(e){return`__firebase__banner__${e}`}We[e]=t;const n="__firebase__banner",r=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(We))We[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function i(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{Qe=!0,function(){const e=document.getElementById(n);e&&e.remove()}()},e}function a(){const e=function(e){let t=document.getElementById(e),s=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),s=!0),{created:s,element:t}}(n),t=s("text"),a=document.getElementById(t)||document.createElement("span"),o=s("learnmore"),l=document.getElementById(o)||document.createElement("a"),c=s("preprendIcon"),d=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(l,o);const s=i();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(d,c),t.append(d,a,l,s),document.body.appendChild(t)}r?(a.innerText="Preview backend disconnected.",d.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(d.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',a.innerText="Preview backend running in this workspace."),a.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",a):a()}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Xe(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function Ze(){return!function(){var e;const t=null==(e=Ve())?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(s){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}class et extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name="FirebaseError",Object.setPrototypeOf(this,et.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,tt.prototype.create)}}class tt{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},n=`${this.service}/${e}`,r=this.errors[e],i=r?function(e,t){return e.replace(st,(e,s)=>{const n=t[s];return null!=n?String(n):`<${s}?>`})}(r,s):"Error",a=`${this.serviceName}: ${i} (${n}).`;return new et(n,a,s)}}const st=/\{\$([^}]+)}/g;function nt(e,t){if(e===t)return!0;const s=Object.keys(e),n=Object.keys(t);for(const r of s){if(!n.includes(r))return!1;const s=e[r],i=t[r];if(rt(s)&&rt(i)){if(!nt(s,i))return!1}else if(s!==i)return!1}for(const r of n)if(!s.includes(r))return!1;return!0}function rt(e){return null!==e&&"object"==typeof e}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function it(e){const t=[];for(const[s,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(s)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(s)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function at(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[s,n]=e.split("=");t[decodeURIComponent(s)]=decodeURIComponent(n)}}),t}function ot(e){const t=e.indexOf("?");if(!t)return"";const s=e.indexOf("#",t);return e.substring(t,s>0?s:void 0)}class lt{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,s){let n;if(void 0===e&&void 0===t&&void 0===s)throw new Error("Missing Observer.");n=function(e,t){if("object"!=typeof e||null===e)return!1;for(const s of t)if(s in e&&"function"==typeof e[s])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:s},void 0===n.next&&(n.next=ct),void 0===n.error&&(n.error=ct),void 0===n.complete&&(n.complete=ct);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}}),this.observers.push(n),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(s){"undefined"!=typeof console&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ct(){}
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function dt(e){return e&&e._delegate?e._delegate:e}class ut{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const ht="[DEFAULT]";
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class mt{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new $e;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&e.resolve(s)}catch(s){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const s=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),n=null!=(t=null==e?void 0:e.optional)&&t;if(!this.isInitialized(s)&&!this.shouldAutoInitialize()){if(n)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:s})}catch(r){if(n)return null;throw r}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(e))try{this.getOrInitializeService({instanceIdentifier:ht})}catch(t){}for(const[e,s]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});s.resolve(e)}catch(t){}}}}clearInstance(e=ht){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return g(this,null,function*(){const e=Array.from(this.instances.values());yield Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])})}isComponentSet(){return null!=this.component}isInitialized(e=ht){return this.instances.has(e)}getOptions(e=ht){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const n=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[r,i]of this.instancesDeferred.entries())s===this.normalizeInstanceIdentifier(r)&&i.resolve(n);return n}onInit(e,t){var s;const n=this.normalizeInstanceIdentifier(t),r=null!=(s=this.onInitCallbacks.get(n))?s:new Set;r.add(e),this.onInitCallbacks.set(n,r);const i=this.instances.get(n);return i&&e(i,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const r of s)try{r(e,t)}catch(n){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e,n===ht?void 0:n),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch(r){}var n;return s||null}normalizeInstanceIdentifier(e=ht){return this.component?this.component.multipleInstances?e:ht:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class pt{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new mt(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var gt,ft;(ft=gt||(gt={}))[ft.DEBUG=0]="DEBUG",ft[ft.VERBOSE=1]="VERBOSE",ft[ft.INFO=2]="INFO",ft[ft.WARN=3]="WARN",ft[ft.ERROR=4]="ERROR",ft[ft.SILENT=5]="SILENT";const xt={debug:gt.DEBUG,verbose:gt.VERBOSE,info:gt.INFO,warn:gt.WARN,error:gt.ERROR,silent:gt.SILENT},yt=gt.INFO,vt={[gt.DEBUG]:"log",[gt.VERBOSE]:"log",[gt.INFO]:"info",[gt.WARN]:"warn",[gt.ERROR]:"error"},bt=(e,t,...s)=>{if(t<e.logLevel)return;const n=(new Date).toISOString(),r=vt[t];if(!r)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[r](`[${n}]  ${e.name}:`,...s)};class wt{constructor(e){this.name=e,this._logLevel=yt,this._logHandler=bt,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in gt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?xt[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,gt.DEBUG,...e),this._logHandler(this,gt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,gt.VERBOSE,...e),this._logHandler(this,gt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,gt.INFO,...e),this._logHandler(this,gt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,gt.WARN,...e),this._logHandler(this,gt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,gt.ERROR,...e),this._logHandler(this,gt.ERROR,...e)}}let Nt,jt;const _t=new WeakMap,kt=new WeakMap,St=new WeakMap,Tt=new WeakMap,It=new WeakMap;let Et={get(e,t,s){if(e instanceof IDBTransaction){if("done"===t)return kt.get(e);if("objectStoreNames"===t)return e.objectStoreNames||St.get(e);if("store"===t)return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return Pt(e[t])},set:(e,t,s)=>(e[t]=s,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Ct(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(jt||(jt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(Dt(this),t),Pt(_t.get(this))}:function(...t){return Pt(e.apply(Dt(this),t))}:function(t,...s){const n=e.call(Dt(this),t,...s);return St.set(n,t.sort?t.sort():[t]),Pt(n)}}function At(e){return"function"==typeof e?Ct(e):(e instanceof IDBTransaction&&function(e){if(kt.has(e))return;const t=new Promise((t,s)=>{const n=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",i),e.removeEventListener("abort",i)},r=()=>{t(),n()},i=()=>{s(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",r),e.addEventListener("error",i),e.addEventListener("abort",i)});kt.set(e,t)}(e),t=e,(Nt||(Nt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,Et):e);var t}function Pt(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,s)=>{const n=()=>{e.removeEventListener("success",r),e.removeEventListener("error",i)},r=()=>{t(Pt(e.result)),n()},i=()=>{s(e.error),n()};e.addEventListener("success",r),e.addEventListener("error",i)});return t.then(t=>{t instanceof IDBCursor&&_t.set(t,e)}).catch(()=>{}),It.set(t,e),t}(e);if(Tt.has(e))return Tt.get(e);const t=At(e);return t!==e&&(Tt.set(e,t),It.set(t,e)),t}const Dt=e=>It.get(e),Rt=["get","getKey","getAll","getAllKeys","count"],Ot=["put","add","delete","clear"],Lt=new Map;function Mt(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Lt.get(t))return Lt.get(t);const s=t.replace(/FromIndex$/,""),n=t!==s,r=Ot.includes(s);if(!(s in(n?IDBIndex:IDBObjectStore).prototype)||!r&&!Rt.includes(s))return;const i=function(e,...t){return g(this,null,function*(){const i=this.transaction(e,r?"readwrite":"readonly");let a=i.store;return n&&(a=a.index(t.shift())),(yield Promise.all([a[s](...t),r&&i.done]))[0]})};return Lt.set(t,i),i}var Ft;Et=u(d({},Ft=Et),{get:(e,t,s)=>Mt(e,t)||Ft.get(e,t,s),has:(e,t)=>!!Mt(e,t)||Ft.has(e,t)});
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Ut{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const Vt="@firebase/app",Bt="0.14.4",Kt=new wt("@firebase/app"),zt="@firebase/app-compat",qt="@firebase/analytics-compat",$t="@firebase/analytics",Ht="@firebase/app-check-compat",Gt="@firebase/app-check",Jt="@firebase/auth",Wt="@firebase/auth-compat",Qt="@firebase/database",Yt="@firebase/data-connect",Xt="@firebase/database-compat",Zt="@firebase/functions",es="@firebase/functions-compat",ts="@firebase/installations",ss="@firebase/installations-compat",ns="@firebase/messaging",rs="@firebase/messaging-compat",is="@firebase/performance",as="@firebase/performance-compat",os="@firebase/remote-config",ls="@firebase/remote-config-compat",cs="@firebase/storage",ds="@firebase/storage-compat",us="@firebase/firestore",hs="@firebase/ai",ms="@firebase/firestore-compat",ps="firebase",gs="[DEFAULT]",fs={[Vt]:"fire-core",[zt]:"fire-core-compat",[$t]:"fire-analytics",[qt]:"fire-analytics-compat",[Gt]:"fire-app-check",[Ht]:"fire-app-check-compat",[Jt]:"fire-auth",[Wt]:"fire-auth-compat",[Qt]:"fire-rtdb",[Yt]:"fire-data-connect",[Xt]:"fire-rtdb-compat",[Zt]:"fire-fn",[es]:"fire-fn-compat",[ts]:"fire-iid",[ss]:"fire-iid-compat",[ns]:"fire-fcm",[rs]:"fire-fcm-compat",[is]:"fire-perf",[as]:"fire-perf-compat",[os]:"fire-rc",[ls]:"fire-rc-compat",[cs]:"fire-gcs",[ds]:"fire-gcs-compat",[us]:"fire-fst",[ms]:"fire-fst-compat",[hs]:"fire-vertex","fire-js":"fire-js",[ps]:"fire-js-all"},xs=new Map,ys=new Map,vs=new Map;function bs(e,t){try{e.container.addComponent(t)}catch(s){Kt.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,s)}}function ws(e){const t=e.name;if(vs.has(t))return Kt.debug(`There were multiple attempts to register component ${t}.`),!1;vs.set(t,e);for(const s of xs.values())bs(s,e);for(const s of ys.values())bs(s,e);return!0}function Ns(e,t){const s=e.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),e.container.getProvider(t)}function js(e){return null!=e&&void 0!==e.settings}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const _s=new tt("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class ks{constructor(e,t,s){this._isDeleted=!1,this._options=d({},e),this._config=d({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new ut("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw _s.create("app-deleted",{appName:this._name})}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Ss="12.4.0";function Ts(e,t={}){let s=e;"object"!=typeof t&&(t={name:t});const n=d({name:gs,automaticDataCollectionEnabled:!0},t),r=n.name;if("string"!=typeof r||!r)throw _s.create("bad-app-name",{appName:String(r)});if(s||(s=ze()),!s)throw _s.create("no-options");const i=xs.get(r);if(i){if(nt(s,i.options)&&nt(n,i.config))return i;throw _s.create("duplicate-app",{appName:r})}const a=new pt(r);for(const l of vs.values())a.addComponent(l);const o=new ks(s,n,a);return xs.set(r,o),o}function Is(e=gs){const t=xs.get(e);if(!t&&e===gs&&ze())return Ts();if(!t)throw _s.create("no-app",{appName:e});return t}function Es(e,t,s){var n;let r=null!=(n=fs[e])?n:e;s&&(r+=`-${s}`);const i=r.match(/\s|\//),a=t.match(/\s|\//);if(i||a){const e=[`Unable to register library "${r}" with version "${t}":`];return i&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Kt.warn(e.join(" "))}ws(new ut(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Cs="firebase-heartbeat-store";let As=null;function Ps(){return As||(As=function(e,t,{blocked:s,upgrade:n,blocking:r,terminated:i}={}){const a=indexedDB.open(e,t),o=Pt(a);return n&&a.addEventListener("upgradeneeded",e=>{n(Pt(a.result),e.oldVersion,e.newVersion,Pt(a.transaction),e)}),s&&a.addEventListener("blocked",e=>s(e.oldVersion,e.newVersion,e)),o.then(e=>{i&&e.addEventListener("close",()=>i()),r&&e.addEventListener("versionchange",e=>r(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Cs)}catch(s){console.warn(s)}}}).catch(e=>{throw _s.create("idb-open",{originalErrorMessage:e.message})})),As}function Ds(e,t){return g(this,null,function*(){try{const s=(yield Ps()).transaction(Cs,"readwrite"),n=s.objectStore(Cs);yield n.put(t,Rs(e)),yield s.done}catch(s){if(s instanceof et)Kt.warn(s.message);else{const e=_s.create("idb-set",{originalErrorMessage:null==s?void 0:s.message});Kt.warn(e.message)}}})}function Rs(e){return`${e.name}!${e.options.appId}`}
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Os{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Ms(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}triggerHeartbeat(){return g(this,null,function*(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=Ls();if(null==(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,null==(null==(t=this._heartbeatsCache)?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(e=>e.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:s}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,s=e[0].date;for(let n=1;n<e.length;n++)e[n].date<s&&(s=e[n].date,t=n);return t}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(s){Kt.warn(s)}})}getHeartbeatsHeader(){return g(this,null,function*(){var e;try{if(null===this._heartbeatsCache&&(yield this._heartbeatsCachePromise),null==(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=Ls(),{heartbeatsToSend:s,unsentEntries:n}=function(e,t=1024){const s=[];let n=e.slice();for(const r of e){const e=s.find(e=>e.agent===r.agent);if(e){if(e.dates.push(r.date),Fs(s)>t){e.dates.pop();break}}else if(s.push({agent:r.agent,dates:[r.date]}),Fs(s)>t){s.pop();break}n=n.slice(1)}return{heartbeatsToSend:s,unsentEntries:n}}(this._heartbeatsCache.heartbeats),r=Me(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(t){return Kt.warn(t),""}})}}function Ls(){return(new Date).toISOString().substring(0,10)}class Ms{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return g(this,null,function*(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let s=!0;const n="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(n);r.onsuccess=()=>{r.result.close(),s||self.indexedDB.deleteDatabase(n),e(!0)},r.onupgradeneeded=()=>{s=!1},r.onerror=()=>{var e;t((null==(e=r.error)?void 0:e.message)||"")}}catch(s){t(s)}}).then(()=>!0).catch(()=>!1)})}read(){return g(this,null,function*(){if(yield this._canUseIndexedDBPromise){const e=yield function(e){return g(this,null,function*(){try{const t=(yield Ps()).transaction(Cs),s=yield t.objectStore(Cs).get(Rs(e));return yield t.done,s}catch(t){if(t instanceof et)Kt.warn(t.message);else{const e=_s.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});Kt.warn(e.message)}}})}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}})}overwrite(e){return g(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){const s=yield this.read();return Ds(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}})}add(e){return g(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){const s=yield this.read();return Ds(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}})}}function Fs(e){return Me(JSON.stringify({version:2,heartbeats:e})).length}var Us;Us="",ws(new ut("platform-logger",e=>new Ut(e),"PRIVATE")),ws(new ut("heartbeat",e=>new Os(e),"PRIVATE")),Es(Vt,Bt,Us),Es(Vt,Bt,"esm2020"),Es("fire-js","");var Vs,Bs,Ks="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};
/** @license
    Copyright The Closure Library Authors.
    SPDX-License-Identifier: Apache-2.0
    */(function(){var e;
/** @license
      
       Copyright The Closure Library Authors.
       SPDX-License-Identifier: Apache-2.0
      */function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function s(e,t,s){s||(s=0);const n=Array(16);if("string"==typeof t)for(var r=0;r<16;++r)n[r]=t.charCodeAt(s++)|t.charCodeAt(s++)<<8|t.charCodeAt(s++)<<16|t.charCodeAt(s++)<<24;else for(r=0;r<16;++r)n[r]=t[s++]|t[s++]<<8|t[s++]<<16|t[s++]<<24;t=e.g[0],s=e.g[1],r=e.g[2];let i,a=e.g[3];i=t+(a^s&(r^a))+n[0]+3614090360&4294967295,i=a+(r^(t=s+(i<<7&4294967295|i>>>25))&(s^r))+n[1]+3905402710&4294967295,a=t+(i<<12&4294967295|i>>>20),i=r+(s^a&(t^s))+n[2]+606105819&4294967295,i=s+(t^(r=a+(i<<17&4294967295|i>>>15))&(a^t))+n[3]+3250441966&4294967295,i=t+(a^(s=r+(i<<22&4294967295|i>>>10))&(r^a))+n[4]+4118548399&4294967295,i=a+(r^(t=s+(i<<7&4294967295|i>>>25))&(s^r))+n[5]+1200080426&4294967295,a=t+(i<<12&4294967295|i>>>20),i=r+(s^a&(t^s))+n[6]+2821735955&4294967295,i=s+(t^(r=a+(i<<17&4294967295|i>>>15))&(a^t))+n[7]+4249261313&4294967295,i=t+(a^(s=r+(i<<22&4294967295|i>>>10))&(r^a))+n[8]+1770035416&4294967295,i=a+(r^(t=s+(i<<7&4294967295|i>>>25))&(s^r))+n[9]+2336552879&4294967295,a=t+(i<<12&4294967295|i>>>20),i=r+(s^a&(t^s))+n[10]+4294925233&4294967295,i=s+(t^(r=a+(i<<17&4294967295|i>>>15))&(a^t))+n[11]+2304563134&4294967295,i=t+(a^(s=r+(i<<22&4294967295|i>>>10))&(r^a))+n[12]+1804603682&4294967295,i=a+(r^(t=s+(i<<7&4294967295|i>>>25))&(s^r))+n[13]+4254626195&4294967295,a=t+(i<<12&4294967295|i>>>20),i=r+(s^a&(t^s))+n[14]+2792965006&4294967295,i=s+(t^(r=a+(i<<17&4294967295|i>>>15))&(a^t))+n[15]+1236535329&4294967295,i=t+(r^a&((s=r+(i<<22&4294967295|i>>>10))^r))+n[1]+4129170786&4294967295,i=a+(s^r&((t=s+(i<<5&4294967295|i>>>27))^s))+n[6]+3225465664&4294967295,a=t+(i<<9&4294967295|i>>>23),i=r+(t^s&(a^t))+n[11]+643717713&4294967295,i=s+(a^t&((r=a+(i<<14&4294967295|i>>>18))^a))+n[0]+3921069994&4294967295,i=t+(r^a&((s=r+(i<<20&4294967295|i>>>12))^r))+n[5]+3593408605&4294967295,i=a+(s^r&((t=s+(i<<5&4294967295|i>>>27))^s))+n[10]+38016083&4294967295,a=t+(i<<9&4294967295|i>>>23),i=r+(t^s&(a^t))+n[15]+3634488961&4294967295,i=s+(a^t&((r=a+(i<<14&4294967295|i>>>18))^a))+n[4]+3889429448&4294967295,i=t+(r^a&((s=r+(i<<20&4294967295|i>>>12))^r))+n[9]+568446438&4294967295,i=a+(s^r&((t=s+(i<<5&4294967295|i>>>27))^s))+n[14]+3275163606&4294967295,a=t+(i<<9&4294967295|i>>>23),i=r+(t^s&(a^t))+n[3]+4107603335&4294967295,i=s+(a^t&((r=a+(i<<14&4294967295|i>>>18))^a))+n[8]+1163531501&4294967295,i=t+(r^a&((s=r+(i<<20&4294967295|i>>>12))^r))+n[13]+2850285829&4294967295,i=a+(s^r&((t=s+(i<<5&4294967295|i>>>27))^s))+n[2]+4243563512&4294967295,a=t+(i<<9&4294967295|i>>>23),i=r+(t^s&(a^t))+n[7]+1735328473&4294967295,i=s+(a^t&((r=a+(i<<14&4294967295|i>>>18))^a))+n[12]+2368359562&4294967295,i=t+((s=r+(i<<20&4294967295|i>>>12))^r^a)+n[5]+4294588738&4294967295,i=a+((t=s+(i<<4&4294967295|i>>>28))^s^r)+n[8]+2272392833&4294967295,a=t+(i<<11&4294967295|i>>>21),i=r+(a^t^s)+n[11]+1839030562&4294967295,i=s+((r=a+(i<<16&4294967295|i>>>16))^a^t)+n[14]+4259657740&4294967295,i=t+((s=r+(i<<23&4294967295|i>>>9))^r^a)+n[1]+2763975236&4294967295,i=a+((t=s+(i<<4&4294967295|i>>>28))^s^r)+n[4]+1272893353&4294967295,a=t+(i<<11&4294967295|i>>>21),i=r+(a^t^s)+n[7]+4139469664&4294967295,i=s+((r=a+(i<<16&4294967295|i>>>16))^a^t)+n[10]+3200236656&4294967295,i=t+((s=r+(i<<23&4294967295|i>>>9))^r^a)+n[13]+681279174&4294967295,i=a+((t=s+(i<<4&4294967295|i>>>28))^s^r)+n[0]+3936430074&4294967295,a=t+(i<<11&4294967295|i>>>21),i=r+(a^t^s)+n[3]+3572445317&4294967295,i=s+((r=a+(i<<16&4294967295|i>>>16))^a^t)+n[6]+76029189&4294967295,i=t+((s=r+(i<<23&4294967295|i>>>9))^r^a)+n[9]+3654602809&4294967295,i=a+((t=s+(i<<4&4294967295|i>>>28))^s^r)+n[12]+3873151461&4294967295,a=t+(i<<11&4294967295|i>>>21),i=r+(a^t^s)+n[15]+530742520&4294967295,i=s+((r=a+(i<<16&4294967295|i>>>16))^a^t)+n[2]+3299628645&4294967295,i=t+(r^((s=r+(i<<23&4294967295|i>>>9))|~a))+n[0]+4096336452&4294967295,i=a+(s^((t=s+(i<<6&4294967295|i>>>26))|~r))+n[7]+1126891415&4294967295,a=t+(i<<10&4294967295|i>>>22),i=r+(t^(a|~s))+n[14]+2878612391&4294967295,i=s+(a^((r=a+(i<<15&4294967295|i>>>17))|~t))+n[5]+4237533241&4294967295,i=t+(r^((s=r+(i<<21&4294967295|i>>>11))|~a))+n[12]+1700485571&4294967295,i=a+(s^((t=s+(i<<6&4294967295|i>>>26))|~r))+n[3]+2399980690&4294967295,a=t+(i<<10&4294967295|i>>>22),i=r+(t^(a|~s))+n[10]+4293915773&4294967295,i=s+(a^((r=a+(i<<15&4294967295|i>>>17))|~t))+n[1]+2240044497&4294967295,i=t+(r^((s=r+(i<<21&4294967295|i>>>11))|~a))+n[8]+1873313359&4294967295,i=a+(s^((t=s+(i<<6&4294967295|i>>>26))|~r))+n[15]+4264355552&4294967295,a=t+(i<<10&4294967295|i>>>22),i=r+(t^(a|~s))+n[6]+2734768916&4294967295,i=s+(a^((r=a+(i<<15&4294967295|i>>>17))|~t))+n[13]+1309151649&4294967295,i=t+(r^((s=r+(i<<21&4294967295|i>>>11))|~a))+n[4]+4149444226&4294967295,i=a+(s^((t=s+(i<<6&4294967295|i>>>26))|~r))+n[11]+3174756917&4294967295,a=t+(i<<10&4294967295|i>>>22),i=r+(t^(a|~s))+n[2]+718787259&4294967295,i=s+(a^((r=a+(i<<15&4294967295|i>>>17))|~t))+n[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(r+(i<<21&4294967295|i>>>11))&4294967295,e.g[2]=e.g[2]+r&4294967295,e.g[3]=e.g[3]+a&4294967295}function n(e,t){this.h=t;const s=[];let n=!0;for(let r=e.length-1;r>=0;r--){const i=0|e[r];n&&i==t||(s[r]=i,n=!1)}this.g=s}!function(e,t){function s(){}s.prototype=t.prototype,e.F=t.prototype,e.prototype=new s,e.prototype.constructor=e,e.D=function(e,s,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return t.prototype[s].apply(e,r)}}(t,function(){this.blockSize=-1}),t.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.v=function(e,t){void 0===t&&(t=e.length);const n=t-this.blockSize,r=this.C;let i=this.h,a=0;for(;a<t;){if(0==i)for(;a<=n;)s(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(r[i++]=e.charCodeAt(a++),i==this.blockSize){s(this,r),i=0;break}}else for(;a<t;)if(r[i++]=e[a++],i==this.blockSize){s(this,r),i=0;break}}this.h=i,this.o+=t},t.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var s=e.length-8;s<e.length;++s)e[s]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,s=0;s<4;++s)for(let n=0;n<32;n+=8)e[t++]=this.g[s]>>>n&255;return e};var r={};function i(e){return-128<=e&&e<128?function(e,t){var s=r;return Object.prototype.hasOwnProperty.call(s,e)?s[e]:s[e]=t(e)}(e,function(e){return new n([0|e],e<0?-1:0)}):new n([0|e],e<0?-1:0)}function a(e){if(isNaN(e)||!isFinite(e))return o;if(e<0)return h(a(-e));const t=[];let s=1;for(let n=0;e>=s;n++)t[n]=e/s|0,s*=4294967296;return new n(t,0)}var o=i(0),l=i(1),c=i(16777216);function d(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function u(e){return-1==e.h}function h(e){const t=e.g.length,s=[];for(let n=0;n<t;n++)s[n]=~e.g[n];return new n(s,~e.h).add(l)}function m(e,t){return e.add(h(t))}function p(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function g(e,t){this.g=e,this.h=t}function f(e,t){if(d(t))throw Error("division by zero");if(d(e))return new g(o,o);if(u(e))return t=f(h(e),t),new g(h(t.g),h(t.h));if(u(t))return t=f(e,h(t)),new g(h(t.g),t.h);if(e.g.length>30){if(u(e)||u(t))throw Error("slowDivide_ only works with positive integers.");for(var s=l,n=t;n.l(e)<=0;)s=x(s),n=x(n);var r=y(s,1),i=y(n,1);for(n=y(n,2),s=y(s,2);!d(n);){var c=i.add(n);c.l(e)<=0&&(r=r.add(s),i=c),n=y(n,1),s=y(s,1)}return t=m(e,r.j(t)),new g(r,t)}for(r=o;e.l(t)>=0;){for(s=Math.max(1,Math.floor(e.m()/t.m())),n=(n=Math.ceil(Math.log(s)/Math.LN2))<=48?1:Math.pow(2,n-48),c=(i=a(s)).j(t);u(c)||c.l(e)>0;)c=(i=a(s-=n)).j(t);d(i)&&(i=l),r=r.add(i),e=m(e,c)}return new g(r,e)}function x(e){const t=e.g.length+1,s=[];for(let n=0;n<t;n++)s[n]=e.i(n)<<1|e.i(n-1)>>>31;return new n(s,e.h)}function y(e,t){const s=t>>5;t%=32;const r=e.g.length-s,i=[];for(let n=0;n<r;n++)i[n]=t>0?e.i(n+s)>>>t|e.i(n+s+1)<<32-t:e.i(n+s);return new n(i,e.h)}(e=n.prototype).m=function(){if(u(this))return-h(this).m();let e=0,t=1;for(let s=0;s<this.g.length;s++){const n=this.i(s);e+=(n>=0?n:4294967296+n)*t,t*=4294967296}return e},e.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(d(this))return"0";if(u(this))return"-"+h(this).toString(e);const t=a(Math.pow(e,6));var s=this;let n="";for(;;){const r=f(s,t).g;let i=(((s=m(s,r.j(t))).g.length>0?s.g[0]:s.h)>>>0).toString(e);if(d(s=r))return i+n;for(;i.length<6;)i="0"+i;n=i+n}},e.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return u(e=m(this,e))?-1:d(e)?0:1},e.abs=function(){return u(this)?h(this):this},e.add=function(e){const t=Math.max(this.g.length,e.g.length),s=[];let r=0;for(let n=0;n<=t;n++){let t=r+(65535&this.i(n))+(65535&e.i(n)),i=(t>>>16)+(this.i(n)>>>16)+(e.i(n)>>>16);r=i>>>16,t&=65535,i&=65535,s[n]=i<<16|t}return new n(s,-2147483648&s[s.length-1]?-1:0)},e.j=function(e){if(d(this)||d(e))return o;if(u(this))return u(e)?h(this).j(h(e)):h(h(this).j(e));if(u(e))return h(this.j(h(e)));if(this.l(c)<0&&e.l(c)<0)return a(this.m()*e.m());const t=this.g.length+e.g.length,s=[];for(var r=0;r<2*t;r++)s[r]=0;for(r=0;r<this.g.length;r++)for(let t=0;t<e.g.length;t++){const n=this.i(r)>>>16,i=65535&this.i(r),a=e.i(t)>>>16,o=65535&e.i(t);s[2*r+2*t]+=i*o,p(s,2*r+2*t),s[2*r+2*t+1]+=n*o,p(s,2*r+2*t+1),s[2*r+2*t+1]+=i*a,p(s,2*r+2*t+1),s[2*r+2*t+2]+=n*a,p(s,2*r+2*t+2)}for(e=0;e<t;e++)s[e]=s[2*e+1]<<16|s[2*e];for(e=t;e<2*t;e++)s[e]=0;return new n(s,0)},e.B=function(e){return f(this,e).h},e.and=function(e){const t=Math.max(this.g.length,e.g.length),s=[];for(let n=0;n<t;n++)s[n]=this.i(n)&e.i(n);return new n(s,this.h&e.h)},e.or=function(e){const t=Math.max(this.g.length,e.g.length),s=[];for(let n=0;n<t;n++)s[n]=this.i(n)|e.i(n);return new n(s,this.h|e.h)},e.xor=function(e){const t=Math.max(this.g.length,e.g.length),s=[];for(let n=0;n<t;n++)s[n]=this.i(n)^e.i(n);return new n(s,this.h^e.h)},t.prototype.digest=t.prototype.A,t.prototype.reset=t.prototype.u,t.prototype.update=t.prototype.v,Bs=t,n.prototype.add=n.prototype.add,n.prototype.multiply=n.prototype.j,n.prototype.modulo=n.prototype.B,n.prototype.compare=n.prototype.l,n.prototype.toNumber=n.prototype.m,n.prototype.toString=n.prototype.toString,n.prototype.getBits=n.prototype.i,n.fromNumber=a,n.fromString=function e(t,s){if(0==t.length)throw Error("number format error: empty string");if((s=s||10)<2||36<s)throw Error("radix out of range: "+s);if("-"==t.charAt(0))return h(e(t.substring(1),s));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');const n=a(Math.pow(s,8));let r=o;for(let o=0;o<t.length;o+=8){var i=Math.min(8,t.length-o);const e=parseInt(t.substring(o,o+i),s);i<8?(i=a(Math.pow(s,i)),r=r.j(i).add(a(e))):(r=r.j(n),r=r.add(a(e)))}return r},Vs=n}).apply(void 0!==Ks?Ks:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var zs,qs,$s,Hs,Gs,Js,Ws,Qs,Ys="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};
/** @license
    Copyright The Closure Library Authors.
    SPDX-License-Identifier: Apache-2.0
    */(function(){var e,t=Object.defineProperty,s=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Ys&&Ys];for(var t=0;t<e.length;++t){var s=e[t];if(s&&s.Math==Math)return s}throw Error("Cannot find global object")}(this);function n(e,n){if(n)e:{var r=s;e=e.split(".");for(var i=0;i<e.length-1;i++){var a=e[i];if(!(a in r))break e;r=r[a]}(n=n(i=r[e=e[e.length-1]]))!=i&&null!=n&&t(r,e,{configurable:!0,writable:!0,value:n})}}n("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),n("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),n("Object.entries",function(e){return e||function(e){var t,s=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&s.push([t,e[t]]);return s}});
/** @license
      
       Copyright The Closure Library Authors.
       SPDX-License-Identifier: Apache-2.0
      */
var r=r||{},i=this||self;function a(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function o(e,t,s){return e.call.apply(e.bind,arguments)}function l(e,t,s){return(l=o).apply(null,arguments)}function c(e,t){var s=Array.prototype.slice.call(arguments,1);return function(){var t=s.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function d(e,t){function s(){}s.prototype=t.prototype,e.Z=t.prototype,e.prototype=new s,e.prototype.constructor=e,e.Ob=function(e,s,n){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return t.prototype[s].apply(e,r)}}var u="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function h(e){const t=e.length;if(t>0){const s=Array(t);for(let n=0;n<t;n++)s[n]=e[n];return s}return[]}function m(e,t){for(let n=1;n<arguments.length;n++){const t=arguments[n];var s=typeof t;if("array"==(s="object"!=s?s:t?Array.isArray(t)?"array":s:"null")||"object"==s&&"number"==typeof t.length){s=e.length||0;const n=t.length||0;e.length=s+n;for(let r=0;r<n;r++)e[s+r]=t[r]}else e.push(t)}}function p(e){i.setTimeout(()=>{throw e},0)}function g(){var e=b;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var f=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new x,e=>e.reset());class x{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let y,v=!1,b=new class{constructor(){this.h=this.g=null}add(e,t){const s=f.get();s.set(e,t),this.h?this.h.next=s:this.g=s,this.h=s}},w=()=>{const e=Promise.resolve(void 0);y=()=>{e.then(N)}};function N(){for(var e;e=g();){try{e.h.call(e.g)}catch(s){p(s)}var t=f;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}v=!1}function j(){this.u=this.u,this.C=this.C}function _(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}j.prototype.u=!1,j.prototype.dispose=function(){this.u||(this.u=!0,this.N())},j.prototype[Symbol.dispose]=function(){this.dispose()},j.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},_.prototype.h=function(){this.defaultPrevented=!0};var k=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};i.addEventListener("test",e,t),i.removeEventListener("test",e,t)}catch(s){}return e}();function S(e){return/^[\s\xa0]*$/.test(e)}function T(e,t){_.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}d(T,_),T.prototype.init=function(e,t){const s=this.type=e.type,n=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==s?t=e.fromElement:"mouseout"==s&&(t=e.toElement)),this.relatedTarget=t,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&T.Z.h.call(this)},T.prototype.h=function(){T.Z.h.call(this);const e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var I="closure_listenable_"+(1e6*Math.random()|0),E=0;function C(e,t,s,n,r){this.listener=e,this.proxy=null,this.src=t,this.type=s,this.capture=!!n,this.ha=r,this.key=++E,this.da=this.fa=!1}function A(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function P(e,t,s){for(const n in e)t.call(s,e[n],n,e)}function D(e){const t={};for(const s in e)t[s]=e[s];return t}const R="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function O(e,t){let s,n;for(let r=1;r<arguments.length;r++){for(s in n=arguments[r],n)e[s]=n[s];for(let t=0;t<R.length;t++)s=R[t],Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}}function L(e){this.src=e,this.g={},this.h=0}function M(e,t){const s=t.type;if(s in e.g){var n,r=e.g[s],i=Array.prototype.indexOf.call(r,t,void 0);(n=i>=0)&&Array.prototype.splice.call(r,i,1),n&&(A(t),0==e.g[s].length&&(delete e.g[s],e.h--))}}function F(e,t,s,n){for(let r=0;r<e.length;++r){const i=e[r];if(!i.da&&i.listener==t&&i.capture==!!s&&i.ha==n)return r}return-1}L.prototype.add=function(e,t,s,n,r){const i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);const a=F(e,t,n,r);return a>-1?(t=e[a],s||(t.fa=!1)):((t=new C(t,this.src,i,!!n,r)).fa=s,e.push(t)),t};var U="closure_lm_"+(1e6*Math.random()|0),V={};function B(e,t,s,n,r){if(Array.isArray(t)){for(let i=0;i<t.length;i++)B(e,t[i],s,n,r);return null}return s=J(s),e&&e[I]?e.J(t,s,!!a(n)&&!!n.capture,r):function(e,t,s,n,r,i){if(!t)throw Error("Invalid event type");const o=a(r)?!!r.capture:!!r;let l=H(e);if(l||(e[U]=l=new L(e)),(s=l.add(t,s,n,o,i)).proxy)return s;if(n=function(){function e(s){return t.call(e.src,e.listener,s)}const t=$;return e}(),s.proxy=n,n.src=e,n.listener=s,e.addEventListener)k||(r=o),void 0===r&&(r=!1),e.addEventListener(t.toString(),n,r);else if(e.attachEvent)e.attachEvent(q(t.toString()),n);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(n)}return s}(e,t,s,!1,n,r)}function K(e,t,s,n,r){if(Array.isArray(t))for(var i=0;i<t.length;i++)K(e,t[i],s,n,r);else n=a(n)?!!n.capture:!!n,s=J(s),e&&e[I]?(e=e.i,(i=String(t).toString())in e.g&&(s=F(t=e.g[i],s,n,r))>-1&&(A(t[s]),Array.prototype.splice.call(t,s,1),0==t.length&&(delete e.g[i],e.h--))):e&&(e=H(e))&&(t=e.g[t.toString()],e=-1,t&&(e=F(t,s,n,r)),(s=e>-1?t[e]:null)&&z(s))}function z(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[I])M(t.i,e);else{var s=e.type,n=e.proxy;t.removeEventListener?t.removeEventListener(s,n,e.capture):t.detachEvent?t.detachEvent(q(s),n):t.addListener&&t.removeListener&&t.removeListener(n),(s=H(t))?(M(s,e),0==s.h&&(s.src=null,t[U]=null)):A(e)}}}function q(e){return e in V?V[e]:V[e]="on"+e}function $(e,t){if(e.da)e=!0;else{t=new T(t,this);const s=e.listener,n=e.ha||e.src;e.fa&&z(e),e=s.call(n,t)}return e}function H(e){return(e=e[U])instanceof L?e:null}var G="__closure_events_fn_"+(1e9*Math.random()>>>0);function J(e){return"function"==typeof e?e:(e[G]||(e[G]=function(t){return e.handleEvent(t)}),e[G])}function W(){j.call(this),this.i=new L(this),this.M=this,this.G=null}function Q(e,t){var s,n=e.G;if(n)for(s=[];n;n=n.G)s.push(n);if(e=e.M,n=t.type||t,"string"==typeof t)t=new _(t,e);else if(t instanceof _)t.target=t.target||e;else{var r=t;O(t=new _(n,e),r)}let i,a;if(r=!0,s)for(a=s.length-1;a>=0;a--)i=t.g=s[a],r=Y(i,n,!0,t)&&r;if(i=t.g=e,r=Y(i,n,!0,t)&&r,r=Y(i,n,!1,t)&&r,s)for(a=0;a<s.length;a++)i=t.g=s[a],r=Y(i,n,!1,t)&&r}function Y(e,t,s,n){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let r=!0;for(let i=0;i<t.length;++i){const a=t[i];if(a&&!a.da&&a.capture==s){const t=a.listener,s=a.ha||a.src;a.fa&&M(e.i,a),r=!1!==t.call(s,n)&&r}}return r&&!n.defaultPrevented}function X(e){e.g=function(e,t){if("function"!=typeof e){if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=l(e.handleEvent,e)}return Number(t)>2147483647?-1:i.setTimeout(e,t||0)}(()=>{e.g=null,e.i&&(e.i=!1,X(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}d(W,j),W.prototype[I]=!0,W.prototype.removeEventListener=function(e,t,s,n){K(this,e,t,s,n)},W.prototype.N=function(){if(W.Z.N.call(this),this.i){var e=this.i;for(const t in e.g){const s=e.g[t];for(let e=0;e<s.length;e++)A(s[e]);delete e.g[t],e.h--}}this.G=null},W.prototype.J=function(e,t,s,n){return this.i.add(String(e),t,!1,s,n)},W.prototype.K=function(e,t,s,n){return this.i.add(String(e),t,!0,s,n)};class Z extends j{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:X(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ee(e){j.call(this),this.h=e,this.g={}}d(ee,j);var te=[];function se(e){P(e.g,function(e,t){this.g.hasOwnProperty(t)&&z(e)},e),e.g={}}ee.prototype.N=function(){ee.Z.N.call(this),se(this)},ee.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ne=i.JSON.stringify,re=i.JSON.parse,ie=class{stringify(e){return i.JSON.stringify(e,void 0)}parse(e){return i.JSON.parse(e,void 0)}};function ae(){}function oe(){}var le={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ce(){_.call(this,"d")}function de(){_.call(this,"c")}d(ce,_),d(de,_);var ue={},he=null;function me(){return he=he||new W}function pe(e){_.call(this,ue.Ia,e)}function ge(e){const t=me();Q(t,new pe(t))}function fe(e,t){_.call(this,ue.STAT_EVENT,e),this.stat=t}function xe(e){const t=me();Q(t,new fe(t,e))}function ye(e,t){_.call(this,ue.Ja,e),this.size=t}function ve(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout(function(){e()},t)}function be(){this.g=!0}function we(e,t,s,n){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{const i=JSON.parse(t);if(i)for(e=0;e<i.length;e++)if(Array.isArray(i[e])){var s=i[e];if(!(s.length<2)){var n=s[1];if(Array.isArray(n)&&!(n.length<1)){var r=n[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(let e=1;e<n.length;e++)n[e]=""}}}return ne(i)}catch(i){return t}}(e,s)+(n?" "+n:"")})}ue.Ia="serverreachability",d(pe,_),ue.STAT_EVENT="statevent",d(fe,_),ue.Ja="timingevent",d(ye,_),be.prototype.ua=function(){this.g=!1},be.prototype.info=function(){};var Ne,je={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},_e={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function ke(){}function Se(e){return encodeURIComponent(String(e))}function Te(e){var t=1;e=e.split(":");const s=[];for(;t>0&&e.length;)s.push(e.shift()),t--;return e.length&&s.push(e.join(":")),s}function Ie(e,t,s,n){this.j=e,this.i=t,this.l=s,this.S=n||1,this.V=new ee(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Ee}function Ee(){this.i=null,this.g="",this.h=!1}d(ke,ae),ke.prototype.g=function(){return new XMLHttpRequest},Ne=new ke;var Ce={},Ae={};function Pe(e,t,s){e.M=1,e.A=nt(Xe(t)),e.u=s,e.R=!0,De(e,null)}function De(e,t){e.F=Date.now(),Le(e),e.B=Xe(e.A);var s=e.B,n=e.S;Array.isArray(n)||(n=[String(n)]),xt(s.i,"t",n),e.C=0,s=e.j.L,e.h=new Ee,e.g=ns(e.j,s?t:null,!e.u),e.P>0&&(e.O=new Z(l(e.Y,e,e.g),e.P)),t=e.V,s=e.g,n=e.ba;var r="readystatechange";Array.isArray(r)||(r&&(te[0]=r.toString()),r=te);for(let i=0;i<r.length;i++){const e=B(s,r[i],n||t.handleEvent,!1,t.h||t);if(!e)break;t.g[e.key]=e}t=e.J?D(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),ge(),function(e,t,s,n,r,i){e.info(function(){if(e.g)if(i){var a="",o=i.split("&");for(let e=0;e<o.length;e++){var l=o[e].split("=");if(l.length>1){const e=l[0];l=l[1];const t=e.split("_");a=t.length>=2&&"type"==t[1]?a+(e+"=")+l+"&":a+(e+"=redacted&")}}}else a=null;else a=i;return"XMLHTTP REQ ("+n+") [attempt "+r+"]: "+t+"\n"+s+"\n"+a})}(e.i,e.v,e.B,e.l,e.S,e.u)}function Re(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function Oe(e,t){var s=e.C,n=t.indexOf("\n",s);return-1==n?Ae:(s=Number(t.substring(s,n)),isNaN(s)?Ce:(n+=1)+s>t.length?Ae:(t=t.slice(n,n+s),e.C=n+s,t))}function Le(e){e.T=Date.now()+e.H,Me(e,e.H)}function Me(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=ve(l(e.aa,e),t)}function Fe(e){e.D&&(i.clearTimeout(e.D),e.D=null)}function Ue(e){0==e.j.I||e.K||Xt(e.j,e)}function Ve(e){Fe(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,se(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function Be(e,t){try{var s=e.j;if(0!=s.I&&(s.g==e||He(s.h,e)))if(!e.L&&He(s.h,e)&&3==s.I){try{var n=s.Ba.g.parse(t)}catch(d){n=null}if(Array.isArray(n)&&3==n.length){var r=n;if(0==r[0]){e:if(!s.v){if(s.g){if(!(s.g.F+3e3<e.F))break e;Yt(s),Bt(s)}Jt(s),xe(18)}}else s.xa=r[1],0<s.xa-s.K&&r[2]<37500&&s.F&&0==s.A&&!s.C&&(s.C=ve(l(s.Va,s),6e3));$e(s.h)<=1&&s.ta&&(s.ta=void 0)}else es(s,11)}else if((e.L||s.g==e)&&Yt(s),!S(t))for(r=s.Ba.g.parse(t),t=0;t<r.length;t++){let l=r[t];const d=l[0];if(!(d<=s.K))if(s.K=d,l=l[1],2==s.I)if("c"==l[0]){s.M=l[1],s.ba=l[2];const t=l[3];null!=t&&(s.ka=t,s.j.info("VER="+s.ka));const r=l[4];null!=r&&(s.za=r,s.j.info("SVER="+s.za));const d=l[5];null!=d&&"number"==typeof d&&d>0&&(n=1.5*d,s.O=n,s.j.info("backChannelRequestTimeoutMs_="+n)),n=s;const u=e.g;if(u){const e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var i=n.h;i.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(Ge(i,i.h),i.h=null))}if(n.G){const e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(n.wa=e,st(n.J,n.G,e))}}s.I=3,s.l&&s.l.ra(),s.aa&&(s.T=Date.now()-e.F,s.j.info("Handshake RTT: "+s.T+"ms"));var a=e;if((n=s).na=ss(n,n.L?n.ba:null,n.W),a.L){Je(n.h,a);var o=a,c=n.O;c&&(o.H=c),o.D&&(Fe(o),Le(o)),n.g=a}else Gt(n);s.i.length>0&&zt(s)}else"stop"!=l[0]&&"close"!=l[0]||es(s,7);else 3==s.I&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?es(s,7):Vt(s):"noop"!=l[0]&&s.l&&s.l.qa(l),s.A=0)}ge()}catch(d){}}Ie.prototype.ba=function(e){e=e.target;const t=this.O;t&&3==Lt(e)?t.j():this.Y(e)},Ie.prototype.Y=function(e){try{if(e==this.g)e:{const l=Lt(this.g),c=this.g.ya();if(this.g.ca(),!(l<3)&&(3!=l||this.g&&(this.h.h||this.g.la()||Mt(this.g)))){this.K||4!=l||7==c||ge(),Fe(this);var t=this.g.ca();this.X=t;var s=function(e){if(!Re(e))return e.g.la();const t=Mt(e.g);if(""===t)return"";let s="";const n=t.length,r=4==Lt(e.g);if(!e.h.i){if("undefined"==typeof TextDecoder)return Ve(e),Ue(e),"";e.h.i=new i.TextDecoder}for(let i=0;i<n;i++)e.h.h=!0,s+=e.h.i.decode(t[i],{stream:!(r&&i==n-1)});return t.length=0,e.h.g+=s,e.C=0,e.h.g}(this);if(this.o=200==t,function(e,t,s,n,r,i,a){e.info(function(){return"XMLHTTP RESP ("+n+") [ attempt "+r+"]: "+t+"\n"+s+"\n"+i+" "+a})}(this.i,this.v,this.B,this.l,this.S,l,t),this.o){if(this.U&&!this.L){t:{if(this.g){var n,r=this.g;if((n=r.g?r.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!S(n)){var a=n;break t}}a=null}if(!(e=a)){this.o=!1,this.m=3,xe(12),Ve(this),Ue(this);break e}we(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Be(this,e)}if(this.R){let t;for(e=!0;!this.K&&this.C<s.length;){if(t=Oe(this,s),t==Ae){4==l&&(this.m=4,xe(14),e=!1),we(this.i,this.l,null,"[Incomplete Response]");break}if(t==Ce){this.m=4,xe(15),we(this.i,this.l,s,"[Invalid Chunk]"),e=!1;break}we(this.i,this.l,t,null),Be(this,t)}if(Re(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=l||0!=s.length||this.h.h||(this.m=1,xe(16),e=!1),this.o=this.o&&e,e){if(s.length>0&&!this.W){this.W=!0;var o=this.j;o.g==this&&o.aa&&!o.P&&(o.j.info("Great, no buffering proxy detected. Bytes received: "+s.length),Wt(o),o.P=!0,xe(11))}}else we(this.i,this.l,s,"[Invalid Chunked Response]"),Ve(this),Ue(this)}else we(this.i,this.l,s,null),Be(this,s);4==l&&Ve(this),this.o&&!this.K&&(4==l?Xt(this.j,this):(this.o=!1,Le(this)))}else(function(e){const t={};e=(e.g&&Lt(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let n=0;n<e.length;n++){if(S(e[n]))continue;var s=Te(e[n]);const r=s[0];if("string"!=typeof(s=s[1]))continue;s=s.trim();const i=t[r]||[];t[r]=i,i.push(s)}!function(e,t){for(const s in e)t.call(void 0,e[s],s,e)}(t,function(e){return e.join(", ")})})(this.g),400==t&&s.indexOf("Unknown SID")>0?(this.m=3,xe(12)):(this.m=0,xe(13)),Ve(this),Ue(this)}}}catch(l){}},Ie.prototype.cancel=function(){this.K=!0,Ve(this)},Ie.prototype.aa=function(){this.D=null;const e=Date.now();e-this.T>=0?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.B),2!=this.M&&(ge(),xe(17)),Ve(this),this.m=2,Ue(this)):Me(this,this.T-e)};var Ke=class{constructor(e,t){this.g=e,this.map=t}};function ze(e){this.l=e||10,e=i.PerformanceNavigationTiming?(e=i.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function qe(e){return!!e.h||!!e.g&&e.g.size>=e.j}function $e(e){return e.h?1:e.g?e.g.size:0}function He(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Ge(e,t){e.g?e.g.add(t):e.h=t}function Je(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function We(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const s of e.g.values())t=t.concat(s.G);return t}return h(e.i)}ze.prototype.cancel=function(){if(this.i=We(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var Qe=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ye(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof Ye?(this.l=e.l,Ze(this,e.j),this.o=e.o,this.g=e.g,et(this,e.u),this.h=e.h,tt(this,yt(e.i)),this.m=e.m):e&&(t=String(e).match(Qe))?(this.l=!1,Ze(this,t[1]||"",!0),this.o=rt(t[2]||""),this.g=rt(t[3]||"",!0),et(this,t[4]),this.h=rt(t[5]||"",!0),tt(this,t[6]||"",!0),this.m=rt(t[7]||"")):(this.l=!1,this.i=new ht(null,this.l))}function Xe(e){return new Ye(e)}function Ze(e,t,s){e.j=s?rt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function et(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function tt(e,t,s){t instanceof ht?(e.i=t,function(e,t){t&&!e.j&&(mt(e),e.i=null,e.g.forEach(function(e,t){const s=t.toLowerCase();t!=s&&(pt(this,t),xt(this,s,e))},e)),e.j=t}(e.i,e.l)):(s||(t=it(t,dt)),e.i=new ht(t,e.l))}function st(e,t,s){e.i.set(t,s)}function nt(e){return st(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function rt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function it(e,t,s){return"string"==typeof e?(e=encodeURI(e).replace(t,at),s&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function at(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Ye.prototype.toString=function(){const e=[];var t=this.j;t&&e.push(it(t,ot,!0),":");var s=this.g;return(s||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(it(t,ot,!0),"@"),e.push(Se(s).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(s=this.u)&&e.push(":",String(s))),(s=this.h)&&(this.g&&"/"!=s.charAt(0)&&e.push("/"),e.push(it(s,"/"==s.charAt(0)?ct:lt,!0))),(s=this.i.toString())&&e.push("?",s),(s=this.m)&&e.push("#",it(s,ut)),e.join("")},Ye.prototype.resolve=function(e){const t=Xe(this);let s=!!e.j;s?Ze(t,e.j):s=!!e.o,s?t.o=e.o:s=!!e.g,s?t.g=e.g:s=null!=e.u;var n=e.h;if(s)et(t,e.u);else if(s=!!e.h){if("/"!=n.charAt(0))if(this.g&&!this.h)n="/"+n;else{var r=t.h.lastIndexOf("/");-1!=r&&(n=t.h.slice(0,r+1)+n)}if(".."==(r=n)||"."==r)n="";else if(-1!=r.indexOf("./")||-1!=r.indexOf("/.")){n=0==r.lastIndexOf("/",0),r=r.split("/");const e=[];for(let t=0;t<r.length;){const s=r[t++];"."==s?n&&t==r.length&&e.push(""):".."==s?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),n&&t==r.length&&e.push("")):(e.push(s),n=!0)}n=e.join("/")}else n=r}return s?t.h=n:s=""!==e.i.toString(),s?tt(t,yt(e.i)):s=!!e.m,s&&(t.m=e.m),t};var ot=/[#\/\?@]/g,lt=/[#\?:]/g,ct=/[#\?]/g,dt=/[#\?@]/g,ut=/#/g;function ht(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function mt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let s=0;s<e.length;s++){const n=e[s].indexOf("=");let r,i=null;n>=0?(r=e[s].substring(0,n),i=e[s].substring(n+1)):r=e[s],t(r,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,s){e.add(decodeURIComponent(t.replace(/\+/g," ")),s)}))}function pt(e,t){mt(e),t=vt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function gt(e,t){return mt(e),t=vt(e,t),e.g.has(t)}function ft(e,t){mt(e);let s=[];if("string"==typeof t)gt(e,t)&&(s=s.concat(e.g.get(vt(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)s=s.concat(e[t]);return s}function xt(e,t,s){pt(e,t),s.length>0&&(e.i=null,e.g.set(vt(e,t),h(s)),e.h+=s.length)}function yt(e){const t=new ht;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function vt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function bt(e,t,s,n,r){try{r&&(r.onload=null,r.onerror=null,r.onabort=null,r.ontimeout=null),n(s)}catch(i){}}function wt(){this.g=new ie}function Nt(e){this.i=e.Sb||null,this.h=e.ab||!1}function jt(e,t){W.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function _t(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function kt(e){e.readyState=4,e.l=null,e.j=null,e.B=null,St(e)}function St(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Tt(e){let t="";return P(e,function(e,s){t+=s,t+=":",t+=e,t+="\r\n"}),t}function It(e,t,s){e:{for(n in s){var n=!1;break e}n=!0}n||(s=Tt(s),"string"==typeof e?null!=s&&Se(s):st(e,t,s))}function Et(e){W.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(e=ht.prototype).add=function(e,t){mt(this),this.i=null,e=vt(this,e);let s=this.g.get(e);return s||this.g.set(e,s=[]),s.push(t),this.h+=1,this},e.forEach=function(e,t){mt(this),this.g.forEach(function(s,n){s.forEach(function(s){e.call(t,s,n,this)},this)},this)},e.set=function(e,t){return mt(this),this.i=null,gt(this,e=vt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&(e=ft(this,e)).length>0?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(let n=0;n<t.length;n++){var s=t[n];const r=Se(s);s=ft(this,s);for(let t=0;t<s.length;t++){let n=r;""!==s[t]&&(n+="="+Se(s[t])),e.push(n)}}return this.i=e.join("&")},d(Nt,ae),Nt.prototype.g=function(){return new jt(this.i,this.h)},d(jt,W),(e=jt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,St(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||i).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,kt(this)),this.readyState=0},e.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,St(this)),this.g&&(this.readyState=3,St(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;_t(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},e.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?kt(this):St(this),3==this.readyState&&_t(this)}},e.Oa=function(e){this.g&&(this.response=this.responseText=e,kt(this))},e.Na=function(e){this.g&&(this.response=e,kt(this))},e.ga=function(){this.g&&kt(this)},e.setRequestHeader=function(e,t){this.A.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var s=t.next();!s.done;)s=s.value,e.push(s[0]+": "+s[1]),s=t.next();return e.join("\r\n")},Object.defineProperty(jt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),d(Et,W);var Ct=/^https?$/i,At=["POST","PUT"];function Pt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,Dt(e),Ot(e)}function Dt(e){e.A||(e.A=!0,Q(e,"complete"),Q(e,"error"))}function Rt(e){if(e.h&&void 0!==r)if(e.v&&4==Lt(e))setTimeout(e.Ca.bind(e),0);else if(Q(e,"readystatechange"),4==Lt(e)){e.h=!1;try{const r=e.ca();e:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var s;if(!(s=t)){var n;if(n=0===r){let t=String(e.D).match(Qe)[1]||null;!t&&i.self&&i.self.location&&(t=i.self.location.protocol.slice(0,-1)),n=!Ct.test(t?t.toLowerCase():"")}s=n}if(s)Q(e,"complete"),Q(e,"success");else{e.o=6;try{var a=Lt(e)>2?e.g.statusText:""}catch(o){a=""}e.l=a+" ["+e.ca()+"]",Dt(e)}}finally{Ot(e)}}}function Ot(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);const n=e.g;e.g=null,t||Q(e,"ready");try{n.onreadystatechange=null}catch(s){}}}function Lt(e){return e.g?e.g.readyState:0}function Mt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Ft(e,t,s){return s&&s.internalChannelParams&&s.internalChannelParams[e]||t}function Ut(e){this.za=0,this.i=[],this.j=new be,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Ft("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Ft("baseRetryDelayMs",5e3,e),this.Za=Ft("retryDelaySeedMs",1e4,e),this.Ta=Ft("forwardChannelMaxRetries",2,e),this.va=Ft("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new ze(e&&e.concurrentRequestLimit),this.Ba=new wt,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function Vt(e){if(Kt(e),3==e.I){var t=e.V++,s=Xe(e.J);if(st(s,"SID",e.M),st(s,"RID",t),st(s,"TYPE","terminate"),$t(e,s),(t=new Ie(e,e.j,t)).M=2,t.A=nt(Xe(s)),s=!1,i.navigator&&i.navigator.sendBeacon)try{s=i.navigator.sendBeacon(t.A.toString(),"")}catch(n){}!s&&i.Image&&((new Image).src=t.A,s=!0),s||(t.g=ns(t.j,null),t.g.ea(t.A)),t.F=Date.now(),Le(t)}ts(e)}function Bt(e){e.g&&(Wt(e),e.g.cancel(),e.g=null)}function Kt(e){Bt(e),e.v&&(i.clearTimeout(e.v),e.v=null),Yt(e),e.h.cancel(),e.m&&("number"==typeof e.m&&i.clearTimeout(e.m),e.m=null)}function zt(e){if(!qe(e.h)&&!e.m){e.m=!0;var t=e.Ea;y||w(),v||(y(),v=!0),b.add(t,e),e.D=0}}function qt(e,t){var s;s=t?t.l:e.V++;const n=Xe(e.J);st(n,"SID",e.M),st(n,"RID",s),st(n,"AID",e.K),$t(e,n),e.u&&e.o&&It(n,e.u,e.o),s=new Ie(e,e.j,s,e.D+1),null===e.u&&(s.J=e.o),t&&(e.i=t.G.concat(e.i)),t=Ht(e,s,1e3),s.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),Ge(e.h,s),Pe(s,n,t)}function $t(e,t){e.H&&P(e.H,function(e,s){st(t,s,e)}),e.l&&P({},function(e,s){st(t,s,e)})}function Ht(e,t,s){s=Math.min(e.i.length,s);const n=e.l?l(e.l.Ka,e.l,e):null;e:{var r=e.i;let t=-1;for(;;){const e=["count="+s];-1==t?s>0?(t=r[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let l=!0;for(let d=0;d<s;d++){var i=r[d].g;const s=r[d].map;if((i-=t)<0)t=Math.max(0,r[d].g-100),l=!1;else try{i="req"+i+"_"||"";try{var o=s instanceof Map?s:Object.entries(s);for(const[t,s]of o){let n=s;a(s)&&(n=ne(s)),e.push(i+t+"="+encodeURIComponent(n))}}catch(c){throw e.push(i+"type="+encodeURIComponent("_badmap")),c}}catch(c){n&&n(s)}}if(l){o=e.join("&");break e}}o=void 0}return e=e.i.splice(0,s),t.G=e,o}function Gt(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;y||w(),v||(y(),v=!0),b.add(t,e),e.A=0}}function Jt(e){return!(e.g||e.v||e.A>=3||(e.Y++,e.v=ve(l(e.Da,e),Zt(e,e.A)),e.A++,0))}function Wt(e){null!=e.B&&(i.clearTimeout(e.B),e.B=null)}function Qt(e){e.g=new Ie(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=Xe(e.na);st(t,"RID","rpc"),st(t,"SID",e.M),st(t,"AID",e.K),st(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&st(t,"TO",e.ia),st(t,"TYPE","xmlhttp"),$t(e,t),e.u&&e.o&&It(t,e.u,e.o),e.O&&(e.g.H=e.O);var s=e.g;e=e.ba,s.M=1,s.A=nt(Xe(t)),s.u=null,s.R=!0,De(s,e)}function Yt(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function Xt(e,t){var s=null;if(e.g==t){Yt(e),Wt(e),e.g=null;var n=2}else{if(!He(e.h,t))return;s=t.G,Je(e.h,t),n=1}if(0!=e.I)if(t.o)if(1==n){s=t.u?t.u.length:0,t=Date.now()-t.F;var r=e.D;Q(n=me(),new ye(n,s)),zt(e)}else Gt(e);else if(3==(r=t.m)||0==r&&t.X>0||!(1==n&&function(e,t){return!($e(e.h)>=e.h.j-(e.m?1:0)||(e.m?(e.i=t.G.concat(e.i),0):1==e.I||2==e.I||e.D>=(e.Sa?0:e.Ta)||(e.m=ve(l(e.Ea,e,t),Zt(e,e.D)),e.D++,0)))}(e,t)||2==n&&Jt(e)))switch(s&&s.length>0&&(t=e.h,t.i=t.i.concat(s)),r){case 1:es(e,5);break;case 4:es(e,10);break;case 3:es(e,6);break;default:es(e,2)}}function Zt(e,t){let s=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(s*=2),s*t}function es(e,t){if(e.j.info("Error code "+t),2==t){var s=l(e.bb,e),n=e.Ua;const t=!n;n=new Ye(n||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||Ze(n,"https"),nt(n),t?function(e,t){const s=new be;if(i.Image){const n=new Image;n.onload=c(bt,s,"TestLoadImage: loaded",!0,t,n),n.onerror=c(bt,s,"TestLoadImage: error",!1,t,n),n.onabort=c(bt,s,"TestLoadImage: abort",!1,t,n),n.ontimeout=c(bt,s,"TestLoadImage: timeout",!1,t,n),i.setTimeout(function(){n.ontimeout&&n.ontimeout()},1e4),n.src=e}else t(!1)}(n.toString(),s):function(e,t){new be;const s=new AbortController,n=setTimeout(()=>{s.abort(),bt(0,0,!1,t)},1e4);fetch(e,{signal:s.signal}).then(e=>{clearTimeout(n),e.ok?bt(0,0,!0,t):bt(0,0,!1,t)}).catch(()=>{clearTimeout(n),bt(0,0,!1,t)})}(n.toString(),s)}else xe(2);e.I=0,e.l&&e.l.pa(t),ts(e),Kt(e)}function ts(e){if(e.I=0,e.ja=[],e.l){const t=We(e.h);0==t.length&&0==e.i.length||(m(e.ja,t),m(e.ja,e.i),e.h.i.length=0,h(e.i),e.i.length=0),e.l.oa()}}function ss(e,t,s){var n=s instanceof Ye?Xe(s):new Ye(s);if(""!=n.g)t&&(n.g=t+"."+n.g),et(n,n.u);else{var r=i.location;n=r.protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port;const e=new Ye(null);n&&Ze(e,n),t&&(e.g=t),r&&et(e,r),s&&(e.h=s),n=e}return s=e.G,t=e.wa,s&&t&&st(n,s,t),st(n,"VER",e.ka),$t(e,n),n}function ns(e,t,s){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Aa&&!e.ma?new Et(new Nt({ab:s})):new Et(e.ma)).Fa(e.L),t}function rs(){}function is(){}function as(e,t){W.call(this),this.g=new Ut(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!S(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!S(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new cs(this)}function os(e){ce.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const s in t){e=s;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function ls(){de.call(this),this.status=1}function cs(e){this.g=e}(e=Et.prototype).Fa=function(e){this.H=e},e.ea=function(e,t,s,n){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Ne.g(),this.g.onreadystatechange=u(l(this.Ca,this));try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(a){return void Pt(this,a)}if(e=s||"",s=new Map(this.headers),n)if(Object.getPrototypeOf(n)===Object.prototype)for(var r in n)s.set(r,n[r]);else{if("function"!=typeof n.keys||"function"!=typeof n.get)throw Error("Unknown input type for opt_headers: "+String(n));for(const e of n.keys())s.set(e,n.get(e))}n=Array.from(s.keys()).find(e=>"content-type"==e.toLowerCase()),r=i.FormData&&e instanceof i.FormData,!(Array.prototype.indexOf.call(At,t,void 0)>=0)||n||r||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,o]of s)this.g.setRequestHeader(i,o);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(e),this.v=!1}catch(a){Pt(this,a)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,Q(this,"complete"),Q(this,"abort"),Ot(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ot(this,!0)),Et.Z.N.call(this)},e.Ca=function(){this.u||(this.B||this.v||this.j?Rt(this):this.Xa())},e.Xa=function(){Rt(this)},e.isActive=function(){return!!this.g},e.ca=function(){try{return Lt(this)>2?this.g.status:-1}catch(e){return-1}},e.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),re(t)}},e.ya=function(){return this.o},e.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=Ut.prototype).ka=8,e.I=1,e.connect=function(e,t,s,n){xe(0),this.W=e,this.H=t||{},s&&void 0!==n&&(this.H.OSID=s,this.H.OAID=n),this.F=this.X,this.J=ss(this,null,this.W),zt(this)},e.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const r=new Ie(this,this.j,e);let i=this.o;if(this.U&&(i?(i=D(i),O(i,this.U)):i=this.U),null!==this.u||this.R||(r.J=i,i=null),this.S)e:{for(var t=0,s=0;s<this.i.length;s++){var n=this.i[s];if(void 0===(n="__data__"in n.map&&"string"==typeof(n=n.map.__data__)?n.length:void 0))break;if((t+=n)>4096){t=s;break e}if(4096===t||s===this.i.length-1){t=s+1;break e}}t=1e3}else t=1e3;t=Ht(this,r,t),st(s=Xe(this.J),"RID",e),st(s,"CVER",22),this.G&&st(s,"X-HTTP-Session-Id",this.G),$t(this,s),i&&(this.R?t="headers="+Se(Tt(i))+"&"+t:this.u&&It(s,this.u,i)),Ge(this.h,r),this.Ra&&st(s,"TYPE","init"),this.S?(st(s,"$req",t),st(s,"SID","null"),r.U=!0,Pe(r,s,null)):Pe(r,s,t),this.I=2}}else 3==this.I&&(e?qt(this,e):0==this.i.length||qe(this.h)||qt(this))},e.Da=function(){if(this.v=null,Qt(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=ve(l(this.Wa,this),e)}},e.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,xe(10),Bt(this),Qt(this))},e.Va=function(){null!=this.C&&(this.C=null,Bt(this),Jt(this),xe(19))},e.bb=function(e){e?(this.j.info("Successfully pinged google.com"),xe(2)):(this.j.info("Failed to ping google.com"),xe(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=rs.prototype).ra=function(){},e.qa=function(){},e.pa=function(){},e.oa=function(){},e.isActive=function(){return!0},e.Ka=function(){},is.prototype.g=function(e,t){return new as(e,t)},d(as,W),as.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},as.prototype.close=function(){Vt(this.g)},as.prototype.o=function(e){var t=this.g;if("string"==typeof e){var s={};s.__data__=e,e=s}else this.v&&((s={}).__data__=ne(e),e=s);t.i.push(new Ke(t.Ya++,e)),3==t.I&&zt(t)},as.prototype.N=function(){this.g.l=null,delete this.j,Vt(this.g),delete this.g,as.Z.N.call(this)},d(os,ce),d(ls,de),d(cs,rs),cs.prototype.ra=function(){Q(this.g,"a")},cs.prototype.qa=function(e){Q(this.g,new os(e))},cs.prototype.pa=function(e){Q(this.g,new ls)},cs.prototype.oa=function(){Q(this.g,"b")},is.prototype.createWebChannel=is.prototype.g,as.prototype.send=as.prototype.o,as.prototype.open=as.prototype.m,as.prototype.close=as.prototype.close,Qs=function(){return new is},Ws=function(){return me()},Js=ue,Gs={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},je.NO_ERROR=0,je.TIMEOUT=8,je.HTTP_ERROR=6,Hs=je,_e.COMPLETE="complete",$s=_e,oe.EventType=le,le.OPEN="a",le.CLOSE="b",le.ERROR="c",le.MESSAGE="d",W.prototype.listen=W.prototype.J,qs=oe,Et.prototype.listenOnce=Et.prototype.K,Et.prototype.getLastError=Et.prototype.Ha,Et.prototype.getLastErrorCode=Et.prototype.ya,Et.prototype.getStatus=Et.prototype.ca,Et.prototype.getResponseJson=Et.prototype.La,Et.prototype.getResponseText=Et.prototype.la,Et.prototype.send=Et.prototype.ea,Et.prototype.setWithCredentials=Et.prototype.Fa,zs=Et}).apply(void 0!==Ys?Ys:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const Xs="@firebase/firestore",Zs="4.9.2";
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class en{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}en.UNAUTHENTICATED=new en(null),en.GOOGLE_CREDENTIALS=new en("google-credentials-uid"),en.FIRST_PARTY=new en("first-party-uid"),en.MOCK_USER=new en("mock-user");
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
let tn="12.3.0";
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const sn=new wt("@firebase/firestore");function nn(){return sn.logLevel}function rn(e,...t){if(sn.logLevel<=gt.DEBUG){const s=t.map(ln);sn.debug(`Firestore (${tn}): ${e}`,...s)}}function an(e,...t){if(sn.logLevel<=gt.ERROR){const s=t.map(ln);sn.error(`Firestore (${tn}): ${e}`,...s)}}function on(e,...t){if(sn.logLevel<=gt.WARN){const s=t.map(ln);sn.warn(`Firestore (${tn}): ${e}`,...s)}}function ln(e){if("string"==typeof e)return e;try{
/**
        * @license
        * Copyright 2020 Google LLC
        *
        * Licensed under the Apache License, Version 2.0 (the "License");
        * you may not use this file except in compliance with the License.
        * You may obtain a copy of the License at
        *
        *   http://www.apache.org/licenses/LICENSE-2.0
        *
        * Unless required by applicable law or agreed to in writing, software
        * distributed under the License is distributed on an "AS IS" BASIS,
        * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
        * See the License for the specific language governing permissions and
        * limitations under the License.
        */
return t=e,JSON.stringify(t)}catch(s){return e}var t}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function cn(e,t,s){let n="Unexpected state";"string"==typeof t?n=t:s=t,dn(e,n,s)}function dn(e,t,s){let n=`FIRESTORE (${tn}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==s)try{n+=" CONTEXT: "+JSON.stringify(s)}catch(r){n+=" CONTEXT: "+s}throw an(n),new Error(n)}function un(e,t,s,n){let r="Unexpected state";"string"==typeof s?r=s:n=s,e||dn(t,r,n)}function hn(e,t){return e}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const mn={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class pn extends et{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class gn{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class fn{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class xn{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(en.UNAUTHENTICATED))}shutdown(){}}class yn{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class vn{constructor(e){this.t=e,this.currentUser=en.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){un(void 0===this.o,42304);let s=this.i;const n=e=>this.i!==s?(s=this.i,t(e)):Promise.resolve();let r=new gn;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new gn,e.enqueueRetryable(()=>n(this.currentUser))};const i=()=>{const t=r;e.enqueueRetryable(()=>g(this,null,function*(){yield t.promise,yield n(this.currentUser)}))},a=e=>{rn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),i())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?a(e):(rn("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new gn)}},0),i()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(rn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(un("string"==typeof t.accessToken,31837,{l:t}),new fn(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return un(null===e||"string"==typeof e,2055,{h:e}),new en(e)}}class bn{constructor(e,t,s){this.P=e,this.T=t,this.I=s,this.type="FirstParty",this.user=en.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class wn{constructor(e,t,s){this.P=e,this.T=t,this.I=s}getToken(){return Promise.resolve(new bn(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(en.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Nn{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class jn{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,js(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){un(void 0===this.o,3512);const s=e=>{null!=e.error&&rn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const s=e.token!==this.m;return this.m=e.token,rn("FirebaseAppCheckTokenProvider",`Received ${s?"new":"existing"} token.`),s?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>s(t))};const n=e=>{rn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?n(e):rn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Nn(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(un("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new Nn(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function _n(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),s=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(s);else for(let n=0;n<e;n++)s[n]=Math.floor(256*Math.random());return s}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class kn{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const s=_n(40);for(let n=0;n<s.length;++n)t.length<20&&s[n]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(s[n]%62))}return t}}function Sn(e,t){return e<t?-1:e>t?1:0}function Tn(e,t){const s=Math.min(e.length,t.length);for(let n=0;n<s;n++){const s=e.charAt(n),r=t.charAt(n);if(s!==r)return In(s)===In(r)?Sn(s,r):In(s)?1:-1}return Sn(e.length,t.length)}function In(e){const t=e.charCodeAt(0);return t>=55296&&t<=57343}function En(e,t,s){return e.length===t.length&&e.every((e,n)=>s(e,t[n]))}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Cn="__name__";class An{constructor(e,t,s){void 0===t?t=0:t>e.length&&cn(637,{offset:t,range:e.length}),void 0===s?s=e.length-t:s>e.length-t&&cn(1746,{length:s,range:e.length-t}),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return 0===An.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof An?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let n=0;n<s;n++){const s=An.compareSegments(e.get(n),t.get(n));if(0!==s)return s}return Sn(e.length,t.length)}static compareSegments(e,t){const s=An.isNumericId(e),n=An.isNumericId(t);return s&&!n?-1:!s&&n?1:s&&n?An.extractNumericId(e).compare(An.extractNumericId(t)):Tn(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Vs.fromString(e.substring(4,e.length-2))}}class Pn extends An{construct(e,t,s){return new Pn(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new pn(mn.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter(e=>e.length>0))}return new Pn(t)}static emptyPath(){return new Pn([])}}const Dn=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Rn extends An{construct(e,t,s){return new Rn(e,t,s)}static isValidIdentifier(e){return Dn.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Rn.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Cn}static keyField(){return new Rn([Cn])}static fromServerFormat(e){const t=[];let s="",n=0;const r=()=>{if(0===s.length)throw new pn(mn.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let i=!1;for(;n<e.length;){const t=e[n];if("\\"===t){if(n+1===e.length)throw new pn(mn.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new pn(mn.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=t,n+=2}else"`"===t?(i=!i,n++):"."!==t||i?(s+=t,n++):(r(),n++)}if(r(),i)throw new pn(mn.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Rn(t)}static emptyPath(){return new Rn([])}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class On{constructor(e){this.path=e}static fromPath(e){return new On(Pn.fromString(e))}static fromName(e){return new On(Pn.fromString(e).popFirst(5))}static empty(){return new On(Pn.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Pn.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Pn.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new On(new Pn(e.slice()))}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Ln(e,t,s){if(!s)throw new pn(mn.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Mn(e){if(!On.isDocumentKey(e))throw new pn(mn.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Fn(e){if(On.isDocumentKey(e))throw new pn(mn.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Un(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function Vn(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const s=(t=e).constructor?t.constructor.name:null;return s?`a custom ${s} object`:"an object"}}var t;return"function"==typeof e?"a function":cn(12329,{type:typeof e})}function Bn(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new pn(mn.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const s=Vn(e);throw new pn(mn.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${s}`)}}return e}
/**
     * @license
     * Copyright 2025 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Kn(e,t){const s={typeString:e};return t&&(s.value=t),s}function zn(e,t){if(!Un(e))throw new pn(mn.INVALID_ARGUMENT,"JSON must be an object");let s;for(const n in t)if(t[n]){const r=t[n].typeString,i="value"in t[n]?{value:t[n].value}:void 0;if(!(n in e)){s=`JSON missing required field: '${n}'`;break}const a=e[n];if(r&&typeof a!==r){s=`JSON field '${n}' must be a ${r}.`;break}if(void 0!==i&&a!==i.value){s=`Expected '${n}' field to equal '${i.value}'`;break}}if(s)throw new pn(mn.INVALID_ARGUMENT,s);return!0}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const qn=-62135596800,$n=1e6;class Hn{static now(){return Hn.fromMillis(Date.now())}static fromDate(e){return Hn.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor((e-1e3*t)*$n);return new Hn(t,s)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new pn(mn.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new pn(mn.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<qn)throw new pn(mn.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new pn(mn.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/$n}_compareTo(e){return this.seconds===e.seconds?Sn(this.nanoseconds,e.nanoseconds):Sn(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Hn._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(zn(e,Hn._jsonSchema))return new Hn(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-qn;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Hn._jsonSchemaVersion="firestore/timestamp/1.0",Hn._jsonSchema={type:Kn("string",Hn._jsonSchemaVersion),seconds:Kn("number"),nanoseconds:Kn("number")};
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Gn{static fromTimestamp(e){return new Gn(e)}static min(){return new Gn(new Hn(0,0))}static max(){return new Gn(new Hn(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Jn(e){return new Wn(e.readTime,e.key,-1)}class Wn{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new Wn(Gn.min(),On.empty(),-1)}static max(){return new Wn(Gn.max(),On.empty(),-1)}}function Qn(e,t){let s=e.readTime.compareTo(t.readTime);return 0!==s?s:(s=On.comparator(e.documentKey,t.documentKey),0!==s?s:Sn(e.largestBatchId,t.largestBatchId)
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */)}class Yn{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Xn(e){return g(this,null,function*(){if(e.code!==mn.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;rn("LocalStore","Unexpectedly lost primary lease")})}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Zn{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&cn(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Zn((s,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(s,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(s,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof Zn?t:Zn.resolve(t)}catch(t){return Zn.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Zn.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Zn.reject(t)}static resolve(e){return new Zn((t,s)=>{t(e)})}static reject(e){return new Zn((t,s)=>{s(e)})}static waitFor(e){return new Zn((t,s)=>{let n=0,r=0,i=!1;e.forEach(e=>{++n,e.next(()=>{++r,i&&r===n&&t()},e=>s(e))}),i=!0,r===n&&t()})}static or(e){let t=Zn.resolve(!1);for(const s of e)t=t.next(e=>e?Zn.resolve(e):s());return t}static forEach(e,t){const s=[];return e.forEach((e,n)=>{s.push(t.call(this,e,n))}),this.waitFor(s)}static mapArray(e,t){return new Zn((s,n)=>{const r=e.length,i=new Array(r);let a=0;for(let o=0;o<r;o++){const l=o;t(e[l]).next(e=>{i[l]=e,++a,a===r&&s(i)},e=>n(e))}})}static doWhile(e,t){return new Zn((s,n)=>{const r=()=>{!0===e()?t().next(()=>{r()},n):s()};r()})}}function er(e){return"IndexedDbTransactionError"===e.name}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class tr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}function sr(e){return null==e}function nr(e){return 0===e&&1/e==-1/0}function rr(e,t){let s=t;const n=e.length;for(let r=0;r<n;r++){const t=e.charAt(r);switch(t){case"\0":s+="";break;case"":s+="";break;default:s+=t}}return s}function ir(e){return e+""}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function ar(e){let t=0;for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&t++;return t}function or(e,t){for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&t(s,e[s])}function lr(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */tr.ce=-1;class cr{constructor(e,t){this.comparator=e,this.root=t||ur.EMPTY}insert(e,t){return new cr(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ur.BLACK,null,null))}remove(e){return new cr(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ur.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(0===s)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const n=this.comparator(e,s.key);if(0===n)return t+s.left.size;n<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,s)=>(e(t,s),!1))}toString(){const e=[];return this.inorderTraversal((t,s)=>(e.push(`${t}:${s}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new dr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new dr(this.root,e,this.comparator,!1)}getReverseIterator(){return new dr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new dr(this.root,e,this.comparator,!0)}}class dr{constructor(e,t,s,n){this.isReverse=n,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?s(e.key,t):1,t&&n&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(0===r){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ur{constructor(e,t,s,n,r){this.key=e,this.value=t,this.color=null!=s?s:ur.RED,this.left=null!=n?n:ur.EMPTY,this.right=null!=r?r:ur.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,n,r){return new ur(null!=e?e:this.key,null!=t?t:this.value,null!=s?s:this.color,null!=n?n:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let n=this;const r=s(e,n.key);return n=r<0?n.copy(null,null,null,n.left.insert(e,t,s),null):0===r?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,s)),n.fixUp()}removeMin(){if(this.left.isEmpty())return ur.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,n=this;if(t(e,n.key)<0)n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key)){if(n.right.isEmpty())return ur.EMPTY;s=n.right.min(),n=n.copy(s.key,s.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ur.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ur.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw cn(43730,{key:this.key,value:this.value});if(this.right.isRed())throw cn(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw cn(27949);return e+(this.isRed()?0:1)}}ur.EMPTY=null,ur.RED=!0,ur.BLACK=!1,ur.EMPTY=new class{constructor(){this.size=0}get key(){throw cn(57766)}get value(){throw cn(16141)}get color(){throw cn(16727)}get left(){throw cn(29726)}get right(){throw cn(36894)}copy(e,t,s,n,r){return this}insert(e,t,s){return new ur(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class hr{constructor(e){this.comparator=e,this.data=new cr(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,s)=>(e(t),!1))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const n=s.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let s;for(s=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new mr(this.data.getIterator())}getIteratorFrom(e){return new mr(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof hr))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,n=s.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new hr(this.comparator);return t.data=e,t}}class mr{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class pr{constructor(e){this.fields=e,e.sort(Rn.comparator)}static empty(){return new pr([])}unionWith(e){let t=new hr(Rn.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new pr(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return En(this.fields,e.fields,(e,t)=>e.isEqual(t))}}
/**
     * @license
     * Copyright 2023 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class gr extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class fr{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new gr("Invalid base64 string: "+t):t}}(e);return new fr(t)}static fromUint8Array(e){const t=function(e){let t="";for(let s=0;s<e.length;++s)t+=String.fromCharCode(e[s]);return t}(e);return new fr(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let s=0;s<e.length;s++)t[s]=e.charCodeAt(s);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Sn(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}fr.EMPTY_BYTE_STRING=new fr("");const xr=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function yr(e){if(un(!!e,39018),"string"==typeof e){let t=0;const s=xr.exec(e);if(un(!!s,46558,{timestamp:e}),s[1]){let e=s[1];e=(e+"000000000").substr(0,9),t=Number(e)}const n=new Date(e);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:vr(e.seconds),nanos:vr(e.nanos)}}function vr(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function br(e){return"string"==typeof e?fr.fromBase64String(e):fr.fromUint8Array(e)}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const wr="server_timestamp",Nr="__type__",jr="__previous_value__",_r="__local_write_time__";function kr(e){var t,s;return(null==(s=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[Nr])?void 0:s.stringValue)===wr}function Sr(e){const t=e.mapValue.fields[jr];return kr(t)?Sr(t):t}function Tr(e){const t=yr(e.mapValue.fields[_r].timestampValue);return new Hn(t.seconds,t.nanos)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ir{constructor(e,t,s,n,r,i,a,o,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=n,this.ssl=r,this.forceLongPolling=i,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=c}}const Er="(default)";class Cr{constructor(e,t){this.projectId=e,this.database=t||Er}static empty(){return new Cr("","")}get isDefaultDatabase(){return this.database===Er}isEqual(e){return e instanceof Cr&&e.projectId===this.projectId&&e.database===this.database}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Ar="__type__",Pr="__max__",Dr={},Rr="__vector__",Or="value";function Lr(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?kr(e)?4:function(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===Pr}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(e)?9007199254740991:function(e){var t,s;const n=null==(s=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[Ar])?void 0:s.stringValue;return n===Rr}(e)?10:11:cn(28295,{value:e})}function Mr(e,t){if(e===t)return!0;const s=Lr(e);if(s!==Lr(t))return!1;switch(s){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Tr(e).isEqual(Tr(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const s=yr(e.timestampValue),n=yr(t.timestampValue);return s.seconds===n.seconds&&s.nanos===n.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return n=t,br(e.bytesValue).isEqual(br(n.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return vr(e.geoPointValue.latitude)===vr(t.geoPointValue.latitude)&&vr(e.geoPointValue.longitude)===vr(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return vr(e.integerValue)===vr(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const s=vr(e.doubleValue),n=vr(t.doubleValue);return s===n?nr(s)===nr(n):isNaN(s)&&isNaN(n)}return!1}(e,t);case 9:return En(e.arrayValue.values||[],t.arrayValue.values||[],Mr);case 10:case 11:return function(e,t){const s=e.mapValue.fields||{},n=t.mapValue.fields||{};if(ar(s)!==ar(n))return!1;for(const r in s)if(s.hasOwnProperty(r)&&(void 0===n[r]||!Mr(s[r],n[r])))return!1;return!0}(e,t);default:return cn(52216,{left:e})}var n}function Fr(e,t){return void 0!==(e.values||[]).find(e=>Mr(e,t))}function Ur(e,t){if(e===t)return 0;const s=Lr(e),n=Lr(t);if(s!==n)return Sn(s,n);switch(s){case 0:case 9007199254740991:return 0;case 1:return Sn(e.booleanValue,t.booleanValue);case 2:return function(e,t){const s=vr(e.integerValue||e.doubleValue),n=vr(t.integerValue||t.doubleValue);return s<n?-1:s>n?1:s===n?0:isNaN(s)?isNaN(n)?0:-1:1}(e,t);case 3:return Vr(e.timestampValue,t.timestampValue);case 4:return Vr(Tr(e),Tr(t));case 5:return Tn(e.stringValue,t.stringValue);case 6:return function(e,t){const s=br(e),n=br(t);return s.compareTo(n)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const s=e.split("/"),n=t.split("/");for(let r=0;r<s.length&&r<n.length;r++){const e=Sn(s[r],n[r]);if(0!==e)return e}return Sn(s.length,n.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const s=Sn(vr(e.latitude),vr(t.latitude));return 0!==s?s:Sn(vr(e.longitude),vr(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return Br(e.arrayValue,t.arrayValue);case 10:return function(e,t){var s,n,r,i;const a=e.fields||{},o=t.fields||{},l=null==(s=a[Or])?void 0:s.arrayValue,c=null==(n=o[Or])?void 0:n.arrayValue,d=Sn((null==(r=null==l?void 0:l.values)?void 0:r.length)||0,(null==(i=null==c?void 0:c.values)?void 0:i.length)||0);return 0!==d?d:Br(l,c)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===Dr&&t===Dr)return 0;if(e===Dr)return 1;if(t===Dr)return-1;const s=e.fields||{},n=Object.keys(s),r=t.fields||{},i=Object.keys(r);n.sort(),i.sort();for(let a=0;a<n.length&&a<i.length;++a){const e=Tn(n[a],i[a]);if(0!==e)return e;const t=Ur(s[n[a]],r[i[a]]);if(0!==t)return t}return Sn(n.length,i.length)}(e.mapValue,t.mapValue);default:throw cn(23264,{he:s})}}function Vr(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Sn(e,t);const s=yr(e),n=yr(t),r=Sn(s.seconds,n.seconds);return 0!==r?r:Sn(s.nanos,n.nanos)}function Br(e,t){const s=e.values||[],n=t.values||[];for(let r=0;r<s.length&&r<n.length;++r){const e=Ur(s[r],n[r]);if(e)return e}return Sn(s.length,n.length)}function Kr(e){return zr(e)}function zr(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=yr(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?br(e.bytesValue).toBase64():"referenceValue"in e?function(e){return On.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",s=!0;for(const n of e.values||[])s?s=!1:t+=",",t+=zr(n);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let s="{",n=!0;for(const r of t)n?n=!1:s+=",",s+=`${r}:${zr(e.fields[r])}`;return s+"}"}(e.mapValue):cn(61005,{value:e})}function qr(e){switch(Lr(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=Sr(e);return t?16+qr(t):16;case 5:return 2*e.stringValue.length;case 6:return br(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return(e.arrayValue.values||[]).reduce((e,t)=>e+qr(t),0);case 10:case 11:return function(e){let t=0;return or(e.fields,(e,s)=>{t+=e.length+qr(s)}),t}(e.mapValue);default:throw cn(13486,{value:e})}}function $r(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Hr(e){return!!e&&"integerValue"in e}function Gr(e){return!!e&&"arrayValue"in e}function Jr(e){return!!e&&"nullValue"in e}function Wr(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Qr(e){return!!e&&"mapValue"in e}function Yr(e){if(e.geoPointValue)return{geoPointValue:d({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:d({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return or(e.mapValue.fields,(e,s)=>t.mapValue.fields[e]=Yr(s)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let s=0;s<(e.arrayValue.values||[]).length;++s)t.arrayValue.values[s]=Yr(e.arrayValue.values[s]);return t}return d({},e)}class Xr{constructor(e){this.value=e}static empty(){return new Xr({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!Qr(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Yr(t)}setAll(e){let t=Rn.emptyPath(),s={},n=[];e.forEach((e,r)=>{if(!t.isImmediateParentOf(r)){const e=this.getFieldsMap(t);this.applyChanges(e,s,n),s={},n=[],t=r.popLast()}e?s[r.lastSegment()]=Yr(e):n.push(r.lastSegment())});const r=this.getFieldsMap(t);this.applyChanges(r,s,n)}delete(e){const t=this.field(e.popLast());Qr(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Mr(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let n=t.mapValue.fields[e.get(s)];Qr(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,s){or(t,(t,s)=>e[t]=s);for(const n of s)delete e[n]}clone(){return new Xr(Yr(this.value))}}function Zr(e){const t=[];return or(e.fields,(e,s)=>{const n=new Rn([e]);if(Qr(s)){const e=Zr(s.mapValue).fields;if(0===e.length)t.push(n);else for(const s of e)t.push(n.child(s))}else t.push(n)}),new pr(t)
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */}class ei{constructor(e,t,s,n,r,i,a){this.key=e,this.documentType=t,this.version=s,this.readTime=n,this.createTime=r,this.data=i,this.documentState=a}static newInvalidDocument(e){return new ei(e,0,Gn.min(),Gn.min(),Gn.min(),Xr.empty(),0)}static newFoundDocument(e,t,s,n){return new ei(e,1,t,Gn.min(),s,n,0)}static newNoDocument(e,t){return new ei(e,2,t,Gn.min(),Gn.min(),Xr.empty(),0)}static newUnknownDocument(e,t){return new ei(e,3,t,Gn.min(),Gn.min(),Xr.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Gn.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Xr.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Xr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Gn.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ei&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ei(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class ti{constructor(e,t){this.position=e,this.inclusive=t}}function si(e,t,s){let n=0;for(let r=0;r<e.position.length;r++){const i=t[r],a=e.position[r];if(n=i.field.isKeyField()?On.comparator(On.fromName(a.referenceValue),s.key):Ur(a,s.data.field(i.field)),"desc"===i.dir&&(n*=-1),0!==n)break}return n}function ni(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let s=0;s<e.position.length;s++)if(!Mr(e.position[s],t.position[s]))return!1;return!0}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class ri{constructor(e,t="asc"){this.field=e,this.dir=t}}function ii(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class ai{}class oi extends ai{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,s):new pi(e,t,s):"array-contains"===t?new yi(e,s):"in"===t?new vi(e,s):"not-in"===t?new bi(e,s):"array-contains-any"===t?new wi(e,s):new oi(e,t,s)}static createKeyFieldInFilter(e,t,s){return"in"===t?new gi(e,s):new fi(e,s)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(Ur(t,this.value)):null!==t&&Lr(this.value)===Lr(t)&&this.matchesComparison(Ur(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return cn(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class li extends ai{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new li(e,t)}matches(e){return ci(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function ci(e){return"and"===e.op}function di(e){return function(e){for(const t of e.filters)if(t instanceof li)return!1;return!0}(e)&&ci(e)}function ui(e){if(e instanceof oi)return e.field.canonicalString()+e.op.toString()+Kr(e.value);if(di(e))return e.filters.map(e=>ui(e)).join(",");{const t=e.filters.map(e=>ui(e)).join(",");return`${e.op}(${t})`}}function hi(e,t){return e instanceof oi?(s=e,(n=t)instanceof oi&&s.op===n.op&&s.field.isEqual(n.field)&&Mr(s.value,n.value)):e instanceof li?function(e,t){return t instanceof li&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,s,n)=>e&&hi(s,t.filters[n]),!0)}(e,t):void cn(19439);var s,n}function mi(e){return e instanceof oi?`${(t=e).field.canonicalString()} ${t.op} ${Kr(t.value)}`:e instanceof li?function(e){return e.op.toString()+" {"+e.getFilters().map(mi).join(" ,")+"}"}(e):"Filter";var t}class pi extends oi{constructor(e,t,s){super(e,t,s),this.key=On.fromName(s.referenceValue)}matches(e){const t=On.comparator(e.key,this.key);return this.matchesComparison(t)}}class gi extends oi{constructor(e,t){super(e,"in",t),this.keys=xi(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class fi extends oi{constructor(e,t){super(e,"not-in",t),this.keys=xi(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function xi(e,t){var s;return((null==(s=t.arrayValue)?void 0:s.values)||[]).map(e=>On.fromName(e.referenceValue))}class yi extends oi{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Gr(t)&&Fr(t.arrayValue,this.value)}}class vi extends oi{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Fr(this.value.arrayValue,t)}}class bi extends oi{constructor(e,t){super(e,"not-in",t)}matches(e){if(Fr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!Fr(this.value.arrayValue,t)}}class wi extends oi{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Gr(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>Fr(this.value.arrayValue,e))}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ni{constructor(e,t=null,s=[],n=[],r=null,i=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=n,this.limit=r,this.startAt=i,this.endAt=a,this.Te=null}}function ji(e,t=null,s=[],n=[],r=null,i=null,a=null){return new Ni(e,t,s,n,r,i,a)}function _i(e){const t=hn(e);if(null===t.Te){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>ui(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>{return(t=e).field.canonicalString()+t.dir;var t}).join(","),sr(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>Kr(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>Kr(e)).join(",")),t.Te=e}return t.Te}function ki(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let s=0;s<e.orderBy.length;s++)if(!ii(e.orderBy[s],t.orderBy[s]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let s=0;s<e.filters.length;s++)if(!hi(e.filters[s],t.filters[s]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!ni(e.startAt,t.startAt)&&ni(e.endAt,t.endAt)}function Si(e){return On.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ti{constructor(e,t=null,s=[],n=[],r=null,i="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=n,this.limit=r,this.limitType=i,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Ii(e){return new Ti(e)}function Ei(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Ci(e){return null!==e.collectionGroup}function Ai(e){const t=hn(e);if(null===t.Ie){t.Ie=[];const e=new Set;for(const n of t.explicitOrderBy)t.Ie.push(n),e.add(n.field.canonicalString());const s=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(e){let t=new hr(Rn.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t})(t).forEach(n=>{e.has(n.canonicalString())||n.isKeyField()||t.Ie.push(new ri(n,s))}),e.has(Rn.keyField().canonicalString())||t.Ie.push(new ri(Rn.keyField(),s))}return t.Ie}function Pi(e){const t=hn(e);return t.Ee||(t.Ee=function(e,t){if("F"===e.limitType)return ji(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new ri(e.field,t)});const s=e.endAt?new ti(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new ti(e.startAt.position,e.startAt.inclusive):null;return ji(e.path,e.collectionGroup,t,e.filters,e.limit,s,n)}}(t,Ai(e))),t.Ee}function Di(e,t){const s=e.filters.concat([t]);return new Ti(e.path,e.collectionGroup,e.explicitOrderBy.slice(),s,e.limit,e.limitType,e.startAt,e.endAt)}function Ri(e,t,s){return new Ti(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,s,e.startAt,e.endAt)}function Oi(e,t){return ki(Pi(e),Pi(t))&&e.limitType===t.limitType}function Li(e){return`${_i(Pi(e))}|lt:${e.limitType}`}function Mi(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>mi(e)).join(", ")}]`),sr(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>{return`${(t=e).field.canonicalString()} (${t.dir})`;var t}).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>Kr(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>Kr(e)).join(",")),`Target(${t})`}(Pi(e))}; limitType=${e.limitType})`}function Fi(e,t){return t.isFoundDocument()&&function(e,t){const s=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(s):On.isDocumentKey(e.path)?e.path.isEqual(s):e.path.isImmediateParentOf(s)}(e,t)&&function(e,t){for(const s of Ai(e))if(!s.field.isKeyField()&&null===t.data.field(s.field))return!1;return!0}(e,t)&&function(e,t){for(const s of e.filters)if(!s.matches(t))return!1;return!0}(e,t)&&(n=t,!((s=e).startAt&&!function(e,t,s){const n=si(e,t,s);return e.inclusive?n<=0:n<0}(s.startAt,Ai(s),n)||s.endAt&&!function(e,t,s){const n=si(e,t,s);return e.inclusive?n>=0:n>0}(s.endAt,Ai(s),n)));var s,n}function Ui(e){return(t,s)=>{let n=!1;for(const r of Ai(e)){const e=Vi(r,t,s);if(0!==e)return e;n=n||r.field.isKeyField()}return 0}}function Vi(e,t,s){const n=e.field.isKeyField()?On.comparator(t.key,s.key):function(e,t,s){const n=t.data.field(e),r=s.data.field(e);return null!==n&&null!==r?Ur(n,r):cn(42886)}(e.field,t,s);switch(e.dir){case"asc":return n;case"desc":return-1*n;default:return cn(19790,{direction:e.dir})}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Bi{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(void 0!==s)for(const[n,r]of s)if(this.equalsFn(n,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const s=this.mapKeyFn(e),n=this.inner[s];if(void 0===n)return this.inner[s]=[[e,t]],void this.innerSize++;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return void(n[r]=[e,t]);n.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(void 0===s)return!1;for(let n=0;n<s.length;n++)if(this.equalsFn(s[n][0],e))return 1===s.length?delete this.inner[t]:s.splice(n,1),this.innerSize--,!0;return!1}forEach(e){or(this.inner,(t,s)=>{for(const[n,r]of s)e(n,r)})}isEmpty(){return lr(this.inner)}size(){return this.innerSize}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Ki=new cr(On.comparator);function zi(){return Ki}const qi=new cr(On.comparator);function $i(...e){let t=qi;for(const s of e)t=t.insert(s.key,s);return t}function Hi(e){let t=qi;return e.forEach((e,s)=>t=t.insert(e,s.overlayedDocument)),t}function Gi(){return Wi()}function Ji(){return Wi()}function Wi(){return new Bi(e=>e.toString(),(e,t)=>e.isEqual(t))}const Qi=new cr(On.comparator),Yi=new hr(On.comparator);function Xi(...e){let t=Yi;for(const s of e)t=t.add(s);return t}const Zi=new hr(Sn);
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function ea(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:nr(t)?"-0":t}}function ta(e){return{integerValue:""+e}}function sa(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!nr(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(t)?ta(t):ea(e,t)}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class na{constructor(){this._=void 0}}function ra(e,t,s){return e instanceof oa?function(e,t){const s={fields:{[Nr]:{stringValue:wr},[_r]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&kr(t)&&(t=Sr(t)),t&&(s.fields[jr]=t),{mapValue:s}}(s,t):e instanceof la?ca(e,t):e instanceof da?ua(e,t):function(e,t){const s=aa(e,t),n=ma(s)+ma(e.Ae);return Hr(s)&&Hr(e.Ae)?ta(n):ea(e.serializer,n)}(e,t)}function ia(e,t,s){return e instanceof la?ca(e,t):e instanceof da?ua(e,t):s}function aa(e,t){return e instanceof ha?Hr(s=t)||(n=s)&&"doubleValue"in n?t:{integerValue:0}:null;var s,n}class oa extends na{}class la extends na{constructor(e){super(),this.elements=e}}function ca(e,t){const s=pa(t);for(const n of e.elements)s.some(e=>Mr(e,n))||s.push(n);return{arrayValue:{values:s}}}class da extends na{constructor(e){super(),this.elements=e}}function ua(e,t){let s=pa(t);for(const n of e.elements)s=s.filter(e=>!Mr(e,n));return{arrayValue:{values:s}}}class ha extends na{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function ma(e){return vr(e.integerValue||e.doubleValue)}function pa(e){return Gr(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class ga{constructor(e,t){this.version=e,this.transformResults=t}}class fa{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new fa}static exists(e){return new fa(void 0,e)}static updateTime(e){return new fa(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function xa(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class ya{}function va(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Ea(e.key,fa.none()):new _a(e.key,e.data,fa.none());{const s=e.data,n=Xr.empty();let r=new hr(Rn.comparator);for(let e of t.fields)if(!r.has(e)){let t=s.field(e);null===t&&e.length>1&&(e=e.popLast(),t=s.field(e)),null===t?n.delete(e):n.set(e,t),r=r.add(e)}return new ka(e.key,n,new pr(r.toArray()),fa.none())}}function ba(e,t,s){var n;e instanceof _a?function(e,t,s){const n=e.value.clone(),r=Ta(e.fieldTransforms,t,s.transformResults);n.setAll(r),t.convertToFoundDocument(s.version,n).setHasCommittedMutations()}(e,t,s):e instanceof ka?function(e,t,s){if(!xa(e.precondition,t))return void t.convertToUnknownDocument(s.version);const n=Ta(e.fieldTransforms,t,s.transformResults),r=t.data;r.setAll(Sa(e)),r.setAll(n),t.convertToFoundDocument(s.version,r).setHasCommittedMutations()}(e,t,s):(n=s,t.convertToNoDocument(n.version).setHasCommittedMutations())}function wa(e,t,s,n){return e instanceof _a?function(e,t,s,n){if(!xa(e.precondition,t))return s;const r=e.value.clone(),i=Ia(e.fieldTransforms,n,t);return r.setAll(i),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null}(e,t,s,n):e instanceof ka?function(e,t,s,n){if(!xa(e.precondition,t))return s;const r=Ia(e.fieldTransforms,n,t),i=t.data;return i.setAll(Sa(e)),i.setAll(r),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null===s?null:s.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,s,n):(r=t,i=s,xa(e.precondition,r)?(r.convertToNoDocument(r.version).setHasLocalMutations(),null):i);var r,i}function Na(e,t){let s=null;for(const n of e.fieldTransforms){const e=t.data.field(n.field),r=aa(n.transform,e||null);null!=r&&(null===s&&(s=Xr.empty()),s.set(n.field,r))}return s||null}function ja(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(s=e.fieldTransforms,n=t.fieldTransforms,!!(void 0===s&&void 0===n||s&&n&&En(s,n,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(s=e.transform,n=t.transform,s instanceof la&&n instanceof la||s instanceof da&&n instanceof da?En(s.elements,n.elements,Mr):s instanceof ha&&n instanceof ha?Mr(s.Ae,n.Ae):s instanceof oa&&n instanceof oa);var s,n}(e,t)))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var s,n}class _a extends ya{constructor(e,t,s,n=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class ka extends ya{constructor(e,t,s,n,r=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=n,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function Sa(e){const t=new Map;return e.fieldMask.fields.forEach(s=>{if(!s.isEmpty()){const n=e.data.field(s);t.set(s,n)}}),t}function Ta(e,t,s){const n=new Map;un(e.length===s.length,32656,{Re:s.length,Ve:e.length});for(let r=0;r<s.length;r++){const i=e[r],a=i.transform,o=t.data.field(i.field);n.set(i.field,ia(a,o,s[r]))}return n}function Ia(e,t,s){const n=new Map;for(const r of e){const e=r.transform,i=s.data.field(r.field);n.set(r.field,ra(e,i,t))}return n}class Ea extends ya{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ca extends ya{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Aa{constructor(e,t,s,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=n}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let n=0;n<this.mutations.length;n++){const t=this.mutations[n];t.key.isEqual(e.key)&&ba(t,e,s[n])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=wa(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=wa(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=Ji();return this.mutations.forEach(n=>{const r=e.get(n.key),i=r.overlayedDocument;let a=this.applyToLocalView(i,r.mutatedFields);a=t.has(n.key)?null:a;const o=va(i,a);null!==o&&s.set(n.key,o),i.isValidDocument()||i.convertToNoDocument(Gn.min())}),s}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Xi())}isEqual(e){return this.batchId===e.batchId&&En(this.mutations,e.mutations,(e,t)=>ja(e,t))&&En(this.baseMutations,e.baseMutations,(e,t)=>ja(e,t))}}class Pa{constructor(e,t,s,n){this.batch=e,this.commitVersion=t,this.mutationResults=s,this.docVersions=n}static from(e,t,s){un(e.mutations.length===s.length,58842,{me:e.mutations.length,fe:s.length});let n=function(){return Qi}();const r=e.mutations;for(let i=0;i<r.length;i++)n=n.insert(r[i].key,s[i].version);return new Pa(e,t,s,n)}}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Da{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ra{constructor(e,t){this.count=e,this.unchangedNames=t}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var Oa,La;function Ma(e){if(void 0===e)return an("GRPC error has no .code"),mn.UNKNOWN;switch(e){case Oa.OK:return mn.OK;case Oa.CANCELLED:return mn.CANCELLED;case Oa.UNKNOWN:return mn.UNKNOWN;case Oa.DEADLINE_EXCEEDED:return mn.DEADLINE_EXCEEDED;case Oa.RESOURCE_EXHAUSTED:return mn.RESOURCE_EXHAUSTED;case Oa.INTERNAL:return mn.INTERNAL;case Oa.UNAVAILABLE:return mn.UNAVAILABLE;case Oa.UNAUTHENTICATED:return mn.UNAUTHENTICATED;case Oa.INVALID_ARGUMENT:return mn.INVALID_ARGUMENT;case Oa.NOT_FOUND:return mn.NOT_FOUND;case Oa.ALREADY_EXISTS:return mn.ALREADY_EXISTS;case Oa.PERMISSION_DENIED:return mn.PERMISSION_DENIED;case Oa.FAILED_PRECONDITION:return mn.FAILED_PRECONDITION;case Oa.ABORTED:return mn.ABORTED;case Oa.OUT_OF_RANGE:return mn.OUT_OF_RANGE;case Oa.UNIMPLEMENTED:return mn.UNIMPLEMENTED;case Oa.DATA_LOSS:return mn.DATA_LOSS;default:return cn(39323,{code:e})}}(La=Oa||(Oa={}))[La.OK=0]="OK",La[La.CANCELLED=1]="CANCELLED",La[La.UNKNOWN=2]="UNKNOWN",La[La.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",La[La.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",La[La.NOT_FOUND=5]="NOT_FOUND",La[La.ALREADY_EXISTS=6]="ALREADY_EXISTS",La[La.PERMISSION_DENIED=7]="PERMISSION_DENIED",La[La.UNAUTHENTICATED=16]="UNAUTHENTICATED",La[La.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",La[La.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",La[La.ABORTED=10]="ABORTED",La[La.OUT_OF_RANGE=11]="OUT_OF_RANGE",La[La.UNIMPLEMENTED=12]="UNIMPLEMENTED",La[La.INTERNAL=13]="INTERNAL",La[La.UNAVAILABLE=14]="UNAVAILABLE",La[La.DATA_LOSS=15]="DATA_LOSS";
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const Fa=new Vs([4294967295,4294967295],0);function Ua(e){const t=(new TextEncoder).encode(e),s=new Bs;return s.update(t),new Uint8Array(s.digest())}function Va(e){const t=new DataView(e.buffer),s=t.getUint32(0,!0),n=t.getUint32(4,!0),r=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new Vs([s,n],0),new Vs([r,i],0)]}class Ba{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new Ka(`Invalid padding: ${t}`);if(s<0)throw new Ka(`Invalid hash count: ${s}`);if(e.length>0&&0===this.hashCount)throw new Ka(`Invalid hash count: ${s}`);if(0===e.length&&0!==t)throw new Ka(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Vs.fromNumber(this.ge)}ye(e,t,s){let n=e.add(t.multiply(Vs.fromNumber(s)));return 1===n.compare(Fa)&&(n=new Vs([n.getBits(0),n.getBits(1)],0)),n.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;const t=Ua(e),[s,n]=Va(t);for(let r=0;r<this.hashCount;r++){const e=this.ye(s,n,r);if(!this.we(e))return!1}return!0}static create(e,t,s){const n=e%8==0?0:8-e%8,r=new Uint8Array(Math.ceil(e/8)),i=new Ba(r,n,t);return s.forEach(e=>i.insert(e)),i}insert(e){if(0===this.ge)return;const t=Ua(e),[s,n]=Va(t);for(let r=0;r<this.hashCount;r++){const e=this.ye(s,n,r);this.Se(e)}}Se(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class Ka extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class za{constructor(e,t,s,n,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=n,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const n=new Map;return n.set(e,qa.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new za(Gn.min(),n,new cr(Sn),zi(),Xi())}}class qa{constructor(e,t,s,n,r){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=n,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new qa(s,t,Xi(),Xi(),Xi())}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class $a{constructor(e,t,s,n){this.be=e,this.removedTargetIds=t,this.key=s,this.De=n}}class Ha{constructor(e,t){this.targetId=e,this.Ce=t}}class Ga{constructor(e,t,s=fr.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=n}}class Ja{constructor(){this.ve=0,this.Fe=Ya(),this.Me=fr.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Xi(),t=Xi(),s=Xi();return this.Fe.forEach((n,r)=>{switch(r){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:s=s.add(n);break;default:cn(38017,{changeType:r})}}),new qa(this.Me,this.xe,e,t,s)}qe(){this.Oe=!1,this.Fe=Ya()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,un(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class Wa{constructor(e){this.Ge=e,this.ze=new Map,this.je=zi(),this.Je=Qa(),this.He=Qa(),this.Ye=new cr(Sn)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const s=this.nt(t);switch(e.state){case 0:this.rt(t)&&s.Le(e.resumeToken);break;case 1:s.Ke(),s.Ne||s.qe(),s.Le(e.resumeToken);break;case 2:s.Ke(),s.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(s.We(),s.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),s.Le(e.resumeToken));break;default:cn(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,s)=>{this.rt(s)&&t(s)})}st(e){const t=e.targetId,s=e.Ce.count,n=this.ot(t);if(n){const r=n.target;if(Si(r))if(0===s){const e=new On(r.path);this.et(t,e,ei.newNoDocument(e,Gn.min()))}else un(1===s,20013,{expectedCount:s});else{const n=this._t(t);if(n!==s){const s=this.ut(e),r=s?this.ct(s,e,n):1;if(0!==r){this.it(t);const e=2===r?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,e)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:n=0},hashCount:r=0}=t;let i,a;try{i=br(s).toUint8Array()}catch(o){if(o instanceof gr)return on("Decoding the base64 bloom filter in existence filter failed ("+o.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw o}try{a=new Ba(i,n,r)}catch(o){return on(o instanceof Ka?"BloomFilter error: ":"Applying bloom filter failed: ",o),null}return 0===a.ge?null:a}ct(e,t,s){return t.Ce.count===s-this.Pt(e,t.targetId)?0:2}Pt(e,t){const s=this.Ge.getRemoteKeysForTarget(t);let n=0;return s.forEach(s=>{const r=this.Ge.ht(),i=`projects/${r.projectId}/databases/${r.database}/documents/${s.path.canonicalString()}`;e.mightContain(i)||(this.et(t,s,null),n++)}),n}Tt(e){const t=new Map;this.ze.forEach((s,n)=>{const r=this.ot(n);if(r){if(s.current&&Si(r.target)){const t=new On(r.target.path);this.It(t).has(n)||this.Et(n,t)||this.et(n,t,ei.newNoDocument(t,e))}s.Be&&(t.set(n,s.ke()),s.qe())}});let s=Xi();this.He.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{const t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(s=s.add(e))}),this.je.forEach((t,s)=>s.setReadTime(e));const n=new za(e,t,this.Ye,this.je,s);return this.je=zi(),this.Je=Qa(),this.He=Qa(),this.Ye=new cr(Sn),n}Xe(e,t){if(!this.rt(e))return;const s=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,s),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,s){if(!this.rt(e))return;const n=this.nt(e);this.Et(e,t)?n.Qe(t,1):n.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),s&&(this.je=this.je.insert(t,s))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new Ja,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new hr(Sn),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new hr(Sn),this.Je=this.Je.insert(e,t)),t}rt(e){const t=null!==this.ot(e);return t||rn("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Ja),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Qa(){return new cr(On.comparator)}function Ya(){return new cr(On.comparator)}const Xa=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),Za=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),eo=(()=>({and:"AND",or:"OR"}))();class to{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function so(e,t){return e.useProto3Json||sr(t)?t:{value:t}}function no(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function ro(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function io(e,t){return no(e,t.toTimestamp())}function ao(e){return un(!!e,49232),Gn.fromTimestamp(function(e){const t=yr(e);return new Hn(t.seconds,t.nanos)}(e))}function oo(e,t){return lo(e,t).canonicalString()}function lo(e,t){const s=(n=e,new Pn(["projects",n.projectId,"databases",n.database])).child("documents");var n;return void 0===t?s:s.child(t)}function co(e){const t=Pn.fromString(e);return un(Io(t),10190,{key:t.toString()}),t}function uo(e,t){return oo(e.databaseId,t.path)}function ho(e,t){const s=co(t);if(s.get(1)!==e.databaseId.projectId)throw new pn(mn.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+s.get(1)+" vs "+e.databaseId.projectId);if(s.get(3)!==e.databaseId.database)throw new pn(mn.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+s.get(3)+" vs "+e.databaseId.database);return new On(go(s))}function mo(e,t){return oo(e.databaseId,t)}function po(e){return new Pn(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function go(e){return un(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function fo(e,t,s){return{name:uo(e,t),fields:s.value.mapValue.fields}}function xo(e,t){return{documents:[mo(e,t.path)]}}function yo(e,t){const s={structuredQuery:{}},n=t.path;let r;null!==t.collectionGroup?(r=n,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(r=n.popLast(),s.structuredQuery.from=[{collectionId:n.lastSegment()}]),s.parent=mo(e,r);const i=function(e){if(0!==e.length)return So(li.create(e,"and"))}(t.filters);i&&(s.structuredQuery.where=i);const a=function(e){if(0!==e.length)return e.map(e=>{return{field:_o((t=e).field),direction:wo(t.dir)};var t})}(t.orderBy);a&&(s.structuredQuery.orderBy=a);const o=so(e,t.limit);return null!==o&&(s.structuredQuery.limit=o),t.startAt&&(s.structuredQuery.startAt={before:(l=t.startAt).inclusive,values:l.position}),t.endAt&&(s.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ft:s,parent:r};var l}function vo(e){let t=function(e){const t=co(e);return 4===t.length?Pn.emptyPath():go(t)}(e.parent);const s=e.structuredQuery,n=s.from?s.from.length:0;let r=null;if(n>0){un(1===n,65062);const e=s.from[0];e.allDescendants?r=e.collectionId:t=t.child(e.collectionId)}let i=[];s.where&&(i=function(e){const t=bo(e);return t instanceof li&&di(t)?t.getFilters():[t]}(s.where));let a=[];s.orderBy&&(a=s.orderBy.map(e=>{return new ri(ko((t=e).field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction));var t}));let o=null;s.limit&&(o=function(e){let t;return t="object"==typeof e?e.value:e,sr(t)?null:t}(s.limit));let l=null;s.startAt&&(l=function(e){const t=!!e.before,s=e.values||[];return new ti(s,t)}(s.startAt));let c=null;return s.endAt&&(c=function(e){const t=!e.before,s=e.values||[];return new ti(s,t)}(s.endAt)),function(e,t,s,n,r,i,a,o){return new Ti(e,t,s,n,r,i,a,o)}(t,r,a,i,o,"F",l,c)}function bo(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=ko(e.unaryFilter.field);return oi.create(t,"==",{doubleValue:NaN});case"IS_NULL":const s=ko(e.unaryFilter.field);return oi.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const n=ko(e.unaryFilter.field);return oi.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=ko(e.unaryFilter.field);return oi.create(r,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return cn(61313);default:return cn(60726)}}(e):void 0!==e.fieldFilter?(t=e,oi.create(ko(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return cn(58110);default:return cn(50506)}}(t.fieldFilter.op),t.fieldFilter.value)):void 0!==e.compositeFilter?function(e){return li.create(e.compositeFilter.filters.map(e=>bo(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return cn(1026)}}(e.compositeFilter.op))}(e):cn(30097,{filter:e});var t}function wo(e){return Xa[e]}function No(e){return Za[e]}function jo(e){return eo[e]}function _o(e){return{fieldPath:e.canonicalString()}}function ko(e){return Rn.fromServerFormat(e.fieldPath)}function So(e){return e instanceof oi?function(e){if("=="===e.op){if(Wr(e.value))return{unaryFilter:{field:_o(e.field),op:"IS_NAN"}};if(Jr(e.value))return{unaryFilter:{field:_o(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Wr(e.value))return{unaryFilter:{field:_o(e.field),op:"IS_NOT_NAN"}};if(Jr(e.value))return{unaryFilter:{field:_o(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:_o(e.field),op:No(e.op),value:e.value}}}(e):e instanceof li?function(e){const t=e.getFilters().map(e=>So(e));return 1===t.length?t[0]:{compositeFilter:{op:jo(e.op),filters:t}}}(e):cn(54877,{filter:e})}function To(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function Io(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Eo{constructor(e,t,s,n,r=Gn.min(),i=Gn.min(),a=fr.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=n,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new Eo(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Eo(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Eo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Eo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Co{constructor(e){this.yt=e}}function Ao(e){const t=vo({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Ri(t,t.limit,"L"):t}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Po{constructor(){this.Cn=new Do}addToCollectionParentIndex(e,t){return this.Cn.add(t),Zn.resolve()}getCollectionParents(e,t){return Zn.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return Zn.resolve()}deleteFieldIndex(e,t){return Zn.resolve()}deleteAllFieldIndexes(e){return Zn.resolve()}createTargetIndexes(e,t){return Zn.resolve()}getDocumentsMatchingTarget(e,t){return Zn.resolve(null)}getIndexType(e,t){return Zn.resolve(0)}getFieldIndexes(e,t){return Zn.resolve([])}getNextCollectionGroupToUpdate(e){return Zn.resolve(null)}getMinOffset(e,t){return Zn.resolve(Wn.min())}getMinOffsetFromCollectionGroup(e,t){return Zn.resolve(Wn.min())}updateCollectionGroup(e,t,s){return Zn.resolve()}updateIndexEntries(e,t){return Zn.resolve()}}class Do{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),n=this.index[t]||new hr(Pn.comparator),r=!n.has(s);return this.index[t]=n.add(s),r}has(e){const t=e.lastSegment(),s=e.popLast(),n=this.index[t];return n&&n.has(s)}getEntries(e){return(this.index[e]||new hr(Pn.comparator)).toArray()}}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Ro={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Oo=41943040;class Lo{static withCacheSize(e){return new Lo(e,Lo.DEFAULT_COLLECTION_PERCENTILE,Lo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */Lo.DEFAULT_COLLECTION_PERCENTILE=10,Lo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Lo.DEFAULT=new Lo(Oo,Lo.DEFAULT_COLLECTION_PERCENTILE,Lo.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Lo.DISABLED=new Lo(-1,0,0);
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Mo{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Mo(0)}static cr(){return new Mo(-1)}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Fo="LruGarbageCollector";function Uo([e,t],[s,n]){const r=Sn(e,s);return 0===r?Sn(t,n):r}class Vo{constructor(e){this.Ir=e,this.buffer=new hr(Uo),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Uo(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Bo{constructor(e,t,s){this.garbageCollector=e,this.asyncQueue=t,this.localStore=s,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){rn(Fo,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>g(this,null,function*(){this.Rr=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){er(e)?rn(Fo,"Ignoring IndexedDB error during garbage collection: ",e):yield Xn(e)}yield this.Vr(3e5)}))}}class Ko{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return Zn.resolve(tr.ce);const s=new Vo(t);return this.mr.forEachTarget(e,e=>s.Ar(e.sequenceNumber)).next(()=>this.mr.pr(e,e=>s.Ar(e))).next(()=>s.maxValue)}removeTargets(e,t,s){return this.mr.removeTargets(e,t,s)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(rn("LruGarbageCollector","Garbage collection skipped; disabled"),Zn.resolve(Ro)):this.getCacheSize(e).next(s=>s<this.params.cacheSizeCollectionThreshold?(rn("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ro):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let s,n,r,i,a,o,l;const c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(rn("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,i=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(s=n,a=Date.now(),this.removeTargets(e,s,t))).next(t=>(r=t,o=Date.now(),this.removeOrphanedDocuments(e,s))).next(e=>(l=Date.now(),nn()<=gt.DEBUG&&rn("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-c}ms\n\tDetermined least recently used ${n} in `+(a-i)+`ms\n\tRemoved ${r} targets in `+(o-a)+`ms\n\tRemoved ${e} documents in `+(l-o)+`ms\nTotal Duration: ${l-c}ms`),Zn.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:r,documentsRemoved:e})))}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class zo{constructor(){this.changes=new Bi(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ei.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return void 0!==s?Zn.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class qo{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class $o{constructor(e,t,s,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=n}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(s=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==s&&wa(s.mutation,e,pr.empty(),Hn.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,Xi()).next(()=>t))}getLocalViewOfDocuments(e,t,s=Xi()){const n=Gi();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,s).next(e=>{let t=$i();return e.forEach((e,s)=>{t=t.insert(e,s.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const s=Gi();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,Xi()))}populateOverlays(e,t,s){const n=[];return s.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,s)=>{t.set(e,s)})})}computeViews(e,t,s,n){let r=zi();const i=Wi(),a=Wi();return t.forEach((e,t)=>{const a=s.get(t.key);n.has(t.key)&&(void 0===a||a.mutation instanceof ka)?r=r.insert(t.key,t):void 0!==a?(i.set(t.key,a.mutation.getFieldMask()),wa(a.mutation,t,a.mutation.getFieldMask(),Hn.now())):i.set(t.key,pr.empty())}),this.recalculateAndSaveOverlays(e,r).next(e=>(e.forEach((e,t)=>i.set(e,t)),t.forEach((e,t)=>{var s;return a.set(e,new qo(t,null!=(s=i.get(e))?s:null))}),a))}recalculateAndSaveOverlays(e,t){const s=Wi();let n=new cr((e,t)=>e-t),r=Xi();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const r of e)r.keys().forEach(e=>{const i=t.get(e);if(null===i)return;let a=s.get(e)||pr.empty();a=r.applyToLocalView(i,a),s.set(e,a);const o=(n.get(r.batchId)||Xi()).add(e);n=n.insert(r.batchId,o)})}).next(()=>{const i=[],a=n.getReverseIterator();for(;a.hasNext();){const n=a.getNext(),o=n.key,l=n.value,c=Ji();l.forEach(e=>{if(!r.has(e)){const n=va(t.get(e),s.get(e));null!==n&&c.set(e,n),r=r.add(e)}}),i.push(this.documentOverlayCache.saveOverlays(e,o,c))}return Zn.waitFor(i)}).next(()=>s)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,s,n){return r=t,On.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Ci(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,n):this.getDocumentsMatchingCollectionQuery(e,t,s,n);var r}getNextDocuments(e,t,s,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,n).next(r=>{const i=n-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,n-r.size):Zn.resolve(Gi());let a=-1,o=r;return i.next(t=>Zn.forEach(t,(t,s)=>(a<s.largestBatchId&&(a=s.largestBatchId),r.get(t)?Zn.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,r)).next(()=>this.computeViews(e,o,t,Xi())).next(e=>({batchId:a,changes:Hi(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new On(t)).next(e=>{let t=$i();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,s,n){const r=t.collectionGroup;let i=$i();return this.indexManager.getCollectionParents(e,r).next(a=>Zn.forEach(a,a=>{const o=(l=t,c=a.child(r),new Ti(c,null,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt));var l,c;return this.getDocumentsMatchingCollectionQuery(e,o,s,n).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,s,n){let r;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next(i=>(r=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,r,n))).next(e=>{r.forEach((t,s)=>{const n=s.getKey();null===e.get(n)&&(e=e.insert(n,ei.newInvalidDocument(n)))});let s=$i();return e.forEach((e,n)=>{const i=r.get(e);void 0!==i&&wa(i.mutation,n,pr.empty(),Hn.now()),Fi(t,n)&&(s=s.insert(e,n))}),s})}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ho{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return Zn.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,{id:(s=t).id,version:s.version,createTime:ao(s.createTime)}),Zn.resolve();var s}getNamedQuery(e,t){return Zn.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,{name:(s=t).name,query:Ao(s.bundledQuery),readTime:ao(s.readTime)}),Zn.resolve();var s}}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Go{constructor(){this.overlays=new cr(On.comparator),this.qr=new Map}getOverlay(e,t){return Zn.resolve(this.overlays.get(t))}getOverlays(e,t){const s=Gi();return Zn.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&s.set(t,e)})).next(()=>s)}saveOverlays(e,t,s){return s.forEach((s,n)=>{this.St(e,t,n)}),Zn.resolve()}removeOverlaysForBatchId(e,t,s){const n=this.qr.get(s);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(s)),Zn.resolve()}getOverlaysForCollection(e,t,s){const n=Gi(),r=t.length+1,i=new On(t.child("")),a=this.overlays.getIteratorFrom(i);for(;a.hasNext();){const e=a.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===r&&e.largestBatchId>s&&n.set(e.getKey(),e)}return Zn.resolve(n)}getOverlaysForCollectionGroup(e,t,s,n){let r=new cr((e,t)=>e-t);const i=this.overlays.getIterator();for(;i.hasNext();){const e=i.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>s){let t=r.get(e.largestBatchId);null===t&&(t=Gi(),r=r.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const a=Gi(),o=r.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=n)););return Zn.resolve(a)}St(e,t,s){const n=this.overlays.get(s.key);if(null!==n){const e=this.qr.get(n.largestBatchId).delete(s.key);this.qr.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(s.key,new Da(t,s));let r=this.qr.get(t);void 0===r&&(r=Xi(),this.qr.set(t,r)),this.qr.set(t,r.add(s.key))}}
/**
     * @license
     * Copyright 2024 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Jo{constructor(){this.sessionToken=fr.EMPTY_BYTE_STRING}getSessionToken(e){return Zn.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Zn.resolve()}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Wo{constructor(){this.Qr=new hr(Qo.$r),this.Ur=new hr(Qo.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const s=new Qo(e,t);this.Qr=this.Qr.add(s),this.Ur=this.Ur.add(s)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new Qo(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){const t=new On(new Pn([])),s=new Qo(t,e),n=new Qo(t,e+1),r=[];return this.Ur.forEachInRange([s,n],e=>{this.Gr(e),r.push(e.key)}),r}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new On(new Pn([])),s=new Qo(t,e),n=new Qo(t,e+1);let r=Xi();return this.Ur.forEachInRange([s,n],e=>{r=r.add(e.key)}),r}containsKey(e){const t=new Qo(e,0),s=this.Qr.firstAfterOrEqual(t);return null!==s&&e.isEqual(s.key)}}class Qo{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return On.comparator(e.key,t.key)||Sn(e.Yr,t.Yr)}static Kr(e,t){return Sn(e.Yr,t.Yr)||On.comparator(e.key,t.key)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Yo{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new hr(Qo.$r)}checkEmpty(e){return Zn.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,s,n){const r=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new Aa(r,t,s,n);this.mutationQueue.push(i);for(const a of n)this.Zr=this.Zr.add(new Qo(a.key,r)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return Zn.resolve(i)}lookupMutationBatch(e,t){return Zn.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,n=this.ei(s),r=n<0?0:n;return Zn.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return Zn.resolve(0===this.mutationQueue.length?-1:this.tr-1)}getAllMutationBatches(e){return Zn.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new Qo(t,0),n=new Qo(t,Number.POSITIVE_INFINITY),r=[];return this.Zr.forEachInRange([s,n],e=>{const t=this.Xr(e.Yr);r.push(t)}),Zn.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new hr(Sn);return t.forEach(e=>{const t=new Qo(e,0),n=new Qo(e,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([t,n],e=>{s=s.add(e.Yr)})}),Zn.resolve(this.ti(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,n=s.length+1;let r=s;On.isDocumentKey(r)||(r=r.child(""));const i=new Qo(new On(r),0);let a=new hr(Sn);return this.Zr.forEachWhile(e=>{const t=e.key.path;return!!s.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.Yr)),!0)},i),Zn.resolve(this.ti(a))}ti(e){const t=[];return e.forEach(e=>{const s=this.Xr(e);null!==s&&t.push(s)}),t}removeMutationBatch(e,t){un(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let s=this.Zr;return Zn.forEach(t.mutations,n=>{const r=new Qo(n.key,t.batchId);return s=s.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.Zr=s})}ir(e){}containsKey(e,t){const s=new Qo(t,0),n=this.Zr.firstAfterOrEqual(s);return Zn.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,Zn.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Xo{constructor(e){this.ri=e,this.docs=new cr(On.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,n=this.docs.get(s),r=n?n.size:0,i=this.ri(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:i}),this.size+=i-r,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return Zn.resolve(s?s.document.mutableCopy():ei.newInvalidDocument(t))}getEntries(e,t){let s=zi();return t.forEach(e=>{const t=this.docs.get(e);s=s.insert(e,t?t.document.mutableCopy():ei.newInvalidDocument(e))}),Zn.resolve(s)}getDocumentsMatchingQuery(e,t,s,n){let r=zi();const i=t.path,a=new On(i.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){const{key:e,value:{document:a}}=o.getNext();if(!i.isPrefixOf(e.path))break;e.path.length>i.length+1||Qn(Jn(a),s)<=0||(n.has(a.key)||Fi(t,a))&&(r=r.insert(a.key,a.mutableCopy()))}return Zn.resolve(r)}getAllFromCollectionGroup(e,t,s,n){cn(9500)}ii(e,t){return Zn.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new Zo(this)}getSize(e){return Zn.resolve(this.size)}}class Zo extends zo{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((s,n)=>{n.isValidDocument()?t.push(this.Nr.addEntry(e,n)):this.Nr.removeEntry(s)}),Zn.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class el{constructor(e){this.persistence=e,this.si=new Bi(e=>_i(e),ki),this.lastRemoteSnapshotVersion=Gn.min(),this.highestTargetId=0,this.oi=0,this._i=new Wo,this.targetCount=0,this.ai=Mo.ur()}forEachTarget(e,t){return this.si.forEach((e,s)=>t(s)),Zn.resolve()}getLastRemoteSnapshotVersion(e){return Zn.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Zn.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),Zn.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.oi&&(this.oi=t),Zn.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Mo(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,Zn.resolve()}updateTargetData(e,t){return this.Pr(t),Zn.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,Zn.resolve()}removeTargets(e,t,s){let n=0;const r=[];return this.si.forEach((i,a)=>{a.sequenceNumber<=t&&null===s.get(a.targetId)&&(this.si.delete(i),r.push(this.removeMatchingKeysForTargetId(e,a.targetId)),n++)}),Zn.waitFor(r).next(()=>n)}getTargetCount(e){return Zn.resolve(this.targetCount)}getTargetData(e,t){const s=this.si.get(t)||null;return Zn.resolve(s)}addMatchingKeys(e,t,s){return this._i.Wr(t,s),Zn.resolve()}removeMatchingKeys(e,t,s){this._i.zr(t,s);const n=this.persistence.referenceDelegate,r=[];return n&&t.forEach(t=>{r.push(n.markPotentiallyOrphaned(e,t))}),Zn.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),Zn.resolve()}getMatchingKeysForTargetId(e,t){const s=this._i.Hr(t);return Zn.resolve(s)}containsKey(e,t){return Zn.resolve(this._i.containsKey(t))}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class tl{constructor(e,t){this.ui={},this.overlays={},this.ci=new tr(0),this.li=!1,this.li=!0,this.hi=new Jo,this.referenceDelegate=e(this),this.Pi=new el(this),this.indexManager=new Po,this.remoteDocumentCache=new Xo(e=>this.referenceDelegate.Ti(e)),this.serializer=new Co(t),this.Ii=new Ho(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Go,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this.ui[e.toKey()];return s||(s=new Yo(t,this.referenceDelegate),this.ui[e.toKey()]=s),s}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,s){rn("MemoryPersistence","Starting transaction:",e);const n=new sl(this.ci.next());return this.referenceDelegate.Ei(),s(n).next(e=>this.referenceDelegate.di(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}Ai(e,t){return Zn.or(Object.values(this.ui).map(s=>()=>s.containsKey(e,t)))}}class sl extends Yn{constructor(e){super(),this.currentSequenceNumber=e}}class nl{constructor(e){this.persistence=e,this.Ri=new Wo,this.Vi=null}static mi(e){return new nl(e)}get fi(){if(this.Vi)return this.Vi;throw cn(60996)}addReference(e,t,s){return this.Ri.addReference(s,t),this.fi.delete(s.toString()),Zn.resolve()}removeReference(e,t,s){return this.Ri.removeReference(s,t),this.fi.add(s.toString()),Zn.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),Zn.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>s.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Zn.forEach(this.fi,s=>{const n=On.fromPath(s);return this.gi(e,n).next(e=>{e||t.removeEntry(n,Gn.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return Zn.or([()=>Zn.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class rl{constructor(e,t){this.persistence=e,this.pi=new Bi(e=>function(e){let t="";for(let s=0;s<e.length;s++)t.length>0&&(t=ir(t)),t=rr(e.get(s),t);return ir(t)}(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=function(e,t){return new Ko(e,t)}(this,t)}static mi(e,t){return new rl(e,t)}Ei(){}di(e){return Zn.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}pr(e,t){return Zn.forEach(this.pi,(s,n)=>this.br(e,s,n).next(e=>e?Zn.resolve():t(n)))}removeTargets(e,t,s){return this.persistence.getTargetCache().removeTargets(e,t,s)}removeOrphanedDocuments(e,t){let s=0;const n=this.persistence.getRemoteDocumentCache(),r=n.newChangeBuffer();return n.ii(e,n=>this.br(e,n,t).next(e=>{e||(s++,r.removeEntry(n,Gn.min()))})).next(()=>r.apply(e)).next(()=>s)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),Zn.resolve()}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),Zn.resolve()}removeReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),Zn.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),Zn.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=qr(e.data.value)),t}br(e,t,s){return Zn.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.pi.get(t);return Zn.resolve(void 0!==e&&e>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class il{constructor(e,t,s,n){this.targetId=e,this.fromCache=t,this.Es=s,this.ds=n}static As(e,t){let s=Xi(),n=Xi();for(const r of t.docChanges)switch(r.type){case 0:s=s.add(r.doc.key);break;case 1:n=n.add(r.doc.key)}return new il(e,t.fromCache,s,n)}}
/**
     * @license
     * Copyright 2023 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class al{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class ol{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=Ze()?8:function(e){const t=e.match(/Android ([\d.]+)/i),s=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(s)}(Xe())>0?6:4}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,s,n){const r={result:null};return this.ys(e,t).next(e=>{r.result=e}).next(()=>{if(!r.result)return this.ws(e,t,n,s).next(e=>{r.result=e})}).next(()=>{if(r.result)return;const s=new al;return this.Ss(e,t,s).next(n=>{if(r.result=n,this.Vs)return this.bs(e,t,s,n.size)})}).next(()=>r.result)}bs(e,t,s,n){return s.documentReadCount<this.fs?(nn()<=gt.DEBUG&&rn("QueryEngine","SDK will not create cache indexes for query:",Mi(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),Zn.resolve()):(nn()<=gt.DEBUG&&rn("QueryEngine","Query:",Mi(t),"scans",s.documentReadCount,"local documents and returns",n,"documents as results."),s.documentReadCount>this.gs*n?(nn()<=gt.DEBUG&&rn("QueryEngine","The SDK decides to create cache indexes for query:",Mi(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Pi(t))):Zn.resolve())}ys(e,t){if(Ei(t))return Zn.resolve(null);let s=Pi(t);return this.indexManager.getIndexType(e,s).next(n=>0===n?null:(null!==t.limit&&1===n&&(t=Ri(t,null,"F"),s=Pi(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next(n=>{const r=Xi(...n);return this.ps.getDocuments(e,r).next(n=>this.indexManager.getMinOffset(e,s).next(s=>{const i=this.Ds(t,n);return this.Cs(t,i,r,s.readTime)?this.ys(e,Ri(t,null,"F")):this.vs(e,i,t,s)}))})))}ws(e,t,s,n){return Ei(t)||n.isEqual(Gn.min())?Zn.resolve(null):this.ps.getDocuments(e,s).next(r=>{const i=this.Ds(t,r);return this.Cs(t,i,s,n)?Zn.resolve(null):(nn()<=gt.DEBUG&&rn("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Mi(t)),this.vs(e,i,t,function(e,t){const s=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1,r=Gn.fromTimestamp(1e9===n?new Hn(s+1,0):new Hn(s,n));return new Wn(r,On.empty(),t)}(n,-1)).next(e=>e))})}Ds(e,t){let s=new hr(Ui(e));return t.forEach((t,n)=>{Fi(e,n)&&(s=s.add(n))}),s}Cs(e,t,s,n){if(null===e.limit)return!1;if(s.size!==t.size)return!0;const r="F"===e.limitType?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(n)>0)}Ss(e,t,s){return nn()<=gt.DEBUG&&rn("QueryEngine","Using full collection scan to execute query:",Mi(t)),this.ps.getDocumentsMatchingQuery(e,t,Wn.min(),s)}vs(e,t,s,n){return this.ps.getDocumentsMatchingQuery(e,s,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const ll="LocalStore";class cl{constructor(e,t,s,n){this.persistence=e,this.Fs=t,this.serializer=n,this.Ms=new cr(Sn),this.xs=new Bi(e=>_i(e),ki),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(s)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new $o(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function dl(e,t){return g(this,null,function*(){const s=hn(e);return yield s.persistence.runTransaction("Handle user change","readonly",e=>{let n;return s.mutationQueue.getAllMutationBatches(e).next(r=>(n=r,s.Bs(t),s.mutationQueue.getAllMutationBatches(e))).next(t=>{const r=[],i=[];let a=Xi();for(const e of n){r.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}for(const e of t){i.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}return s.localDocuments.getDocuments(e,a).next(e=>({Ls:e,removedBatchIds:r,addedBatchIds:i}))})})})}function ul(e){const t=hn(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Pi.getLastRemoteSnapshotVersion(e))}function hl(e,t){const s=hn(e),n=t.snapshotVersion;let r=s.Ms;return s.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const i=s.Ns.newChangeBuffer({trackRemovals:!0});r=s.Ms;const a=[];t.targetChanges.forEach((i,o)=>{const l=r.get(o);if(!l)return;a.push(s.Pi.removeMatchingKeys(e,i.removedDocuments,o).next(()=>s.Pi.addMatchingKeys(e,i.addedDocuments,o)));let c=l.withSequenceNumber(e.currentSequenceNumber);var d,u,h;null!==t.targetMismatches.get(o)?c=c.withResumeToken(fr.EMPTY_BYTE_STRING,Gn.min()).withLastLimboFreeSnapshotVersion(Gn.min()):i.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(i.resumeToken,n)),r=r.insert(o,c),u=c,h=i,(0===(d=l).resumeToken.approximateByteSize()||u.snapshotVersion.toMicroseconds()-d.snapshotVersion.toMicroseconds()>=3e8||h.addedDocuments.size+h.modifiedDocuments.size+h.removedDocuments.size>0)&&a.push(s.Pi.updateTargetData(e,c))});let o=zi(),l=Xi();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&a.push(s.persistence.referenceDelegate.updateLimboDocument(e,n))}),a.push(function(e,t,s){let n=Xi(),r=Xi();return s.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=zi();return s.forEach((s,i)=>{const a=e.get(s);i.isFoundDocument()!==a.isFoundDocument()&&(r=r.add(s)),i.isNoDocument()&&i.version.isEqual(Gn.min())?(t.removeEntry(s,i.readTime),n=n.insert(s,i)):!a.isValidDocument()||i.version.compareTo(a.version)>0||0===i.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(i),n=n.insert(s,i)):rn(ll,"Ignoring outdated watch update for ",s,". Current version:",a.version," Watch version:",i.version)}),{ks:n,qs:r}})}(e,i,t.documentUpdates).next(e=>{o=e.ks,l=e.qs})),!n.isEqual(Gn.min())){const t=s.Pi.getLastRemoteSnapshotVersion(e).next(t=>s.Pi.setTargetsMetadata(e,e.currentSequenceNumber,n));a.push(t)}return Zn.waitFor(a).next(()=>i.apply(e)).next(()=>s.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(s.Ms=r,e))}function ml(e,t){const s=hn(e);return s.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),s.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function pl(e,t,s){return g(this,null,function*(){const n=hn(e),r=n.Ms.get(t),i=s?"readwrite":"readwrite-primary";try{s||(yield n.persistence.runTransaction("Release target",i,e=>n.persistence.referenceDelegate.removeTarget(e,r)))}catch(a){if(!er(a))throw a;rn(ll,`Failed to update sequence numbers for target ${t}: ${a}`)}n.Ms=n.Ms.remove(t),n.xs.delete(r.target)})}function gl(e,t,s){const n=hn(e);let r=Gn.min(),i=Xi();return n.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,s){const n=hn(e),r=n.xs.get(s);return void 0!==r?Zn.resolve(n.Ms.get(r)):n.Pi.getTargetData(t,s)}(n,e,Pi(t)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,n.Pi.getMatchingKeysForTargetId(e,t.targetId).next(e=>{i=e})}).next(()=>n.Fs.getDocumentsMatchingQuery(e,t,s?r:Gn.min(),s?i:Xi())).next(e=>(function(e,t,s){let n=e.Os.get(t)||Gn.min();s.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.Os.set(t,n)}(n,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,Qs:i})))}class fl{constructor(){this.activeTargetIds=Zi}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class xl{constructor(){this.Mo=new fl,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,s){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new fl,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class yl{Oo(e){}shutdown(){}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const vl="ConnectivityMonitor";class bl{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){rn(vl,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){rn(vl,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}
/**
     * @license
     * Copyright 2023 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */let wl=null;function Nl(){return null===wl?wl=268435456+Math.round(2147483648*Math.random()):wl++,"0x"+wl.toString(16)
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */}const jl="RestConnection",_l={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class kl{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${s}/databases/${n}`,this.Wo=this.databaseId.database===Er?`project_id=${s}`:`project_id=${s}&database_id=${n}`}Go(e,t,s,n,r){const i=Nl(),a=this.zo(e,t.toUriEncodedString());rn(jl,`Sending RPC '${e}' ${i}:`,a,s);const o={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(o,n,r);const{host:l}=new URL(a),c=He(l);return this.Jo(e,a,o,s,c).then(t=>(rn(jl,`Received RPC '${e}' ${i}: `,t),t),t=>{throw on(jl,`RPC '${e}' ${i} failed with error: `,t,"url: ",a,"request:",s),t})}Ho(e,t,s,n,r,i){return this.Go(e,t,s,n,r)}jo(e,t,s){e["X-Goog-Api-Client"]="gl-js/ fire/"+tn,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,s)=>e[s]=t),s&&s.headers.forEach((t,s)=>e[s]=t)}zo(e,t){const s=_l[e];return`${this.Uo}/v1/${t}:${s}`}terminate(){}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Sl{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Tl="WebChannelConnection";class Il extends kl{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,s,n,r){const i=Nl();return new Promise((r,a)=>{const o=new zs;o.setWithCredentials(!0),o.listenOnce($s.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case Hs.NO_ERROR:const t=o.getResponseJson();rn(Tl,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),r(t);break;case Hs.TIMEOUT:rn(Tl,`RPC '${e}' ${i} timed out`),a(new pn(mn.DEADLINE_EXCEEDED,"Request time out"));break;case Hs.HTTP_ERROR:const s=o.getStatus();if(rn(Tl,`RPC '${e}' ${i} failed with status:`,s,"response text:",o.getResponseText()),s>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(mn).indexOf(t)>=0?t:mn.UNKNOWN}(t.status);a(new pn(e,t.message))}else a(new pn(mn.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new pn(mn.UNAVAILABLE,"Connection failed."));break;default:cn(9055,{l_:e,streamId:i,h_:o.getLastErrorCode(),P_:o.getLastError()})}}finally{rn(Tl,`RPC '${e}' ${i} completed.`)}});const l=JSON.stringify(n);rn(Tl,`RPC '${e}' ${i} sending request:`,n),o.send(t,"POST",l,s,15)})}T_(e,t,s){const n=Nl(),r=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=Qs(),a=Ws(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.jo(o.initMessageHeaders,t,s),o.encodeInitMessageHeaders=!0;const c=r.join("");rn(Tl,`Creating RPC '${e}' stream ${n}: ${c}`,o);const d=i.createWebChannel(c,o);this.I_(d);let u=!1,h=!1;const m=new Sl({Yo:t=>{h?rn(Tl,`Not sending because RPC '${e}' stream ${n} is closed:`,t):(u||(rn(Tl,`Opening RPC '${e}' stream ${n} transport.`),d.open(),u=!0),rn(Tl,`RPC '${e}' stream ${n} sending:`,t),d.send(t))},Zo:()=>d.close()}),p=(e,t,s)=>{e.listen(t,e=>{try{s(e)}catch(t){setTimeout(()=>{throw t},0)}})};return p(d,qs.EventType.OPEN,()=>{h||(rn(Tl,`RPC '${e}' stream ${n} transport opened.`),m.o_())}),p(d,qs.EventType.CLOSE,()=>{h||(h=!0,rn(Tl,`RPC '${e}' stream ${n} transport closed`),m.a_(),this.E_(d))}),p(d,qs.EventType.ERROR,t=>{h||(h=!0,on(Tl,`RPC '${e}' stream ${n} transport errored. Name:`,t.name,"Message:",t.message),m.a_(new pn(mn.UNAVAILABLE,"The operation could not be completed")))}),p(d,qs.EventType.MESSAGE,t=>{var s;if(!h){const r=t.data[0];un(!!r,16349);const i=r,a=(null==i?void 0:i.error)||(null==(s=i[0])?void 0:s.error);if(a){rn(Tl,`RPC '${e}' stream ${n} received error:`,a);const t=a.status;let s=function(e){const t=Oa[e];if(void 0!==t)return Ma(t)}(t),r=a.message;void 0===s&&(s=mn.INTERNAL,r="Unknown error status: "+t+" with message "+a.message),h=!0,m.a_(new pn(s,r)),d.close()}else rn(Tl,`RPC '${e}' stream ${n} received:`,r),m.u_(r)}}),p(a,Js.STAT_EVENT,t=>{t.stat===Gs.PROXY?rn(Tl,`RPC '${e}' stream ${n} detected buffering proxy`):t.stat===Gs.NOPROXY&&rn(Tl,`RPC '${e}' stream ${n} detected no buffering proxy`)}),setTimeout(()=>{m.__()},0),m}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function El(){return"undefined"!=typeof document?document:null}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Cl(e){return new to(e,!0)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Al{constructor(e,t,s=1e3,n=1.5,r=6e4){this.Mi=e,this.timerId=t,this.d_=s,this.A_=n,this.R_=r,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),s=Math.max(0,Date.now()-this.f_),n=Math.max(0,t-s);n>0&&rn("ExponentialBackoff",`Backing off for ${n} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,n,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Pl="PersistentStream";class Dl{constructor(e,t,s,n,r,i,a,o){this.Mi=e,this.S_=s,this.b_=n,this.connection=r,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Al(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}stop(){return g(this,null,function*(){this.x_()&&(yield this.close(0))})}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}k_(){return g(this,null,function*(){if(this.O_())return this.close(0)})}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(e,t){return g(this,null,function*(){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===mn.RESOURCE_EXHAUSTED?(an(t.toString()),an("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===mn.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.r_(t)})}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,s])=>{this.D_===t&&this.G_(e,s)},t=>{e(()=>{const e=new pn(mn.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){const s=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{s(()=>this.listener.Xo())}),this.stream.t_(()=>{s(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(e=>{s(()=>this.z_(e))}),this.stream.onMessage(e=>{s(()=>1==++this.F_?this.J_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(()=>g(this,null,function*(){this.state=0,this.start()}))}z_(e){return rn(Pl,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(rn(Pl,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Rl extends Dl{constructor(e,t,s,n,r,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,n,i),this.serializer=r}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=function(e,t){let s;if("targetChange"in t){t.targetChange;const r="NO_CHANGE"===(n=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===n?1:"REMOVE"===n?2:"CURRENT"===n?3:"RESET"===n?4:cn(39313,{state:n}),i=t.targetChange.targetIds||[],a=function(e,t){return e.useProto3Json?(un(void 0===t||"string"==typeof t,58123),fr.fromBase64String(t||"")):(un(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),fr.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,l=o&&function(e){const t=void 0===e.code?mn.UNKNOWN:Ma(e.code);return new pn(t,e.message||"")}(o);s=new Ga(r,i,a,l||null)}else if("documentChange"in t){t.documentChange;const n=t.documentChange;n.document,n.document.name,n.document.updateTime;const r=ho(e,n.document.name),i=ao(n.document.updateTime),a=n.document.createTime?ao(n.document.createTime):Gn.min(),o=new Xr({mapValue:{fields:n.document.fields}}),l=ei.newFoundDocument(r,i,a,o),c=n.targetIds||[],d=n.removedTargetIds||[];s=new $a(c,d,l.key,l)}else if("documentDelete"in t){t.documentDelete;const n=t.documentDelete;n.document;const r=ho(e,n.document),i=n.readTime?ao(n.readTime):Gn.min(),a=ei.newNoDocument(r,i),o=n.removedTargetIds||[];s=new $a([],o,a.key,a)}else if("documentRemove"in t){t.documentRemove;const n=t.documentRemove;n.document;const r=ho(e,n.document),i=n.removedTargetIds||[];s=new $a([],i,r,null)}else{if(!("filter"in t))return cn(11601,{Rt:t});{t.filter;const e=t.filter;e.targetId;const{count:n=0,unchangedNames:r}=e,i=new Ra(n,r),a=e.targetId;s=new Ha(a,i)}}var n;return s}(this.serializer,e),s=function(e){if(!("targetChange"in e))return Gn.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Gn.min():t.readTime?ao(t.readTime):Gn.min()}(e);return this.listener.H_(t,s)}Y_(e){const t={};t.database=po(this.serializer),t.addTarget=function(e,t){let s;const n=t.target;if(s=Si(n)?{documents:xo(e,n)}:{query:yo(e,n).ft},s.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){s.resumeToken=ro(e,t.resumeToken);const n=so(e,t.expectedCount);null!==n&&(s.expectedCount=n)}else if(t.snapshotVersion.compareTo(Gn.min())>0){s.readTime=no(e,t.snapshotVersion.toTimestamp());const n=so(e,t.expectedCount);null!==n&&(s.expectedCount=n)}return s}(this.serializer,e);const s=function(e,t){const s=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return cn(28987,{purpose:e})}}(t.purpose);return null==s?null:{"goog-listen-tags":s}}(this.serializer,e);s&&(t.labels=s),this.q_(t)}Z_(e){const t={};t.database=po(this.serializer),t.removeTarget=e,this.q_(t)}}class Ol extends Dl{constructor(e,t,s,n,r,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,s,n,i),this.serializer=r}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return un(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,un(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){un(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=function(e,t){return e&&e.length>0?(un(void 0!==t,14353),e.map(e=>function(e,t){let s=e.updateTime?ao(e.updateTime):ao(t);return s.isEqual(Gn.min())&&(s=ao(t)),new ga(s,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),s=ao(e.commitTime);return this.listener.na(s,t)}ra(){const e={};e.database=po(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>function(e,t){let s;if(t instanceof _a)s={update:fo(e,t.key,t.value)};else if(t instanceof Ea)s={delete:uo(e,t.key)};else if(t instanceof ka)s={update:fo(e,t.key,t.data),updateMask:To(t.fieldMask)};else{if(!(t instanceof Ca))return cn(16599,{Vt:t.type});s={verify:uo(e,t.key)}}return t.fieldTransforms.length>0&&(s.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const s=t.transform;if(s instanceof oa)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(s instanceof la)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:s.elements}};if(s instanceof da)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:s.elements}};if(s instanceof ha)return{fieldPath:t.field.canonicalString(),increment:s.Ae};throw cn(20930,{transform:t.transform})}(0,e))),t.precondition.isNone||(s.currentDocument=(n=e,void 0!==(r=t.precondition).updateTime?{updateTime:io(n,r.updateTime)}:void 0!==r.exists?{exists:r.exists}:cn(27497))),s;var n,r}(this.serializer,e))};this.q_(t)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ll{}class Ml extends Ll{constructor(e,t,s,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=n,this.ia=!1}sa(){if(this.ia)throw new pn(mn.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,s,n){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,i])=>this.connection.Go(e,lo(t,s),n,r,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===mn.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new pn(mn.UNKNOWN,e.toString())})}Ho(e,t,s,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Ho(e,lo(t,s),n,i,a,r)).catch(e=>{throw"FirebaseError"===e.name?(e.code===mn.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new pn(mn.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class Fl{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(an(t),this.aa=!1):rn("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Ul="RemoteStore";class Vl{constructor(e,t,s,n,r){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=r,this.Aa.Oo(e=>{s.enqueueAndForget(()=>g(this,null,function*(){Wl(this)&&(rn(Ul,"Restarting streams for network reachability change."),yield function(e){return g(this,null,function*(){const t=hn(e);t.Ea.add(4),yield Kl(t),t.Ra.set("Unknown"),t.Ea.delete(4),yield Bl(t)})}(this))}))}),this.Ra=new Fl(s,n)}}function Bl(e){return g(this,null,function*(){if(Wl(e))for(const t of e.da)yield t(!0)})}function Kl(e){return g(this,null,function*(){for(const t of e.da)yield t(!1)})}function zl(e,t){const s=hn(e);s.Ia.has(t.targetId)||(s.Ia.set(t.targetId,t),Jl(s)?Gl(s):mc(s).O_()&&$l(s,t))}function ql(e,t){const s=hn(e),n=mc(s);s.Ia.delete(t),n.O_()&&Hl(s,t),0===s.Ia.size&&(n.O_()?n.L_():Wl(s)&&s.Ra.set("Unknown"))}function $l(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Gn.min())>0){const s=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(s)}mc(e).Y_(t)}function Hl(e,t){e.Va.Ue(t),mc(e).Z_(t)}function Gl(e){e.Va=new Wa({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),mc(e).start(),e.Ra.ua()}function Jl(e){return Wl(e)&&!mc(e).x_()&&e.Ia.size>0}function Wl(e){return 0===hn(e).Ea.size}function Ql(e){e.Va=void 0}function Yl(e){return g(this,null,function*(){e.Ra.set("Online")})}function Xl(e){return g(this,null,function*(){e.Ia.forEach((t,s)=>{$l(e,t)})})}function Zl(e,t){return g(this,null,function*(){Ql(e),Jl(e)?(e.Ra.ha(t),Gl(e)):e.Ra.set("Unknown")})}function ec(e,t,s){return g(this,null,function*(){if(e.Ra.set("Online"),t instanceof Ga&&2===t.state&&t.cause)try{yield function(e,t){return g(this,null,function*(){const s=t.cause;for(const n of t.targetIds)e.Ia.has(n)&&(yield e.remoteSyncer.rejectListen(n,s),e.Ia.delete(n),e.Va.removeTarget(n))})}(e,t)}catch(n){rn(Ul,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),yield tc(e,n)}else if(t instanceof $a?e.Va.Ze(t):t instanceof Ha?e.Va.st(t):e.Va.tt(t),!s.isEqual(Gn.min()))try{const t=yield ul(e.localStore);s.compareTo(t)>=0&&(yield function(e,t){const s=e.Va.Tt(t);return s.targetChanges.forEach((s,n)=>{if(s.resumeToken.approximateByteSize()>0){const r=e.Ia.get(n);r&&e.Ia.set(n,r.withResumeToken(s.resumeToken,t))}}),s.targetMismatches.forEach((t,s)=>{const n=e.Ia.get(t);if(!n)return;e.Ia.set(t,n.withResumeToken(fr.EMPTY_BYTE_STRING,n.snapshotVersion)),Hl(e,t);const r=new Eo(n.target,t,s,n.sequenceNumber);$l(e,r)}),e.remoteSyncer.applyRemoteEvent(s)}(e,s))}catch(r){rn(Ul,"Failed to raise snapshot:",r),yield tc(e,r)}})}function tc(e,t,s){return g(this,null,function*(){if(!er(t))throw t;e.Ea.add(1),yield Kl(e),e.Ra.set("Offline"),s||(s=()=>ul(e.localStore)),e.asyncQueue.enqueueRetryable(()=>g(this,null,function*(){rn(Ul,"Retrying IndexedDB access"),yield s(),e.Ea.delete(1),yield Bl(e)}))})}function sc(e,t){return t().catch(s=>tc(e,s,t))}function nc(e){return g(this,null,function*(){const t=hn(e),s=pc(t);let n=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:-1;for(;rc(t);)try{const e=yield ml(t.localStore,n);if(null===e){0===t.Ta.length&&s.L_();break}n=e.batchId,ic(t,e)}catch(r){yield tc(t,r)}ac(t)&&oc(t)})}function rc(e){return Wl(e)&&e.Ta.length<10}function ic(e,t){e.Ta.push(t);const s=pc(e);s.O_()&&s.X_&&s.ea(t.mutations)}function ac(e){return Wl(e)&&!pc(e).x_()&&e.Ta.length>0}function oc(e){pc(e).start()}function lc(e){return g(this,null,function*(){pc(e).ra()})}function cc(e){return g(this,null,function*(){const t=pc(e);for(const s of e.Ta)t.ea(s.mutations)})}function dc(e,t,s){return g(this,null,function*(){const n=e.Ta.shift(),r=Pa.from(n,t,s);yield sc(e,()=>e.remoteSyncer.applySuccessfulWrite(r)),yield nc(e)})}function uc(e,t){return g(this,null,function*(){t&&pc(e).X_&&(yield function(e,t){return g(this,null,function*(){if(function(e){switch(e){case mn.OK:return cn(64938);case mn.CANCELLED:case mn.UNKNOWN:case mn.DEADLINE_EXCEEDED:case mn.RESOURCE_EXHAUSTED:case mn.INTERNAL:case mn.UNAVAILABLE:case mn.UNAUTHENTICATED:return!1;case mn.INVALID_ARGUMENT:case mn.NOT_FOUND:case mn.ALREADY_EXISTS:case mn.PERMISSION_DENIED:case mn.FAILED_PRECONDITION:case mn.ABORTED:case mn.OUT_OF_RANGE:case mn.UNIMPLEMENTED:case mn.DATA_LOSS:return!0;default:return cn(15467,{code:e})}}(s=t.code)&&s!==mn.ABORTED){const s=e.Ta.shift();pc(e).B_(),yield sc(e,()=>e.remoteSyncer.rejectFailedWrite(s.batchId,t)),yield nc(e)}var s})}(e,t)),ac(e)&&oc(e)})}function hc(e,t){return g(this,null,function*(){const s=hn(e);s.asyncQueue.verifyOperationInProgress(),rn(Ul,"RemoteStore received new credentials");const n=Wl(s);s.Ea.add(3),yield Kl(s),n&&s.Ra.set("Unknown"),yield s.remoteSyncer.handleCredentialChange(t),s.Ea.delete(3),yield Bl(s)})}function mc(e){return e.ma||(e.ma=function(e,t,s){const n=hn(e);return n.sa(),new Rl(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,s)}(e.datastore,e.asyncQueue,{Xo:Yl.bind(null,e),t_:Xl.bind(null,e),r_:Zl.bind(null,e),H_:ec.bind(null,e)}),e.da.push(t=>g(this,null,function*(){t?(e.ma.B_(),Jl(e)?Gl(e):e.Ra.set("Unknown")):(yield e.ma.stop(),Ql(e))}))),e.ma}function pc(e){return e.fa||(e.fa=function(e,t,s){const n=hn(e);return n.sa(),new Ol(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,s)}(e.datastore,e.asyncQueue,{Xo:()=>Promise.resolve(),t_:lc.bind(null,e),r_:uc.bind(null,e),ta:cc.bind(null,e),na:dc.bind(null,e)}),e.da.push(t=>g(this,null,function*(){t?(e.fa.B_(),yield nc(e)):(yield e.fa.stop(),e.Ta.length>0&&(rn(Ul,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))}))),e.fa
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */}class gc{constructor(e,t,s,n,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=n,this.removalCallback=r,this.deferred=new gn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,n,r){const i=Date.now()+s,a=new gc(e,t,i,n,r);return a.start(s),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new pn(mn.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function fc(e,t){if(an("AsyncQueue",`${t}: ${e}`),er(e))return new pn(mn.UNAVAILABLE,`${t}: ${e}`);throw e}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class xc{static emptySet(e){return new xc(e.comparator)}constructor(e){this.comparator=e?(t,s)=>e(t,s)||On.comparator(t.key,s.key):(e,t)=>On.comparator(e.key,t.key),this.keyedMap=$i(),this.sortedSet=new cr(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,s)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof xc))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,n=s.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const s=new xc;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class yc{constructor(){this.ga=new cr(On.comparator)}track(e){const t=e.doc.key,s=this.ga.get(t);s?0!==e.type&&3===s.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==s.type?this.ga=this.ga.insert(t,{type:s.type,doc:e.doc}):2===e.type&&2===s.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===s.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===s.type?this.ga=this.ga.remove(t):1===e.type&&2===s.type?this.ga=this.ga.insert(t,{type:1,doc:s.doc}):0===e.type&&1===s.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):cn(63341,{Rt:e,pa:s}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,s)=>{e.push(s)}),e}}class vc{constructor(e,t,s,n,r,i,a,o,l){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=n,this.mutatedKeys=r,this.fromCache=i,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,s,n,r){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new vc(e,t,xc.emptySet(t),i,s,n,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Oi(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let n=0;n<t.length;n++)if(t[n].type!==s[n].type||!t[n].doc.isEqual(s[n].doc))return!1;return!0}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class bc{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class wc{constructor(){this.queries=Nc(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(e,t){const s=hn(e),n=s.queries;s.queries=Nc(),n.forEach((e,s)=>{for(const n of s.Sa)n.onError(t)})}(this,new pn(mn.ABORTED,"Firestore shutting down"))}}function Nc(){return new Bi(e=>Li(e),Oi)}function jc(e,t){return g(this,null,function*(){const s=hn(e);let n=3;const r=t.query;let i=s.queries.get(r);i?!i.ba()&&t.Da()&&(n=2):(i=new bc,n=t.Da()?0:1);try{switch(n){case 0:i.wa=yield s.onListen(r,!0);break;case 1:i.wa=yield s.onListen(r,!1);break;case 2:yield s.onFirstRemoteStoreListen(r)}}catch(a){const e=fc(a,`Initialization of query '${Mi(t.query)}' failed`);return void t.onError(e)}s.queries.set(r,i),i.Sa.push(t),t.va(s.onlineState),i.wa&&t.Fa(i.wa)&&Tc(s)})}function _c(e,t){return g(this,null,function*(){const s=hn(e),n=t.query;let r=3;const i=s.queries.get(n);if(i){const e=i.Sa.indexOf(t);e>=0&&(i.Sa.splice(e,1),0===i.Sa.length?r=t.Da()?0:1:!i.ba()&&t.Da()&&(r=2))}switch(r){case 0:return s.queries.delete(n),s.onUnlisten(n,!0);case 1:return s.queries.delete(n),s.onUnlisten(n,!1);case 2:return s.onLastRemoteStoreUnlisten(n);default:return}})}function kc(e,t){const s=hn(e);let n=!1;for(const r of t){const e=r.query,t=s.queries.get(e);if(t){for(const e of t.Sa)e.Fa(r)&&(n=!0);t.wa=r}}n&&Tc(s)}function Sc(e,t,s){const n=hn(e),r=n.queries.get(t);if(r)for(const i of r.Sa)i.onError(s);n.queries.delete(t)}function Tc(e){e.Ca.forEach(e=>{e.next()})}var Ic,Ec;(Ec=Ic||(Ic={})).Ma="default",Ec.Cache="cache";class Cc{constructor(e,t,s){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=s||{}}Fa(e){if(!this.options.includeMetadataChanges){const t=[];for(const s of e.docChanges)3!==s.type&&t.push(s);e=new vc(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache)return!0;if(!this.Da())return!0;const s="Offline"!==t;return(!this.options.qa||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=vc.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Ic.Cache}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ac{constructor(e){this.key=e}}class Pc{constructor(e){this.key=e}}class Dc{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Xi(),this.mutatedKeys=Xi(),this.eu=Ui(e),this.tu=new xc(this.eu)}get nu(){return this.Ya}ru(e,t){const s=t?t.iu:new yc,n=t?t.tu:this.tu;let r=t?t.mutatedKeys:this.mutatedKeys,i=n,a=!1;const o="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,l="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{const c=n.get(e),d=Fi(this.query,t)?t:null,u=!!c&&this.mutatedKeys.has(c.key),h=!!d&&(d.hasLocalMutations||this.mutatedKeys.has(d.key)&&d.hasCommittedMutations);let m=!1;c&&d?c.data.isEqual(d.data)?u!==h&&(s.track({type:3,doc:d}),m=!0):this.su(c,d)||(s.track({type:2,doc:d}),m=!0,(o&&this.eu(d,o)>0||l&&this.eu(d,l)<0)&&(a=!0)):!c&&d?(s.track({type:0,doc:d}),m=!0):c&&!d&&(s.track({type:1,doc:c}),m=!0,(o||l)&&(a=!0)),m&&(d?(i=i.add(d),r=h?r.add(e):r.delete(e)):(i=i.delete(e),r=r.delete(e)))}),null!==this.query.limit)for(;i.size>this.query.limit;){const e="F"===this.query.limitType?i.last():i.first();i=i.delete(e.key),r=r.delete(e.key),s.track({type:1,doc:e})}return{tu:i,iu:s,Cs:a,mutatedKeys:r}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,n){const r=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const i=e.iu.ya();i.sort((e,t)=>function(e,t){const s=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return cn(20277,{Rt:e})}};return s(e)-s(t)}(e.type,t.type)||this.eu(e.doc,t.doc)),this.ou(s),n=null!=n&&n;const a=t&&!n?this._u():[],o=0===this.Xa.size&&this.current&&!n?1:0,l=o!==this.Za;return this.Za=o,0!==i.length||l?{snapshot:new vc(this.query,e.tu,r,i,e.mutatedKeys,0===o,l,!1,!!s&&s.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new yc,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Xi(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))});const t=[];return e.forEach(e=>{this.Xa.has(e)||t.push(new Pc(e))}),this.Xa.forEach(s=>{e.has(s)||t.push(new Ac(s))}),t}cu(e){this.Ya=e.Qs,this.Xa=Xi();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return vc.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}const Rc="SyncEngine";class Oc{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class Lc{constructor(e){this.key=e,this.hu=!1}}class Mc{constructor(e,t,s,n,r,i){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=n,this.currentUser=r,this.maxConcurrentLimboResolutions=i,this.Pu={},this.Tu=new Bi(e=>Li(e),Oi),this.Iu=new Map,this.Eu=new Set,this.du=new cr(On.comparator),this.Au=new Map,this.Ru=new Wo,this.Vu={},this.mu=new Map,this.fu=Mo.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}function Fc(e,t,s=!0){return g(this,null,function*(){const n=id(e);let r;const i=n.Tu.get(t);return i?(n.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.lu()):r=yield Vc(n,t,s,!0),r})}function Uc(e,t){return g(this,null,function*(){const s=id(e);yield Vc(s,t,!0,!1)})}function Vc(e,t,s,n){return g(this,null,function*(){const r=yield function(e,t){const s=hn(e);return s.persistence.runTransaction("Allocate target","readwrite",e=>{let n;return s.Pi.getTargetData(e,t).next(r=>r?(n=r,Zn.resolve(n)):s.Pi.allocateTargetId(e).next(r=>(n=new Eo(t,r,"TargetPurposeListen",e.currentSequenceNumber),s.Pi.addTargetData(e,n).next(()=>n))))}).then(e=>{const n=s.Ms.get(e.targetId);return(null===n||e.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(s.Ms=s.Ms.insert(e.targetId,e),s.xs.set(t,e.targetId)),e})}(e.localStore,Pi(t)),i=r.targetId,a=e.sharedClientState.addLocalQueryTarget(i,s);let o;return n&&(o=yield function(e,t,s,n,r){return g(this,null,function*(){e.pu=(t,s,n)=>function(e,t,s,n){return g(this,null,function*(){let r=t.view.ru(s);r.Cs&&(r=yield gl(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,r)));const i=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),o=t.view.applyChanges(r,e.isPrimaryClient,i,a);return Zc(e,t.targetId,o.au),o.snapshot})}(e,t,s,n);const i=yield gl(e.localStore,t,!0),a=new Dc(t,i.Qs),o=a.ru(i.documents),l=qa.createSynthesizedTargetChangeForCurrentChange(s,n&&"Offline"!==e.onlineState,r),c=a.applyChanges(o,e.isPrimaryClient,l);Zc(e,s,c.au);const d=new Oc(t,s,a);return e.Tu.set(t,d),e.Iu.has(s)?e.Iu.get(s).push(t):e.Iu.set(s,[t]),c.snapshot})}(e,t,i,"current"===a,r.resumeToken)),e.isPrimaryClient&&s&&zl(e.remoteStore,r),o})}function Bc(e,t,s){return g(this,null,function*(){const n=hn(e),r=n.Tu.get(t),i=n.Iu.get(r.targetId);if(i.length>1)return n.Iu.set(r.targetId,i.filter(e=>!Oi(e,t))),void n.Tu.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||(yield pl(n.localStore,r.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(r.targetId),s&&ql(n.remoteStore,r.targetId),Yc(n,r.targetId)}).catch(Xn))):(Yc(n,r.targetId),yield pl(n.localStore,r.targetId,!0))})}function Kc(e,t){return g(this,null,function*(){const s=hn(e),n=s.Tu.get(t),r=s.Iu.get(n.targetId);s.isPrimaryClient&&1===r.length&&(s.sharedClientState.removeLocalQueryTarget(n.targetId),ql(s.remoteStore,n.targetId))})}function zc(e,t,s){return g(this,null,function*(){const n=function(e){const t=hn(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Gc.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Jc.bind(null,t),t}(e);try{const e=yield function(e,t){const s=hn(e),n=Hn.now(),r=t.reduce((e,t)=>e.add(t.key),Xi());let i,a;return s.persistence.runTransaction("Locally write mutations","readwrite",e=>{let o=zi(),l=Xi();return s.Ns.getEntries(e,r).next(e=>{o=e,o.forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>s.localDocuments.getOverlayedDocuments(e,o)).next(r=>{i=r;const a=[];for(const e of t){const t=Na(e,i.get(e.key).overlayedDocument);null!=t&&a.push(new ka(e.key,t,Zr(t.value.mapValue),fa.exists(!0)))}return s.mutationQueue.addMutationBatch(e,n,a,t)}).next(t=>{a=t;const n=t.applyToLocalDocumentSet(i,l);return s.documentOverlayCache.saveOverlays(e,t.batchId,n)})}).then(()=>({batchId:a.batchId,changes:Hi(i)}))}(n.localStore,t);n.sharedClientState.addPendingMutation(e.batchId),function(e,t,s){let n=e.Vu[e.currentUser.toKey()];n||(n=new cr(Sn)),n=n.insert(t,s),e.Vu[e.currentUser.toKey()]=n}(n,e.batchId,s),yield sd(n,e.changes),yield nc(n.remoteStore)}catch(r){const e=fc(r,"Failed to persist write");s.reject(e)}})}function qc(e,t){return g(this,null,function*(){const s=hn(e);try{const e=yield hl(s.localStore,t);t.targetChanges.forEach((e,t)=>{const n=s.Au.get(t);n&&(un(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?n.hu=!0:e.modifiedDocuments.size>0?un(n.hu,14607):e.removedDocuments.size>0&&(un(n.hu,42227),n.hu=!1))}),yield sd(s,e,t)}catch(n){yield Xn(n)}})}function $c(e,t,s){const n=hn(e);if(n.isPrimaryClient&&0===s||!n.isPrimaryClient&&1===s){const e=[];n.Tu.forEach((s,n)=>{const r=n.view.va(t);r.snapshot&&e.push(r.snapshot)}),function(e,t){const s=hn(e);s.onlineState=t;let n=!1;s.queries.forEach((e,s)=>{for(const r of s.Sa)r.va(t)&&(n=!0)}),n&&Tc(s)}(n.eventManager,t),e.length&&n.Pu.H_(e),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}function Hc(e,t,s){return g(this,null,function*(){const n=hn(e);n.sharedClientState.updateQueryState(t,"rejected",s);const r=n.Au.get(t),i=r&&r.key;if(i){let e=new cr(On.comparator);e=e.insert(i,ei.newNoDocument(i,Gn.min()));const s=Xi().add(i),r=new za(Gn.min(),new Map,new cr(Sn),e,s);yield qc(n,r),n.du=n.du.remove(i),n.Au.delete(t),td(n)}else yield pl(n.localStore,t,!1).then(()=>Yc(n,t,s)).catch(Xn)})}function Gc(e,t){return g(this,null,function*(){const s=hn(e),n=t.batch.batchId;try{const e=yield function(e,t){const s=hn(e);return s.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const n=t.batch.keys(),r=s.Ns.newChangeBuffer({trackRemovals:!0});return function(e,t,s,n){const r=s.batch,i=r.keys();let a=Zn.resolve();return i.forEach(e=>{a=a.next(()=>n.getEntry(t,e)).next(t=>{const i=s.docVersions.get(e);un(null!==i,48541),t.version.compareTo(i)<0&&(r.applyToRemoteDocument(t,s),t.isValidDocument()&&(t.setReadTime(s.commitVersion),n.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,r))}(s,e,t,r).next(()=>r.apply(e)).next(()=>s.mutationQueue.performConsistencyCheck(e)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(e,n,t.batch.batchId)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Xi();for(let s=0;s<e.mutationResults.length;++s)e.mutationResults[s].transformResults.length>0&&(t=t.add(e.batch.mutations[s].key));return t}(t))).next(()=>s.localDocuments.getDocuments(e,n))})}(s.localStore,t);Qc(s,n,null),Wc(s,n),s.sharedClientState.updateMutationState(n,"acknowledged"),yield sd(s,e)}catch(r){yield Xn(r)}})}function Jc(e,t,s){return g(this,null,function*(){const n=hn(e);try{const e=yield function(e,t){const s=hn(e);return s.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return s.mutationQueue.lookupMutationBatch(e,t).next(t=>(un(null!==t,37113),n=t.keys(),s.mutationQueue.removeMutationBatch(e,t))).next(()=>s.mutationQueue.performConsistencyCheck(e)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>s.localDocuments.getDocuments(e,n))})}(n.localStore,t);Qc(n,t,s),Wc(n,t),n.sharedClientState.updateMutationState(t,"rejected",s),yield sd(n,e)}catch(r){yield Xn(r)}})}function Wc(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function Qc(e,t,s){const n=hn(e);let r=n.Vu[n.currentUser.toKey()];if(r){const e=r.get(t);e&&(s?e.reject(s):e.resolve(),r=r.remove(t)),n.Vu[n.currentUser.toKey()]=r}}function Yc(e,t,s=null){e.sharedClientState.removeLocalQueryTarget(t);for(const n of e.Iu.get(t))e.Tu.delete(n),s&&e.Pu.yu(n,s);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach(t=>{e.Ru.containsKey(t)||Xc(e,t)})}function Xc(e,t){e.Eu.delete(t.path.canonicalString());const s=e.du.get(t);null!==s&&(ql(e.remoteStore,s),e.du=e.du.remove(t),e.Au.delete(s),td(e))}function Zc(e,t,s){for(const n of s)n instanceof Ac?(e.Ru.addReference(n.key,t),ed(e,n)):n instanceof Pc?(rn(Rc,"Document no longer in limbo: "+n.key),e.Ru.removeReference(n.key,t),e.Ru.containsKey(n.key)||Xc(e,n.key)):cn(19791,{wu:n})}function ed(e,t){const s=t.key,n=s.path.canonicalString();e.du.get(s)||e.Eu.has(n)||(rn(Rc,"New document in limbo: "+s),e.Eu.add(n),td(e))}function td(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){const t=e.Eu.values().next().value;e.Eu.delete(t);const s=new On(Pn.fromString(t)),n=e.fu.next();e.Au.set(n,new Lc(s)),e.du=e.du.insert(s,n),zl(e.remoteStore,new Eo(Pi(Ii(s.path)),n,"TargetPurposeLimboResolution",tr.ce))}}function sd(e,t,s){return g(this,null,function*(){const n=hn(e),r=[],i=[],a=[];n.Tu.isEmpty()||(n.Tu.forEach((e,o)=>{a.push(n.pu(o,t,s).then(e=>{var t;if((e||s)&&n.isPrimaryClient){const r=e?!e.fromCache:null==(t=null==s?void 0:s.targetChanges.get(o.targetId))?void 0:t.current;n.sharedClientState.updateQueryState(o.targetId,r?"current":"not-current")}if(e){r.push(e);const t=il.As(o.targetId,e);i.push(t)}}))}),yield Promise.all(a),n.Pu.H_(r),yield function(e,t){return g(this,null,function*(){const s=hn(e);try{yield s.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>Zn.forEach(t,t=>Zn.forEach(t.Es,n=>s.persistence.referenceDelegate.addReference(e,t.targetId,n)).next(()=>Zn.forEach(t.ds,n=>s.persistence.referenceDelegate.removeReference(e,t.targetId,n)))))}catch(n){if(!er(n))throw n;rn(ll,"Failed to update sequence numbers: "+n)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=s.Ms.get(t),n=e.snapshotVersion,r=e.withLastLimboFreeSnapshotVersion(n);s.Ms=s.Ms.insert(t,r)}}})}(n.localStore,i))})}function nd(e,t){return g(this,null,function*(){const s=hn(e);if(!s.currentUser.isEqual(t)){rn(Rc,"User change. New user:",t.toKey());const e=yield dl(s.localStore,t);s.currentUser=t,r="'waitForPendingWrites' promise is rejected due to a user change.",(n=s).mu.forEach(e=>{e.forEach(e=>{e.reject(new pn(mn.CANCELLED,r))})}),n.mu.clear(),s.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),yield sd(s,e.Ls)}var n,r})}function rd(e,t){const s=hn(e),n=s.Au.get(t);if(n&&n.hu)return Xi().add(n.key);{let e=Xi();const n=s.Iu.get(t);if(!n)return e;for(const t of n){const n=s.Tu.get(t);e=e.unionWith(n.view.nu)}return e}}function id(e){const t=hn(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=qc.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=rd.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Hc.bind(null,t),t.Pu.H_=kc.bind(null,t.eventManager),t.Pu.yu=Sc.bind(null,t.eventManager),t}class ad{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(e){return g(this,null,function*(){this.serializer=Cl(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),yield this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)})}Fu(e,t){return null}Mu(e,t){return null}vu(e){return function(e,t,s,n){return new cl(e,t,s,n)}(this.persistence,new ol,e.initialUser,this.serializer)}Cu(e){return new tl(nl.mi,this.serializer)}Du(e){return new xl}terminate(){return g(this,null,function*(){var e,t;null==(e=this.gcScheduler)||e.stop(),null==(t=this.indexBackfillerScheduler)||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}ad.provider={build:()=>new ad};class od extends ad{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){un(this.persistence.referenceDelegate instanceof rl,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new Bo(s,e.asyncQueue,t)}Cu(e){const t=void 0!==this.cacheSizeBytes?Lo.withCacheSize(this.cacheSizeBytes):Lo.DEFAULT;return new tl(e=>rl.mi(e,t),this.serializer)}}class ld{initialize(e,t){return g(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>$c(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=nd.bind(null,this.syncEngine),yield function(e,t){return g(this,null,function*(){const s=hn(e);t?(s.Ea.delete(2),yield Bl(s)):t||(s.Ea.add(2),yield Kl(s),s.Ra.set("Unknown"))})}(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return new wc}createDatastore(e){const t=Cl(e.databaseInfo.databaseId),s=(n=e.databaseInfo,new Il(n));var n;return function(e,t,s,n){return new Ml(e,t,s,n)}(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return t=this.localStore,s=this.datastore,n=e.asyncQueue,r=e=>$c(this.syncEngine,e,0),i=bl.v()?new bl:new yl,new Vl(t,s,n,r,i);var t,s,n,r,i}createSyncEngine(e,t){return function(e,t,s,n,r,i,a){const o=new Mc(e,t,s,n,r,i);return a&&(o.gu=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return g(this,null,function*(){var e,t;yield function(e){return g(this,null,function*(){const t=hn(e);rn(Ul,"RemoteStore shutting down."),t.Ea.add(5),yield Kl(t),t.Aa.shutdown(),t.Ra.set("Unknown")})}(this.remoteStore),null==(e=this.datastore)||e.terminate(),null==(t=this.eventManager)||t.terminate()})}}ld.provider={build:()=>new ld};
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class cd{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):an("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const dd="FirestoreClient";class ud{constructor(e,t,s,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this.databaseInfo=n,this.user=en.UNAUTHENTICATED,this.clientId=kn.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(s,e=>g(this,null,function*(){rn(dd,"Received user=",e.uid),yield this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(s,e=>(rn(dd,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new gn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>g(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=fc(t,"Failed to shutdown persistence");e.reject(s)}})),e.promise}}function hd(e,t){return g(this,null,function*(){e.asyncQueue.verifyOperationInProgress(),rn(dd,"Initializing OfflineComponentProvider");const s=e.configuration;yield t.initialize(s);let n=s.initialUser;e.setCredentialChangeListener(e=>g(this,null,function*(){n.isEqual(e)||(yield dl(t.localStore,e),n=e)})),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t})}function md(e,t){return g(this,null,function*(){e.asyncQueue.verifyOperationInProgress();const s=yield function(e){return g(this,null,function*(){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){rn(dd,"Using user provided OfflineComponentProvider");try{yield hd(e,e._uninitializedComponentsProvider._offline)}catch(t){const r=t;if(!("FirebaseError"===(s=r).name?s.code===mn.FAILED_PRECONDITION||s.code===mn.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&s instanceof DOMException)||22===s.code||20===s.code||11===s.code))throw r;on("Error using user provided cache. Falling back to memory cache: "+r),yield hd(e,new ad)}}else rn(dd,"Using default OfflineComponentProvider"),yield hd(e,new od(void 0));var s;return e._offlineComponents})}(e);rn(dd,"Initializing OnlineComponentProvider"),yield t.initialize(s,e.configuration),e.setCredentialChangeListener(e=>hc(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,s)=>hc(t.remoteStore,s)),e._onlineComponents=t})}function pd(e){return g(this,null,function*(){return e._onlineComponents||(e._uninitializedComponentsProvider?(rn(dd,"Using user provided OnlineComponentProvider"),yield md(e,e._uninitializedComponentsProvider._online)):(rn(dd,"Using default OnlineComponentProvider"),yield md(e,new ld))),e._onlineComponents})}function gd(e){return g(this,null,function*(){const t=yield pd(e),s=t.eventManager;return s.onListen=Fc.bind(null,t.syncEngine),s.onUnlisten=Bc.bind(null,t.syncEngine),s.onFirstRemoteStoreListen=Uc.bind(null,t.syncEngine),s.onLastRemoteStoreUnlisten=Kc.bind(null,t.syncEngine),s})}
/**
     * @license
     * Copyright 2023 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function fd(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */}const xd=new Map,yd="firestore.googleapis.com",vd=!0;
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class bd{constructor(e){var t,s;if(void 0===e.host){if(void 0!==e.ssl)throw new pn(mn.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=yd,this.ssl=vd}else this.host=e.host,this.ssl=null!=(t=e.ssl)?t:vd;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=Oo;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new pn(mn.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,s,n){if(!0===t&&!0===n)throw new pn(mn.INVALID_ARGUMENT,`${e} and ${s} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=fd(null!=(s=e.experimentalLongPollingOptions)?s:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new pn(mn.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new pn(mn.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new pn(mn.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,s=e.experimentalLongPollingOptions,t.timeoutSeconds===s.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,s}}class wd{constructor(e,t,s,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new bd({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new pn(mn.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new pn(mn.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new bd(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new xn;switch(e.type){case"firstParty":return new wn(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new pn(mn.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return g(this,null,function*(){"notTerminated"===this._terminateTask?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=xd.get(e);t&&(rn("ComponentProvider","Removing Datastore"),xd.delete(e),t.terminate())}(this),Promise.resolve()}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Nd{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new Nd(this.firestore,e,this._query)}}class jd{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new _d(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new jd(this.firestore,e,this._key)}toJSON(){return{type:jd._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,s){if(zn(t,jd._jsonSchema))return new jd(e,s||null,new On(Pn.fromString(t.referencePath)))}}jd._jsonSchemaVersion="firestore/documentReference/1.0",jd._jsonSchema={type:Kn("string",jd._jsonSchemaVersion),referencePath:Kn("string")};class _d extends Nd{constructor(e,t,s){super(e,t,Ii(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new jd(this.firestore,null,new On(e))}withConverter(e){return new _d(this.firestore,e,this._path)}}function kd(e,t,...s){if(e=dt(e),Ln("collection","path",t),e instanceof wd){const n=Pn.fromString(t,...s);return Fn(n),new _d(e,null,n)}{if(!(e instanceof jd||e instanceof _d))throw new pn(mn.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(Pn.fromString(t,...s));return Fn(n),new _d(e.firestore,null,n)}}function Sd(e,t,...s){if(e=dt(e),1===arguments.length&&(t=kn.newId()),Ln("doc","path",t),e instanceof wd){const n=Pn.fromString(t,...s);return Mn(n),new jd(e,null,new On(n))}{if(!(e instanceof jd||e instanceof _d))throw new pn(mn.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=e._path.child(Pn.fromString(t,...s));return Mn(n),new jd(e.firestore,e instanceof _d?e.converter:null,new On(n))}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Td="AsyncQueue";class Id{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Al(this,"async_queue_retry"),this._c=()=>{const e=El();e&&rn(Td,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=El();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=El();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new gn;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}lc(){return g(this,null,function*(){if(0!==this.Xu.length){try{yield this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!er(e))throw e;rn(Td,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}})}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,an("INTERNAL UNHANDLED ERROR: ",Ed(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,s){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const n=gc.createAndSchedule(this,e,t,s,e=>this.hc(e));return this.tc.push(n),n}uc(){this.nc&&cn(47125,{Pc:Ed(this.nc)})}verifyOperationInProgress(){}Tc(){return g(this,null,function*(){let e;do{e=this.ac,yield e}while(e!==this.ac)})}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Ed(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */}function Cd(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const s=e;for(const n of t)if(n in s&&"function"==typeof s[n])return!0;return!1}(e,["next","error","complete"])}class Ad extends wd{constructor(e,t,s,n){super(e,t,s,n),this.type="firestore",this._queue=new Id,this._persistenceKey=(null==n?void 0:n.name)||"[DEFAULT]"}_terminate(){return g(this,null,function*(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Id(e),this._firestoreClient=void 0,yield e}})}}function Pd(e){if(e._terminated)throw new pn(mn.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,s,n;const r=e._freezeSettings(),i=(a=e._databaseId,o=(null==(t=e._app)?void 0:t.options.appId)||"",l=e._persistenceKey,new Ir(a,o,l,(c=r).host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,fd(c.experimentalLongPollingOptions),c.useFetchStreams,c.isUsingEmulator));var a,o,l,c;e._componentsProvider||(null==(s=r.localCache)?void 0:s._offlineComponentProvider)&&(null==(n=r.localCache)?void 0:n._onlineComponentProvider)&&(e._componentsProvider={_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider}),e._firestoreClient=new ud(e._authCredentials,e._appCheckCredentials,e._queue,i,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(e),e._firestoreClient}class Dd{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Dd(fr.fromBase64String(e))}catch(t){throw new pn(mn.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Dd(fr.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Dd._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(zn(e,Dd._jsonSchema))return Dd.fromBase64String(e.bytes)}}Dd._jsonSchemaVersion="firestore/bytes/1.0",Dd._jsonSchema={type:Kn("string",Dd._jsonSchemaVersion),bytes:Kn("string")};
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Rd{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new pn(mn.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Rn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Od{constructor(e){this._methodName=e}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ld{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new pn(mn.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new pn(mn.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Sn(this._lat,e._lat)||Sn(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ld._jsonSchemaVersion}}static fromJSON(e){if(zn(e,Ld._jsonSchema))return new Ld(e.latitude,e.longitude)}}Ld._jsonSchemaVersion="firestore/geoPoint/1.0",Ld._jsonSchema={type:Kn("string",Ld._jsonSchemaVersion),latitude:Kn("number"),longitude:Kn("number")};
/**
     * @license
     * Copyright 2024 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Md{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let s=0;s<e.length;++s)if(e[s]!==t[s])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Md._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(zn(e,Md._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new Md(e.vectorValues);throw new pn(mn.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Md._jsonSchemaVersion="firestore/vectorValue/1.0",Md._jsonSchema={type:Kn("string",Md._jsonSchemaVersion),vectorValues:Kn("object")};
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const Fd=/^__.*__$/;class Ud{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return null!==this.fieldMask?new ka(e,this.data,this.fieldMask,t,this.fieldTransforms):new _a(e,this.data,t,this.fieldTransforms)}}class Vd{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return new ka(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Bd(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw cn(40011,{Ac:e})}}class Kd{constructor(e,t,s,n,r,i){this.settings=e,this.databaseId=t,this.serializer=s,this.ignoreUndefinedProperties=n,void 0===r&&this.Rc(),this.fieldTransforms=r||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Kd(d(d({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var t;const s=null==(t=this.path)?void 0:t.child(e),n=this.Vc({path:s,fc:!1});return n.gc(e),n}yc(e){var t;const s=null==(t=this.path)?void 0:t.child(e),n=this.Vc({path:s,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return eu(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(Bd(this.Ac)&&Fd.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class zd{constructor(e,t,s){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=s||Cl(e)}Cc(e,t,s,n=!1){return new Kd({Ac:e,methodName:t,Dc:s,path:Rn.emptyPath(),fc:!1,bc:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function qd(e){const t=e._freezeSettings(),s=Cl(e._databaseId);return new zd(e._databaseId,!!t.ignoreUndefinedProperties,s)}function $d(e,t,s,n,r,i={}){const a=e.Cc(i.merge||i.mergeFields?2:0,t,s,r);Qd("Data must be an object, but it was:",a,n);const o=Jd(n,a);let l,c;if(i.merge)l=new pr(a.fieldMask),c=a.fieldTransforms;else if(i.mergeFields){const e=[];for(const n of i.mergeFields){const r=Yd(t,n,s);if(!a.contains(r))throw new pn(mn.INVALID_ARGUMENT,`Field '${r}' is specified in your field mask but missing from your input data.`);tu(e,r)||e.push(r)}l=new pr(e),c=a.fieldTransforms.filter(e=>l.covers(e.field))}else l=null,c=a.fieldTransforms;return new Ud(new Xr(o),l,c)}class Hd extends Od{_toFieldTransform(e){if(2!==e.Ac)throw 1===e.Ac?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Hd}}function Gd(e,t){if(Wd(e=dt(e)))return Qd("Unsupported field value:",t,e),Jd(e,t);if(e instanceof Od)return function(e,t){if(!Bd(t.Ac))throw t.Sc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Sc(`${e._methodName}() is not currently supported inside arrays`);const s=e._toFieldTransform(t);s&&t.fieldTransforms.push(s)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&4!==t.Ac)throw t.Sc("Nested arrays are not supported");return function(e,t){const s=[];let n=0;for(const r of e){let e=Gd(r,t.wc(n));null==e&&(e={nullValue:"NULL_VALUE"}),s.push(e),n++}return{arrayValue:{values:s}}}(e,t)}return function(e,t){if(null===(e=dt(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return sa(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const s=Hn.fromDate(e);return{timestampValue:no(t.serializer,s)}}if(e instanceof Hn){const s=new Hn(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:no(t.serializer,s)}}if(e instanceof Ld)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Dd)return{bytesValue:ro(t.serializer,e._byteString)};if(e instanceof jd){const s=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(s))throw t.Sc(`Document reference is for database ${n.projectId}/${n.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:oo(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof Md)return s=e,n=t,{mapValue:{fields:{[Ar]:{stringValue:Rr},[Or]:{arrayValue:{values:s.toArray().map(e=>{if("number"!=typeof e)throw n.Sc("VectorValues must only contain numeric values.");return ea(n.serializer,e)})}}}}};var s,n;throw t.Sc(`Unsupported field value: ${Vn(e)}`)}(e,t)}function Jd(e,t){const s={};return lr(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):or(e,(e,n)=>{const r=Gd(n,t.mc(e));null!=r&&(s[e]=r)}),{mapValue:{fields:s}}}function Wd(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Hn||e instanceof Ld||e instanceof Dd||e instanceof jd||e instanceof Od||e instanceof Md)}function Qd(e,t,s){if(!Wd(s)||!Un(s)){const n=Vn(s);throw"an object"===n?t.Sc(e+" a custom object"):t.Sc(e+" "+n)}}function Yd(e,t,s){if((t=dt(t))instanceof Rd)return t._internalPath;if("string"==typeof t)return Zd(e,t);throw eu("Field path arguments must be of type string or ",e,!1,void 0,s)}const Xd=new RegExp("[~\\*/\\[\\]]");function Zd(e,t,s){if(t.search(Xd)>=0)throw eu(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,s);try{return new Rd(...t.split("."))._internalPath}catch(n){throw eu(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,s)}}function eu(e,t,s,n,r){const i=n&&!n.isEmpty(),a=void 0!==r;let o=`Function ${t}() called with invalid data`;s&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(i||a)&&(l+=" (found",i&&(l+=` in field ${n}`),a&&(l+=` in document ${r}`),l+=")"),new pn(mn.INVALID_ARGUMENT,o+e+l)}function tu(e,t){return e.some(e=>e.isEqual(t))}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class su{constructor(e,t,s,n,r){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=n,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new jd(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new nu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(ru("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class nu extends su{data(){return super.data()}}function ru(e,t){return"string"==typeof t?Zd(e,t):t instanceof Rd?t._internalPath:t._delegate._internalPath}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function iu(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new pn(mn.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class au{}class ou extends au{}function lu(e,t,...s){let n=[];t instanceof au&&n.push(t),n=n.concat(s),function(e){const t=e.filter(e=>e instanceof du).length,s=e.filter(e=>e instanceof cu).length;if(t>1||t>0&&s>0)throw new pn(mn.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const r of n)e=r._apply(e);return e}class cu extends ou{constructor(e,t,s){super(),this._field=e,this._op=t,this._value=s,this.type="where"}static _create(e,t,s){return new cu(e,t,s)}_apply(e){const t=this._parse(e);return gu(e._query,t),new Nd(e.firestore,e.converter,Di(e._query,t))}_parse(e){const t=qd(e.firestore),s=function(e,t,s,n,r,i,a){let o;if(r.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new pn(mn.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){pu(a,i);const t=[];for(const s of a)t.push(mu(n,e,s));o={arrayValue:{values:t}}}else o=mu(n,e,a)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||pu(a,i),o=function(e,t,s,n=!1){return Gd(s,e.Cc(n?4:3,t))}(s,t,a,"in"===i||"not-in"===i);return oi.create(r,i,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return s}}class du extends au{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new du(e,t)}_parse(e){const t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:li.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let s=e;const n=t.getFlattenedFilters();for(const r of n)gu(s,r),s=Di(s,r)}(e._query,t),new Nd(e.firestore,e.converter,Di(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class uu extends ou{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new uu(e,t)}_apply(e){const t=function(e,t,s){if(null!==e.startAt)throw new pn(mn.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new pn(mn.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ri(t,s)}(e._query,this._field,this._direction);return new Nd(e.firestore,e.converter,function(e,t){const s=e.explicitOrderBy.concat([t]);return new Ti(e.path,e.collectionGroup,s,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class hu extends ou{constructor(e,t,s){super(),this.type=e,this._limit=t,this._limitType=s}static _create(e,t,s){return new hu(e,t,s)}_apply(e){return new Nd(e.firestore,e.converter,Ri(e._query,this._limit,this._limitType))}}function mu(e,t,s){if("string"==typeof(s=dt(s))){if(""===s)throw new pn(mn.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ci(t)&&-1!==s.indexOf("/"))throw new pn(mn.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${s}' contains a '/' character.`);const n=t.path.child(Pn.fromString(s));if(!On.isDocumentKey(n))throw new pn(mn.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return $r(e,new On(n))}if(s instanceof jd)return $r(e,s._key);throw new pn(mn.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Vn(s)}.`)}function pu(e,t){if(!Array.isArray(e)||0===e.length)throw new pn(mn.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function gu(e,t){const s=function(e,t){for(const s of e)for(const e of s.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==s)throw s===t.op?new pn(mn.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new pn(mn.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${s.toString()}' filters.`)}class fu{convertValue(e,t="none"){switch(Lr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return vr(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(br(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw cn(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return or(e,(e,n)=>{s[e]=this.convertValue(n,t)}),s}convertVectorValue(e){var t,s,n;const r=null==(n=null==(s=null==(t=e.fields)?void 0:t[Or].arrayValue)?void 0:s.values)?void 0:n.map(e=>vr(e.doubleValue));return new Md(r)}convertGeoPoint(e){return new Ld(vr(e.latitude),vr(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const s=Sr(e);return null==s?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(Tr(e));default:return null}}convertTimestamp(e){const t=yr(e);return new Hn(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=Pn.fromString(e);un(Io(s),9688,{name:e});const n=new Cr(s.get(1),s.get(3)),r=new On(s.popFirst(5));return n.isEqual(t)||an(`Document ${r} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function xu(e,t,s){let n;return n=e?e.toFirestore(t):t,n}class yu{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class vu extends su{constructor(e,t,s,n,r,i){super(e,t,s,n,i),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new bu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(ru("DocumentSnapshot.get",e));if(null!==s)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new pn(mn.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=vu._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t):t}}vu._jsonSchemaVersion="firestore/documentSnapshot/1.0",vu._jsonSchema={type:Kn("string",vu._jsonSchemaVersion),bundleSource:Kn("string","DocumentSnapshot"),bundleName:Kn("string"),bundle:Kn("string")};class bu extends vu{data(e={}){return super.data(e)}}class wu{constructor(e,t,s,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new yu(n.hasPendingWrites,n.fromCache),this.query=s}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(s=>{e.call(t,new bu(this._firestore,this._userDataWriter,s.key,s,new yu(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new pn(mn.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(s=>{const n=new bu(e._firestore,e._userDataWriter,s.doc.key,s.doc,new yu(e._snapshot.mutatedKeys.has(s.doc.key),e._snapshot.fromCache),e.query.converter);return s.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let s=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const n=new bu(e._firestore,e._userDataWriter,t.doc.key,t.doc,new yu(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let r=-1,i=-1;return 0!==t.type&&(r=s.indexOf(t.doc.key),s=s.delete(t.doc.key)),1!==t.type&&(s=s.add(t.doc),i=s.indexOf(t.doc.key)),{type:Nu(t.type),doc:n,oldIndex:r,newIndex:i}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new pn(mn.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=wu._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=kn.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],s=[],n=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),s.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),n.push(e.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Nu(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return cn(61501,{type:e})}}wu._jsonSchemaVersion="firestore/querySnapshot/1.0",wu._jsonSchema={type:Kn("string",wu._jsonSchemaVersion),bundleSource:Kn("string","QuerySnapshot"),bundleName:Kn("string"),bundle:Kn("string")};class ju extends fu{constructor(e){super(),this.firestore=e}convertBytes(e){return new Dd(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new jd(this.firestore,null,t)}}function _u(e){e=Bn(e,Nd);const t=Bn(e.firestore,Ad),s=Pd(t),n=new ju(t);return iu(e._query),function(e,t,s={}){const n=new gn;return e.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return function(e,t,s,n,r){const i=new cd({next:s=>{i.Nu(),t.enqueueAndForget(()=>_c(e,a)),s.fromCache&&"server"===n.source?r.reject(new pn(mn.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(s)},error:e=>r.reject(e)}),a=new Cc(s,i,{includeMetadataChanges:!0,qa:!0});return jc(e,a)}(yield gd(e),e.asyncQueue,t,s,n)})),n.promise}(s,e._query).then(s=>new wu(t,n,e,s))}function ku(e,t,s,...n){e=Bn(e,jd);const r=Bn(e.firestore,Ad),i=qd(r);let a;return a="string"==typeof(t=dt(t))||t instanceof Rd?function(e,t,s,n,r,i){const a=e.Cc(1,t,s),o=[Yd(t,n,s)],l=[r];if(i.length%2!=0)throw new pn(mn.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let h=0;h<i.length;h+=2)o.push(Yd(t,i[h])),l.push(i[h+1]);const c=[],d=Xr.empty();for(let h=o.length-1;h>=0;--h)if(!tu(c,o[h])){const e=o[h];let t=l[h];t=dt(t);const s=a.yc(e);if(t instanceof Hd)c.push(e);else{const n=Gd(t,s);null!=n&&(c.push(e),d.set(e,n))}}const u=new pr(c);return new Vd(d,u,a.fieldTransforms)}(i,"updateDoc",e._key,t,s,n):function(e,t,s,n){const r=e.Cc(1,t,s);Qd("Data must be an object, but it was:",r,n);const i=[],a=Xr.empty();or(n,(e,n)=>{const o=Zd(t,e,s);n=dt(n);const l=r.yc(o);if(n instanceof Hd)i.push(o);else{const e=Gd(n,l);null!=e&&(i.push(o),a.set(o,e))}});const o=new pr(i);return new Vd(a,o,r.fieldTransforms)}(i,"updateDoc",e._key,t),Tu(r,[a.toMutation(e._key,fa.exists(!0))])}function Su(e,...t){var s,n,r;e=dt(e);let i={includeMetadataChanges:!1,source:"default"},a=0;"object"!=typeof t[a]||Cd(t[a])||(i=t[a++]);const o={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Cd(t[a])){const e=t[a];t[a]=null==(s=e.next)?void 0:s.bind(e),t[a+1]=null==(n=e.error)?void 0:n.bind(e),t[a+2]=null==(r=e.complete)?void 0:r.bind(e)}let l,c,d;if(e instanceof jd)c=Bn(e.firestore,Ad),d=Ii(e._key.path),l={next:s=>{t[a]&&t[a](function(e,t,s){const n=s.docs.get(t._key),r=new ju(e);return new vu(e,r,t._key,n,new yu(s.hasPendingWrites,s.fromCache),t.converter)}(c,e,s))},error:t[a+1],complete:t[a+2]};else{const s=Bn(e,Nd);c=Bn(s.firestore,Ad),d=s._query;const n=new ju(c);l={next:e=>{t[a]&&t[a](new wu(c,n,s,e))},error:t[a+1],complete:t[a+2]},iu(e._query)}return function(e,t,s,n){const r=new cd(n),i=new Cc(t,r,s);return e.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return jc(yield gd(e),i)})),()=>{r.Nu(),e.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return _c(yield gd(e),i)}))}}(Pd(c),d,o,l)}function Tu(e,t){return function(e,t){const s=new gn;return e.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return zc(yield function(e){return pd(e).then(e=>e.syncEngine)}(e),t,s)})),s.promise}(Pd(e),t)}!function(e,t=!0){tn=Ss,ws(new ut("firestore",(e,{instanceIdentifier:s,options:n})=>{const r=e.getProvider("app").getImmediate(),i=new Ad(new vn(e.getProvider("auth-internal")),new jn(r,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new pn(mn.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Cr(e.options.projectId,t)}(r,s),r);return n=d({useFetchStreams:t},n),i._setSettings(n),i},"PUBLIC").setMultipleInstances(!0)),Es(Xs,Zs,e),Es(Xs,Zs,"esm2020")}(),
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
Es("firebase","12.4.0","app");
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const Iu="firebasestorage.googleapis.com";
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Eu extends et{constructor(e,t,s=0){super(Ru(e),`Firebase Storage: ${t} (${Ru(e)})`),this.status_=s,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Eu.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Ru(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var Cu,Au,Pu,Du;function Ru(e){return"storage/"+e}function Ou(e){return new Eu(Cu.INVALID_ARGUMENT,e)}function Lu(){return new Eu(Cu.APP_DELETED,"The Firebase app was deleted.")}(Au=Cu||(Cu={})).UNKNOWN="unknown",Au.OBJECT_NOT_FOUND="object-not-found",Au.BUCKET_NOT_FOUND="bucket-not-found",Au.PROJECT_NOT_FOUND="project-not-found",Au.QUOTA_EXCEEDED="quota-exceeded",Au.UNAUTHENTICATED="unauthenticated",Au.UNAUTHORIZED="unauthorized",Au.UNAUTHORIZED_APP="unauthorized-app",Au.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",Au.INVALID_CHECKSUM="invalid-checksum",Au.CANCELED="canceled",Au.INVALID_EVENT_NAME="invalid-event-name",Au.INVALID_URL="invalid-url",Au.INVALID_DEFAULT_BUCKET="invalid-default-bucket",Au.NO_DEFAULT_BUCKET="no-default-bucket",Au.CANNOT_SLICE_BLOB="cannot-slice-blob",Au.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",Au.NO_DOWNLOAD_URL="no-download-url",Au.INVALID_ARGUMENT="invalid-argument",Au.INVALID_ARGUMENT_COUNT="invalid-argument-count",Au.APP_DELETED="app-deleted",Au.INVALID_ROOT_OPERATION="invalid-root-operation",Au.INVALID_FORMAT="invalid-format",Au.INTERNAL_ERROR="internal-error",Au.UNSUPPORTED_ENVIRONMENT="unsupported-environment";
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Mu{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let s;try{s=Mu.makeFromUrl(e,t)}catch(r){return new Mu(e,"")}if(""===s.path)return s;throw n=e,new Eu(Cu.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.");var n}static makeFromUrl(e,t){let s=null;const n="([A-Za-z0-9.\\-_]+)",r=new RegExp("^gs://"+n+"(/(.*))?$","i");function i(e){e.path_=decodeURIComponent(e.path)}const a=t.replace(/[.]/g,"\\."),o=[{regex:r,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${a}/v[A-Za-z0-9_]+/b/${n}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:i},{regex:new RegExp(`^https?://${t===Iu?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${n}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:i}];for(let l=0;l<o.length;l++){const t=o[l],n=t.regex.exec(e);if(n){const e=n[t.indices.bucket];let r=n[t.indices.path];r||(r=""),s=new Mu(e,r),t.postModify(s);break}}if(null==s)throw function(e){return new Eu(Cu.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return s}}class Fu{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Uu(e,t,s,n){if(n<t)throw Ou(`Invalid value for '${e}'. Expected ${t} or greater.`);if(n>s)throw Ou(`Invalid value for '${e}'. Expected ${s} or less.`)}(Du=Pu||(Pu={}))[Du.NO_ERROR=0]="NO_ERROR",Du[Du.NETWORK_ERROR=1]="NETWORK_ERROR",Du[Du.ABORT=2]="ABORT";
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Vu{constructor(e,t,s,n,r,i,a,o,l,c,d,u=!0,h=!1){this.url_=e,this.method_=t,this.headers_=s,this.body_=n,this.successCodes_=r,this.additionalRetryCodes_=i,this.callback_=a,this.errorCallback_=o,this.timeout_=l,this.progressCallback_=c,this.connectionFactory_=d,this.retry=u,this.isUsingEmulator=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){const e=(e,t)=>{if(t)return void e(!1,new Bu(!1,null,!0));const s=this.connectionFactory_();this.pendingConnection_=s;const n=e=>{const t=e.loaded,s=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,s)};null!==this.progressCallback_&&s.addUploadProgressListener(n),s.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&s.removeUploadProgressListener(n),this.pendingConnection_=null;const t=s.getErrorCode()===Pu.NO_ERROR,r=s.getStatus();if(!t||
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function(e,t){const s=e>=500&&e<600,n=-1!==[408,429].indexOf(e),r=-1!==t.indexOf(e);return s||n||r}(r,this.additionalRetryCodes_)&&this.retry){const t=s.getErrorCode()===Pu.ABORT;return void e(!1,new Bu(!1,null,t))}const i=-1!==this.successCodes_.indexOf(r);e(!0,new Bu(i,s))})},t=(e,t)=>{const s=this.resolve_,n=this.reject_,r=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(r,r.getResponse());void 0!==e?s(e):s()}catch(i){n(i)}else if(null!==r){const e=new Eu(Cu.UNKNOWN,"An unknown error occurred, please check the error payload for server response.");e.serverResponse=r.getErrorText(),this.errorCallback_?n(this.errorCallback_(r,e)):n(e)}else t.canceled?n(this.appDelete_?Lu():new Eu(Cu.CANCELED,"User canceled the upload/download.")):n(new Eu(Cu.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))};this.canceled_?t(0,new Bu(!1,null,!0)):this.backoffId_=function(e,t,s){let n=1,r=null,i=null,a=!1,o=0;function l(){return 2===o}let c=!1;function d(...e){c||(c=!0,t.apply(null,e))}function u(t){r=setTimeout(()=>{r=null,e(m,l())},t)}function h(){i&&clearTimeout(i)}function m(e,...t){if(c)return void h();if(e)return h(),void d.call(null,e,...t);if(l()||a)return h(),void d.call(null,e,...t);let s;n<64&&(n*=2),1===o?(o=2,s=0):s=1e3*(n+Math.random()),u(s)}let p=!1;function g(e){p||(p=!0,h(),c||(null!==r?(e||(o=2),clearTimeout(r),u(0)):e||(o=1)))}return u(0),i=setTimeout(()=>{a=!0,g(!0)},s),g}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class Bu{constructor(e,t,s){this.wasSuccessCode=e,this.connection=t,this.canceled=!!s}}function Ku(e,t,s,n,r,i,a=!0,o=!1){const l=function(e){const t=encodeURIComponent;let s="?";for(const n in e)e.hasOwnProperty(n)&&(s=s+(t(n)+"=")+t(e[n])+"&");return s=s.slice(0,-1),s}(e.urlParams),c=e.url+l,d=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(d,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(d,s),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!=t?t:"AppManager")}(d,i),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(d,n),new Vu(c,e.method,d,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,r,a,o)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class zu{constructor(e,t){this._service=e,this._location=t instanceof Mu?t:Mu.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new zu(e,t)}get root(){const e=new Mu(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return function(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new Mu(this._location.bucket,e);return new zu(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new Eu(Cu.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function qu(e,t){const s=null==t?void 0:t.storageBucket;return null==s?null:Mu.makeFromBucketSpec(s,e)}class $u{constructor(e,t,s,n,r,i=!1){this.app=e,this._authProvider=t,this._appCheckProvider=s,this._url=n,this._firebaseVersion=r,this._isUsingEmulator=i,this._bucket=null,this._host=Iu,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=n?Mu.makeFromBucketSpec(n,this._host):qu(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=Mu.makeFromBucketSpec(this._url,e):this._bucket=qu(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Uu("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Uu("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}_getAuthToken(){return g(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=yield e.getToken();if(null!==t)return t.accessToken}return null})}_getAppCheckToken(){return g(this,null,function*(){if(js(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(yield e.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new zu(this,e)}_makeRequest(e,t,s,n,r=!0){if(this._deleted)return new Fu(Lu());{const i=Ku(e,this._appId,s,n,t,this._firebaseVersion,r,this._isUsingEmulator);return this._requests.add(i),i.getPromise().then(()=>this._requests.delete(i),()=>this._requests.delete(i)),i}}makeRequestWithTokens(e,t){return g(this,null,function*(){const[s,n]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,s,n).getPromise()})}}const Hu="@firebase/storage",Gu="0.14.0",Ju="storage";function Wu(e,{instanceIdentifier:t}){const s=e.getProvider("app").getImmediate(),n=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return new $u(s,n,r,t,Ss)}function Qu(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}ws(new ut(Ju,Wu,"PUBLIC").setMultipleInstances(!0)),Es(Hu,Gu,""),Es(Hu,Gu,"esm2020");const Yu=Qu,Xu=new tt("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Zu=new wt("@firebase/auth");function eh(e,...t){Zu.logLevel<=gt.ERROR&&Zu.error(`Auth (${Ss}): ${e}`,...t)}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function th(e,...t){throw ih(e,...t)}function sh(e,...t){return ih(e,...t)}function nh(e,t,s){const n=u(d({},Yu()),{[t]:s});return new tt("auth","Firebase",n).create(t,{appName:e.name})}function rh(e){return nh(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function ih(e,...t){if("string"!=typeof e){const s=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(s,...n)}return Xu.create(e,...t)}function ah(e,t,...s){if(!e)throw ih(t,...s)}function oh(e){const t="INTERNAL ASSERTION FAILED: "+e;throw eh(t),new Error(t)}function lh(e,t){e||oh(t)}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function ch(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.href)||""}function dh(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.protocol)||null}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function uh(){return"undefined"==typeof navigator||!navigator||!("onLine"in navigator)||"boolean"!=typeof navigator.onLine||"http:"!==dh()&&"https:"!==dh()&&!function(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()&&!("connection"in navigator)||navigator.onLine}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class hh{constructor(e,t){this.shortDelay=e,this.longDelay=t,lh(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Xe())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return uh()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function mh(e,t){lh(e.emulator,"Emulator should always be set here");const{url:s}=e.emulator;return t?`${s}${t.startsWith("/")?t.slice(1):t}`:s}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class ph{static initialize(e,t,s){this.fetchImpl=e,t&&(this.headersImpl=t),s&&(this.responseImpl=s)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void oh("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void oh("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void oh("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const gh={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},fh=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],xh=new hh(3e4,6e4);
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function yh(e,t){return e.tenantId&&!t.tenantId?u(d({},t),{tenantId:e.tenantId}):t}function vh(e,t,s,n){return g(this,arguments,function*(e,t,s,n,r={}){return bh(e,r,()=>g(this,null,function*(){let r={},i={};n&&("GET"===t?i=n:r={body:JSON.stringify(n)});const a=it(d({key:e.config.apiKey},i)).slice(1),o=yield e._getAdditionalHeaders();o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode);const l=d({method:t,headers:o},r);return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(l.referrerPolicy="no-referrer"),e.emulatorConfig&&He(e.emulatorConfig.host)&&(l.credentials="include"),ph.fetch()(yield Nh(e,e.config.apiHost,s,a),l)}))})}function bh(e,t,s){return g(this,null,function*(){e._canInitEmulator=!1;const n=d(d({},gh),t);try{const t=new _h(e),r=yield Promise.race([s(),t.promise]);t.clearNetworkTimeout();const i=yield r.json();if("needConfirmation"in i)throw kh(e,"account-exists-with-different-credential",i);if(r.ok&&!("errorMessage"in i))return i;{const t=r.ok?i.errorMessage:i.error.message,[s,a]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===s)throw kh(e,"credential-already-in-use",i);if("EMAIL_EXISTS"===s)throw kh(e,"email-already-in-use",i);if("USER_DISABLED"===s)throw kh(e,"user-disabled",i);const o=n[s]||s.toLowerCase().replace(/[_\s]+/g,"-");if(a)throw nh(e,o,a);th(e,o)}}catch(r){if(r instanceof et)throw r;th(e,"network-request-failed",{message:String(r)})}})}function wh(e,t,s,n){return g(this,arguments,function*(e,t,s,n,r={}){const i=yield vh(e,t,s,n,r);return"mfaPendingCredential"in i&&th(e,"multi-factor-auth-required",{_serverResponse:i}),i})}function Nh(e,t,s,n){return g(this,null,function*(){const r=`${t}${s}?${n}`,i=e,a=i.config.emulator?mh(e.config,r):`${e.config.apiScheme}://${r}`;return fh.includes(s)&&(yield i._persistenceManagerAvailable,"COOKIE"===i._getPersistenceType())?i._getPersistence()._getFinalTarget(a).toString():a})}function jh(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class _h{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(sh(this.auth,"network-request-failed")),xh.get())})}}function kh(e,t,s){const n={appName:e.name};s.email&&(n.email=s.email),s.phoneNumber&&(n.phoneNumber=s.phoneNumber);const r=sh(e,t,n);return r.customData._tokenResponse=s,r}function Sh(e){return void 0!==e&&void 0!==e.enterprise}class Th{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return jh(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}function Ih(e,t){return g(this,null,function*(){return vh(e,"POST","/v1/accounts:lookup",t)})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Eh(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function Ch(e){return 1e3*Number(e)}function Ah(e){const[t,s,n]=e.split(".");if(void 0===t||void 0===s||void 0===n)return eh("JWT malformed, contained fewer than 3 sections"),null;try{const e=Fe(s);return e?JSON.parse(e):(eh("Failed to decode base64 JWT payload"),null)}catch(r){return eh("Caught error parsing JWT payload as JSON",null==r?void 0:r.toString()),null}}function Ph(e){const t=Ah(e);return ah(t,"internal-error"),ah(void 0!==t.exp,"internal-error"),ah(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Dh(e,t,s=!1){return g(this,null,function*(){if(s)return t;try{return yield t}catch(n){throw n instanceof et&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(n)&&e.auth.currentUser===e&&(yield e.auth.signOut()),n}})}class Rh{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!=(t=this.user.stsTokenManager.expirationTime)?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(()=>g(this,null,function*(){yield this.iteration()}),t)}iteration(){return g(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()})}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Oh{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Eh(this.lastLoginAt),this.creationTime=Eh(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Lh(e){return g(this,null,function*(){var t;const s=e.auth,n=yield e.getIdToken(),r=yield Dh(e,Ih(s,{idToken:n}));ah(null==r?void 0:r.users.length,s,"internal-error");const i=r.users[0];e._notifyReloadListener(i);const a=(null==(t=i.providerUserInfo)?void 0:t.length)?Mh(i.providerUserInfo):[],o=(l=e.providerData,c=a,[...l.filter(e=>!c.some(t=>t.providerId===e.providerId)),...c]);var l,c;const d=e.isAnonymous,u=!(e.email&&i.passwordHash||(null==o?void 0:o.length)),h=!!d&&u,m={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new Oh(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(e,m)})}function Mh(e){return e.map(e=>{var t=e,{providerId:s}=t,n=h(t,["providerId"]);return{providerId:s,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Fh{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ah(e.idToken,"internal-error"),ah(void 0!==e.idToken,"internal-error"),ah(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):Ph(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){ah(0!==e.length,"internal-error");const t=Ph(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return g(this,null,function*(){return t||!this.accessToken||this.isExpired?(ah(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return g(this,null,function*(){const{accessToken:s,refreshToken:n,expiresIn:r}=yield function(e,t){return g(this,null,function*(){const s=yield bh(e,{},()=>g(this,null,function*(){const s=it({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:r}=e.config,i=yield Nh(e,n,"/v1/token",`key=${r}`),a=yield e._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const o={method:"POST",headers:a,body:s};return e.emulatorConfig&&He(e.emulatorConfig.host)&&(o.credentials="include"),ph.fetch()(i,o)}));return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}})}(e,t);this.updateTokensAndExpiration(s,n,Number(r))})}updateTokensAndExpiration(e,t,s){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*s}static fromJSON(e,t){const{refreshToken:s,accessToken:n,expirationTime:r}=t,i=new Fh;return s&&(ah("string"==typeof s,"internal-error",{appName:e}),i.refreshToken=s),n&&(ah("string"==typeof n,"internal-error",{appName:e}),i.accessToken=n),r&&(ah("number"==typeof r,"internal-error",{appName:e}),i.expirationTime=r),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Fh,this.toJSON())}_performRefresh(){return oh("not implemented")}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Uh(e,t){ah("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Vh{constructor(e){var t=e,{uid:s,auth:n,stsTokenManager:r}=t,i=h(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Rh(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=s,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Oh(i.createdAt||void 0,i.lastLoginAt||void 0)}getIdToken(e){return g(this,null,function*(){const t=yield Dh(this,this.stsTokenManager.getToken(this.auth,e));return ah(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return function(e,t=!1){return g(this,null,function*(){const s=dt(e),n=yield s.getIdToken(t),r=Ah(n);ah(r&&r.exp&&r.auth_time&&r.iat,s.auth,"internal-error");const i="object"==typeof r.firebase?r.firebase:void 0,a=null==i?void 0:i.sign_in_provider;return{claims:r,token:n,authTime:Eh(Ch(r.auth_time)),issuedAtTime:Eh(Ch(r.iat)),expirationTime:Eh(Ch(r.exp)),signInProvider:a||null,signInSecondFactor:(null==i?void 0:i.sign_in_second_factor)||null}})}(this,e)}reload(){return function(e){return g(this,null,function*(){const t=dt(e);yield Lh(t),yield t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)})}(this)}_assign(e){this!==e&&(ah(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>d({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Vh(u(d({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){ah(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return g(this,null,function*(){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),t&&(yield Lh(this)),yield this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)})}delete(){return g(this,null,function*(){if(js(this.auth.app))return Promise.reject(rh(this.auth));const e=yield this.getIdToken();return yield Dh(this,
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function(e,t){return g(this,null,function*(){return vh(e,"POST","/v1/accounts:delete",t)})}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return u(d({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>d({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var s,n,r,i,a,o,l,c;const u=null!=(s=t.displayName)?s:void 0,h=null!=(n=t.email)?n:void 0,m=null!=(r=t.phoneNumber)?r:void 0,p=null!=(i=t.photoURL)?i:void 0,g=null!=(a=t.tenantId)?a:void 0,f=null!=(o=t._redirectEventId)?o:void 0,x=null!=(l=t.createdAt)?l:void 0,y=null!=(c=t.lastLoginAt)?c:void 0,{uid:v,emailVerified:b,isAnonymous:w,providerData:N,stsTokenManager:j}=t;ah(v&&j,e,"internal-error");const _=Fh.fromJSON(this.name,j);ah("string"==typeof v,e,"internal-error"),Uh(u,e.name),Uh(h,e.name),ah("boolean"==typeof b,e,"internal-error"),ah("boolean"==typeof w,e,"internal-error"),Uh(m,e.name),Uh(p,e.name),Uh(g,e.name),Uh(f,e.name),Uh(x,e.name),Uh(y,e.name);const k=new Vh({uid:v,auth:e,email:h,emailVerified:b,displayName:u,isAnonymous:w,photoURL:p,phoneNumber:m,tenantId:g,stsTokenManager:_,createdAt:x,lastLoginAt:y});return N&&Array.isArray(N)&&(k.providerData=N.map(e=>d({},e))),f&&(k._redirectEventId=f),k}static _fromIdTokenResponse(e,t,s=!1){return g(this,null,function*(){const n=new Fh;n.updateFromServerResponse(t);const r=new Vh({uid:t.localId,auth:e,stsTokenManager:n,isAnonymous:s});return yield Lh(r),r})}static _fromGetAccountInfoResponse(e,t,s){return g(this,null,function*(){const n=t.users[0];ah(void 0!==n.localId,"internal-error");const r=void 0!==n.providerUserInfo?Mh(n.providerUserInfo):[],i=!(n.email&&n.passwordHash||(null==r?void 0:r.length)),a=new Fh;a.updateFromIdToken(s);const o=new Vh({uid:n.localId,auth:e,stsTokenManager:a,isAnonymous:i}),l={uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:r,metadata:new Oh(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash||(null==r?void 0:r.length))};return Object.assign(o,l),o})}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Bh=new Map;function Kh(e){lh(e instanceof Function,"Expected a class definition");let t=Bh.get(e);return t?(lh(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Bh.set(e,t),t)}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class zh{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return g(this,null,function*(){return!0})}_set(e,t){return g(this,null,function*(){this.storage[e]=t})}_get(e){return g(this,null,function*(){const t=this.storage[e];return void 0===t?null:t})}_remove(e){return g(this,null,function*(){delete this.storage[e]})}_addListener(e,t){}_removeListener(e,t){}}zh.type="NONE";const qh=zh;
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function $h(e,t,s){return`firebase:${e}:${t}:${s}`}class Hh{constructor(e,t,s){this.persistence=e,this.auth=t,this.userKey=s;const{config:n,name:r}=this.auth;this.fullUserKey=$h(this.userKey,n.apiKey,r),this.fullPersistenceKey=$h("persistence",n.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return g(this,null,function*(){const e=yield this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){const t=yield Ih(this.auth,{idToken:e}).catch(()=>{});return t?Vh._fromGetAccountInfoResponse(this.auth,t,e):null}return Vh._fromJSON(this.auth,e)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return g(this,null,function*(){if(this.persistence===e)return;const t=yield this.getCurrentUser();return yield this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,s="authUser"){return g(this,null,function*(){if(!t.length)return new Hh(Kh(qh),e,s);const n=(yield Promise.all(t.map(e=>g(this,null,function*(){if(yield e._isAvailable())return e})))).filter(e=>e);let r=n[0]||Kh(qh);const i=$h(s,e.config.apiKey,e.name);let a=null;for(const s of t)try{const t=yield s._get(i);if(t){let n;if("string"==typeof t){const s=yield Ih(e,{idToken:t}).catch(()=>{});if(!s)break;n=yield Vh._fromGetAccountInfoResponse(e,s,t)}else n=Vh._fromJSON(e,t);s!==r&&(a=n),r=s;break}}catch(l){}const o=n.filter(e=>e._shouldAllowMigration);return r._shouldAllowMigration&&o.length?(r=o[0],a&&(yield r._set(i,a.toJSON())),yield Promise.all(t.map(e=>g(this,null,function*(){if(e!==r)try{yield e._remove(i)}catch(l){}}))),new Hh(r,e,s)):new Hh(r,e,s)})}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Gh(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Yh(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Jh(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Zh(t))return"Blackberry";if(em(t))return"Webos";if(Wh(t))return"Safari";if((t.includes("chrome/")||Qh(t))&&!t.includes("edge/"))return"Chrome";if(Xh(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=e.match(t);if(2===(null==s?void 0:s.length))return s[1]}return"Other"}function Jh(e=Xe()){return/firefox\//i.test(e)}function Wh(e=Xe()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Qh(e=Xe()){return/crios\//i.test(e)}function Yh(e=Xe()){return/iemobile/i.test(e)}function Xh(e=Xe()){return/android/i.test(e)}function Zh(e=Xe()){return/blackberry/i.test(e)}function em(e=Xe()){return/webos/i.test(e)}function tm(e=Xe()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function sm(){return function(){const e=Xe();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()&&10===document.documentMode}function nm(e=Xe()){return tm(e)||Xh(e)||em(e)||Zh(e)||/windows phone/i.test(e)||Yh(e)}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function rm(e,t=[]){let s;switch(e){case"Browser":s=Gh(Xe());break;case"Worker":s=`${Gh(Xe())}-${e}`;break;default:s=e}const n=t.length?t.join(","):"FirebaseCore-web";return`${s}/JsCore/${Ss}/${n}`}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class im{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const s=t=>new Promise((s,n)=>{try{s(e(t))}catch(r){n(r)}});s.onAbort=t,this.queue.push(s);const n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}runMiddleware(e){return g(this,null,function*(){if(this.auth.currentUser===e)return;const t=[];try{for(const s of this.queue)yield s(e),s.onAbort&&t.push(s.onAbort)}catch(s){t.reverse();for(const e of t)try{e()}catch(n){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==s?void 0:s.message})}})}}
/**
     * @license
     * Copyright 2023 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class am{constructor(e){var t,s,n,r;const i=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!=(t=i.minPasswordLength)?t:6,i.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=i.maxPasswordLength),void 0!==i.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=i.containsLowercaseCharacter),void 0!==i.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=i.containsUppercaseCharacter),void 0!==i.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=i.containsNumericCharacter),void 0!==i.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=i.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!=(n=null==(s=e.allowedNonAlphanumericCharacters)?void 0:s.join(""))?n:"",this.forceUpgradeOnSignin=null!=(r=e.forceUpgradeOnSignin)&&r,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,s,n,r,i,a;const o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=null==(t=o.meetsMinPasswordLength)||t),o.isValid&&(o.isValid=null==(s=o.meetsMaxPasswordLength)||s),o.isValid&&(o.isValid=null==(n=o.containsLowercaseLetter)||n),o.isValid&&(o.isValid=null==(r=o.containsUppercaseLetter)||r),o.isValid&&(o.isValid=null==(i=o.containsNumericCharacter)||i),o.isValid&&(o.isValid=null==(a=o.containsNonAlphanumericCharacter)||a),o}validatePasswordLengthOptions(e,t){const s=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;s&&(t.meetsMinPasswordLength=e.length>=s),n&&(t.meetsMaxPasswordLength=e.length<=n)}validatePasswordCharacterOptions(e,t){let s;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let n=0;n<e.length;n++)s=e.charAt(n),this.updatePasswordCharacterOptionsStatuses(t,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,t,s,n,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class om{constructor(e,t,s,n){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=s,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new cm(this),this.idTokenSubscription=new cm(this),this.beforeStateQueue=new im(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Xu,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Kh(t)),this._initializationPromise=this.queue(()=>g(this,null,function*(){var s,n,r;if(!this._deleted&&(this.persistenceManager=yield Hh.create(this,e),null==(s=this._resolvePersistenceManagerAvailable)||s.call(this),!this._deleted)){if(null==(n=this._popupRedirectResolver)?void 0:n._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch(i){}yield this.initializeCurrentUser(t),this.lastNotifiedUid=(null==(r=this.currentUser)?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return g(this,null,function*(){if(this._deleted)return;const e=yield this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void(yield this.currentUser.getIdToken())):void(yield this._updateCurrentUser(e,!0)):void 0})}initializeCurrentUserFromIdToken(e){return g(this,null,function*(){try{const t=yield Ih(this,{idToken:e}),s=yield Vh._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(s)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return g(this,null,function*(){var t;if(js(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const s=yield this.assertedPersistence.getCurrentUser();let n=s,r=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();const s=null==(t=this.redirectUser)?void 0:t._redirectEventId,i=null==n?void 0:n._redirectEventId,a=yield this.tryRedirectSignIn(e);s&&s!==i||!(null==a?void 0:a.user)||(n=a.user,r=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(r)try{yield this.beforeStateQueue.runMiddleware(n)}catch(i){n=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(i))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return ah(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)})}tryRedirectSignIn(e){return g(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(s){yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return g(this,null,function*(){try{yield Lh(e)}catch(t){if("auth/network-request-failed"!==(null==t?void 0:t.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}_delete(){return g(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return g(this,null,function*(){if(js(this.app))return Promise.reject(rh(this));const t=e?dt(e):null;return t&&ah(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return g(this,null,function*(){if(!this._deleted)return e&&ah(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>g(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return g(this,null,function*(){return js(this.app)?Promise.reject(rh(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return js(this.app)?Promise.reject(rh(this)):this.queue(()=>g(this,null,function*(){yield this.assertedPersistence.setPersistence(Kh(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return g(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return g(this,null,function*(){const e=yield function(e){return g(this,arguments,function*(e,t={}){return vh(e,"GET","/v2/passwordPolicy",yh(e,t))})}
/**
     * @license
     * Copyright 2023 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(this),t=new am(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new tt("auth","Firebase",e())}onAuthStateChanged(e,t,s){return this.registerStateListener(this.authStateSubscription,e,t,s)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,s){return this.registerStateListener(this.idTokenSubscription,e,t,s)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},t)}})}revokeAccessToken(e){return g(this,null,function*(){if(this.currentUser){const t=yield this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};null!=this.tenantId&&(s.tenantId=this.tenantId),yield function(e,t){return g(this,null,function*(){return vh(e,"POST","/v2/accounts:revokeToken",yh(e,t))})}(this,s)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null==(e=this._currentUser)?void 0:e.toJSON()}}_setRedirectUser(e,t){return g(this,null,function*(){const s=yield this.getOrInitRedirectPersistenceManager(t);return null===e?s.removeCurrentUser():s.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return g(this,null,function*(){if(!this.redirectPersistenceManager){const t=e&&Kh(e)||this._popupRedirectResolver;ah(t,this,"argument-error"),this.redirectPersistenceManager=yield Hh.create(this,[Kh(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return g(this,null,function*(){var t,s;return this._isInitialized&&(yield this.queue(()=>g(this,null,function*(){}))),(null==(t=this._currentUser)?void 0:t._redirectEventId)===e?this._currentUser:(null==(s=this.redirectUser)?void 0:s._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return g(this,null,function*(){if(e===this.currentUser)return this.queue(()=>g(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const s=null!=(t=null==(e=this.currentUser)?void 0:e.uid)?t:null;this.lastNotifiedUid!==s&&(this.lastNotifiedUid=s,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,s,n){if(this._deleted)return()=>{};const r="function"==typeof t?t:t.next.bind(t);let i=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(ah(a,this,"internal-error"),a.then(()=>{i||r(this.currentUser)}),"function"==typeof t){const r=e.addObserver(t,s,n);return()=>{i=!0,r()}}{const s=e.addObserver(t);return()=>{i=!0,s()}}}directlySetCurrentUser(e){return g(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ah(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=rm(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return g(this,null,function*(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const s=yield null==(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))?void 0:e.getHeartbeatsHeader();s&&(t["X-Firebase-Client"]=s);const n=yield this._getAppCheckToken();return n&&(t["X-Firebase-AppCheck"]=n),t})}_getAppCheckToken(){return g(this,null,function*(){var e;if(js(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=yield null==(e=this.appCheckServiceProvider.getImmediate({optional:!0}))?void 0:e.getToken();return(null==t?void 0:t.error)&&function(e,...t){Zu.logLevel<=gt.WARN&&Zu.warn(`Auth (${Ss}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token})}}function lm(e){return dt(e)}class cm{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const s=new lt(e,t);return s.subscribe.bind(s)}(e=>this.observer=e)}get next(){return ah(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */let dm={loadJS(){return g(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function um(e){return dm.loadJS(e)}class hm{constructor(){this.enterprise=new mm}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class mm{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const pm="NO_RECAPTCHA";class gm{constructor(e){this.type="recaptcha-enterprise",this.auth=lm(e)}verify(e="verify",t=!1){return g(this,null,function*(){function s(e){return g(this,null,function*(){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((t,s)=>g(this,null,function*(){(function(e,t){return g(this,null,function*(){return vh(e,"GET","/v2/recaptchaConfig",yh(e,t))})})(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(n=>{if(void 0!==n.recaptchaKey){const s=new Th(n);return null==e.tenantId?e._agentRecaptchaConfig=s:e._tenantRecaptchaConfigs[e.tenantId]=s,t(s.siteKey)}s(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{s(e)})}))})}function n(t,s,n){const r=window.grecaptcha;Sh(r)?r.enterprise.ready(()=>{r.enterprise.execute(t,{action:e}).then(e=>{s(e)}).catch(()=>{s(pm)})}):n(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?(new hm).execute("siteKey",{action:"verify"}):new Promise((e,r)=>{s(this.auth).then(s=>{if(!t&&Sh(window.grecaptcha))n(s,e,r);else{if("undefined"==typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=dm.recaptchaEnterpriseScript;0!==t.length&&(t+=s),um(t).then(()=>{n(s,e,r)}).catch(e=>{r(e)})}}).catch(e=>{r(e)})})})}}function fm(e,t,s,n=!1,r=!1){return g(this,null,function*(){const i=new gm(e);let a;if(r)a=pm;else try{a=yield i.verify(s)}catch(l){a=yield i.verify(s,!0)}const o=d({},t);if("mfaSmsEnrollment"===s||"mfaSmsSignIn"===s){if("phoneEnrollmentInfo"in o){const e=o.phoneEnrollmentInfo.phoneNumber,t=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){const e=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return n?Object.assign(o,{captchaResp:a}):Object.assign(o,{captchaResponse:a}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o})}function xm(e,t,s,n,r){return g(this,null,function*(){var r;if(null==(r=e._getRecaptchaConfig())?void 0:r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const r=yield fm(e,t,s,"getOobCode"===s);return n(e,r)}return n(e,t).catch(r=>g(this,null,function*(){if("auth/missing-recaptcha-token"===r.code){console.log(`${s} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const r=yield fm(e,t,s,"getOobCode"===s);return n(e,r)}return Promise.reject(r)}))})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function ym(e,t,s){const n=lm(e);ah(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");const r=vm(t),{host:i,port:a}=function(e){const t=vm(e),s=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!s)return{host:"",port:null};const n=s[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(n);if(r){const e=r[1];return{host:e,port:bm(n.substr(e.length+1))}}{const[e,t]=n.split(":");return{host:e,port:bm(t)}}}(t),o=null===a?"":`:${a}`,l={url:`${r}//${i}${o}/`},c=Object.freeze({host:i,port:a,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!n._canInitEmulator)return ah(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),void ah(nt(l,n.config.emulator)&&nt(c,n.emulatorConfig),n,"emulator-config-failed");n.config.emulator=l,n.emulatorConfig=c,n.settings.appVerificationDisabledForTesting=!0,He(i)?(Ge(`${r}//${i}${o}`),Ye("Auth",!0)):function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */()}function vm(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function bm(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class wm{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return oh("not implemented")}_getIdTokenResponse(e){return oh("not implemented")}_linkToIdToken(e,t){return oh("not implemented")}_getReauthenticationResolver(e){return oh("not implemented")}}function Nm(e,t){return g(this,null,function*(){return vh(e,"POST","/v1/accounts:signUp",t)})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function jm(e,t){return g(this,null,function*(){return wh(e,"POST","/v1/accounts:signInWithPassword",yh(e,t))})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class _m extends wm{constructor(e,t,s,n=null){super("password",s),this._email=e,this._password=t,this._tenantId=n}static _fromEmailAndPassword(e,t){return new _m(e,t,"password")}static _fromEmailAndCode(e,t,s=null){return new _m(e,t,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){return g(this,null,function*(){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return xm(e,t,"signInWithPassword",jm);case"emailLink":return function(e,t){return g(this,null,function*(){return wh(e,"POST","/v1/accounts:signInWithEmailLink",yh(e,t))})}(e,{email:this._email,oobCode:this._password});default:th(e,"internal-error")}})}_linkToIdToken(e,t){return g(this,null,function*(){switch(this.signInMethod){case"password":const s={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return xm(e,s,"signUpPassword",Nm);case"emailLink":return function(e,t){return g(this,null,function*(){return wh(e,"POST","/v1/accounts:signInWithEmailLink",yh(e,t))})}(e,{idToken:t,email:this._email,oobCode:this._password});default:th(e,"internal-error")}})}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function km(e,t){return g(this,null,function*(){return wh(e,"POST","/v1/accounts:signInWithIdp",yh(e,t))})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Sm extends wm{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Sm(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):th("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:s,signInMethod:n}=t,r=h(t,["providerId","signInMethod"]);if(!s||!n)return null;const i=new Sm(s,n);return i.idToken=r.idToken||void 0,i.accessToken=r.accessToken||void 0,i.secret=r.secret,i.nonce=r.nonce,i.pendingToken=r.pendingToken||null,i}_getIdTokenResponse(e){return km(e,this.buildRequest())}_linkToIdToken(e,t){const s=this.buildRequest();return s.idToken=t,km(e,s)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,km(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=it(t)}return e}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Tm{constructor(e){var t,s,n,r,i,a;const o=at(ot(e)),l=null!=(t=o.apiKey)?t:null,c=null!=(s=o.oobCode)?s:null,d=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!=(n=o.mode)?n:null);ah(l&&c&&d,"argument-error"),this.apiKey=l,this.operation=d,this.code=c,this.continueUrl=null!=(r=o.continueUrl)?r:null,this.languageCode=null!=(i=o.lang)?i:null,this.tenantId=null!=(a=o.tenantId)?a:null}static parseLink(e){const t=function(e){const t=at(ot(e)).link,s=t?at(ot(t)).deep_link_id:null,n=at(ot(e)).deep_link_id;return(n?at(ot(n)).link:null)||n||s||t||e}(e);try{return new Tm(t)}catch(s){return null}}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Im{constructor(){this.providerId=Im.PROVIDER_ID}static credential(e,t){return _m._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const s=Tm.parseLink(t);return ah(s,"argument-error"),_m._fromEmailAndCode(e,s.code,s.tenantId)}}Im.PROVIDER_ID="password",Im.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Im.EMAIL_LINK_SIGN_IN_METHOD="emailLink";
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Em{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Cm extends Em{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Am extends Cm{constructor(){super("facebook.com")}static credential(e){return Sm._fromParams({providerId:Am.PROVIDER_ID,signInMethod:Am.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Am.credentialFromTaggedObject(e)}static credentialFromError(e){return Am.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Am.credential(e.oauthAccessToken)}catch(t){return null}}}Am.FACEBOOK_SIGN_IN_METHOD="facebook.com",Am.PROVIDER_ID="facebook.com";
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Pm extends Cm{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Sm._fromParams({providerId:Pm.PROVIDER_ID,signInMethod:Pm.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Pm.credentialFromTaggedObject(e)}static credentialFromError(e){return Pm.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:s}=e;if(!t&&!s)return null;try{return Pm.credential(t,s)}catch(n){return null}}}Pm.GOOGLE_SIGN_IN_METHOD="google.com",Pm.PROVIDER_ID="google.com";
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Dm extends Cm{constructor(){super("github.com")}static credential(e){return Sm._fromParams({providerId:Dm.PROVIDER_ID,signInMethod:Dm.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Dm.credentialFromTaggedObject(e)}static credentialFromError(e){return Dm.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Dm.credential(e.oauthAccessToken)}catch(t){return null}}}Dm.GITHUB_SIGN_IN_METHOD="github.com",Dm.PROVIDER_ID="github.com";
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Rm extends Cm{constructor(){super("twitter.com")}static credential(e,t){return Sm._fromParams({providerId:Rm.PROVIDER_ID,signInMethod:Rm.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Rm.credentialFromTaggedObject(e)}static credentialFromError(e){return Rm.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:s}=e;if(!t||!s)return null;try{return Rm.credential(t,s)}catch(n){return null}}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function Om(e,t){return g(this,null,function*(){return wh(e,"POST","/v1/accounts:signUp",yh(e,t))})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */Rm.TWITTER_SIGN_IN_METHOD="twitter.com",Rm.PROVIDER_ID="twitter.com";class Lm{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,s,n=!1){return g(this,null,function*(){const r=yield Vh._fromIdTokenResponse(e,s,n),i=Mm(s);return new Lm({user:r,providerId:i,_tokenResponse:s,operationType:t})})}static _forOperation(e,t,s){return g(this,null,function*(){yield e._updateTokensIfNecessary(s,!0);const n=Mm(s);return new Lm({user:e,providerId:n,_tokenResponse:s,operationType:t})})}}function Mm(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Fm extends et{constructor(e,t,s,n){var r;super(t.code,t.message),this.operationType=s,this.user=n,Object.setPrototypeOf(this,Fm.prototype),this.customData={appName:e.name,tenantId:null!=(r=e.tenantId)?r:void 0,_serverResponse:t.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,t,s,n){return new Fm(e,t,s,n)}}function Um(e,t,s,n){return("reauthenticate"===t?s._getReauthenticationResolver(e):s._getIdTokenResponse(e)).catch(s=>{if("auth/multi-factor-auth-required"===s.code)throw Fm._fromErrorAndOperation(e,s,t,n);throw s})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function Vm(e,t,s=!1){return g(this,null,function*(){if(js(e.app))return Promise.reject(rh(e));const n="signIn",r=yield Um(e,n,t),i=yield Lm._fromIdTokenResponse(e,n,r);return s||(yield e._updateCurrentUser(i.user)),i})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function Bm(e){return g(this,null,function*(){const t=lm(e);t._getPasswordPolicyInternal()&&(yield t._updatePasswordPolicy())})}function Km(e,t,s){return js(e.app)?Promise.reject(rh(e)):function(e,t){return g(this,null,function*(){return Vm(lm(e),t)})}(dt(e),Im.credential(t,s)).catch(t=>g(this,null,function*(){throw"auth/password-does-not-meet-requirements"===t.code&&Bm(e),t}))}const zm="__sak";
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class qm{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(zm,"1"),this.storage.removeItem(zm),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class $m extends qm{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=nm(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const s=this.storage.getItem(t),n=this.localCache[t];s!==n&&e(t,n,s)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,s)=>{this.notifyListeners(e,s)});const s=e.key;t?this.detachListener():this.stopPolling();const n=()=>{const e=this.storage.getItem(s);(t||this.localCache[s]!==e)&&this.notifyListeners(s,e)},r=this.storage.getItem(s);sm()&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(n,10):n()}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const n of Array.from(s))n(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:s}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(e,t){return g(this,null,function*(){yield p($m.prototype,this,"_set").call(this,e,t),this.localCache[e]=JSON.stringify(t)})}_get(e){return g(this,null,function*(){const t=yield p($m.prototype,this,"_get").call(this,e);return this.localCache[e]=JSON.stringify(t),t})}_remove(e){return g(this,null,function*(){yield p($m.prototype,this,"_remove").call(this,e),delete this.localCache[e]})}}$m.type="LOCAL";const Hm=$m;
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Gm extends qm{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Gm.type="SESSION";const Jm=Gm;
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Wm{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const s=new Wm(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}handleEvent(e){return g(this,null,function*(){const t=e,{eventId:s,eventType:n,data:r}=t.data,i=this.handlersMap[n];if(!(null==i?void 0:i.size))return;t.ports[0].postMessage({status:"ack",eventId:s,eventType:n});const a=Array.from(i).map(e=>g(this,null,function*(){return e(t.origin,r)})),o=yield function(e){return Promise.all(e.map(e=>g(this,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}(a);t.ports[0].postMessage({status:"done",eventId:s,eventType:n,response:o})})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function Qm(e="",t=10){let s="";for(let n=0;n<t;n++)s+=Math.floor(10*Math.random());return e+s}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */Wm.receivers=[];class Ym{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,s=50){return g(this,null,function*(){const n="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!n)throw new Error("connection_unavailable");let r,i;return new Promise((a,o)=>{const l=Qm("",20);n.port1.start();const c=setTimeout(()=>{o(new Error("unsupported_event"))},s);i={messageChannel:n,onMessage(e){const t=e;if(t.data.eventId===l)switch(t.data.status){case"ack":clearTimeout(c),r=setTimeout(()=>{o(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),a(t.data.response);break;default:clearTimeout(c),clearTimeout(r),o(new Error("invalid_response"))}}},this.handlers.add(i),n.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[n.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})})}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Xm(){return window}
/**
     * @license
     * Copyright 2020 Google LLC.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function Zm(){return void 0!==Xm().WorkerGlobalScope&&"function"==typeof Xm().importScripts}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const ep="firebaseLocalStorageDb",tp="firebaseLocalStorage",sp="fbase_key";class np{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function rp(e,t){return e.transaction([tp],t?"readwrite":"readonly").objectStore(tp)}function ip(){const e=indexedDB.open(ep,1);return new Promise((t,s)=>{e.addEventListener("error",()=>{s(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(tp,{keyPath:sp})}catch(n){s(n)}}),e.addEventListener("success",()=>g(this,null,function*(){const s=e.result;s.objectStoreNames.contains(tp)?t(s):(s.close(),yield function(){const e=indexedDB.deleteDatabase(ep);return new np(e).toPromise()}(),t(yield ip()))}))})}function ap(e,t,s){return g(this,null,function*(){const n=rp(e,!0).put({[sp]:t,value:s});return new np(n).toPromise()})}function op(e,t){const s=rp(e,!0).delete(t);return new np(s).toPromise()}class lp{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return g(this,null,function*(){return this.db||(this.db=yield ip()),this.db})}_withRetries(e){return g(this,null,function*(){let t=0;for(;;)try{const t=yield this._openDb();return yield e(t)}catch(s){if(t++>3)throw s;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return g(this,null,function*(){return Zm()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return g(this,null,function*(){this.receiver=Wm._getInstance(Zm()?self:null),this.receiver._subscribe("keyChanged",(e,t)=>g(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(t.key)}})),this.receiver._subscribe("ping",(e,t)=>g(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return g(this,null,function*(){var e,t;if(this.activeServiceWorker=yield function(){return g(this,null,function*(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(yield navigator.serviceWorker.ready).active}catch(e){return null}})}(),!this.activeServiceWorker)return;this.sender=new Ym(this.activeServiceWorker);const s=yield this.sender._send("ping",{},800);s&&(null==(e=s[0])?void 0:e.fulfilled)&&(null==(t=s[0])?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(e){return g(this,null,function*(){var t;if(this.sender&&this.activeServiceWorker&&((null==(t=null==navigator?void 0:navigator.serviceWorker)?void 0:t.controller)||null)===this.activeServiceWorker)try{yield this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(s){}})}_isAvailable(){return g(this,null,function*(){try{if(!indexedDB)return!1;const e=yield ip();return yield ap(e,zm,"1"),yield op(e,zm),!0}catch(e){}return!1})}_withPendingWrite(e){return g(this,null,function*(){this.pendingWrites++;try{yield e()}finally{this.pendingWrites--}})}_set(e,t){return g(this,null,function*(){return this._withPendingWrite(()=>g(this,null,function*(){return yield this._withRetries(s=>ap(s,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)}))})}_get(e){return g(this,null,function*(){const t=yield this._withRetries(t=>function(e,t){return g(this,null,function*(){const s=rp(e,!1).get(t),n=yield new np(s).toPromise();return void 0===n?null:n.value})}(t,e));return this.localCache[e]=t,t})}_remove(e){return g(this,null,function*(){return this._withPendingWrite(()=>g(this,null,function*(){return yield this._withRetries(t=>op(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)}))})}_poll(){return g(this,null,function*(){const e=yield this._withRetries(e=>{const t=rp(e,!1).getAll();return new np(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],s=new Set;if(0!==e.length)for(const{fbase_key:n,value:r}of e)s.add(n),JSON.stringify(this.localCache[n])!==JSON.stringify(r)&&(this.notifyListeners(n,r),t.push(n));for(const n of Object.keys(this.localCache))this.localCache[n]&&!s.has(n)&&(this.notifyListeners(n,null),t.push(n));return t})}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const n of Array.from(s))n(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>g(this,null,function*(){return this._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}lp.type="LOCAL";const cp=lp;new hh(3e4,6e4);
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class dp extends wm{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return km(e,this._buildIdpRequest())}_linkToIdToken(e,t){return km(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return km(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function up(e){return Vm(e.auth,new dp(e),e.bypassAuthState)}function hp(e){const{auth:t,user:s}=e;return ah(s,t,"internal-error"),
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function(e,t,s=!1){return g(this,null,function*(){const{auth:n}=e;if(js(n.app))return Promise.reject(rh(n));const r="reauthenticate";try{const i=yield Dh(e,Um(n,r,t,e),s);ah(i.idToken,n,"internal-error");const a=Ah(i.idToken);ah(a,n,"internal-error");const{sub:o}=a;return ah(e.uid===o,n,"user-mismatch"),Lm._forOperation(e,r,i)}catch(i){throw"auth/user-not-found"===(null==i?void 0:i.code)&&th(n,"user-mismatch"),i}})}(s,new dp(e),e.bypassAuthState)}function mp(e){return g(this,null,function*(){const{auth:t,user:s}=e;return ah(s,t,"internal-error"),function(e,t,s=!1){return g(this,null,function*(){const n=yield Dh(e,t._linkToIdToken(e.auth,yield e.getIdToken()),s);return Lm._forOperation(e,"link",n)})}(s,new dp(e),e.bypassAuthState)})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class pp{constructor(e,t,s,n,r=!1){this.auth=e,this.resolver=s,this.user=n,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>g(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}}))}onAuthEvent(e){return g(this,null,function*(){const{urlResponse:t,sessionId:s,postBody:n,tenantId:r,error:i,type:a}=e;if(i)return void this.reject(i);const o={auth:this.auth,requestUri:t,sessionId:s,tenantId:r||void 0,postBody:n||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(a)(o))}catch(l){this.reject(l)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return up;case"linkViaPopup":case"linkViaRedirect":return mp;case"reauthViaPopup":case"reauthViaRedirect":return hp;default:th(this.auth,"internal-error")}}resolve(e){lh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){lh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const gp=new hh(2e3,1e4);class fp extends pp{constructor(e,t,s,n,r){super(e,t,n,r),this.provider=s,this.authWindow=null,this.pollId=null,fp.currentPopupAction&&fp.currentPopupAction.cancel(),fp.currentPopupAction=this}executeNotNull(){return g(this,null,function*(){const e=yield this.execute();return ah(e,this.auth,"internal-error"),e})}onExecution(){return g(this,null,function*(){lh(1===this.filter.length,"Popup operations only handle one event");const e=Qm();this.authWindow=yield this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(sh(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()})}get eventId(){var e;return(null==(e=this.authWindow)?void 0:e.associatedEvent)||null}cancel(){this.reject(sh(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,fp.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,s;(null==(s=null==(t=this.authWindow)?void 0:t.window)?void 0:s.closed)?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(sh(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,gp.get())};e()}}fp.currentPopupAction=null;
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const xp="pendingRedirect",yp=new Map;class vp extends pp{constructor(e,t,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,s),this.eventId=null}execute(){return g(this,null,function*(){let e=yp.get(this.auth._key());if(!e){try{const t=(yield function(e,t){return g(this,null,function*(){const s=function(e){return $h(xp,e.config.apiKey,e.name)}(t),n=function(e){return Kh(e._redirectPersistence)}(e);if(!(yield n._isAvailable()))return!1;const r="true"===(yield n._get(s));return yield n._remove(s),r})}(this.resolver,this.auth))?yield p(vp.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}yp.set(this.auth._key(),e)}return this.bypassAuthState||yp.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return g(this,null,function*(){if("signInViaRedirect"===e.type)return p(vp.prototype,this,"onAuthEvent").call(this,e);if("unknown"!==e.type){if(e.eventId){const t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,p(vp.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}}else this.resolve(null)})}onExecution(){return g(this,null,function*(){})}cleanUp(){}}function bp(e,t){yp.set(e._key(),t)}function wp(e,t,s=!1){return g(this,null,function*(){if(js(e.app))return Promise.reject(rh(e));const n=lm(e),r=
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function(e,t){return t?Kh(t):(ah(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}(n,t),i=new vp(n,r,s),a=yield i.execute();return a&&!s&&(delete a.user._redirectEventId,yield n._persistUserIfCurrent(a.user),yield n._setRedirectUser(null,t)),a})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Np{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(t=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return _p(e);default:return!1}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var s;if(e.error&&!_p(e)){const n=(null==(s=e.error.code)?void 0:s.split("auth/")[1])||"internal-error";t.onError(sh(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const s=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(jp(e))}saveEventToCache(e){this.cachedEventUids.add(jp(e)),this.lastProcessedEventTime=Date.now()}}function jp(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function _p({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const kp=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Sp=/^https?/;function Tp(e){return g(this,null,function*(){if(e.config.emulator)return;const{authorizedDomains:t}=yield function(e){return g(this,arguments,function*(e,t={}){return vh(e,"GET","/v1/projects",t)})}(e);for(const e of t)try{if(Ip(e))return}catch(s){}th(e,"unauthorized-domain")})}function Ip(e){const t=ch(),{protocol:s,hostname:n}=new URL(t);if(e.startsWith("chrome-extension://")){const r=new URL(e);return""===r.hostname&&""===n?"chrome-extension:"===s&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===s&&r.hostname===n}if(!Sp.test(s))return!1;if(kp.test(e))return n===e;const r=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(n)}
/**
     * @license
     * Copyright 2020 Google LLC.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Ep=new hh(3e4,6e4);function Cp(){const e=Xm().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let s=0;s<e.CP.length;s++)e.CP[s]=null}function Ap(e){return new Promise((t,s)=>{var n,r,i;function a(){Cp(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Cp(),s(sh(e,"network-request-failed"))},timeout:Ep.get()})}if(null==(r=null==(n=Xm().gapi)?void 0:n.iframes)?void 0:r.Iframe)t(gapi.iframes.getContext());else{if(!(null==(i=Xm().gapi)?void 0:i.load)){const t=`__iframefcb${Math.floor(1e6*Math.random())}`;return Xm()[t]=()=>{gapi.load?a():s(sh(e,"network-request-failed"))},um(`${dm.gapiScript}?onload=${t}`).catch(e=>s(e))}a()}}).catch(e=>{throw Pp=null,e})}let Pp=null;
/**
     * @license
     * Copyright 2020 Google LLC.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const Dp=new hh(5e3,15e3),Rp={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Op=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Lp(e){const t=e.config;ah(t.authDomain,e,"auth-domain-config-required");const s=t.emulator?mh(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,n={apiKey:t.apiKey,appName:e.name,v:Ss},r=Op.get(e.config.apiHost);r&&(n.eid=r);const i=e._getFrameworks();return i.length&&(n.fw=i.join(",")),`${s}?${it(n).slice(1)}`}function Mp(e){return g(this,null,function*(){const t=yield function(e){return Pp=Pp||Ap(e),Pp}(e),s=Xm().gapi;return ah(s,e,"internal-error"),t.open({where:document.body,url:Lp(e),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Rp,dontclear:!0},t=>new Promise((s,n)=>g(this,null,function*(){yield t.restyle({setHideOnLeave:!1});const r=sh(e,"network-request-failed"),i=Xm().setTimeout(()=>{n(r)},Dp.get());function a(){Xm().clearTimeout(i),s(t)}t.ping(a).then(a,()=>{n(r)})})))})}
/**
     * @license
     * Copyright 2020 Google LLC.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Fp={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Up{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function Vp(e,t,s,n=500,r=600){const i=Math.max((window.screen.availHeight-r)/2,0).toString(),a=Math.max((window.screen.availWidth-n)/2,0).toString();let o="";const l=u(d({},Fp),{width:n.toString(),height:r.toString(),top:i,left:a}),c=Xe().toLowerCase();s&&(o=Qh(c)?"_blank":s),Jh(c)&&(t=t||"http://localhost",l.scrollbars="yes");const h=Object.entries(l).reduce((e,[t,s])=>`${e}${t}=${s},`,"");if(function(e=Xe()){var t;return tm(e)&&!!(null==(t=window.navigator)?void 0:t.standalone)}(c)&&"_self"!==o)return function(e,t){const s=document.createElement("a");s.href=e,s.target=t;const n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(n)}
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(t||"",o),new Up(null);const m=window.open(t||"",o,h);ah(m,e,"popup-blocked");try{m.focus()}catch(p){}return new Up(m)}const Bp="__/auth/handler",Kp="emulator/auth/handler",zp=encodeURIComponent("fac");function qp(e,t,s,n,r,i){return g(this,null,function*(){ah(e.config.authDomain,e,"auth-domain-config-required"),ah(e.config.apiKey,e,"invalid-api-key");const i={apiKey:e.config.apiKey,appName:e.name,authType:s,redirectUrl:n,v:Ss,eventId:r};if(t instanceof Em){t.setDefaultLanguage(e.languageCode),i.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(i.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries({}))i[e]=t}if(t instanceof Cm){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(i.scopes=e.join(","))}e.tenantId&&(i.tid=e.tenantId);const a=i;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];const o=yield e._getAppCheckToken(),l=o?`#${zp}=${encodeURIComponent(o)}`:"";return`${function({config:e}){return e.emulator?mh(e,Kp):`https://${e.authDomain}/${Bp}`}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(e)}?${it(a).slice(1)}${l}`})}const $p="webStorageSupport",Hp=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Jm,this._completeRedirectFn=wp,this._overrideRedirectResult=bp}_openPopup(e,t,s,n){return g(this,null,function*(){var r;lh(null==(r=this.eventManagers[e._key()])?void 0:r.manager,"_initialize() not called before _openPopup()");const i=yield qp(e,t,s,ch(),n);return Vp(e,i,Qm())})}_openRedirect(e,t,s,n){return g(this,null,function*(){return yield this._originValidation(e),function(e){Xm().location.href=e}(yield qp(e,t,s,ch(),n)),new Promise(()=>{})})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:s}=this.eventManagers[t];return e?Promise.resolve(e):(lh(s,"If manager is not set, promise should be"),s)}const s=this.initAndGetManager(e);return this.eventManagers[t]={promise:s},s.catch(()=>{delete this.eventManagers[t]}),s}initAndGetManager(e){return g(this,null,function*(){const t=yield Mp(e),s=new Np(e);return t.register("authEvent",t=>(ah(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:s.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=t,s})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send($p,{type:$p},s=>{var n;const r=null==(n=null==s?void 0:s[0])?void 0:n[$p];void 0!==r&&t(!!r),th(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Tp(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return nm()||Wh()||tm()}};var Gp="@firebase/auth",Jp="1.11.0";
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Wp{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null==(e=this.auth.currentUser)?void 0:e.uid)||null}getToken(e){return g(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ah(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const Qp=qe("authIdTokenMaxAge")||300;let Yp=null;var Xp;dm={loadJS:e=>new Promise((t,s)=>{const n=document.createElement("script");var r,i;n.setAttribute("src",e),n.onload=t,n.onerror=e=>{const t=sh("internal-error");t.customData=e,s(t)},n.type="text/javascript",n.charset="UTF-8",(null!=(i=null==(r=document.getElementsByTagName("head"))?void 0:r[0])?i:document).appendChild(n)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Xp="Browser",ws(new ut("auth",(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),n=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:i,authDomain:a}=s.options;ah(i&&!i.includes(":"),"invalid-api-key",{appName:s.name});const o={apiKey:i,authDomain:a,clientPlatform:Xp,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:rm(Xp)},l=new om(s,n,r,o);return function(e,t){const s=(null==t?void 0:t.persistence)||[],n=(Array.isArray(s)?s:[s]).map(Kh);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(n,null==t?void 0:t.popupRedirectResolver)}(l,t),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,s)=>{e.getProvider("auth-internal").initialize()})),ws(new ut("auth-internal",e=>{const t=lm(e.getProvider("auth").getImmediate());return new Wp(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Es(Gp,Jp,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Xp)),Es(Gp,Jp,"esm2020");const Zp=Ts({apiKey:"AIzaSyDYGOfg7BSk1W8KuqjA0RzVMGOmfKZdOUs",authDomain:"azzahra-fashion-muslim-ab416.firebaseapp.com",projectId:"azzahra-fashion-muslim-ab416",storageBucket:"azzahra-fashion-muslim-ab416.firebasestorage.app",messagingSenderId:"822661485961",appId:"1:822661485961:web:4603488d8bef0119f3fd58",measurementId:"G-NZSXEKPQER"});console.log("âœ… Firebase initialized");const eg=function(e){const t="object"==typeof e?e:Is(),s="string"==typeof e?e:Er,n=Ns(t,"firestore").getImmediate({identifier:s});if(!n._initialized){const e=Ke("firestore");e&&function(e,t,s,n={}){var r;e=Bn(e,wd);const i=He(t),a=e._getSettings(),o=u(d({},a),{emulatorOptions:e._getEmulatorOptions()}),l=`${t}:${s}`;i&&(Ge(`https://${l}`),Ye("Firestore",!0)),a.host!==yd&&a.host!==l&&on("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c=u(d({},a),{host:l,ssl:i,emulatorOptions:n});if(!nt(c,o)&&(e._setSettings(c),n.mockUserToken)){let t,s;if("string"==typeof n.mockUserToken)t=n.mockUserToken,s=en.MOCK_USER;else{t=Je(n.mockUserToken,null==(r=e._app)?void 0:r.options.projectId);const i=n.mockUserToken.sub||n.mockUserToken.user_id;if(!i)throw new pn(mn.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");s=new en(i)}e._authCredentials=new yn(new fn(t,s))}}(n,...e)}return n}(Zp);!function(e=Is(),t){const s=Ns(e=dt(e),Ju).getImmediate({identifier:t}),n=Ke("storage");n&&function(e,t,s,n={}){!function(e,t,s,n={}){e.host=`${t}:${s}`;const r=He(t);r&&(Ge(`https://${e.host}/b`),Ye("Storage",!0)),e._isUsingEmulator=!0,e._protocol=r?"https":"http";const{mockUserToken:i}=n;i&&(e._overrideAuthToken="string"==typeof i?i:Je(i,e.app.options.projectId))}(e,t,s,n)}(s,...n)}(Zp);const tg=function(t=Is()){const s=Ns(t,"auth");if(s.isInitialized())return s.getImmediate();const n=function(e,t){const s=Ns(e,"auth");if(s.isInitialized()){const e=s.getImmediate();if(nt(s.getOptions(),null!=t?t:{}))return e;th(e,"already-initialized")}return s.initialize({options:t})}(t,{popupRedirectResolver:Hp,persistence:[cp,Hm,Jm]}),r=qe("authTokenSyncURL");if(r&&"boolean"==typeof isSecureContext&&isSecureContext){const t=new URL(r,location.origin);if(location.origin===t.origin){const s=(i=t.toString(),t=>g(e,null,function*(){const e=t&&(yield t.getIdTokenResult()),s=e&&((new Date).getTime()-Date.parse(e.issuedAtTime))/1e3;if(s&&s>Qp)return;const n=null==e?void 0:e.token;Yp!==n&&(Yp=n,yield fetch(i,{method:n?"POST":"DELETE",headers:n?{Authorization:`Bearer ${n}`}:{}}))}));!function(e,t,s){dt(e).beforeAuthStateChanged(t,s)}(n,s,()=>s(n.currentUser)),function(e,t,s,n){dt(e).onIdTokenChanged(t,s,n)}(n,e=>s(e))}}var i;const a=Be("auth");return a&&ym(n,`http://${a}`),n}(Zp),sg="current-flash-sale",ng=()=>{const[t,s]=f.useState(null),[n,r]=f.useState(""),[i,a]=f.useState(!0),o=()=>g(e,null,function*(){try{console.log("ðŸ§¹ Firebase Flash Sale: Cleaning up flash sale products...");const t=lu(kd(eg,"products"),function(e,t,s){const n=t,r=ru("where",e);return cu._create(r,n,s)}("isFlashSale","==",!0)),s=yield _u(t);console.log(`ðŸ§¹ Firebase Flash Sale: Found ${s.docs.length} flash sale products to clean`);const n=s.docs.map(t=>g(e,null,function*(){const e=Sd(eg,"products",t.id);yield ku(e,{isFlashSale:!1,flashSalePrice:null}),console.log(`ðŸ§¹ Firebase Flash Sale: Cleared flash sale from product ${t.id}`)}));yield Promise.all(n),console.log("âœ… Firebase Flash Sale: All flash sale products cleaned successfully")}catch(t){throw console.error("âŒ Firebase Flash Sale: Error cleaning flash sale products:",t),t}});f.useEffect(()=>{a(!0),console.log("ðŸ”¥ Firebase Flash Sale: Initializing real-time listener");const e=Su(Sd(eg,"flashSales",sg),e=>{if(e.exists()){const t=d({id:e.id},e.data());s(t),console.log("âœ… Firebase Flash Sale: Config loaded from Firebase"),console.log("ðŸ“… Flash sale ends at:",t.endTime),console.log("â° Current time:",(new Date).toISOString()),console.log("ðŸ”¥ Firebase Flash Sale: Active status:",t.isActive)}else console.log("ðŸ“ Firebase Flash Sale: No active flash sale found"),s(null);a(!1)},e=>{console.error("âŒ Firebase Flash Sale: Error listening to config:",e),a(!1)});return()=>{e(),console.log("ðŸ”¥ Firebase Flash Sale: Listener disconnected")}},[]),f.useEffect(()=>{if(!t||!t.isActive)return void r("");const e=setInterval(()=>{const e=(new Date).getTime(),s=new Date(t.endTime).getTime()-e;if(s>0){const e=Math.floor(s/864e5),t=Math.floor(s%864e5/36e5),n=Math.floor(s%36e5/6e4),i=Math.floor(s%6e4/1e3);r(e>0?`${e} hari ${t} jam ${n} menit`:t>0?`${t} jam ${n} menit ${i} detik`:`${n} menit ${i} detik`)}else console.log("â° Firebase Flash Sale: Flash sale has ended!"),t.id&&(c({isActive:!1}),o()),window.dispatchEvent(new CustomEvent("flashSaleEnded",{detail:{timestamp:(new Date).toISOString(),reason:"time_expired",configId:t.id}})),r("Flash Sale Berakhir")},1e3);return()=>clearInterval(e)},[t,o]);const l=t=>g(e,null,function*(){try{const e=Sd(eg,"flashSales",sg),s=u(d({id:sg},t),{createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()});return yield function(e,t,s){e=Bn(e,jd);const n=Bn(e.firestore,Ad),r=xu(e.converter,t);return Tu(n,[$d(qd(n),"setDoc",e._key,r,null!==e.converter,s).toMutation(e._key,fa.none())])}(e,s),console.log("âœ… Firebase Flash Sale: Flash sale created successfully"),s}catch(e){throw console.error("âŒ Firebase Flash Sale: Error creating flash sale:",e),e}}),c=s=>g(e,null,function*(){try{if(!(null==t?void 0:t.id))return;const e=Sd(eg,"flashSales",t.id);yield ku(e,u(d({},s),{updatedAt:(new Date).toISOString()})),console.log("âœ… Firebase Flash Sale: Flash sale updated successfully")}catch(e){throw console.error("âŒ Firebase Flash Sale: Error updating flash sale:",e),e}});return{flashSaleConfig:t,timeLeft:n,loading:i,isFlashSaleActive:(null==t?void 0:t.isActive)||!1,createFlashSale:l,updateFlashSale:c,startFlashSale:t=>g(e,null,function*(){try{const e=u(d({},t),{isActive:!0});yield l(e),console.log("âœ… Firebase Flash Sale: Flash sale started successfully")}catch(e){throw console.error("âŒ Firebase Flash Sale: Error starting flash sale:",e),e}}),stopFlashSale:()=>g(e,null,function*(){try{if(!(null==t?void 0:t.id))return;yield c({isActive:!1}),yield o(),console.log("âœ… Firebase Flash Sale: Flash sale stopped successfully")}catch(e){throw console.error("âŒ Firebase Flash Sale: Error stopping flash sale:",e),e}}),isProductInFlashSale:e=>{var s;if(!(null==t?void 0:t.isActive))return!1;const n=t.products.includes(e),r=(null==(s=t.productIds)?void 0:s.includes(e))||!1;return n||r}}},rg=({user:e,cartItems:t,products:s,loading:n,onProductClick:r,onLoginRequired:i,onCartClick:a,onAddToCart:o,onNavigateToFlashSale:l})=>{var c;const[h,m]=f.useState(""),[p,g]=f.useState("all"),[x,w]=f.useState("all"),[N,j]=f.useState("terbaru"),[A,P]=f.useState(1),[D,R]=f.useState(0),[O,L]=f.useState(0),{timeLeft:M,isFlashSaleActive:F}=ng(),[U,V]=f.useState(0),[B,K]=f.useState("");f.useEffect(()=>{console.log("ðŸ”„ HomePage: Starting periodic refresh timer");const e=setInterval(()=>{console.log("â° HomePage: Periodic refresh triggered"),V(e=>e+1),K((new Date).toLocaleTimeString("id-ID"))},15e3);return K((new Date).toLocaleTimeString("id-ID")),()=>{clearInterval(e),console.log("ðŸ”„ HomePage: Periodic refresh timer stopped")}},[]);const z=[{id:"all",name:"Semua",icon:"ðŸ›ï¸"},{id:"hijab",name:"Hijab",icon:"ðŸ§•"},{id:"gamis",name:"Gamis",icon:"ðŸ‘—"},{id:"khimar",name:"Khimar",icon:"ðŸ§•"},{id:"tunik",name:"Tunik",icon:"ðŸ‘š"},{id:"abaya",name:"Abaya",icon:"ðŸ¥»"}],q=e=>{o(e)},$=y.useMemo(()=>{const e=function(e){return Array.isArray(e)?e.map(Pe).filter(e=>null!==e):(console.warn("âš ï¸ validateProducts: Input is not an array"),[])}(s);return e.map(e=>u(d({},e),{description:e.description||"",category:e.category||"other",images:e.images||[],variants:e.variants||{sizes:[],colors:[]},retailPrice:e.retailPrice||0,resellerPrice:e.resellerPrice||0,costPrice:e.costPrice||0,stock:e.stock||0,status:e.status||"ready",isFlashSale:e.isFlashSale||!1,flashSalePrice:e.flashSalePrice||0,createdAt:e.createdAt||new Date,salesCount:e.salesCount||0,isFeatured:e.isFeatured||!1}))},[s]),H=$.filter(e=>{const t=e.name.toLowerCase().includes(h.toLowerCase())||e.description.toLowerCase().includes(h.toLowerCase()),s="all"===p||e.category===p,n="all"===x||e.status===x;return t&&s&&n}),G=[...H].sort((t,s)=>{switch(N){case"terbaru":return new Date(s.createdAt).getTime()-new Date(t.createdAt).getTime();case"terlama":return new Date(t.createdAt).getTime()-new Date(s.createdAt).getTime();case"terlaris":return(s.salesCount||0)-(t.salesCount||0);case"termurah":return("reseller"===(null==e?void 0:e.role)?t.resellerPrice:t.retailPrice)-("reseller"===(null==e?void 0:e.role)?s.resellerPrice:s.retailPrice);case"termahal":const n="reseller"===(null==e?void 0:e.role)?t.resellerPrice:t.retailPrice;return("reseller"===(null==e?void 0:e.role)?s.resellerPrice:s.retailPrice)-n;default:return 0}}),J=y.useMemo(()=>{const e=$.filter(e=>e.isFeatured);return e},[$,D]),W=y.useMemo(()=>{try{return Array.isArray(G)?G:$||[]}catch(e){return $||[]}},[G,$]),Q=8*A,Y=Q-8,X=W.slice(Y,Q),Z=Math.ceil(W.length/8);return f.useEffect(()=>{P(1)},[h,p,x,N]),f.useEffect(()=>{const e=e=>{R(e=>e+1),setTimeout(()=>{V(e=>e+1)},100)},t=e=>{V(e=>e+1)},s=e=>{L(e=>e+1),setTimeout(()=>{V(e=>e+1)},100)};return window.addEventListener("featuredProductsUpdated",e),window.addEventListener("productsUpdated",t),window.addEventListener("flashSaleUpdated",s),window.addEventListener("productAdded",t),window.addEventListener("productUpdated",t),window.addEventListener("productDeleted",t),()=>{window.removeEventListener("featuredProductsUpdated",e),window.removeEventListener("productsUpdated",t),window.removeEventListener("flashSaleUpdated",s),window.removeEventListener("productAdded",t),window.removeEventListener("productUpdated",t),window.removeEventListener("productDeleted",t)}},[]),f.useEffect(()=>{const e=e=>{var t;console.log("ðŸ”¥ Flash sale ended detected in HomePage:",e.detail),R(e=>e+1),"time_expired"===(null==(t=e.detail)?void 0:t.reason)&&(window.flashSaleRefreshTimer&&clearTimeout(window.flashSaleRefreshTimer),window.flashSaleRefreshTimer=setTimeout(()=>{console.log("ðŸ”„ Auto-refreshing HomePage after flash sale time expired"),window.location.reload()},4e3))};return window.addEventListener("flashSaleEnded",e),()=>{window.removeEventListener("flashSaleEnded",e)}},[]),n?je.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:je.jsxs("div",{className:"text-center",children:[je.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500 mx-auto mb-4"}),je.jsx("p",{className:"text-gray-600",children:"Loading products..."})]})}):je.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[je.jsxs("div",{className:"bg-gradient-to-r from-pink-500 to-purple-600 text-white p-4",children:[je.jsxs("div",{className:"flex items-center justify-between mb-4",children:[je.jsxs("div",{children:[je.jsx("h1",{className:"text-xl font-bold",children:"Azzahra Fashion"}),je.jsx("p",{className:"text-pink-100 text-sm",children:"Muslim Fashion Store"})]}),je.jsx("div",{className:"flex items-center space-x-3",children:e?je.jsxs("div",{className:"flex items-center space-x-2",children:[je.jsx(S,{className:"w-5 h-5"}),je.jsx("span",{className:"text-sm",children:e.name})]}):je.jsx("button",{onClick:i,className:"bg-white/20 px-3 py-1 rounded-full text-sm hover:bg-white/30 transition-colors",children:"Login"})})]}),je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsxs("div",{className:"flex-1 relative",children:[je.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),je.jsx("input",{type:"text",placeholder:"Cari produk...",value:h,onChange:e=>m(e.target.value),className:"w-full pl-10 pr-4 py-3 rounded-lg text-gray-800 focus:outline-none focus:ring-2 focus:ring-white/50"})]}),je.jsxs("button",{onClick:a,className:"relative p-2 bg-white rounded-full shadow-md hover:shadow-lg transition-shadow",children:[je.jsx(b,{className:"w-6 h-6 text-gray-600"}),t.length>0&&je.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:t.length})]})]})]}),je.jsx("div",{className:"p-4",children:je.jsx(Ae,{onBannerClick:e=>{console.log("Banner clicked:",e),"flashsale"===e.type&&(console.log("Flash sale banner clicked, navigating..."),l&&l())}})}),je.jsx("div",{className:"px-4 mb-6",children:je.jsxs("div",{className:"bg-gradient-to-br from-red-600 via-red-500 to-orange-500 rounded-xl p-5 text-white shadow-xl relative overflow-hidden",children:[je.jsxs("div",{className:"absolute inset-0 opacity-10",children:[je.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white rounded-full -mr-16 -mt-16 animate-pulse"}),je.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white rounded-full -ml-12 -mb-12 animate-pulse delay-75"})]}),je.jsx("div",{className:"relative z-10",children:je.jsxs("div",{className:"flex items-center justify-between mb-4",children:[je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx("div",{className:"bg-white/20 backdrop-blur-sm p-3 rounded-full shadow-lg",children:je.jsx("span",{className:"text-3xl",children:"âš¡"})}),je.jsxs("div",{children:[je.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-yellow-200 to-white bg-clip-text text-transparent",children:"Flash Sale"}),je.jsx("p",{className:"text-red-100 text-sm font-medium",children:F?"Diskon Terbatas!":"Nantikan Flash Sale Kami Selanjutnya"}),F&&M&&je.jsxs("div",{className:"flex items-center space-x-2 mt-2 bg-white/20 backdrop-blur-sm rounded-full px-3 py-1",children:[je.jsx(I,{className:"w-4 h-4 text-yellow-200"}),je.jsx("span",{className:"text-sm font-bold text-yellow-200",children:M})]})]})]}),je.jsx("button",{onClick:l,className:"bg-white text-red-500 px-4 py-2 rounded-full text-sm font-bold hover:bg-red-50 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105",children:F?"Lihat Semua":"Lihat Produk"})]})}),n?je.jsx("div",{className:"grid grid-cols-2 gap-3",children:[...Array(2)].map((e,t)=>je.jsxs("div",{className:"bg-white/10 rounded-lg p-3 backdrop-blur-sm",children:[je.jsx("div",{className:"w-full h-24 bg-white/20 rounded animate-pulse mb-2"}),je.jsx("div",{className:"h-3 bg-white/20 rounded animate-pulse mb-1"}),je.jsx("div",{className:"h-3 bg-white/20 rounded w-3/4 animate-pulse"})]},`flash-skeleton-${t}`))}):je.jsx("div",{className:"grid grid-cols-2 gap-3",children:$.filter(e=>e.isFlashSale&&F).slice(0,2).map(e=>{var t;return je.jsxs("div",{onClick:()=>r(e),className:"bg-white/10 rounded-lg p-3 backdrop-blur-sm hover:bg-white/20 transition-colors cursor-pointer",children:[je.jsxs("div",{className:"relative",children:[je.jsx("img",{src:(null==(t=e.images)?void 0:t[0])||"/placeholder-product.jpg",alt:e.name,className:"w-full h-24 object-cover rounded mb-2"}),je.jsxs("div",{className:"absolute top-1 right-1 bg-red-600 text-white text-xs px-2 py-1 rounded-full",children:["-",Math.round((e.retailPrice-e.flashSalePrice)/e.retailPrice*100),"%"]})]}),je.jsx("h3",{className:"text-white font-medium text-sm mb-1 truncate",children:e.name}),je.jsxs("div",{className:"flex items-center space-x-2",children:[je.jsxs("span",{className:"text-white font-bold text-sm",children:["Rp ",e.flashSalePrice.toLocaleString("id-ID")]}),je.jsxs("span",{className:"text-red-200 line-through text-xs",children:["Rp ",e.retailPrice.toLocaleString("id-ID")]})]})]},`flash-${e.id}`)})}),0===$.filter(e=>e.isFlashSale&&F).length&&!n&&je.jsxs("div",{className:"text-center py-4 text-red-100",children:[je.jsx("span",{className:"text-3xl",children:"ðŸš«"}),je.jsx("p",{className:"text-sm mt-1",children:"Tidak ada Flash Sale saat ini"})]})]})}),F&&M&&je.jsx("div",{className:"px-4 mb-4",children:je.jsxs("div",{className:"bg-gradient-to-br from-red-600 via-red-500 to-pink-500 rounded-xl p-5 text-white shadow-xl relative overflow-hidden",children:[je.jsxs("div",{className:"absolute inset-0 opacity-10",children:[je.jsx("div",{className:"absolute top-2 left-2 w-20 h-20 bg-white rounded-full -ml-10 -mt-10 animate-pulse"}),je.jsx("div",{className:"absolute bottom-2 right-2 w-16 h-16 bg-white rounded-full -mr-8 -mb-8 animate-pulse delay-100"})]}),je.jsx("div",{className:"relative z-10",children:je.jsxs("div",{className:"flex items-center justify-between",children:[je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsxs("div",{className:"relative",children:[je.jsx("div",{className:"w-4 h-4 bg-yellow-400 rounded-full animate-pulse"}),je.jsx("div",{className:"absolute inset-0 w-4 h-4 bg-yellow-300 rounded-full animate-ping"})]}),je.jsxs("div",{children:[je.jsx("span",{className:"font-bold text-xl bg-gradient-to-r from-yellow-200 to-white bg-clip-text text-transparent",children:"âš¡ Flash Sale Berlangsung!"}),je.jsx("p",{className:"text-red-100 text-sm font-medium mt-1",children:"Diskon Terbatas, Siapa Cepat Dia Dapat!"})]})]}),je.jsxs("div",{className:"text-right",children:[je.jsx("div",{className:"text-sm text-red-100 font-medium mb-1",children:"Berakhir dalam:"}),je.jsx("div",{className:"font-black text-2xl bg-white/20 backdrop-blur-sm rounded-lg px-4 py-2",children:M})]})]})})]})}),je.jsxs("div",{className:"px-4 mb-6",children:[je.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[je.jsx(v,{className:"w-5 h-5 text-yellow-500 fill-current"}),je.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"Produk Unggulan"})]}),n?je.jsx("div",{className:"grid grid-cols-2 gap-4",children:[...Array(2)].map((e,t)=>je.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[je.jsx("div",{className:"w-full h-48 bg-gray-200 animate-pulse"}),je.jsxs("div",{className:"p-4",children:[je.jsx("div",{className:"h-4 bg-gray-200 rounded mb-2 animate-pulse"}),je.jsx("div",{className:"h-3 bg-gray-200 rounded mb-3 animate-pulse"}),je.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 animate-pulse"})]})]},`skeleton-${t}`))}):J.length>0?je.jsx("div",{className:"grid grid-cols-2 gap-4",children:J.map(t=>je.jsx(Ce,{product:t,onProductClick:r,onAddToCart:q,user:e,isFeatured:!0},`featured-${t.id}`))}):je.jsxs("div",{className:"text-center py-8 text-gray-500 bg-white rounded-lg",children:[je.jsx(v,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),je.jsx("p",{children:"Belum ada produk unggulan"})]})]}),je.jsx("div",{className:"px-4",children:je.jsxs("div",{className:"flex flex-col space-y-3",children:[je.jsx("div",{className:"flex space-x-3 overflow-x-auto pb-2",children:z.map(e=>je.jsxs("button",{onClick:()=>g(e.id),className:"flex-shrink-0 flex items-center space-x-2 px-4 py-2 rounded-full transition-colors "+(p===e.id?"bg-pink-500 text-white":"bg-white text-gray-600 hover:bg-gray-100"),children:[je.jsx("span",{children:e.icon}),je.jsx("span",{className:"text-sm font-medium",children:e.name})]},e.id))}),je.jsxs("div",{className:"flex space-x-3 overflow-x-auto pb-2",children:[je.jsx("button",{onClick:()=>w("all"),className:"flex-shrink-0 flex items-center space-x-2 px-4 py-2 rounded-full transition-colors "+("all"===x?"bg-gray-700 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:je.jsx("span",{className:"text-sm font-medium",children:"Semua Status"})}),je.jsxs("button",{onClick:()=>w("ready"),className:"flex-shrink-0 flex items-center space-x-2 px-4 py-2 rounded-full transition-colors "+("ready"===x?"bg-green-500 text-white":"bg-white text-gray-600 hover:bg-gray-100 border border-green-300"),children:[je.jsx("span",{className:"w-2 h-2 bg-current rounded-full"}),je.jsx("span",{className:"text-sm font-medium",children:"Ready"})]}),je.jsxs("button",{onClick:()=>w("po"),className:"flex-shrink-0 flex items-center space-x-2 px-4 py-2 rounded-full transition-colors "+("po"===x?"bg-orange-500 text-white":"bg-white text-gray-600 hover:bg-gray-100 border border-orange-300"),children:[je.jsx("span",{className:"w-2 h-2 bg-current rounded-full"}),je.jsx("span",{className:"text-sm font-medium",children:"PO"})]})]})]})}),je.jsxs("div",{className:"px-4",children:[je.jsxs("div",{className:"flex flex-col space-y-3 mb-4",children:[je.jsxs("div",{className:"flex items-center justify-between",children:[je.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"all"===p?"Semua Produk":null==(c=z.find(e=>e.id===p))?void 0:c.name}),je.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[je.jsx(E,{className:"w-4 h-4 mr-1"}),H.length," produk"]})]}),je.jsxs("div",{className:"flex items-center space-x-2 overflow-x-auto pb-2",children:[je.jsxs("div",{className:"flex items-center text-sm text-gray-600 mr-2",children:[je.jsx(C,{className:"w-4 h-4 mr-1"}),"Urutkan:"]}),je.jsx("button",{onClick:()=>j("terbaru"),className:"flex-shrink-0 px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+("terbaru"===N?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"Terbaru"}),je.jsx("button",{onClick:()=>j("terlaris"),className:"flex-shrink-0 px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+("terlaris"===N?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"Terlaris"}),je.jsx("button",{onClick:()=>j("termurah"),className:"flex-shrink-0 px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+("termurah"===N?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"Termurah"}),je.jsx("button",{onClick:()=>j("termahal"),className:"flex-shrink-0 px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+("termahal"===N?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"Termahal"}),je.jsx("button",{onClick:()=>j("terlama"),className:"flex-shrink-0 px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+("terlama"===N?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"Terlama"})]})]}),0===H.length?je.jsxs("div",{className:"text-center py-12",children:[je.jsx("div",{className:"text-gray-400 mb-4",children:je.jsx(T,{className:"w-12 h-12 mx-auto"})}),je.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"Produk tidak ditemukan"}),je.jsx("p",{className:"text-gray-500",children:"Coba kata kunci lain atau pilih kategori berbeda"})]}):je.jsxs(je.Fragment,{children:[je.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:X.map(t=>je.jsx(Ce,{product:t,onProductClick:r,onAddToCart:q,user:e},t.id))}),Z>1&&je.jsxs("div",{className:"flex flex-col items-center mt-8 space-y-4",children:[je.jsxs("div",{className:"flex items-center space-x-2",children:[je.jsxs("button",{onClick:()=>P(e=>Math.max(1,e-1)),disabled:1===A,className:"flex items-center space-x-1 px-3 py-2 rounded-lg transition-colors "+(1===A?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300"),children:[je.jsx(_,{className:"w-4 h-4"}),je.jsx("span",{children:"Sebelumnya"})]}),je.jsx("div",{className:"flex items-center space-x-1",children:[...Array(Z)].map((e,t)=>{const s=t+1,n=A===s;return 1===s||s===Z||s>=A-1&&s<=A+1?je.jsx("button",{onClick:()=>P(s),className:"w-10 h-10 rounded-lg font-medium transition-colors "+(n?"bg-pink-500 text-white":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300"),children:s},s):2===s&&A>3||s===Z-1&&A<Z-2?je.jsx("span",{className:"px-2 text-gray-400",children:"..."},s):null})}),je.jsxs("button",{onClick:()=>P(e=>Math.min(Z,e+1)),disabled:A===Z,className:"flex items-center space-x-1 px-3 py-2 rounded-lg transition-colors "+(A===Z?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300"),children:[je.jsx("span",{children:"Selanjutnya"}),je.jsx(k,{className:"w-4 h-4"})]})]}),je.jsxs("div",{className:"text-sm text-gray-600",children:["Menampilkan ",Y+1,"-",Math.min(Q,W.length)," dari ",W.length," produk"]})]})]})]}),e&&je.jsx("div",{className:"fixed bottom-24 right-4 bg-white rounded-lg shadow-lg p-3 border-l-4 border-pink-500",children:je.jsx("div",{className:"text-xs text-gray-600",children:"reseller"===e.role?je.jsxs("div",{className:"flex items-center space-x-1",children:[je.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full"}),je.jsx("span",{children:"Harga Reseller Aktif"})]}):je.jsxs("div",{className:"flex items-center space-x-1",children:[je.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),je.jsx("span",{children:"Harga Retail"})]})})})]})},ig=({product:e,user:t,onBack:s,onLoginRequired:n,onAddToCart:r,onBuyNow:i,onNavigateToCart:a})=>{var o;const[l,c]=f.useState(""),[d,u]=f.useState(""),[h,m]=f.useState(1),[p,g]=f.useState(0);return je.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[je.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:je.jsxs("div",{className:"flex items-center justify-between p-4",children:[je.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-full",children:je.jsx(A,{className:"w-6 h-6 text-gray-600"})}),je.jsx("h1",{className:"text-lg font-semibold",children:"Detail Produk"}),je.jsxs("div",{className:"flex items-center space-x-2",children:[je.jsx("button",{onClick:a||(()=>{}),className:"p-2 rounded-full transition-colors relative "+(t?"bg-pink-500 text-white hover:bg-pink-600":"bg-gray-100 text-gray-400"),children:je.jsx(b,{className:"w-5 h-5"})}),je.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-full",children:je.jsx(P,{className:"w-5 h-5 text-gray-600"})}),je.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-full",children:je.jsx(D,{className:"w-5 h-5 text-gray-600"})})]})]})}),je.jsxs("div",{className:"bg-white",children:[je.jsxs("div",{className:"relative",children:[je.jsx("img",{src:(null==(o=e.images)?void 0:o[p])||e.image||"/placeholder-product.jpg",alt:e.name,className:"w-full h-96 object-cover",onError:e=>{e.target.src="/placeholder-product.jpg"}}),e.isFlashSale&&je.jsx("div",{className:"absolute top-4 left-4 bg-red-500 text-white px-3 py-1 rounded-full text-sm font-semibold",children:"FLASH SALE"}),"po"===e.status&&je.jsx("div",{className:"absolute top-4 right-4 bg-orange-500 text-white px-3 py-1 rounded-full text-sm font-semibold",children:"PRE ORDER"})]}),e.images&&e.images.length>1&&je.jsx("div",{className:"flex space-x-2 p-4 overflow-x-auto",children:e.images.map((t,s)=>je.jsx("button",{onClick:()=>g(s),className:"flex-shrink-0 w-16 h-16 rounded-lg overflow-hidden border-2 "+(p===s?"border-pink-500":"border-gray-200"),children:je.jsx("img",{src:t,alt:`${e.name} ${s+1}`,className:"w-full h-full object-cover",onError:e=>{e.target.src="/placeholder-product.jpg"}})},s))})]}),je.jsxs("div",{className:"bg-white mt-2 p-4",children:[je.jsx("div",{className:"flex items-start justify-between mb-3",children:je.jsxs("div",{className:"flex-1",children:[je.jsx("h1",{className:"text-xl font-bold text-gray-800 mb-2",children:e.name}),je.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[je.jsxs("div",{className:"flex items-center",children:[[...Array(5)].map((e,t)=>je.jsx(v,{className:"w-4 h-4 text-yellow-400 fill-current"},t)),je.jsx("span",{className:"text-sm text-gray-600 ml-1",children:"(4.8)"})]}),je.jsx("span",{className:"text-sm text-gray-500",children:"â€¢ Terjual 150+"})]})]})}),je.jsx("div",{className:"mb-4",children:e.isFlashSale&&e.flashSalePrice>0?je.jsxs("div",{className:"space-y-1",children:[je.jsxs("div",{className:"flex items-center space-x-2",children:[je.jsxs("span",{className:"text-2xl font-bold text-red-600",children:["Rp ",e.flashSalePrice.toLocaleString("id-ID")]}),je.jsxs("span",{className:"bg-red-100 text-red-600 text-xs px-2 py-1 rounded",children:["-",Math.round(100*(1-e.flashSalePrice/(e.originalRetailPrice||e.retailPrice))),"%"]})]}),je.jsxs("div",{className:"text-lg text-gray-500 line-through",children:["Rp ",(e.originalRetailPrice||e.retailPrice).toLocaleString("id-ID")]})]}):je.jsxs("div",{className:"space-y-1",children:[je.jsxs("div",{className:"text-2xl font-bold text-pink-600",children:["Rp ",(e.isFlashSale&&e.flashSalePrice>0?e.flashSalePrice:"reseller"===(null==t?void 0:t.role)?e.resellerPrice:e.retailPrice).toLocaleString("id-ID")]}),"reseller"===(null==t?void 0:t.role)?je.jsxs("div",{className:"text-sm text-blue-600 font-medium",children:["Harga Reseller (Retail: Rp ",e.retailPrice.toLocaleString("id-ID"),")"]}):je.jsx("button",{onClick:()=>{if("reseller"!==(null==t?void 0:t.role)){const t=encodeURIComponent(`Halo Admin, saya tertarik dengan produk ${e.name} dan ingin menanyakan tentang harga reseller. Mohon info lebih lanjut. Terima kasih.`);window.open(`https://wa.me/6287815990944?text=${t}`,"_blank")}},className:"text-sm text-green-600 font-medium hover:text-green-700 underline transition-colors",children:"ðŸ’¬ Info Harga Reseller?"})]})}),je.jsx("div",{className:"flex items-center justify-between mb-4 p-3 bg-gray-50 rounded-lg",children:je.jsxs("div",{className:"flex items-center space-x-4",children:[je.jsxs("div",{className:"text-sm",children:[je.jsx("span",{className:"text-gray-600",children:"Stok: "}),je.jsx("span",{className:"font-semibold "+(e.stock>10?"text-green-600":e.stock>0?"text-yellow-600":"text-red-600"),children:e.stock})]}),je.jsxs("div",{className:"text-sm",children:[je.jsx("span",{className:"text-gray-600",children:"Status: "}),je.jsx("span",{className:"font-semibold "+("ready"===e.status?"text-green-600":"text-orange-600"),children:"ready"===e.status?"Ready Stock":"Pre Order"})]})]})}),je.jsx("div",{className:"border-t pt-4",children:je.jsx("p",{className:"text-gray-600 leading-relaxed",children:e.description})})]}),je.jsxs("div",{className:"bg-white mt-2 p-4",children:[je.jsxs("div",{className:"mb-6",children:[je.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Pilih Ukuran"}),je.jsx("div",{className:"flex flex-wrap gap-2",children:e.variants.sizes.map(e=>je.jsx("button",{onClick:()=>c(e),className:"px-4 py-2 border rounded-lg font-medium transition-colors "+(l===e?"border-pink-500 bg-pink-50 text-pink-600":"border-gray-300 text-gray-600 hover:border-gray-400"),children:e},e))})]}),je.jsxs("div",{className:"mb-6",children:[je.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Pilih Warna"}),je.jsx("div",{className:"flex flex-wrap gap-2",children:e.variants.colors.map(e=>je.jsx("button",{onClick:()=>u(e),className:"px-4 py-2 border rounded-lg font-medium transition-colors "+(d===e?"border-pink-500 bg-pink-50 text-pink-600":"border-gray-300 text-gray-600 hover:border-gray-400"),children:e},e))})]}),je.jsxs("div",{className:"mb-6",children:[je.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Jumlah"}),je.jsxs("div",{className:"flex items-center space-x-4",children:[je.jsxs("div",{className:"flex items-center space-x-3 bg-gray-100 rounded-lg p-1",children:[je.jsx("button",{onClick:()=>m(Math.max(1,h-1)),className:"w-10 h-10 flex items-center justify-center rounded-md hover:bg-gray-200 transition-colors",children:je.jsx(R,{className:"w-4 h-4"})}),je.jsx("span",{className:"w-12 text-center font-semibold",children:h}),je.jsx("button",{onClick:()=>m(h+1),className:"w-10 h-10 flex items-center justify-center rounded-md hover:bg-gray-200 transition-colors",children:je.jsx(O,{className:"w-4 h-4"})})]}),je.jsxs("div",{className:"text-sm text-gray-600",children:["Stok tersedia: ",je.jsx("span",{className:"font-semibold",children:e.stock})]})]})]})]}),je.jsxs("div",{className:"bg-white mt-2 p-4",children:[je.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Detail Produk"}),je.jsxs("div",{className:"space-y-2 text-sm",children:[je.jsxs("div",{className:"flex justify-between",children:[je.jsx("span",{className:"text-gray-600",children:"Kategori:"}),je.jsx("span",{className:"font-medium capitalize",children:e.category})]}),"po"===e.status&&e.estimatedReady&&je.jsxs("div",{className:"flex justify-between",children:[je.jsx("span",{className:"text-gray-600",children:"Estimasi Ready:"}),je.jsx("span",{className:"font-medium",children:e.estimatedReady.toLocaleDateString("id-ID")})]}),je.jsxs("div",{className:"flex justify-between",children:[je.jsx("span",{className:"text-gray-600",children:"Berat:"}),je.jsx("span",{className:"font-medium",children:"500 gram"})]}),je.jsxs("div",{className:"flex justify-between",children:[je.jsx("span",{className:"text-gray-600",children:"Kondisi:"}),je.jsx("span",{className:"font-medium text-green-600",children:"Baru"})]}),je.jsxs("div",{className:"flex justify-between",children:[je.jsx("span",{className:"text-gray-600",children:"Garansi:"}),je.jsx("span",{className:"font-medium",children:"Garansi Toko"})]})]})]}),je.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 shadow-lg z-50",children:[je.jsxs("div",{className:"flex space-x-3",children:[je.jsxs("button",{onClick:()=>{t?l&&d?(r(e,{size:l,color:d},h),c(""),u(""),m(1)):alert("Pilih ukuran dan warna terlebih dahulu"):n()},disabled:!l||!d,className:"flex-1 bg-pink-100 text-pink-600 py-4 rounded-lg font-semibold hover:bg-pink-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:[je.jsx(b,{className:"w-5 h-5"}),je.jsx("span",{children:"Tambah ke Keranjang"})]}),je.jsx("button",{onClick:()=>{t?l&&d?i(e,{size:l,color:d},h):alert("Pilih ukuran dan warna terlebih dahulu"):n()},disabled:!l||!d,className:"flex-1 bg-gradient-to-r from-pink-500 to-purple-600 text-white py-4 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"Beli Sekarang"})]}),(!l||!d)&&je.jsx("p",{className:"text-center text-sm text-gray-500 mt-2",children:"Pilih ukuran dan warna terlebih dahulu"})]})]})},ag=({cartItems:e,user:t,updateQuantity:s,removeFromCart:n,getTotalPrice:r,onBack:i,onCheckout:a})=>{if(0===e.length)return je.jsxs("div",{className:"min-h-screen bg-gray-50",children:[je.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:je.jsxs("div",{className:"flex items-center p-4",children:[je.jsx("button",{onClick:i,className:"mr-4",children:je.jsx(A,{className:"w-6 h-6 text-gray-600"})}),je.jsx("h1",{className:"text-lg font-semibold",children:"Keranjang Belanja"})]})}),je.jsxs("div",{className:"flex flex-col items-center justify-center h-96",children:[je.jsx(L,{className:"w-16 h-16 text-gray-300 mb-4"}),je.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"Keranjang Kosong"}),je.jsxs("p",{className:"text-gray-500 text-center mb-6",children:["Belum ada produk di keranjang Anda.",je.jsx("br",{}),"Yuk mulai belanja!"]}),je.jsx("button",{onClick:i,className:"bg-gradient-to-r from-pink-500 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition-all",children:"Mulai Belanja"})]})]});const o=r();return je.jsxs("div",{className:"min-h-screen bg-gray-50 pb-32",children:[je.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:je.jsxs("div",{className:"flex items-center p-4",children:[je.jsx("button",{onClick:i,className:"mr-4",children:je.jsx(A,{className:"w-6 h-6 text-gray-600"})}),je.jsx("h1",{className:"text-lg font-semibold",children:"Keranjang Belanja"}),je.jsx("span",{className:"ml-2 bg-pink-100 text-pink-600 text-xs px-2 py-1 rounded-full",children:e.length})]})}),je.jsx("div",{className:"p-4 space-y-4",children:e.map(e=>{var r,i;const a="reseller"===(null==t?void 0:t.role)?e.resellerPrice:e.retailPrice,o=a*e.quantity;return je.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:je.jsxs("div",{className:"flex space-x-4",children:[je.jsx("img",{src:e.images[0],alt:e.name,className:"w-20 h-20 object-cover rounded-lg"}),je.jsxs("div",{className:"flex-1",children:[je.jsx("h3",{className:"font-semibold text-gray-800 mb-1",children:e.name}),e.selectedVariant&&je.jsxs("p",{className:"text-sm text-gray-500 mb-2",children:["Ukuran: ",e.selectedVariant.size," | Warna: ",e.selectedVariant.color]}),je.jsxs("div",{className:"flex items-center justify-between",children:[je.jsxs("div",{className:"flex flex-col",children:[je.jsxs("span",{className:"text-lg font-bold text-pink-600",children:["Rp ",a.toLocaleString("id-ID")]}),"reseller"===(null==t?void 0:t.role)&&je.jsx("span",{className:"text-xs text-blue-600 font-medium",children:"Harga Reseller"})]}),je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsxs("div",{className:"flex items-center space-x-2 bg-gray-100 rounded-lg p-1",children:[je.jsx("button",{onClick:()=>s(e.id,e.selectedVariant,Math.max(1,e.quantity-1)),className:"w-8 h-8 flex items-center justify-center rounded-md hover:bg-gray-200 transition-colors",children:je.jsx(R,{className:"w-4 h-4"})}),je.jsx("span",{className:"w-8 text-center font-semibold",children:e.quantity}),je.jsx("button",{onClick:()=>s(e.id,e.selectedVariant,e.quantity+1),className:"w-8 h-8 flex items-center justify-center rounded-md hover:bg-gray-200 transition-colors",children:je.jsx(O,{className:"w-4 h-4"})})]}),je.jsx("button",{onClick:()=>n(e.id,e.selectedVariant),className:"w-8 h-8 flex items-center justify-center text-red-500 hover:bg-red-50 rounded-md transition-colors",children:je.jsx(M,{className:"w-4 h-4"})})]})]}),je.jsxs("div",{className:"mt-2 text-right",children:[je.jsx("span",{className:"text-sm text-gray-600",children:"Subtotal: "}),je.jsxs("span",{className:"font-semibold text-gray-800",children:["Rp ",o.toLocaleString("id-ID")]})]})]})]})},`${e.id}-${null==(r=e.selectedVariant)?void 0:r.size}-${null==(i=e.selectedVariant)?void 0:i.color}`)})}),je.jsxs("div",{className:"fixed bottom-20 left-0 right-0 bg-white border-t border-gray-200 p-4 shadow-lg",children:[je.jsxs("div",{className:"flex items-center justify-between mb-3",children:[je.jsxs("span",{className:"text-gray-600",children:["Total (",e.length," item)"]}),je.jsxs("span",{className:"text-xl font-bold text-pink-600",children:["Rp ",o.toLocaleString("id-ID")]})]}),je.jsx("button",{onClick:a,className:"w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-4 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition-all",children:"Checkout Sekarang"})]})]})},og="azzahra-addresses",lg={API_KEY:"L3abavkD5358dc66be91f537G8MkpZHi",BASE_URL:"https://api.rajaongkir.com/starter",DELIVERY_API_KEY:"LVhqbq325358dc66be91f537xYjLL3Zi",DELIVERY_BASE_URL:"https://pro.rajaongkir.com/api"},cg=[{code:"jnt",name:"J&T Express"},{code:"jne",name:"JNE"},{code:"pos",name:"POS Indonesia"},{code:"tiki",name:"TIKI"},{code:"sicepat",name:"SiCepat Express"},{code:"wahana",name:"Wahana Prestasi Logistik"}],dg=new class{constructor(){m(this,"baseUrl",lg.BASE_URL),m(this,"deliveryBaseUrl",lg.DELIVERY_BASE_URL),m(this,"apiKey",lg.API_KEY)}getProvinces(){return g(this,null,function*(){if("localhost"===window.location.hostname)return this.getMockProvinces();try{const e=yield fetch(`${this.baseUrl}/province?key=${this.apiKey}`);if(!e.ok)throw new Error("Failed to fetch provinces");return(yield e.json()).rajaongkir.results}catch(e){return this.getMockProvinces()}})}getCities(e){return g(this,null,function*(){if("localhost"===window.location.hostname)return this.getMockCities(e);try{const t=e?`${this.baseUrl}/city?province=${e}&key=${this.apiKey}`:`${this.baseUrl}/city?key=${this.apiKey}`,s=yield fetch(t);if(!s.ok)throw new Error("Failed to fetch cities");return(yield s.json()).rajaongkir.results}catch(t){return this.getMockCities(e)}})}getSubdistricts(e){return g(this,null,function*(){if("localhost"===window.location.hostname)return this.getMockSubdistricts(e);try{const t=yield fetch(`${this.deliveryBaseUrl}/subdistrict?key=${lg.DELIVERY_API_KEY}&city=${e}`);if(!t.ok)throw new Error("Failed to fetch subdistricts");return(yield t.json()).rajaongkir.results}catch(t){return this.getMockSubdistricts(e)}})}calculateShippingCost(e,t,s){return g(this,null,function*(){if("localhost"===window.location.hostname)return this.getMockCost(lg.STORE_ORIGIN.cityId,e,t,s);try{const n=yield fetch(`${this.baseUrl}/cost`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",key:this.apiKey},body:new URLSearchParams({origin:lg.STORE_ORIGIN.cityId,destination:e,weight:t.toString(),courier:s})});if(!n.ok)throw new Error("Failed to calculate shipping cost");return(yield n.json()).rajaongkir.results}catch(n){return this.getMockCost(lg.STORE_ORIGIN.cityId,e,t,s)}})}getMockProvinces(){return[{province_id:"1",province:"Bali"},{province_id:"2",province:"Bangka Belitung"},{province_id:"3",province:"Banten"},{province_id:"4",province:"Bengkulu"},{province_id:"5",province:"Daerah Istimewa Yogyakarta"},{province_id:"6",province:"DKI Jakarta"},{province_id:"7",province:"Gorontalo"},{province_id:"8",province:"Jambi"},{province_id:"9",province:"Jawa Barat"},{province_id:"10",province:"Jawa Tengah"},{province_id:"11",province:"Jawa Timur"},{province_id:"12",province:"Kalimantan Barat"},{province_id:"13",province:"Kalimantan Selatan"},{province_id:"14",province:"Kalimantan Tengah"},{province_id:"15",province:"Kalimantan Timur"},{province_id:"16",province:"Kalimantan Utara"},{province_id:"17",province:"Kepulauan Riau"},{province_id:"18",province:"Lampung"},{province_id:"19",province:"Maluku"},{province_id:"20",province:"Maluku Utara"},{province_id:"21",province:"Nusa Tenggara Barat"},{province_id:"22",province:"Nusa Tenggara Timur"},{province_id:"23",province:"Papua"},{province_id:"24",province:"Papua Barat"},{province_id:"25",province:"Riau"},{province_id:"26",province:"Sulawesi Barat"},{province_id:"27",province:"Sulawesi Selatan"},{province_id:"28",province:"Sulawesi Tengah"},{province_id:"29",province:"Sulawesi Tenggara"},{province_id:"30",province:"Sulawesi Utara"},{province_id:"31",province:"Sumatera Barat"},{province_id:"32",province:"Sumatera Selatan"},{province_id:"33",province:"Sumatera Utara"},{province_id:"34",province:"Aceh"}]}getMockCities(e){const t=[{city_id:"17",city_name:"Badung",province:"Bali",province_id:"1",type:"Kabupaten",postal_code:"80351"},{city_id:"18",city_name:"Bangli",province:"Bali",province_id:"1",type:"Kabupaten",postal_code:"80619"},{city_id:"19",city_name:"Buleleng",province:"Bali",province_id:"1",type:"Kabupaten",postal_code:"81111"},{city_id:"20",city_name:"Gianyar",province:"Bali",province_id:"1",type:"Kabupaten",postal_code:"80511"},{city_id:"21",city_name:"Jembrana",province:"Bali",province_id:"1",type:"Kabupaten",postal_code:"82211"},{city_id:"22",city_name:"Karangasem",province:"Bali",province_id:"1",type:"Kabupaten",postal_code:"80811"},{city_id:"23",city_name:"Klungkung",province:"Bali",province_id:"1",type:"Kabupaten",postal_code:"80711"},{city_id:"24",city_name:"Tabanan",province:"Bali",province_id:"1",type:"Kabupaten",postal_code:"82111"},{city_id:"25",city_name:"Denpasar",province:"Bali",province_id:"1",type:"Kota",postal_code:"80227"},{city_id:"192",city_name:"Tanah Laut",province:"Kalimantan Selatan",province_id:"13",type:"Kabupaten",postal_code:"70811"},{city_id:"193",city_name:"Kotabaru",province:"Kalimantan Selatan",province_id:"13",type:"Kabupaten",postal_code:"72111"},{city_id:"194",city_name:"Banjar",province:"Kalimantan Selatan",province_id:"13",type:"Kabupaten",postal_code:"70611"},{city_id:"195",city_name:"Barito Kuala",province:"Kalimantan Selatan",province_id:"13",type:"Kabupaten",postal_code:"70511"},{city_id:"196",city_name:"Tapin",province:"Kalimantan Selatan",province_id:"13",type:"Kabupaten",postal_code:"71111"},{city_id:"197",city_name:"Hulu Sungai Selatan",province:"Kalimantan Selatan",province_id:"13",type:"Kabupaten",postal_code:"71211"},{city_id:"198",city_name:"Hulu Sungai Tengah",province:"Kalimantan Selatan",province_id:"13",type:"Kabupaten",postal_code:"71311"},{city_id:"199",city_name:"Hulu Sungai Utara",province:"Kalimantan Selatan",province_id:"13",type:"Kabupaten",postal_code:"71411"},{city_id:"200",city_name:"Tabalong",province:"Kalimantan Selatan",province_id:"13",type:"Kabupaten",postal_code:"71511"},{city_id:"201",city_name:"Tanah Bumbu",province:"Kalimantan Selatan",province_id:"13",type:"Kabupaten",postal_code:"72211"},{city_id:"202",city_name:"Balangan",province:"Kalimantan Selatan",province_id:"13",type:"Kabupaten",postal_code:"71611"},{city_id:"607",city_name:"Banjarmasin",province:"Kalimantan Selatan",province_id:"13",type:"Kota",postal_code:"70117"},{city_id:"608",city_name:"Banjarbaru",province:"Kalimantan Selatan",province_id:"13",type:"Kota",postal_code:"70712"},{city_id:"56",city_name:"Jakarta Pusat",province:"DKI Jakarta",province_id:"6",type:"Kota Administrasi",postal_code:"10110"},{city_id:"57",city_name:"Jakarta Utara",province:"DKI Jakarta",province_id:"6",type:"Kota Administrasi",postal_code:"14140"},{city_id:"58",city_name:"Jakarta Barat",province:"DKI Jakarta",province_id:"6",type:"Kota Administrasi",postal_code:"11110"},{city_id:"59",city_name:"Jakarta Selatan",province:"DKI Jakarta",province_id:"6",type:"Kota Administrasi",postal_code:"12110"},{city_id:"60",city_name:"Jakarta Timur",province:"DKI Jakarta",province_id:"6",type:"Kota Administrasi",postal_code:"13110"},{city_id:"61",city_name:"Kepulauan Seribu",province:"DKI Jakarta",province_id:"6",type:"Kabupaten Administrasi",postal_code:"11110"},{city_id:"43",city_name:"Bandung",province:"Jawa Barat",province_id:"9",type:"Kabupaten",postal_code:"40111"},{city_id:"44",city_name:"Bandung Barat",province:"Jawa Barat",province_id:"9",type:"Kabupaten",postal_code:"40511"},{city_id:"45",city_name:"Bekasi",province:"Jawa Barat",province_id:"9",type:"Kabupaten",postal_code:"17111"},{city_id:"46",city_name:"Bogor",province:"Jawa Barat",province_id:"9",type:"Kabupaten",postal_code:"16111"},{city_id:"47",city_name:"Ciamis",province:"Jawa Barat",province_id:"9",type:"Kabupaten",postal_code:"46211"},{city_id:"48",city_name:"Cianjur",province:"Jawa Barat",province_id:"9",type:"Kabupaten",postal_code:"43211"},{city_id:"49",city_name:"Cirebon",province:"Jawa Barat",province_id:"9",type:"Kabupaten",postal_code:"45111"},{city_id:"50",city_name:"Garut",province:"Jawa Barat",province_id:"9",type:"Kabupaten",postal_code:"44111"},{city_id:"51",city_name:"Indramayu",province:"Jawa Barat",province_id:"9",type:"Kabupaten",postal_code:"45211"},{city_id:"52",city_name:"Karawang",province:"Jawa Barat",province_id:"9",type:"Kabupaten",postal_code:"41311"},{city_id:"53",city_name:"Kuningan",province:"Jawa Barat",province_id:"9",type:"Kabupaten",postal_code:"45511"},{city_id:"54",city_name:"Majalengka",province:"Jawa Barat",province_id:"9",type:"Kabupaten",postal_code:"45411"},{city_id:"55",city_name:"Pangandaran",province:"Jawa Barat",province_id:"9",type:"Kabupaten",postal_code:"46311"},{city_id:"96",city_name:"Bandung",province:"Jawa Barat",province_id:"9",type:"Kota",postal_code:"40111"},{city_id:"97",city_name:"Banjar",province:"Jawa Barat",province_id:"9",type:"Kota",postal_code:"46311"},{city_id:"98",city_name:"Bekasi",province:"Jawa Barat",province_id:"9",type:"Kota",postal_code:"17111"},{city_id:"99",city_name:"Bogor",province:"Jawa Barat",province_id:"9",type:"Kota",postal_code:"16111"},{city_id:"100",city_name:"Cimahi",province:"Jawa Barat",province_id:"9",type:"Kota",postal_code:"40511"},{city_id:"101",city_name:"Cirebon",province:"Jawa Barat",province_id:"9",type:"Kota",postal_code:"45111"},{city_id:"102",city_name:"Depok",province:"Jawa Barat",province_id:"9",type:"Kota",postal_code:"16411"},{city_id:"103",city_name:"Sukabumi",province:"Jawa Barat",province_id:"9",type:"Kota",postal_code:"43111"},{city_id:"104",city_name:"Tasikmalaya",province:"Jawa Barat",province_id:"9",type:"Kota",postal_code:"46111"},{city_id:"69",city_name:"Semarang",province:"Jawa Tengah",province_id:"10",type:"Kabupaten",postal_code:"50111"},{city_id:"70",city_name:"Surakarta",province:"Jawa Tengah",province_id:"10",type:"Kabupaten",postal_code:"57111"},{city_id:"71",city_name:"Salatiga",province:"Jawa Tengah",province_id:"10",type:"Kabupaten",postal_code:"50711"},{city_id:"72",city_name:"Pekalongan",province:"Jawa Tengah",province_id:"10",type:"Kabupaten",postal_code:"51111"},{city_id:"73",city_name:"Tegal",province:"Jawa Tengah",province_id:"10",type:"Kabupaten",postal_code:"52111"},{city_id:"134",city_name:"Magelang",province:"Jawa Tengah",province_id:"10",type:"Kota",postal_code:"56111"},{city_id:"135",city_name:"Pekalongan",province:"Jawa Tengah",province_id:"10",type:"Kota",postal_code:"51111"},{city_id:"136",city_name:"Salatiga",province:"Jawa Tengah",province_id:"10",type:"Kota",postal_code:"50711"},{city_id:"137",city_name:"Semarang",province:"Jawa Tengah",province_id:"10",type:"Kota",postal_code:"50111"},{city_id:"138",city_name:"Surakarta",province:"Jawa Tengah",province_id:"10",type:"Kota",postal_code:"57111"},{city_id:"139",city_name:"Tegal",province:"Jawa Tengah",province_id:"10",type:"Kota",postal_code:"52111"},{city_id:"140",city_name:"Bangkalan",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"69111"},{city_id:"141",city_name:"Banyuwangi",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"68411"},{city_id:"142",city_name:"Blitar",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"66111"},{city_id:"143",city_name:"Bojonegoro",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"62111"},{city_id:"144",city_name:"Bondowoso",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"68211"},{city_id:"145",city_name:"Gresik",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"61111"},{city_id:"146",city_name:"Jember",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"68111"},{city_id:"147",city_name:"Jombang",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"61411"},{city_id:"148",city_name:"Kediri",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"64111"},{city_id:"149",city_name:"Lamongan",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"62211"},{city_id:"150",city_name:"Lumajang",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"67311"},{city_id:"151",city_name:"Madiun",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"63111"},{city_id:"152",city_name:"Magetan",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"63311"},{city_id:"153",city_name:"Malang",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"65111"},{city_id:"154",city_name:"Mojokerto",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"61311"},{city_id:"155",city_name:"Nganjuk",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"64411"},{city_id:"156",city_name:"Ngawi",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"63211"},{city_id:"157",city_name:"Pacitan",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"63511"},{city_id:"158",city_name:"Pamekasan",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"69311"},{city_id:"159",city_name:"Pasuruan",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"67111"},{city_id:"160",city_name:"Ponorogo",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"63411"},{city_id:"161",city_name:"Probolinggo",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"67211"},{city_id:"162",city_name:"Sampang",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"69211"},{city_id:"163",city_name:"Sidoarjo",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"61211"},{city_id:"164",city_name:"Situbondo",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"68311"},{city_id:"165",city_name:"Sumenep",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"69411"},{city_id:"166",city_name:"Trenggalek",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"66411"},{city_id:"167",city_name:"Tuban",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"62311"},{city_id:"168",city_name:"Tulungagung",province:"Jawa Timur",province_id:"11",type:"Kabupaten",postal_code:"66211"},{city_id:"169",city_name:"Batu",province:"Jawa Timur",province_id:"11",type:"Kota",postal_code:"65311"},{city_id:"170",city_name:"Blitar",province:"Jawa Timur",province_id:"11",type:"Kota",postal_code:"66111"},{city_id:"171",city_name:"Kediri",province:"Jawa Timur",province_id:"11",type:"Kota",postal_code:"64111"},{city_id:"172",city_name:"Madiun",province:"Jawa Timur",province_id:"11",type:"Kota",postal_code:"63111"},{city_id:"173",city_name:"Malang",province:"Jawa Timur",province_id:"11",type:"Kota",postal_code:"65111"},{city_id:"174",city_name:"Mojokerto",province:"Jawa Timur",province_id:"11",type:"Kota",postal_code:"61311"},{city_id:"175",city_name:"Pasuruan",province:"Jawa Timur",province_id:"11",type:"Kota",postal_code:"67111"},{city_id:"176",city_name:"Probolinggo",province:"Jawa Timur",province_id:"11",type:"Kota",postal_code:"67211"},{city_id:"177",city_name:"Surabaya",province:"Jawa Timur",province_id:"11",type:"Kota",postal_code:"60111"},{city_id:"1",city_name:"Sibolga",province:"Sumatera Utara",province_id:"33",type:"Kota",postal_code:"22511"},{city_id:"2",city_name:"Tanjung Balai",province:"Sumatera Utara",province_id:"33",type:"Kota",postal_code:"21311"},{city_id:"3",city_name:"Pematangsiantar",province:"Sumatera Utara",province_id:"33",type:"Kota",postal_code:"21111"},{city_id:"4",city_name:"Tebing Tinggi",province:"Sumatera Utara",province_id:"33",type:"Kota",postal_code:"20611"},{city_id:"5",city_name:"Binjai",province:"Sumatera Utara",province_id:"33",type:"Kota",postal_code:"20711"},{city_id:"6",city_name:"Medan",province:"Sumatera Utara",province_id:"33",type:"Kota",postal_code:"20111"},{city_id:"7",city_name:"Padangsidimpuan",province:"Sumatera Utara",province_id:"33",type:"Kota",postal_code:"22711"},{city_id:"8",city_name:"Gunungsitoli",province:"Sumatera Utara",province_id:"33",type:"Kota",postal_code:"22811"}];return e?t.filter(t=>t.province_id===e):t}getMockSubdistricts(e){return{607:[{subdistrict_id:"60701",subdistrict_name:"Banjarmasin Utara",city_id:"607",city:"Banjarmasin",province:"Kalimantan Selatan",province_id:"13",type:"Kecamatan"},{subdistrict_id:"60702",subdistrict_name:"Banjarmasin Tengah",city_id:"607",city:"Banjarmasin",province:"Kalimantan Selatan",province_id:"13",type:"Kecamatan"},{subdistrict_id:"60703",subdistrict_name:"Banjarmasin Selatan",city_id:"607",city:"Banjarmasin",province:"Kalimantan Selatan",province_id:"13",type:"Kecamatan"},{subdistrict_id:"60704",subdistrict_name:"Banjarmasin Barat",city_id:"607",city:"Banjarmasin",province:"Kalimantan Selatan",province_id:"13",type:"Kecamatan"},{subdistrict_id:"60705",subdistrict_name:"Banjarmasin Timur",city_id:"607",city:"Banjarmasin",province:"Kalimantan Selatan",province_id:"13",type:"Kecamatan"}],177:[{subdistrict_id:"17701",subdistrict_name:"Gubeng",city_id:"177",city:"Surabaya",province:"Jawa Timur",province_id:"11",type:"Kecamatan"},{subdistrict_id:"17702",subdistrict_name:"Sukolilo",city_id:"177",city:"Surabaya",province:"Jawa Timur",province_id:"11",type:"Kecamatan"},{subdistrict_id:"17703",subdistrict_name:"Tegalsari",city_id:"177",city:"Surabaya",province:"Jawa Timur",province_id:"11",type:"Kecamatan"},{subdistrict_id:"17704",subdistrict_name:"Simokerto",city_id:"177",city:"Surabaya",province:"Jawa Timur",province_id:"11",type:"Kecamatan"},{subdistrict_id:"17705",subdistrict_name:"Tambaksari",city_id:"177",city:"Surabaya",province:"Jawa Timur",province_id:"11",type:"Kecamatan"}],6:[{subdistrict_id:"601",subdistrict_name:"Medan Barat",city_id:"6",city:"Medan",province:"Sumatera Utara",province_id:"33",type:"Kecamatan"},{subdistrict_id:"602",subdistrict_name:"Medan Timur",city_id:"6",city:"Medan",province:"Sumatera Utara",province_id:"33",type:"Kecamatan"},{subdistrict_id:"603",subdistrict_name:"Medan Selatan",city_id:"6",city:"Medan",province:"Sumatera Utara",province_id:"33",type:"Kecamatan"},{subdistrict_id:"604",subdistrict_name:"Medan Utara",city_id:"6",city:"Medan",province:"Sumatera Utara",province_id:"33",type:"Kecamatan"}]}[e]||[{subdistrict_id:"1",subdistrict_name:"Kecamatan Default",city_id:e,city:"Unknown",province:"Unknown",province_id:"0",type:"Kecamatan"}]}getMockCost(e,t,s,n){var r;const i={jnt:15e3,jne:18e3,pos:2e4,tiki:17e3,sicepat:16e3,wahana:12e3}[n]||15e3,a=Math.max(1,s/1e3),o=Math.floor(1e4*Math.random())+5e3,l=Math.round(i*a+o);return[{code:n.toUpperCase(),name:(null==(r=cg.find(e=>e.code===n))?void 0:r.name)||n.toUpperCase(),costs:[{service:"Regular Package",description:"Paket reguler",cost:[{value:l,etd:{jnt:"2-3 hari",jne:"2-4 hari",pos:"3-5 hari",tiki:"2-3 hari",sicepat:"1-2 hari",wahana:"3-6 hari"}[n]||"2-4 hari",note:"Mock calculation"}]}]}]}formatFullAddress(e){return[e.subdistrict,e.district,e.cityName,e.provinceName].filter(Boolean).join(", ")}isCourierSupported(e){return cg.some(t=>t.code===e)}},ug=({initialData:t,onSave:s,onCancel:n})=>{const[r,i]=f.useState({name:(null==t?void 0:t.name)||"",phone:(null==t?void 0:t.phone)||"",fullAddress:(null==t?void 0:t.fullAddress)||"",province:(null==t?void 0:t.province)||"",provinceId:(null==t?void 0:t.provinceId)||"",city:(null==t?void 0:t.city)||"",cityId:(null==t?void 0:t.cityId)||"",district:(null==t?void 0:t.district)||"",subdistrict:(null==t?void 0:t.subdistrict)||"",subdistrictId:(null==t?void 0:t.subdistrictId)||"",postalCode:(null==t?void 0:t.postalCode)||"",isDefault:(null==t?void 0:t.isDefault)||!1}),[a,o]=f.useState([]),[l,c]=f.useState([]),[h,m]=f.useState([]),[p,x]=f.useState(!1),[y,v]=f.useState(!1),[b,w]=f.useState(!1),[N,j]=f.useState(""),[_,k]=f.useState({});f.useEffect(()=>{S()},[]),f.useEffect(()=>{r.provinceId&&(T(r.provinceId),c([]),m([]),i(e=>u(d({},e),{cityId:"",city:"",district:"",subdistrict:"",subdistrictId:"",postalCode:""})))},[r.provinceId]),f.useEffect(()=>{r.cityId&&(I(r.cityId),m([]),i(e=>u(d({},e),{district:"",subdistrict:"",subdistrictId:"",postalCode:""})))},[r.cityId]),f.useEffect(()=>{if(r.subdistrictId&&l.length>0){const e=l.find(e=>e.city_id===r.cityId);e&&i(t=>u(d({},t),{postalCode:e.postal_code}))}},[r.subdistrictId,r.cityId,l]);const S=()=>g(e,null,function*(){try{x(!0),j("");const e=yield dg.getProvinces();o(e)}catch(e){j("Gagal memuat data provinsi"),console.error("Error loading provinces:",e)}finally{x(!1)}}),T=t=>g(e,null,function*(){try{v(!0),j("");const e=yield dg.getCities(t);c(e)}catch(e){j("Gagal memuat data kota"),console.error("Error loading cities:",e)}finally{v(!1)}}),I=t=>g(e,null,function*(){try{w(!0),j("");const e=yield dg.getSubdistricts(t);m(e)}catch(e){j("Gagal memuat data kecamatan"),console.error("Error loading subdistricts:",e)}finally{w(!1)}}),E=e=>{const{name:t,value:s,type:n}=e.target;let r="checkbox"===n?e.target.checked:s;i(e=>{const n=u(d({},e),{[t]:r});if("provinceId"===t){const e=a.find(e=>e.province_id===s);e&&(n.province=e.province)}if("cityId"===t){const e=l.find(e=>e.city_id===s);e&&(n.city=e.city_name,n.postalCode=e.postal_code)}if("subdistrictId"===t){const e=h.find(e=>e.subdistrict_id===s);e&&(n.district=e.subdistrict_name,n.subdistrict=e.subdistrict_name)}return n}),_[t]&&k(e=>u(d({},e),{[t]:void 0}))};return je.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),(()=>{const e={};return r.name.trim()||(e.name="Nama harus diisi"),r.phone.trim()||(e.phone="Nomor telepon harus diisi"),r.provinceId.trim()||(e.provinceId="Provinsi harus diisi"),r.cityId.trim()||(e.cityId="Kota harus diisi"),r.district.trim()||(e.district="Kecamatan harus diisi"),r.subdistrict.trim()||(e.subdistrict="Kelurahan harus diisi"),r.postalCode.trim()||(e.postalCode="Kode pos harus diisi"),k(e),0===Object.keys(e).length})()){const e=`${r.fullAddress}, ${r.subdistrict}, ${r.district}, ${r.city}, ${r.province}`,t=u(d({},r),{fullAddress:e});s(t)}},className:"space-y-4",children:[N&&je.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:je.jsxs("div",{className:"flex items-center text-red-800",children:[je.jsx(F,{className:"w-4 h-4 mr-2"}),je.jsx("span",{className:"text-sm",children:N})]})}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nama Lengkap *"}),je.jsx("input",{type:"text",name:"name",value:r.name,onChange:E,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(_.name?"border-red-500":"border-gray-300"),placeholder:"Masukkan nama lengkap"}),_.name&&je.jsx("p",{className:"text-red-500 text-xs mt-1",children:_.name})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nomor Telepon *"}),je.jsx("input",{type:"tel",name:"phone",value:r.phone,onChange:E,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(_.phone?"border-red-500":"border-gray-300"),placeholder:"Masukkan nomor telepon aktif"}),_.phone&&je.jsx("p",{className:"text-red-500 text-xs mt-1",children:_.phone})]}),je.jsxs("div",{children:[je.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[je.jsx(U,{className:"w-4 h-4 inline mr-1"}),"Provinsi *"]}),je.jsxs("select",{name:"provinceId",value:r.provinceId,onChange:E,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(_.provinceId?"border-red-500":"border-gray-300"),disabled:p,children:[je.jsx("option",{value:"",children:"Pilih provinsi"}),a.map(e=>je.jsx("option",{value:e.province_id,children:e.province},e.province_id))]}),p&&je.jsxs("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:[je.jsx(V,{className:"w-4 h-4 animate-spin mr-1"}),"Memuat provinsi..."]}),_.provinceId&&je.jsx("p",{className:"text-red-500 text-xs mt-1",children:_.provinceId})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kota/Kabupaten *"}),je.jsxs("select",{name:"cityId",value:r.cityId,onChange:E,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(_.cityId?"border-red-500":"border-gray-300"),disabled:!r.provinceId||y,children:[je.jsx("option",{value:"",children:"Pilih kota/kabupaten"}),l.map(e=>je.jsxs("option",{value:e.city_id,children:[e.type," ",e.city_name]},e.city_id))]}),y&&je.jsxs("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:[je.jsx(V,{className:"w-4 h-4 animate-spin mr-1"}),"Memuat kota..."]}),_.cityId&&je.jsx("p",{className:"text-red-500 text-xs mt-1",children:_.cityId})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kecamatan *"}),je.jsxs("select",{name:"subdistrictId",value:r.subdistrictId,onChange:E,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(_.district?"border-red-500":"border-gray-300"),disabled:!r.cityId||b,children:[je.jsx("option",{value:"",children:"Pilih kecamatan"}),h.map(e=>je.jsx("option",{value:e.subdistrict_id,children:e.subdistrict_name},e.subdistrict_id))]}),b&&je.jsxs("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:[je.jsx(V,{className:"w-4 h-4 animate-spin mr-1"}),"Memuat kecamatan..."]}),_.district&&je.jsx("p",{className:"text-red-500 text-xs mt-1",children:_.district})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kelurahan/Desa *"}),je.jsx("input",{type:"text",name:"subdistrict",value:r.subdistrict,onChange:E,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(_.subdistrict?"border-red-500":"border-gray-300"),placeholder:"Masukkan nama kelurahan/desa"}),_.subdistrict&&je.jsx("p",{className:"text-red-500 text-xs mt-1",children:_.subdistrict})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kode Pos *"}),je.jsx("input",{type:"text",name:"postalCode",value:r.postalCode,onChange:E,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(_.postalCode?"border-red-500":"border-gray-300"),placeholder:"Masukkan kode pos",maxLength:5}),_.postalCode&&je.jsx("p",{className:"text-red-500 text-xs mt-1",children:_.postalCode})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Alamat Detail (Jalan, RT/RW, No. Rumah) *"}),je.jsx("textarea",{name:"fullAddress",value:r.fullAddress,onChange:E,rows:3,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(_.fullAddress?"border-red-500":"border-gray-300"),placeholder:"Contoh: Jl. Merdeka No. 123, RT 001/RW 002"}),_.fullAddress&&je.jsx("p",{className:"text-red-500 text-xs mt-1",children:_.fullAddress})]}),je.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:je.jsxs("p",{className:"text-sm text-blue-800",children:[je.jsx("strong",{children:"Preview Alamat:"}),je.jsx("br",{}),r.fullAddress&&`${r.fullAddress}, `,r.subdistrict,", ",r.district,", ",r.city,", ",r.province,", ",r.postalCode]})}),je.jsxs("div",{className:"flex items-center",children:[je.jsx("input",{type:"checkbox",name:"isDefault",checked:r.isDefault,onChange:E,className:"w-4 h-4 text-pink-600 border-gray-300 rounded focus:ring-pink-500"}),je.jsx("label",{className:"ml-2 text-sm text-gray-700",children:"Jadikan alamat utama"})]}),je.jsxs("div",{className:"flex space-x-3 pt-4",children:[je.jsx("button",{type:"button",onClick:n,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Batal"}),je.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition-colors font-medium",children:t?"Update":"Simpan"})]})]})},hg=({cartItems:t,user:s,getTotalPrice:n,clearCart:r,onBack:i})=>{const[a,o]=f.useState(!1),[l,c]=f.useState(""),[h,m]=f.useState(null),{addresses:p,addAddress:x,updateAddress:y,deleteAddress:v,getDefaultAddress:b}=(()=>{const[e,t]=f.useState([]),[s,n]=f.useState(!0);f.useEffect(()=>{r()},[]);const r=()=>{try{const e=localStorage.getItem(og);e&&t(JSON.parse(e))}catch(e){console.error("Failed to load addresses:",e)}finally{n(!1)}},i=e=>{localStorage.setItem(og,JSON.stringify(e)),t(e)};return{addresses:e,loading:s,addAddress:t=>{const s=u(d({},t),{id:Date.now().toString()});if(0===e.length||t.isDefault){const t=e.map(e=>u(d({},e),{isDefault:!1}));i([...t,s])}else i([...e,s])},updateAddress:(t,s)=>{const n=e.map(e=>e.id===t?d(d({},e),s):s.isDefault?u(d({},e),{isDefault:!1}):e),r=n.find(e=>e.id===t&&s.isDefault);i(r?n.map(e=>e.id===t?e:u(d({},e),{isDefault:!1})):n)},deleteAddress:t=>{const s=e.find(e=>e.id===t);if(e.length<=1)alert("Tidak dapat menghapus alamat. Minimal harus ada satu alamat.");else if(null==s?void 0:s.isDefault){const s=e.filter(e=>e.id!==t);s.length>0&&(s[0].isDefault=!0),i(s)}else i(e.filter(e=>e.id!==t))},setDefaultAddress:t=>{i(e.map(e=>u(d({},e),{isDefault:e.id===t})))},getDefaultAddress:()=>e.find(e=>e.isDefault)||e[0],refresh:r}})(),[w,N]=f.useState(!1),[j,_]=f.useState([]),[k,T]=f.useState(""),I=()=>t.reduce((e,t)=>e+1e3*t.quantity,0),E=(t,s,n)=>g(e,null,function*(){if(console.log("ðŸš€ calculateShippingCost called with:",{courierCode:t,destinationCityId:s,weight:n}),t&&s&&n){s&&"undefined"!==s&&""!==s||(console.log("âŒ Invalid destinationCityId, using fallback Banjarmasin (607)"),s="607");try{N(!0),T(""),console.log("ðŸ“¡ Calling rajaOngkirService.calculateShippingCost...");const e=yield dg.calculateShippingCost(s,n,t);if(console.log("ðŸ“¦ Results from service:",e),e.length>0&&e[0].costs.length>0){const t=e[0].costs[0],s=t.cost[0].value;console.log("ðŸ’° Setting shipping cost:",s),P(e=>u(d({},e),{shippingCost:s,shippingService:t.service,shippingETD:t.cost[0].etd}))}else console.log("âŒ No results from API, using fallback"),T("Tidak dapat menghitung ongkir untuk kurir ini"),P(e=>u(d({},e),{shippingCost:15e3}))}catch(e){console.log("âŒ Error in calculateShippingCost:",e),T(""),P(e=>u(d({},e),{shippingCost:15e3}))}finally{N(!1)}}else console.log("âŒ Missing required parameters")}),[C,P]=f.useState({name:(null==s?void 0:s.name)||"",phone:"",address:"",provinceId:"",cityId:"",isDropship:!1,dropshipName:"",dropshipPhone:"",paymentMethod:"transfer",shippingCourier:"jnt",shippingCost:0,shippingService:"",shippingETD:"",notes:""}),D=[{id:"jnt",name:"J&T Express",code:"jnt",price:0},{id:"jne",name:"JNE",code:"jne",price:0},{id:"pos",name:"POS Indonesia",code:"pos",price:0},{id:"tiki",name:"TIKI",code:"tiki",price:0},{id:"ojek",name:"OJEK",code:null,price:0},{id:"lion",name:"Lion Parcel",code:null,price:0},{id:"idexpress",name:"ID Express",code:null,price:0}];f.useEffect(()=>{const e=D.find(e=>e.code);if(e&&!C.shippingCourier&&P(t=>u(d({},t),{shippingCourier:e.id})),p.length>0&&!l){const t=b();if(t)if(c(t.id),P(e=>u(d({},e),{name:e.isDropship?e.name:t.name,phone:e.isDropship?e.phone:t.phone,address:t.fullAddress,provinceId:t.provinceId||"607",cityId:t.cityId||"607"})),(null==e?void 0:e.code)&&t.cityId){const s=I();E(e.code,t.cityId,s)}else if(null==e?void 0:e.code){const t=I();E(e.code,"607",t)}}},[p,l,C.shippingCourier,C.isDropship]);const R=e=>{const{name:t,value:s,type:n}=e.target,r="checkbox"===n?e.target.checked:"number"===n?parseInt(s)||0:s;if(P(e=>u(d({},e),{[t]:r})),"shippingCourier"===t){const e=D.find(e=>e.id===s);if(null==e?void 0:e.code){const t=I();E(e.code,"607",t)}else P(e=>u(d({},e),{shippingCost:15e3,shippingService:"",shippingETD:""}))}};f.useEffect(()=>{const e=b();e&&(c(e.id),P(t=>u(d({},t),{name:e.name,phone:e.phone,address:e.fullAddress})))},[p]);const L=e=>{if(window.confirm("Apakah Anda yakin ingin menghapus alamat ini?")&&(v(e),l===e)){const e=b();e&&(e=>{c(e);const t=p.find(t=>t.id===e);t&&P(e=>u(d({},e),{name:C.isDropship?e.name:t.name,phone:C.isDropship?e.phone:t.phone,address:C.isDropship?e.address:t.fullAddress}))})(e.id)}},$=(e,t)=>{navigator.clipboard.writeText(e),alert(`âœ… Nomor rekening ${t} berhasil disalin!\n\n${e}\na.n. Fahrin`)},H=n(),G=C.shippingCost||0,J=H+G,W=D.find(e=>e.id===C.shippingCourier),Q=!!(null==W?void 0:W.code);return je.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[je.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:je.jsxs("div",{className:"flex items-center p-4",children:[je.jsx("button",{onClick:i,className:"mr-4",children:je.jsx(A,{className:"w-6 h-6 text-gray-600"})}),je.jsx("h1",{className:"text-lg font-semibold",children:"Checkout"})]})}),je.jsxs("div",{className:"p-4 space-y-4",children:[je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsx("h3",{className:"font-semibold mb-3",children:"Produk Pesanan"}),je.jsx("div",{className:"space-y-3",children:t.map(e=>{var t,n;return je.jsxs("div",{className:"flex space-x-3",children:[je.jsx("img",{src:e.images[0],alt:e.name,className:"w-16 h-16 object-cover rounded-lg"}),je.jsxs("div",{className:"flex-1",children:[je.jsx("h4",{className:"font-medium text-sm",children:e.name}),e.selectedVariant&&je.jsxs("p",{className:"text-xs text-gray-500",children:[e.selectedVariant.size," - ",e.selectedVariant.color]}),je.jsxs("div",{className:"flex justify-between items-center mt-1",children:[je.jsxs("span",{className:"text-sm font-semibold text-pink-600",children:["Rp ",("reseller"===(null==s?void 0:s.role)?e.resellerPrice:e.retailPrice).toLocaleString("id-ID")]}),je.jsxs("span",{className:"text-sm text-gray-500",children:["x",e.quantity]})]})]})]},`${e.id}-${null==(t=e.selectedVariant)?void 0:t.size}-${null==(n=e.selectedVariant)?void 0:n.color}`)})})]}),je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsx("h3",{className:"font-semibold mb-3",children:"Informasi Penerima"}),je.jsxs("div",{className:"space-y-4",children:[je.jsxs("div",{children:[je.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[je.jsx(S,{className:"w-4 h-4 inline mr-1"}),"Nama Penerima"]}),je.jsx("input",{type:"text",name:"name",value:C.name,onChange:R,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Masukkan nama penerima"})]}),je.jsxs("div",{children:[je.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[je.jsx(B,{className:"w-4 h-4 inline mr-1"}),"Nomor Telepon"]}),je.jsx("input",{type:"tel",name:"phone",value:C.phone,onChange:R,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Masukkan nomor telepon"})]})]})]}),je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsx("h3",{className:"font-semibold mb-3",children:"Pilih Kurir Pengiriman"}),je.jsxs("div",{className:"space-y-3",children:[je.jsxs("div",{children:[je.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[je.jsx(K,{className:"w-4 h-4 inline mr-1"}),"Kurir"]}),je.jsx("select",{name:"shippingCourier",value:C.shippingCourier,onChange:R,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",children:D.map(e=>je.jsxs("option",{value:e.id,children:[e.name," ",e.code?"(âœ“ Otomatis)":"(Manual)"]},e.id))}),je.jsx("div",{className:"mt-2 text-xs text-gray-500",children:Q?je.jsx("div",{className:"text-green-600",children:"âœ“ Otomatis via RajaOngkir dari Banjarmasin"}):je.jsx("div",{className:"text-amber-600",children:"â„¹ï¸ Kurir lokal - biaya diinput manual"})}),w&&je.jsxs("div",{className:"mt-2 flex items-center text-sm text-blue-600",children:[je.jsx(V,{className:"w-4 h-4 animate-spin mr-1"}),"Menghitung ongkir..."]}),k&&je.jsxs("div",{className:"mt-2 text-sm text-red-600 flex items-center",children:[je.jsx(F,{className:"w-4 h-4 mr-1"}),k]})]}),C.shippingCost>0&&je.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[je.jsxs("div",{className:"flex justify-between items-center",children:[je.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Biaya Ongkir:"}),je.jsxs("span",{className:"text-sm font-semibold text-pink-600",children:["Rp ",C.shippingCost.toLocaleString("id-ID")]})]}),C.shippingService&&je.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Service: ",C.shippingService," | Estimasi: ",C.shippingETD]})]})]})]}),je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsxs("div",{className:"flex justify-between items-center mb-3",children:[je.jsx("h3",{className:"font-semibold",children:"Alamat Pengiriman"}),je.jsxs("button",{onClick:()=>o(!0),className:"text-pink-600 hover:text-pink-700 flex items-center text-sm font-medium",children:[je.jsx(O,{className:"w-4 h-4 mr-1"}),"Tambah Alamat"]})]}),p.length>0&&je.jsx("div",{className:"space-y-2 mb-4",children:p.map(e=>je.jsx("label",{className:"block p-3 border rounded-lg cursor-pointer transition-colors "+(l===e.id?"border-pink-500 bg-pink-50":"border-gray-200 hover:border-gray-300"),children:je.jsxs("div",{className:"flex items-start justify-between",children:[je.jsxs("div",{className:"flex-1",children:[je.jsxs("div",{className:"flex items-center mb-1",children:[je.jsx("input",{type:"radio",name:"savedAddress",checked:l===e.id,onChange:()=>{if(console.log("ðŸ” Selected address:",e),console.log("ðŸ” supportsAutomatic:",Q),console.log("ðŸ” formData.shippingCourier:",C.shippingCourier),c(e.id),P(t=>u(d({},t),{name:C.isDropship?t.name:e.name,phone:C.isDropship?t.phone:e.phone,address:e.fullAddress,provinceId:e.provinceId||"",cityId:e.cityId||""})),Q&&C.shippingCourier){const t=D.find(e=>e.id===C.shippingCourier);if(console.log("ðŸ” selectedCourier:",t),console.log("ðŸ” address.cityId:",e.cityId),null==t?void 0:t.code){const s=I(),n=e.cityId||"607";console.log("ðŸš€ Calling calculateShippingCost with:",t.code,n,s),E(t.code,n,s)}else console.log("âŒ Missing courier code")}else console.log("âŒ Either not automatic or no courier selected")},className:"w-4 h-4 text-pink-600 mr-2"}),je.jsx("span",{className:"font-medium",children:e.name}),e.isDefault&&je.jsx("span",{className:"ml-2 text-xs bg-green-100 text-green-600 px-2 py-1 rounded-full",children:"Utama"})]}),je.jsx("p",{className:"text-sm text-gray-600 ml-6",children:e.phone}),je.jsx("p",{className:"text-sm text-gray-600 ml-6",children:e.fullAddress})]}),je.jsxs("div",{className:"flex space-x-2",children:[je.jsx("button",{onClick:t=>{t.stopPropagation(),m(e),o(!0)},className:"text-blue-600 hover:text-blue-700",children:je.jsx(z,{className:"w-4 h-4"})}),p.length>1&&je.jsx("button",{onClick:t=>{t.stopPropagation(),L(e.id)},className:"text-red-600 hover:text-red-700",children:je.jsx(M,{className:"w-4 h-4"})})]})]})},e.id))}),je.jsxs("div",{className:"border-t pt-4",children:[je.jsx("div",{className:"flex items-center justify-between mb-3",children:je.jsxs("label",{className:"text-sm font-medium text-gray-700",children:[je.jsx(U,{className:"w-4 h-4 inline mr-1"}),0===p.length?"Alamat Pengiriman":"Atau Tambah Alamat Baru"]})}),je.jsx("div",{children:je.jsxs("div",{children:[je.jsx("textarea",{name:"address",value:C.address,onChange:R,rows:4,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Masukkan alamat lengkap (Jalan, RT/RW, Kelurahan, Kecamatan, Kota, Provinsi)"}),je.jsx("p",{className:"text-xs text-green-600 mt-1",children:"âœ“ Ongkir akan dihitung otomatis untuk kurir ini"})]})}),!Q&&je.jsxs("div",{className:"mt-4",children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Biaya Ongkos Kirim (Rp)"}),je.jsx("input",{type:"number",name:"shippingCost",value:C.shippingCost||"",onChange:R,min:"0",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Masukkan biaya ongkos kirim"}),je.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"* Masukkan manual biaya ongkos kirim untuk kurir lokal"})]})]})]}),je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsx("h3",{className:"font-semibold mb-3",children:"Opsi Tambahan"}),je.jsx("div",{className:"mb-4",children:je.jsxs("label",{className:"flex items-center space-x-3",children:[je.jsx("input",{type:"checkbox",name:"isDropship",checked:C.isDropship,onChange:R,className:"w-4 h-4 text-pink-600 border-gray-300 rounded focus:ring-pink-500"}),je.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Kirim sebagai dropship"})]})}),C.isDropship&&je.jsxs("div",{className:"border-t pt-4 space-y-3",children:[je.jsx("input",{type:"text",name:"dropshipName",value:C.dropshipName,onChange:R,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Nama pengirim dropship"}),je.jsx("input",{type:"tel",name:"dropshipPhone",value:C.dropshipPhone,onChange:R,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Nomor telepon pengirim"})]}),je.jsxs("div",{className:"border-t pt-4",children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Catatan Pesanan"}),je.jsx("textarea",{name:"notes",value:C.notes,onChange:R,rows:3,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Tambahkan catatan untuk pesanan (opsional)"})]})]}),je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsx("h3",{className:"font-semibold mb-3",children:"Metode Pembayaran"}),je.jsxs("div",{className:"space-y-3",children:[je.jsxs("label",{className:"flex items-center space-x-3",children:[je.jsx("input",{type:"radio",name:"paymentMethod",value:"transfer",checked:"transfer"===C.paymentMethod,onChange:R,className:"w-4 h-4 text-pink-600 border-gray-300 focus:ring-pink-500"}),je.jsx("span",{className:"text-sm font-medium",children:"Transfer Bank"})]}),je.jsxs("label",{className:"flex items-center space-x-3",children:[je.jsx("input",{type:"radio",name:"paymentMethod",value:"cod",checked:"cod"===C.paymentMethod,onChange:R,className:"w-4 h-4 text-pink-600 border-gray-300 focus:ring-pink-500"}),je.jsx("span",{className:"text-sm font-medium",children:"COD (Bayar di Tempat)"})]})]}),"transfer"===C.paymentMethod&&je.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:[je.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Transfer ke:"}),je.jsxs("div",{className:"space-y-2 text-sm",children:[je.jsxs("div",{className:"flex justify-between items-center",children:[je.jsx("span",{children:"BCA: 0511456494"}),je.jsxs("button",{onClick:()=>$("0511456494","BCA"),className:"text-blue-600 hover:text-blue-700 text-xs",children:[je.jsx(q,{className:"w-3 h-3 inline mr-1"}),"Salin"]})]}),je.jsxs("div",{className:"flex justify-between items-center",children:[je.jsx("span",{children:"BRI: 066301000115566"}),je.jsxs("button",{onClick:()=>$("066301000115566","BRI"),className:"text-blue-600 hover:text-blue-700 text-xs",children:[je.jsx(q,{className:"w-3 h-3 inline mr-1"}),"Salin"]})]}),je.jsxs("div",{className:"flex justify-between items-center",children:[je.jsx("span",{children:"MANDIRI: 310011008896"}),je.jsxs("button",{onClick:()=>$("310011008896","MANDIRI"),className:"text-blue-600 hover:text-blue-700 text-xs",children:[je.jsx(q,{className:"w-3 h-3 inline mr-1"}),"Salin"]})]})]}),je.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"a.n. Fahrin"})]})]}),je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsx("h3",{className:"font-semibold mb-3",children:"Ringkasan Pesanan"}),je.jsxs("div",{className:"space-y-2",children:[je.jsxs("div",{className:"flex justify-between",children:[je.jsx("span",{className:"text-sm text-gray-600",children:"Subtotal Produk"}),je.jsxs("span",{className:"text-sm font-medium",children:["Rp ",H.toLocaleString("id-ID")]})]}),je.jsxs("div",{className:"flex justify-between",children:[je.jsx("span",{className:"text-sm text-gray-600",children:"Biaya Ongkir"}),je.jsxs("span",{className:"text-sm font-medium",children:["Rp ",G.toLocaleString("id-ID")]})]}),je.jsx("div",{className:"border-t pt-2",children:je.jsxs("div",{className:"flex justify-between",children:[je.jsx("span",{className:"font-semibold",children:"Total"}),je.jsxs("span",{className:"font-semibold text-pink-600",children:["Rp ",J.toLocaleString("id-ID")]})]})})]})]}),je.jsx("button",{onClick:()=>{if(!C.name||!C.phone||!C.address)return void alert("Mohon lengkapi semua data pengiriman");const e={shippingInfo:{name:C.name,phone:C.phone,address:C.address,isDropship:C.isDropship,dropshipName:C.dropshipName,dropshipPhone:C.dropshipPhone,courier:C.shippingCourier,shippingCost:C.shippingCost,shippingService:C.shippingService,shippingETD:C.shippingETD},paymentMethod:C.paymentMethod,notes:C.notes},t=r(e);"transfer"===C.paymentMethod?alert(`ðŸŽ‰ Pesanan berhasil dibuat!\n\nID Pesanan: ${t}\nTotal: Rp ${J.toLocaleString("id-ID")}\n\nSilakan transfer ke:\nâ€¢ BCA: 0511456494\nâ€¢ BRI: 066301000115566\nâ€¢ MANDIRI: 310011008896\n\na.n. Fahrin\n\nKemudian upload bukti pembayaran di menu "Pesanan"`):alert(`ðŸŽ‰ Pesanan berhasil dibuat!\n\nID Pesanan: ${t}\nTotal: Rp ${J.toLocaleString("id-ID")}\n\nPembayaran Cash on Delivery (COD)\nBarang akan dikirim setelah konfirmasi.`),i()},className:"w-full bg-pink-600 text-white py-4 rounded-lg font-semibold hover:bg-pink-700 transition-colors shadow-lg",children:"Buat Pesanan"})]}),a&&je.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:je.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[je.jsx("h3",{className:"text-lg font-semibold mb-4",children:h?"Edit Alamat":"Tambah Alamat Baru"}),je.jsx(ug,{initialData:h,onSave:e=>{h?y(h.id,e):x(e),o(!1),m(null)},onCancel:()=>{o(!1),m(null)}})]})})]})},mg=()=>{const[t,s]=f.useState(null),[n,r]=f.useState(!0),[i,a]=f.useState(null);f.useEffect(()=>tg.onAuthStateChanged(e=>{var t;if(r(!1),e){const n={uid:e.uid,email:e.email||"",displayName:e.displayName||(null==(t=e.email)?void 0:t.split("@")[0])||"",role:o(e.email||"")};s(n),console.log("âœ… Firebase user authenticated:",n)}else s(null),console.log("â„¹ï¸ No Firebase user authenticated")}),[]);const o=e=>{const t=e.toLowerCase();return"v4hrin@gmail.com"===t||t.includes("owner")?"owner":t.includes("admin")?"admin":t.includes("reseller")?"reseller":"customer"},l=e=>{switch(e){case"auth/user-not-found":return"Email tidak terdaftar. Silakan coba lagi.";case"auth/wrong-password":return"Password salah. Silakan coba lagi.";case"auth/email-already-in-use":return"Email sudah terdaftar. Silakan gunakan email lain.";case"auth/weak-password":return"Password terlalu lemah. Gunakan minimal 6 karakter.";case"auth/invalid-email":return"Format email tidak valid. Silakan coba lagi.";case"auth/too-many-requests":return"Terlalu banyak percobaan login. Silakan coba lagi nanti.";case"auth/user-disabled":return"Akun dinonaktifkan. Hubungi admin.";default:return"Login gagal. Silakan coba lagi."}};return{user:t,loading:n,error:i,login:(t,n)=>g(e,null,function*(){var e;try{a(null),r(!0);const i=(yield Km(tg,t,n)).user;if(i){const t={uid:i.uid,email:i.email||"",displayName:i.displayName||(null==(e=i.email)?void 0:e.split("@")[0])||"",role:o(i.email||"")};return s(t),console.log("âœ… Firebase login successful:",t),t}}catch(i){throw console.error("âŒ Firebase login error:",i),a(l(i.code)),i}finally{r(!1)}}),register:(t,n,i,c)=>g(e,null,function*(){var e;try{a(null),r(!0);const l=yield function(e,t,s){return g(this,null,function*(){if(js(e.app))return Promise.reject(rh(e));const n=lm(e),r=xm(n,{returnSecureToken:!0,email:t,password:s,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Om),i=yield r.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&Bm(e),t}),a=yield Lm._fromIdTokenResponse(n,"signIn",i);return yield n._updateCurrentUser(a.user),a})}(tg,t,n),d=l.user;if(d&&i&&(yield d.updateProfile({displayName:i})),d){const t={uid:d.uid,email:d.email||"",displayName:i||(null==(e=d.email)?void 0:e.split("@")[0])||"",role:c||o(d.email||"")};return s(t),console.log("âœ… Firebase registration successful:",t),t}}catch(d){throw console.error("âŒ Firebase registration error:",d),a(l(d.code)),d}finally{r(!1)}}),logout:()=>g(e,null,function*(){try{yield(e=tg,dt(e).signOut()),s(null),console.log("âœ… Firebase logout successful")}catch(t){console.error("âŒ Firebase logout error:",t),a(l(t.code))}var e}),isAuthenticated:!!t}},pg=({onSuccess:t,onClose:s,onShowRegister:n})=>{const[r,i]=f.useState(""),[a,o]=f.useState(""),[l,c]=f.useState(!1),{login:d,loading:u,error:h}=mg();return je.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:je.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[je.jsxs("div",{className:"flex justify-between items-center mb-6",children:[je.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Login"}),je.jsx("button",{onClick:s,className:"text-gray-500 hover:text-gray-700 transition-colors",children:je.jsx($,{size:24})})]}),je.jsxs("form",{onSubmit:s=>g(e,null,function*(){var e;if(s.preventDefault(),r&&a)try{console.log("ðŸ”„ Firebase login attempt:",r);const s=yield d(r,a);if(s){const n={id:s.uid,name:s.displayName||(null==(e=s.email)?void 0:e.split("@")[0])||"",email:s.email,role:s.role};console.log("âœ… Firebase login successful:",n),t(n)}}catch(n){console.error("âŒ Firebase login error:",n)}}),className:"space-y-4",children:[je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),je.jsxs("div",{className:"relative",children:[je.jsx(H,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),je.jsx("input",{type:"email",value:r,onChange:e=>i(e.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"email@example.com",required:!0})]})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),je.jsxs("div",{className:"relative",children:[je.jsx(G,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),je.jsx("input",{type:l?"text":"password",value:a,onChange:e=>o(e.target.value),className:"w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0}),je.jsx("button",{type:"button",onClick:()=>c(!l),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:l?je.jsx(J,{size:20}):je.jsx(W,{size:20})})]})]}),h&&je.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-3 py-2 rounded",children:h}),je.jsx("button",{type:"submit",disabled:u,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:u?"Loading...":"Login"})]}),n&&je.jsx("div",{className:"mt-4 text-center",children:je.jsx("button",{onClick:n,className:"text-blue-600 hover:text-blue-700 text-sm font-medium transition-colors",children:"Belum punya akun? Daftar di sini"})}),je.jsxs("div",{className:"mt-4 text-center text-sm text-gray-600",children:[je.jsx("p",{className:"font-semibold mb-2",children:"ðŸ”¥ Firebase Authentication"}),je.jsxs("div",{className:"space-y-1 text-xs",children:[je.jsxs("p",{children:[je.jsx("strong",{children:"Owner:"})," v4hrin@gmail.com / (password Anda)"]}),je.jsxs("p",{children:[je.jsx("strong",{children:"Admin:"})," admin@azzahra.com / admin123"]}),je.jsxs("p",{children:[je.jsx("strong",{children:"Reseller:"})," reseller@azzahra.com / reseller123"]}),je.jsxs("p",{children:[je.jsx("strong",{children:"Customer:"})," [email lain] / [password]"]})]}),je.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"* Email harus terdaftar di Firebase Authentication"})]})]})})},gg=({onClose:t,onSuccess:s})=>{const[n,r]=f.useState(""),[i,a]=f.useState(""),[o,l]=f.useState(""),[c,d]=f.useState(""),[u,h]=f.useState("customer"),[m,p]=f.useState(!1),[x,y]=f.useState(!1),[v,b]=f.useState(!1),[w,N]=f.useState(""),[j,_]=f.useState(1),{register:k}=mg(),S=e=>{switch(e){case"owner":return"bg-red-500 hover:bg-red-600 text-white";case"admin":return"bg-purple-500 hover:bg-purple-600 text-white";case"reseller":return"bg-blue-500 hover:bg-blue-600 text-white";default:return"bg-green-500 hover:bg-green-600 text-white"}};return 1===j?je.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:je.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md",children:[je.jsx("div",{className:"p-6 border-b border-gray-100",children:je.jsxs("div",{className:"flex items-center justify-between",children:[je.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Pilih Role Akun"}),je.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:je.jsx($,{className:"w-5 h-5 text-gray-500"})})]})}),je.jsxs("div",{className:"p-6",children:[je.jsx("p",{className:"text-gray-600 mb-6",children:"Pilih jenis akun yang ingin Anda daftarkan:"}),je.jsx("div",{className:"space-y-3",children:[{role:"owner",title:"Owner",desc:"Pemilik bisnis - Akses penuh"},{role:"admin",title:"Administrator",desc:"Admin - Kelola produk dan pesanan"},{role:"reseller",title:"Reseller",desc:"Penjual reseller - Harga khusus"},{role:"customer",title:"Customer",desc:"Pelanggan - Belanja biasa"}].map(({role:e,title:t,desc:s})=>{const n=(e=>{switch(e){case"owner":return X;case"admin":return Y;default:return Q}})(e);return je.jsx("button",{onClick:()=>{h(e),_(2)},className:"w-full p-4 rounded-lg border-2 transition-all "+(u===e?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300"),children:je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx("div",{className:`p-2 rounded-lg ${S(e)}`,children:je.jsx(n,{className:"w-5 h-5"})}),je.jsxs("div",{className:"text-left",children:[je.jsx("h3",{className:"font-semibold text-gray-800",children:t}),je.jsx("p",{className:"text-sm text-gray-600",children:s})]})]})},e)})})]})]})}):je.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:je.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md",children:[je.jsx("div",{className:"p-6 border-b border-gray-100",children:je.jsxs("div",{className:"flex items-center justify-between",children:[je.jsxs("h2",{className:"text-xl font-bold text-gray-800",children:["Daftar ","owner"===u?"Owner":"admin"===u?"Admin":"reseller"===u?"Reseller":"Customer"]}),je.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:je.jsx($,{className:"w-5 h-5 text-gray-500"})})]})}),je.jsxs("div",{className:"p-6",children:[w&&je.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:je.jsx("p",{className:"text-red-600 text-sm",children:w})}),je.jsxs("form",{onSubmit:r=>g(e,null,function*(){if(r.preventDefault(),N(""),n&&i&&o&&c)if(i===o)if(i.length<6)N("Password minimal 6 karakter!");else{b(!0);try{console.log("ðŸ”„ Firebase registration attempt:",{email:n,displayName:c,role:u});const e=yield k(n,i,c,u);if(e){const n={id:e.uid,name:e.displayName||c,email:e.email,role:e.role};console.log("âœ… Firebase registration successful:",n),s(n),t()}}catch(e){console.error("âŒ Firebase registration error:",e),N(e.message||"Registrasi gagal. Silakan coba lagi.")}finally{b(!1)}}else N("Password tidak cocok!");else N("Semua field harus diisi!")}),className:"space-y-4",children:[je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nama Lengkap"}),je.jsx("input",{type:"text",value:c,onChange:e=>d(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Masukkan nama lengkap",required:!0})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),je.jsx("input",{type:"email",value:n,onChange:e=>r(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:`contoh: ${u}@azzahra.com`,required:!0})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),je.jsxs("div",{className:"relative",children:[je.jsx("input",{type:m?"text":"password",value:i,onChange:e=>a(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent pr-10",placeholder:"Minimal 6 karakter",required:!0}),je.jsx("button",{type:"button",onClick:()=>p(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:m?je.jsx(J,{className:"w-5 h-5"}):je.jsx(W,{className:"w-5 h-5"})})]})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password"}),je.jsxs("div",{className:"relative",children:[je.jsx("input",{type:x?"text":"password",value:o,onChange:e=>l(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent pr-10",placeholder:"Konfirmasi password",required:!0}),je.jsx("button",{type:"button",onClick:()=>y(!x),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:x?je.jsx(J,{className:"w-5 h-5"}):je.jsx(W,{className:"w-5 h-5"})})]})]}),je.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg",children:[je.jsxs("p",{className:"text-sm text-purple-700",children:[je.jsx("strong",{children:"Role:"})," ",u.charAt(0).toUpperCase()+u.slice(1)]}),je.jsxs("p",{className:"text-xs text-purple-600 mt-1",children:["owner"===u&&"Akses penuh ke semua fitur admin","admin"===u&&"Akses kelola produk dan pesanan","reseller"===u&&"Harga reseller dan poin reward","customer"===u&&"Akses berbelanja biasa"]})]}),je.jsxs("div",{className:"flex space-x-3 pt-4",children:[je.jsx("button",{type:"button",onClick:()=>_(1),className:"flex-1 p-3 border border-gray-300 text-gray-600 rounded-lg hover:bg-gray-50 transition-colors",children:"Kembali"}),je.jsx("button",{type:"submit",disabled:v,className:"flex-1 p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50",children:v?"Mendaftar...":"Daftar"})]})]})]})]})})},fg=({user:e,cartItems:t,products:s,loading:n,onProductClick:r,onCartClick:i,onAddToCart:a})=>{const{timeLeft:o,isFlashSaleActive:l,loading:c}=ng(),[d,u]=f.useState(0);console.log("âš¡ FlashSalePage Debug:",{isFlashSaleActive:l,timeLeft:o,flashSaleLoading:c}),f.useEffect(()=>{const e=e=>{var t;console.log("ðŸ”„ Flash sale ended event received:",e.detail),console.log("ðŸ”„ Updating FlashSalePage..."),u(e=>e+1),"time_expired"===(null==(t=e.detail)?void 0:t.reason)&&(window.flashSaleRefreshTimer&&clearTimeout(window.flashSaleRefreshTimer),window.flashSaleRefreshTimer=setTimeout(()=>{console.log("ðŸ”„ Auto-refreshing FlashSalePage after time expired"),window.location.reload()},3e3))};window.addEventListener("flashSaleEnded",e);const t=()=>{console.log("ðŸ”„ Flash sale updated event received"),u(e=>e+1)};return window.addEventListener("flashSaleUpdated",t),()=>{window.removeEventListener("flashSaleEnded",e),window.removeEventListener("flashSaleUpdated",t)}},[]),f.useEffect(()=>{const e=()=>{try{const e=localStorage.getItem("azzahra-flashsale");if(e){const t=JSON.parse(e);if(t&&t.isActive){const e=(new Date).getTime();e>=new Date(t.endTime).getTime()&&(console.log("â° FlashSalePage: Flash sale ended, triggering cleanup"),window.dispatchEvent(new CustomEvent("flashSaleEnded",{detail:{timestamp:(new Date).toISOString(),reason:"time_expired_page_check",source:"FlashSalePage"}})),localStorage.removeItem("azzahra-flashsale"),t.isActive=!1,u(e=>e+1))}}}catch(e){console.error("Error in FlashSalePage real-time check:",e)}};e();const t=setInterval(e,2e3);return()=>clearInterval(t)},[]),f.useEffect(()=>{const e=e=>{console.log("Products updated in FlashSalePage:",e.detail),u(e=>e+1)};return window.addEventListener("productsUpdated",e),()=>{window.removeEventListener("productsUpdated",e)}},[]);const h=e=>{a(e)},m=f.useMemo(()=>{try{if(!Array.isArray(s)||0===s.length)return console.warn("âš ï¸ FlashSale: Products array is empty or invalid"),[];const t=s.filter(e=>e&&e.id&&e.name);let n;try{const e=localStorage.getItem("azzahra-flashsale");if(n=e?JSON.parse(e):null,n&&n.isActive){const e=(new Date).getTime(),t=new Date(n.endTime).getTime();e<new Date(n.startTime).getTime()?(console.log("â° Flash sale has not started yet"),n.isActive=!1):e>=t&&(console.log("â° Flash sale has ended! Deactivating..."),n.isActive=!1,localStorage.removeItem("azzahra-flashsale"))}}catch(e){console.warn("âš ï¸ Error parsing flash sale config:",e),n=null}return t.filter(t=>{try{if(!t||!t.id)return console.warn("âš ï¸ Invalid product found:",t),!1;let e=!1;if(!0===t.isFlashSale&&(e=!0),n&&!0===n.isActive){const s=Array.isArray(n.products)&&n.products.includes(t.id),r=Array.isArray(n.productIds)&&n.productIds.includes(t.id);(s||r)&&(e=!0)}return e&&console.log(`âœ… Product ${t.name} (${t.id}) is in flash sale`),e}catch(e){return console.warn("âš ï¸ Error checking flash sale for product:",t.id,e),!1}})}catch(t){return console.error("ðŸš¨ Error in flashSaleProducts calculation:",t),[]}},[s,d,o]);return n?je.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center",children:je.jsx("div",{className:"text-white text-xl",children:"Loading flash sale products..."})}):0===m.length?je.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900",children:je.jsxs("div",{className:"container mx-auto px-4 py-8",children:[je.jsxs("div",{className:"flex items-center justify-between mb-8",children:[je.jsx("h1",{className:"text-xl font-bold text-white",children:"Flash Sale âš¡"}),je.jsxs("button",{onClick:i,className:"relative p-2 bg-white/20 rounded-full hover:bg-white/30 transition-colors",children:[je.jsx(b,{className:"w-6 h-6 text-white"}),t.length>0&&je.jsx("span",{className:"absolute -top-2 -right-2 bg-yellow-400 text-gray-800 text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold",children:t.length})]})]}),je.jsxs("div",{className:"bg-gradient-to-br from-gray-700 via-gray-600 to-gray-500 rounded-2xl p-8 text-center max-w-3xl mx-auto shadow-2xl relative overflow-hidden",children:[je.jsxs("div",{className:"absolute inset-0 opacity-10",children:[je.jsx("div",{className:"absolute top-4 left-4 w-32 h-32 bg-white rounded-full -ml-16 -mt-16 animate-pulse"}),je.jsx("div",{className:"absolute bottom-4 right-4 w-24 h-24 bg-white rounded-full -mr-12 -mb-12 animate-pulse delay-100"})]}),je.jsxs("div",{className:"relative z-10",children:[je.jsx("div",{className:"bg-white/20 backdrop-blur-sm p-4 rounded-full w-20 h-20 mx-auto mb-6 shadow-lg",children:je.jsx("span",{className:"text-4xl",children:"â°"})}),je.jsx("h2",{className:"text-3xl font-bold bg-gradient-to-r from-yellow-200 to-white bg-clip-text text-transparent mb-4",children:"Flash Sale Sedang Disiapkan"}),je.jsx("p",{className:"text-gray-200 text-lg mb-2",children:"Nantikan Flash Sale Kami Selanjutnya!"}),je.jsx("p",{className:"text-gray-300 text-sm mb-8",children:"Diskon spesial dan penawaran terbatas akan segera hadir. Pastikan Anda tidak ketinggalan!"}),je.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[je.jsx("button",{onClick:()=>window.history.back(),className:"bg-white text-gray-700 px-6 py-3 rounded-full font-bold hover:bg-gray-50 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105",children:"Kembali"}),je.jsx("button",{onClick:()=>window.location.href="/",className:"bg-purple-600 text-white px-6 py-3 rounded-full font-bold hover:bg-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105",children:"Lihat Produk Lainnya"})]})]})]})]})}):je.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 pb-20",children:je.jsxs("div",{className:"container mx-auto px-4 py-8",children:[je.jsxs("div",{className:"flex items-center justify-between mb-6",children:[je.jsx("h1",{className:"text-xl font-bold text-white",children:"Flash Sale âš¡"}),je.jsxs("button",{onClick:i,className:"relative p-2 bg-white/20 rounded-full hover:bg-white/30 transition-colors",children:[je.jsx(b,{className:"w-6 h-6 text-white"}),t.length>0&&je.jsx("span",{className:"absolute -top-2 -right-2 bg-yellow-400 text-gray-800 text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold",children:t.length})]})]}),je.jsxs("div",{className:"bg-gradient-to-r from-red-600 to-orange-600 rounded-2xl p-8 mb-6 text-center relative overflow-hidden",children:[je.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-yellow-400 rounded-full -mr-16 -mt-16 opacity-20"}),je.jsx("div",{className:"absolute bottom-0 left-0 w-40 h-40 bg-yellow-400 rounded-full -ml-20 -mb-20 opacity-20"}),je.jsxs("div",{className:"relative z-10",children:[je.jsxs("div",{className:"flex items-center justify-center mb-4",children:[je.jsx(Z,{className:"w-12 h-12 text-yellow-300 mr-3"}),je.jsx("h1",{className:"text-4xl font-bold text-white",children:"FLASH SALE"}),je.jsx(Z,{className:"w-12 h-12 text-yellow-300 ml-3"})]}),je.jsx("p",{className:"text-xl text-white/90 mb-6",children:"Diskon Hingga 70%"}),o&&je.jsxs("div",{className:"bg-black/30 backdrop-blur-sm rounded-xl p-4 mb-4",children:[je.jsx("p",{className:"text-yellow-300 text-sm mb-2",children:"â° Flash Sale Berakhir Dalam"}),je.jsx("div",{className:"text-3xl font-bold text-white tracking-wider",children:o})]}),je.jsxs("div",{className:"flex items-center justify-center space-x-4 text-white/80",children:[je.jsxs("div",{className:"flex items-center",children:[je.jsx(ee,{className:"w-5 h-5 mr-1"}),je.jsx("span",{className:"text-sm",children:"Terbatas"})]}),je.jsxs("div",{className:"flex items-center",children:[je.jsx(te,{className:"w-5 h-5 mr-1"}),je.jsx("span",{className:"text-sm",children:"Diskon Spesial"})]})]})]})]}),je.jsxs("div",{className:"text-center text-white/60 text-sm mb-6",children:[m.length," produk flash sale tersedia"]}),je.jsx("div",{className:"grid grid-cols-2 gap-4",children:m.map(t=>je.jsx(Ce,{product:t,onProductClick:r,onAddToCart:h,isFlashSale:!0,user:e},t.id))})]})})},xg=({user:t})=>{const[s,n]=f.useState("all"),[r,i]=f.useState(null),[a,o]=f.useState(!1),[l,c]=f.useState(null),{orders:d,updateOrderPayment:u}=Ie(),h=e=>{i(e),o(!0)},m=()=>{o(!1),i(null),c(null)},p=(e,t)=>{navigator.clipboard.writeText(e),alert(`âœ… Nomor rekening ${t} berhasil disalin!\n\n${e}\na.n. Fahrin`)},x=d.filter(e=>e.userId===(null==t?void 0:t.id)),y="all"===s?x:x.filter(e=>e.status===s),v={pending:{label:"Menunggu Pembayaran",icon:I,color:"text-orange-600 bg-orange-100"},awaiting_verification:{label:"Menunggu Verifikasi",icon:I,color:"text-yellow-600 bg-yellow-100"},paid:{label:"Dibayar",icon:ne,color:"text-blue-600 bg-blue-100"},processing:{label:"Dikemas",icon:K,color:"text-blue-600 bg-blue-100"},shipped:{label:"Dikirim",icon:re,color:"text-purple-600 bg-purple-100"},delivered:{label:"Selesai",icon:ne,color:"text-green-600 bg-green-100"},cancelled:{label:"Dibatalkan",icon:se,color:"text-red-600 bg-red-100"}};return je.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[je.jsxs("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:[je.jsx("div",{className:"p-4",children:je.jsx("h1",{className:"text-lg font-semibold text-center",children:"Pesanan Saya"})}),je.jsx("div",{className:"px-4 pb-4",children:je.jsxs("div",{className:"relative",children:[je.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),je.jsx("input",{type:"text",placeholder:"Cari pesanan...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"})]})}),je.jsx("div",{className:"flex overflow-x-auto px-4 pb-2",children:[{id:"all",label:"Semua"},{id:"pending",label:"Belum Bayar"},{id:"awaiting_verification",label:"Menunggu Verifikasi"},{id:"processing",label:"Dikemas"},{id:"shipped",label:"Dikirim"},{id:"delivered",label:"Selesai"}].map(e=>je.jsx("button",{onClick:()=>n(e.id),className:"flex-shrink-0 px-4 py-2 mr-2 rounded-full text-sm font-medium transition-colors "+(s===e.id?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:e.label},e.id))})]}),je.jsx("div",{className:"p-4 space-y-4",children:0===y.length?je.jsxs("div",{className:"text-center py-12",children:[je.jsx(K,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),je.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"Belum Ada Pesanan"}),je.jsx("p",{className:"text-gray-500",children:"Pesanan Anda akan muncul di sini"})]}):y.map(e=>{const t=v[e.status],s=t.icon;return je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsxs("div",{className:"flex items-center justify-between mb-3",children:[je.jsxs("div",{children:[je.jsxs("p",{className:"font-semibold text-gray-800",children:["#",e.id]}),je.jsx("p",{className:"text-sm text-gray-500",children:e.createdAt.toLocaleDateString("id-ID")})]}),je.jsxs("div",{className:`flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium ${t.color}`,children:[je.jsx(s,{className:"w-3 h-3"}),je.jsx("span",{children:t.label})]})]}),je.jsx("div",{className:"space-y-2 mb-3",children:e.items.map((e,t)=>je.jsxs("div",{className:"flex justify-between text-sm",children:[je.jsxs("span",{className:"text-gray-600",children:[e.productName," x",e.quantity]}),je.jsxs("span",{className:"font-medium",children:["Rp ",e.total.toLocaleString("id-ID")]})]},t))}),je.jsxs("div",{className:"border-t pt-3 flex items-center justify-between",children:[je.jsx("span",{className:"text-sm text-gray-600",children:"Total Pesanan"}),je.jsxs("span",{className:"font-bold text-pink-600",children:["Rp ",e.finalTotal.toLocaleString("id-ID")]})]}),je.jsxs("div",{className:"mt-3 flex space-x-2",children:[je.jsx("button",{className:"flex-1 bg-gray-100 text-gray-600 py-2 rounded-lg text-sm font-medium hover:bg-gray-200 transition-colors",children:"Detail"}),"pending"===e.status&&"transfer"===e.paymentMethod&&!e.paymentProof&&je.jsxs("button",{onClick:()=>h(e),className:"flex-1 bg-orange-500 text-white py-2 rounded-lg text-sm font-medium hover:bg-orange-600 transition-colors flex items-center justify-center space-x-1",children:[je.jsx(ie,{className:"w-4 h-4"}),je.jsx("span",{children:"Bayar"})]}),("pending"===e.status||"awaiting_verification"===e.status)&&e.paymentProof&&je.jsxs("div",{className:"flex-1 flex space-x-2",children:[je.jsx("div",{className:"flex-1 bg-yellow-100 text-yellow-700 py-2 rounded-lg text-sm font-medium text-center",children:"â³ Menunggu Verifikasi"}),je.jsxs("button",{onClick:()=>h(e),className:"px-3 py-2 bg-blue-500 text-white rounded-lg text-sm font-medium hover:bg-blue-600 transition-colors flex items-center space-x-1",children:[je.jsx(ae,{className:"w-3 h-3"}),je.jsx("span",{children:"Upload Ulang"})]})]}),"paid"===e.status&&je.jsx("div",{className:"flex-1 bg-blue-100 text-blue-700 py-2 rounded-lg text-sm font-medium text-center",children:"âœ… Pembayaran Terverifikasi"}),"delivered"===e.status&&je.jsx("button",{className:"flex-1 bg-pink-500 text-white py-2 rounded-lg text-sm font-medium hover:bg-pink-600 transition-colors",children:"Beli Lagi"})]})]},e.id)})}),a&&r&&je.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:je.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md relative max-h-[90vh] overflow-y-auto",children:[je.jsx("button",{onClick:m,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600",children:je.jsx($,{size:24})}),je.jsxs("div",{className:"text-center mb-6",children:[je.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Pembayaran"}),je.jsxs("p",{className:"text-sm text-gray-600",children:["Pesanan #",r.id]}),je.jsxs("p",{className:"text-lg font-bold text-pink-600 mt-2",children:["Rp ",r.finalTotal.toLocaleString("id-ID")]}),r.paymentProof&&je.jsxs("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[je.jsx("p",{className:"text-yellow-800 text-sm font-medium",children:"ðŸ“„ Upload Ulang Bukti Pembayaran"}),je.jsxs("p",{className:"text-yellow-600 text-xs mt-1",children:["Bukti sebelumnya: ",r.paymentProof]})]})]}),je.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 mb-6",children:[je.jsx("h4",{className:"font-semibold text-blue-800 mb-3",children:"Transfer ke Rekening:"}),je.jsxs("div",{className:"space-y-3 text-sm",children:[je.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded-lg border border-blue-200",children:[je.jsxs("div",{children:[je.jsx("span",{className:"font-medium text-gray-700",children:"BCA"}),je.jsx("div",{className:"font-mono text-xs text-gray-600",children:"0511456494"})]}),je.jsxs("button",{onClick:()=>p("0511456494","BCA"),className:"flex items-center space-x-1 text-blue-600 hover:text-blue-700 text-xs font-medium transition-colors",children:[je.jsx(q,{className:"w-3 h-3"}),je.jsx("span",{children:"Salin"})]})]}),je.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded-lg border border-blue-200",children:[je.jsxs("div",{children:[je.jsx("span",{className:"font-medium text-gray-700",children:"BRI"}),je.jsx("div",{className:"font-mono text-xs text-gray-600",children:"066301000115566"})]}),je.jsxs("button",{onClick:()=>p("066301000115566","BRI"),className:"flex items-center space-x-1 text-blue-600 hover:text-blue-700 text-xs font-medium transition-colors",children:[je.jsx(q,{className:"w-3 h-3"}),je.jsx("span",{children:"Salin"})]})]}),je.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded-lg border border-blue-200",children:[je.jsxs("div",{children:[je.jsx("span",{className:"font-medium text-gray-700",children:"MANDIRI"}),je.jsx("div",{className:"font-mono text-xs text-gray-600",children:"310011008896"})]}),je.jsxs("button",{onClick:()=>p("310011008896","MANDIRI"),className:"flex items-center space-x-1 text-blue-600 hover:text-blue-700 text-xs font-medium transition-colors",children:[je.jsx(q,{className:"w-3 h-3"}),je.jsx("span",{children:"Salin"})]})]}),je.jsx("div",{className:"text-center mt-3 p-2 bg-blue-100 rounded-lg",children:je.jsx("p",{className:"text-blue-700 font-semibold text-sm",children:"a.n. Fahrin"})})]})]}),je.jsxs("div",{className:"mb-6",children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload Bukti Pembayaran"}),je.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[je.jsx("input",{type:"file",accept:"image/*",onChange:e=>{e.target.files&&e.target.files[0]&&c(e.target.files[0])},className:"hidden",id:"payment-proof-modal"}),je.jsxs("label",{htmlFor:"payment-proof-modal",className:"cursor-pointer",children:[je.jsx(ae,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),je.jsx("p",{className:"text-sm text-gray-600",children:l?l.name:"Klik untuk upload bukti transfer"})]})]})]}),je.jsx("button",{onClick:()=>g(e,null,function*(){if(r&&l)try{yield u(r.id,l.name,"awaiting_verification"),m();const e=r.paymentProof?"Bukti pembayaran berhasil diupload ulang! Menunggu verifikasi admin.":"Bukti pembayaran berhasil dikirim! Menunggu verifikasi admin.";alert(e)}catch(e){console.error("Error submitting payment:",e)}}),disabled:!l,className:"w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 px-4 rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed font-semibold transition-all",children:(null==r?void 0:r.paymentProof)?"Upload Ulang Bukti Pembayaran":"Kirim Bukti Pembayaran"})]})})]})},yg=({user:t,onLogout:s,onNavigateToAdminProducts:n,onNavigateToAdminOrders:r,onNavigateToAdminReports:i,onNavigateToAdminUsers:a})=>{const[o,l]=f.useState(!1),[c,h]=f.useState(!1),[m,p]=f.useState(!1),[x,y]=f.useState({currentPassword:"",newPassword:"",confirmPassword:""}),b=t;console.log("ðŸ”¥ AccountPage rendered - user role:",null==b?void 0:b.role),console.log("ðŸ”¥ AccountPage rendered - final user role:",null==b?void 0:b.role),console.log("ðŸ”¥ User object:",b),console.log("ðŸ”¥ AccountPage loaded with complete settings menu!");const w=t=>g(e,null,function*(){if(t.preventDefault(),x.newPassword===x.confirmPassword)if(x.newPassword.length<6)alert("Password minimal 6 karakter!");else try{alert("âœ… Password berhasil diubah!"),y({currentPassword:"",newPassword:"",confirmPassword:""}),l(!1)}catch(e){alert("âŒ Gagal mengubah password: "+e.message)}else alert("Password baru tidak cocok!")});if(!b){console.log("âš ï¸ AccountPage: User is null, checking for stored sessions");try{let e=localStorage.getItem("temp_user_session");if(e||(e=localStorage.getItem("azzahra_current_user")),e)return console.log("ðŸ”„ AccountPage: Found stored user session, reloading page to restore..."),console.log("ðŸ’¡ This should trigger the useSupabaseAuthSimple hook to restore the session properly"),setTimeout(()=>{window.location.reload()},100),je.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:je.jsxs("div",{className:"text-center",children:[je.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),je.jsx("p",{className:"text-gray-600",children:"Memulihkan sesi pengguna..."})]})});console.log("â„¹ï¸ AccountPage: No stored user session found")}catch(_){console.error("âŒ AccountPage: Failed to restore user session:",_)}return je.jsx("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 to-purple-50 flex items-center justify-center",children:je.jsxs("div",{className:"text-center",children:[je.jsx(S,{className:"w-16 h-16 text-purple-400 mx-auto mb-4"}),je.jsx("p",{className:"text-gray-600 mb-4",children:"Silakan login terlebih dahulu"}),je.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Muat Ulang Halaman"})]})})}const N=(e=>{switch(e){case"owner":return{text:"Owner",icon:X,color:"text-red-600 bg-red-100"};case"admin":return{text:"Administrator",icon:v,color:"text-purple-600 bg-purple-100"};case"reseller":return{text:"Reseller",icon:S,color:"text-blue-600 bg-blue-100"};default:return{text:"Customer",icon:S,color:"text-green-600 bg-green-100"}}})(b.role),j=N.icon;return je.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[je.jsxs("div",{className:"bg-gradient-to-r from-pink-500 to-purple-600 text-white p-6",children:[je.jsxs("div",{className:"flex items-center space-x-4",children:[je.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-full flex items-center justify-center",children:je.jsx(S,{className:"w-8 h-8"})}),je.jsxs("div",{className:"flex-1",children:[je.jsx("h2",{className:"text-xl font-bold",children:b.name}),je.jsx("p",{className:"text-pink-100",children:b.email}),je.jsxs("div",{className:`inline-flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium mt-2 ${N.color}`,children:[je.jsx(j,{className:"w-3 h-3"}),je.jsx("span",{className:"text-gray-800",children:N.text})]})]})]}),"reseller"===b.role&&je.jsx("div",{className:"mt-4 bg-white/10 rounded-lg p-3",children:je.jsxs("div",{className:"flex items-center justify-between",children:[je.jsx("span",{className:"text-sm",children:"Total Poin"}),je.jsxs("span",{className:"text-lg font-bold",children:[b.points||0," pts"]})]})})]}),je.jsx("div",{className:"p-4",children:(()=>{switch(b.role){case"customer":return je.jsxs("div",{className:"space-y-4",children:[je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Informasi Akun"}),je.jsxs("div",{className:"space-y-3",children:[je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx(S,{className:"w-5 h-5 text-gray-400"}),je.jsxs("div",{children:[je.jsx("p",{className:"text-sm text-gray-500",children:"Username"}),je.jsx("p",{className:"font-medium",children:b.name})]})]}),je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx(H,{className:"w-5 h-5 text-gray-400"}),je.jsxs("div",{children:[je.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),je.jsx("p",{className:"font-medium",children:b.email})]})]}),je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx(B,{className:"w-5 h-5 text-gray-400"}),je.jsxs("div",{children:[je.jsx("p",{className:"text-sm text-gray-500",children:"Telepon"}),je.jsx("p",{className:"font-medium",children:b.phone||"Belum diisi"})]})]})]})]}),je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Keamanan"}),je.jsx("button",{onClick:()=>l(!o),className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx(ue,{className:"w-5 h-5 text-gray-400"}),je.jsxs("div",{className:"flex-1",children:[je.jsx("p",{className:"font-medium",children:"Ubah Password"}),je.jsx("p",{className:"text-sm text-gray-500",children:"Keamanan akun Anda"})]})]})}),o&&je.jsxs("form",{onSubmit:w,className:"mt-4 space-y-3",children:[je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Saat Ini"}),je.jsxs("div",{className:"relative",children:[je.jsx("input",{type:c?"text":"password",value:x.currentPassword,onChange:e=>y(u(d({},x),{currentPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),je.jsx("button",{type:"button",onClick:()=>h(!c),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:c?je.jsx(J,{className:"w-5 h-5"}):je.jsx(W,{className:"w-5 h-5"})})]})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Baru"}),je.jsxs("div",{className:"relative",children:[je.jsx("input",{type:m?"text":"password",value:x.newPassword,onChange:e=>y(u(d({},x),{newPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),je.jsx("button",{type:"button",onClick:()=>p(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:m?je.jsx(J,{className:"w-5 h-5"}):je.jsx(W,{className:"w-5 h-5"})})]})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password Baru"}),je.jsx("input",{type:"password",value:x.confirmPassword,onChange:e=>y(u(d({},x),{confirmPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg",required:!0})]}),je.jsxs("div",{className:"flex space-x-3",children:[je.jsx("button",{type:"button",onClick:()=>l(!1),className:"flex-1 p-3 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50",children:"Batal"}),je.jsx("button",{type:"submit",className:"flex-1 p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Simpan"})]})]})]}),je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Preferensi"}),je.jsxs("div",{className:"space-y-3",children:[je.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx(D,{className:"w-5 h-5 text-gray-400"}),je.jsxs("div",{className:"flex-1",children:[je.jsx("p",{className:"font-medium",children:"Wishlist"}),je.jsx("p",{className:"text-sm text-gray-500",children:"Produk favorit Anda"})]})]})}),je.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx(U,{className:"w-5 h-5 text-gray-400"}),je.jsxs("div",{className:"flex-1",children:[je.jsx("p",{className:"font-medium",children:"Alamat Pengiriman"}),je.jsx("p",{className:"text-sm text-gray-500",children:"Kelola alamat Anda"})]})]})})]})]})]});case"reseller":return je.jsxs("div",{className:"space-y-4",children:[je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Informasi Akun"}),je.jsxs("div",{className:"space-y-3",children:[je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx(S,{className:"w-5 h-5 text-gray-400"}),je.jsxs("div",{children:[je.jsx("p",{className:"text-sm text-gray-500",children:"Username"}),je.jsx("p",{className:"font-medium",children:b.name})]})]}),je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx(H,{className:"w-5 h-5 text-gray-400"}),je.jsxs("div",{children:[je.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),je.jsx("p",{className:"font-medium",children:b.email})]})]}),je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx(B,{className:"w-5 h-5 text-gray-400"}),je.jsxs("div",{children:[je.jsx("p",{className:"text-sm text-gray-500",children:"Telepon"}),je.jsx("p",{className:"font-medium",children:b.phone||"Belum diisi"})]})]})]})]}),je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Point Reseller"}),je.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg p-4 text-white",children:[je.jsxs("div",{className:"flex items-center justify-between mb-2",children:[je.jsx("span",{className:"text-sm opacity-90",children:"Total Poin"}),je.jsx(pe,{className:"w-6 h-6"})]}),je.jsxs("div",{className:"text-3xl font-bold",children:[b.points||0," pts"]}),je.jsx("div",{className:"mt-2 text-sm opacity-90",children:"Tukar dengan diskon khusus!"})]})]}),je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Keamanan"}),je.jsx("button",{onClick:()=>l(!o),className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx(ue,{className:"w-5 h-5 text-gray-400"}),je.jsxs("div",{className:"flex-1",children:[je.jsx("p",{className:"font-medium",children:"Ubah Password"}),je.jsx("p",{className:"text-sm text-gray-500",children:"Keamanan akun Anda"})]})]})}),o&&je.jsxs("form",{onSubmit:w,className:"mt-4 space-y-3",children:[je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Saat Ini"}),je.jsxs("div",{className:"relative",children:[je.jsx("input",{type:c?"text":"password",value:x.currentPassword,onChange:e=>y(u(d({},x),{currentPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),je.jsx("button",{type:"button",onClick:()=>h(!c),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:c?je.jsx(J,{className:"w-5 h-5"}):je.jsx(W,{className:"w-5 h-5"})})]})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Baru"}),je.jsxs("div",{className:"relative",children:[je.jsx("input",{type:m?"text":"password",value:x.newPassword,onChange:e=>y(u(d({},x),{newPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),je.jsx("button",{type:"button",onClick:()=>p(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:m?je.jsx(J,{className:"w-5 h-5"}):je.jsx(W,{className:"w-5 h-5"})})]})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password Baru"}),je.jsx("input",{type:"password",value:x.confirmPassword,onChange:e=>y(u(d({},x),{confirmPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg",required:!0})]}),je.jsxs("div",{className:"flex space-x-3",children:[je.jsx("button",{type:"button",onClick:()=>l(!1),className:"flex-1 p-3 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50",children:"Batal"}),je.jsx("button",{type:"submit",className:"flex-1 p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Simpan"})]})]})]}),je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Preferensi Reseller"}),je.jsxs("div",{className:"space-y-3",children:[je.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx(D,{className:"w-5 h-5 text-gray-400"}),je.jsxs("div",{className:"flex-1",children:[je.jsx("p",{className:"font-medium",children:"Wishlist"}),je.jsx("p",{className:"text-sm text-gray-500",children:"Produk favorit Anda"})]})]})}),je.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx(U,{className:"w-5 h-5 text-gray-400"}),je.jsxs("div",{className:"flex-1",children:[je.jsx("p",{className:"font-medium",children:"Alamat Pengiriman"}),je.jsx("p",{className:"text-sm text-gray-500",children:"Kelola alamat Anda"})]})]})}),je.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx(pe,{className:"w-5 h-5 text-gray-400"}),je.jsxs("div",{className:"flex-1",children:[je.jsx("p",{className:"font-medium",children:"Riwayat Poin"}),je.jsx("p",{className:"text-sm text-gray-500",children:"Lihat transaksi poin"})]})]})})]})]})]});case"admin":return je.jsxs("div",{className:"space-y-4",children:[je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Informasi Akun Admin"}),je.jsxs("div",{className:"space-y-3",children:[je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx(S,{className:"w-5 h-5 text-gray-400"}),je.jsxs("div",{children:[je.jsx("p",{className:"text-sm text-gray-500",children:"Username"}),je.jsx("p",{className:"font-medium",children:b.name})]})]}),je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx(H,{className:"w-5 h-5 text-gray-400"}),je.jsxs("div",{children:[je.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),je.jsx("p",{className:"font-medium",children:b.email})]})]}),je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx(B,{className:"w-5 h-5 text-gray-400"}),je.jsxs("div",{children:[je.jsx("p",{className:"text-sm text-gray-500",children:"Telepon"}),je.jsx("p",{className:"font-medium",children:b.phone||"Belum diisi"})]})]})]})]}),je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Fitur Admin"}),je.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[je.jsxs("button",{onClick:n,className:"p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[je.jsx(K,{className:"w-6 h-6 mx-auto mb-2"}),je.jsx("p",{className:"text-sm",children:"Kelola Produk"})]}),je.jsxs("button",{onClick:r,className:"p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[je.jsx(K,{className:"w-6 h-6 mx-auto mb-2"}),je.jsx("p",{className:"text-sm",children:"Kelola Pesanan"})]}),je.jsxs("button",{onClick:i,className:"p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[je.jsx(le,{className:"w-6 h-6 mx-auto mb-2"}),je.jsx("p",{className:"text-sm",children:"Laporan"})]}),je.jsxs("button",{onClick:a,className:"p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[je.jsx(ce,{className:"w-6 h-6 mx-auto mb-2"}),je.jsx("p",{className:"text-sm",children:"Pelanggan"})]})]})]}),je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Statistik Admin"}),je.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[je.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[je.jsx(de,{className:"w-6 h-6 text-blue-600 mx-auto mb-2"}),je.jsx("p",{className:"text-sm text-gray-600",children:"Total Penjualan"}),je.jsx("p",{className:"text-xl font-bold text-blue-600",children:"Rp 0"})]}),je.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[je.jsx(K,{className:"w-6 h-6 text-green-600 mx-auto mb-2"}),je.jsx("p",{className:"text-sm text-gray-600",children:"Total Pesanan"}),je.jsx("p",{className:"text-xl font-bold text-green-600",children:"0"})]})]})]}),je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Keamanan Admin"}),je.jsx("button",{onClick:()=>l(!o),className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx(ue,{className:"w-5 h-5 text-gray-400"}),je.jsxs("div",{className:"flex-1",children:[je.jsx("p",{className:"font-medium",children:"Ubah Password"}),je.jsx("p",{className:"text-sm text-gray-500",children:"Keamanan akun admin"})]})]})}),o&&je.jsxs("form",{onSubmit:w,className:"mt-4 space-y-3",children:[je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Saat Ini"}),je.jsxs("div",{className:"relative",children:[je.jsx("input",{type:c?"text":"password",value:x.currentPassword,onChange:e=>y(u(d({},x),{currentPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),je.jsx("button",{type:"button",onClick:()=>h(!c),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:c?je.jsx(J,{className:"w-5 h-5"}):je.jsx(W,{className:"w-5 h-5"})})]})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Baru"}),je.jsxs("div",{className:"relative",children:[je.jsx("input",{type:m?"text":"password",value:x.newPassword,onChange:e=>y(u(d({},x),{newPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),je.jsx("button",{type:"button",onClick:()=>p(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:m?je.jsx(J,{className:"w-5 h-5"}):je.jsx(W,{className:"w-5 h-5"})})]})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password Baru"}),je.jsx("input",{type:"password",value:x.confirmPassword,onChange:e=>y(u(d({},x),{confirmPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg",required:!0})]}),je.jsxs("div",{className:"flex space-x-3",children:[je.jsx("button",{type:"button",onClick:()=>l(!1),className:"flex-1 p-3 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50",children:"Batal"}),je.jsx("button",{type:"submit",className:"flex-1 p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Simpan"})]})]})]}),je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Preferensi Admin"}),je.jsxs("div",{className:"space-y-3",children:[je.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx(Y,{className:"w-5 h-5 text-gray-400"}),je.jsxs("div",{className:"flex-1",children:[je.jsx("p",{className:"font-medium",children:"Keamanan"}),je.jsx("p",{className:"text-sm text-gray-500",children:"Pengaturan keamanan"})]})]})}),je.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx(he,{className:"w-5 h-5 text-gray-400"}),je.jsxs("div",{className:"flex-1",children:[je.jsx("p",{className:"font-medium",children:"Pengaturan Sistem"}),je.jsx("p",{className:"text-sm text-gray-500",children:"Konfigurasi aplikasi"})]})]})})]})]})]});case"owner":return je.jsxs("div",{className:"space-y-4",children:[je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Informasi Akun Owner"}),je.jsxs("div",{className:"space-y-3",children:[je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx(S,{className:"w-5 h-5 text-gray-400"}),je.jsxs("div",{children:[je.jsx("p",{className:"text-sm text-gray-500",children:"Username"}),je.jsx("p",{className:"font-medium",children:b.name})]})]}),je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx(H,{className:"w-5 h-5 text-gray-400"}),je.jsxs("div",{children:[je.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),je.jsx("p",{className:"font-medium",children:b.email})]})]}),je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx(B,{className:"w-5 h-5 text-gray-400"}),je.jsxs("div",{children:[je.jsx("p",{className:"text-sm text-gray-500",children:"Telepon"}),je.jsx("p",{className:"font-medium",children:b.phone||"Belum diisi"})]})]})]})]}),je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Kontrol Owner"}),je.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[je.jsxs("button",{onClick:n,className:"p-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[je.jsx(K,{className:"w-6 h-6 mx-auto mb-2"}),je.jsx("p",{className:"text-sm",children:"Kelola Produk"})]}),je.jsxs("button",{onClick:r,className:"p-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[je.jsx(K,{className:"w-6 h-6 mx-auto mb-2"}),je.jsx("p",{className:"text-sm",children:"Kelola Pesanan"})]}),je.jsxs("button",{onClick:i,className:"p-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[je.jsx(le,{className:"w-6 h-6 mx-auto mb-2"}),je.jsx("p",{className:"text-sm",children:"Laporan"})]}),je.jsxs("button",{onClick:a,className:"p-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[je.jsx(ce,{className:"w-6 h-6 mx-auto mb-2"}),je.jsx("p",{className:"text-sm",children:"Kelola User"})]})]})]}),je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Statistik Bisnis"}),je.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[je.jsxs("div",{className:"text-center p-3 bg-red-50 rounded-lg",children:[je.jsx(de,{className:"w-6 h-6 text-red-600 mx-auto mb-2"}),je.jsx("p",{className:"text-sm text-gray-600",children:"Total Revenue"}),je.jsx("p",{className:"text-xl font-bold text-red-600",children:"Rp 0"})]}),je.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[je.jsx(K,{className:"w-6 h-6 text-green-600 mx-auto mb-2"}),je.jsx("p",{className:"text-sm text-gray-600",children:"Total Pesanan"}),je.jsx("p",{className:"text-xl font-bold text-green-600",children:"0"})]})]})]}),je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Keamanan Owner"}),je.jsx("button",{onClick:()=>l(!o),className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx(ue,{className:"w-5 h-5 text-gray-400"}),je.jsxs("div",{className:"flex-1",children:[je.jsx("p",{className:"font-medium",children:"Ubah Password"}),je.jsx("p",{className:"text-sm text-gray-500",children:"Keamanan akun owner"})]})]})}),o&&je.jsxs("form",{onSubmit:w,className:"mt-4 space-y-3",children:[je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Saat Ini"}),je.jsxs("div",{className:"relative",children:[je.jsx("input",{type:c?"text":"password",value:x.currentPassword,onChange:e=>y(u(d({},x),{currentPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),je.jsx("button",{type:"button",onClick:()=>h(!c),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:c?je.jsx(J,{className:"w-5 h-5"}):je.jsx(W,{className:"w-5 h-5"})})]})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Baru"}),je.jsxs("div",{className:"relative",children:[je.jsx("input",{type:m?"text":"password",value:x.newPassword,onChange:e=>y(u(d({},x),{newPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),je.jsx("button",{type:"button",onClick:()=>p(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:m?je.jsx(J,{className:"w-5 h-5"}):je.jsx(W,{className:"w-5 h-5"})})]})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password Baru"}),je.jsx("input",{type:"password",value:x.confirmPassword,onChange:e=>y(u(d({},x),{confirmPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg",required:!0})]}),je.jsxs("div",{className:"flex space-x-3",children:[je.jsx("button",{type:"button",onClick:()=>l(!1),className:"flex-1 p-3 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50",children:"Batal"}),je.jsx("button",{type:"submit",className:"flex-1 p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Simpan"})]})]})]}),je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Pengaturan Owner"}),je.jsxs("div",{className:"space-y-3",children:[je.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx(Y,{className:"w-5 h-5 text-gray-400"}),je.jsxs("div",{className:"flex-1",children:[je.jsx("p",{className:"font-medium",children:"Keamanan"}),je.jsx("p",{className:"text-sm text-gray-500",children:"Pengaturan keamanan tingkat lanjut"})]})]})}),je.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx(he,{className:"w-5 h-5 text-gray-400"}),je.jsxs("div",{className:"flex-1",children:[je.jsx("p",{className:"font-medium",children:"Sistem"}),je.jsx("p",{className:"text-sm text-gray-500",children:"Konfigurasi aplikasi"})]})]})}),je.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx(me,{className:"w-5 h-5 text-gray-400"}),je.jsxs("div",{className:"flex-1",children:[je.jsx("p",{className:"font-medium",children:"Backup & Restore"}),je.jsx("p",{className:"text-sm text-gray-500",children:"Cadangkan data"})]})]})})]})]})]});default:return null}})()}),je.jsx("div",{className:"p-4",children:je.jsx("div",{className:"bg-white rounded-lg shadow-sm",children:je.jsxs("button",{onClick:()=>{s()},className:"w-full p-4 flex items-center space-x-3 text-red-600 hover:bg-red-50 transition-colors rounded-lg",children:[je.jsx(oe,{className:"w-5 h-5"}),je.jsx("span",{children:"Keluar"})]})})})]})},vg="azzahra_products_cache",bg="azzahra_products_cache_expiry",wg=()=>{const[t,s]=f.useState([]),[n,r]=f.useState(!0),[i,a]=f.useState(null),[o,l]=f.useState(!0),{saveToCache:c,getFromCache:d}=(()=>{const e=e=>{try{localStorage.setItem(vg,JSON.stringify(e)),localStorage.setItem(bg,Date.now().toString()),console.log("ðŸ’¾ Products cached:",e.length)}catch(i){console.warn("âŒ Failed to cache products:",i)}},t=()=>{try{const e=localStorage.getItem(vg),t=localStorage.getItem(bg);return e&&t?Date.now()-parseInt(t)>3e5?(console.log("â° Cache expired, clearing..."),s(),null):(console.log("âš¡ Loading from cache..."),JSON.parse(e)):null}catch(i){return console.warn("âŒ Failed to load from cache:",i),s(),null}},s=()=>{try{localStorage.removeItem(vg),localStorage.removeItem(bg),console.log("ðŸ—‘ï¸ Cache cleared")}catch(i){console.warn("âŒ Failed to clear cache:",i)}};return{saveToCache:e,getFromCache:t,clearCache:s,isCacheValid:()=>null!==t(),refreshCache:t=>{s(),e(t)}}})();return f.useEffect(()=>{console.log("âš¡ Loading products with smart cache...");const e=performance.now(),t=d();var n;t&&(console.log("ðŸš€ Instant load from cache -",t.length,"products"),s(t),r(!1),l(!1));const i=Su(lu(kd(eg,"products"),function(e,t="asc"){const s=t,n=ru("orderBy",e);return uu._create(n,s)}("createdAt","desc"),(n=50,hu._create("limit",n,"F"))),t=>{const n=performance.now(),i=t.docs.map(e=>{var t,s;const n=e.data(),r=n.createdAt?"string"==typeof n.createdAt?new Date(n.createdAt):null==(t=n.createdAt)?void 0:t.toDate():new Date,i=Number(n.retailPrice||n.price||0),a=Number(n.stock||0);return{id:e.id,name:n.name||"",description:n.description||"",category:n.category||"uncategorized",retailPrice:i,resellerPrice:Number(n.resellerPrice)||.8*i,costPrice:Number(n.costPrice)||.6*i,stock:a,images:n.images||[],image:(null==(s=n.images)?void 0:s[0])||"/placeholder-product.jpg",variants:{sizes:n.sizes||[],colors:n.colors||[]},isFeatured:Boolean(n.isFeatured),isFlashSale:Boolean(n.isFlashSale),flashSalePrice:Number(n.flashSalePrice)||i,createdAt:r,salesCount:Number(n.salesCount)||0,status:a>0?"ready":"po"}});if(o){const t=performance.now()-n,s=performance.now()-e;console.log("âš¡ Performance:"),console.log(`   - Processing time: ${t.toFixed(2)}ms`),console.log(`   - Total time: ${s.toFixed(2)}ms`),console.log(`ðŸ“Š Initial load complete. Total products: ${i.length}`),l(!1)}else console.log("ðŸ”„ Products updated in real-time");c(i),s(i),r(!1)});return()=>i()},[]),{products:t,loading:n,error:i,addProduct:t=>g(e,null,function*(){try{const e=yield function(e,t){const s=Bn(e.firestore,Ad),n=Sd(e),r=xu(e.converter,t);return Tu(s,[$d(qd(e.firestore),"addDoc",n._key,r,null!==e.converter,{}).toMutation(n._key,fa.exists(!1))]).then(()=>n)}(kd(eg,"products"),{name:t.name,description:t.description||"",category:t.category||"uncategorized",price:t.retailPrice,resellerPrice:t.resellerPrice,costPrice:t.costPrice,stock:t.stock||0,images:t.images||[],sizes:t.sizes||[],colors:t.colors||[],featured:t.isFeatured||!1,isFlashSale:t.isFlashSale||!1,flashSalePrice:t.flashSalePrice||t.retailPrice,salesCount:0,unit:t.unit||"pcs",createdAt:new Date});console.log("âœ… Product added with ID:",e.id)}catch(e){throw console.error("âŒ Error adding product:",e),e}}),updateProduct:(t,s)=>g(e,null,function*(){try{const e=Sd(eg,"products",t);yield ku(e,s),console.log("âœ… Product updated")}catch(e){throw console.error("âŒ Error updating product:",e),e}}),deleteProduct:t=>g(e,null,function*(){try{const s=Sd(eg,"products",t);yield(e=s,Tu(Bn(e.firestore,Ad),[new Ea(e._key,fa.none())])),console.log("âœ… Product deleted")}catch(s){throw console.error("âŒ Error deleting product:",s),s}var e}),updateProductStock:(s,n)=>g(e,null,function*(){try{const e=Sd(eg,"products",s),r=t.find(e=>e.id===s);if(r){const t=Math.max(0,r.stock-n);return yield ku(e,{stock:t}),t}return 0}catch(e){throw console.error("âŒ Error updating stock:",e),e}}),setProducts:s}},Ng=()=>je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsxs("div",{className:"flex items-center justify-between mb-4",children:[je.jsx("div",{className:"h-6 bg-gray-200 rounded w-32 animate-pulse"}),je.jsxs("div",{className:"flex space-x-2",children:[je.jsx("div",{className:"h-10 bg-gray-200 rounded w-64 animate-pulse"}),je.jsx("div",{className:"h-10 bg-gray-200 rounded w-32 animate-pulse"}),je.jsx("div",{className:"h-10 bg-gray-200 rounded w-24 animate-pulse"})]})]}),je.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden mb-4",children:[je.jsxs("div",{className:"grid grid-cols-12 gap-4 p-4 bg-gray-50 border-b border-gray-200",children:[je.jsx("div",{className:"col-span-1 h-4 bg-gray-200 rounded animate-pulse"}),je.jsx("div",{className:"col-span-4 h-4 bg-gray-200 rounded animate-pulse"}),je.jsx("div",{className:"col-span-2 h-4 bg-gray-200 rounded animate-pulse"}),je.jsx("div",{className:"col-span-2 h-4 bg-gray-200 rounded animate-pulse"}),je.jsx("div",{className:"col-span-1 h-4 bg-gray-200 rounded animate-pulse"}),je.jsx("div",{className:"col-span-1 h-4 bg-gray-200 rounded animate-pulse"}),je.jsx("div",{className:"col-span-1 h-4 bg-gray-200 rounded animate-pulse"})]}),[...Array(5)].map((e,t)=>je.jsxs("div",{className:"grid grid-cols-12 gap-4 p-4 border-b border-gray-100 hover:bg-gray-50",children:[je.jsx("div",{className:"col-span-1 h-4 bg-gray-100 rounded animate-pulse"}),je.jsxs("div",{className:"col-span-4",children:[je.jsx("div",{className:"h-4 bg-gray-100 rounded w-3/4 mb-2 animate-pulse"}),je.jsx("div",{className:"h-3 bg-gray-50 rounded w-1/2 animate-pulse"})]}),je.jsx("div",{className:"col-span-2 h-4 bg-gray-100 rounded animate-pulse"}),je.jsx("div",{className:"col-span-2 h-4 bg-gray-100 rounded animate-pulse"}),je.jsx("div",{className:"col-span-1 h-4 bg-gray-100 rounded animate-pulse"}),je.jsx("div",{className:"col-span-1 h-4 bg-gray-100 rounded animate-pulse"}),je.jsx("div",{className:"col-span-1 h-8 bg-gray-100 rounded animate-pulse"})]},t))]}),je.jsxs("div",{className:"flex items-center justify-between",children:[je.jsx("div",{className:"h-4 bg-gray-200 rounded w-48 animate-pulse"}),je.jsx("div",{className:"flex space-x-1",children:[...Array(5)].map((e,t)=>je.jsx("div",{className:"h-8 w-8 bg-gray-200 rounded animate-pulse"},t))})]})]}),jg=({onBack:t,user:s})=>{var n;const{products:r,loading:i,updateProduct:a,addProduct:o,deleteProduct:l}=wg(),{flashSaleConfig:c,timeLeft:h,isFlashSaleActive:m,startFlashSale:p,stopFlashSale:x}=ng();f.useEffect(()=>{const e=r.filter(e=>e.isFlashSale);console.log("ðŸ” DEBUG AdminProductsPage:"),console.log("ðŸ“Š Total products:",r.length),console.log("ðŸ”¥ Flash sale products:",e.length),console.log("âš¡ Flash sale config active:",m),console.log("â° Time left:",h),console.log("ðŸ“‹ Flash sale config:",c),e.length>0&&console.log("ðŸ”¥ Flash sale product details:",e.map(e=>({name:e.name,id:e.id,isFlashSale:e.isFlashSale,flashSalePrice:e.flashSalePrice}))),e.length>0&&!m&&(console.error("ðŸš¨ INCONSISTENCY DETECTED: Products marked as flash sale but flash sale is not active!"),e.forEach(e=>{console.error(`ðŸš¨ Product "${e.name}" stuck in flash sale mode`)}))},[r,m,c,h]);const[b,w]=f.useState(!1),[N,j]=f.useState(!1),[S,E]=f.useState(!1),[C,P]=f.useState(!1),[D,R]=f.useState(null),[L,F]=f.useState([]),[U,V]=f.useState(""),[B,z]=f.useState(""),[q,H]=f.useState("name"),[G,J]=f.useState(1),[W,Q]=f.useState(10),[Y,X]=f.useState({name:"",description:"",category:"Hijab",retailPrice:0,resellerPrice:0,costPrice:0,stock:0,images:[],variants:[{sizes:[],colors:[]}]}),[ee,te]=f.useState({category:"",retailPrice:0,discount:0,stock:0,status:"ready",isFeatured:!1}),[se,ne]=f.useState({isActive:!1,startTime:"",endTime:"",flashSaleDiscount:0,productIds:[]}),re=["Hijab","Gamis","Khimar","Tunik","Jaket","Bawahan","Aksesoris","Lainnya"],ie=y.useMemo(()=>{let e=[...r];return U&&(e=e.filter(e=>e.name.toLowerCase().includes(U.toLowerCase())||e.category.toLowerCase().includes(U.toLowerCase()))),B&&(e=e.filter(e=>e.category===B)),e.sort((e,t)=>{switch(q){case"price-asc":return e.retailPrice-t.retailPrice;case"price-desc":return t.retailPrice-e.retailPrice;case"date-newest":return new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime();case"date-oldest":return new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime();default:return e.name.localeCompare(t.name)}}),e},[r,U,B,q]),ae=Math.ceil(ie.length/W),oe=(G-1)*W,le=oe+W,ce=ie.slice(oe,le);f.useEffect(()=>{J(1)},[U,B,q,W]);const de=()=>g(e,null,function*(){try{const e=r.filter(e=>e.isFlashSale);for(const t of e)yield a(t.id,{isFlashSale:!1,flashSalePrice:null});yield x()}catch(e){console.error("Error ending flash sale:",e),alert("Gagal menghentikan flash sale")}});return je.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[je.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4",children:je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx("button",{onClick:t,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:je.jsx(A,{className:"w-5 h-5"})}),je.jsx("h1",{className:"text-xl font-bold",children:"Kelola Produk"})]})}),je.jsxs("div",{className:"p-4 space-y-4",children:[je.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[je.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[je.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-1",children:"Total Produk"}),je.jsx("p",{className:"text-2xl font-bold text-blue-600",children:r.length})]}),je.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[je.jsx("h4",{className:"text-sm font-medium text-green-800 mb-1",children:"Stok Tersedia"}),je.jsx("p",{className:"text-2xl font-bold text-green-600",children:r.reduce((e,t)=>e+t.stock,0)})]}),je.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[je.jsx("h4",{className:"text-sm font-medium text-purple-800 mb-1",children:"Kategori"}),je.jsx("p",{className:"text-2xl font-bold text-purple-600",children:re.length})]}),je.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[je.jsx("h4",{className:"text-sm font-medium text-orange-800 mb-1",children:"Produk Unggulan"}),je.jsx("p",{className:"text-2xl font-bold text-orange-600",children:r.filter(e=>e.isFeatured).length})]})]}),m&&je.jsxs("div",{className:"bg-gradient-to-r from-red-50 to-orange-50 rounded-lg shadow-sm p-4 border border-red-200",children:[je.jsxs("div",{className:"flex items-center justify-between",children:[je.jsxs("div",{className:"flex items-center space-x-2",children:[je.jsx(Z,{className:"w-5 h-5 text-red-600"}),je.jsx("span",{className:"font-semibold text-red-800",children:"Flash Sale Aktif"})]}),je.jsxs("div",{className:"flex items-center space-x-3",children:[h&&je.jsxs("div",{className:"flex items-center space-x-1 bg-red-600 text-white px-3 py-1 rounded-full text-sm",children:[je.jsx(I,{className:"w-4 h-4"}),je.jsx("span",{className:"font-medium",children:h})]}),je.jsx("button",{onClick:de,className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors text-sm",children:"Stop Flash Sale"})]})]}),je.jsxs("p",{className:"text-sm text-red-700 mt-2",children:[r.filter(e=>e.isFlashSale).length," produk dengan diskon Rp ",(null==(n=null==c?void 0:c.flashSaleDiscount)?void 0:n.toLocaleString("id-ID"))||0]})]}),r.filter(e=>e.isFlashSale).length>0&&!m&&je.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:[je.jsxs("div",{className:"flex items-center justify-between mb-2",children:[je.jsx("h3",{className:"text-sm font-semibold text-yellow-800",children:"âš ï¸ Flash Sale Cleanup Needed"}),je.jsxs("span",{className:"text-xs text-yellow-600",children:[r.filter(e=>e.isFlashSale).length," products stuck"]})]}),je.jsxs("p",{className:"text-xs text-yellow-700 mb-3",children:["Flash sale is not active but ",r.filter(e=>e.isFlashSale).length," products still have flash sale status. This may cause display issues."]}),je.jsxs("div",{className:"flex items-center space-x-2",children:[je.jsx("button",{onClick:de,className:"bg-yellow-600 text-white px-3 py-1 rounded hover:bg-yellow-700 transition-colors text-xs",children:"ðŸ§¹ Force Clean Up"}),je.jsx("button",{onClick:()=>{const e=r.filter(e=>e.isFlashSale);console.log("ðŸš¨ Stuck flash sale products:",e),alert(`Stuck products: ${e.map(e=>e.name).join(", ")}`)},className:"bg-gray-600 text-white px-3 py-1 rounded hover:bg-gray-700 transition-colors text-xs",children:"ðŸ“‹ Show Details"})]})]}),je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsx("div",{className:"flex items-center justify-between mb-4",children:je.jsx("h2",{className:"text-lg font-semibold",children:"Menu Utama"})}),je.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[je.jsxs("button",{onClick:()=>w(!0),className:"bg-blue-600 text-white p-4 rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-3",children:[je.jsx(O,{className:"w-6 h-6"}),je.jsxs("div",{className:"text-left",children:[je.jsx("p",{className:"font-semibold",children:"Tambah Produk"}),je.jsx("p",{className:"text-sm opacity-90",children:"Tambah produk baru"})]})]}),je.jsxs("button",{onClick:()=>{const e=r.filter(e=>e.isFeatured);e.length>0?(F(e.map(e=>e.id)),te(u(d({},ee),{isFeatured:!0})),E(!0)):alert("Belum ada produk unggulan. Pilih produk terlebih dahulu dari daftar produk.")},className:"bg-yellow-500 text-white p-4 rounded-lg hover:bg-yellow-600 transition-colors flex items-center space-x-3",children:[je.jsx(v,{className:"w-6 h-6"}),je.jsxs("div",{className:"text-left",children:[je.jsx("p",{className:"font-semibold",children:"Produk Unggulan"}),je.jsxs("p",{className:"text-sm opacity-90",children:["Kelola produk unggulan (",r.filter(e=>e.isFeatured).length,")"]})]})]}),je.jsxs("button",{onClick:()=>P(!0),className:"bg-red-600 text-white p-4 rounded-lg hover:bg-red-700 transition-colors flex items-center space-x-3",children:[je.jsx(Z,{className:"w-6 h-6"}),je.jsxs("div",{className:"text-left",children:[je.jsx("p",{className:"font-semibold",children:"Flash Sale"}),je.jsxs("p",{className:"text-sm opacity-90",children:["Atur diskon flash sale (",r.filter(e=>e.isFlashSale).length,")"]})]})]})]})]}),je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-4 space-y-4 md:space-y-0",children:[je.jsxs("h2",{className:"text-lg font-semibold",children:["Daftar Produk ",L.length>0&&`(${L.length} dipilih)`]}),je.jsxs("div",{className:"flex flex-col md:flex-row md:items-center space-y-3 md:space-y-0 md:space-x-3",children:[je.jsxs("div",{className:"relative",children:[je.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),je.jsx("input",{type:"text",placeholder:"Cari produk...",value:U,onChange:e=>V(e.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent w-full md:w-64"})]}),je.jsxs("select",{value:B,onChange:e=>z(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[je.jsx("option",{value:"",children:"Semua Kategori"}),re.map(e=>je.jsx("option",{value:e,children:e},e))]}),je.jsxs("select",{value:q,onChange:e=>H(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[je.jsx("option",{value:"name",children:"Nama"}),je.jsx("option",{value:"price-asc",children:"Harga (Rendah ke Tinggi)"}),je.jsx("option",{value:"price-desc",children:"Harga (Tinggi ke Rendah)"}),je.jsx("option",{value:"date-newest",children:"Terbaru"}),je.jsx("option",{value:"date-oldest",children:"Terlama"})]}),L.length>0&&je.jsxs("button",{onClick:()=>E(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[je.jsx(ge,{className:"w-4 h-4"}),je.jsxs("span",{children:["Edit ",L.length," Produk"]})]})]})]}),i?je.jsx(Ng,{}):0===ce.length?je.jsxs("div",{className:"text-center py-8",children:[je.jsx(K,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),je.jsx("p",{className:"text-gray-500",children:U||B?"Tidak ada produk yang ditemukan":"Belum ada produk"})]}):je.jsxs(je.Fragment,{children:[je.jsx("div",{className:"overflow-x-auto",children:je.jsxs("table",{className:"w-full",children:[je.jsx("thead",{children:je.jsxs("tr",{className:"border-b",children:[je.jsx("th",{className:"text-left p-3",children:je.jsx("input",{type:"checkbox",checked:L.length===ce.length,onChange:e=>{e.target.checked?F(ce.map(e=>e.id)):F([])},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),je.jsx("th",{className:"text-left p-3",children:"Produk"}),je.jsx("th",{className:"text-left p-3",children:"Kategori"}),je.jsx("th",{className:"text-left p-3",children:"Harga"}),je.jsx("th",{className:"text-left p-3",children:"Stok"}),je.jsx("th",{className:"text-left p-3",children:"Status"}),je.jsx("th",{className:"text-left p-3",children:"Aksi"})]})}),je.jsx("tbody",{children:ce.map(t=>{var s;return je.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[je.jsx("td",{className:"p-3",children:je.jsx("input",{type:"checkbox",checked:L.includes(t.id),onChange:e=>{e.target.checked?F([...L,t.id]):F(L.filter(e=>e!==t.id))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),je.jsx("td",{className:"p-3",children:je.jsxs("div",{className:"flex items-center space-x-3",children:[t.images.length>0?je.jsx("img",{src:t.image||t.images[0]||"/placeholder-product.jpg",alt:t.name,className:"w-10 h-10 object-cover rounded-lg"}):je.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center",children:je.jsx(K,{className:"w-5 h-5 text-gray-400"})}),je.jsxs("div",{children:[je.jsx("p",{className:"font-medium text-gray-900",children:t.name}),t.isFeatured&&je.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800",children:"â­ Unggulan"}),t.isFlashSale&&je.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800 ml-2",children:"ðŸ”¥ Flash Sale"})]})]})}),je.jsx("td",{className:"p-3",children:je.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:t.category})}),je.jsx("td",{className:"p-3",children:je.jsx("div",{children:t.isFlashSale?je.jsxs(je.Fragment,{children:[je.jsxs("p",{className:"font-semibold text-red-600",children:["Rp ",null==(s=t.flashSalePrice)?void 0:s.toLocaleString("id-ID")]}),je.jsxs("p",{className:"text-sm text-gray-400 line-through",children:["Rp ",t.retailPrice.toLocaleString("id-ID")]})]}):je.jsxs("p",{className:"font-semibold",children:["Rp ",t.retailPrice.toLocaleString("id-ID")]})})}),je.jsx("td",{className:"p-3",children:je.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(t.stock>10?"bg-green-100 text-green-800":t.stock>0?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:[t.stock," pcs"]})}),je.jsx("td",{className:"p-3",children:je.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(t.stock>0?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:t.stock>0?"Ready":"Habis"})}),je.jsx("td",{className:"p-3",children:je.jsxs("div",{className:"flex items-center space-x-2",children:[je.jsx("button",{onClick:()=>(e=>{R(e),X({name:e.name,description:e.description,category:e.category,retailPrice:e.retailPrice,resellerPrice:e.resellerPrice,costPrice:e.costPrice,stock:e.stock,images:e.images,variants:e.variants||[{sizes:[],colors:[]}]}),j(!0)})(t),className:"p-1 text-blue-600 hover:bg-blue-100 rounded",children:je.jsx(ge,{className:"w-4 h-4"})}),je.jsx("button",{onClick:()=>{return s=t.id,g(e,null,function*(){if(confirm("Apakah Anda yakin ingin menghapus produk ini?"))try{yield l(s)}catch(e){console.error("Error deleting product:",e),alert("Gagal menghapus produk")}});var s},className:"p-1 text-red-600 hover:bg-red-100 rounded",children:je.jsx(M,{className:"w-4 h-4"})})]})})]},t.id)})})]})}),ae>1&&je.jsxs("div",{className:"flex items-center justify-between mt-4",children:[je.jsxs("div",{className:"text-sm text-gray-700",children:["Menampilkan ",oe+1," hingga ",Math.min(le,ie.length)," dari ",ie.length," produk"]}),je.jsxs("div",{className:"flex items-center space-x-2",children:[je.jsx("button",{onClick:()=>J(Math.max(1,G-1)),disabled:1===G,className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:je.jsx(_,{className:"w-4 h-4"})}),Array.from({length:Math.min(5,ae)},(e,t)=>{let s;return s=ae<=5||G<=3?t+1:G>=ae-2?ae-4+t:G-2+t,je.jsx("button",{onClick:()=>J(s),className:"px-3 py-1 border rounded-lg "+(G===s?"bg-blue-600 text-white border-blue-600":"border-gray-300 hover:bg-gray-50"),children:s},s)}),je.jsx("button",{onClick:()=>J(Math.min(ae,G+1)),disabled:G===ae,className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:je.jsx(k,{className:"w-4 h-4"})})]})]})]})]})]}),b&&je.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:je.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[je.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4",children:je.jsxs("div",{className:"flex items-center justify-between",children:[je.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Tambah Produk Baru"}),je.jsx("button",{onClick:()=>w(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:je.jsx($,{className:"w-5 h-5 text-gray-500"})})]})}),je.jsxs("form",{onSubmit:t=>g(e,null,function*(){t.preventDefault();try{const e=u(d({},Y),{createdAt:new Date,salesCount:0,isFeatured:!1,isFlashSale:!1,flashSalePrice:Y.retailPrice});yield o(e),X({name:"",description:"",category:"Hijab",retailPrice:0,resellerPrice:0,costPrice:0,stock:0,images:[],variants:[{sizes:[],colors:[]}]}),w(!1)}catch(e){console.error("Error adding product:",e),alert("Gagal menambahkan produk")}}),className:"p-6 space-y-6",children:[je.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nama Produk *"}),je.jsx("input",{type:"text",required:!0,value:Y.name,onChange:e=>X(u(d({},Y),{name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kategori *"}),je.jsx("select",{required:!0,value:Y.category,onChange:e=>X(u(d({},Y),{category:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:re.map(e=>je.jsx("option",{value:e,children:e},e))})]})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Deskripsi"}),je.jsx("textarea",{rows:3,value:Y.description,onChange:e=>X(u(d({},Y),{description:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),je.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Harga Jual (Rp) *"}),je.jsx("input",{type:"number",required:!0,min:"0",value:Y.retailPrice,onChange:e=>{const t=parseInt(e.target.value)||0;X(u(d({},Y),{retailPrice:t,resellerPrice:Math.round(.8*t),costPrice:Math.round(.6*t)}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Harga Reseller (Rp)"}),je.jsx("input",{type:"number",value:Y.resellerPrice,onChange:e=>X(u(d({},Y),{resellerPrice:parseInt(e.target.value)||0})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",readOnly:!0})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Harga Modal (Rp)"}),je.jsx("input",{type:"number",value:Y.costPrice,onChange:e=>X(u(d({},Y),{costPrice:parseInt(e.target.value)||0})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",readOnly:!0})]})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stok *"}),je.jsx("input",{type:"number",required:!0,min:"0",value:Y.stock,onChange:e=>X(u(d({},Y),{stock:parseInt(e.target.value)||0})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),je.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[je.jsx("button",{type:"button",onClick:()=>w(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Batal"}),je.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Tambah Produk"})]})]})]})}),N&&D&&je.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:je.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[je.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4",children:je.jsxs("div",{className:"flex items-center justify-between",children:[je.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Edit Produk"}),je.jsx("button",{onClick:()=>{j(!1),R(null)},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:je.jsx($,{className:"w-5 h-5 text-gray-500"})})]})}),je.jsxs("form",{onSubmit:t=>g(e,null,function*(){if(t.preventDefault(),D)try{yield a(D.id,Y),j(!1),R(null)}catch(e){console.error("Error updating product:",e),alert("Gagal memperbarui produk")}}),className:"p-6 space-y-6",children:[je.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nama Produk *"}),je.jsx("input",{type:"text",required:!0,value:Y.name,onChange:e=>X(u(d({},Y),{name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kategori *"}),je.jsx("select",{required:!0,value:Y.category,onChange:e=>X(u(d({},Y),{category:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:re.map(e=>je.jsx("option",{value:e,children:e},e))})]})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Deskripsi"}),je.jsx("textarea",{rows:3,value:Y.description,onChange:e=>X(u(d({},Y),{description:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),je.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Harga Jual (Rp) *"}),je.jsx("input",{type:"number",required:!0,min:"0",value:Y.retailPrice,onChange:e=>{const t=parseInt(e.target.value)||0;X(u(d({},Y),{retailPrice:t,resellerPrice:Math.round(.8*t),costPrice:Math.round(.6*t)}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Harga Reseller (Rp)"}),je.jsx("input",{type:"number",value:Y.resellerPrice,onChange:e=>X(u(d({},Y),{resellerPrice:parseInt(e.target.value)||0})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",readOnly:!0})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Harga Modal (Rp)"}),je.jsx("input",{type:"number",value:Y.costPrice,onChange:e=>X(u(d({},Y),{costPrice:parseInt(e.target.value)||0})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",readOnly:!0})]})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stok *"}),je.jsx("input",{type:"number",required:!0,min:"0",value:Y.stock,onChange:e=>X(u(d({},Y),{stock:parseInt(e.target.value)||0})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),je.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[je.jsx("button",{type:"button",onClick:()=>{j(!1),R(null)},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Batal"}),je.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Simpan Perubahan"})]})]})]})}),S&&je.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:je.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[je.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4",children:je.jsxs("div",{className:"flex items-center justify-between",children:[je.jsxs("h2",{className:"text-xl font-bold text-gray-800",children:["Edit ",L.length," Produk Terpilih"]}),je.jsx("button",{onClick:()=>{E(!1),F([])},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:je.jsx($,{className:"w-5 h-5 text-gray-500"})})]})}),je.jsxs("div",{className:"p-6 space-y-6",children:[je.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[je.jsx("h4",{className:"font-medium text-gray-800 mb-3",children:"Produk yang akan diedit:"}),je.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:L.map(e=>{const t=r.find(t=>t.id===e);return t?je.jsxs("div",{className:"flex items-center justify-between text-sm",children:[je.jsx("span",{className:"font-medium",children:t.name}),je.jsx("span",{className:"text-gray-500",children:t.category})]},t.id):null})})]}),je.jsxs("div",{className:"space-y-4",children:[je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ubah Kategori (kosongkan jika tidak ingin mengubah)"}),je.jsxs("select",{value:ee.category,onChange:e=>te(u(d({},ee),{category:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[je.jsx("option",{value:"",children:"-- Tidak Diubah --"}),re.map(e=>je.jsx("option",{value:e,children:e},e))]})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ubah Harga Jual (Rp)"}),je.jsx("input",{type:"number",min:"0",value:ee.retailPrice||"",onChange:e=>te(u(d({},ee),{retailPrice:parseInt(e.target.value)||0})),placeholder:"Kosongkan jika tidak ingin mengubah",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ubah Stok"}),je.jsx("input",{type:"number",min:"0",value:ee.stock||"",onChange:e=>te(u(d({},ee),{stock:parseInt(e.target.value)||0})),placeholder:"Kosongkan jika tidak ingin mengubah",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status Produk Unggulan"}),je.jsxs("select",{value:ee.isFeatured?"true":"false",onChange:e=>te(u(d({},ee),{isFeatured:"true"===e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[je.jsx("option",{value:"false",children:"Tidak Unggulan"}),je.jsx("option",{value:"true",children:"Jadikan Unggulan"})]})]})]}),je.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[je.jsx("button",{onClick:()=>{E(!1),F([])},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Batal"}),je.jsx("button",{onClick:()=>g(e,null,function*(){if(0!==L.length)try{const e={};ee.category&&(e.category=ee.category),ee.retailPrice>0&&(e.retailPrice=ee.retailPrice,e.resellerPrice=Math.round(.8*ee.retailPrice)),ee.stock>=0&&(e.stock=ee.stock),ee.status&&(e.status=ee.status),void 0!==ee.isFeatured&&(e.isFeatured=ee.isFeatured);for(const t of L)yield a(t,e);F([]),E(!1),te({category:"",retailPrice:0,discount:0,stock:0,status:"ready",isFeatured:!1})}catch(e){console.error("Error updating products:",e),alert("Gagal memperbarui produk")}else alert("Pilih setidaknya satu produk")}),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Simpan Perubahan"})]})]})]})}),C&&je.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:je.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[je.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4",children:je.jsxs("div",{className:"flex items-center justify-between",children:[je.jsxs("h2",{className:"text-xl font-bold text-gray-800 flex items-center space-x-2",children:[je.jsx(Z,{className:"w-6 h-6 text-red-600"}),je.jsx("span",{children:"Konfigurasi Flash Sale"})]}),je.jsx("button",{onClick:()=>P(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:je.jsx($,{className:"w-5 h-5 text-gray-500"})})]})}),je.jsxs("div",{className:"p-6 space-y-6",children:[je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Pilih Produk untuk Flash Sale"}),je.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-60 overflow-y-auto border border-gray-200 rounded-lg p-3",children:r.filter(e=>!e.isFlashSale).map(e=>je.jsxs("label",{className:"flex items-center space-x-3 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[je.jsx("input",{type:"checkbox",checked:se.productIds.includes(e.id),onChange:t=>{t.target.checked?ne(u(d({},se),{productIds:[...se.productIds,e.id]})):ne(u(d({},se),{productIds:se.productIds.filter(t=>t!==e.id)}))},className:"rounded border-gray-300 text-red-600 focus:ring-red-500"}),je.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.images.length>0?je.jsx("img",{src:e.image||e.images[0]||"/placeholder-product.jpg",alt:e.name,className:"w-8 h-8 object-cover rounded"}):je.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded flex items-center justify-center",children:je.jsx(K,{className:"w-4 h-4 text-gray-400"})}),je.jsxs("div",{className:"flex-1",children:[je.jsx("p",{className:"text-sm font-medium",children:e.name}),je.jsxs("p",{className:"text-xs text-gray-500",children:["Rp ",e.retailPrice.toLocaleString("id-ID")]})]})]})]},e.id))}),je.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:[se.productIds.length," produk dipilih"]})]}),je.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[je.jsxs("div",{children:[je.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[je.jsx(I,{className:"w-4 h-4 inline mr-1"}),"Waktu Mulai"]}),je.jsx("input",{type:"datetime-local",value:se.startTime,onChange:e=>ne(u(d({},se),{startTime:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"})]}),je.jsxs("div",{children:[je.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[je.jsx(I,{className:"w-4 h-4 inline mr-1"}),"Waktu Berakhir"]}),je.jsx("input",{type:"datetime-local",value:se.endTime,onChange:e=>ne(u(d({},se),{endTime:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"})]})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Diskon Flash Sale (Rp)"}),je.jsx("input",{type:"number",value:se.flashSaleDiscount||"",onChange:e=>ne(u(d({},se),{flashSaleDiscount:parseInt(e.target.value)||0})),placeholder:"Masukkan jumlah diskon",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"})]}),je.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[je.jsx("button",{onClick:()=>P(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Batal"}),je.jsxs("div",{className:"flex items-center space-x-2",children:[m&&je.jsxs("button",{onClick:de,className:"bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors flex items-center space-x-2",children:[je.jsx(Z,{className:"w-4 h-4"}),je.jsx("span",{children:"Stop Flash Sale"})]}),se.productIds.length>0&&je.jsxs("button",{onClick:()=>g(e,null,function*(){if(0!==se.productIds.length)try{for(const e of se.productIds){const t=r.find(t=>t.id===e);if(t){const s=Math.round(t.retailPrice-se.flashSaleDiscount);yield a(e,{isFlashSale:!0,flashSalePrice:Math.max(s,1e3)})}}yield p(se),P(!1),ne({isActive:!1,startTime:"",endTime:"",flashSaleDiscount:0,productIds:[]})}catch(e){console.error("Error starting flash sale:",e),alert("Gagal memulai flash sale")}else alert("Pilih setidaknya satu produk untuk flash sale")}),className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors flex items-center space-x-2",children:[je.jsx(Z,{className:"w-4 h-4"}),je.jsx("span",{children:"Mulai Flash Sale"})]})]})]})]})]})})]})},_g=({onBack:e,user:t})=>{var s,n,r,i,a,o,l,c,d;const{orders:u,updateOrderStatus:h,updateOrderPayment:m,deleteOrder:p,getOrdersByStatus:g,getTotalRevenue:x,getTodayOrders:y}=Ie(),[v,b]=f.useState(""),[w,N]=f.useState("all"),[j,_]=f.useState(""),[k,E]=f.useState(!1),[C,P]=f.useState(null),[D,R]=f.useState(!1),[O,L]=f.useState(""),[M,F]=f.useState("");f.useEffect(()=>{const e=e=>{console.log("AdminOrdersPage: Order update received",e.detail),b(e=>e+" "),setTimeout(()=>b(e=>e.trim()),100)};return window.addEventListener("orderUpdated",e),()=>window.removeEventListener("orderUpdated",e)},[]);const V={pending:{label:"Menunggu Pembayaran",icon:I,color:"text-orange-600 bg-orange-100"},awaiting_verification:{label:"Menunggu Verifikasi",icon:I,color:"text-yellow-600 bg-yellow-100"},paid:{label:"Dibayar",icon:ne,color:"text-blue-600 bg-blue-100"},processing:{label:"Diproses",icon:K,color:"text-purple-600 bg-purple-100"},shipped:{label:"Dikirim",icon:re,color:"text-indigo-600 bg-indigo-100"},delivered:{label:"Selesai",icon:ne,color:"text-green-600 bg-green-100"},cancelled:{label:"Dibatalkan",icon:se,color:"text-red-600 bg-red-100"}},z=u.filter(e=>{const t=""===v||e.id.toLowerCase().includes(v.toLowerCase())||e.userName.toLowerCase().includes(v.toLowerCase())||e.userEmail.toLowerCase().includes(v.toLowerCase()),s="all"===w||e.status===w,n=""===j||new Date(e.createdAt).toISOString().split("T")[0]===j;return t&&s&&n}),q=e=>{P(e),R(!0)},H=(e,t)=>{h(e,t)},G=e=>{C&&("paid"===e?m(C.id,O||"payment_verified",e):h(C.id,e),R(!1),P(null),L(""),F(""))};return je.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[je.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4",children:je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx("button",{onClick:e,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:je.jsx(A,{className:"w-5 h-5"})}),je.jsx("h1",{className:"text-xl font-bold",children:"Kelola Pesanan"})]})}),je.jsxs("div",{className:"p-4 space-y-4",children:[je.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[je.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[je.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-1",children:"Total Pesanan"}),je.jsx("p",{className:"text-2xl font-bold text-blue-600",children:u.length})]}),je.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[je.jsx("h4",{className:"text-sm font-medium text-orange-800 mb-1",children:"Menunggu"}),je.jsx("p",{className:"text-2xl font-bold text-orange-600",children:g("pending").length+g("awaiting_verification").length})]}),je.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[je.jsx("h4",{className:"text-sm font-medium text-green-800 mb-1",children:"Selesai"}),je.jsx("p",{className:"text-2xl font-bold text-green-600",children:g("delivered").length})]}),je.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[je.jsx("h4",{className:"text-sm font-medium text-purple-800 mb-1",children:"Total Revenue"}),je.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[Math.round(x()/1e3),"K"]})]})]}),je.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:je.jsxs("div",{className:"flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3",children:[je.jsxs("div",{className:"flex-1 relative",children:[je.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),je.jsx("input",{type:"text",placeholder:"Cari pesanan...",value:v,onChange:e=>b(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),je.jsxs("select",{value:w,onChange:e=>N(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[je.jsx("option",{value:"all",children:"Semua Status"}),Object.entries(V).map(([e,t])=>je.jsx("option",{value:e,children:t.label},e))]}),je.jsx("input",{type:"date",value:j,onChange:e=>_(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),je.jsx("button",{className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:je.jsx(fe,{className:"w-4 h-4"})})]})}),je.jsx("div",{className:"space-y-3",children:0===z.length?je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-8 text-center",children:[je.jsx(K,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),je.jsx("p",{className:"text-gray-500",children:"Belum ada pesanan"}),je.jsx("p",{className:"text-sm text-gray-400",children:"Pesanan akan muncul di sini ketika ada checkout"})]}):z.map(e=>{const s=V[e.status],n=s.icon;return je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 hover:shadow-md transition-shadow",children:[je.jsxs("div",{className:"flex items-center justify-between mb-3",children:[je.jsxs("div",{children:[je.jsxs("p",{className:"font-semibold text-lg",children:["#",e.id]}),je.jsxs("p",{className:"text-sm text-gray-600",children:[e.userName," â€¢ ",e.userEmail]}),je.jsx("p",{className:"text-xs text-gray-500",children:new Date(e.createdAt).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})})]}),je.jsxs("div",{className:"text-right",children:[je.jsxs("div",{className:`inline-flex items-center space-x-1 px-3 py-1 rounded-full text-xs font-medium ${s.color}`,children:[je.jsx(n,{className:"w-3 h-3"}),je.jsx("span",{children:s.label})]}),je.jsxs("p",{className:"text-lg font-semibold text-pink-600 mt-1",children:["Rp ",e.finalTotal.toLocaleString("id-ID")]})]})]}),je.jsxs("div",{className:"flex items-center justify-between",children:[je.jsxs("div",{className:"text-sm text-gray-600",children:[e.items.length," item â€¢ ","transfer"===e.paymentMethod?"Transfer Bank":"COD"]}),je.jsxs("div",{className:"flex items-center space-x-2",children:[je.jsxs("button",{onClick:()=>(e=>{P(e),E(!0)})(e),className:"flex items-center space-x-1 text-blue-600 hover:text-blue-700 text-sm font-medium",children:[je.jsx(W,{className:"w-4 h-4"}),je.jsx("span",{children:"Detail"})]}),"pending"===e.status||"awaiting_verification"===e.status?je.jsxs("button",{onClick:()=>q(e),className:"flex items-center space-x-1 text-green-600 hover:text-green-700 text-sm font-medium",children:[je.jsx(ne,{className:"w-4 h-4"}),je.jsx("span",{children:"Verifikasi"})]}):null,"paid"===e.status&&je.jsxs("button",{onClick:()=>H(e.id,"processing"),className:"flex items-center space-x-1 text-purple-600 hover:text-purple-700 text-sm font-medium",children:[je.jsx(K,{className:"w-4 h-4"}),je.jsx("span",{children:"Proses"})]}),"processing"===e.status&&je.jsxs("button",{onClick:()=>H(e.id,"shipped"),className:"flex items-center space-x-1 text-indigo-600 hover:text-indigo-700 text-sm font-medium",children:[je.jsx(re,{className:"w-4 h-4"}),je.jsx("span",{children:"Kirim"})]}),"shipped"===e.status&&je.jsxs("button",{onClick:()=>H(e.id,"delivered"),className:"flex items-center space-x-1 text-green-600 hover:text-green-700 text-sm font-medium",children:[je.jsx(ne,{className:"w-4 h-4"}),je.jsx("span",{children:"Selesai"})]}),("owner"===(null==t?void 0:t.role)||"admin"===(null==t?void 0:t.role))&&je.jsxs("button",{onClick:()=>{return t=e.id,void(window.confirm("Apakah Anda yakin ingin menghapus pesanan ini?")&&p(t));var t},className:"flex items-center space-x-1 text-red-600 hover:text-red-700 text-sm font-medium",children:[je.jsx(se,{className:"w-4 h-4"}),je.jsx("span",{children:"Batal"})]})]})]})]},e.id)})})]}),k&&C&&je.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:je.jsxs("div",{className:"bg-white rounded-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[je.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4",children:je.jsxs("div",{className:"flex items-center justify-between",children:[je.jsxs("h2",{className:"text-xl font-bold text-gray-800",children:["Detail Pesanan #",C.id]}),je.jsx("button",{onClick:()=>E(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:je.jsx($,{className:"w-5 h-5 text-gray-500"})})]})}),je.jsxs("div",{className:"p-6 space-y-6",children:[je.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[je.jsxs("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center",children:[je.jsx(S,{className:"w-4 h-4 mr-2"}),"Informasi Pelanggan"]}),je.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[je.jsxs("div",{children:[je.jsx("p",{className:"text-gray-600",children:"Nama"}),je.jsx("p",{className:"font-medium",children:C.userName})]}),je.jsxs("div",{children:[je.jsx("p",{className:"text-gray-600",children:"Email"}),je.jsx("p",{className:"font-medium",children:C.userEmail})]})]})]}),je.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[je.jsxs("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center",children:[je.jsx(U,{className:"w-4 h-4 mr-2"}),"Informasi Pengiriman"]}),je.jsxs("div",{className:"space-y-2 text-sm",children:[je.jsxs("div",{children:[je.jsx("p",{className:"text-gray-600",children:"Nama Penerima"}),je.jsx("p",{className:"font-medium",children:(null==(s=C.shippingInfo)?void 0:s.name)||"-"})]}),je.jsxs("div",{children:[je.jsx("p",{className:"text-gray-600",children:"No. Telepon"}),je.jsxs("p",{className:"font-medium flex items-center",children:[je.jsx(B,{className:"w-3 h-3 mr-1"}),(null==(n=C.shippingInfo)?void 0:n.phone)||"-"]})]}),je.jsxs("div",{children:[je.jsx("p",{className:"text-gray-600",children:"Alamat"}),je.jsx("p",{className:"font-medium",children:(null==(r=C.shippingInfo)?void 0:r.address)||"-"})]}),(null==(i=C.shippingInfo)?void 0:i.isDropship)&&je.jsx("div",{className:"mt-2 p-2 bg-yellow-100 rounded",children:je.jsxs("p",{className:"text-xs text-yellow-800",children:[je.jsx("strong",{children:"Dropship:"})," ",C.shippingInfo.dropshipName," (",C.shippingInfo.dropshipPhone,")"]})})]})]}),je.jsxs("div",{children:[je.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Detail Produk"}),je.jsx("div",{className:"space-y-3",children:null==(a=C.items)?void 0:a.map((e,t)=>{var s,n;return je.jsxs("div",{className:"flex items-center space-x-4 p-3 bg-gray-50 rounded-lg",children:[je.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",children:je.jsx(K,{className:"w-6 h-6 text-gray-400"})}),je.jsxs("div",{className:"flex-1",children:[je.jsx("p",{className:"font-medium",children:e.productName}),je.jsxs("p",{className:"text-sm text-gray-600",children:[null==(s=e.selectedVariant)?void 0:s.size,", ",null==(n=e.selectedVariant)?void 0:n.color," â€¢ ",e.quantity," pcs"]})]}),je.jsxs("div",{className:"text-right",children:[je.jsxs("p",{className:"font-medium",children:["Rp ",e.price.toLocaleString("id-ID")]}),je.jsxs("p",{className:"text-sm text-gray-600",children:["Total: Rp ",e.total.toLocaleString("id-ID")]})]})]},t)})})]}),je.jsx("div",{className:"border-t pt-4",children:je.jsxs("div",{className:"space-y-2 text-sm",children:[je.jsxs("div",{className:"flex justify-between",children:[je.jsx("span",{className:"text-gray-600",children:"Subtotal"}),je.jsxs("span",{className:"font-medium",children:["Rp ",null==(o=C.totalAmount)?void 0:o.toLocaleString("id-ID")]})]}),je.jsxs("div",{className:"flex justify-between",children:[je.jsx("span",{className:"text-gray-600",children:"Ongkos Kirim"}),je.jsxs("span",{className:"font-medium",children:["Rp ",null==(l=C.shippingCost)?void 0:l.toLocaleString("id-ID")]})]}),je.jsxs("div",{className:"flex justify-between text-lg font-bold pt-2 border-t",children:[je.jsx("span",{children:"Total"}),je.jsxs("span",{className:"text-pink-600",children:["Rp ",null==(c=C.finalTotal)?void 0:c.toLocaleString("id-ID")]})]})]})}),C.paymentProof&&je.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[je.jsxs("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center",children:[je.jsx(ie,{className:"w-4 h-4 mr-2"}),"Bukti Pembayaran"]}),C.paymentProofUrl?je.jsx("img",{src:C.paymentProofUrl,alt:"Payment Proof",className:"w-full max-w-md rounded-lg border-2 border-green-200"}):je.jsx("p",{className:"text-sm text-green-800",children:"Bukti pembayaran telah tersimpan"})]}),C.notes&&je.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4",children:[je.jsx("h3",{className:"font-semibold text-gray-800 mb-2",children:"Catatan"}),je.jsx("p",{className:"text-sm text-gray-700",children:C.notes})]}),je.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t",children:[je.jsx("button",{onClick:()=>E(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"Tutup"}),("pending"===C.status||"awaiting_verification"===C.status)&&je.jsxs("button",{onClick:()=>{E(!1),q(C)},className:"px-4 py-2 bg-green-600 text-white hover:bg-green-700 rounded-lg transition-colors flex items-center space-x-2",children:[je.jsx(ne,{className:"w-4 h-4"}),je.jsx("span",{children:"Verifikasi Pembayaran"})]})]})]})]})}),D&&C&&je.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:je.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full",children:[je.jsx("div",{className:"border-b border-gray-200 px-6 py-4",children:je.jsxs("div",{className:"flex items-center justify-between",children:[je.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Verifikasi Pembayaran"}),je.jsx("button",{onClick:()=>R(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:je.jsx($,{className:"w-5 h-5 text-gray-500"})})]})}),je.jsxs("div",{className:"p-6 space-y-4",children:[je.jsxs("div",{className:"text-center",children:[je.jsx(ne,{className:"w-12 h-12 text-green-600 mx-auto mb-3"}),je.jsxs("h3",{className:"font-medium text-gray-800 mb-2",children:["Pesanan #",C.id]}),je.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Total: Rp ",null==(d=C.finalTotal)?void 0:d.toLocaleString("id-ID")]})]}),je.jsx("div",{className:"space-y-3",children:je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Catatan Verifikasi"}),je.jsx("textarea",{value:M,onChange:e=>F(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Tambahkan catatan jika diperlukan..."})]})}),je.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:je.jsxs("p",{className:"text-sm text-blue-800",children:[je.jsx("strong",{children:"Periksa:"})," Pastikan bukti pembayaran sudah sesuai dengan jumlah yang dibayarkan."]})}),je.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t",children:[je.jsx("button",{onClick:()=>G("cancelled"),className:"px-4 py-2 text-red-700 bg-red-100 hover:bg-red-200 rounded-lg transition-colors",children:"Tolak"}),je.jsxs("button",{onClick:()=>G("paid"),className:"px-4 py-2 bg-green-600 text-white hover:bg-green-700 rounded-lg transition-colors flex items-center space-x-2",children:[je.jsx(xe,{className:"w-4 h-4"}),je.jsx("span",{children:"Konfirmasi"})]})]})]})]})})]})},kg=({onBack:e,user:t})=>{const[s,n]=f.useState("sales"),[r,i]=f.useState("today"),[a,o]=f.useState((new Date).toISOString().split("T")[0]),[l,c]=f.useState((new Date).toISOString().split("T")[0]),d={sales:{totalSales:25e5,totalOrders:45,avgOrderValue:55555,topProduct:"Hijab Segi Empat Premium",topCategory:"Hijab",growth:15.5},products:{totalProducts:12,lowStock:3,outOfStock:0,topSelling:"Gamis Syari Elegant",worstSelling:"Khimar Basic",avgPrice:125e3},customers:{totalCustomers:234,newCustomers:28,activeCustomers:189,topCustomer:"Siti Nurhaliza",avgOrdersPerCustomer:2.3}},u=d[s]||d.sales;return je.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[je.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4",children:je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx("button",{onClick:e,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:je.jsx(A,{className:"w-5 h-5"})}),je.jsx("h1",{className:"text-xl font-bold",children:"Laporan"})]})}),je.jsxs("div",{className:"p-4 space-y-4",children:[je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Jenis Laporan"}),je.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[je.jsxs("button",{onClick:()=>n("sales"),className:"p-3 rounded-lg border-2 transition-colors "+("sales"===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"),children:[je.jsx(le,{className:"w-6 h-6 mx-auto mb-2"}),je.jsx("p",{className:"text-sm font-medium",children:"Penjualan"})]}),je.jsxs("button",{onClick:()=>n("products"),className:"p-3 rounded-lg border-2 transition-colors "+("products"===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"),children:[je.jsx(K,{className:"w-6 h-6 mx-auto mb-2"}),je.jsx("p",{className:"text-sm font-medium",children:"Produk"})]}),je.jsxs("button",{onClick:()=>n("customers"),className:"p-3 rounded-lg border-2 transition-colors "+("customers"===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"),children:[je.jsx(ce,{className:"w-6 h-6 mx-auto mb-2"}),je.jsx("p",{className:"text-sm font-medium",children:"Pelanggan"})]}),je.jsxs("button",{onClick:()=>n("financial"),className:"p-3 rounded-lg border-2 transition-colors "+("financial"===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"),children:[je.jsx(de,{className:"w-6 h-6 mx-auto mb-2"}),je.jsx("p",{className:"text-sm font-medium",children:"Keuangan"})]})]})]}),je.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:je.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:space-x-4 space-y-3 md:space-y-0",children:[je.jsxs("div",{className:"flex-1",children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Periode"}),je.jsxs("select",{value:r,onChange:e=>i(e.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[je.jsx("option",{value:"today",children:"Hari Ini"}),je.jsx("option",{value:"week",children:"Minggu Ini"}),je.jsx("option",{value:"month",children:"Bulan Ini"}),je.jsx("option",{value:"year",children:"Tahun Ini"}),je.jsx("option",{value:"custom",children:"Custom"})]})]}),"custom"===r&&je.jsxs(je.Fragment,{children:[je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dari"}),je.jsx("input",{type:"date",value:a,onChange:e=>o(e.target.value),className:"p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),je.jsxs("div",{children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sampai"}),je.jsx("input",{type:"date",value:l,onChange:e=>c(e.target.value),className:"p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),je.jsxs("button",{className:"p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[je.jsx(ye,{className:"w-4 h-4"}),je.jsx("span",{children:"Generate"})]}),je.jsx("button",{className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:je.jsx(fe,{className:"w-4 h-4"})})]})}),je.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsxs("div",{className:"flex items-center justify-between mb-2",children:[je.jsxs("h3",{className:"text-sm font-medium text-gray-600",children:["Total ","sales"===s?"Penjualan":"products"===s?"Produk":"Pelanggan"]}),je.jsx(de,{className:"w-4 h-4 text-green-500"})]}),je.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["sales"===s&&`Rp ${u.totalSales.toLocaleString("id-ID")}`,"products"===s&&u.totalProducts,"customers"===s&&u.totalCustomers,"financial"===s&&"Rp 5.2M"]}),je.jsx("p",{className:"text-xs text-green-600",children:"+15.5% dari periode lalu"})]}),je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsxs("div",{className:"flex items-center justify-between mb-2",children:[je.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Transaksi"}),je.jsx(K,{className:"w-4 h-4 text-blue-500"})]}),je.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["sales"===s&&u.totalOrders,"products"===s&&u.lowStock,"customers"===s&&u.newCustomers,"financial"===s&&"142"]}),je.jsxs("p",{className:"text-xs text-gray-500",children:["sales"===s&&"Total pesanan","products"===s&&"Stok rendah","customers"===s&&"Pelanggan baru","financial"===s&&"Total transaksi"]})]}),je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsxs("div",{className:"flex items-center justify-between mb-2",children:[je.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Rata-rata"}),je.jsx(ve,{className:"w-4 h-4 text-purple-500"})]}),je.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["sales"===s&&`Rp ${u.avgOrderValue.toLocaleString("id-ID")}`,"products"===s&&`Rp ${u.avgPrice.toLocaleString("id-ID")}`,"customers"===s&&u.avgOrdersPerCustomer,"financial"===s&&"Rp 36K"]}),je.jsxs("p",{className:"text-xs text-gray-500",children:["sales"===s&&"Nilai per order","products"===s&&"Harga rata-rata","customers"===s&&"Order per pelanggan","financial"===s&&"Transaksi rata-rata"]})]}),je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsxs("div",{className:"flex items-center justify-between mb-2",children:[je.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Terbaik"}),je.jsx(le,{className:"w-4 h-4 text-orange-500"})]}),je.jsx("p",{className:"text-lg font-bold text-gray-800 truncate",children:u.topProduct||u.topCustomer||"Hijab"}),je.jsxs("p",{className:"text-xs text-gray-500 truncate",children:["sales"===s&&"Produk terlaris","products"===s&&"Produk terlaris","customers"===s&&"Pelanggan terbaik","financial"===s&&"Kategori terlaris"]})]})]}),je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[je.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Grafik ","sales"===s?"Penjualan":"products"===s?"Produk":"Pelanggan"]}),je.jsx("div",{className:"h-64 bg-gray-100 rounded-lg flex items-center justify-center",children:je.jsxs("div",{className:"text-center",children:[je.jsx(le,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),je.jsx("p",{className:"text-gray-500",children:"Grafik akan ditampilkan di sini"}),je.jsx("p",{className:"text-sm text-gray-400",children:"Integrasi chart library diperlukan"})]})})]}),je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsxs("div",{className:"flex items-center justify-between mb-4",children:[je.jsxs("h3",{className:"text-lg font-semibold",children:["Detail ","sales"===s?"Penjualan":"Data"]}),je.jsx("button",{className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:je.jsx(fe,{className:"w-4 h-4"})})]}),je.jsx("div",{className:"overflow-x-auto",children:je.jsxs("table",{className:"w-full text-sm",children:[je.jsx("thead",{children:je.jsxs("tr",{className:"border-b",children:[je.jsx("th",{className:"text-left py-2",children:"Tanggal"}),je.jsx("th",{className:"text-left py-2",children:"Deskripsi"}),je.jsx("th",{className:"text-right py-2",children:"Jumlah"}),je.jsx("th",{className:"text-right py-2",children:"Total"})]})}),je.jsxs("tbody",{children:[je.jsxs("tr",{className:"border-b",children:[je.jsx("td",{className:"py-2",children:"15 Jan 2024"}),je.jsx("td",{className:"py-2",children:"Penjualan Hijab Premium"}),je.jsx("td",{className:"text-right",children:"5"}),je.jsx("td",{className:"text-right font-medium",children:"Rp 425.000"})]}),je.jsxs("tr",{className:"border-b",children:[je.jsx("td",{className:"py-2",children:"14 Jan 2024"}),je.jsx("td",{className:"py-2",children:"Penjualan Gamis Syari"}),je.jsx("td",{className:"text-right",children:"3"}),je.jsx("td",{className:"text-right font-medium",children:"Rp 495.000"})]})]})]})})]})]})]})},Sg=({onBack:e,user:t})=>{const[s,n]=f.useState(""),[r,i]=f.useState("all"),[a,o]=f.useState("all"),l=[{id:"USR001",name:"Siti Nurhaliza",email:"siti@email.com",phone:"08123456789",role:"customer",status:"active",joinDate:"2024-01-10",totalOrders:5,totalSpent:125e4},{id:"USR002",name:"Ahmad Fauzi",email:"ahmad@email.com",phone:"08234567890",role:"reseller",status:"active",joinDate:"2024-01-05",totalOrders:12,totalSpent:24e5,points:450},{id:"USR003",name:"Ratna Dewi",email:"ratna@email.com",phone:"08345678901",role:"customer",status:"active",joinDate:"2024-01-08",totalOrders:3,totalSpent:675e3},{id:"USR004",name:"Budi Santoso",email:"budi@email.com",phone:"08456789012",role:"admin",status:"active",joinDate:"2024-01-01",totalOrders:0,totalSpent:0}],c={owner:{label:"Owner",color:"text-red-600 bg-red-100",icon:Y},admin:{label:"Administrator",color:"text-purple-600 bg-purple-100",icon:Y},reseller:{label:"Reseller",color:"text-blue-600 bg-blue-100",icon:pe},customer:{label:"Customer",color:"text-green-600 bg-green-100",icon:ce}},d=l.filter(e=>{const t=e.name.toLowerCase().includes(s.toLowerCase())||e.email.toLowerCase().includes(s.toLowerCase()),n="all"===r||e.role===r,i="all"===a||e.status===a;return t&&n&&i});return je.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[je.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4",children:je.jsxs("div",{className:"flex items-center justify-between",children:[je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx("button",{onClick:e,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:je.jsx(A,{className:"w-5 h-5"})}),je.jsx("h1",{className:"text-xl font-bold",children:"Kelola Pengguna"})]}),je.jsxs("button",{className:"bg-white text-blue-600 px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors flex items-center space-x-2",children:[je.jsx(O,{className:"w-4 h-4"}),je.jsx("span",{children:"Tambah User"})]})]})}),je.jsxs("div",{className:"p-4 space-y-4",children:[je.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[je.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[je.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-1",children:"Total User"}),je.jsx("p",{className:"text-2xl font-bold text-blue-600",children:l.length}),je.jsx("p",{className:"text-xs text-blue-600",children:"Semua role"})]}),je.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[je.jsx("h4",{className:"text-sm font-medium text-green-800 mb-1",children:"User Aktif"}),je.jsx("p",{className:"text-2xl font-bold text-green-600",children:l.filter(e=>"active"===e.status).length}),je.jsxs("p",{className:"text-xs text-green-600",children:[Math.round(l.filter(e=>"active"===e.status).length/l.length*100),"% aktivasi"]})]}),je.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[je.jsx("h4",{className:"text-sm font-medium text-purple-800 mb-1",children:"Reseller"}),je.jsx("p",{className:"text-2xl font-bold text-purple-600",children:l.filter(e=>"reseller"===e.role).length}),je.jsx("p",{className:"text-xs text-purple-600",children:"Partner bisnis"})]}),je.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[je.jsx("h4",{className:"text-sm font-medium text-orange-800 mb-1",children:"User Baru"}),je.jsx("p",{className:"text-2xl font-bold text-orange-600",children:"2"}),je.jsx("p",{className:"text-xs text-orange-600",children:"Bulan ini"})]})]}),je.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:je.jsxs("div",{className:"flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3",children:[je.jsxs("div",{className:"flex-1 relative",children:[je.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),je.jsx("input",{type:"text",placeholder:"Cari user...",value:s,onChange:e=>n(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),je.jsxs("select",{value:r,onChange:e=>i(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[je.jsx("option",{value:"all",children:"Semua Role"}),je.jsx("option",{value:"customer",children:"Customer"}),je.jsx("option",{value:"reseller",children:"Reseller"}),je.jsx("option",{value:"admin",children:"Admin"}),je.jsx("option",{value:"owner",children:"Owner"})]}),je.jsxs("select",{value:a,onChange:e=>o(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[je.jsx("option",{value:"all",children:"Semua Status"}),je.jsx("option",{value:"active",children:"Aktif"}),je.jsx("option",{value:"inactive",children:"Non-aktif"}),je.jsx("option",{value:"banned",children:"Banned"})]}),je.jsx("button",{className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:je.jsx(E,{className:"w-4 h-4"})})]})}),je.jsx("div",{className:"space-y-3",children:d.map(e=>{const s=c[e.role],n=s.icon;return je.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[je.jsxs("div",{className:"flex items-center justify-between mb-3",children:[je.jsxs("div",{className:"flex items-center space-x-3",children:[je.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-100 to-purple-100 rounded-full flex items-center justify-center",children:je.jsx(ce,{className:"w-6 h-6 text-blue-600"})}),je.jsxs("div",{children:[je.jsx("p",{className:"font-semibold text-lg",children:e.name}),je.jsx("p",{className:"text-sm text-gray-600",children:e.email}),je.jsxs("p",{className:"text-xs text-gray-500",children:[e.phone," â€¢ Bergabung: ",e.joinDate]})]})]}),je.jsxs("div",{className:"text-right",children:[je.jsxs("div",{className:`inline-flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium ${s.color}`,children:[je.jsx(n,{className:"w-3 h-3"}),je.jsx("span",{children:s.label})]}),je.jsx("div",{className:"mt-1",children:je.jsxs("span",{className:"inline-flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium "+("active"===e.status?"text-green-600 bg-green-100":"text-gray-600 bg-gray-100"),children:[je.jsx("span",{className:"w-2 h-2 bg-current rounded-full"}),je.jsx("span",{children:"active"===e.status?"Aktif":"Non-aktif"})]})})]})]}),je.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-3",children:[je.jsxs("div",{className:"text-center p-2 bg-gray-50 rounded",children:[je.jsx("p",{className:"text-xs text-gray-600",children:"Total Order"}),je.jsx("p",{className:"font-semibold",children:e.totalOrders})]}),je.jsxs("div",{className:"text-center p-2 bg-gray-50 rounded",children:[je.jsx("p",{className:"text-xs text-gray-600",children:"Total Belanja"}),je.jsxs("p",{className:"font-semibold",children:["Rp ",e.totalSpent.toLocaleString("id-ID")]})]}),"reseller"===e.role&&je.jsxs("div",{className:"text-center p-2 bg-blue-50 rounded",children:[je.jsx("p",{className:"text-xs text-blue-600",children:"Poin Reseller"}),je.jsxs("p",{className:"font-semibold text-blue-600",children:[e.points||0," pts"]})]}),je.jsxs("div",{className:"text-center p-2 bg-gray-50 rounded",children:[je.jsx("p",{className:"text-xs text-gray-600",children:"User ID"}),je.jsx("p",{className:"font-semibold text-xs",children:e.id})]})]}),je.jsxs("div",{className:"flex items-center justify-between",children:[je.jsx("div",{className:"text-xs text-gray-500",children:"Terakhir login: 2 hari yang lalu"}),je.jsxs("div",{className:"flex items-center space-x-2",children:[je.jsx("button",{className:"p-1 text-blue-600 hover:text-blue-700 transition-colors",children:je.jsx(W,{className:"w-4 h-4"})}),je.jsx("button",{className:"p-1 text-green-600 hover:text-green-700 transition-colors",children:je.jsx(ge,{className:"w-4 h-4"})}),"owner"===(null==t?void 0:t.role)&&je.jsx("button",{className:"p-1 text-red-600 hover:text-red-700 transition-colors",children:je.jsx(M,{className:"w-4 h-4"})})]})]})]},e.id)})})]})]})},Tg=({currentPage:e,onPageChange:t})=>{const s=[{id:"home",label:"Beranda",icon:be},{id:"flash-sale",label:"Flash Sale",icon:ee},{id:"orders",label:"Pesanan",icon:K},{id:"account",label:"âš™ï¸ Pengaturan",icon:S}];return je.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg",children:je.jsx("div",{className:"flex",children:s.map(s=>{const n=s.icon,r=e===s.id;return je.jsxs("button",{onClick:()=>t(s.id),className:"flex-1 flex flex-col items-center py-3 px-2 transition-colors "+(r?"text-pink-600 bg-pink-50":"text-gray-600 hover:text-pink-600 hover:bg-gray-50"),children:[je.jsx(n,{className:"w-6 h-6 mb-1 "+(r?"text-pink-600":"text-gray-600")}),je.jsx("span",{className:"text-xs font-medium "+(r?"text-pink-600":"text-gray-600"),children:s.label})]},s.id)})})})},Ig=({originCityId:t="152",weight:s=1e3,onCostSelected:n,className:r=""})=>{const[i,a]=f.useState([]),[o,l]=f.useState([]),[c,d]=f.useState(""),[u,h]=f.useState(""),[m,p]=f.useState("jne"),[x,y]=f.useState([]),[v,b]=f.useState(!1),[w,N]=f.useState(!1),[j,_]=f.useState(""),[k,S]=f.useState(null);f.useEffect(()=>{I()},[]),f.useEffect(()=>{c?E(c):l([])},[c]);const I=()=>g(e,null,function*(){try{b(!0);const e=yield dg.getProvinces();a(e)}catch(e){_("Gagal memuat data provinsi")}finally{b(!1)}}),E=t=>g(e,null,function*(){try{N(!0);const e=yield dg.getCities(t);l(e),h("")}catch(e){_("Gagal memuat data kota")}finally{N(!1)}});return v&&0===i.length?je.jsx("div",{className:`bg-white rounded-lg shadow-sm border border-gray-200 p-6 ${r}`,children:je.jsxs("div",{className:"flex items-center justify-center py-8",children:[je.jsx(V,{className:"w-8 h-8 animate-spin text-blue-500 mr-2"}),je.jsx("span",{className:"text-gray-600",children:"Memuat data provinsi..."})]})}):je.jsxs("div",{className:`bg-white rounded-lg shadow-sm border border-gray-200 p-6 ${r}`,children:[je.jsxs("div",{className:"flex items-center mb-4",children:[je.jsx(re,{className:"w-5 h-5 text-blue-500 mr-2"}),je.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Cek Ongkos Kirim"})]}),je.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[je.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[je.jsx(U,{className:"w-4 h-4 mr-2"}),je.jsx("span",{children:"Dikirim dari Jakarta"})]}),je.jsxs("div",{className:"flex items-center text-sm text-gray-600 mt-1",children:[je.jsx(K,{className:"w-4 h-4 mr-2"}),je.jsxs("span",{children:["Berat: ",(s/1e3).toFixed(1)," kg"]})]})]}),je.jsxs("div",{className:"mb-4",children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Provinsi Tujuan"}),je.jsxs("select",{value:c,onChange:e=>d(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[je.jsx("option",{value:"",children:"-- Pilih Provinsi --"}),i.map(e=>je.jsx("option",{value:e.province_id,children:e.province},e.province_id))]})]}),je.jsxs("div",{className:"mb-4",children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kota/Kabupaten Tujuan"}),je.jsxs("select",{value:u,onChange:e=>h(e.target.value),disabled:!c||w,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-100",children:[je.jsx("option",{value:"",children:"-- Pilih Kota --"}),o.map(e=>je.jsxs("option",{value:e.city_id,children:[e.type," ",e.city_name]},e.city_id))]}),w&&je.jsxs("div",{className:"flex items-center mt-2 text-sm text-gray-500",children:[je.jsx(V,{className:"w-4 h-4 animate-spin mr-1"}),"Memuat kota..."]})]}),je.jsxs("div",{className:"mb-4",children:[je.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kurir"}),je.jsx("select",{value:m,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:dg.getCouriers().map(e=>je.jsx("option",{value:e.code,children:e.name},e.code))})]}),je.jsx("button",{onClick:()=>g(e,null,function*(){if(u&&m)try{b(!0),_(""),y([]);const e=yield dg.calculateCost(t,u,s,m);y(e)}catch(e){_(e.message||"Gagal menghitung ongkos kirim")}finally{b(!1)}else _("Silakan pilih kota tujuan dan kurir")}),disabled:!u||v,className:"w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-lg disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors duration-200 flex items-center justify-center",children:v?je.jsxs(je.Fragment,{children:[je.jsx(V,{className:"w-4 h-4 animate-spin mr-2"}),"Menghitung..."]}):je.jsxs(je.Fragment,{children:[je.jsx(T,{className:"w-4 h-4 mr-2"}),"Cek Ongkir"]})}),j&&je.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:je.jsx("p",{className:"text-sm text-red-600",children:j})}),x.length>0&&je.jsxs("div",{className:"mt-4 space-y-3",children:[je.jsxs("h4",{className:"font-medium text-gray-700",children:["Hasil Pencarian - ",(()=>{const e=dg.getCouriers().find(e=>e.code===m);return(null==e?void 0:e.name)||m.toUpperCase()})()]}),x.map(e=>je.jsxs("div",{className:"border border-gray-200 rounded-lg p-3",children:[je.jsxs("div",{className:"flex items-center mb-2",children:[je.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mr-3",children:je.jsx(re,{className:"w-4 h-4 text-blue-600"})}),je.jsxs("div",{children:[je.jsx("p",{className:"font-medium text-gray-800",children:e.name}),je.jsx("p",{className:"text-sm text-gray-500",children:e.code.toUpperCase()})]})]}),je.jsx("div",{className:"space-y-2",children:e.costs.map((t,s)=>je.jsx("button",{onClick:()=>((e,t,s,r)=>{S({courier:e,service:t,cost:s,etd:r}),n&&n(e,t,s,r)})(e.code,t.service,t.cost[0].value,t.cost[0].etd),className:"w-full text-left p-3 rounded-lg border transition-colors duration-200 "+((null==k?void 0:k.courier)===e.code&&(null==k?void 0:k.service)===t.service?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"),children:je.jsxs("div",{className:"flex items-center justify-between",children:[je.jsxs("div",{className:"flex-1",children:[je.jsx("p",{className:"font-medium text-gray-800",children:t.service}),je.jsx("p",{className:"text-sm text-gray-600",children:t.description}),je.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Estimasi: ",je.jsx("span",{className:"font-medium",children:t.cost[0].etd})]})]}),je.jsxs("div",{className:"text-right",children:[je.jsxs("p",{className:"font-bold text-green-600",children:["Rp ",t.cost[0].value.toLocaleString("id-ID")]}),(null==k?void 0:k.courier)===e.code&&(null==k?void 0:k.service)===t.service&&je.jsx("span",{className:"text-xs bg-blue-500 text-white px-2 py-1 rounded-full",children:"Dipilih"})]})]})},s))})]},e.code))]})]})},Eg=({onBack:e})=>{const[t,s]=f.useState(null);return je.jsxs("div",{className:"min-h-screen bg-gray-50",children:[je.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:je.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4",children:je.jsxs("div",{className:"flex items-center",children:[je.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors duration-200 mr-3",children:je.jsx(A,{className:"w-5 h-5"})}),je.jsxs("div",{className:"flex items-center",children:[je.jsx(we,{className:"w-6 h-6 text-blue-500 mr-3"}),je.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Cek Ongkos Kirim"})]})]})})}),je.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-6",children:[je.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[je.jsx("div",{className:"lg:col-span-2",children:je.jsx(Ig,{originCityId:"152",weight:1e3,onCostSelected:(e,t,n,r)=>{s({courier:e,service:t,cost:n,etd:r})}})}),je.jsx("div",{className:"lg:col-span-1",children:je.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 sticky top-6",children:[je.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[je.jsx(K,{className:"w-5 h-5 mr-2"}),"Info Pengiriman"]}),t?je.jsxs("div",{className:"space-y-4",children:[je.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[je.jsx("p",{className:"text-sm font-medium text-green-800 mb-2",children:"âœ… Pengiriman Terpilih"}),je.jsxs("div",{className:"space-y-2",children:[je.jsxs("div",{children:[je.jsx("p",{className:"text-sm text-gray-600",children:"Kurir"}),je.jsx("p",{className:"font-medium text-gray-800",children:(n=t.courier,{jne:"JNE",tiki:"TIKI",pos:"POS Indonesia",jnt:"J&T Express",sicepat:"SiCepat",wahana:"Wahana",anteraja:"AnterAja"}[n]||n.toUpperCase())})]}),je.jsxs("div",{children:[je.jsx("p",{className:"text-sm text-gray-600",children:"Layanan"}),je.jsx("p",{className:"font-medium text-gray-800",children:t.service})]}),je.jsxs("div",{children:[je.jsx("p",{className:"text-sm text-gray-600",children:"Estimasi"}),je.jsx("p",{className:"font-medium text-gray-800",children:t.etd})]}),je.jsxs("div",{children:[je.jsx("p",{className:"text-sm text-gray-600",children:"Biaya"}),je.jsxs("p",{className:"font-bold text-lg text-green-600",children:["Rp ",t.cost.toLocaleString("id-ID")]})]})]})]}),je.jsx("button",{className:"w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-4 rounded-lg transition-colors duration-200",children:"Lanjut ke Pembayaran"})]}):je.jsxs("div",{className:"text-center py-8",children:[je.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:je.jsx(K,{className:"w-8 h-8 text-gray-400"})}),je.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"Belum ada metode pengiriman yang dipilih"}),je.jsx("p",{className:"text-gray-400 text-xs",children:"Pilih kurir dan layanan di form sebelah kiri"})]}),je.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[je.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"Informasi Tambahan"}),je.jsxs("div",{className:"space-y-2 text-xs text-gray-500",children:[je.jsxs("div",{className:"flex items-start",children:[je.jsx("span",{className:"mr-2",children:"â€¢"}),je.jsx("span",{children:"Estimasi waktu pengiriman dapat berubah tergantung kondisi"})]}),je.jsxs("div",{className:"flex items-start",children:[je.jsx("span",{className:"mr-2",children:"â€¢"}),je.jsx("span",{children:"Biaya yang tertera adalah estimasi dan belum termasuk asuransi"})]}),je.jsxs("div",{className:"flex items-start",children:[je.jsx("span",{className:"mr-2",children:"â€¢"}),je.jsx("span",{children:"Proses pengiriman akan dilakukan pada hari kerja"})]})]})]})]})})]}),je.jsxs("div",{className:"mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6",children:[je.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-4",children:"Cara Penggunaan"}),je.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[je.jsxs("div",{className:"text-center",children:[je.jsx("div",{className:"w-12 h-12 bg-blue-500 text-white rounded-full flex items-center justify-center mx-auto mb-2 font-bold",children:"1"}),je.jsx("p",{className:"text-sm text-blue-700",children:"Pilih provinsi tujuan"})]}),je.jsxs("div",{className:"text-center",children:[je.jsx("div",{className:"w-12 h-12 bg-blue-500 text-white rounded-full flex items-center justify-center mx-auto mb-2 font-bold",children:"2"}),je.jsx("p",{className:"text-sm text-blue-700",children:"Pilih kota/kabupaten"})]}),je.jsxs("div",{className:"text-center",children:[je.jsx("div",{className:"w-12 h-12 bg-blue-500 text-white rounded-full flex items-center justify-center mx-auto mb-2 font-bold",children:"3"}),je.jsx("p",{className:"text-sm text-blue-700",children:"Pilih kurir"})]}),je.jsxs("div",{className:"text-center",children:[je.jsx("div",{className:"w-12 h-12 bg-blue-500 text-white rounded-full flex items-center justify-center mx-auto mb-2 font-bold",children:"4"}),je.jsx("p",{className:"text-sm text-blue-700",children:'Klik "Cek Ongkir"'})]})]})]})]})]});var n};function Cg(){const[e,t]=f.useState("home"),[s,n]=f.useState(null),[r,i]=f.useState(!1),[a,o]=f.useState(!1),[l,c]=f.useState([]),{user:h,logout:m}=mg(),{products:p,loading:g,updateProductStock:x}=wg(),{addOrder:y}=Ie();f.useEffect(()=>{console.log("ðŸš€ App initializing... Checking localStorage"),ke.initializeApp(),ke.validateAndSyncFeaturedProducts(),console.log("ðŸš€ App initialized with featured products validation");const e=localStorage.getItem("azzahra_cart");if(e)try{const t=JSON.parse(e);c(t),console.log("âœ… Cart restored:",t.length,"items")}catch(s){console.error("âŒ Error restoring cart:",s),localStorage.removeItem("azzahra_cart")}else console.log("â„¹ï¸ No saved cart found");"/ongkir-test"===window.location.pathname&&t("ongkir-test")},[]);const v=e=>{n(e),t("product-detail")},b=()=>{i(!0)},w=e=>{i(!1),console.log("âœ… Firebase user logged in:",e.name,e.role)},N=()=>{console.log("ðŸ”ƒ User logging out from Firebase"),m(),c([]),t("home"),localStorage.removeItem("azzahra_cart"),console.log("âœ… Firebase logout successful"),console.log("ðŸ“¦ Cart cleared from localStorage")},j=(e,t,s)=>{const n=u(d({},e),{selectedVariant:t,quantity:s,cartId:`${e.id}-${null==t?void 0:t.size}-${null==t?void 0:t.color}`,addedAt:(new Date).toISOString()});c(r=>{const i=r.findIndex(s=>{var n,r;return s.id===e.id&&(null==(n=s.selectedVariant)?void 0:n.size)===(null==t?void 0:t.size)&&(null==(r=s.selectedVariant)?void 0:r.color)===(null==t?void 0:t.color)});let a;return i>=0?(a=[...r],a[i].quantity+=s,a[i].addedAt=(new Date).toISOString()):a=[...r,n],localStorage.setItem("azzahra_cart",JSON.stringify(a)),console.log("ðŸ’¾ Cart saved to localStorage:",a.length,"items"),a}),alert("Produk berhasil ditambahkan ke keranjang!")},_=e=>{if(!h)return void b();const t={size:e.variants.sizes[0],color:e.variants.colors[0]};j(e,t,1)},k=(e,s,n)=>{h?(j(e,s,n),setTimeout(()=>{t("checkout")},500)):b()},S=(e,t,s)=>{c(n=>{const r=n.map(n=>{var r,i;return n.id===e&&(null==(r=n.selectedVariant)?void 0:r.size)===(null==t?void 0:t.size)&&(null==(i=n.selectedVariant)?void 0:i.color)===(null==t?void 0:t.color)?u(d({},n),{quantity:Math.max(1,s)}):n});return localStorage.setItem("azzahra_cart",JSON.stringify(r)),r})},T=(e,t)=>{c(s=>{const n=s.filter(s=>{var n,r;return!(s.id===e&&(null==(n=s.selectedVariant)?void 0:n.size)===(null==t?void 0:t.size)&&(null==(r=s.selectedVariant)?void 0:r.color)===(null==t?void 0:t.color))});return localStorage.setItem("azzahra_cart",JSON.stringify(n)),n})},I=e=>{const t="AZF"+Date.now().toString().slice(-8);return y({id:t,userId:h.id,userName:h.name,userEmail:h.email,items:l.map(e=>({productId:e.id,productName:e.name,selectedVariant:e.selectedVariant,quantity:e.quantity,price:"reseller"===(null==h?void 0:h.role)?e.resellerPrice:e.retailPrice,total:("reseller"===(null==h?void 0:h.role)?e.resellerPrice:e.retailPrice)*e.quantity})),shippingInfo:e.shippingInfo,paymentMethod:e.paymentMethod,status:"pending",totalAmount:E(),shippingCost:15e3,finalTotal:E()+15e3,notes:e.notes}),l.forEach(e=>{x(e.id,e.quantity)}),c([]),localStorage.removeItem("azzahra_cart"),console.log("Cart cleared after order completion"),t},E=()=>l.reduce((e,t)=>e+("reseller"===(null==h?void 0:h.role)?t.resellerPrice:t.retailPrice)*t.quantity,0),C=()=>{t("cart")},A=()=>{t("checkout")},P=()=>{t("flash-sale")},D=()=>{t("ongkir-test")},R=()=>{t("admin-products")},O=()=>{t("admin-orders")},L=()=>{t("admin-reports")},M=()=>{t("admin-users")};return je.jsx(Ee,{children:je.jsxs("div",{className:"min-h-screen bg-gray-50",children:[(()=>{if(r)return je.jsx(pg,{onSuccess:w,onClose:()=>i(!1)});switch(e){case"home":return je.jsx(rg,{user:h,cartItems:l,products:p,loading:g,onProductClick:v,onLoginRequired:b,onCartClick:C,onAddToCart:_,onNavigateToFlashSale:P,onNavigateToOngkirTest:D});case"flash-sale":return je.jsx(fg,{user:h,cartItems:l,products:p,loading:g,onProductClick:v,onLoginRequired:b,onCartClick:C,onAddToCart:_});case"orders":return je.jsx(xg,{user:h});case"account":return console.log("App: Rendering AccountPage with user:",h),je.jsx(yg,{user:h,onLogout:N,onNavigateToAdminProducts:R,onNavigateToAdminOrders:O,onNavigateToAdminReports:L,onNavigateToAdminUsers:M});case"admin-products":return console.log("App: Rendering AdminProductsPage with user:",h),je.jsx(jg,{onBack:()=>t("account"),user:h});case"admin-orders":return console.log("App: Rendering AdminOrdersPage with user:",h),je.jsx(_g,{onBack:()=>t("account"),user:h});case"admin-reports":return console.log("App: Rendering AdminReportsPage with user:",h),je.jsx(kg,{onBack:()=>t("account"),user:h});case"admin-users":return console.log("App: Rendering AdminUsersPage with user:",h),je.jsx(Sg,{onBack:()=>t("account"),user:h});case"ongkir-test":return je.jsx(Eg,{onBack:()=>t("home")});case"product-detail":return je.jsx(ig,{product:s,user:h,onBack:()=>t("home"),onLoginRequired:b,onAddToCart:j,onBuyNow:k,onNavigateToCart:()=>t("cart")});case"cart":return je.jsx(ag,{cartItems:l,user:h,updateQuantity:S,removeFromCart:T,getTotalPrice:E,onBack:()=>t("home"),onCheckout:A});case"checkout":return je.jsx(hg,{cartItems:l,user:h,getTotalPrice:E,clearCart:I,onBack:()=>t("cart")});default:return je.jsx(rg,{user:h,cartItems:l,products:p,loading:g,onProductClick:v,onLoginRequired:b,onCartClick:C,onAddToCart:_,onNavigateToFlashSale:P})}})(),!r&&!e.startsWith("admin-")&&je.jsx(Tg,{currentPage:e,onPageChange:t}),r&&je.jsx(pg,{onSuccess:w,onClose:()=>i(!1),onShowRegister:()=>{i(!1),o(!0)}}),a&&je.jsx(gg,{onSuccess:e=>{o(!1),console.log("âœ… Firebase user registered:",e.name,e.role)},onClose:()=>o(!1)})]})})}function Ag(){return je.jsx(Te,{children:je.jsx(Cg,{})})}Ne(document.getElementById("root")).render(je.jsx(f.StrictMode,{children:je.jsx(Ag,{})}))}},function(){return je||(0,Ne[n(Ne)[0]])((je={exports:{}}).exports,je),je.exports});export default _e();
