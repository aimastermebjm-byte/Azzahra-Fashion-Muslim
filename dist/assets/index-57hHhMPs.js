var t=Object.defineProperty,s=Object.defineProperties,r=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertyNames,n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=(e,s,r)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[s]=r,c=(e,t)=>{for(var s in t||(t={}))i.call(t,s)&&l(e,s,t[s]);if(n)for(var s of n(t))o.call(t,s)&&l(e,s,t[s]);return e},d=(e,t)=>s(e,r(t)),u=(e,t,s)=>new Promise((r,a)=>{var n=e=>{try{o(s.next(e))}catch(t){a(t)}},i=e=>{try{o(s.throw(e))}catch(t){a(t)}},o=e=>e.done?r(e.value):Promise.resolve(e.value).then(n,i);o((s=s.apply(e,t)).next())});import{r as h,a as m,R as p,g,c as f}from"./vendor-DBR9_dkd.js";import{S as x,a as b,C as y,M as v,T as j,b as w,c as N,U as k,d as S,F as _,A as P,e as E,f as C,H as T,g as O,P as A,h as I,i as R,j as D,k as $,l as U,m as L,n as z,o as B,p as F,q as M,r as q,s as K,L as J,E as W,t as H,X as G,u as V,Z as Y,v as X,w as Z,x as Q,y as ee,z as te,B as se,D as re,G as ae,I as ne,J as ie,K as oe,N as le,O as ce,R as de,Q as ue,V as he,W as me,Y as pe,_ as ge,$ as fe,a0 as xe}from"./ui-bHJVFZ8B.js";var be,ye,ve=(be={"assets/index-57hHhMPs.js"(t){!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var s={exports:{}},r={},a=h,n=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,be=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ye={key:!0,ref:!0,__self:!0,__source:!0};function ve(e,t,s){var r,a={},i=null,l=null;for(r in void 0!==s&&(i=""+s),void 0!==t.key&&(i=""+t.key),void 0!==t.ref&&(l=t.ref),t)o.call(t,r)&&!ye.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===a[r]&&(a[r]=t[r]);return{$$typeof:n,type:e,key:i,ref:l,props:a,_owner:be.current}}r.Fragment=i,r.jsx=ve,r.jsxs=ve,s.exports=r;var je,we,Ne=s.exports,ke=m;je=ke.createRoot,ke.hydrateRoot;class Se{static initializeApp(){console.log("🚀 Initializing Azzahra Fashion Muslim App..."),localStorage.getItem(this.KEYS.PRODUCTS)||this.initializeProducts(),localStorage.getItem(this.KEYS.USERS)||this.initializeUsers(),localStorage.getItem(this.KEYS.ORDERS)||this.initializeOrders(),localStorage.getItem(this.KEYS.CART)||localStorage.setItem(this.KEYS.CART,JSON.stringify([])),console.log("✅ App initialized successfully!")}static initializeProducts(){const e=[{id:"1",name:"Hijab Segi Empat Premium",description:"Hijab segi empat berbahan premium dengan kualitas terbaik. Nyaman dipakai sehari-hari.",category:"hijab",images:["https://images.pexels.com/photos/3184291/pexels-photo-3184291.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["Regular"],colors:["Navy","Maroon","Black","Cream","Pink","Mint","Gray"]},retailPrice:85e3,resellerPrice:7e4,costPrice:55e3,stock:50,status:"ready",salesCount:15,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"2",name:"Gamis Syari Elegant",description:"Gamis syari dengan desain elegant dan bahan adem. Cocok untuk acara formal maupun casual.",category:"gamis",images:["https://images.pexels.com/photos/3184338/pexels-photo-3184338.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["S","M","L","XL","XXL"],colors:["Black","Navy","Maroon","Army","Dusty"]},retailPrice:285e3,resellerPrice:25e4,costPrice:2e5,stock:25,status:"ready",salesCount:8,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"3",name:"Khimar Instant Modern",description:"Khimar instant dengan pad antem dan material berkualitas. Praktis dan syari.",category:"khimar",images:["https://images.pexels.com/photos/3184461/pexels-photo-3184461.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["Regular","Jumbo"],colors:["Black","White","Cream","Silver","Pink"]},retailPrice:95e3,resellerPrice:8e4,costPrice:65e3,stock:40,status:"ready",salesCount:12,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"4",name:"Tunik Kasual Modern",description:"Tunik dengan desain modern yang cocok untuk OOTD harian. Nyaman dan stylish.",category:"tunik",images:["https://images.pexels.com/photos/3184315/pexels-photo-3184315.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["S","M","L","XL"],colors:["Blue","Pink","White","Black","Mustard"]},retailPrice:165e3,resellerPrice:14e4,costPrice:11e4,stock:30,status:"ready",salesCount:6,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"5",name:"Setelan Celana Kulot",description:"Setelan atasan dengan celana kulot yang nyaman. Modern dan syari.",category:"setelan",images:["https://images.pexels.com/photos/3184339/pexels-photo-3184339.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["S","M","L","XL"],colors:["Army","Navy","Maroon","Gray","Beige"]},retailPrice:225e3,resellerPrice:19e4,costPrice:15e4,stock:20,status:"ready",salesCount:4,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"6",name:"Rok Plisket Premium",description:"Rok plisket dengan bahan premium yang jatuh dan nyaman. Elegan dan modis.",category:"rok",images:["https://images.pexels.com/photos/3184340/pexels-photo-3184340.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["S","M","L","XL"],colors:["Black","Navy","Maroon","Gray","Cream"]},retailPrice:145e3,resellerPrice:12e4,costPrice:95e3,stock:35,status:"ready",salesCount:9,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"7",name:"Blouse Kekinian",description:"Blouse dengan desain kekinian yang nyaman dipakai sehari-hari.",category:"atasan",images:["https://images.pexels.com/photos/3184359/pexels-photo-3184359.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["S","M","L","XL"],colors:["Pink","Blue","White","Yellow","Green"]},retailPrice:125e3,resellerPrice:105e3,costPrice:85e3,stock:28,status:"ready",salesCount:7,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"8",name:"Abaya Simple Elegant",description:"Abaya dengan desain simple namun elegant. Cocok untuk acara formal.",category:"abaya",images:["https://images.pexels.com/photos/3184365/pexels-photo-3184365.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["S","M","L","XL"],colors:["Black","Navy","Gray","Maroon"]},retailPrice:325e3,resellerPrice:28e4,costPrice:22e4,stock:15,status:"ready",salesCount:3,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0}];this.saveData(this.KEYS.PRODUCTS,e),console.log("📦 Products initialized:",e.length)}static initializeUsers(){const e=[{id:"1",name:"Customer",email:"customer@azzahra.com",phone:"08123456789",role:"customer",createdAt:new Date},{id:"2",name:"Admin",email:"admin@azzahra.com",phone:"08123456780",role:"admin",createdAt:new Date},{id:"3",name:"Owner",email:"owner@azzahra.com",phone:"08123456781",role:"owner",createdAt:new Date}];this.saveData(this.KEYS.USERS,e),console.log("👥 Users initialized:",e.length)}static initializeOrders(){this.saveData(this.KEYS.ORDERS,[]),console.log("📋 Orders initialized: 0")}static saveData(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(s){console.error(`❌ Error saving data to ${e}:`,s)}}static loadData(e){try{const t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(t){return console.error(`❌ Error loading data from ${e}:`,t),null}}static getProducts(){return(this.loadData(this.KEYS.PRODUCTS)||[]).map(e=>d(c({},e),{createdAt:new Date(e.createdAt)}))}static saveProducts(e){this.saveData(this.KEYS.PRODUCTS,e)}static getFeaturedProducts(){try{const e=this.getProducts().filter(e=>!0===e.isFeatured).sort((e,t)=>(e.featuredOrder||0)-(t.featuredOrder||0));return console.log(`🌟 AppStorage: Found ${e.length} featured products`),e.forEach((e,t)=>{console.log(`  ${t+1}. ${e.name} (Order: ${e.featuredOrder})`)}),e}catch(e){return console.error("🚨 AppStorage: Error getting featured products:",e),[]}}static reorderFeatured(e,t){const s=this.getProducts(),r=s.filter(e=>e.isFeatured).sort((e,t)=>(e.featuredOrder||0)-(t.featuredOrder||0)),a=r.findIndex(t=>t.id===e);if(-1===a)return s;const n="up"===t?a-1:a+1;if(n<0||n>=r.length)return s;const[i]=r.splice(a,1);r.splice(n,0,i);const o=s.map(e=>{const t=r.findIndex(t=>t.id===e.id);return-1!==t?d(c({},e),{featuredOrder:t+1}):e});return this.saveProducts(o),o}static toggleFeatured(e){const t=this.getProducts(),s=t.find(t=>t.id===e);if(!s)return t;let r;if(s.isFeatured)r=t.map(t=>t.id===e?d(c({},t),{isFeatured:!1,featuredOrder:0}):t.isFeatured&&t.featuredOrder>s.featuredOrder?d(c({},t),{featuredOrder:t.featuredOrder-1}):t);else{const s=t.filter(e=>e.isFeatured);if(s.length>=4)return alert("Maksimal 4 produk unggulan!"),t;r=t.map(t=>t.id===e?d(c({},t),{isFeatured:!0,featuredOrder:s.length+1}):t)}return this.saveProducts(r),"undefined"!=typeof window&&window.dispatchEvent(new CustomEvent("featuredProductsUpdated",{detail:{action:s.isFeatured?"removed":"added",productId:e,featuredProducts:r.filter(e=>e.isFeatured)}})),r}static validateAndSyncFeaturedProducts(){try{const e=this.getProducts(),t=e.filter(e=>e.isFeatured).sort((e,t)=>(e.featuredOrder||0)-(t.featuredOrder||0)),s=e.map(e=>{const s=t.findIndex(t=>t.id===e.id);return-1!==s?d(c({},e),{featuredOrder:s+1}):e});return JSON.stringify(e)!==JSON.stringify(s)&&(this.saveProducts(s),console.log("🔧 AppStorage: Fixed featured products order consistency")),s}catch(e){return console.error("🚨 AppStorage: Error validating featured products:",e),this.getProducts()}}static refreshFeaturedProductsCache(){this.getFeaturedProducts(),"undefined"!=typeof window&&window.dispatchEvent(new CustomEvent("featuredProductsRefreshed",{detail:{timestamp:(new Date).toISOString()}}))}static getOrders(){return(this.loadData(this.KEYS.ORDERS)||[]).map(e=>d(c({},e),{createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}))}static saveOrder(e){const t=this.getOrders();t.push(e),this.saveData(this.KEYS.ORDERS,t),console.log("💾 Order saved:",e.id)}static updateOrderStatus(e,t){const s=this.getOrders().map(s=>s.id===e?d(c({},s),{status:t,updatedAt:new Date}):s);this.saveData(this.KEYS.ORDERS,s),console.log("📋 Order status updated:",e,"→",t)}static getUsers(){return(this.loadData(this.KEYS.USERS)||[]).map(e=>d(c({},e),{createdAt:new Date(e.createdAt)}))}static saveUser(e){const t=this.getUsers(),s=t.findIndex(t=>t.id===e.id);s>=0?t[s]=e:t.push(e),this.saveData(this.KEYS.USERS,t)}static getCart(){return this.loadData(this.KEYS.CART)||[]}static saveCart(e){this.saveData(this.KEYS.CART,e)}static exportAllData(){const e={products:this.getProducts(),orders:this.getOrders(),users:this.getUsers(),cart:this.getCart(),exportedAt:(new Date).toISOString()};return JSON.stringify(e,null,2)}static importAllData(e){try{const t=JSON.parse(e);return t.products&&this.saveData(this.KEYS.PRODUCTS,t.products),t.orders&&this.saveData(this.KEYS.ORDERS,t.orders),t.users&&this.saveData(this.KEYS.USERS,t.users),t.cart&&this.saveData(this.KEYS.CART,t.cart),console.log("📥 Data imported successfully"),!0}catch(t){return console.error("❌ Error importing data:",t),!1}}static clearAllData(){Object.values(this.KEYS).forEach(e=>{localStorage.removeItem(e)}),console.log("🗑️ All data cleared"),this.initializeApp()}static getStorageInfo(){const e={};return Object.entries(this.KEYS).forEach(([t,s])=>{const r=localStorage.getItem(s);e[t]={size:r?r.length:0,items:r?JSON.parse(r).length:0}}),e}}l(Se,"symbol"!=typeof(we="KEYS")?we+"":we,{PRODUCTS:"azzahra_products",ORDERS:"azzahra_orders",USERS:"azzahra_users",CART:"azzahra_cart",FLASH_SALES:"azzahra_flash_sales",APP_STATE:"azzahra_app_state"}),"undefined"!=typeof window&&(window.AppStorage=Se);const _e=h.createContext(void 0),Pe=({children:e})=>{const[t,s]=h.useState([]),[r,a]=h.useState([]);return h.useEffect(()=>{const e=Se.getOrders();s(e),console.log("📋 Orders loaded from AppStorage:",e.length)},[]),h.useEffect(()=>{const e=()=>{const e=Se.getOrders();s(e),console.log("📋 Orders updated:",e.length)};return window.addEventListener("orderUpdated",e),()=>window.removeEventListener("orderUpdated",e)},[]),Ne.jsx(_e.Provider,{value:{orders:t,flashSales:r,addOrder:e=>{const t=d(c({},e),{createdAt:new Date,updatedAt:new Date});Se.saveOrder(t),s(e=>[t,...e]),console.log("💾 Order saved permanently:",t.id),window.dispatchEvent(new CustomEvent("orderUpdated",{detail:t}))},updateOrderStatus:(e,t)=>{Se.updateOrderStatus(e,t),s(s=>s.map(s=>s.id===e?d(c({},s),{status:t,updatedAt:new Date}):s)),console.log("📋 Order status updated:",e,"→",t),window.dispatchEvent(new CustomEvent("orderUpdated",{detail:{orderId:e,status:t}}))},updateOrderPayment:(e,r,a="pending")=>{const n=t.map(t=>t.id===e?d(c({},t),{paymentProof:r,paymentProofUrl:"https://images.pexels.com/photos/4386321/pexels-photo-4386321.jpeg?auto=compress&cs=tinysrgb&w=400",status:a,updatedAt:new Date}):t);localStorage.setItem("azzahra_orders",JSON.stringify(n)),s(n),console.log("💳 Order payment updated:",e),window.dispatchEvent(new CustomEvent("orderUpdated",{detail:{orderId:e,paymentProof:r,status:a}}))},deleteOrder:e=>{const r=t.filter(t=>t.id!==e);localStorage.setItem("azzahra_orders",JSON.stringify(r)),s(r),console.log("🗑️ Order deleted permanently:",e),window.dispatchEvent(new CustomEvent("orderUpdated",{detail:{orderId:e,deleted:!0}}))},getOrdersByStatus:e=>t.filter(t=>t.status===e),getTotalRevenue:()=>t.filter(e=>"delivered"===e.status).reduce((e,t)=>e+t.finalTotal,0),getTodayOrders:()=>{const e=new Date;return e.setHours(0,0,0,0),t.filter(t=>t.createdAt>=e)},createFlashSale:e=>{const t=d(c({},e),{id:"FS"+Date.now().toString(),createdAt:new Date});console.log("Creating flash sale:",t),console.log("Flash sale products:",e.productIds),console.log("Discount:",e.discountType,e.discountValue),a(e=>{const s=[t,...e];return console.log("Updated flash sales:",s),s}),setTimeout(()=>{console.log("Dispatching flashSaleCreated event");const e=new CustomEvent("flashSaleCreated",{detail:t,bubbles:!0});window.dispatchEvent(e),console.log("Event dispatched")},100)},updateFlashSale:(e,t)=>{a(s=>s.map(s=>s.id===e?c(c({},s),t):s)),console.log("Updating flash sale:",e,t);const s=r.find(t=>t.id===e);s&&window.dispatchEvent(new CustomEvent("flashSaleUpdated",{detail:c(c({},s),t)}))},deleteFlashSale:e=>{const t=r.find(t=>t.id===e);t&&(console.log("Deleting flash sale:",t),window.dispatchEvent(new CustomEvent("flashSaleDeleted",{detail:t}))),a(t=>t.filter(t=>t.id!==e))},getActiveFlashSales:()=>{const e=new Date;return r.filter(t=>t.isActive&&t.startDate<=e&&t.endDate>=e)}},children:e})},Ee=()=>{const e=h.useContext(_e);if(void 0===e)throw new Error("useAdmin must be used within an AdminProvider");return e};class Ce extends p.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e,t)}render(){return this.state.hasError?this.props.fallback||Ne.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:Ne.jsxs("div",{className:"text-center",children:[Ne.jsx("div",{className:"text-red-500 mb-4",children:Ne.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:Ne.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),Ne.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Terjadi Kesalahan"}),Ne.jsx("p",{className:"text-gray-600 mb-4",children:"Mohon muat ulang halaman atau coba lagi nanti."}),Ne.jsx("button",{onClick:()=>window.location.reload(),className:"bg-pink-500 text-white px-6 py-2 rounded-lg hover:bg-pink-600 transition-colors",children:"Muat Ulang"})]})}):this.props.children}}const Te=({product:e,onProductClick:t,onAddToCart:s,isFlashSale:r=!1,isFeatured:a=!1,user:n})=>{const[i,o]=h.useState(!1),[l,c]=h.useState(e.isFlashSale);h.useEffect(()=>{const t=()=>{const t=localStorage.getItem("azzahra-flashsale");if(t)try{const s=JSON.parse(t),r=(new Date).getTime(),a=new Date(s.endTime).getTime(),n=e.isFlashSale&&s.isActive&&r<a;c(n)}catch(s){console.error("Error checking flash sale status:",s),c(!1)}else c(!1)};t();const s=setInterval(t,2e3),r=()=>{console.log("🔥 ProductCard received flash sale ended event"),c(!1)};return window.addEventListener("flashSaleEnded",r),()=>{clearInterval(s),window.removeEventListener("flashSaleEnded",r)}},[e.isFlashSale]);const d=e=>{e.stopPropagation(),"reseller"!==(null==n?void 0:n.role)&&o(!i)},u=t=>{t.stopPropagation();const s=encodeURIComponent(`Halo Admin, saya tertarik dengan produk ${e.name} dan ingin menanyakan tentang harga reseller. Mohon info lebih lanjut. Terima kasih.`);window.open(`https://wa.me/6287815990944?text=${s}`,"_blank"),o(!1)};return Ne.jsxs("div",{onClick:()=>t(e),className:"bg-white rounded-lg shadow-md hover:shadow-lg transition-all duration-300 cursor-pointer group overflow-hidden "+(a?"ring-2 ring-yellow-400 shadow-lg":""),children:[Ne.jsxs("div",{className:"relative",children:[Ne.jsx("img",{src:e.images[0],alt:e.name,className:"w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300"}),(()=>{const t="ready"===e.status?`Ready (${e.stock})`:`PO (${e.stock})`;return Ne.jsx("div",{className:"absolute top-2 left-2 text-xs px-2 py-1 rounded font-medium "+("ready"===e.status?"bg-green-500 text-white":"bg-orange-500 text-white"),children:t})})(),a&&Ne.jsx("div",{className:"absolute top-2 right-2 bg-yellow-400 text-white p-1.5 rounded-full shadow-lg",children:Ne.jsx(x,{className:"w-4 h-4 fill-current"})}),Ne.jsx("div",{className:"absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:Ne.jsx("button",{onClick:t=>{t.stopPropagation(),s(e)},className:"bg-pink-500 text-white p-2 rounded-full hover:bg-pink-600 transition-colors shadow-lg",children:Ne.jsx(b,{className:"w-4 h-4"})})})]}),Ne.jsxs("div",{className:"p-4",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800 mb-2 line-clamp-2 group-hover:text-pink-600 transition-colors",children:e.name}),Ne.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:e.description}),l&&e.flashSalePrice>0?Ne.jsxs("div",{className:"space-y-1",children:[Ne.jsxs("div",{className:"flex items-center space-x-2",children:[Ne.jsxs("span",{className:"text-lg font-bold text-red-600",children:["Rp ",e.flashSalePrice.toLocaleString("id-ID")]}),Ne.jsxs("span",{className:"bg-red-100 text-red-600 text-xs px-2 py-1 rounded",children:["-",Math.round(100*(1-e.flashSalePrice/(e.originalRetailPrice||e.retailPrice))),"%"]})]}),Ne.jsxs("div",{className:"text-sm text-gray-500 line-through",children:["Rp ",(e.originalRetailPrice||e.retailPrice).toLocaleString("id-ID")]})]}):Ne.jsxs("div",{className:"space-y-1 relative",children:[Ne.jsxs("div",{className:"text-lg font-bold text-pink-600",children:["Rp ",e.retailPrice.toLocaleString("id-ID")]}),Ne.jsxs("div",{className:"relative",children:["reseller"===(null==n?void 0:n.role)?Ne.jsxs("div",{className:"text-sm text-pink-600",children:["Reseller: Rp ",e.resellerPrice.toLocaleString("id-ID")]}):Ne.jsxs("button",{onClick:d,className:"text-sm text-pink-600 hover:text-pink-700 font-medium transition-colors flex items-center space-x-1",children:[Ne.jsxs("span",{children:["Reseller: Rp ",e.resellerPrice.toLocaleString("id-ID")]}),Ne.jsx(y,{className:"w-3 h-3 transition-transform "+(i?"rotate-180":"")})]}),i&&"reseller"!==(null==n?void 0:n.role)&&Ne.jsxs("div",{className:"absolute bottom-full left-0 right-0 mb-2 bg-white rounded-lg shadow-lg border border-gray-200 z-10",children:[Ne.jsxs("button",{onClick:u,className:"w-full px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors flex items-center space-x-2 rounded-t-lg",children:[Ne.jsx(v,{className:"w-4 h-4 text-green-600"}),Ne.jsx("span",{children:"Info Reseller via WhatsApp"})]}),Ne.jsx("div",{className:"text-xs text-gray-500 px-3 pb-2 text-center",children:"Hubungi admin untuk harga reseller"})]})]})]})]})]})},Oe=({onBannerClick:e})=>{const[t,s]=h.useState(0),[r,a]=h.useState([]),n=[{id:"flashsale-default",title:"Flash Sale ⚡",image:"/api/placeholder/400/200",link:"/flash-sale",type:"flashsale"}];return h.useEffect(()=>{const e=localStorage.getItem("azzahra-banners");if(e)try{const t=JSON.parse(e);a([...n,...t])}catch(t){a(n)}else a(n)},[]),h.useEffect(()=>{if(r.length<=1)return;const e=setInterval(()=>{s(e=>(e+1)%r.length)},3e3);return()=>clearInterval(e)},[r.length]),0===r.length?null:Ne.jsxs("div",{className:"relative w-full h-48 md:h-56 lg:h-64 overflow-hidden rounded-lg",children:[Ne.jsx("div",{className:"relative h-full",children:r.map((s,r)=>Ne.jsx("div",{className:"absolute inset-0 transition-opacity duration-500 "+(r===t?"opacity-100":"opacity-0"),children:Ne.jsx("div",{className:"w-full h-full cursor-pointer "+("flashsale"===s.type?"bg-gradient-to-r from-red-500 to-pink-500":"bg-gradient-to-r from-purple-500 to-pink-500"),onClick:()=>(t=>{e&&e(t)})(s),children:Ne.jsx("div",{className:"flex items-center justify-center h-full p-8 text-white",children:Ne.jsxs("div",{className:"text-center",children:["flashsale"===s.type&&Ne.jsx(j,{className:"w-8 h-8 mx-auto mb-2"}),Ne.jsx("h2",{className:"text-2xl md:text-3xl font-bold mb-2",children:s.title}),"flashsale"===s.type&&Ne.jsx("p",{className:"text-red-100",children:"Diskon terbatas! Buruan sebelum kehabisan!"}),"promo"===s.type&&Ne.jsx("p",{className:"text-purple-100",children:"Promo spesial untuk Anda!"})]})})})},s.id))}),r.length>1&&Ne.jsxs(Ne.Fragment,{children:[Ne.jsx("button",{onClick:()=>{s(e=>(e-1+r.length)%r.length)},className:"absolute left-4 top-1/2 transform -translate-y-1/2 bg-white/20 hover:bg-white/30 rounded-full p-2 transition-colors",children:Ne.jsx(w,{className:"w-5 h-5 text-white"})}),Ne.jsx("button",{onClick:()=>{s(e=>(e+1)%r.length)},className:"absolute right-4 top-1/2 transform -translate-y-1/2 bg-white/20 hover:bg-white/30 rounded-full p-2 transition-colors",children:Ne.jsx(N,{className:"w-5 h-5 text-white"})})]}),r.length>1&&Ne.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2",children:r.map((e,r)=>Ne.jsx("button",{onClick:()=>s(r),className:"w-2 h-2 rounded-full transition-colors "+(r===t?"bg-white":"bg-white/50")},r))})]})};function Ae(e){return e&&"object"==typeof e&&e.id&&e.name?c({id:String(e.id),name:String(e.name),description:e.description?String(e.description):"",category:e.category?String(e.category):"other",images:Array.isArray(e.images)?e.images:[],variants:e.variants&&"object"==typeof e.variants?{sizes:Array.isArray(e.variants.sizes)?e.variants.sizes:[],colors:Array.isArray(e.variants.colors)?e.variants.colors:[]}:{sizes:[],colors:[]},retailPrice:"number"==typeof e.retailPrice?e.retailPrice:0,resellerPrice:"number"==typeof e.resellerPrice?e.resellerPrice:0,costPrice:"number"==typeof e.costPrice?e.costPrice:0,stock:"number"==typeof e.stock?e.stock:0,status:"ready"===e.status||"po"===e.status?e.status:"ready",isFlashSale:Boolean(e.isFlashSale),flashSalePrice:"number"==typeof e.flashSalePrice?e.flashSalePrice:0,createdAt:e.createdAt?e.createdAt instanceof Date?e.createdAt:new Date(e.createdAt):new Date,salesCount:"number"==typeof e.salesCount?e.salesCount:0,isFeatured:Boolean(e.isFeatured),featuredOrder:"number"==typeof e.featuredOrder?e.featuredOrder:void 0},Object.keys(e).reduce((t,s)=>(["id","name","description","category","images","variants","retailPrice","resellerPrice","costPrice","stock","status","isFlashSale","flashSalePrice","createdAt","salesCount","isFeatured","featuredOrder"].includes(s)||(t[s]=e[s]),t),{})):null}const Ie=({user:e,cartItems:t,products:s,loading:r,onProductClick:a,onLoginRequired:n,onCartClick:i,onAddToCart:o,onNavigateToFlashSale:l})=>{var u;const[m,g]=h.useState(""),[f,y]=h.useState("all"),[v,j]=h.useState("all"),[E,C]=h.useState("terbaru"),[T,O]=h.useState(1),[A,I]=h.useState(0),R=[{id:"all",name:"Semua",icon:"🛍️"},{id:"hijab",name:"Hijab",icon:"🧕"},{id:"gamis",name:"Gamis",icon:"👗"},{id:"khimar",name:"Khimar",icon:"🧕"},{id:"tunik",name:"Tunik",icon:"👚"},{id:"abaya",name:"Abaya",icon:"🥻"}],D=e=>{o(e)},$=p.useMemo(()=>{const e=function(e){if(!Array.isArray(e))return console.warn("⚠️ validateProducts: Input is not an array"),[];const t=e.map(Ae).filter(e=>null!==e);return console.log(`✅ validateProducts: ${t.length}/${e.length} products are valid`),t}(s);return e.map(e=>d(c({},e),{description:e.description||"",category:e.category||"other",images:e.images||[],variants:e.variants||{sizes:[],colors:[]},retailPrice:e.retailPrice||0,resellerPrice:e.resellerPrice||0,costPrice:e.costPrice||0,stock:e.stock||0,status:e.status||"ready",isFlashSale:e.isFlashSale||!1,flashSalePrice:e.flashSalePrice||0,createdAt:e.createdAt||new Date,salesCount:e.salesCount||0,isFeatured:e.isFeatured||!1}))},[s]),U=$.filter(e=>{const t=e.name.toLowerCase().includes(m.toLowerCase())||e.description.toLowerCase().includes(m.toLowerCase()),s="all"===f||e.category===f,r="all"===v||e.status===v;return t&&s&&r}),L=[...U].sort((t,s)=>{switch(E){case"terbaru":return new Date(s.createdAt).getTime()-new Date(t.createdAt).getTime();case"terlama":return new Date(t.createdAt).getTime()-new Date(s.createdAt).getTime();case"terlaris":return(s.salesCount||0)-(t.salesCount||0);case"termurah":return("reseller"===(null==e?void 0:e.role)?t.resellerPrice:t.retailPrice)-("reseller"===(null==e?void 0:e.role)?s.resellerPrice:s.retailPrice);case"termahal":const r="reseller"===(null==e?void 0:e.role)?t.resellerPrice:t.retailPrice;return("reseller"===(null==e?void 0:e.role)?s.resellerPrice:s.retailPrice)-r;default:return 0}}),z=p.useMemo(()=>(Se.validateAndSyncFeaturedProducts(),Se.getFeaturedProducts()),[s,A]),B=p.useMemo(()=>{try{if(!Array.isArray(L)||!Array.isArray(z))return console.warn("⚠️ Invalid product arrays for regular products calculation"),L||[];const e=new Set(z.map(e=>e.id).filter(Boolean));return L.filter(t=>t&&t.id&&!e.has(t.id))}catch(e){return console.error("🚨 Error in regularProducts calculation:",e),L||[]}},[L,z]),F=8*T,M=F-8,q=B.slice(M,F),K=Math.ceil(B.length/8);return h.useEffect(()=>{O(1)},[m,f,v,E]),h.useEffect(()=>{const e=e=>{console.log("Featured products updated in HomePage:",e.detail),I(e=>e+1)};return window.addEventListener("featuredProductsUpdated",e),()=>{window.removeEventListener("featuredProductsUpdated",e)}},[]),h.useEffect(()=>{const e=e=>{console.log("Products updated in HomePage:",e.detail),I(e=>e+1)};return window.addEventListener("productsUpdated",e),()=>{window.removeEventListener("productsUpdated",e)}},[]),h.useEffect(()=>{const e=e=>{var t;console.log("🔥 Flash sale ended detected in HomePage:",e.detail),I(e=>e+1),Se.refreshFeaturedProductsCache(),"time_expired"===(null==(t=e.detail)?void 0:t.reason)&&(window.flashSaleRefreshTimer&&clearTimeout(window.flashSaleRefreshTimer),window.flashSaleRefreshTimer=setTimeout(()=>{console.log("🔄 Auto-refreshing HomePage after flash sale time expired"),window.location.reload()},4e3))};return window.addEventListener("flashSaleEnded",e),()=>{window.removeEventListener("flashSaleEnded",e)}},[]),r?Ne.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:Ne.jsxs("div",{className:"text-center",children:[Ne.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500 mx-auto mb-4"}),Ne.jsx("p",{className:"text-gray-600",children:"Loading products..."})]})}):Ne.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[Ne.jsxs("div",{className:"bg-gradient-to-r from-pink-500 to-purple-600 text-white p-4",children:[Ne.jsxs("div",{className:"flex items-center justify-between mb-4",children:[Ne.jsxs("div",{children:[Ne.jsx("h1",{className:"text-xl font-bold",children:"Azzahra Fashion"}),Ne.jsx("p",{className:"text-pink-100 text-sm",children:"Muslim Fashion Store"})]}),Ne.jsx("div",{className:"flex items-center space-x-3",children:e?Ne.jsxs("div",{className:"flex items-center space-x-2",children:[Ne.jsx(k,{className:"w-5 h-5"}),Ne.jsx("span",{className:"text-sm",children:e.name})]}):Ne.jsx("button",{onClick:n,className:"bg-white/20 px-3 py-1 rounded-full text-sm hover:bg-white/30 transition-colors",children:"Login"})})]}),Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsxs("div",{className:"flex-1 relative",children:[Ne.jsx(S,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),Ne.jsx("input",{type:"text",placeholder:"Cari produk...",value:m,onChange:e=>g(e.target.value),className:"w-full pl-10 pr-4 py-3 rounded-lg text-gray-800 focus:outline-none focus:ring-2 focus:ring-white/50"})]}),Ne.jsxs("button",{onClick:i,className:"relative p-2 bg-white rounded-full shadow-md hover:shadow-lg transition-shadow",children:[Ne.jsx(b,{className:"w-6 h-6 text-gray-600"}),t.length>0&&Ne.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:t.length})]})]})]}),Ne.jsx("div",{className:"p-4",children:Ne.jsx(Oe,{onBannerClick:e=>{console.log("Banner clicked:",e),"flashsale"===e.type&&(console.log("Flash sale banner clicked, navigating..."),l&&l())}})}),Ne.jsxs("div",{className:"px-4 mb-6",children:[Ne.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[Ne.jsx(x,{className:"w-5 h-5 text-yellow-500 fill-current"}),Ne.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"Produk Unggulan"})]}),r?Ne.jsx("div",{className:"grid grid-cols-2 gap-4",children:[...Array(2)].map((e,t)=>Ne.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[Ne.jsx("div",{className:"w-full h-48 bg-gray-200 animate-pulse"}),Ne.jsxs("div",{className:"p-4",children:[Ne.jsx("div",{className:"h-4 bg-gray-200 rounded mb-2 animate-pulse"}),Ne.jsx("div",{className:"h-3 bg-gray-200 rounded mb-3 animate-pulse"}),Ne.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 animate-pulse"})]})]},`skeleton-${t}`))}):z.length>0?Ne.jsx("div",{className:"grid grid-cols-2 gap-4",children:z.map(t=>Ne.jsx(Te,{product:t,onProductClick:a,onAddToCart:D,user:e,isFeatured:!0},`featured-${t.id}`))}):Ne.jsxs("div",{className:"text-center py-8 text-gray-500 bg-white rounded-lg",children:[Ne.jsx(x,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),Ne.jsx("p",{children:"Belum ada produk unggulan"})]})]}),Ne.jsx("div",{className:"px-4",children:Ne.jsxs("div",{className:"flex flex-col space-y-3",children:[Ne.jsx("div",{className:"flex space-x-3 overflow-x-auto pb-2",children:R.map(e=>Ne.jsxs("button",{onClick:()=>y(e.id),className:"flex-shrink-0 flex items-center space-x-2 px-4 py-2 rounded-full transition-colors "+(f===e.id?"bg-pink-500 text-white":"bg-white text-gray-600 hover:bg-gray-100"),children:[Ne.jsx("span",{children:e.icon}),Ne.jsx("span",{className:"text-sm font-medium",children:e.name})]},e.id))}),Ne.jsxs("div",{className:"flex space-x-3 overflow-x-auto pb-2",children:[Ne.jsx("button",{onClick:()=>j("all"),className:"flex-shrink-0 flex items-center space-x-2 px-4 py-2 rounded-full transition-colors "+("all"===v?"bg-gray-700 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:Ne.jsx("span",{className:"text-sm font-medium",children:"Semua Status"})}),Ne.jsxs("button",{onClick:()=>j("ready"),className:"flex-shrink-0 flex items-center space-x-2 px-4 py-2 rounded-full transition-colors "+("ready"===v?"bg-green-500 text-white":"bg-white text-gray-600 hover:bg-gray-100 border border-green-300"),children:[Ne.jsx("span",{className:"w-2 h-2 bg-current rounded-full"}),Ne.jsx("span",{className:"text-sm font-medium",children:"Ready"})]}),Ne.jsxs("button",{onClick:()=>j("po"),className:"flex-shrink-0 flex items-center space-x-2 px-4 py-2 rounded-full transition-colors "+("po"===v?"bg-orange-500 text-white":"bg-white text-gray-600 hover:bg-gray-100 border border-orange-300"),children:[Ne.jsx("span",{className:"w-2 h-2 bg-current rounded-full"}),Ne.jsx("span",{className:"text-sm font-medium",children:"PO"})]})]})]})}),Ne.jsxs("div",{className:"px-4",children:[Ne.jsxs("div",{className:"flex flex-col space-y-3 mb-4",children:[Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"all"===f?"Semua Produk":null==(u=R.find(e=>e.id===f))?void 0:u.name}),Ne.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[Ne.jsx(_,{className:"w-4 h-4 mr-1"}),U.length," produk"]})]}),Ne.jsxs("div",{className:"flex items-center space-x-2 overflow-x-auto pb-2",children:[Ne.jsxs("div",{className:"flex items-center text-sm text-gray-600 mr-2",children:[Ne.jsx(P,{className:"w-4 h-4 mr-1"}),"Urutkan:"]}),Ne.jsx("button",{onClick:()=>C("terbaru"),className:"flex-shrink-0 px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+("terbaru"===E?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"Terbaru"}),Ne.jsx("button",{onClick:()=>C("terlaris"),className:"flex-shrink-0 px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+("terlaris"===E?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"Terlaris"}),Ne.jsx("button",{onClick:()=>C("termurah"),className:"flex-shrink-0 px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+("termurah"===E?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"Termurah"}),Ne.jsx("button",{onClick:()=>C("termahal"),className:"flex-shrink-0 px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+("termahal"===E?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"Termahal"}),Ne.jsx("button",{onClick:()=>C("terlama"),className:"flex-shrink-0 px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+("terlama"===E?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"Terlama"})]})]}),0===U.length?Ne.jsxs("div",{className:"text-center py-12",children:[Ne.jsx("div",{className:"text-gray-400 mb-4",children:Ne.jsx(S,{className:"w-12 h-12 mx-auto"})}),Ne.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"Produk tidak ditemukan"}),Ne.jsx("p",{className:"text-gray-500",children:"Coba kata kunci lain atau pilih kategori berbeda"})]}):Ne.jsxs(Ne.Fragment,{children:[Ne.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:q.map(t=>Ne.jsx(Te,{product:t,onProductClick:a,onAddToCart:D,user:e},t.id))}),K>1&&Ne.jsxs("div",{className:"flex flex-col items-center mt-8 space-y-4",children:[Ne.jsxs("div",{className:"flex items-center space-x-2",children:[Ne.jsxs("button",{onClick:()=>O(e=>Math.max(1,e-1)),disabled:1===T,className:"flex items-center space-x-1 px-3 py-2 rounded-lg transition-colors "+(1===T?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300"),children:[Ne.jsx(w,{className:"w-4 h-4"}),Ne.jsx("span",{children:"Sebelumnya"})]}),Ne.jsx("div",{className:"flex items-center space-x-1",children:[...Array(K)].map((e,t)=>{const s=t+1,r=T===s;return 1===s||s===K||s>=T-1&&s<=T+1?Ne.jsx("button",{onClick:()=>O(s),className:"w-10 h-10 rounded-lg font-medium transition-colors "+(r?"bg-pink-500 text-white":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300"),children:s},s):2===s&&T>3||s===K-1&&T<K-2?Ne.jsx("span",{className:"px-2 text-gray-400",children:"..."},s):null})}),Ne.jsxs("button",{onClick:()=>O(e=>Math.min(K,e+1)),disabled:T===K,className:"flex items-center space-x-1 px-3 py-2 rounded-lg transition-colors "+(T===K?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300"),children:[Ne.jsx("span",{children:"Selanjutnya"}),Ne.jsx(N,{className:"w-4 h-4"})]})]}),Ne.jsxs("div",{className:"text-sm text-gray-600",children:["Menampilkan ",M+1,"-",Math.min(F,B.length)," dari ",B.length," produk"]})]})]})]}),e&&Ne.jsx("div",{className:"fixed bottom-24 right-4 bg-white rounded-lg shadow-lg p-3 border-l-4 border-pink-500",children:Ne.jsx("div",{className:"text-xs text-gray-600",children:"reseller"===e.role?Ne.jsxs("div",{className:"flex items-center space-x-1",children:[Ne.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full"}),Ne.jsx("span",{children:"Harga Reseller Aktif"})]}):Ne.jsxs("div",{className:"flex items-center space-x-1",children:[Ne.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),Ne.jsx("span",{children:"Harga Retail"})]})})})]})},Re=({product:e,user:t,onBack:s,onLoginRequired:r,onAddToCart:a,onBuyNow:n,onNavigateToCart:i})=>{const[o,l]=h.useState(""),[c,d]=h.useState(""),[u,m]=h.useState(1),[p,g]=h.useState(0);return Ne.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[Ne.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:Ne.jsxs("div",{className:"flex items-center justify-between p-4",children:[Ne.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-full",children:Ne.jsx(E,{className:"w-6 h-6 text-gray-600"})}),Ne.jsx("h1",{className:"text-lg font-semibold",children:"Detail Produk"}),Ne.jsxs("div",{className:"flex items-center space-x-2",children:[Ne.jsx("button",{onClick:i||(()=>{}),className:"p-2 rounded-full transition-colors relative "+(t?"bg-pink-500 text-white hover:bg-pink-600":"bg-gray-100 text-gray-400"),children:Ne.jsx(b,{className:"w-5 h-5"})}),Ne.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-full",children:Ne.jsx(C,{className:"w-5 h-5 text-gray-600"})}),Ne.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-full",children:Ne.jsx(T,{className:"w-5 h-5 text-gray-600"})})]})]})}),Ne.jsxs("div",{className:"bg-white",children:[Ne.jsxs("div",{className:"relative",children:[Ne.jsx("img",{src:e.images[p],alt:e.name,className:"w-full h-96 object-cover"}),e.isFlashSale&&Ne.jsx("div",{className:"absolute top-4 left-4 bg-red-500 text-white px-3 py-1 rounded-full text-sm font-semibold",children:"FLASH SALE"}),"po"===e.status&&Ne.jsx("div",{className:"absolute top-4 right-4 bg-orange-500 text-white px-3 py-1 rounded-full text-sm font-semibold",children:"PRE ORDER"})]}),e.images.length>1&&Ne.jsx("div",{className:"flex space-x-2 p-4 overflow-x-auto",children:e.images.map((t,s)=>Ne.jsx("button",{onClick:()=>g(s),className:"flex-shrink-0 w-16 h-16 rounded-lg overflow-hidden border-2 "+(p===s?"border-pink-500":"border-gray-200"),children:Ne.jsx("img",{src:t,alt:`${e.name} ${s+1}`,className:"w-full h-full object-cover"})},s))})]}),Ne.jsxs("div",{className:"bg-white mt-2 p-4",children:[Ne.jsx("div",{className:"flex items-start justify-between mb-3",children:Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("h1",{className:"text-xl font-bold text-gray-800 mb-2",children:e.name}),Ne.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[Ne.jsxs("div",{className:"flex items-center",children:[[...Array(5)].map((e,t)=>Ne.jsx(x,{className:"w-4 h-4 text-yellow-400 fill-current"},t)),Ne.jsx("span",{className:"text-sm text-gray-600 ml-1",children:"(4.8)"})]}),Ne.jsx("span",{className:"text-sm text-gray-500",children:"• Terjual 150+"})]})]})}),Ne.jsx("div",{className:"mb-4",children:e.isFlashSale&&e.flashSalePrice>0?Ne.jsxs("div",{className:"space-y-1",children:[Ne.jsxs("div",{className:"flex items-center space-x-2",children:[Ne.jsxs("span",{className:"text-2xl font-bold text-red-600",children:["Rp ",e.flashSalePrice.toLocaleString("id-ID")]}),Ne.jsxs("span",{className:"bg-red-100 text-red-600 text-xs px-2 py-1 rounded",children:["-",Math.round(100*(1-e.flashSalePrice/(e.originalRetailPrice||e.retailPrice))),"%"]})]}),Ne.jsxs("div",{className:"text-lg text-gray-500 line-through",children:["Rp ",(e.originalRetailPrice||e.retailPrice).toLocaleString("id-ID")]})]}):Ne.jsxs("div",{className:"space-y-1",children:[Ne.jsxs("div",{className:"text-2xl font-bold text-pink-600",children:["Rp ",(e.isFlashSale&&e.flashSalePrice>0?e.flashSalePrice:"reseller"===(null==t?void 0:t.role)?e.resellerPrice:e.retailPrice).toLocaleString("id-ID")]}),"reseller"===(null==t?void 0:t.role)?Ne.jsxs("div",{className:"text-sm text-blue-600 font-medium",children:["Harga Reseller (Retail: Rp ",e.retailPrice.toLocaleString("id-ID"),")"]}):Ne.jsx("button",{onClick:()=>{if("reseller"!==(null==t?void 0:t.role)){const t=encodeURIComponent(`Halo Admin, saya tertarik dengan produk ${e.name} dan ingin menanyakan tentang harga reseller. Mohon info lebih lanjut. Terima kasih.`);window.open(`https://wa.me/6287815990944?text=${t}`,"_blank")}},className:"text-sm text-green-600 font-medium hover:text-green-700 underline transition-colors",children:"💬 Info Harga Reseller?"})]})}),Ne.jsx("div",{className:"flex items-center justify-between mb-4 p-3 bg-gray-50 rounded-lg",children:Ne.jsxs("div",{className:"flex items-center space-x-4",children:[Ne.jsxs("div",{className:"text-sm",children:[Ne.jsx("span",{className:"text-gray-600",children:"Stok: "}),Ne.jsx("span",{className:"font-semibold "+(e.stock>10?"text-green-600":e.stock>0?"text-yellow-600":"text-red-600"),children:e.stock})]}),Ne.jsxs("div",{className:"text-sm",children:[Ne.jsx("span",{className:"text-gray-600",children:"Status: "}),Ne.jsx("span",{className:"font-semibold "+("ready"===e.status?"text-green-600":"text-orange-600"),children:"ready"===e.status?"Ready Stock":"Pre Order"})]})]})}),Ne.jsx("div",{className:"border-t pt-4",children:Ne.jsx("p",{className:"text-gray-600 leading-relaxed",children:e.description})})]}),Ne.jsxs("div",{className:"bg-white mt-2 p-4",children:[Ne.jsxs("div",{className:"mb-6",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Pilih Ukuran"}),Ne.jsx("div",{className:"flex flex-wrap gap-2",children:e.variants.sizes.map(e=>Ne.jsx("button",{onClick:()=>l(e),className:"px-4 py-2 border rounded-lg font-medium transition-colors "+(o===e?"border-pink-500 bg-pink-50 text-pink-600":"border-gray-300 text-gray-600 hover:border-gray-400"),children:e},e))})]}),Ne.jsxs("div",{className:"mb-6",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Pilih Warna"}),Ne.jsx("div",{className:"flex flex-wrap gap-2",children:e.variants.colors.map(e=>Ne.jsx("button",{onClick:()=>d(e),className:"px-4 py-2 border rounded-lg font-medium transition-colors "+(c===e?"border-pink-500 bg-pink-50 text-pink-600":"border-gray-300 text-gray-600 hover:border-gray-400"),children:e},e))})]}),Ne.jsxs("div",{className:"mb-6",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Jumlah"}),Ne.jsxs("div",{className:"flex items-center space-x-4",children:[Ne.jsxs("div",{className:"flex items-center space-x-3 bg-gray-100 rounded-lg p-1",children:[Ne.jsx("button",{onClick:()=>m(Math.max(1,u-1)),className:"w-10 h-10 flex items-center justify-center rounded-md hover:bg-gray-200 transition-colors",children:Ne.jsx(O,{className:"w-4 h-4"})}),Ne.jsx("span",{className:"w-12 text-center font-semibold",children:u}),Ne.jsx("button",{onClick:()=>m(u+1),className:"w-10 h-10 flex items-center justify-center rounded-md hover:bg-gray-200 transition-colors",children:Ne.jsx(A,{className:"w-4 h-4"})})]}),Ne.jsxs("div",{className:"text-sm text-gray-600",children:["Stok tersedia: ",Ne.jsx("span",{className:"font-semibold",children:e.stock})]})]})]})]}),Ne.jsxs("div",{className:"bg-white mt-2 p-4",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Detail Produk"}),Ne.jsxs("div",{className:"space-y-2 text-sm",children:[Ne.jsxs("div",{className:"flex justify-between",children:[Ne.jsx("span",{className:"text-gray-600",children:"Kategori:"}),Ne.jsx("span",{className:"font-medium capitalize",children:e.category})]}),"po"===e.status&&e.estimatedReady&&Ne.jsxs("div",{className:"flex justify-between",children:[Ne.jsx("span",{className:"text-gray-600",children:"Estimasi Ready:"}),Ne.jsx("span",{className:"font-medium",children:e.estimatedReady.toLocaleDateString("id-ID")})]}),Ne.jsxs("div",{className:"flex justify-between",children:[Ne.jsx("span",{className:"text-gray-600",children:"Berat:"}),Ne.jsx("span",{className:"font-medium",children:"500 gram"})]}),Ne.jsxs("div",{className:"flex justify-between",children:[Ne.jsx("span",{className:"text-gray-600",children:"Kondisi:"}),Ne.jsx("span",{className:"font-medium text-green-600",children:"Baru"})]}),Ne.jsxs("div",{className:"flex justify-between",children:[Ne.jsx("span",{className:"text-gray-600",children:"Garansi:"}),Ne.jsx("span",{className:"font-medium",children:"Garansi Toko"})]})]})]}),Ne.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 shadow-lg z-50",children:[Ne.jsxs("div",{className:"flex space-x-3",children:[Ne.jsxs("button",{onClick:()=>{t?o&&c?(a(e,{size:o,color:c},u),l(""),d(""),m(1)):alert("Pilih ukuran dan warna terlebih dahulu"):r()},disabled:!o||!c,className:"flex-1 bg-pink-100 text-pink-600 py-4 rounded-lg font-semibold hover:bg-pink-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:[Ne.jsx(b,{className:"w-5 h-5"}),Ne.jsx("span",{children:"Tambah ke Keranjang"})]}),Ne.jsx("button",{onClick:()=>{t?o&&c?n(e,{size:o,color:c},u):alert("Pilih ukuran dan warna terlebih dahulu"):r()},disabled:!o||!c,className:"flex-1 bg-gradient-to-r from-pink-500 to-purple-600 text-white py-4 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"Beli Sekarang"})]}),(!o||!c)&&Ne.jsx("p",{className:"text-center text-sm text-gray-500 mt-2",children:"Pilih ukuran dan warna terlebih dahulu"})]})]})},De=({cartItems:e,user:t,updateQuantity:s,removeFromCart:r,getTotalPrice:a,onBack:n,onCheckout:i})=>{if(0===e.length)return Ne.jsxs("div",{className:"min-h-screen bg-gray-50",children:[Ne.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:Ne.jsxs("div",{className:"flex items-center p-4",children:[Ne.jsx("button",{onClick:n,className:"mr-4",children:Ne.jsx(E,{className:"w-6 h-6 text-gray-600"})}),Ne.jsx("h1",{className:"text-lg font-semibold",children:"Keranjang Belanja"})]})}),Ne.jsxs("div",{className:"flex flex-col items-center justify-center h-96",children:[Ne.jsx(I,{className:"w-16 h-16 text-gray-300 mb-4"}),Ne.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"Keranjang Kosong"}),Ne.jsxs("p",{className:"text-gray-500 text-center mb-6",children:["Belum ada produk di keranjang Anda.",Ne.jsx("br",{}),"Yuk mulai belanja!"]}),Ne.jsx("button",{onClick:n,className:"bg-gradient-to-r from-pink-500 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition-all",children:"Mulai Belanja"})]})]});const o=a();return Ne.jsxs("div",{className:"min-h-screen bg-gray-50 pb-32",children:[Ne.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:Ne.jsxs("div",{className:"flex items-center p-4",children:[Ne.jsx("button",{onClick:n,className:"mr-4",children:Ne.jsx(E,{className:"w-6 h-6 text-gray-600"})}),Ne.jsx("h1",{className:"text-lg font-semibold",children:"Keranjang Belanja"}),Ne.jsx("span",{className:"ml-2 bg-pink-100 text-pink-600 text-xs px-2 py-1 rounded-full",children:e.length})]})}),Ne.jsx("div",{className:"p-4 space-y-4",children:e.map(e=>{var a,n;const i="reseller"===(null==t?void 0:t.role)?e.resellerPrice:e.retailPrice,o=i*e.quantity;return Ne.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:Ne.jsxs("div",{className:"flex space-x-4",children:[Ne.jsx("img",{src:e.images[0],alt:e.name,className:"w-20 h-20 object-cover rounded-lg"}),Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800 mb-1",children:e.name}),e.selectedVariant&&Ne.jsxs("p",{className:"text-sm text-gray-500 mb-2",children:["Ukuran: ",e.selectedVariant.size," | Warna: ",e.selectedVariant.color]}),Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"flex flex-col",children:[Ne.jsxs("span",{className:"text-lg font-bold text-pink-600",children:["Rp ",i.toLocaleString("id-ID")]}),"reseller"===(null==t?void 0:t.role)&&Ne.jsx("span",{className:"text-xs text-blue-600 font-medium",children:"Harga Reseller"})]}),Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsxs("div",{className:"flex items-center space-x-2 bg-gray-100 rounded-lg p-1",children:[Ne.jsx("button",{onClick:()=>s(e.id,e.selectedVariant,Math.max(1,e.quantity-1)),className:"w-8 h-8 flex items-center justify-center rounded-md hover:bg-gray-200 transition-colors",children:Ne.jsx(O,{className:"w-4 h-4"})}),Ne.jsx("span",{className:"w-8 text-center font-semibold",children:e.quantity}),Ne.jsx("button",{onClick:()=>s(e.id,e.selectedVariant,e.quantity+1),className:"w-8 h-8 flex items-center justify-center rounded-md hover:bg-gray-200 transition-colors",children:Ne.jsx(A,{className:"w-4 h-4"})})]}),Ne.jsx("button",{onClick:()=>r(e.id,e.selectedVariant),className:"w-8 h-8 flex items-center justify-center text-red-500 hover:bg-red-50 rounded-md transition-colors",children:Ne.jsx(R,{className:"w-4 h-4"})})]})]}),Ne.jsxs("div",{className:"mt-2 text-right",children:[Ne.jsx("span",{className:"text-sm text-gray-600",children:"Subtotal: "}),Ne.jsxs("span",{className:"font-semibold text-gray-800",children:["Rp ",o.toLocaleString("id-ID")]})]})]})]})},`${e.id}-${null==(a=e.selectedVariant)?void 0:a.size}-${null==(n=e.selectedVariant)?void 0:n.color}`)})}),Ne.jsxs("div",{className:"fixed bottom-20 left-0 right-0 bg-white border-t border-gray-200 p-4 shadow-lg",children:[Ne.jsxs("div",{className:"flex items-center justify-between mb-3",children:[Ne.jsxs("span",{className:"text-gray-600",children:["Total (",e.length," item)"]}),Ne.jsxs("span",{className:"text-xl font-bold text-pink-600",children:["Rp ",o.toLocaleString("id-ID")]})]}),Ne.jsx("button",{onClick:i,className:"w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-4 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition-all",children:"Checkout Sekarang"})]})]})},$e="azzahra-addresses",Ue=({initialData:e,onSave:t,onCancel:s})=>{const[r,a]=h.useState({name:(null==e?void 0:e.name)||"",phone:(null==e?void 0:e.phone)||"",fullAddress:(null==e?void 0:e.fullAddress)||"",province:(null==e?void 0:e.province)||"",city:(null==e?void 0:e.city)||"",postalCode:(null==e?void 0:e.postalCode)||"",isDefault:(null==e?void 0:e.isDefault)||!1}),[n,i]=h.useState({}),o=e=>{const{name:t,value:s,type:r}=e.target;a(a=>d(c({},a),{[t]:"checkbox"===r?e.target.checked:s})),n[t]&&i(e=>d(c({},e),{[t]:void 0}))};return Ne.jsxs("form",{onSubmit:e=>{e.preventDefault(),(()=>{const e={};return r.name.trim()||(e.name="Nama harus diisi"),r.phone.trim()||(e.phone="Nomor telepon harus diisi"),r.fullAddress.trim()||(e.fullAddress="Alamat harus diisi"),r.province.trim()||(e.province="Provinsi harus diisi"),r.city.trim()||(e.city="Kota harus diisi"),r.postalCode.trim()||(e.postalCode="Kode pos harus diisi"),i(e),0===Object.keys(e).length})()&&t(r)},className:"space-y-4",children:[Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nama Lengkap *"}),Ne.jsx("input",{type:"text",name:"name",value:r.name,onChange:o,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(n.name?"border-red-500":"border-gray-300"),placeholder:"Masukkan nama lengkap"}),n.name&&Ne.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.name})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nomor Telepon *"}),Ne.jsx("input",{type:"tel",name:"phone",value:r.phone,onChange:o,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(n.phone?"border-red-500":"border-gray-300"),placeholder:"Masukkan nomor telepon aktif"}),n.phone&&Ne.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.phone})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Provinsi *"}),Ne.jsxs("select",{name:"province",value:r.province,onChange:o,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(n.province?"border-red-500":"border-gray-300"),children:[Ne.jsx("option",{value:"",children:"Pilih provinsi"}),["Aceh","Sumatera Utara","Sumatera Barat","Sumatera Selatan","Riau","Kepulauan Riau","Jambi","Bengkulu","Lampung","Banten","DKI Jakarta","Jawa Barat","Jawa Tengah","DI Yogyakarta","Jawa Timur","Bali","Nusa Tenggara Barat","Nusa Tenggara Timur","Kalimantan Barat","Kalimantan Tengah","Kalimantan Selatan","Kalimantan Timur","Kalimantan Utara","Sulawesi Utara","Sulawesi Tengah","Sulawesi Selatan","Sulawesi Tenggara","Sulawesi Barat","Gorontalo","Sulawesi Selatan","Maluku","Maluku Utara","Papua","Papua Barat","Papua Selatan","Papua Tengah"].map(e=>Ne.jsx("option",{value:e,children:e},e))]}),n.province&&Ne.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.province})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kota/Kabupaten *"}),Ne.jsx("input",{type:"text",name:"city",value:r.city,onChange:o,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(n.city?"border-red-500":"border-gray-300"),placeholder:"Masukkan kota/kabupaten"}),n.city&&Ne.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.city})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kode Pos *"}),Ne.jsx("input",{type:"text",name:"postalCode",value:r.postalCode,onChange:o,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(n.postalCode?"border-red-500":"border-gray-300"),placeholder:"Masukkan kode pos",maxLength:5}),n.postalCode&&Ne.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.postalCode})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Alamat Lengkap *"}),Ne.jsx("textarea",{name:"fullAddress",value:r.fullAddress,onChange:o,rows:3,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(n.fullAddress?"border-red-500":"border-gray-300"),placeholder:"Jalan, nomor rumah, RT/RW, kelurahan/desa"}),n.fullAddress&&Ne.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.fullAddress})]}),Ne.jsxs("div",{className:"flex items-center",children:[Ne.jsx("input",{type:"checkbox",name:"isDefault",checked:r.isDefault,onChange:o,className:"w-4 h-4 text-pink-600 border-gray-300 rounded focus:ring-pink-500"}),Ne.jsx("label",{className:"ml-2 text-sm text-gray-700",children:"Jadikan alamat utama"})]}),Ne.jsxs("div",{className:"flex space-x-3 pt-4",children:[Ne.jsx("button",{type:"button",onClick:s,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Batal"}),Ne.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition-colors font-medium",children:e?"Update":"Simpan"})]})]})},Le=({cartItems:e,user:t,getTotalPrice:s,clearCart:r,onBack:a})=>{var n;const[i,o]=h.useState(!1),[l,u]=h.useState(""),[m,p]=h.useState(null),{addresses:g,addAddress:f,updateAddress:x,deleteAddress:b,getDefaultAddress:y}=(()=>{const[e,t]=h.useState([]),[s,r]=h.useState(!0);h.useEffect(()=>{a()},[]);const a=()=>{try{const e=localStorage.getItem($e);e&&t(JSON.parse(e))}catch(e){console.error("Failed to load addresses:",e)}finally{r(!1)}},n=e=>{localStorage.setItem($e,JSON.stringify(e)),t(e)};return{addresses:e,loading:s,addAddress:t=>{const s=d(c({},t),{id:Date.now().toString()});if(0===e.length||t.isDefault){const t=e.map(e=>d(c({},e),{isDefault:!1}));n([...t,s])}else n([...e,s])},updateAddress:(t,s)=>{const r=e.map(e=>e.id===t?c(c({},e),s):s.isDefault?d(c({},e),{isDefault:!1}):e),a=r.find(e=>e.id===t&&s.isDefault);n(a?r.map(e=>e.id===t?e:d(c({},e),{isDefault:!1})):r)},deleteAddress:t=>{const s=e.find(e=>e.id===t);if(e.length<=1)alert("Tidak dapat menghapus alamat. Minimal harus ada satu alamat.");else if(null==s?void 0:s.isDefault){const s=e.filter(e=>e.id!==t);s.length>0&&(s[0].isDefault=!0),n(s)}else n(e.filter(e=>e.id!==t))},setDefaultAddress:t=>{n(e.map(e=>d(c({},e),{isDefault:e.id===t})))},getDefaultAddress:()=>e.find(e=>e.isDefault)||e[0],refresh:a}})(),[v,j]=h.useState({name:(null==t?void 0:t.name)||"",phone:"",address:"",isDropship:!1,dropshipName:"",dropshipPhone:"",paymentMethod:"transfer",shippingCourier:"jnt",shippingCost:0,notes:""}),w=[{id:"ojek",name:"OJEK",price:0},{id:"jnt",name:"J&T",price:0},{id:"jne",name:"JNE",price:0},{id:"pos",name:"POS Indonesia",price:0},{id:"tiki",name:"TIKI",price:0},{id:"lion",name:"Lion Parcel",price:0},{id:"idexpress",name:"ID Express",price:0}],N=e=>{const{name:t,value:s,type:r}=e.target;j(a=>d(c({},a),{[t]:"checkbox"===r?e.target.checked:"number"===r?parseInt(s)||0:s}))};h.useEffect(()=>{const e=y();e&&(u(e.id),j(t=>d(c({},t),{name:e.name,phone:e.phone,address:e.fullAddress})))},[g]);const S=e=>{u(e);const t=g.find(t=>t.id===e);t&&j(e=>d(c({},e),{name:v.isDropship?e.name:t.name,phone:v.isDropship?e.phone:t.phone,address:v.isDropship?e.address:t.fullAddress}))},_=s(),P=v.shippingCost||0,C=_+P;return Ne.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[Ne.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:Ne.jsxs("div",{className:"flex items-center p-4",children:[Ne.jsx("button",{onClick:a,className:"mr-4",children:Ne.jsx(E,{className:"w-6 h-6 text-gray-600"})}),Ne.jsx("h1",{className:"text-lg font-semibold",children:"Checkout"})]})}),Ne.jsxs("div",{className:"p-4 space-y-4",children:[Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsx("h3",{className:"font-semibold mb-3",children:"Produk Pesanan"}),Ne.jsx("div",{className:"space-y-3",children:e.map(e=>{var s,r;return Ne.jsxs("div",{className:"flex space-x-3",children:[Ne.jsx("img",{src:e.images[0],alt:e.name,className:"w-16 h-16 object-cover rounded-lg"}),Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("h4",{className:"font-medium text-sm",children:e.name}),e.selectedVariant&&Ne.jsxs("p",{className:"text-xs text-gray-500",children:[e.selectedVariant.size," - ",e.selectedVariant.color]}),Ne.jsxs("div",{className:"flex justify-between items-center mt-1",children:[Ne.jsxs("span",{className:"text-sm font-semibold text-pink-600",children:["Rp ",("reseller"===(null==t?void 0:t.role)?e.resellerPrice:e.retailPrice).toLocaleString("id-ID")]}),Ne.jsxs("span",{className:"text-sm text-gray-500",children:["x",e.quantity]})]})]})]},`${e.id}-${null==(s=e.selectedVariant)?void 0:s.size}-${null==(r=e.selectedVariant)?void 0:r.color}`)})})]}),Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsxs("div",{className:"flex justify-between items-center mb-3",children:[Ne.jsx("h3",{className:"font-semibold",children:"Informasi Pengiriman"}),Ne.jsxs("button",{onClick:()=>o(!0),className:"text-pink-600 hover:text-pink-700 flex items-center text-sm font-medium",children:[Ne.jsx(A,{className:"w-4 h-4 mr-1"}),"Tambah Alamat"]})]}),g.length>0&&Ne.jsx("div",{className:"space-y-2 mb-4",children:g.map(e=>Ne.jsx("label",{className:"block p-3 border rounded-lg cursor-pointer transition-colors "+(l===e.id?"border-pink-500 bg-pink-50":"border-gray-200 hover:border-gray-300"),children:Ne.jsxs("div",{className:"flex items-start justify-between",children:[Ne.jsxs("div",{className:"flex-1",children:[Ne.jsxs("div",{className:"flex items-center mb-1",children:[Ne.jsx("input",{type:"radio",name:"address",checked:l===e.id,onChange:()=>S(e.id),className:"w-4 h-4 text-pink-600 mr-2"}),Ne.jsx("span",{className:"font-medium",children:e.name}),e.isDefault&&Ne.jsx("span",{className:"ml-2 text-xs bg-green-100 text-green-600 px-2 py-1 rounded-full",children:"Utama"})]}),Ne.jsx("p",{className:"text-sm text-gray-600 ml-6",children:e.phone}),Ne.jsx("p",{className:"text-sm text-gray-600 ml-6",children:e.fullAddress})]}),Ne.jsxs("div",{className:"flex space-x-2",children:[Ne.jsx("button",{onClick:t=>{t.stopPropagation(),p(e),o(!0)},className:"text-blue-600 hover:text-blue-700",children:Ne.jsx(D,{className:"w-4 h-4"})}),g.length>1&&Ne.jsx("button",{onClick:t=>{t.stopPropagation(),(e=>{if(window.confirm("Apakah Anda yakin ingin menghapus alamat ini?")&&(b(e),l===e)){const e=y();e&&S(e.id)}})(e.id)},className:"text-red-600 hover:text-red-700",children:Ne.jsx(R,{className:"w-4 h-4"})})]})]})},e.id))}),v.isDropship&&Ne.jsxs("div",{className:"border-t pt-4",children:[Ne.jsx("h4",{className:"font-medium text-sm text-gray-700 mb-3",children:"Informasi Pengirim (Dropship)"}),Ne.jsxs("div",{className:"space-y-3",children:[Ne.jsx("input",{type:"text",name:"dropshipName",value:v.dropshipName,onChange:N,className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Nama pengirim dropship"}),Ne.jsx("input",{type:"tel",name:"dropshipPhone",value:v.dropshipPhone,onChange:N,className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Nomor telepon pengirim"})]})]})]}),i&&Ne.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:Ne.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[Ne.jsx("h3",{className:"text-lg font-semibold mb-4",children:m?"Edit Alamat":"Tambah Alamat Baru"}),Ne.jsx(Ue,{initialData:m,onSave:e=>{m?x(m.id,e):f(e),o(!1),p(null)},onCancel:()=>{o(!1),p(null)}})]})}),Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsx("h3",{className:"font-semibold mb-3",children:"Kurir Pengiriman"}),Ne.jsxs("div",{className:"space-y-4",children:[Ne.jsxs("div",{children:[Ne.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[Ne.jsx(k,{className:"w-4 h-4 inline mr-1"}),"Nama Penerima"]}),Ne.jsx("input",{type:"text",name:"name",value:v.name,onChange:N,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Masukkan nama penerima"})]}),Ne.jsxs("div",{children:[Ne.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[Ne.jsx($,{className:"w-4 h-4 inline mr-1"}),"Nomor Telepon"]}),Ne.jsx("input",{type:"tel",name:"phone",value:v.phone,onChange:N,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Masukkan nomor telepon"})]}),Ne.jsxs("div",{children:[Ne.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[Ne.jsx(U,{className:"w-4 h-4 inline mr-1"}),"Alamat Lengkap"]}),Ne.jsx("textarea",{name:"address",value:v.address,onChange:N,rows:3,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Masukkan alamat lengkap"})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pilih Kurir Pengiriman"}),Ne.jsx("select",{name:"shippingCourier",value:v.shippingCourier,onChange:N,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",children:w.map(e=>Ne.jsx("option",{value:e.id,children:e.name},e.id))})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Biaya Ongkos Kirim (Rp)"}),Ne.jsx("input",{type:"number",name:"shippingCost",value:v.shippingCost||"",onChange:N,min:"0",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Masukkan biaya ongkos kirim"}),Ne.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"* Masukkan 0 jika gratis ongkir"})]}),Ne.jsxs("div",{className:"border-t pt-4",children:[Ne.jsxs("label",{className:"flex items-center space-x-3",children:[Ne.jsx("input",{type:"checkbox",name:"isDropship",checked:v.isDropship,onChange:N,className:"w-4 h-4 text-pink-600 border-gray-300 rounded focus:ring-pink-500"}),Ne.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Kirim sebagai dropship"})]}),v.isDropship&&Ne.jsxs("div",{className:"mt-3 space-y-3 pl-7",children:[Ne.jsx("input",{type:"text",name:"dropshipName",value:v.dropshipName,onChange:N,className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Nama pengirim dropship"}),Ne.jsx("input",{type:"tel",name:"dropshipPhone",value:v.dropshipPhone,onChange:N,className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Nomor telepon pengirim"})]})]})]})]}),Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsx("h3",{className:"font-semibold mb-3",children:"Metode Pembayaran"}),Ne.jsxs("div",{className:"space-y-3",children:[Ne.jsxs("label",{className:"flex items-center space-x-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50",children:[Ne.jsx("input",{type:"radio",name:"paymentMethod",value:"transfer",checked:"transfer"===v.paymentMethod,onChange:N,className:"w-4 h-4 text-pink-600"}),Ne.jsx(L,{className:"w-5 h-5 text-gray-400"}),Ne.jsx("span",{children:"Transfer Bank"})]}),Ne.jsxs("label",{className:"flex items-center space-x-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50",children:[Ne.jsx("input",{type:"radio",name:"paymentMethod",value:"cash",checked:"cash"===v.paymentMethod,onChange:N,className:"w-4 h-4 text-pink-600"}),Ne.jsx(z,{className:"w-5 h-5 text-gray-400"}),Ne.jsx("span",{children:"Cash on Delivery (COD)"})]})]})]}),Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsx("h3",{className:"font-semibold mb-3",children:"Ringkasan Pembayaran"}),Ne.jsxs("div",{className:"space-y-2 text-sm",children:[Ne.jsxs("div",{className:"flex justify-between",children:[Ne.jsxs("span",{children:["Subtotal (",e.length," item)"]}),Ne.jsxs("span",{children:["Rp ",_.toLocaleString("id-ID")]})]}),Ne.jsxs("div",{className:"flex justify-between",children:[Ne.jsxs("span",{children:["Ongkos Kirim (",null==(n=w.find(e=>e.id===v.shippingCourier))?void 0:n.name,")"]}),Ne.jsxs("span",{children:["Rp ",P.toLocaleString("id-ID")]})]}),Ne.jsx("div",{className:"border-t pt-2 mt-2",children:Ne.jsxs("div",{className:"flex justify-between font-semibold text-lg",children:[Ne.jsx("span",{children:"Total Pembayaran"}),Ne.jsxs("span",{className:"text-pink-600",children:["Rp ",C.toLocaleString("id-ID")]})]})})]})]}),Ne.jsx("button",{onClick:()=>{if(!v.name||!v.phone||!v.address)return void alert("Mohon lengkapi semua data pengiriman");const e={shippingInfo:{name:v.name,phone:v.phone,address:v.address,isDropship:v.isDropship,dropshipName:v.dropshipName,dropshipPhone:v.dropshipPhone,courier:v.shippingCourier},paymentMethod:v.paymentMethod,notes:v.notes},t=r(e);"transfer"===v.paymentMethod?alert(`🎉 Pesanan berhasil dibuat!\n\nID Pesanan: ${t}\nTotal: Rp ${C.toLocaleString("id-ID")}\n\nSilakan transfer ke:\n• BCA: 0511456494\n• BRI: 066301000115566\n• MANDIRI: 310011008896\n\na.n. Fahrin\n\nKemudian upload bukti pembayaran di menu "Pesanan"`):alert(`🎉 Pesanan berhasil dibuat!\n\nID Pesanan: ${t}\nTotal: Rp ${C.toLocaleString("id-ID")}\n\nPembayaran Cash on Delivery (COD)\nBarang akan dikirim setelah konfirmasi.`),a()},disabled:!v.name||!v.phone||!v.address,className:"w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-4 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"Buat Pesanan"})]})]})},ze={},Be=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),s=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));r=Promise.allSettled(t.map(e=>{if((e=function(e){return"/"+e}(e))in ze)return;ze[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const a=document.createElement("link");return a.rel=t?"stylesheet":"modulepreload",t||(a.as="script"),a.crossOrigin="",a.href=e,s&&a.setAttribute("nonce",s),document.head.appendChild(a),t?new Promise((t,s)=>{a.addEventListener("load",t),a.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function a(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then(t=>{for(const e of t||[])"rejected"===e.status&&a(e.reason);return e().catch(a)})};class Fe extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class Me extends Fe{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class qe extends Fe{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Ke extends Fe{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Je,We;(We=Je||(Je={})).Any="any",We.ApNortheast1="ap-northeast-1",We.ApNortheast2="ap-northeast-2",We.ApSouth1="ap-south-1",We.ApSoutheast1="ap-southeast-1",We.ApSoutheast2="ap-southeast-2",We.CaCentral1="ca-central-1",We.EuCentral1="eu-central-1",We.EuWest1="eu-west-1",We.EuWest2="eu-west-2",We.EuWest3="eu-west-3",We.SaEast1="sa-east-1",We.UsEast1="us-east-1",We.UsWest1="us-west-1",We.UsWest2="us-west-2";var He=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){e.done?a(e.value):function(e){return e instanceof s?e:new s(function(t){t(e)})}(e.value).then(i,o)}l((r=r.apply(e,t||[])).next())})};class Ge{constructor(e,{headers:s={},customFetch:r,region:a=Je.Any}={}){this.url=e,this.headers=s,this.region=a,this.fetch=(e=>{let s;return s=e||("undefined"==typeof fetch?(...e)=>Be(()=>u(t,null,function*(){const{default:e}=yield Promise.resolve().then(()=>ot);return{default:e}}),void 0).then(({default:t})=>t(...e)):fetch),(...e)=>s(...e)})(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return He(this,arguments,void 0,function*(e,t={}){var s;try{const{headers:r,method:a,body:n,signal:i}=t;let o={},{region:l}=t;l||(l=this.region);const c=new URL(`${this.url}/${e}`);let d;l&&"any"!==l&&(o["x-region"]=l,c.searchParams.set("forceFunctionRegion",l)),n&&(r&&!Object.prototype.hasOwnProperty.call(r,"Content-Type")||!r)&&("undefined"!=typeof Blob&&n instanceof Blob||n instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",d=n):"string"==typeof n?(o["Content-Type"]="text/plain",d=n):"undefined"!=typeof FormData&&n instanceof FormData?d=n:(o["Content-Type"]="application/json",d=JSON.stringify(n)));const u=yield this.fetch(c.toString(),{method:a||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),r),body:d,signal:i}).catch(e=>{if("AbortError"===e.name)throw e;throw new Me(e)}),h=u.headers.get("x-relay-error");if(h&&"true"===h)throw new qe(u);if(!u.ok)throw new Ke(u);let m,p=(null!==(s=u.headers.get("Content-Type"))&&void 0!==s?s:"text/plain").split(";")[0].trim();return m="application/json"===p?yield u.json():"application/octet-stream"===p?yield u.blob():"text/event-stream"===p?u:"multipart/form-data"===p?yield u.formData():yield u.text(),{data:m,error:null,response:u}}catch(r){return r instanceof Error&&"AbortError"===r.name?{data:null,error:new Me(r)}:{data:null,error:r,response:r instanceof Ke||r instanceof qe?r.context:void 0}}})}}var Ve={},Ye={},Xe={},Ze={},Qe={},et={},tt=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();const st=tt.fetch,rt=tt.fetch.bind(tt),at=tt.Headers,nt=tt.Request,it=tt.Response,ot=Object.freeze(Object.defineProperty({__proto__:null,Headers:at,Request:nt,Response:it,default:rt,fetch:st},Symbol.toStringTag,{value:"Module"})),lt=g(ot);var ct={};Object.defineProperty(ct,"__esModule",{value:!0});let dt=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};ct.default=dt;var ut=f&&f.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(et,"__esModule",{value:!0});const ht=ut(lt),mt=ut(ct);et.default=class{constructor(e){var t,s;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!==(t=e.shouldThrowOnError)&&void 0!==t&&t,this.signal=e.signal,this.isMaybeSingle=null!==(s=e.isMaybeSingle)&&void 0!==s&&s,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=ht.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let s=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(e=>u(this,null,function*(){var t,s,r,a;let n=null,i=null,o=null,l=e.status,c=e.statusText;if(e.ok){if("HEAD"!==this.method){const s=yield e.text();""===s||(i="text/csv"===this.headers.get("Accept")||this.headers.get("Accept")&&(null===(t=this.headers.get("Accept"))||void 0===t?void 0:t.includes("application/vnd.pgrst.plan+text"))?s:JSON.parse(s))}const a=null===(s=this.headers.get("Prefer"))||void 0===s?void 0:s.match(/count=(exact|planned|estimated)/),d=null===(r=e.headers.get("content-range"))||void 0===r?void 0:r.split("/");a&&d&&d.length>1&&(o=parseInt(d[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(i)&&(i.length>1?(n={code:"PGRST116",details:`Results contain ${i.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},i=null,o=null,l=406,c="Not Acceptable"):i=1===i.length?i[0]:null)}else{const t=yield e.text();try{n=JSON.parse(t),Array.isArray(n)&&404===e.status&&(i=[],n=null,l=200,c="OK")}catch(d){404===e.status&&""===t?(l=204,c="No Content"):n={message:t}}if(n&&this.isMaybeSingle&&(null===(a=null==n?void 0:n.details)||void 0===a?void 0:a.includes("0 rows"))&&(n=null,l=200,c="OK"),n&&this.shouldThrowOnError)throw new mt.default(n)}return{error:n,data:i,count:o,status:l,statusText:c}}));return this.shouldThrowOnError||(s=s.catch(e=>{var t,s,r;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(s=null==e?void 0:e.stack)&&void 0!==s?s:""}`,hint:"",code:`${null!==(r=null==e?void 0:e.code)&&void 0!==r?r:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}returns(){return this}overrideTypes(){return this}};var pt=f&&f.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Qe,"__esModule",{value:!0});const gt=pt(et);let ft=class extends gt.default{select(e){let t=!1;const s=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",s),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:r,referencedTable:a=r}={}){const n=a?`${a}.order`:"order",i=this.url.searchParams.get(n);return this.url.searchParams.set(n,`${i?`${i},`:""}${e}.${t?"asc":"desc"}${void 0===s?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const r=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:r=s}={}){const a=void 0===r?"offset":`${r}.offset`,n=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(a,`${e}`),this.url.searchParams.set(n,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:r=!1,wal:a=!1,format:n="text"}={}){var i;const o=[e?"analyze":null,t?"verbose":null,s?"settings":null,r?"buffers":null,a?"wal":null].filter(Boolean).join("|"),l=null!==(i=this.headers.get("Accept"))&&void 0!==i?i:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${n}; for="${l}"; options=${o};`),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};Qe.default=ft;var xt=f&&f.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ze,"__esModule",{value:!0});const bt=xt(Qe);let yt=class extends bt.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:r}={}){let a="";"plain"===r?a="pl":"phrase"===r?a="ph":"websearch"===r&&(a="w");const n=void 0===s?"":`(${s})`;return this.url.searchParams.append(e,`${a}fts${n}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const r=s?`${s}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};Ze.default=yt;var vt=f&&f.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Xe,"__esModule",{value:!0});const jt=vt(Ze);Xe.default=class{constructor(e,{headers:t={},schema:s,fetch:r}){this.url=e,this.headers=new Headers(t),this.schema=s,this.fetch=r}select(e,t){const{head:s=!1,count:r}=null!=t?t:{},a=s?"HEAD":"GET";let n=!1;const i=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!n?"":('"'===e&&(n=!n),e)).join("");return this.url.searchParams.set("select",i),r&&this.headers.append("Prefer",`count=${r}`),new jt.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:s=!0}={}){var r;if(t&&this.headers.append("Prefer",`count=${t}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new jt.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(r=this.fetch)&&void 0!==r?r:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:r,defaultToNull:a=!0}={}){var n;if(this.headers.append("Prefer",`resolution=${s?"ignore":"merge"}-duplicates`),void 0!==t&&this.url.searchParams.set("on_conflict",t),r&&this.headers.append("Prefer",`count=${r}`),a||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new jt.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(n=this.fetch)&&void 0!==n?n:fetch})}update(e,{count:t}={}){var s;return t&&this.headers.append("Prefer",`count=${t}`),new jt.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(s=this.fetch)&&void 0!==s?s:fetch})}delete({count:e}={}){var t;return e&&this.headers.append("Prefer",`count=${e}`),new jt.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:null!==(t=this.fetch)&&void 0!==t?t:fetch})}};var wt=f&&f.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ye,"__esModule",{value:!0});const Nt=wt(Xe),kt=wt(Ze);Ye.default=class e{constructor(e,{headers:t={},schema:s,fetch:r}={}){this.url=e,this.headers=new Headers(t),this.schemaName=s,this.fetch=r}from(e){const t=new URL(`${this.url}/${e}`);return new Nt.default(t,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:r=!1,count:a}={}){var n;let i;const o=new URL(`${this.url}/rpc/${e}`);let l;s||r?(i=s?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{o.searchParams.append(e,t)})):(i="POST",l=t);const c=new Headers(this.headers);return a&&c.set("Prefer",`count=${a}`),new kt.default({method:i,url:o,headers:c,schema:this.schemaName,body:l,fetch:null!==(n=this.fetch)&&void 0!==n?n:fetch})}};var St=f&&f.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.PostgrestError=Ve.PostgrestBuilder=Ve.PostgrestTransformBuilder=Ve.PostgrestFilterBuilder=Ve.PostgrestQueryBuilder=Ve.PostgrestClient=void 0;const _t=St(Ye);Ve.PostgrestClient=_t.default;const Pt=St(Xe);Ve.PostgrestQueryBuilder=Pt.default;const Et=St(Ze);Ve.PostgrestFilterBuilder=Et.default;const Ct=St(Qe);Ve.PostgrestTransformBuilder=Ct.default;const Tt=St(et);Ve.PostgrestBuilder=Tt.default;const Ot=St(ct);Ve.PostgrestError=Ot.default;var At=Ve.default={PostgrestClient:_t.default,PostgrestQueryBuilder:Pt.default,PostgrestFilterBuilder:Et.default,PostgrestTransformBuilder:Ct.default,PostgrestBuilder:Tt.default,PostgrestError:Ot.default};const{PostgrestClient:It,PostgrestQueryBuilder:Rt,PostgrestFilterBuilder:Dt,PostgrestTransformBuilder:$t,PostgrestBuilder:Ut,PostgrestError:Lt}=At;class zt{static detectEnvironment(){var e;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!=typeof global&&void 0!==global.WebSocket)return{type:"native",constructor:global.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if("undefined"!=typeof process){const e=process.versions;if(e&&e.node){const t=e.node,s=parseInt(t.replace(/^v/,"").split(".")[0]);return s>=22?void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`\n\nSuggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(e){return!1}}}const Bt=1e4;var Ft,Mt,qt,Kt,Jt,Wt,Ht,Gt,Vt,Yt,Xt;(Mt=Ft||(Ft={}))[Mt.connecting=0]="connecting",Mt[Mt.open=1]="open",Mt[Mt.closing=2]="closing",Mt[Mt.closed=3]="closed",(Kt=qt||(qt={})).closed="closed",Kt.errored="errored",Kt.joined="joined",Kt.joining="joining",Kt.leaving="leaving",(Wt=Jt||(Jt={})).close="phx_close",Wt.error="phx_error",Wt.join="phx_join",Wt.reply="phx_reply",Wt.leave="phx_leave",Wt.access_token="access_token",(Ht||(Ht={})).websocket="websocket",(Vt=Gt||(Gt={})).Connecting="connecting",Vt.Open="open",Vt.Closing="closing",Vt.Closed="closed";class Zt{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const r=t.getUint8(1),a=t.getUint8(2);let n=this.HEADER_LENGTH+2;const i=s.decode(e.slice(n,n+r));n+=r;const o=s.decode(e.slice(n,n+a));return n+=a,{ref:null,topic:i,event:o,payload:JSON.parse(s.decode(e.slice(n,e.byteLength)))}}}class Qt{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(Xt=Yt||(Yt={})).abstime="abstime",Xt.bool="bool",Xt.date="date",Xt.daterange="daterange",Xt.float4="float4",Xt.float8="float8",Xt.int2="int2",Xt.int4="int4",Xt.int4range="int4range",Xt.int8="int8",Xt.int8range="int8range",Xt.json="json",Xt.jsonb="jsonb",Xt.money="money",Xt.numeric="numeric",Xt.oid="oid",Xt.reltime="reltime",Xt.text="text",Xt.time="time",Xt.timestamp="timestamp",Xt.timestamptz="timestamptz",Xt.timetz="timetz",Xt.tsrange="tsrange",Xt.tstzrange="tstzrange";const es=(e,t,s={})=>{var r;const a=null!==(r=s.skipTypes)&&void 0!==r?r:[];return t?Object.keys(t).reduce((s,r)=>(s[r]=ts(r,e,t,a),s),{}):{}},ts=(e,t,s,r)=>{const a=t.find(t=>t.name===e),n=null==a?void 0:a.type,i=s[e];return n&&!r.includes(n)?ss(n,i):rs(i)},ss=(e,t)=>{if("_"===e.charAt(0)){const s=e.slice(1,e.length);return os(t,s)}switch(e){case Yt.bool:return as(t);case Yt.float4:case Yt.float8:case Yt.int2:case Yt.int4:case Yt.int8:case Yt.numeric:case Yt.oid:return ns(t);case Yt.json:case Yt.jsonb:return is(t);case Yt.timestamp:return ls(t);case Yt.abstime:case Yt.date:case Yt.daterange:case Yt.int4range:case Yt.int8range:case Yt.money:case Yt.reltime:case Yt.text:case Yt.time:case Yt.timestamptz:case Yt.timetz:case Yt.tsrange:case Yt.tstzrange:default:return rs(t)}},rs=e=>e,as=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},ns=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},is=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},os=(e,t)=>{if("string"!=typeof e)return e;const s=e.length-1,r=e[s];if("{"===e[0]&&"}"===r){let r;const n=e.slice(1,s);try{r=JSON.parse("["+n+"]")}catch(a){r=n?n.split(","):[]}return r.map(e=>ss(t,e))}return e},ls=e=>"string"==typeof e?e.replace(" ","T"):e,cs=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")+"/api/broadcast"};class ds{constructor(e,t,s={},r=1e4){this.channel=e,this.event=t,this.payload=s,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t(null===(s=this.receivedResp)||void 0===s?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref),this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout))}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var us,hs,ms,ps,gs,fs,xs,bs;(hs=us||(us={})).SYNC="sync",hs.JOIN="join",hs.LEAVE="leave";class ys{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},e=>{const{onJoin:t,onLeave:s,onSync:r}=this.caller;this.joinRef=this.channel._joinRef(),this.state=ys.syncState(this.state,e,t,s),this.pendingDiffs.forEach(e=>{this.state=ys.syncDiff(this.state,e,t,s)}),this.pendingDiffs=[],r()}),this.channel._on(s.diff,{},e=>{const{onJoin:t,onLeave:s,onSync:r}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=ys.syncDiff(this.state,e,t,s),r())}),this.onJoin((e,t,s)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:s})}),this.onLeave((e,t,s)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:s})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,r){const a=this.cloneDeep(e),n=this.transformState(t),i={},o={};return this.map(a,(e,t)=>{n[e]||(o[e]=t)}),this.map(n,(e,t)=>{const s=a[e];if(s){const r=t.map(e=>e.presence_ref),a=s.map(e=>e.presence_ref),n=t.filter(e=>a.indexOf(e.presence_ref)<0),l=s.filter(e=>r.indexOf(e.presence_ref)<0);n.length>0&&(i[e]=n),l.length>0&&(o[e]=l)}else i[e]=t}),this.syncDiff(a,{joins:i,leaves:o},s,r)}static syncDiff(e,t,s,r){const{joins:a,leaves:n}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),r||(r=()=>{}),this.map(a,(t,r)=>{var a;const n=null!==(a=e[t])&&void 0!==a?a:[];if(e[t]=this.cloneDeep(r),n.length>0){const s=e[t].map(e=>e.presence_ref),r=n.filter(e=>s.indexOf(e.presence_ref)<0);e[t].unshift(...r)}s(t,n,r)}),this.map(n,(t,s)=>{let a=e[t];if(!a)return;const n=s.map(e=>e.presence_ref);a=a.filter(e=>n.indexOf(e.presence_ref)<0),e[t]=a,r(t,a,s),0===a.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const r=e[s];return t[s]="metas"in r?r.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(ps=ms||(ms={})).ALL="*",ps.INSERT="INSERT",ps.UPDATE="UPDATE",ps.DELETE="DELETE",(fs=gs||(gs={})).BROADCAST="broadcast",fs.PRESENCE="presence",fs.POSTGRES_CHANGES="postgres_changes",fs.SYSTEM="system",(bs=xs||(xs={})).SUBSCRIBED="SUBSCRIBED",bs.TIMED_OUT="TIMED_OUT",bs.CLOSED="CLOSED",bs.CHANNEL_ERROR="CHANNEL_ERROR";class vs{constructor(e,t={config:{}},s){var r,a;if(this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=qt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new ds(this,Jt.join,this.params,this.timeout),this.rejoinTimer=new Qt(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=qt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=qt.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=qt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=qt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=qt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Jt.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new ys(this),this.broadcastEndpointURL=cs(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null===(a=null===(r=this.params.config)||void 0===r?void 0:r.broadcast)||void 0===a?void 0:a.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var s,r,a;if(this.socket.isConnected()||this.socket.connect(),this.state==qt.closed){const{config:{broadcast:n,presence:i,private:o}}=this.params,l=null!==(r=null===(s=this.bindings.postgres_changes)||void 0===s?void 0:s.map(e=>e.filter))&&void 0!==r?r:[],c=!!this.bindings[gs.PRESENCE]&&this.bindings[gs.PRESENCE].length>0||!0===(null===(a=this.params.config.presence)||void 0===a?void 0:a.enabled),d={},h={broadcast:n,presence:Object.assign(Object.assign({},i),{enabled:c}),postgres_changes:l,private:o};this.socket.accessTokenValue&&(d.access_token=this.socket.accessTokenValue),this._onError(t=>null==e?void 0:e(xs.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e(xs.CLOSED)),this.updateJoinPayload(Object.assign({config:h},d)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",t=>u(this,[t],function*({postgres_changes:t}){var s;if(this.socket.setAuth(),void 0!==t){const r=this.bindings.postgres_changes,a=null!==(s=null==r?void 0:r.length)&&void 0!==s?s:0,n=[];for(let s=0;s<a;s++){const a=r[s],{filter:{event:i,schema:o,table:l,filter:c}}=a,d=t&&t[s];if(!d||d.event!==i||d.schema!==o||d.table!==l||d.filter!==c)return this.unsubscribe(),this.state=qt.errored,void(null==e||e(xs.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));n.push(Object.assign(Object.assign({},a),{id:d.id}))}return this.bindings.postgres_changes=n,void(e&&e(xs.SUBSCRIBED))}null==e||e(xs.SUBSCRIBED)})).receive("error",t=>{this.state=qt.errored,null==e||e(xs.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null==e||e(xs.TIMED_OUT)})}return this}presenceState(){return this.presence.state}track(e){return u(this,arguments,function*(e,t={}){return yield this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)})}untrack(){return u(this,arguments,function*(e={}){return yield this.send({type:"presence",event:"untrack"},e)})}on(e,t,s){return this.state===qt.joined&&e===gs.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,s)}send(e){return u(this,arguments,function*(e,t={}){var s,r;if(this._canPush()||"broadcast"!==e.type)return new Promise(s=>{var r,a,n;const i=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(n=null===(a=null===(r=this.params)||void 0===r?void 0:r.config)||void 0===a?void 0:a.broadcast)||void 0===n?void 0:n.ack)||s("ok"),i.receive("ok",()=>s("ok")),i.receive("error",()=>s("error")),i.receive("timeout",()=>s("timed out"))});{const{event:n,payload:i}=e,o={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:i,private:this.private}]})};try{const e=yield this._fetchWithTimeout(this.broadcastEndpointURL,o,null!==(s=t.timeout)&&void 0!==s?s:this.timeout);return yield null===(r=e.body)||void 0===r?void 0:r.cancel(),e.ok?"ok":"error"}catch(a){return"AbortError"===a.name?"timed out":"error"}}})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=qt.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Jt.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(r=>{s=new ds(this,Jt.leave,{},e),s.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{null==s||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=qt.closed,this.bindings={}}_fetchWithTimeout(e,t,s){return u(this,null,function*(){const r=new AbortController,a=setTimeout(()=>r.abort(),s),n=yield this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(a),n})}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new ds(this,e,t,s);return this._canPush()?r.send():this._addToPushBuffer(r),r}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var r,a;const n=e.toLocaleLowerCase(),{close:i,error:o,leave:l,join:c}=Jt;if(s&&[i,o,l,c].indexOf(n)>=0&&s!==this._joinRef())return;let d=this._onMessage(n,t,s);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(n)?null===(r=this.bindings.postgres_changes)||void 0===r||r.filter(e=>{var t,s,r;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(r=null===(s=e.filter)||void 0===s?void 0:s.event)||void 0===r?void 0:r.toLocaleLowerCase())===n}).map(e=>e.callback(d,s)):null===(a=this.bindings[n])||void 0===a||a.filter(e=>{var s,r,a,i,o,l;if(["broadcast","presence","postgres_changes"].includes(n)){if("id"in e){const n=e.id,i=null===(s=e.filter)||void 0===s?void 0:s.event;return n&&(null===(r=t.ids)||void 0===r?void 0:r.includes(n))&&("*"===i||(null==i?void 0:i.toLocaleLowerCase())===(null===(a=t.data)||void 0===a?void 0:a.type.toLocaleLowerCase()))}{const s=null===(o=null===(i=null==e?void 0:e.filter)||void 0===i?void 0:i.event)||void 0===o?void 0:o.toLocaleLowerCase();return"*"===s||s===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===n}).map(e=>{if("object"==typeof d&&"ids"in d){const e=d.data,{schema:t,table:s,commit_timestamp:r,type:a,errors:n}=e,i={schema:t,table:s,commit_timestamp:r,eventType:a,new:{},old:{},errors:n};d=Object.assign(Object.assign({},i),this._getPayloadRecords(e))}e.callback(d,s)})}_isClosed(){return this.state===qt.closed}_isJoined(){return this.state===qt.joined}_isJoining(){return this.state===qt.joining}_isLeaving(){return this.state===qt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const r=e.toLocaleLowerCase(),a={type:r,filter:t,callback:s};return this.bindings[r]?this.bindings[r].push(a):this.bindings[r]=[a],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(e=>{var r;return!((null===(r=e.type)||void 0===r?void 0:r.toLocaleLowerCase())===s&&vs.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Jt.close,{},e)}_onError(e){this._on(Jt.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=qt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=es(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=es(e.columns,e.old_record)),t}}const js=()=>{},ws=25e3,Ns=10,ks=100,Ss=[1e3,2e3,5e3,1e4];class _s{constructor(e,t){var s;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Bt,this.transport=null,this.heartbeatIntervalMs=ws,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=js,this.ref=0,this.reconnectTimer=null,this.logger=js,this.conn=null,this.sendBuffer=[],this.serializer=new Zt,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>Be(()=>u(this,null,function*(){const{default:e}=yield Promise.resolve().then(()=>ot);return{default:e}}),void 0).then(({default:t})=>t(...e)).catch(e=>{throw new Error(`Failed to load @supabase/node-fetch: ${e.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):fetch),(...e)=>t(...e)},!(null===(s=null==t?void 0:t.params)||void 0===s?void 0:s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${Ht.websocket}`,this.httpEndpoint=cs(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null==t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=zt.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;if(t.includes("Node.js"))throw new Error(`${t}\n\nTo use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })`);throw new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}removeChannel(e){return u(this,null,function*(){const t=yield e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t})}removeAllChannels(){return u(this,null,function*(){const e=yield Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e})}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case Ft.connecting:return Gt.Connecting;case Ft.open:return Gt.Open;case Ft.closing:return Gt.Closing;default:return Gt.Closed}}isConnected(){return this.connectionState()===Gt.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e,t={config:{}}){const s=`realtime:${e}`,r=this.getChannels().find(e=>e.topic===s);if(r)return r;{const s=new vs(`realtime:${e}`,t,this);return this.channels.push(s),s}}push(e){const{topic:t,event:s,payload:r,ref:a}=e,n=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push",`${t} ${s} (${a})`,r),this.isConnected()?n():this.sendBuffer.push(n)}setAuth(e=null){return u(this,null,function*(){this._authPromise=this._performAuth(e);try{yield this._authPromise}finally{this._authPromise=null}})}sendHeartbeat(){return u(this,null,function*(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}return this._wasManualDisconnect=!1,null===(e=this.conn)||void 0===e||e.close(1e3,"heartbeat timeout"),void setTimeout(()=>{var e;this.isConnected()||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout()},ks)}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}else try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}})}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{if("phoenix"===e.topic&&"phx_reply"===e.event)try{this.heartbeatCallback("ok"===e.payload.status?"ok":"error")}catch(o){this.log("error","error in heartbeat callback",o)}e.ref&&e.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:t,event:s,payload:r,ref:a}=e,n=a?`(${a})`:"",i=r.status||"";this.log("receive",`${i} ${t} ${s} ${n}`.trim(),r),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(s,r,a)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null===(t=this.reconnectTimer)||void 0===t||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Jt.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const s=e.match(/\?/)?"&":"?";return`${e}${s}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e,t=!1){this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}_performAuth(e=null){return u(this,null,function*(){let t;t=e||(this.accessToken?yield this.accessToken():this.accessTokenValue),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(e=>{const s={access_token:t,version:"realtime-js/2.75.1"};t&&e.updateJoinPayload(s),e.joinedOnce&&e._isJoined()&&e._push(Jt.access_token,{access_token:t})}))})}_waitForAuthIfNeeded(){return u(this,null,function*(){this._authPromise&&(yield this._authPromise)})}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(t)}catch(r){this.log("error",`error in ${e} callback`,r)}})}catch(s){this.log("error",`error triggering ${e} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new Qt(()=>u(this,null,function*(){setTimeout(()=>u(this,null,function*(){yield this._waitForAuthIfNeeded(),this.isConnected()||this.connect()}),Ns)}),this.reconnectAfterMs)}_initializeOptions(e){var t,s,r,a,n,i,o,l,c;if(this.transport=null!==(t=null==e?void 0:e.transport)&&void 0!==t?t:null,this.timeout=null!==(s=null==e?void 0:e.timeout)&&void 0!==s?s:Bt,this.heartbeatIntervalMs=null!==(r=null==e?void 0:e.heartbeatIntervalMs)&&void 0!==r?r:ws,this.worker=null!==(a=null==e?void 0:e.worker)&&void 0!==a&&a,this.accessToken=null!==(n=null==e?void 0:e.accessToken)&&void 0!==n?n:null,this.heartbeatCallback=null!==(i=null==e?void 0:e.heartbeatCallback)&&void 0!==i?i:js,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.logger)&&(this.logger=e.logger),((null==e?void 0:e.logLevel)||(null==e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(o=null==e?void 0:e.reconnectAfterMs)&&void 0!==o?o:e=>Ss[e-1]||1e4,this.encode=null!==(l=null==e?void 0:e.encode)&&void 0!==l?l:(e,t)=>t(JSON.stringify(e)),this.decode=null!==(c=null==e?void 0:e.decode)&&void 0!==c?c:this.serializer.decode.bind(this.serializer),this.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=null==e?void 0:e.workerUrl}}}class Ps extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Es(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class Cs extends Ps{constructor(e,t,s){super(e),this.name="StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Ts extends Ps{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Os=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){e.done?a(e.value):function(e){return e instanceof s?e:new s(function(t){t(e)})}(e.value).then(i,o)}l((r=r.apply(e,t||[])).next())})};const As=e=>{let s;return s=e||("undefined"==typeof fetch?(...e)=>Be(()=>u(t,null,function*(){const{default:e}=yield Promise.resolve().then(()=>ot);return{default:e}}),void 0).then(({default:t})=>t(...e)):fetch),(...e)=>s(...e)},Is=e=>{if(Array.isArray(e))return e.map(e=>Is(e));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([e,s])=>{const r=e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[r]=Is(s)}),t};var Rs=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){e.done?a(e.value):function(e){return e instanceof s?e:new s(function(t){t(e)})}(e.value).then(i,o)}l((r=r.apply(e,t||[])).next())})};const Ds=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),$s=(e,t,s)=>Rs(void 0,void 0,void 0,function*(){const r=yield Os(void 0,void 0,void 0,function*(){return"undefined"==typeof Response?(yield Be(()=>Promise.resolve().then(()=>ot),void 0)).Response:Response});e instanceof r&&!(null==s?void 0:s.noResolveJson)?e.json().then(s=>{const r=e.status||500,a=(null==s?void 0:s.statusCode)||r+"";t(new Cs(Ds(s),r,a))}).catch(e=>{t(new Ts(Ds(e),e))}):t(new Ts(Ds(e),e))}),Us=(e,t,s,r)=>{const a={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"!==e&&r?((e=>{if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)})(r)?(a.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),a.body=JSON.stringify(r)):a.body=r,(null==t?void 0:t.duplex)&&(a.duplex=t.duplex),Object.assign(Object.assign({},a),s)):a};function Ls(e,t,s,r,a,n){return Rs(this,void 0,void 0,function*(){return new Promise((i,o)=>{e(s,Us(t,r,a,n)).then(e=>{if(!e.ok)throw e;return(null==r?void 0:r.noResolveJson)?e:e.json()}).then(e=>i(e)).catch(e=>$s(e,o,r))})})}function zs(e,t,s,r){return Rs(this,void 0,void 0,function*(){return Ls(e,"GET",t,s,r)})}function Bs(e,t,s,r,a){return Rs(this,void 0,void 0,function*(){return Ls(e,"POST",t,r,a,s)})}function Fs(e,t,s,r,a){return Rs(this,void 0,void 0,function*(){return Ls(e,"PUT",t,r,a,s)})}function Ms(e,t,s,r,a){return Rs(this,void 0,void 0,function*(){return Ls(e,"DELETE",t,r,a,s)})}var qs=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){e.done?a(e.value):function(e){return e instanceof s?e:new s(function(t){t(e)})}(e.value).then(i,o)}l((r=r.apply(e,t||[])).next())})};class Ks{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return qs(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Es(e))return{data:null,error:e};throw e}})}}var Js,Ws=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){e.done?a(e.value):function(e){return e instanceof s?e:new s(function(t){t(e)})}(e.value).then(i,o)}l((r=r.apply(e,t||[])).next())})};class Hs{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[Js]="BlobDownloadBuilder",this.promise=null}asStream(){return new Ks(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return Ws(this,void 0,void 0,function*(){try{const e=yield this.downloadFn();return{data:yield e.blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Es(e))return{data:null,error:e};throw e}})}}Js=Symbol.toStringTag;var Gs=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){e.done?a(e.value):function(e){return e instanceof s?e:new s(function(t){t(e)})}(e.value).then(i,o)}l((r=r.apply(e,t||[])).next())})};const Vs={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ys={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Xs{constructor(e,t={},s,r){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=s,this.fetch=As(r)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,s,r){return Gs(this,void 0,void 0,function*(){try{let a;const n=Object.assign(Object.assign({},Ys),r);let i=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(n.upsert)});const o=n.metadata;"undefined"!=typeof Blob&&s instanceof Blob?(a=new FormData,a.append("cacheControl",n.cacheControl),o&&a.append("metadata",this.encodeMetadata(o)),a.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(a=s,a.append("cacheControl",n.cacheControl),o&&a.append("metadata",this.encodeMetadata(o))):(a=s,i["cache-control"]=`max-age=${n.cacheControl}`,i["content-type"]=n.contentType,o&&(i["x-metadata"]=this.toBase64(this.encodeMetadata(o)))),(null==r?void 0:r.headers)&&(i=Object.assign(Object.assign({},i),r.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),d=yield("PUT"==e?Fs:Bs)(this.fetch,`${this.url}/object/${c}`,a,Object.assign({headers:i},(null==n?void 0:n.duplex)?{duplex:n.duplex}:{}));return{data:{path:l,id:d.Id,fullPath:d.Key},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Es(a))return{data:null,error:a};throw a}})}upload(e,t,s){return Gs(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,r){return Gs(this,void 0,void 0,function*(){const a=this._removeEmptyFolders(e),n=this._getFinalPath(a),i=new URL(this.url+`/object/upload/sign/${n}`);i.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:Ys.upsert},r),n=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});return"undefined"!=typeof Blob&&s instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(e=s,e.append("cacheControl",t.cacheControl)):(e=s,n["cache-control"]=`max-age=${t.cacheControl}`,n["content-type"]=t.contentType),{data:{path:a,fullPath:(yield Fs(this.fetch,i.toString(),e,{headers:n})).Key},error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(Es(o))return{data:null,error:o};throw o}})}createSignedUploadUrl(e,t){return Gs(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const r=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(r["x-upsert"]="true");const a=yield Bs(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:r}),n=new URL(this.url+a.url),i=n.searchParams.get("token");if(!i)throw new Ps("No token returned by API");return{data:{signedUrl:n.toString(),path:e,token:i},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Es(s))return{data:null,error:s};throw s}})}update(e,t,s){return Gs(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return Gs(this,void 0,void 0,function*(){try{return{data:yield Bs(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Es(r))return{data:null,error:r};throw r}})}copy(e,t,s){return Gs(this,void 0,void 0,function*(){try{return{data:{path:(yield Bs(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Es(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,s){return Gs(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),a=yield Bs(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:t},(null==s?void 0:s.transform)?{transform:s.transform}:{}),{headers:this.headers});const n=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return a={signedUrl:encodeURI(`${this.url}${a.signedURL}${n}`)},{data:a,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Es(r))return{data:null,error:r};throw r}})}createSignedUrls(e,t,s){return Gs(this,void 0,void 0,function*(){try{const r=yield Bs(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),a=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return{data:r.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${a}`):null})),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Es(r))return{data:null,error:r};throw r}})}download(e,t){const s=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",r=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),a=r?`?${r}`:"",n=this._getFinalPath(e);return new Hs(()=>zs(this.fetch,`${this.url}/${s}/${n}${a}`,{headers:this.headers,noResolveJson:!0}),this.shouldThrowOnError)}info(e){return Gs(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const e=yield zs(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Is(e),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Es(s))return{data:null,error:s};throw s}})}exists(e){return Gs(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield function(e,t,s,r){return Rs(this,void 0,void 0,function*(){return Ls(e,"HEAD",t,Object.assign(Object.assign({},s),{noResolveJson:!0}),r)})}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Es(s)&&s instanceof Ts){const e=s.originalError;if([400,404].includes(null==e?void 0:e.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),r=[],a=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==a&&r.push(a);const n=void 0!==(null==t?void 0:t.transform)?"render/image":"object",i=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==i&&r.push(i);let o=r.join("&");return""!==o&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${n}/public/${s}${o}`)}}}remove(e){return Gs(this,void 0,void 0,function*(){try{return{data:yield Ms(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Es(t))return{data:null,error:t};throw t}})}list(e,t,s){return Gs(this,void 0,void 0,function*(){try{const r=Object.assign(Object.assign(Object.assign({},Vs),t),{prefix:e||""});return{data:yield Bs(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},s),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Es(r))return{data:null,error:r};throw r}})}listV2(e,t){return Gs(this,void 0,void 0,function*(){try{const s=Object.assign({},e);return{data:yield Bs(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,s,{headers:this.headers},t),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Es(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Zs={"X-Client-Info":"storage-js/2.75.1"};var Qs=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){e.done?a(e.value):function(e){return e instanceof s?e:new s(function(t){t(e)})}(e.value).then(i,o)}l((r=r.apply(e,t||[])).next())})};class er{constructor(e,t={},s,r){this.shouldThrowOnError=!1;const a=new URL(e);(null==r?void 0:r.useNewHostname)&&/supabase\.(co|in|red)$/.test(a.hostname)&&!a.hostname.includes("storage.supabase.")&&(a.hostname=a.hostname.replace("supabase.","storage.supabase.")),this.url=a.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Zs),t),this.fetch=As(s)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return Qs(this,void 0,void 0,function*(){try{return{data:yield zs(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Es(e))return{data:null,error:e};throw e}})}getBucket(e){return Qs(this,void 0,void 0,function*(){try{return{data:yield zs(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Es(t))return{data:null,error:t};throw t}})}createBucket(e){return Qs(this,arguments,void 0,function*(e,t={public:!1}){try{return{data:yield Bs(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Es(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return Qs(this,void 0,void 0,function*(){try{return{data:yield Fs(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Es(s))return{data:null,error:s};throw s}})}emptyBucket(e){return Qs(this,void 0,void 0,function*(){try{return{data:yield Bs(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Es(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Qs(this,void 0,void 0,function*(){try{return{data:yield Ms(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Es(t))return{data:null,error:t};throw t}})}}class tr extends er{constructor(e,t={},s,r){super(e,t,s,r)}from(e){return new Xs(this.url,this.headers,e,this.fetch)}}let sr="";sr="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const rr={headers:{"X-Client-Info":`supabase-js-${sr}/2.75.1`}},ar={schema:"public"},nr={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},ir={};var or=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){e.done?a(e.value):function(e){return e instanceof s?e:new s(function(t){t(e)})}(e.value).then(i,o)}l((r=r.apply(e,t||[])).next())})};const lr=(e,t,s)=>{const r=(e=>{let t;return t=e||("undefined"==typeof fetch?rt:fetch),(...e)=>t(...e)})(s),a="undefined"==typeof Headers?at:Headers;return(s,n)=>or(void 0,void 0,void 0,function*(){var i;const o=null!==(i=yield t())&&void 0!==i?i:e;let l=new a(null==n?void 0:n.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${o}`),r(s,Object.assign(Object.assign({},n),{headers:l}))})};var cr=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){e.done?a(e.value):function(e){return e instanceof s?e:new s(function(t){t(e)})}(e.value).then(i,o)}l((r=r.apply(e,t||[])).next())})};const dr="2.75.1",ur=3e4,hr=9e4,mr={"X-Client-Info":`gotrue-js/${dr}`},pr="X-Supabase-Api-Version",gr={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},fr=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class xr extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function br(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class yr extends xr{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function vr(e){return br(e)&&"AuthApiError"===e.name}class jr extends xr{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class wr extends xr{constructor(e,t,s,r){super(e,s,r),this.name=t,this.status=s}}class Nr extends wr{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function kr(e){return br(e)&&"AuthSessionMissingError"===e.name}class Sr extends wr{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class _r extends wr{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Pr extends wr{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Er(e){return br(e)&&"AuthImplicitGrantRedirectError"===e.name}class Cr extends wr{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Tr extends wr{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Or(e){return br(e)&&"AuthRetryableFetchError"===e.name}class Ar extends wr{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class Ir extends wr{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Rr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Dr=" \t\n\r=".split(""),$r=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<Dr.length;t+=1)e[Dr[t].charCodeAt(0)]=-2;for(let t=0;t<Rr.length;t+=1)e[Rr[t].charCodeAt(0)]=t;return e})();function Ur(e,t,s){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(Rr[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(Rr[e]),t.queuedBits-=6}}function Lr(e,t,s){const r=$r[e];if(!(r>-1)){if(-2===r)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function zr(e){const t=[],s=e=>{t.push(String.fromCodePoint(e))},r={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},n=e=>{!function(e,t,s){if(0===t.utf8seq){if(e<=127)return void s(e);for(let s=1;s<6;s+=1)if(!(e>>7-s&1)){t.utf8seq=s;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&s(t.codepoint)}}(e,r,s)};for(let i=0;i<e.length;i+=1)Lr(e.charCodeAt(i),a,n);return t.join("")}function Br(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}t(e)}function Fr(e){const t=[],s={queue:0,queuedBits:0},r=e=>{t.push(e)};for(let a=0;a<e.length;a+=1)Lr(e.charCodeAt(a),s,r);return new Uint8Array(t)}function Mr(e){const t=[];return function(e,t){for(let s=0;s<e.length;s+=1){let r=e.charCodeAt(s);if(r>55295&&r<=56319){const t=1024*(r-55296)&65535;r=65536+(e.charCodeAt(s+1)-56320&65535|t),s+=1}Br(r,t)}}(e,e=>t.push(e)),new Uint8Array(t)}function qr(e){const t=[],s={queue:0,queuedBits:0},r=e=>{t.push(e)};return e.forEach(e=>Ur(e,s,r)),Ur(null,s,r),t.join("")}const Kr=()=>"undefined"!=typeof window&&"undefined"!=typeof document,Jr={tested:!1,writable:!1},Wr=()=>{if(!Kr())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(t){return!1}if(Jr.tested)return Jr.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Jr.tested=!0,Jr.writable=!0}catch(t){Jr.tested=!0,Jr.writable=!1}return Jr.writable},Hr=e=>{let s;return s=e||("undefined"==typeof fetch?(...e)=>Be(()=>u(t,null,function*(){const{default:e}=yield Promise.resolve().then(()=>ot);return{default:e}}),void 0).then(({default:t})=>t(...e)):fetch),(...e)=>s(...e)},Gr=(e,s,r)=>u(t,null,function*(){yield e.setItem(s,JSON.stringify(r))}),Vr=(e,s)=>u(t,null,function*(){const t=yield e.getItem(s);if(!t)return null;try{return JSON.parse(t)}catch(r){return t}}),Yr=(e,s)=>u(t,null,function*(){yield e.removeItem(s)});class Xr{constructor(){this.promise=new Xr.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function Zr(e){const t=e.split(".");if(3!==t.length)throw new Ir("Invalid JWT structure");for(let s=0;s<t.length;s++)if(!fr.test(t[s]))throw new Ir("JWT not in base64url format");return{header:JSON.parse(zr(t[0])),payload:JSON.parse(zr(t[1])),signature:Fr(t[2]),raw:{header:t[0],payload:t[1]}}}function Qr(e){return("0"+e.toString(16)).substr(-2)}function ea(e){return u(this,null,function*(){if("undefined"==typeof crypto||void 0===crypto.subtle||"undefined"==typeof TextEncoder)return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=yield function(e){return u(this,null,function*(){const t=(new TextEncoder).encode(e),s=yield crypto.subtle.digest("SHA-256",t),r=new Uint8Array(s);return Array.from(r).map(e=>String.fromCharCode(e)).join("")})}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")})}function ta(e,t,s=!1){return u(this,null,function*(){const r=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let s="";for(let r=0;r<56;r++)s+=e.charAt(Math.floor(Math.random()*t));return s}return crypto.getRandomValues(e),Array.from(e,Qr).join("")}();let a=r;s&&(a+="/PASSWORD_RECOVERY"),yield Gr(e,`${t}-code-verifier`,a);const n=yield ea(r);return[n,r===n?"plain":"s256"]})}Xr.promiseConstructor=Promise;const sa=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i,ra=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function aa(e){if(!ra.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function na(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"==typeof t){const e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function ia(e){return JSON.parse(JSON.stringify(e))}const oa=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),la=[502,503,504];function ca(e){return u(this,null,function*(){var t,s;if(!("object"==typeof(s=e)&&null!==s&&"status"in s&&"ok"in s&&"json"in s&&"function"==typeof s.json))throw new Tr(oa(e),0);if(la.includes(e.status))throw new Tr(oa(e),e.status);let r,a;try{r=yield e.json()}catch(i){throw new jr(oa(i),i)}const n=function(e){const t=e.headers.get(pr);if(!t)return null;if(!t.match(sa))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(i){return null}}(e);if(n&&n.getTime()>=gr.timestamp&&"object"==typeof r&&r&&"string"==typeof r.code?a=r.code:"object"==typeof r&&r&&"string"==typeof r.error_code&&(a=r.error_code),a){if("weak_password"===a)throw new Ar(oa(r),e.status,(null===(t=r.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===a)throw new Nr}else if("object"==typeof r&&r&&"object"==typeof r.weak_password&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0))throw new Ar(oa(r),e.status,r.weak_password.reasons);throw new yr(oa(r),e.status||500,a)})}function da(e,t,s,r){return u(this,null,function*(){var a;const n=Object.assign({},null==r?void 0:r.headers);n[pr]||(n[pr]=gr.name),(null==r?void 0:r.jwt)&&(n.Authorization=`Bearer ${r.jwt}`);const i=null!==(a=null==r?void 0:r.query)&&void 0!==a?a:{};(null==r?void 0:r.redirectTo)&&(i.redirect_to=r.redirectTo);const o=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",l=yield function(e,t,s,r,a,n){return u(this,null,function*(){const i=((e,t,s,r)=>{const a={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),a.body=JSON.stringify(r),Object.assign(Object.assign({},a),s))})(t,r,a,n);let o;try{o=yield e(s,Object.assign({},i))}catch(l){throw console.error(l),new Tr(oa(l),0)}if(o.ok||(yield ca(o)),null==r?void 0:r.noResolveJson)return o;try{return yield o.json()}catch(l){yield ca(l)}})}(e,t,s+o,{headers:n,noResolveJson:null==r?void 0:r.noResolveJson},{},null==r?void 0:r.body);return(null==r?void 0:r.xform)?null==r?void 0:r.xform(l):{data:Object.assign({},l),error:null}})}function ua(e){var t;let s=null;var r;return function(e){return e.access_token&&e.refresh_token&&e.expires_in}(e)&&(s=Object.assign({},e),e.expires_at||(s.expires_at=(r=e.expires_in,Math.round(Date.now()/1e3)+r))),{data:{session:s,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function ha(e){const t=ua(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function ma(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function pa(e){return{data:e,error:null}}function ga(e){const{action_link:t,email_otp:s,hashed_token:r,redirect_to:a,verification_type:n}=e,i=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(s[r[a]]=e[r[a]])}return s}(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:s,hashed_token:r,redirect_to:a,verification_type:n},user:Object.assign({},i)},error:null}}function fa(e){return e}const xa=["global","local","others"];class ba{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Hr(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}signOut(e){return u(this,arguments,function*(e,t=xa[0]){if(xa.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${xa.join(", ")}`);try{return yield da(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(br(s))return{data:null,error:s};throw s}})}inviteUserByEmail(e){return u(this,arguments,function*(e,t={}){try{return yield da(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:ma})}catch(s){if(br(s))return{data:{user:null},error:s};throw s}})}generateLink(e){return u(this,null,function*(){try{const{options:t}=e,s=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(s[r[a]]=e[r[a]])}return s}(e,["options"]),r=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(r.new_email=null==s?void 0:s.newEmail,delete r.newEmail),yield da(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:ga,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(br(t))return{data:{properties:null,user:null},error:t};throw t}})}createUser(e){return u(this,null,function*(){try{return yield da(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ma})}catch(t){if(br(t))return{data:{user:null},error:t};throw t}})}listUsers(e){return u(this,null,function*(){var t,s,r,a,n,i,o;try{const l={nextPage:null,lastPage:0,total:0},c=yield da(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(s=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==s?s:"",per_page:null!==(a=null===(r=null==e?void 0:e.perPage)||void 0===r?void 0:r.toString())&&void 0!==a?a:""},xform:fa});if(c.error)throw c.error;const d=yield c.json(),u=null!==(n=c.headers.get("x-total-count"))&&void 0!==n?n:0,h=null!==(o=null===(i=c.headers.get("link"))||void 0===i?void 0:i.split(","))&&void 0!==o?o:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),s=JSON.parse(e.split(";")[1].split("=")[1]);l[`${s}Page`]=t}),l.total=parseInt(u)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(br(l))return{data:{users:[]},error:l};throw l}})}getUserById(e){return u(this,null,function*(){aa(e);try{return yield da(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ma})}catch(t){if(br(t))return{data:{user:null},error:t};throw t}})}updateUserById(e,t){return u(this,null,function*(){aa(e);try{return yield da(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:ma})}catch(s){if(br(s))return{data:{user:null},error:s};throw s}})}deleteUser(e,t=!1){return u(this,null,function*(){aa(e);try{return yield da(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:ma})}catch(s){if(br(s))return{data:{user:null},error:s};throw s}})}_listFactors(e){return u(this,null,function*(){aa(e.userId);try{const{data:t,error:s}=yield da(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:s}}catch(t){if(br(t))return{data:null,error:t};throw t}})}_deleteFactor(e){return u(this,null,function*(){aa(e.userId),aa(e.id);try{return{data:yield da(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(br(t))return{data:null,error:t};throw t}})}_listOAuthClients(e){return u(this,null,function*(){var t,s,r,a,n,i,o;try{const l={nextPage:null,lastPage:0,total:0},c=yield da(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(s=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==s?s:"",per_page:null!==(a=null===(r=null==e?void 0:e.perPage)||void 0===r?void 0:r.toString())&&void 0!==a?a:""},xform:fa});if(c.error)throw c.error;const d=yield c.json(),u=null!==(n=c.headers.get("x-total-count"))&&void 0!==n?n:0,h=null!==(o=null===(i=c.headers.get("link"))||void 0===i?void 0:i.split(","))&&void 0!==o?o:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),s=JSON.parse(e.split(";")[1].split("=")[1]);l[`${s}Page`]=t}),l.total=parseInt(u)),{data:Object.assign(Object.assign({},d),l),error:null}}catch(l){if(br(l))return{data:{clients:[]},error:l};throw l}})}_createOAuthClient(e){return u(this,null,function*(){try{return yield da(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(br(t))return{data:null,error:t};throw t}})}_getOAuthClient(e){return u(this,null,function*(){try{return yield da(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(br(t))return{data:null,error:t};throw t}})}_deleteOAuthClient(e){return u(this,null,function*(){try{return yield da(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(br(t))return{data:null,error:t};throw t}})}_regenerateOAuthClientSecret(e){return u(this,null,function*(){try{return yield da(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(br(t))return{data:null,error:t};throw t}})}}function ya(e={}){return{getItem:t=>e[t]||null,setItem:(t,s)=>{e[t]=s},removeItem:t=>{delete e[t]}}}const va={debug:!!(globalThis&&Wr()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"))};class ja extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class wa extends ja{}function Na(e,t,s){return u(this,null,function*(){va.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const r=new globalThis.AbortController;return t>0&&setTimeout(()=>{r.abort(),va.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),yield Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},r=>u(this,null,function*(){if(!r){if(0===t)throw va.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new wa(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(va.debug)try{const e=yield globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(a){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",a)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),yield s()}va.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,r.name);try{return yield s()}finally{va.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,r.name)}})))})}function ka(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function Sa(e){const t=(new TextEncoder).encode(e);return"0x"+Array.from(t,e=>e.toString(16).padStart(2,"0")).join("")}class _a extends Error{constructor({message:e,code:t,cause:s,name:r}){var a;super(e,{cause:s}),this.__isWebAuthnError=!0,this.name=null!==(a=null!=r?r:s instanceof Error?s.name:void 0)&&void 0!==a?a:"Unknown Error",this.code=t}}class Pa extends _a{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function Ea({error:e,options:t}){var s,r,a;const{publicKey:n}=t;if(!n)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new _a({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if("ConstraintError"===e.name){if(!0===(null===(s=n.authenticatorSelection)||void 0===s?void 0:s.requireResidentKey))return new _a({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if("conditional"===t.mediation&&"required"===(null===(r=n.authenticatorSelection)||void 0===r?void 0:r.userVerification))return new _a({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if("required"===(null===(a=n.authenticatorSelection)||void 0===a?void 0:a.userVerification))return new _a({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if("InvalidStateError"===e.name)return new _a({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if("NotAllowedError"===e.name)return new _a({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if("NotSupportedError"===e.name)return 0===n.pubKeyCredParams.filter(e=>"public-key"===e.type).length?new _a({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new _a({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if("SecurityError"===e.name){const t=window.location.hostname;if(!$a(t))return new _a({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(n.rp.id!==t)return new _a({message:`The RP ID "${n.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("TypeError"===e.name){if(n.user.id.byteLength<1||n.user.id.byteLength>64)return new _a({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if("UnknownError"===e.name)return new _a({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new _a({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function Ca({error:e,options:t}){const{publicKey:s}=t;if(!s)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new _a({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if("NotAllowedError"===e.name)return new _a({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if("SecurityError"===e.name){const t=window.location.hostname;if(!$a(t))return new _a({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(s.rpId!==t)return new _a({message:`The RP ID "${s.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("UnknownError"===e.name)return new _a({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new _a({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}var Ta=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(s[r[a]]=e[r[a]])}return s};const Oa=new class{createNewAbortSignal(){if(this.controller){const e=new Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}};function Aa(e){if(!e)throw new Error("Credential creation options are required");if("undefined"!=typeof PublicKeyCredential&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseCreationOptionsFromJSON)return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:s,excludeCredentials:r}=e,a=Ta(e,["challenge","user","excludeCredentials"]),n=Fr(t).buffer,i=Object.assign(Object.assign({},s),{id:Fr(s.id).buffer}),o=Object.assign(Object.assign({},a),{challenge:n,user:i});if(r&&r.length>0){o.excludeCredentials=new Array(r.length);for(let e=0;e<r.length;e++){const t=r[e];o.excludeCredentials[e]=Object.assign(Object.assign({},t),{id:Fr(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return o}function Ia(e){if(!e)throw new Error("Credential request options are required");if("undefined"!=typeof PublicKeyCredential&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseRequestOptionsFromJSON)return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:s}=e,r=Ta(e,["challenge","allowCredentials"]),a=Fr(t).buffer,n=Object.assign(Object.assign({},r),{challenge:a});if(s&&s.length>0){n.allowCredentials=new Array(s.length);for(let e=0;e<s.length;e++){const t=s[e];n.allowCredentials[e]=Object.assign(Object.assign({},t),{id:Fr(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return n}function Ra(e){var t;if("toJSON"in e&&"function"==typeof e.toJSON)return e.toJSON();const s=e;return{id:e.id,rawId:e.id,response:{attestationObject:qr(new Uint8Array(e.response.attestationObject)),clientDataJSON:qr(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:null!==(t=s.authenticatorAttachment)&&void 0!==t?t:void 0}}function Da(e){var t;if("toJSON"in e&&"function"==typeof e.toJSON)return e.toJSON();const s=e,r=e.getClientExtensionResults(),a=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:qr(new Uint8Array(a.authenticatorData)),clientDataJSON:qr(new Uint8Array(a.clientDataJSON)),signature:qr(new Uint8Array(a.signature)),userHandle:a.userHandle?qr(new Uint8Array(a.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:null!==(t=s.authenticatorAttachment)&&void 0!==t?t:void 0}}function $a(e){return"localhost"===e||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function Ua(){var e,t;return!!(Kr()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&"function"==typeof(null===(e=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===e?void 0:e.create)&&"function"==typeof(null===(t=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===t?void 0:t.get))}const La={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},za={userVerification:"preferred",hints:["security-key"]};function Ba(...e){const t=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),s=e=>e instanceof ArrayBuffer||ArrayBuffer.isView(e),r={};for(const a of e)if(a)for(const e in a){const n=a[e];if(void 0!==n)if(Array.isArray(n))r[e]=n;else if(s(n))r[e]=n;else if(t(n)){const s=r[e];t(s)?r[e]=Ba(s,n):r[e]=Ba(n)}else r[e]=n}return r}class Fa{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}_enroll(e){return u(this,null,function*(){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))})}_challenge(e,t){return u(this,arguments,function*({factorId:e,webauthn:t,friendlyName:s,signal:r},a){try{const{data:n,error:i}=yield this.client.mfa.challenge({factorId:e,webauthn:t});if(!n)return{data:null,error:i};const o=null!=r?r:Oa.createNewAbortSignal();if("create"===n.webauthn.type){const{user:e}=n.webauthn.credential_options.publicKey;e.name||(e.name=`${e.id}:${s}`),e.displayName||(e.displayName=e.name)}switch(n.webauthn.type){case"create":{const t=function(e,t){return Ba(La,e,t||{})}(n.webauthn.credential_options.publicKey,null==a?void 0:a.create),{data:s,error:r}=yield function(e){return u(this,null,function*(){try{const t=yield navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Pa("Browser returned unexpected credential type",t)}:{data:null,error:new Pa("Empty credential response",t)}}catch(t){return{data:null,error:Ea({error:t,options:e})}}})}({publicKey:t,signal:o});return s?{data:{factorId:e,challengeId:n.id,webauthn:{type:n.webauthn.type,credential_response:s}},error:null}:{data:null,error:r}}case"request":{const t=function(e,t){return Ba(za,e,t||{})}(n.webauthn.credential_options.publicKey,null==a?void 0:a.request),{data:s,error:r}=yield function(e){return u(this,null,function*(){try{const t=yield navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Pa("Browser returned unexpected credential type",t)}:{data:null,error:new Pa("Empty credential response",t)}}catch(t){return{data:null,error:Ca({error:t,options:e})}}})}(Object.assign(Object.assign({},n.webauthn.credential_options),{publicKey:t,signal:o}));return s?{data:{factorId:e,challengeId:n.id,webauthn:{type:n.webauthn.type,credential_response:s}},error:null}:{data:null,error:r}}}}catch(n){return br(n)?{data:null,error:n}:{data:null,error:new jr("Unexpected error in challenge",n)}}})}_verify(e){return u(this,arguments,function*({challengeId:e,factorId:t,webauthn:s}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:s})})}_authenticate(e,t){return u(this,arguments,function*({factorId:e,webauthn:{rpId:t=("undefined"!=typeof window?window.location.hostname:void 0),rpOrigins:s=("undefined"!=typeof window?[window.location.origin]:void 0),signal:r}},a){if(!t)return{data:null,error:new xr("rpId is required for WebAuthn authentication")};try{if(!Ua())return{data:null,error:new jr("Browser does not support WebAuthn",null)};const{data:n,error:i}=yield this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:s},signal:r},{request:a});if(!n)return{data:null,error:i};const{webauthn:o}=n;return this._verify({factorId:e,challengeId:n.challengeId,webauthn:{type:o.type,rpId:t,rpOrigins:s,credential_response:o.credential_response}})}catch(n){return br(n)?{data:null,error:n}:{data:null,error:new jr("Unexpected error in authenticate",n)}}})}_register(e,t){return u(this,arguments,function*({friendlyName:e,rpId:t=("undefined"!=typeof window?window.location.hostname:void 0),rpOrigins:s=("undefined"!=typeof window?[window.location.origin]:void 0),signal:r},a){if(!t)return{data:null,error:new xr("rpId is required for WebAuthn registration")};try{if(!Ua())return{data:null,error:new jr("Browser does not support WebAuthn",null)};const{data:n,error:i}=yield this._enroll({friendlyName:e});if(!n)return yield this.client.mfa.listFactors().then(t=>{var s;return null===(s=t.data)||void 0===s?void 0:s.all.find(t=>"webauthn"===t.factor_type&&t.friendly_name===e&&"unverified"!==t.status)}).then(e=>e?this.client.mfa.unenroll({factorId:null==e?void 0:e.id}):void 0),{data:null,error:i};const{data:o,error:l}=yield this._challenge({factorId:n.id,friendlyName:n.friendly_name,webauthn:{rpId:t,rpOrigins:s},signal:r},{create:a});return o?this._verify({factorId:n.id,challengeId:o.challengeId,webauthn:{rpId:t,rpOrigins:s,type:o.webauthn.type,credential_response:o.webauthn.credential_response}}):{data:null,error:l}}catch(n){return br(n)?{data:null,error:n}:{data:null,error:new jr("Unexpected error in register",n)}}})}}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const Ma={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:mr,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};function qa(e,t,s){return u(this,null,function*(){return yield s()})}const Ka={};class Ja{get jwks(){var e,t;return null!==(t=null===(e=Ka[this.storageKey])||void 0===e?void 0:e.jwks)&&void 0!==t?t:{keys:[]}}set jwks(e){Ka[this.storageKey]=Object.assign(Object.assign({},Ka[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!==(t=null===(e=Ka[this.storageKey])||void 0===e?void 0:e.cachedAt)&&void 0!==t?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Ka[this.storageKey]=Object.assign(Object.assign({},Ka[this.storageKey]),{cachedAt:e})}constructor(e){var t,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Ja.nextInstanceID,Ja.nextInstanceID+=1,this.instanceID>0&&Kr()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},Ma),e);if(this.logDebugMessages=!!r.debug,"function"==typeof r.debug&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new ba({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=Hr(r.fetch),this.lock=r.lock||qa,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,r.lock?this.lock=r.lock:Kr()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=Na:this.lock=qa,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new Fa(this)},this.persistSession?(r.storage?this.storage=r.storage:Wr()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=ya(this.memoryStorage)),r.userStorage&&(this.userStorage=r.userStorage)):(this.memoryStorage={},this.storage=ya(this.memoryStorage)),Kr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(a){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",a)}null===(s=this.broadcastChannel)||void 0===s||s.addEventListener("message",e=>u(this,null,function*(){this._debug("received broadcast notification from other tab or client",e),yield this._notifyAllSubscribers(e.data.event,e.data.session,!1)}))}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${dr}) ${(new Date).toISOString()}`,...e),this}initialize(){return u(this,null,function*(){return this.initializePromise||(this.initializePromise=(()=>u(this,null,function*(){return yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._initialize()}))}))()),yield this.initializePromise})}_initialize(){return u(this,null,function*(){var e;try{const t=function(e){const t={},s=new URL(e);if(s.hash&&"#"===s.hash[0])try{new URLSearchParams(s.hash.substring(1)).forEach((e,s)=>{t[s]=e})}catch(r){}return s.searchParams.forEach((e,s)=>{t[s]=e}),t}(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":(yield this._isPKCECallback(t))&&(s="pkce"),Kr()&&this.detectSessionInUrl&&"none"!==s){const{data:r,error:a}=yield this._getSessionFromURL(t,s);if(a){if(this._debug("#_initialize()","error detecting session from URL",a),Er(a)){const t=null===(e=a.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:a}}return yield this._removeSession(),{error:a}}const{session:n,redirectType:i}=r;return this._debug("#_initialize()","detected session in URL",n,"redirect type",i),yield this._saveSession(n),setTimeout(()=>u(this,null,function*(){"recovery"===i?yield this._notifyAllSubscribers("PASSWORD_RECOVERY",n):yield this._notifyAllSubscribers("SIGNED_IN",n)}),0),{error:null}}return yield this._recoverAndRefresh(),{error:null}}catch(t){return br(t)?{error:t}:{error:new jr("Unexpected error during initialization",t)}}finally{yield this._handleVisibilityChange(),this._debug("#_initialize()","end")}})}signInAnonymously(e){return u(this,null,function*(){var t,s,r;try{const a=yield da(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(s=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==s?s:{},gotrue_meta_security:{captcha_token:null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken}},xform:ua}),{data:n,error:i}=a;if(i||!n)return{data:{user:null,session:null},error:i};const o=n.session,l=n.user;return n.session&&(yield this._saveSession(n.session),yield this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(a){if(br(a))return{data:{user:null,session:null},error:a};throw a}})}signUp(e){return u(this,null,function*(){var t,s,r;try{let a;if("email"in e){const{email:s,password:r,options:n}=e;let i=null,o=null;"pkce"===this.flowType&&([i,o]=yield ta(this.storage,this.storageKey)),a=yield da(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==n?void 0:n.emailRedirectTo,body:{email:s,password:r,data:null!==(t=null==n?void 0:n.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:i,code_challenge_method:o},xform:ua})}else{if(!("phone"in e))throw new _r("You must provide either an email or phone number and a password");{const{phone:t,password:n,options:i}=e;a=yield da(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:n,data:null!==(s=null==i?void 0:i.data)&&void 0!==s?s:{},channel:null!==(r=null==i?void 0:i.channel)&&void 0!==r?r:"sms",gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:ua})}}const{data:n,error:i}=a;if(i||!n)return{data:{user:null,session:null},error:i};const o=n.session,l=n.user;return n.session&&(yield this._saveSession(n.session),yield this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(a){if(br(a))return{data:{user:null,session:null},error:a};throw a}})}signInWithPassword(e){return u(this,null,function*(){try{let t;if("email"in e){const{email:s,password:r,options:a}=e;t=yield da(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:r,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},xform:ha})}else{if(!("phone"in e))throw new _r("You must provide either an email or phone number and a password");{const{phone:s,password:r,options:a}=e;t=yield da(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:r,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},xform:ha})}}const{data:s,error:r}=t;return r?{data:{user:null,session:null},error:r}:s&&s.session&&s.user?(s.session&&(yield this._saveSession(s.session),yield this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:r}):{data:{user:null,session:null},error:new Sr}}catch(t){if(br(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOAuth(e){return u(this,null,function*(){var t,s,r,a;return yield this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(r=e.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:null===(a=e.options)||void 0===a?void 0:a.skipBrowserRedirect})})}exchangeCodeForSession(e){return u(this,null,function*(){return yield this.initializePromise,this._acquireLock(-1,()=>u(this,null,function*(){return this._exchangeCodeForSession(e)}))})}signInWithWeb3(e){return u(this,null,function*(){const{chain:t}=e;switch(t){case"ethereum":return yield this.signInWithEthereum(e);case"solana":return yield this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}})}signInWithEthereum(e){return u(this,null,function*(){var t,s,r,a,n,i,o,l,c,d,u;let h,m;if("message"in e)h=e.message,m=e.signature;else{const{chain:d,wallet:u,statement:p,options:g}=e;let f;if(Kr())if("object"==typeof u)f=u;else{const e=window;if(!("ethereum"in e)||"object"!=typeof e.ethereum||!("request"in e.ethereum)||"function"!=typeof e.ethereum.request)throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.");f=e.ethereum}else{if("object"!=typeof u||!(null==g?void 0:g.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");f=u}const x=new URL(null!==(t=null==g?void 0:g.url)&&void 0!==t?t:window.location.href),b=yield f.request({method:"eth_requestAccounts"}).then(e=>e).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!b||0===b.length)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const y=ka(b[0]);let v=null===(s=null==g?void 0:g.signInWithEthereum)||void 0===s?void 0:s.chainId;if(!v){const e=yield f.request({method:"eth_chainId"});v=parseInt(e,16)}h=function(e){var t;const{chainId:s,domain:r,expirationTime:a,issuedAt:n=new Date,nonce:i,notBefore:o,requestId:l,resources:c,scheme:d,uri:u,version:h}=e;if(!Number.isInteger(s))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${s}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(i&&i.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${i}`);if(!u)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if("1"!==h)throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(null===(t=e.statement)||void 0===t?void 0:t.includes("\n"))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`);const m=`${d?`${d}://${r}`:r} wants you to sign in with your Ethereum account:\n${ka(e.address)}\n\n${e.statement?`${e.statement}\n`:""}`;let p=`URI: ${u}\nVersion: ${h}\nChain ID: ${s}${i?`\nNonce: ${i}`:""}\nIssued At: ${n.toISOString()}`;if(a&&(p+=`\nExpiration Time: ${a.toISOString()}`),o&&(p+=`\nNot Before: ${o.toISOString()}`),l&&(p+=`\nRequest ID: ${l}`),c){let e="\nResources:";for(const t of c){if(!t||"string"!=typeof t)throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${t}`);e+=`\n- ${t}`}p+=e}return`${m}\n${p}`}({domain:x.host,address:y,statement:p,uri:x.href,version:"1",chainId:v,nonce:null===(r=null==g?void 0:g.signInWithEthereum)||void 0===r?void 0:r.nonce,issuedAt:null!==(n=null===(a=null==g?void 0:g.signInWithEthereum)||void 0===a?void 0:a.issuedAt)&&void 0!==n?n:new Date,expirationTime:null===(i=null==g?void 0:g.signInWithEthereum)||void 0===i?void 0:i.expirationTime,notBefore:null===(o=null==g?void 0:g.signInWithEthereum)||void 0===o?void 0:o.notBefore,requestId:null===(l=null==g?void 0:g.signInWithEthereum)||void 0===l?void 0:l.requestId,resources:null===(c=null==g?void 0:g.signInWithEthereum)||void 0===c?void 0:c.resources}),m=yield f.request({method:"personal_sign",params:[Sa(h),y]})}try{const{data:t,error:s}=yield da(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:h,signature:m},(null===(d=e.options)||void 0===d?void 0:d.captchaToken)?{gotrue_meta_security:{captcha_token:null===(u=e.options)||void 0===u?void 0:u.captchaToken}}:null),xform:ua});if(s)throw s;return t&&t.session&&t.user?(t.session&&(yield this._saveSession(t.session),yield this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign({},t),error:s}):{data:{user:null,session:null},error:new Sr}}catch(p){if(br(p))return{data:{user:null,session:null},error:p};throw p}})}signInWithSolana(e){return u(this,null,function*(){var t,s,r,a,n,i,o,l,c,d,u,h;let m,p;if("message"in e)m=e.message,p=e.signature;else{const{chain:u,wallet:h,statement:g,options:f}=e;let x;if(Kr())if("object"==typeof h)x=h;else{const e=window;if(!("solana"in e)||"object"!=typeof e.solana||!("signIn"in e.solana&&"function"==typeof e.solana.signIn||"signMessage"in e.solana&&"function"==typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");x=e.solana}else{if("object"!=typeof h||!(null==f?void 0:f.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");x=h}const b=new URL(null!==(t=null==f?void 0:f.url)&&void 0!==t?t:window.location.href);if("signIn"in x&&x.signIn){const e=yield x.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==f?void 0:f.signInWithSolana),{version:"1",domain:b.host,uri:b.href}),g?{statement:g}:null));let t;if(Array.isArray(e)&&e[0]&&"object"==typeof e[0])t=e[0];else{if(!(e&&"object"==typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"==typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");m="string"==typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),p=t.signature}else{if(!("signMessage"in x&&"function"==typeof x.signMessage&&"publicKey"in x&&"object"==typeof x&&x.publicKey&&"toBase58"in x.publicKey&&"function"==typeof x.publicKey.toBase58))throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=[`${b.host} wants you to sign in with your Solana account:`,x.publicKey.toBase58(),...g?["",g,""]:[""],"Version: 1",`URI: ${b.href}`,`Issued At: ${null!==(r=null===(s=null==f?void 0:f.signInWithSolana)||void 0===s?void 0:s.issuedAt)&&void 0!==r?r:(new Date).toISOString()}`,...(null===(a=null==f?void 0:f.signInWithSolana)||void 0===a?void 0:a.notBefore)?[`Not Before: ${f.signInWithSolana.notBefore}`]:[],...(null===(n=null==f?void 0:f.signInWithSolana)||void 0===n?void 0:n.expirationTime)?[`Expiration Time: ${f.signInWithSolana.expirationTime}`]:[],...(null===(i=null==f?void 0:f.signInWithSolana)||void 0===i?void 0:i.chainId)?[`Chain ID: ${f.signInWithSolana.chainId}`]:[],...(null===(o=null==f?void 0:f.signInWithSolana)||void 0===o?void 0:o.nonce)?[`Nonce: ${f.signInWithSolana.nonce}`]:[],...(null===(l=null==f?void 0:f.signInWithSolana)||void 0===l?void 0:l.requestId)?[`Request ID: ${f.signInWithSolana.requestId}`]:[],...(null===(d=null===(c=null==f?void 0:f.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===d?void 0:d.length)?["Resources",...f.signInWithSolana.resources.map(e=>`- ${e}`)]:[]].join("\n");const e=yield x.signMessage((new TextEncoder).encode(m),"utf8");if(!(e&&e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=e}}try{const{data:t,error:s}=yield da(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:qr(p)},(null===(u=e.options)||void 0===u?void 0:u.captchaToken)?{gotrue_meta_security:{captcha_token:null===(h=e.options)||void 0===h?void 0:h.captchaToken}}:null),xform:ua});if(s)throw s;return t&&t.session&&t.user?(t.session&&(yield this._saveSession(t.session),yield this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign({},t),error:s}):{data:{user:null,session:null},error:new Sr}}catch(g){if(br(g))return{data:{user:null,session:null},error:g};throw g}})}_exchangeCodeForSession(e){return u(this,null,function*(){const t=yield Vr(this.storage,`${this.storageKey}-code-verifier`),[s,r]=(null!=t?t:"").split("/");try{const{data:t,error:a}=yield da(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:ua});if(yield Yr(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return t&&t.session&&t.user?(t.session&&(yield this._saveSession(t.session),yield this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!=r?r:null}),error:a}):{data:{user:null,session:null,redirectType:null},error:new Sr}}catch(a){if(br(a))return{data:{user:null,session:null,redirectType:null},error:a};throw a}})}signInWithIdToken(e){return u(this,null,function*(){try{const{options:t,provider:s,token:r,access_token:a,nonce:n}=e,i=yield da(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:r,access_token:a,nonce:n,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:ua}),{data:o,error:l}=i;return l?{data:{user:null,session:null},error:l}:o&&o.session&&o.user?(o.session&&(yield this._saveSession(o.session),yield this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:o,error:l}):{data:{user:null,session:null},error:new Sr}}catch(t){if(br(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOtp(e){return u(this,null,function*(){var t,s,r,a,n;try{if("email"in e){const{email:r,options:a}=e;let n=null,i=null;"pkce"===this.flowType&&([n,i]=yield ta(this.storage,this.storageKey));const{error:o}=yield da(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:r,data:null!==(t=null==a?void 0:a.data)&&void 0!==t?t:{},create_user:null===(s=null==a?void 0:a.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken},code_challenge:n,code_challenge_method:i},redirectTo:null==a?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:o}}if("phone"in e){const{phone:t,options:s}=e,{data:i,error:o}=yield da(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(r=null==s?void 0:s.data)&&void 0!==r?r:{},create_user:null===(a=null==s?void 0:s.shouldCreateUser)||void 0===a||a,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},channel:null!==(n=null==s?void 0:s.channel)&&void 0!==n?n:"sms"}});return{data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:o}}throw new _r("You must provide either an email or phone number.")}catch(i){if(br(i))return{data:{user:null,session:null},error:i};throw i}})}verifyOtp(e){return u(this,null,function*(){var t,s;try{let r,a;"options"in e&&(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo,a=null===(s=e.options)||void 0===s?void 0:s.captchaToken);const{data:n,error:i}=yield da(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:a}}),redirectTo:r,xform:ua});if(i)throw i;if(!n)throw new Error("An error occurred on token verification.");const o=n.session,l=n.user;return(null==o?void 0:o.access_token)&&(yield this._saveSession(o),yield this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(r){if(br(r))return{data:{user:null,session:null},error:r};throw r}})}signInWithSSO(e){return u(this,null,function*(){var t,s,r;try{let a=null,n=null;return"pkce"===this.flowType&&([a,n]=yield ta(this.storage,this.storageKey)),yield da(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==s?s:void 0}),(null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:n}),headers:this.headers,xform:pa})}catch(a){if(br(a))return{data:null,error:a};throw a}})}reauthenticate(){return u(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._reauthenticate()}))})}_reauthenticate(){return u(this,null,function*(){try{return yield this._useSession(e=>u(this,null,function*(){const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new Nr;const{error:r}=yield da(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:r}}))}catch(e){if(br(e))return{data:{user:null,session:null},error:e};throw e}})}resend(e){return u(this,null,function*(){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:r,options:a}=e,{error:n}=yield da(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:r,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},redirectTo:null==a?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:n}}if("phone"in e){const{phone:s,type:r,options:a}=e,{data:n,error:i}=yield da(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:r,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}}});return{data:{user:null,session:null,messageId:null==n?void 0:n.message_id},error:i}}throw new _r("You must provide either an email or phone number and a type")}catch(t){if(br(t))return{data:{user:null,session:null},error:t};throw t}})}getSession(){return u(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return this._useSession(e=>u(this,null,function*(){return e}))}))})}_acquireLock(e,t){return u(this,null,function*(){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(()=>u(this,null,function*(){return yield e,yield t()}))();return this.pendingInLock.push((()=>u(this,null,function*(){try{yield s}catch(e){}}))()),s}return yield this.lock(`lock:${this.storageKey}`,e,()=>u(this,null,function*(){this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((()=>u(this,null,function*(){try{yield e}catch(t){}}))()),yield e;this.pendingInLock.length;){const e=[...this.pendingInLock];yield Promise.all(e),this.pendingInLock.splice(0,e.length)}return yield e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this._debug("#_acquireLock","end")}})}_useSession(e){return u(this,null,function*(){this._debug("#_useSession","begin");try{const t=yield this.__loadSession();return yield e(t)}finally{this._debug("#_useSession","end")}})}__loadSession(){return u(this,null,function*(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=yield Vr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),yield this._removeSession())),!e)return{data:{session:null},error:null};const s=!!e.expires_at&&1e3*e.expires_at-Date.now()<hr;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const t=yield Vr(this.userStorage,this.storageKey+"-user");(null==t?void 0:t.user)?e.user=t.user:e.user=na()}if(this.storage.isServer&&e.user){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,s,r)=>(t||"user"!==s||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,s,r))})}return{data:{session:e},error:null}}const{data:r,error:a}=yield this._callRefreshToken(e.refresh_token);return a?{data:{session:null},error:a}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}})}getUser(e){return u(this,null,function*(){return e?yield this._getUser(e):(yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._getUser()})))})}_getUser(e){return u(this,null,function*(){try{return e?yield da(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ma}):yield this._useSession(e=>u(this,null,function*(){var t,s,r;const{data:a,error:n}=e;if(n)throw n;return(null===(t=a.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?yield da(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(r=null===(s=a.session)||void 0===s?void 0:s.access_token)&&void 0!==r?r:void 0,xform:ma}):{data:{user:null},error:new Nr}}))}catch(t){if(br(t))return kr(t)&&(yield this._removeSession(),yield Yr(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}})}updateUser(e){return u(this,arguments,function*(e,t={}){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._updateUser(e,t)}))})}_updateUser(e){return u(this,arguments,function*(e,t={}){try{return yield this._useSession(s=>u(this,null,function*(){const{data:r,error:a}=s;if(a)throw a;if(!r.session)throw new Nr;const n=r.session;let i=null,o=null;"pkce"===this.flowType&&null!=e.email&&([i,o]=yield ta(this.storage,this.storageKey));const{data:l,error:c}=yield da(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:i,code_challenge_method:o}),jwt:n.access_token,xform:ma});if(c)throw c;return n.user=l.user,yield this._saveSession(n),yield this._notifyAllSubscribers("USER_UPDATED",n),{data:{user:n.user},error:null}}))}catch(s){if(br(s))return{data:{user:null},error:s};throw s}})}setSession(e){return u(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._setSession(e)}))})}_setSession(e){return u(this,null,function*(){try{if(!e.access_token||!e.refresh_token)throw new Nr;const t=Date.now()/1e3;let s=t,r=!0,a=null;const{payload:n}=Zr(e.access_token);if(n.exp&&(s=n.exp,r=s<=t),r){const{data:t,error:s}=yield this._callRefreshToken(e.refresh_token);if(s)return{data:{user:null,session:null},error:s};if(!t)return{data:{user:null,session:null},error:null};a=t}else{const{data:r,error:n}=yield this._getUser(e.access_token);if(n)throw n;a={access_token:e.access_token,refresh_token:e.refresh_token,user:r.user,token_type:"bearer",expires_in:s-t,expires_at:s},yield this._saveSession(a),yield this._notifyAllSubscribers("SIGNED_IN",a)}return{data:{user:a.user,session:a},error:null}}catch(t){if(br(t))return{data:{session:null,user:null},error:t};throw t}})}refreshSession(e){return u(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._refreshSession(e)}))})}_refreshSession(e){return u(this,null,function*(){try{return yield this._useSession(t=>u(this,null,function*(){var s;if(!e){const{data:r,error:a}=t;if(a)throw a;e=null!==(s=r.session)&&void 0!==s?s:void 0}if(!(null==e?void 0:e.refresh_token))throw new Nr;const{data:r,error:a}=yield this._callRefreshToken(e.refresh_token);return a?{data:{user:null,session:null},error:a}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}}))}catch(t){if(br(t))return{data:{user:null,session:null},error:t};throw t}})}_getSessionFromURL(e,t){return u(this,null,function*(){try{if(!Kr())throw new Pr("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Pr(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new Cr("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new Pr("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Cr("No code detected.");const{data:t,error:s}=yield this._exchangeCodeForSession(e.code);if(s)throw s;const r=new URL(window.location.href);return r.searchParams.delete("code"),window.history.replaceState(window.history.state,"",r.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:r,access_token:a,refresh_token:n,expires_in:i,expires_at:o,token_type:l}=e;if(!(a&&i&&n&&l))throw new Pr("No session defined in URL");const c=Math.round(Date.now()/1e3),d=parseInt(i);let u=c+d;o&&(u=parseInt(o));const h=u-c;1e3*h<=ur&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${d}s`);const m=u-d;c-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,u,c):c-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,u,c);const{data:p,error:g}=yield this._getUser(a);if(g)throw g;const f={provider_token:s,provider_refresh_token:r,access_token:a,expires_in:d,expires_at:u,refresh_token:n,token_type:l,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:f,redirectType:e.type},error:null}}catch(s){if(br(s))return{data:{session:null,redirectType:null},error:s};throw s}})}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}_isPKCECallback(e){return u(this,null,function*(){const t=yield Vr(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)})}signOut(){return u(this,arguments,function*(e={scope:"global"}){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._signOut(e)}))})}_signOut(){return u(this,arguments,function*({scope:e}={scope:"global"}){return yield this._useSession(t=>u(this,null,function*(){var s;const{data:r,error:a}=t;if(a)return{error:a};const n=null===(s=r.session)||void 0===s?void 0:s.access_token;if(n){const{error:t}=yield this.admin.signOut(n,e);if(t&&(!vr(t)||404!==t.status&&401!==t.status&&403!==t.status))return{error:t}}return"others"!==e&&(yield this._removeSession(),yield Yr(this.storage,`${this.storageKey}-code-verifier`)),{error:null}}))})}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(()=>{u(this,null,function*(){yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){this._emitInitialSession(t)}))})})(),{data:{subscription:s}}}_emitInitialSession(e){return u(this,null,function*(){return yield this._useSession(t=>u(this,null,function*(){var s,r;try{const{data:{session:r},error:a}=t;if(a)throw a;yield null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",r),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(a){yield null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",null),this._debug("INITIAL_SESSION","callback id",e,"error",a),console.error(a)}}))})}resetPasswordForEmail(e){return u(this,arguments,function*(e,t={}){let s=null,r=null;"pkce"===this.flowType&&([s,r]=yield ta(this.storage,this.storageKey,!0));try{return yield da(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(a){if(br(a))return{data:null,error:a};throw a}})}getUserIdentities(){return u(this,null,function*(){var e;try{const{data:t,error:s}=yield this.getUser();if(s)throw s;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(t){if(br(t))return{data:null,error:t};throw t}})}linkIdentity(e){return u(this,null,function*(){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)})}linkIdentityOAuth(e){return u(this,null,function*(){var t;try{const{data:s,error:r}=yield this._useSession(t=>u(this,null,function*(){var s,r,a,n,i;const{data:o,error:l}=t;if(l)throw l;const c=yield this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(s=e.options)||void 0===s?void 0:s.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(a=e.options)||void 0===a?void 0:a.queryParams,skipBrowserRedirect:!0});return yield da(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(i=null===(n=o.session)||void 0===n?void 0:n.access_token)&&void 0!==i?i:void 0})}));if(r)throw r;return Kr()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==s?void 0:s.url),{data:{provider:e.provider,url:null==s?void 0:s.url},error:null}}catch(s){if(br(s))return{data:{provider:e.provider,url:null},error:s};throw s}})}linkIdentityIdToken(e){return u(this,null,function*(){return yield this._useSession(t=>u(this,null,function*(){var s;try{const{error:r,data:{session:a}}=t;if(r)throw r;const{options:n,provider:i,token:o,access_token:l,nonce:c}=e,d=yield da(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:null!==(s=null==a?void 0:a.access_token)&&void 0!==s?s:void 0,body:{provider:i,id_token:o,access_token:l,nonce:c,link_identity:!0,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:ua}),{data:u,error:h}=d;return h?{data:{user:null,session:null},error:h}:u&&u.session&&u.user?(u.session&&(yield this._saveSession(u.session),yield this._notifyAllSubscribers("USER_UPDATED",u.session)),{data:u,error:h}):{data:{user:null,session:null},error:new Sr}}catch(r){if(br(r))return{data:{user:null,session:null},error:r};throw r}}))})}unlinkIdentity(e){return u(this,null,function*(){try{return yield this._useSession(t=>u(this,null,function*(){var s,r;const{data:a,error:n}=t;if(n)throw n;return yield da(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(r=null===(s=a.session)||void 0===s?void 0:s.access_token)&&void 0!==r?r:void 0})}))}catch(t){if(br(t))return{data:null,error:t};throw t}})}_refreshAccessToken(e){return u(this,null,function*(){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return yield function(e,t){return new Promise((s,r)=>{(()=>{u(this,null,function*(){for(let n=0;n<1/0;n++)try{const r=yield e(n);if(!t(n,null,r))return void s(r)}catch(a){if(!t(n,a))return void r(a)}})})()})}(s=>u(this,null,function*(){return s>0&&(yield function(e){return u(this,null,function*(){return yield new Promise(t=>{setTimeout(()=>t(null),e)})})}(200*Math.pow(2,s-1))),this._debug(t,"refreshing attempt",s),yield da(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:ua})}),(e,t)=>{const r=200*Math.pow(2,e);return t&&Or(t)&&Date.now()+r-s<ur})}catch(s){if(this._debug(t,"error",s),br(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}})}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}_handleProviderSignIn(e,t){return u(this,null,function*(){const s=yield this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),Kr()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}})}_recoverAndRefresh(){return u(this,null,function*(){var e,t;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const a=yield Vr(this.storage,this.storageKey);if(a&&this.userStorage){let t=yield Vr(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||t||(t={user:a.user},yield Gr(this.userStorage,this.storageKey+"-user",t)),a.user=null!==(e=null==t?void 0:t.user)&&void 0!==e?e:na()}else if(a&&!a.user&&!a.user){const e=yield Vr(this.storage,this.storageKey+"-user");e&&(null==e?void 0:e.user)?(a.user=e.user,yield Yr(this.storage,this.storageKey+"-user"),yield Gr(this.storage,this.storageKey,a)):a.user=na()}if(this._debug(s,"session from storage",a),!this._isValidSession(a))return this._debug(s,"session is not valid"),void(null!==a&&(yield this._removeSession()));const n=1e3*(null!==(t=a.expires_at)&&void 0!==t?t:1/0)-Date.now()<hr;if(this._debug(s,`session has${n?"":" not"} expired with margin of 90000s`),n){if(this.autoRefreshToken&&a.refresh_token){const{error:e}=yield this._callRefreshToken(a.refresh_token);e&&(console.error(e),Or(e)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",e),yield this._removeSession()))}}else if(a.user&&!0===a.user.__isUserNotAvailableProxy)try{const{data:e,error:t}=yield this._getUser(a.access_token);!t&&(null==e?void 0:e.user)?(a.user=e.user,yield this._saveSession(a),yield this._notifyAllSubscribers("SIGNED_IN",a)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(r){console.error("Error getting user data:",r),this._debug(s,"error getting user data, skipping SIGNED_IN notification",r)}else yield this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){return this._debug(s,"error",a),void console.error(a)}finally{this._debug(s,"end")}})}_callRefreshToken(e){return u(this,null,function*(){var t,s;if(!e)throw new Nr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new Xr;const{data:t,error:s}=yield this._refreshAccessToken(e);if(s)throw s;if(!t.session)throw new Nr;yield this._saveSession(t.session),yield this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const r={data:t.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(a){if(this._debug(r,"error",a),br(a)){const e={data:null,error:a};return Or(a)||(yield this._removeSession()),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(s=this.refreshingDeferred)||void 0===s||s.reject(a),a}finally{this.refreshingDeferred=null,this._debug(r,"end")}})}_notifyAllSubscribers(e,t,s=!0){return u(this,null,function*(){const r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const r=[],a=Array.from(this.stateChangeEmitters.values()).map(s=>u(this,null,function*(){try{yield s.callback(e,t)}catch(a){r.push(a)}}));if(yield Promise.all(a),r.length>0){for(let e=0;e<r.length;e+=1)console.error(r[e]);throw r[0]}}finally{this._debug(r,"end")}})}_saveSession(e){return u(this,null,function*(){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),s=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!s&&t.user&&(yield Gr(this.userStorage,this.storageKey+"-user",{user:t.user}));const e=Object.assign({},t);delete e.user;const r=ia(e);yield Gr(this.storage,this.storageKey,r)}else{const e=ia(t);yield Gr(this.storage,this.storageKey,e)}})}_removeSession(){return u(this,null,function*(){this._debug("#_removeSession()"),yield Yr(this.storage,this.storageKey),yield Yr(this.storage,this.storageKey+"-code-verifier"),yield Yr(this.storage,this.storageKey+"-user"),this.userStorage&&(yield Yr(this.userStorage,this.storageKey+"-user")),yield this._notifyAllSubscribers("SIGNED_OUT",null)})}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Kr()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}_startAutoRefresh(){return u(this,null,function*(){yield this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),ur);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout(()=>u(this,null,function*(){yield this.initializePromise,yield this._autoRefreshTokenTick()}),0)})}_stopAutoRefresh(){return u(this,null,function*(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)})}startAutoRefresh(){return u(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._startAutoRefresh()})}stopAutoRefresh(){return u(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._stopAutoRefresh()})}_autoRefreshTokenTick(){return u(this,null,function*(){this._debug("#_autoRefreshTokenTick()","begin");try{yield this._acquireLock(0,()=>u(this,null,function*(){try{const t=Date.now();try{return yield this._useSession(e=>u(this,null,function*(){const{data:{session:s}}=e;if(!s||!s.refresh_token||!s.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const r=Math.floor((1e3*s.expires_at-t)/ur);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),r<=3&&(yield this._callRefreshToken(s.refresh_token))}))}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}catch(e){if(!(e.isAcquireTimeout||e instanceof ja))throw e;this._debug("auto refresh token tick lock not available")}})}_handleVisibilityChange(){return u(this,null,function*(){if(this._debug("#_handleVisibilityChange()"),!Kr()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=()=>u(this,null,function*(){return yield this._onVisibilityChanged(!1)}),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),yield this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}})}_onVisibilityChanged(e){return u(this,null,function*(){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){"visible"===document.visibilityState?yield this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")})))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()})}_getUrlForProvider(e,t,s){return u(this,null,function*(){const r=[`provider=${encodeURIComponent(t)}`];if((null==s?void 0:s.redirectTo)&&r.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),(null==s?void 0:s.scopes)&&r.push(`scopes=${encodeURIComponent(s.scopes)}`),"pkce"===this.flowType){const[e,t]=yield ta(this.storage,this.storageKey),s=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});r.push(s.toString())}if(null==s?void 0:s.queryParams){const e=new URLSearchParams(s.queryParams);r.push(e.toString())}return(null==s?void 0:s.skipBrowserRedirect)&&r.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${r.join("&")}`})}_unenroll(e){return u(this,null,function*(){try{return yield this._useSession(t=>u(this,null,function*(){var s;const{data:r,error:a}=t;return a?{data:null,error:a}:yield da(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token})}))}catch(t){if(br(t))return{data:null,error:t};throw t}})}_enroll(e){return u(this,null,function*(){try{return yield this._useSession(t=>u(this,null,function*(){var s,r;const{data:a,error:n}=t;if(n)return{data:null,error:n};const i=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:"totp"===e.factorType?{issuer:e.issuer}:{}),{data:o,error:l}=yield da(this.fetch,"POST",`${this.url}/factors`,{body:i,headers:this.headers,jwt:null===(s=null==a?void 0:a.session)||void 0===s?void 0:s.access_token});return l?{data:null,error:l}:("totp"===e.factorType&&"totp"===o.type&&(null===(r=null==o?void 0:o.totp)||void 0===r?void 0:r.qr_code)&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})}))}catch(t){if(br(t))return{data:null,error:t};throw t}})}_verify(e){return u(this,null,function*(){return this._acquireLock(-1,()=>u(this,null,function*(){try{return yield this._useSession(t=>u(this,null,function*(){var s;const{data:r,error:a}=t;if(a)return{data:null,error:a};const n=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:"create"===e.webauthn.type?Ra(e.webauthn.credential_response):Da(e.webauthn.credential_response)})}:{code:e.code}),{data:i,error:o}=yield da(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:n,headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token});return o?{data:null,error:o}:(yield this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),yield this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:o})}))}catch(t){if(br(t))return{data:null,error:t};throw t}}))})}_challenge(e){return u(this,null,function*(){return this._acquireLock(-1,()=>u(this,null,function*(){try{return yield this._useSession(t=>u(this,null,function*(){var s;const{data:r,error:a}=t;if(a)return{data:null,error:a};const n=yield da(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token});if(n.error)return n;const{data:i}=n;if("webauthn"!==i.type)return{data:i,error:null};switch(i.webauthn.type){case"create":return{data:Object.assign(Object.assign({},i),{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_options:Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:Aa(i.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},i),{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_options:Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:Ia(i.webauthn.credential_options.publicKey)})})}),error:null}}}))}catch(t){if(br(t))return{data:null,error:t};throw t}}))})}_challengeAndVerify(e){return u(this,null,function*(){const{data:t,error:s}=yield this._challenge({factorId:e.factorId});return s?{data:null,error:s}:yield this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})})}_listFactors(){return u(this,null,function*(){var e;const{data:{user:t},error:s}=yield this.getUser();if(s)return{data:null,error:s};const r={all:[],phone:[],totp:[],webauthn:[]};for(const a of null!==(e=null==t?void 0:t.factors)&&void 0!==e?e:[])r.all.push(a),"verified"===a.status&&r[a.factor_type].push(a);return{data:r,error:null}})}_getAuthenticatorAssuranceLevel(){return u(this,null,function*(){return this._acquireLock(-1,()=>u(this,null,function*(){return yield this._useSession(e=>u(this,null,function*(){var t,s;const{data:{session:r},error:a}=e;if(a)return{data:null,error:a};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:n}=Zr(r.access_token);let i=null;n.aal&&(i=n.aal);let o=i;return(null!==(s=null===(t=r.user.factors)||void 0===t?void 0:t.filter(e=>"verified"===e.status))&&void 0!==s?s:[]).length>0&&(o="aal2"),{data:{currentLevel:i,nextLevel:o,currentAuthenticationMethods:n.amr||[]},error:null}}))}))})}fetchJwk(e){return u(this,arguments,function*(e,t={keys:[]}){let s=t.keys.find(t=>t.kid===e);if(s)return s;const r=Date.now();if(s=this.jwks.keys.find(t=>t.kid===e),s&&this.jwks_cached_at+6e5>r)return s;const{data:a,error:n}=yield da(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(n)throw n;return a.keys&&0!==a.keys.length?(this.jwks=a,this.jwks_cached_at=r,s=a.keys.find(t=>t.kid===e),s||null):null})}getClaims(e){return u(this,arguments,function*(e,t={}){try{let s=e;if(!s){const{data:e,error:t}=yield this.getSession();if(t||!e.session)return{data:null,error:t};s=e.session.access_token}const{header:r,payload:a,signature:n,raw:{header:i,payload:o}}=Zr(s);(null==t?void 0:t.allowExpired)||function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(a.exp);const l=r.alg&&!r.alg.startsWith("HS")&&r.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?yield this.fetchJwk(r.kid,(null==t?void 0:t.keys)?{keys:t.keys}:null==t?void 0:t.jwks):null;if(!l){const{error:e}=yield this.getUser(s);if(e)throw e;return{data:{claims:a,header:r,signature:n},error:null}}const c=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(r.alg),d=yield crypto.subtle.importKey("jwk",l,c,!0,["verify"]);if(!(yield crypto.subtle.verify(c,d,n,Mr(`${i}.${o}`))))throw new Ir("Invalid JWT signature");return{data:{claims:a,header:r,signature:n},error:null}}catch(s){if(br(s))return{data:null,error:s};throw s}})}}Ja.nextInstanceID=0;const Wa=Ja;class Ha extends Wa{constructor(e){super(e)}}var Ga=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{l(r.next(e))}catch(t){n(t)}}function o(e){try{l(r.throw(e))}catch(t){n(t)}}function l(e){e.done?a(e.value):function(e){return e instanceof s?e:new s(function(t){t(e)})}(e.value).then(i,o)}l((r=r.apply(e,t||[])).next())})};class Va{constructor(e,t,s){var r,a,n;this.supabaseUrl=e,this.supabaseKey=t;const i=function(e){const t=null==e?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL((s=t).endsWith("/")?s:s+"/")}catch(r){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}var s}(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const o=`sb-${i.hostname.split(".")[0]}-auth-token`,l=function(e,t){var s,r;const{db:a,auth:n,realtime:i,global:o}=e,{db:l,auth:c,realtime:d,global:u}=t,h={db:Object.assign(Object.assign({},l),a),auth:Object.assign(Object.assign({},c),n),realtime:Object.assign(Object.assign({},d),i),storage:{},global:Object.assign(Object.assign(Object.assign({},u),o),{headers:Object.assign(Object.assign({},null!==(s=null==u?void 0:u.headers)&&void 0!==s?s:{}),null!==(r=null==o?void 0:o.headers)&&void 0!==r?r:{})}),accessToken:()=>cr(this,void 0,void 0,function*(){return""})};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}(null!=s?s:{},{db:ar,realtime:ir,auth:Object.assign(Object.assign({},nr),{storageKey:o}),global:rr});this.storageKey=null!==(r=l.auth.storageKey)&&void 0!==r?r:"",this.headers=null!==(a=l.global.headers)&&void 0!==a?a:{},l.accessToken?(this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(n=l.auth)&&void 0!==n?n:{},this.headers,l.global.fetch),this.fetch=lr(t,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.rest=new It(new URL("rest/v1",i).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new tr(this.storageUrl.href,this.headers,this.fetch,null==s?void 0:s.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new Ge(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){return Ga(this,void 0,void 0,function*(){var e,t;if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return null!==(t=null===(e=s.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,userStorage:a,storageKey:n,flowType:i,lock:o,debug:l},c,d){const u={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Ha({url:this.authUrl.href,headers:Object.assign(Object.assign({},u),c),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,userStorage:a,flowType:i,lock:o,debug:l,fetch:d,hasCustomAuthorizationHeader:Object.keys(this.headers).some(e=>"authorization"===e.toLowerCase())})}_initRealtimeClient(e){return new _s(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,s){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===s?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):(this.changedAccessToken=s,this.realtime.setAuth(s))}}const Ya=(e,t,s)=>new Va(e,t,s);(function(){if("undefined"!=typeof window)return!1;if("undefined"==typeof process)return!1;const e=process.version;if(null==e)return!1;const t=e.match(/^v(\d+)\./);return!!t&&parseInt(t[1],10)<=18})()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Xa=Object.freeze(Object.defineProperty({__proto__:null,AuthApiError:yr,AuthClient:Wa,AuthError:xr,AuthImplicitGrantRedirectError:Pr,AuthInvalidCredentialsError:_r,AuthInvalidJwtError:Ir,AuthInvalidTokenResponseError:Sr,AuthPKCEGrantCodeExchangeError:Cr,AuthRetryableFetchError:Tr,AuthSessionMissingError:Nr,AuthUnknownError:jr,AuthWeakPasswordError:Ar,CustomAuthError:wr,get FunctionRegion(){return Je},FunctionsError:Fe,FunctionsFetchError:Me,FunctionsHttpError:Ke,FunctionsRelayError:qe,GoTrueAdminApi:ba,GoTrueClient:Ja,NavigatorLockAcquireTimeoutError:wa,PostgrestError:Lt,get REALTIME_LISTEN_TYPES(){return gs},get REALTIME_POSTGRES_CHANGES_LISTEN_EVENT(){return ms},get REALTIME_PRESENCE_LISTEN_EVENTS(){return us},get REALTIME_SUBSCRIBE_STATES(){return xs},RealtimeChannel:vs,RealtimeClient:_s,RealtimePresence:ys,SIGN_OUT_SCOPES:xa,SupabaseClient:Va,WebSocketFactory:zt,createClient:Ya,isAuthApiError:vr,isAuthError:br,isAuthImplicitGrantRedirectError:Er,isAuthRetryableFetchError:Or,isAuthSessionMissingError:kr,lockInternals:va,navigatorLock:Na},Symbol.toStringTag,{value:"Module"})),Za=Ya("https://zlnmfcxdysitmxztprcg.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inpsbm1mY3hkeXNpdG14enRwcmNnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3NTc0NjksImV4cCI6MjA3NjMzMzQ2OX0.0DWlDCN4C3MEibjyjMs7bDE9Y8K-P8vmqED02sOMqaE"),Qa={customer:{name:"Siti Aminah",email:"customer@azzahra.com",password:"customer123",role:"customer",points:0},reseller:{name:"Fatimah Zahra",email:"reseller@azzahra.com",password:"reseller123",role:"reseller",points:1250},admin:{name:"Admin Azzahra",email:"admin@azzahra.com",password:"admin123",role:"admin",points:0},owner:{name:"Owner Azzahra",email:"owner@azzahra.com",password:"owner123",role:"owner",points:0}},en=()=>{const[e,s]=h.useState(null),[r,a]=h.useState(!0);return h.useEffect(()=>{u(t,null,function*(){var e,t;try{const r=localStorage.getItem("temp_user_session");if(r){const e=JSON.parse(r);return console.log("🔄 Found temporary local session:",e.name),s(e),void a(!1)}const{data:{session:n}}=yield Za.auth.getSession();if(null==n?void 0:n.user){const{data:r}=yield Za.from("profiles").select("*").eq("id",n.user.id).single();if(r)s(r),console.log("✅ User session restored from Supabase:",r.name,r.role);else{const r={id:n.user.id,name:(null==(e=n.user.user_metadata)?void 0:e.name)||"User",email:n.user.email||"",role:(null==(t=n.user.user_metadata)?void 0:t.role)||"customer",phone:null,points:0},{data:a}=yield Za.from("profiles").insert(r).select().single();a&&(s(a),console.log("✅ New user profile created:",a.name))}}else console.log("ℹ️ No active Supabase session found")}catch(r){console.error("❌ Error initializing auth:",r)}finally{a(!1)}});const{data:{subscription:e}}=Za.auth.onAuthStateChange((e,r)=>u(t,null,function*(){var t,a;if("SIGNED_IN"===e&&(null==r?void 0:r.user))try{const{data:e}=yield Za.from("profiles").select("*").eq("id",r.user.id).single();if(e)s(e),console.log("✅ User signed in:",e.name);else{const e={id:r.user.id,name:(null==(t=r.user.user_metadata)?void 0:t.name)||"User",email:r.user.email||"",role:(null==(a=r.user.user_metadata)?void 0:a.role)||"customer",phone:null,points:0},{data:n}=yield Za.from("profiles").insert(e).select().single();n&&(s(n),console.log("✅ New user profile created on sign in:",n.name))}}catch(n){console.error("❌ Error handling sign in:",n)}else"SIGNED_OUT"===e&&(s(null),localStorage.removeItem("temp_user_session"),console.log("✅ User signed out"))}));return()=>e.unsubscribe()},[]),{user:e,loading:r,login:(e,r)=>u(t,null,function*(){try{const t=Object.values(Qa).find(t=>t.email===e&&t.password===r);if(!t)return{success:!1,error:"Email atau password salah"};if(console.log("🔄 Attempting login for:",t.email),e.includes("@azzahra.com")&&("owner@azzahra.com"===e||"admin@azzahra.com"===e)){console.log("🔄 Using local fallback for Azzahra domain emails");const e={id:"local-"+t.email.replace("@","-"),name:t.name,email:t.email,role:t.role,points:t.points,created_at:(new Date).toISOString(),phone:void 0};return localStorage.setItem("temp_user_session",JSON.stringify(e)),localStorage.setItem("azzahra_current_user",JSON.stringify(e)),s(e),{success:!0,data:e}}const{error:a}=yield Za.auth.signInWithPassword({email:t.email,password:t.password});if(a){if(console.log("ℹ️ Sign in failed, trying sign up:",a.message),a.message.includes("Invalid login credentials")||a.message.includes("Email not confirmed")||a.message.includes("email address")||a.message.includes("invalid")){console.log("🔄 Using local fallback due to Supabase auth issues");const e={id:"local-"+t.email.replace("@","-"),name:t.name,email:t.email,role:t.role,points:t.points,created_at:(new Date).toISOString(),phone:void 0};return localStorage.setItem("temp_user_session",JSON.stringify(e)),localStorage.setItem("azzahra_current_user",JSON.stringify(e)),s(e),{success:!0,data:e}}throw a}return console.log("✅ Login successful:",t.name),{success:!0,data:t}}catch(t){return console.error("❌ Login error:",t),t.message.includes("you can only request this after")?{success:!1,error:"Terlalu banyak percobaan login. Silakan coba lagi beberapa saat."}:{success:!1,error:t.message}}}),logout:()=>u(t,null,function*(){try{const{error:e}=yield Za.auth.signOut();return e?(console.error("❌ Logout error:",e),{success:!1,error:e.message}):(localStorage.removeItem("temp_user_session"),localStorage.removeItem("azzahra_current_user"),console.log("✅ Logout successful"),{success:!0})}catch(e){return console.error("❌ Logout error:",e),{success:!1,error:e.message}}}),ensureDummyProfiles:()=>u(t,null,function*(){try{for(const[e,t]of Object.entries(Qa)){const{data:s}=yield Za.from("profiles").select("*").eq("email",t.email).single();if(!s){const{error:s}=yield Za.from("profiles").insert({id:`dummy-${e}`,name:t.name,email:t.email,role:t.role,points:t.points,phone:null});s?console.error(`❌ Error creating dummy profile for ${t.email}:`,s):console.log(`✅ Dummy profile created for ${t.email}`)}}}catch(e){console.error("❌ Error ensuring dummy profiles:",e)}})}},tn=({onBack:e,onSuccess:s})=>{const[r,a]=h.useState({name:"",email:"",password:"",confirmPassword:"",role:"owner",phone:""}),[n,i]=h.useState(!1),[o,l]=h.useState(!1),[m,p]=h.useState(!1),[g,f]=h.useState(""),[b,y]=h.useState(!1),v=(e,t)=>{a(s=>d(c({},s),{[e]:t})),f("")};return b?Ne.jsx("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 to-purple-50 flex items-center justify-center p-4",children:Ne.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 max-w-md w-full text-center",children:[Ne.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:Ne.jsx(B,{className:"w-8 h-8 text-green-600"})}),Ne.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Registrasi Berhasil!"}),Ne.jsxs("p",{className:"text-gray-600 mb-4",children:["Akun ","owner"===r.role?"Owner":"Admin"," telah dibuat"]}),Ne.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-4",children:Ne.jsxs("p",{className:"text-sm text-gray-600",children:[Ne.jsx("strong",{children:"Nama:"})," ",r.name,Ne.jsx("br",{}),Ne.jsx("strong",{children:"Email:"})," ",r.email,Ne.jsx("br",{}),Ne.jsx("strong",{children:"Role:"})," ","owner"===r.role?"Owner":"Admin"]})}),Ne.jsx("p",{className:"text-sm text-green-600",children:"Sedang mengalihkan ke dashboard..."})]})}):Ne.jsx("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 to-purple-50 flex items-center justify-center p-4",children:Ne.jsxs("div",{className:"bg-white rounded-2xl shadow-xl p-8 max-w-md w-full",children:[Ne.jsxs("button",{onClick:e,className:"mb-6 flex items-center text-gray-600 hover:text-gray-800 transition-colors",children:[Ne.jsx(E,{className:"w-4 h-4 mr-2"}),"Kembali"]}),Ne.jsxs("div",{className:"text-center mb-6",children:[Ne.jsx("div",{className:"w-16 h-16 bg-gradient-to-r from-pink-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4",children:Ne.jsx(F,{className:"w-8 h-8 text-white"})}),Ne.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Registrasi Owner/Admin"}),Ne.jsx("p",{className:"text-gray-600",children:"Buat akun Owner atau Admin dengan email valid"})]}),Ne.jsxs("form",{onSubmit:e=>u(t,null,function*(){var a,n,i;if(e.preventDefault(),f(""),p(!0),r.name.trim()?(i=r.email,!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i)||i.includes("@azzahra.com")?(f("Gunakan email yang valid (Gmail/Yahoo/etc). Email @azzahra.com tidak diperbolehkan."),0):r.password.length<6?(f("Password minimal 6 karakter"),0):r.password===r.confirmPassword||(f("Password tidak cocok"),0)):(f("Nama harus diisi"),0))try{const{createClient:e}=yield Be(()=>u(t,null,function*(){const{createClient:e}=yield Promise.resolve().then(()=>Xa);return{createClient:e}}),void 0),i=e("https://zlnmfcxdysitmxztprcg.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inpsbm1mY3hkeXNpdG14enRwcmNnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3NTc0NjksImV4cCI6MjA3NjMzMzQ2OX0.0DWlDCN4C3MEibjyjMs7bDE9Y8K-P8vmqED02sOMqaE");console.log("🔄 Creating Supabase user account...");const{data:o,error:l}=yield i.auth.signUp({email:r.email,password:r.password,options:{data:{name:r.name,role:r.role,phone:r.phone||null}}});if(l)throw new Error(`Gagal membuat akun: ${l.message}`);if(console.log("✅ Supabase auth user created:",null==(a=o.user)?void 0:a.id),yield new Promise(e=>setTimeout(e,1e3)),o.user){const e={id:o.user.id,name:r.name,email:r.email,role:r.role,phone:r.phone||null,points:0},{error:t}=yield i.from("profiles").insert(e);t?console.error("⚠️ Profile creation error:",t):console.log("✅ Profile created successfully")}y(!0),console.log("✅ Registration successful for:",r.name,r.role);const c={id:(null==(n=o.user)?void 0:n.id)||`temp-${Date.now()}`,name:r.name,email:r.email,role:r.role,phone:r.phone||null,points:0,created_at:(new Date).toISOString()};localStorage.setItem("temp_user_session",JSON.stringify(c)),localStorage.setItem("azzahra_current_user",JSON.stringify(c)),setTimeout(()=>{s(c)},2e3)}catch(o){console.error("❌ Registration error:",o),f(o.message||"Terjadi kesalahan saat registrasi")}finally{p(!1)}else p(!1)}),className:"space-y-4",children:[Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pilih Role"}),Ne.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[Ne.jsxs("button",{type:"button",onClick:()=>v("role","owner"),className:"p-3 rounded-lg border-2 transition-all "+("owner"===r.role?"border-red-500 bg-red-50 text-red-700":"border-gray-200 hover:border-gray-300"),children:[Ne.jsx(M,{className:"w-5 h-5 mx-auto mb-1"}),Ne.jsx("span",{className:"text-sm font-medium",children:"Owner"})]}),Ne.jsxs("button",{type:"button",onClick:()=>v("role","admin"),className:"p-3 rounded-lg border-2 transition-all "+("admin"===r.role?"border-purple-500 bg-purple-50 text-purple-700":"border-gray-200 hover:border-gray-300"),children:[Ne.jsx(x,{className:"w-5 h-5 mx-auto mb-1"}),Ne.jsx("span",{className:"text-sm font-medium",children:"Admin"})]})]})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nama Lengkap"}),Ne.jsx("input",{type:"text",value:r.name,onChange:e=>v("name",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Masukkan nama lengkap",required:!0})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email (Gmail/Yahoo)"}),Ne.jsxs("div",{className:"relative",children:[Ne.jsx(q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),Ne.jsx("input",{type:"email",value:r.email,onChange:e=>v("email",e.target.value),className:"w-full pl-10 pr-3 p-3 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 "+(r.email&&r.email.includes("@azzahra.com")?"border-red-300 bg-red-50":"border-gray-300"),placeholder:"nama@gmail.com",required:!0})]}),r.email&&r.email.includes("@azzahra.com")&&Ne.jsxs("p",{className:"mt-1 text-xs text-red-600 flex items-center",children:[Ne.jsx(K,{className:"w-3 h-3 mr-1"}),"Gunakan email Gmail/Yahoo, bukan @azzahra.com"]})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"No. Telepon (Opsional)"}),Ne.jsx("input",{type:"tel",value:r.phone,onChange:e=>v("phone",e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"08123456789"})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),Ne.jsxs("div",{className:"relative",children:[Ne.jsx(J,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),Ne.jsx("input",{type:n?"text":"password",value:r.password,onChange:e=>v("password",e.target.value),className:"w-full pl-10 pr-10 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Minimal 6 karakter",required:!0}),Ne.jsx("button",{type:"button",onClick:()=>i(!n),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:n?Ne.jsx(W,{className:"w-5 h-5"}):Ne.jsx(H,{className:"w-5 h-5"})})]})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password"}),Ne.jsxs("div",{className:"relative",children:[Ne.jsx(J,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),Ne.jsx("input",{type:o?"text":"password",value:r.confirmPassword,onChange:e=>v("confirmPassword",e.target.value),className:"w-full pl-10 pr-10 p-3 border rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 "+(r.confirmPassword&&r.password!==r.confirmPassword?"border-red-300 bg-red-50":"border-gray-300"),placeholder:"Ulangi password",required:!0}),Ne.jsx("button",{type:"button",onClick:()=>l(!o),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:o?Ne.jsx(W,{className:"w-5 h-5"}):Ne.jsx(H,{className:"w-5 h-5"})})]}),r.confirmPassword&&r.password!==r.confirmPassword&&Ne.jsx("p",{className:"mt-1 text-xs text-red-600",children:"Password tidak cocok"})]}),g&&Ne.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:Ne.jsxs("p",{className:"text-sm text-red-600 flex items-center",children:[Ne.jsx(K,{className:"w-4 h-4 mr-2"}),g]})}),Ne.jsx("button",{type:"submit",disabled:m,className:"w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-lg font-medium hover:from-pink-600 hover:to-purple-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:m?Ne.jsxs("div",{className:"flex items-center justify-center",children:[Ne.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Mendaftarkan..."]}):"Daftar Sekarang"}),Ne.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:Ne.jsxs("p",{className:"text-xs text-blue-600",children:[Ne.jsx("strong",{children:"Catatan:"})," Gunakan email yang valid (Gmail, Yahoo, dll) agar bisa login ke Supabase. Email @azzahra.com tidak akan berfungsi."]})})]})]})})},sn=({onSuccess:e,onClose:s})=>{const[r,a]=h.useState("customer"),[n,i]=h.useState(!1),[o,l]=h.useState(!1),{login:c}=en(),d={customer:{id:"1",name:"Siti Aminah",email:"customer@azzahra.com",password:"customer123",role:"customer",points:0},reseller:{id:"2",name:"Fatimah Zahra",email:"reseller@azzahra.com",password:"reseller123",role:"reseller",points:1250},admin:{id:"3",name:"Admin Azzahra",email:"admin@azzahra.com",password:"admin123",role:"admin",points:0},owner:{id:"4",name:"Owner Azzahra",email:"owner@azzahra.com",password:"owner123",role:"owner",points:0}},m=t=>{l(!1),e(t),s()};return o?Ne.jsx(tn,{onBack:()=>l(!1),onSuccess:m}):Ne.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:Ne.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md relative",children:[Ne.jsx("button",{onClick:s,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600",children:Ne.jsx(G,{size:24})}),Ne.jsxs("div",{className:"text-center mb-6",children:[Ne.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Login Demo"}),Ne.jsx("p",{className:"text-sm text-gray-600",children:"Pilih role untuk testing"})]}),Ne.jsxs("div",{className:"space-y-3 mb-6",children:[Ne.jsx("button",{onClick:()=>a("customer"),className:"w-full p-4 border-2 rounded-lg text-left transition-all "+("customer"===r?"border-green-500 bg-green-50":"border-gray-200 hover:border-gray-300"),children:Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:Ne.jsx(k,{className:"w-5 h-5 text-green-600"})}),Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800",children:"Customer"}),Ne.jsx("p",{className:"text-sm text-gray-600",children:"Siti Aminah - Harga Retail"}),Ne.jsx("p",{className:"text-xs text-gray-500",children:"customer@azzahrafashion.com"})]}),"customer"===r&&Ne.jsx("div",{className:"w-4 h-4 bg-green-500 rounded-full"})]})}),Ne.jsx("button",{onClick:()=>a("reseller"),className:"w-full p-4 border-2 rounded-lg text-left transition-all "+("reseller"===r?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:Ne.jsx(k,{className:"w-5 h-5 text-blue-600"})}),Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800",children:"Reseller"}),Ne.jsx("p",{className:"text-sm text-gray-600",children:"Fatimah Zahra - Harga Reseller"}),Ne.jsx("p",{className:"text-xs text-gray-500",children:"reseller@azzahrafashion.com"}),Ne.jsx("p",{className:"text-xs text-blue-600 font-medium",children:"Points: 1,250"})]}),"reseller"===r&&Ne.jsx("div",{className:"w-4 h-4 bg-blue-500 rounded-full"})]})}),Ne.jsx("button",{onClick:()=>a("admin"),className:"w-full p-4 border-2 rounded-lg text-left transition-all "+("admin"===r?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300"),children:Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:Ne.jsx(k,{className:"w-5 h-5 text-purple-600"})}),Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800",children:"Admin"}),Ne.jsx("p",{className:"text-sm text-gray-600",children:"Admin Azzahra - Limited Access"}),Ne.jsx("p",{className:"text-xs text-gray-500",children:"admin@azzahrafashion.com"}),Ne.jsx("p",{className:"text-xs text-purple-600 font-medium",children:"Order Management"})]}),"admin"===r&&Ne.jsx("div",{className:"w-4 h-4 bg-purple-500 rounded-full"})]})}),Ne.jsx("button",{onClick:()=>a("owner"),className:"w-full p-4 border-2 rounded-lg text-left transition-all "+("owner"===r?"border-red-500 bg-red-50":"border-gray-200 hover:border-gray-300"),children:Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:Ne.jsx(k,{className:"w-5 h-5 text-red-600"})}),Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800",children:"Owner"}),Ne.jsx("p",{className:"text-sm text-gray-600",children:"Owner Azzahra - Full Access"}),Ne.jsx("p",{className:"text-xs text-gray-500",children:"owner@azzahrafashion.com"}),Ne.jsx("p",{className:"text-xs text-red-600 font-medium",children:"Full Dashboard Access"})]}),"owner"===r&&Ne.jsx("div",{className:"w-4 h-4 bg-red-500 rounded-full"})]})})]}),Ne.jsx("button",{onClick:()=>{return s=r,u(t,null,function*(){i(!0);try{const t=d[s];console.log("🔄 Attempting login to Supabase:",t.email);const r=yield c(t.email,t.password);r.success?(console.log("✅ Login successful via Supabase:",t.name),e(t)):(console.error("❌ Login failed:",r.error),alert("Login gagal: "+r.error))}catch(t){console.error("❌ Login error:",t),alert("Terjadi kesalahan saat login: "+t.message)}i(!1)});var s},disabled:n,className:"w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 px-4 rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed font-semibold transition-all",children:n?"Memproses...":"Login sebagai "+("customer"===r?"Customer":"reseller"===r?"Reseller":"admin"===r?"Admin":"Owner")}),Ne.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[Ne.jsxs("button",{onClick:()=>l(!0),className:"w-full bg-gradient-to-r from-red-500 to-orange-500 text-white py-3 px-4 rounded-lg hover:from-red-600 hover:to-orange-600 font-semibold transition-all flex items-center justify-center space-x-2",children:[Ne.jsx(M,{className:"w-5 h-5"}),Ne.jsx("span",{children:"Registrasi Owner/Admin Real"}),Ne.jsx(F,{className:"w-4 h-4"})]}),Ne.jsx("p",{className:"text-xs text-gray-500 text-center mt-2",children:"Buat akun Owner/Admin dengan email Gmail/Yahoo untuk login Supabase"})]}),Ne.jsx("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:Ne.jsxs("p",{className:"text-xs text-gray-600 text-center",children:[Ne.jsx("strong",{children:"Demo Mode:"})," Pilih role untuk test fitur berbeda"]})})]})})},rn="azzahra-flashsale",an=({user:e,cartItems:t,products:s,loading:r,onProductClick:a,onCartClick:n,onAddToCart:i})=>{const{timeLeft:o}=(()=>{const[e,t]=h.useState(null),[s,r]=h.useState(""),[a,n]=h.useState(!1);return h.useEffect(()=>{if(!a)try{const s=localStorage.getItem(rn);if(s)try{const e=JSON.parse(s);if(!(e&&"object"==typeof e&&"isActive"in e&&"endTime"in e))throw console.warn("⚠️ Invalid flash sale config structure, using default"),new Error("Invalid config structure");t(e),console.log("✅ Flash sale config loaded successfully from localStorage"),console.log("📅 Flash sale ends at:",e.endTime),console.log("⏰ Current time:",(new Date).toISOString())}catch(e){throw console.warn("⚠️ Failed to parse flash sale config:",e),e}else console.log("📝 No flash sale config found in localStorage"),console.log("ℹ️ Please create flash sale from admin dashboard first")}catch(e){console.error("🚨 Error initializing flash sale:",e)}finally{n(!0)}},[a]),h.useEffect(()=>{if(!e||!e.isActive)return;const s=setInterval(()=>{const s=(new Date).getTime(),a=new Date(e.endTime).getTime()-s;if(!(a>0)){console.log("⏰ Flash sale has ended!"),t(e=>e?d(c({},e),{isActive:!1}):null),localStorage.removeItem(rn);const e=localStorage.getItem("azzahra_products");if(e)try{const t=JSON.parse(e).map(e=>d(c({},e),{isFlashSale:!1,flashSalePrice:void 0,flashSaleDiscount:void 0,originalRetailPrice:e.originalRetailPrice||e.retailPrice,retailPrice:e.originalRetailPrice||e.retailPrice}));localStorage.setItem("azzahra_products",JSON.stringify(t)),console.log("🧹 Cleaned flash sale from products:",t.length,"products")}catch(n){console.error("Error cleaning products after flash sale:",n)}return window.dispatchEvent(new CustomEvent("flashSaleEnded",{detail:{timestamp:(new Date).toISOString(),reason:"time_expired"}})),void(window.flashSaleRefreshTimer||(window.flashSaleRefreshTimer=setTimeout(()=>{console.log("🔄 Auto-refreshing page after flash sale cleanup"),window.location.reload()},2e3)))}{const e=Math.floor(a/864e5),t=Math.floor(a%864e5/36e5),s=Math.floor(a%36e5/6e4),n=Math.floor(a%6e4/1e3);r(e>0?`${e} hari ${t} jam ${s} menit`:t>0?`${t} jam ${s} menit ${n} detik`:`${s} menit ${n} detik`)}},1e3);return()=>clearInterval(s)},[e]),{flashSaleConfig:e,timeLeft:s,isFlashSaleActive:(null==e?void 0:e.isActive)||!1,startFlashSale:e=>{const s=d(c({},e),{isActive:!0});t(s),localStorage.setItem(rn,JSON.stringify(s))},stopFlashSale:()=>{if(e){const s=d(c({},e),{isActive:!1});t(s),localStorage.removeItem(rn)}},isProductInFlashSale:t=>{var s;if(!(null==e?void 0:e.isActive))return!1;const r=e.products.includes(t),a=(null==(s=e.productIds)?void 0:s.includes(t))||!1;return r||a}}})(),[l,u]=h.useState(0);h.useEffect(()=>{const e=e=>{var t;console.log("🔄 Flash sale ended event received:",e.detail),console.log("🔄 Updating FlashSalePage..."),u(e=>e+1),"time_expired"===(null==(t=e.detail)?void 0:t.reason)&&(window.flashSaleRefreshTimer&&clearTimeout(window.flashSaleRefreshTimer),window.flashSaleRefreshTimer=setTimeout(()=>{console.log("🔄 Auto-refreshing FlashSalePage after time expired"),window.location.reload()},3e3))};window.addEventListener("flashSaleEnded",e);const t=()=>{console.log("🔄 Flash sale updated event received"),u(e=>e+1)};return window.addEventListener("flashSaleUpdated",t),()=>{window.removeEventListener("flashSaleEnded",e),window.removeEventListener("flashSaleUpdated",t)}},[]),h.useEffect(()=>{const e=()=>{try{const e=localStorage.getItem("azzahra-flashsale");if(e){const t=JSON.parse(e);if(t&&t.isActive){const e=(new Date).getTime();e>=new Date(t.endTime).getTime()&&(console.log("⏰ FlashSalePage: Flash sale ended, triggering cleanup"),window.dispatchEvent(new CustomEvent("flashSaleEnded",{detail:{timestamp:(new Date).toISOString(),reason:"time_expired_page_check",source:"FlashSalePage"}})),localStorage.removeItem("azzahra-flashsale"),t.isActive=!1,u(e=>e+1))}}}catch(e){console.error("Error in FlashSalePage real-time check:",e)}};e();const t=setInterval(e,2e3);return()=>clearInterval(t)},[]),h.useEffect(()=>{const e=e=>{console.log("Products updated in FlashSalePage:",e.detail),u(e=>e+1)};return window.addEventListener("productsUpdated",e),()=>{window.removeEventListener("productsUpdated",e)}},[]);const m=e=>{i(e)},p=h.useMemo(()=>{try{if(!Array.isArray(s)||0===s.length)return console.warn("⚠️ FlashSale: Products array is empty or invalid"),[];const t=s.filter(e=>e&&e.id&&e.name);let r;try{const e=localStorage.getItem("azzahra-flashsale");if(r=e?JSON.parse(e):null,r&&r.isActive){const e=(new Date).getTime(),t=new Date(r.endTime).getTime();e<new Date(r.startTime).getTime()?(console.log("⏰ Flash sale has not started yet"),r.isActive=!1):e>=t&&(console.log("⏰ Flash sale has ended! Deactivating..."),r.isActive=!1,localStorage.removeItem("azzahra-flashsale"))}}catch(e){console.warn("⚠️ Error parsing flash sale config:",e),r=null}return t.filter(t=>{try{if(!t||!t.id)return console.warn("⚠️ Invalid product found:",t),!1;let e=!1;if(!0===t.isFlashSale&&(e=!0),r&&!0===r.isActive){const s=Array.isArray(r.products)&&r.products.includes(t.id),a=Array.isArray(r.productIds)&&r.productIds.includes(t.id);(s||a)&&(e=!0)}return e&&console.log(`✅ Product ${t.name} (${t.id}) is in flash sale`),e}catch(e){return console.warn("⚠️ Error checking flash sale for product:",t.id,e),!1}})}catch(t){return console.error("🚨 Error in flashSaleProducts calculation:",t),[]}},[s,l,o]);return r?Ne.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center",children:Ne.jsx("div",{className:"text-white text-xl",children:"Loading flash sale products..."})}):0===p.length?Ne.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900",children:Ne.jsxs("div",{className:"container mx-auto px-4 py-8",children:[Ne.jsxs("div",{className:"flex items-center justify-between mb-8",children:[Ne.jsx("h1",{className:"text-xl font-bold text-white",children:"Flash Sale ⚡"}),Ne.jsxs("button",{onClick:n,className:"relative p-2 bg-white/20 rounded-full hover:bg-white/30 transition-colors",children:[Ne.jsx(b,{className:"w-6 h-6 text-white"}),t.length>0&&Ne.jsx("span",{className:"absolute -top-2 -right-2 bg-yellow-400 text-gray-800 text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold",children:t.length})]})]}),Ne.jsx("div",{className:"text-center py-20",children:Ne.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-2xl p-12 max-w-2xl mx-auto",children:[Ne.jsx("div",{className:"text-6xl mb-6",children:"⚡"}),Ne.jsx("h2",{className:"text-4xl font-bold text-white mb-4",children:"Flash Sale Segera Hadir!"}),Ne.jsx("p",{className:"text-xl text-white/80 mb-8",children:"Tunggu flash sale kami selanjutnya dengan diskon hingga 70%"}),Ne.jsx("div",{className:"bg-yellow-400 text-gray-800 px-8 py-4 rounded-full inline-block font-bold text-lg",children:"🔥 Coming Soon 🔥"})]})})]})}):Ne.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 pb-20",children:Ne.jsxs("div",{className:"container mx-auto px-4 py-8",children:[Ne.jsxs("div",{className:"flex items-center justify-between mb-6",children:[Ne.jsx("h1",{className:"text-xl font-bold text-white",children:"Flash Sale ⚡"}),Ne.jsxs("button",{onClick:n,className:"relative p-2 bg-white/20 rounded-full hover:bg-white/30 transition-colors",children:[Ne.jsx(b,{className:"w-6 h-6 text-white"}),t.length>0&&Ne.jsx("span",{className:"absolute -top-2 -right-2 bg-yellow-400 text-gray-800 text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold",children:t.length})]})]}),Ne.jsxs("div",{className:"bg-gradient-to-r from-red-600 to-orange-600 rounded-2xl p-8 mb-6 text-center relative overflow-hidden",children:[Ne.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-yellow-400 rounded-full -mr-16 -mt-16 opacity-20"}),Ne.jsx("div",{className:"absolute bottom-0 left-0 w-40 h-40 bg-yellow-400 rounded-full -ml-20 -mb-20 opacity-20"}),Ne.jsxs("div",{className:"relative z-10",children:[Ne.jsxs("div",{className:"flex items-center justify-center mb-4",children:[Ne.jsx(V,{className:"w-12 h-12 text-yellow-300 mr-3"}),Ne.jsx("h1",{className:"text-4xl font-bold text-white",children:"FLASH SALE"}),Ne.jsx(V,{className:"w-12 h-12 text-yellow-300 ml-3"})]}),Ne.jsx("p",{className:"text-xl text-white/90 mb-6",children:"Diskon Hingga 70%"}),o&&Ne.jsxs("div",{className:"bg-black/30 backdrop-blur-sm rounded-xl p-4 mb-4",children:[Ne.jsx("p",{className:"text-yellow-300 text-sm mb-2",children:"⏰ Flash Sale Berakhir Dalam"}),Ne.jsx("div",{className:"text-3xl font-bold text-white tracking-wider",children:o})]}),Ne.jsxs("div",{className:"flex items-center justify-center space-x-4 text-white/80",children:[Ne.jsxs("div",{className:"flex items-center",children:[Ne.jsx(Y,{className:"w-5 h-5 mr-1"}),Ne.jsx("span",{className:"text-sm",children:"Terbatas"})]}),Ne.jsxs("div",{className:"flex items-center",children:[Ne.jsx(X,{className:"w-5 h-5 mr-1"}),Ne.jsx("span",{className:"text-sm",children:"Diskon Spesial"})]})]})]})]}),Ne.jsxs("div",{className:"text-center text-white/60 text-sm mb-6",children:[p.length," produk flash sale tersedia"]}),Ne.jsx("div",{className:"grid grid-cols-2 gap-4",children:p.map(t=>Ne.jsx(Te,{product:t,onProductClick:a,onAddToCart:m,isFlashSale:!0,user:e},t.id))})]})})},nn=({user:e})=>{const[s,r]=h.useState("all"),[a,n]=h.useState(null),[i,o]=h.useState(!1),[l,c]=h.useState(null),{orders:d,updateOrderPayment:m}=Ee(),p=e=>{n(e),o(!0)},g=()=>{o(!1),n(null),c(null)},f=(e,t)=>{navigator.clipboard.writeText(e),alert(`✅ Nomor rekening ${t} berhasil disalin!\n\n${e}\na.n. Fahrin`)},x=d.filter(t=>t.userId===(null==e?void 0:e.id)),b="all"===s?x:x.filter(e=>e.status===s),y={pending:{label:"Menunggu Pembayaran",icon:ee,color:"text-orange-600 bg-orange-100"},awaiting_verification:{label:"Menunggu Verifikasi",icon:ee,color:"text-yellow-600 bg-yellow-100"},paid:{label:"Dibayar",icon:B,color:"text-blue-600 bg-blue-100"},processing:{label:"Dikemas",icon:z,color:"text-blue-600 bg-blue-100"},shipped:{label:"Dikirim",icon:Q,color:"text-purple-600 bg-purple-100"},delivered:{label:"Selesai",icon:B,color:"text-green-600 bg-green-100"},cancelled:{label:"Dibatalkan",icon:Z,color:"text-red-600 bg-red-100"}};return Ne.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[Ne.jsxs("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:[Ne.jsx("div",{className:"p-4",children:Ne.jsx("h1",{className:"text-lg font-semibold text-center",children:"Pesanan Saya"})}),Ne.jsx("div",{className:"px-4 pb-4",children:Ne.jsxs("div",{className:"relative",children:[Ne.jsx(S,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),Ne.jsx("input",{type:"text",placeholder:"Cari pesanan...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"})]})}),Ne.jsx("div",{className:"flex overflow-x-auto px-4 pb-2",children:[{id:"all",label:"Semua"},{id:"pending",label:"Belum Bayar"},{id:"awaiting_verification",label:"Menunggu Verifikasi"},{id:"processing",label:"Dikemas"},{id:"shipped",label:"Dikirim"},{id:"delivered",label:"Selesai"}].map(e=>Ne.jsx("button",{onClick:()=>r(e.id),className:"flex-shrink-0 px-4 py-2 mr-2 rounded-full text-sm font-medium transition-colors "+(s===e.id?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:e.label},e.id))})]}),Ne.jsx("div",{className:"p-4 space-y-4",children:0===b.length?Ne.jsxs("div",{className:"text-center py-12",children:[Ne.jsx(z,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),Ne.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"Belum Ada Pesanan"}),Ne.jsx("p",{className:"text-gray-500",children:"Pesanan Anda akan muncul di sini"})]}):b.map(e=>{const t=y[e.status],s=t.icon;return Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsxs("div",{className:"flex items-center justify-between mb-3",children:[Ne.jsxs("div",{children:[Ne.jsxs("p",{className:"font-semibold text-gray-800",children:["#",e.id]}),Ne.jsx("p",{className:"text-sm text-gray-500",children:e.createdAt.toLocaleDateString("id-ID")})]}),Ne.jsxs("div",{className:`flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium ${t.color}`,children:[Ne.jsx(s,{className:"w-3 h-3"}),Ne.jsx("span",{children:t.label})]})]}),Ne.jsx("div",{className:"space-y-2 mb-3",children:e.items.map((e,t)=>Ne.jsxs("div",{className:"flex justify-between text-sm",children:[Ne.jsxs("span",{className:"text-gray-600",children:[e.productName," x",e.quantity]}),Ne.jsxs("span",{className:"font-medium",children:["Rp ",e.total.toLocaleString("id-ID")]})]},t))}),Ne.jsxs("div",{className:"border-t pt-3 flex items-center justify-between",children:[Ne.jsx("span",{className:"text-sm text-gray-600",children:"Total Pesanan"}),Ne.jsxs("span",{className:"font-bold text-pink-600",children:["Rp ",e.finalTotal.toLocaleString("id-ID")]})]}),Ne.jsxs("div",{className:"mt-3 flex space-x-2",children:[Ne.jsx("button",{className:"flex-1 bg-gray-100 text-gray-600 py-2 rounded-lg text-sm font-medium hover:bg-gray-200 transition-colors",children:"Detail"}),"pending"===e.status&&"transfer"===e.paymentMethod&&!e.paymentProof&&Ne.jsxs("button",{onClick:()=>p(e),className:"flex-1 bg-orange-500 text-white py-2 rounded-lg text-sm font-medium hover:bg-orange-600 transition-colors flex items-center justify-center space-x-1",children:[Ne.jsx(L,{className:"w-4 h-4"}),Ne.jsx("span",{children:"Bayar"})]}),("pending"===e.status||"awaiting_verification"===e.status)&&e.paymentProof&&Ne.jsxs("div",{className:"flex-1 flex space-x-2",children:[Ne.jsx("div",{className:"flex-1 bg-yellow-100 text-yellow-700 py-2 rounded-lg text-sm font-medium text-center",children:"⏳ Menunggu Verifikasi"}),Ne.jsxs("button",{onClick:()=>p(e),className:"px-3 py-2 bg-blue-500 text-white rounded-lg text-sm font-medium hover:bg-blue-600 transition-colors flex items-center space-x-1",children:[Ne.jsx(te,{className:"w-3 h-3"}),Ne.jsx("span",{children:"Upload Ulang"})]})]}),"paid"===e.status&&Ne.jsx("div",{className:"flex-1 bg-blue-100 text-blue-700 py-2 rounded-lg text-sm font-medium text-center",children:"✅ Pembayaran Terverifikasi"}),"delivered"===e.status&&Ne.jsx("button",{className:"flex-1 bg-pink-500 text-white py-2 rounded-lg text-sm font-medium hover:bg-pink-600 transition-colors",children:"Beli Lagi"})]})]},e.id)})}),i&&a&&Ne.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:Ne.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md relative max-h-[90vh] overflow-y-auto",children:[Ne.jsx("button",{onClick:g,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600",children:Ne.jsx(G,{size:24})}),Ne.jsxs("div",{className:"text-center mb-6",children:[Ne.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Pembayaran"}),Ne.jsxs("p",{className:"text-sm text-gray-600",children:["Pesanan #",a.id]}),Ne.jsxs("p",{className:"text-lg font-bold text-pink-600 mt-2",children:["Rp ",a.finalTotal.toLocaleString("id-ID")]}),a.paymentProof&&Ne.jsxs("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[Ne.jsx("p",{className:"text-yellow-800 text-sm font-medium",children:"📄 Upload Ulang Bukti Pembayaran"}),Ne.jsxs("p",{className:"text-yellow-600 text-xs mt-1",children:["Bukti sebelumnya: ",a.paymentProof]})]})]}),Ne.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 mb-6",children:[Ne.jsx("h4",{className:"font-semibold text-blue-800 mb-3",children:"Transfer ke Rekening:"}),Ne.jsxs("div",{className:"space-y-3 text-sm",children:[Ne.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded-lg border border-blue-200",children:[Ne.jsxs("div",{children:[Ne.jsx("span",{className:"font-medium text-gray-700",children:"BCA"}),Ne.jsx("div",{className:"font-mono text-xs text-gray-600",children:"0511456494"})]}),Ne.jsxs("button",{onClick:()=>f("0511456494","BCA"),className:"flex items-center space-x-1 text-blue-600 hover:text-blue-700 text-xs font-medium transition-colors",children:[Ne.jsx(se,{className:"w-3 h-3"}),Ne.jsx("span",{children:"Salin"})]})]}),Ne.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded-lg border border-blue-200",children:[Ne.jsxs("div",{children:[Ne.jsx("span",{className:"font-medium text-gray-700",children:"BRI"}),Ne.jsx("div",{className:"font-mono text-xs text-gray-600",children:"066301000115566"})]}),Ne.jsxs("button",{onClick:()=>f("066301000115566","BRI"),className:"flex items-center space-x-1 text-blue-600 hover:text-blue-700 text-xs font-medium transition-colors",children:[Ne.jsx(se,{className:"w-3 h-3"}),Ne.jsx("span",{children:"Salin"})]})]}),Ne.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded-lg border border-blue-200",children:[Ne.jsxs("div",{children:[Ne.jsx("span",{className:"font-medium text-gray-700",children:"MANDIRI"}),Ne.jsx("div",{className:"font-mono text-xs text-gray-600",children:"310011008896"})]}),Ne.jsxs("button",{onClick:()=>f("310011008896","MANDIRI"),className:"flex items-center space-x-1 text-blue-600 hover:text-blue-700 text-xs font-medium transition-colors",children:[Ne.jsx(se,{className:"w-3 h-3"}),Ne.jsx("span",{children:"Salin"})]})]}),Ne.jsx("div",{className:"text-center mt-3 p-2 bg-blue-100 rounded-lg",children:Ne.jsx("p",{className:"text-blue-700 font-semibold text-sm",children:"a.n. Fahrin"})})]})]}),Ne.jsxs("div",{className:"mb-6",children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload Bukti Pembayaran"}),Ne.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[Ne.jsx("input",{type:"file",accept:"image/*",onChange:e=>{e.target.files&&e.target.files[0]&&c(e.target.files[0])},className:"hidden",id:"payment-proof-modal"}),Ne.jsxs("label",{htmlFor:"payment-proof-modal",className:"cursor-pointer",children:[Ne.jsx(te,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),Ne.jsx("p",{className:"text-sm text-gray-600",children:l?l.name:"Klik untuk upload bukti transfer"})]})]})]}),Ne.jsx("button",{onClick:()=>u(t,null,function*(){if(a&&l)try{yield m(a.id,l.name,"awaiting_verification"),g();const e=a.paymentProof?"Bukti pembayaran berhasil diupload ulang! Menunggu verifikasi admin.":"Bukti pembayaran berhasil dikirim! Menunggu verifikasi admin.";alert(e)}catch(e){console.error("Error submitting payment:",e)}}),disabled:!l,className:"w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 px-4 rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed font-semibold transition-all",children:(null==a?void 0:a.paymentProof)?"Upload Ulang Bukti Pembayaran":"Kirim Bukti Pembayaran"})]})})]})},on=Ya("https://zlnmfcxdysitmxztprcg.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inpsbm1mY3hkeXNpdG14enRwcmNnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3NTc0NjksImV4cCI6MjA3NjMzMzQ2OX0.0DWlDCN4C3MEibjyjMs7bDE9Y8K-P8vmqED02sOMqaE"),ln=({user:e,onLogout:s,onNavigateToAdminProducts:r,onNavigateToAdminOrders:a,onNavigateToAdminReports:n,onNavigateToAdminUsers:i})=>{const[o,l]=h.useState(!1),[m,p]=h.useState(!1),[g,f]=h.useState(!1),[b,y]=h.useState({currentPassword:"",newPassword:"",confirmPassword:""}),{user:v,loading:j}=en();(()=>{const[e,s]=h.useState(null),[r,a]=h.useState(!0);h.useEffect(()=>{u(t,null,function*(){try{const{data:{session:e}}=yield on.auth.getSession();if(null==e?void 0:e.user){const{data:t}=yield on.from("profiles").select("*").eq("id",e.user.id).single();t&&s(t)}}catch(e){console.error("Error getting session:",e)}finally{a(!1)}});const{data:{subscription:e}}=on.auth.onAuthStateChange((e,r)=>u(t,null,function*(){if(null==r?void 0:r.user){const{data:e}=yield on.from("profiles").select("*").eq("id",r.user.id).single();e&&s(e)}else s(null);a(!1)}));return()=>e.unsubscribe()},[])})();const w=e||v;console.log("🔥 AccountPage rendered - propUser role:",null==e?void 0:e.role),console.log("🔥 AccountPage rendered - hookUser role:",null==v?void 0:v.role),console.log("🔥 AccountPage rendered - final user role:",null==w?void 0:w.role),console.log("🔥 User object:",w),console.log("🔥 AccountPage loaded with complete settings menu!");const N=e=>u(t,null,function*(){if(e.preventDefault(),b.newPassword===b.confirmPassword)if(b.newPassword.length<6)alert("Password minimal 6 karakter!");else try{alert("✅ Password berhasil diubah!"),y({currentPassword:"",newPassword:"",confirmPassword:""}),l(!1)}catch(t){alert("❌ Gagal mengubah password: "+t.message)}else alert("Password baru tidak cocok!")});if(j)return console.log("⏳ AccountPage: Auth is still loading..."),Ne.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:Ne.jsxs("div",{className:"text-center",children:[Ne.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),Ne.jsx("p",{className:"text-gray-600",children:"Memuat autentikasi..."})]})});if(!w){console.log("⚠️ AccountPage: User is null, checking for stored sessions");try{let e=localStorage.getItem("temp_user_session");if(e||(e=localStorage.getItem("azzahra_current_user")),e)return console.log("🔄 AccountPage: Found stored user session, reloading page to restore..."),console.log("💡 This should trigger the useSupabaseAuthSimple hook to restore the session properly"),setTimeout(()=>{window.location.reload()},100),Ne.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:Ne.jsxs("div",{className:"text-center",children:[Ne.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),Ne.jsx("p",{className:"text-gray-600",children:"Memulihkan sesi pengguna..."})]})});console.log("ℹ️ AccountPage: No stored user session found")}catch(P){console.error("❌ AccountPage: Failed to restore user session:",P)}return Ne.jsx("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 to-purple-50 flex items-center justify-center",children:Ne.jsxs("div",{className:"text-center",children:[Ne.jsx(k,{className:"w-16 h-16 text-purple-400 mx-auto mb-4"}),Ne.jsx("p",{className:"text-gray-600 mb-4",children:"Silakan login terlebih dahulu"}),Ne.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Muat Ulang Halaman"})]})})}const S=(e=>{switch(e){case"owner":return{text:"Owner",icon:M,color:"text-red-600 bg-red-100"};case"admin":return{text:"Administrator",icon:x,color:"text-purple-600 bg-purple-100"};case"reseller":return{text:"Reseller",icon:k,color:"text-blue-600 bg-blue-100"};default:return{text:"Customer",icon:k,color:"text-green-600 bg-green-100"}}})(w.role),_=S.icon;return Ne.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[Ne.jsxs("div",{className:"bg-gradient-to-r from-pink-500 to-purple-600 text-white p-6",children:[Ne.jsxs("div",{className:"flex items-center space-x-4",children:[Ne.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-full flex items-center justify-center",children:Ne.jsx(k,{className:"w-8 h-8"})}),Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("h2",{className:"text-xl font-bold",children:w.name}),Ne.jsx("p",{className:"text-pink-100",children:w.email}),Ne.jsxs("div",{className:`inline-flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium mt-2 ${S.color}`,children:[Ne.jsx(_,{className:"w-3 h-3"}),Ne.jsx("span",{className:"text-gray-800",children:S.text})]})]})]}),"reseller"===w.role&&Ne.jsx("div",{className:"mt-4 bg-white/10 rounded-lg p-3",children:Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsx("span",{className:"text-sm",children:"Total Poin"}),Ne.jsxs("span",{className:"text-lg font-bold",children:[w.points||0," pts"]})]})})]}),Ne.jsx("div",{className:"p-4",children:(()=>{switch(w.role){case"customer":return Ne.jsxs("div",{className:"space-y-4",children:[Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Informasi Akun"}),Ne.jsxs("div",{className:"space-y-3",children:[Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx(k,{className:"w-5 h-5 text-gray-400"}),Ne.jsxs("div",{children:[Ne.jsx("p",{className:"text-sm text-gray-500",children:"Username"}),Ne.jsx("p",{className:"font-medium",children:w.name})]})]}),Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx(q,{className:"w-5 h-5 text-gray-400"}),Ne.jsxs("div",{children:[Ne.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),Ne.jsx("p",{className:"font-medium",children:w.email})]})]}),Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx($,{className:"w-5 h-5 text-gray-400"}),Ne.jsxs("div",{children:[Ne.jsx("p",{className:"text-sm text-gray-500",children:"Telepon"}),Ne.jsx("p",{className:"font-medium",children:w.phone||"Belum diisi"})]})]})]})]}),Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Keamanan"}),Ne.jsx("button",{onClick:()=>l(!o),className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx(oe,{className:"w-5 h-5 text-gray-400"}),Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("p",{className:"font-medium",children:"Ubah Password"}),Ne.jsx("p",{className:"text-sm text-gray-500",children:"Keamanan akun Anda"})]})]})}),o&&Ne.jsxs("form",{onSubmit:N,className:"mt-4 space-y-3",children:[Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Saat Ini"}),Ne.jsxs("div",{className:"relative",children:[Ne.jsx("input",{type:m?"text":"password",value:b.currentPassword,onChange:e=>y(d(c({},b),{currentPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),Ne.jsx("button",{type:"button",onClick:()=>p(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:m?Ne.jsx(W,{className:"w-5 h-5"}):Ne.jsx(H,{className:"w-5 h-5"})})]})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Baru"}),Ne.jsxs("div",{className:"relative",children:[Ne.jsx("input",{type:g?"text":"password",value:b.newPassword,onChange:e=>y(d(c({},b),{newPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),Ne.jsx("button",{type:"button",onClick:()=>f(!g),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:g?Ne.jsx(W,{className:"w-5 h-5"}):Ne.jsx(H,{className:"w-5 h-5"})})]})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password Baru"}),Ne.jsx("input",{type:"password",value:b.confirmPassword,onChange:e=>y(d(c({},b),{confirmPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg",required:!0})]}),Ne.jsxs("div",{className:"flex space-x-3",children:[Ne.jsx("button",{type:"button",onClick:()=>l(!1),className:"flex-1 p-3 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50",children:"Batal"}),Ne.jsx("button",{type:"submit",className:"flex-1 p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Simpan"})]})]})]}),Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Preferensi"}),Ne.jsxs("div",{className:"space-y-3",children:[Ne.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx(T,{className:"w-5 h-5 text-gray-400"}),Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("p",{className:"font-medium",children:"Wishlist"}),Ne.jsx("p",{className:"text-sm text-gray-500",children:"Produk favorit Anda"})]})]})}),Ne.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx(U,{className:"w-5 h-5 text-gray-400"}),Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("p",{className:"font-medium",children:"Alamat Pengiriman"}),Ne.jsx("p",{className:"text-sm text-gray-500",children:"Kelola alamat Anda"})]})]})})]})]})]});case"reseller":return Ne.jsxs("div",{className:"space-y-4",children:[Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Informasi Akun"}),Ne.jsxs("div",{className:"space-y-3",children:[Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx(k,{className:"w-5 h-5 text-gray-400"}),Ne.jsxs("div",{children:[Ne.jsx("p",{className:"text-sm text-gray-500",children:"Username"}),Ne.jsx("p",{className:"font-medium",children:w.name})]})]}),Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx(q,{className:"w-5 h-5 text-gray-400"}),Ne.jsxs("div",{children:[Ne.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),Ne.jsx("p",{className:"font-medium",children:w.email})]})]}),Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx($,{className:"w-5 h-5 text-gray-400"}),Ne.jsxs("div",{children:[Ne.jsx("p",{className:"text-sm text-gray-500",children:"Telepon"}),Ne.jsx("p",{className:"font-medium",children:w.phone||"Belum diisi"})]})]})]})]}),Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Point Reseller"}),Ne.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg p-4 text-white",children:[Ne.jsxs("div",{className:"flex items-center justify-between mb-2",children:[Ne.jsx("span",{className:"text-sm opacity-90",children:"Total Poin"}),Ne.jsx(ue,{className:"w-6 h-6"})]}),Ne.jsxs("div",{className:"text-3xl font-bold",children:[w.points||0," pts"]}),Ne.jsx("div",{className:"mt-2 text-sm opacity-90",children:"Tukar dengan diskon khusus!"})]})]}),Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Keamanan"}),Ne.jsx("button",{onClick:()=>l(!o),className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx(oe,{className:"w-5 h-5 text-gray-400"}),Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("p",{className:"font-medium",children:"Ubah Password"}),Ne.jsx("p",{className:"text-sm text-gray-500",children:"Keamanan akun Anda"})]})]})}),o&&Ne.jsxs("form",{onSubmit:N,className:"mt-4 space-y-3",children:[Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Saat Ini"}),Ne.jsxs("div",{className:"relative",children:[Ne.jsx("input",{type:m?"text":"password",value:b.currentPassword,onChange:e=>y(d(c({},b),{currentPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),Ne.jsx("button",{type:"button",onClick:()=>p(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:m?Ne.jsx(W,{className:"w-5 h-5"}):Ne.jsx(H,{className:"w-5 h-5"})})]})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Baru"}),Ne.jsxs("div",{className:"relative",children:[Ne.jsx("input",{type:g?"text":"password",value:b.newPassword,onChange:e=>y(d(c({},b),{newPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),Ne.jsx("button",{type:"button",onClick:()=>f(!g),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:g?Ne.jsx(W,{className:"w-5 h-5"}):Ne.jsx(H,{className:"w-5 h-5"})})]})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password Baru"}),Ne.jsx("input",{type:"password",value:b.confirmPassword,onChange:e=>y(d(c({},b),{confirmPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg",required:!0})]}),Ne.jsxs("div",{className:"flex space-x-3",children:[Ne.jsx("button",{type:"button",onClick:()=>l(!1),className:"flex-1 p-3 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50",children:"Batal"}),Ne.jsx("button",{type:"submit",className:"flex-1 p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Simpan"})]})]})]}),Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Preferensi Reseller"}),Ne.jsxs("div",{className:"space-y-3",children:[Ne.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx(T,{className:"w-5 h-5 text-gray-400"}),Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("p",{className:"font-medium",children:"Wishlist"}),Ne.jsx("p",{className:"text-sm text-gray-500",children:"Produk favorit Anda"})]})]})}),Ne.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx(U,{className:"w-5 h-5 text-gray-400"}),Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("p",{className:"font-medium",children:"Alamat Pengiriman"}),Ne.jsx("p",{className:"text-sm text-gray-500",children:"Kelola alamat Anda"})]})]})}),Ne.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx(ue,{className:"w-5 h-5 text-gray-400"}),Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("p",{className:"font-medium",children:"Riwayat Poin"}),Ne.jsx("p",{className:"text-sm text-gray-500",children:"Lihat transaksi poin"})]})]})})]})]})]});case"admin":return Ne.jsxs("div",{className:"space-y-4",children:[Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Informasi Akun Admin"}),Ne.jsxs("div",{className:"space-y-3",children:[Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx(k,{className:"w-5 h-5 text-gray-400"}),Ne.jsxs("div",{children:[Ne.jsx("p",{className:"text-sm text-gray-500",children:"Username"}),Ne.jsx("p",{className:"font-medium",children:w.name})]})]}),Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx(q,{className:"w-5 h-5 text-gray-400"}),Ne.jsxs("div",{children:[Ne.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),Ne.jsx("p",{className:"font-medium",children:w.email})]})]}),Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx($,{className:"w-5 h-5 text-gray-400"}),Ne.jsxs("div",{children:[Ne.jsx("p",{className:"text-sm text-gray-500",children:"Telepon"}),Ne.jsx("p",{className:"font-medium",children:w.phone||"Belum diisi"})]})]})]})]}),Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Fitur Admin"}),Ne.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[Ne.jsxs("button",{onClick:r,className:"p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[Ne.jsx(z,{className:"w-6 h-6 mx-auto mb-2"}),Ne.jsx("p",{className:"text-sm",children:"Kelola Produk"})]}),Ne.jsxs("button",{onClick:a,className:"p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[Ne.jsx(z,{className:"w-6 h-6 mx-auto mb-2"}),Ne.jsx("p",{className:"text-sm",children:"Kelola Pesanan"})]}),Ne.jsxs("button",{onClick:n,className:"p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[Ne.jsx(ae,{className:"w-6 h-6 mx-auto mb-2"}),Ne.jsx("p",{className:"text-sm",children:"Laporan"})]}),Ne.jsxs("button",{onClick:i,className:"p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[Ne.jsx(ne,{className:"w-6 h-6 mx-auto mb-2"}),Ne.jsx("p",{className:"text-sm",children:"Pelanggan"})]})]})]}),Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Statistik Admin"}),Ne.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Ne.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[Ne.jsx(ie,{className:"w-6 h-6 text-blue-600 mx-auto mb-2"}),Ne.jsx("p",{className:"text-sm text-gray-600",children:"Total Penjualan"}),Ne.jsx("p",{className:"text-xl font-bold text-blue-600",children:"Rp 0"})]}),Ne.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[Ne.jsx(z,{className:"w-6 h-6 text-green-600 mx-auto mb-2"}),Ne.jsx("p",{className:"text-sm text-gray-600",children:"Total Pesanan"}),Ne.jsx("p",{className:"text-xl font-bold text-green-600",children:"0"})]})]})]}),Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Keamanan Admin"}),Ne.jsx("button",{onClick:()=>l(!o),className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx(oe,{className:"w-5 h-5 text-gray-400"}),Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("p",{className:"font-medium",children:"Ubah Password"}),Ne.jsx("p",{className:"text-sm text-gray-500",children:"Keamanan akun admin"})]})]})}),o&&Ne.jsxs("form",{onSubmit:N,className:"mt-4 space-y-3",children:[Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Saat Ini"}),Ne.jsxs("div",{className:"relative",children:[Ne.jsx("input",{type:m?"text":"password",value:b.currentPassword,onChange:e=>y(d(c({},b),{currentPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),Ne.jsx("button",{type:"button",onClick:()=>p(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:m?Ne.jsx(W,{className:"w-5 h-5"}):Ne.jsx(H,{className:"w-5 h-5"})})]})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Baru"}),Ne.jsxs("div",{className:"relative",children:[Ne.jsx("input",{type:g?"text":"password",value:b.newPassword,onChange:e=>y(d(c({},b),{newPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),Ne.jsx("button",{type:"button",onClick:()=>f(!g),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:g?Ne.jsx(W,{className:"w-5 h-5"}):Ne.jsx(H,{className:"w-5 h-5"})})]})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password Baru"}),Ne.jsx("input",{type:"password",value:b.confirmPassword,onChange:e=>y(d(c({},b),{confirmPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg",required:!0})]}),Ne.jsxs("div",{className:"flex space-x-3",children:[Ne.jsx("button",{type:"button",onClick:()=>l(!1),className:"flex-1 p-3 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50",children:"Batal"}),Ne.jsx("button",{type:"submit",className:"flex-1 p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Simpan"})]})]})]}),Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Preferensi Admin"}),Ne.jsxs("div",{className:"space-y-3",children:[Ne.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx(le,{className:"w-5 h-5 text-gray-400"}),Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("p",{className:"font-medium",children:"Keamanan"}),Ne.jsx("p",{className:"text-sm text-gray-500",children:"Pengaturan keamanan"})]})]})}),Ne.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx(ce,{className:"w-5 h-5 text-gray-400"}),Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("p",{className:"font-medium",children:"Pengaturan Sistem"}),Ne.jsx("p",{className:"text-sm text-gray-500",children:"Konfigurasi aplikasi"})]})]})})]})]})]});case"owner":return Ne.jsxs("div",{className:"space-y-4",children:[Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Informasi Akun Owner"}),Ne.jsxs("div",{className:"space-y-3",children:[Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx(k,{className:"w-5 h-5 text-gray-400"}),Ne.jsxs("div",{children:[Ne.jsx("p",{className:"text-sm text-gray-500",children:"Username"}),Ne.jsx("p",{className:"font-medium",children:w.name})]})]}),Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx(q,{className:"w-5 h-5 text-gray-400"}),Ne.jsxs("div",{children:[Ne.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),Ne.jsx("p",{className:"font-medium",children:w.email})]})]}),Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx($,{className:"w-5 h-5 text-gray-400"}),Ne.jsxs("div",{children:[Ne.jsx("p",{className:"text-sm text-gray-500",children:"Telepon"}),Ne.jsx("p",{className:"font-medium",children:w.phone||"Belum diisi"})]})]})]})]}),Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Kontrol Owner"}),Ne.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[Ne.jsxs("button",{onClick:r,className:"p-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[Ne.jsx(z,{className:"w-6 h-6 mx-auto mb-2"}),Ne.jsx("p",{className:"text-sm",children:"Kelola Produk"})]}),Ne.jsxs("button",{onClick:a,className:"p-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[Ne.jsx(z,{className:"w-6 h-6 mx-auto mb-2"}),Ne.jsx("p",{className:"text-sm",children:"Kelola Pesanan"})]}),Ne.jsxs("button",{onClick:n,className:"p-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[Ne.jsx(ae,{className:"w-6 h-6 mx-auto mb-2"}),Ne.jsx("p",{className:"text-sm",children:"Laporan"})]}),Ne.jsxs("button",{onClick:i,className:"p-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[Ne.jsx(ne,{className:"w-6 h-6 mx-auto mb-2"}),Ne.jsx("p",{className:"text-sm",children:"Kelola User"})]})]})]}),Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Statistik Bisnis"}),Ne.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Ne.jsxs("div",{className:"text-center p-3 bg-red-50 rounded-lg",children:[Ne.jsx(ie,{className:"w-6 h-6 text-red-600 mx-auto mb-2"}),Ne.jsx("p",{className:"text-sm text-gray-600",children:"Total Revenue"}),Ne.jsx("p",{className:"text-xl font-bold text-red-600",children:"Rp 0"})]}),Ne.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[Ne.jsx(z,{className:"w-6 h-6 text-green-600 mx-auto mb-2"}),Ne.jsx("p",{className:"text-sm text-gray-600",children:"Total Pesanan"}),Ne.jsx("p",{className:"text-xl font-bold text-green-600",children:"0"})]})]})]}),Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Keamanan Owner"}),Ne.jsx("button",{onClick:()=>l(!o),className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx(oe,{className:"w-5 h-5 text-gray-400"}),Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("p",{className:"font-medium",children:"Ubah Password"}),Ne.jsx("p",{className:"text-sm text-gray-500",children:"Keamanan akun owner"})]})]})}),o&&Ne.jsxs("form",{onSubmit:N,className:"mt-4 space-y-3",children:[Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Saat Ini"}),Ne.jsxs("div",{className:"relative",children:[Ne.jsx("input",{type:m?"text":"password",value:b.currentPassword,onChange:e=>y(d(c({},b),{currentPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),Ne.jsx("button",{type:"button",onClick:()=>p(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:m?Ne.jsx(W,{className:"w-5 h-5"}):Ne.jsx(H,{className:"w-5 h-5"})})]})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Baru"}),Ne.jsxs("div",{className:"relative",children:[Ne.jsx("input",{type:g?"text":"password",value:b.newPassword,onChange:e=>y(d(c({},b),{newPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),Ne.jsx("button",{type:"button",onClick:()=>f(!g),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:g?Ne.jsx(W,{className:"w-5 h-5"}):Ne.jsx(H,{className:"w-5 h-5"})})]})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password Baru"}),Ne.jsx("input",{type:"password",value:b.confirmPassword,onChange:e=>y(d(c({},b),{confirmPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg",required:!0})]}),Ne.jsxs("div",{className:"flex space-x-3",children:[Ne.jsx("button",{type:"button",onClick:()=>l(!1),className:"flex-1 p-3 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50",children:"Batal"}),Ne.jsx("button",{type:"submit",className:"flex-1 p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Simpan"})]})]})]}),Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Pengaturan Owner"}),Ne.jsxs("div",{className:"space-y-3",children:[Ne.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx(le,{className:"w-5 h-5 text-gray-400"}),Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("p",{className:"font-medium",children:"Keamanan"}),Ne.jsx("p",{className:"text-sm text-gray-500",children:"Pengaturan keamanan tingkat lanjut"})]})]})}),Ne.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx(ce,{className:"w-5 h-5 text-gray-400"}),Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("p",{className:"font-medium",children:"Sistem"}),Ne.jsx("p",{className:"text-sm text-gray-500",children:"Konfigurasi aplikasi"})]})]})}),Ne.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx(de,{className:"w-5 h-5 text-gray-400"}),Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("p",{className:"font-medium",children:"Backup & Restore"}),Ne.jsx("p",{className:"text-sm text-gray-500",children:"Cadangkan data"})]})]})})]})]})]});default:return null}})()}),Ne.jsx("div",{className:"p-4",children:Ne.jsx("div",{className:"bg-white rounded-lg shadow-sm",children:Ne.jsxs("button",{onClick:()=>{s()},className:"w-full p-4 flex items-center space-x-3 text-red-600 hover:bg-red-50 transition-colors rounded-lg",children:[Ne.jsx(re,{className:"w-5 h-5"}),Ne.jsx("span",{children:"Keluar"})]})})})]})},cn=()=>{const[e,s]=h.useState([]),[r,a]=h.useState(!0),[n,i]=h.useState(null),o=()=>u(t,null,function*(){try{a(!0),i(null),console.log("🔄 Fetching products from Supabase...");const{data:e,error:t}=yield on.from("products").select("*").order("created_at",{ascending:!1});if(t)return console.error("❌ Error fetching products:",t),void i(t.message);console.log("✅ Products fetched from Supabase:",(null==e?void 0:e.length)||0,"items");const r=(e||[]).map(e=>{var t;return{id:e.id,name:e.name,description:e.description||"",category:e.category||"uncategorized",price:Number(e.price),retailPrice:Number(e.price),resellerPrice:Number(e.reseller_price||.8*e.price),stock:e.stock||0,image:(null==(t=e.images)?void 0:t[0])||"/placeholder-product.jpg",images:e.images||[],sizes:e.sizes||[],colors:e.colors||[],featured:e.featured||!1,isFlashSale:e.flash_sale||!1,flashSalePrice:e.flash_sale_price?Number(e.flash_sale_price):void 0,originalRetailPrice:Number(e.price)}});s(r)}catch(e){console.error("❌ Unexpected error:",e),i("Failed to fetch products")}finally{a(!1)}});return h.useEffect(()=>{const e=on.channel("products-changes").on("postgres_changes",{event:"*",schema:"public",table:"products"},e=>{console.log("🔄 Real-time product update:",e.eventType,e.new),o()}).subscribe();return()=>{e.unsubscribe()}},[]),h.useEffect(()=>{o()},[]),{products:e,loading:r,error:n,fetchProducts:o,addProduct:e=>u(t,null,function*(){try{console.log("➕ Adding new product to Supabase...");const{data:t,error:s}=yield on.from("products").insert({name:e.name,description:e.description,category:e.category,price:e.price,reseller_price:e.resellerPrice,stock:e.stock,images:e.images,sizes:e.sizes,colors:e.colors,featured:e.featured,flash_sale:e.isFlashSale,flash_sale_price:e.flashSalePrice}).select().single();if(s)throw console.error("❌ Error adding product:",s),s;return console.log("✅ Product added to Supabase:",t),yield o(),t}catch(t){throw console.error("❌ Error in addProduct:",t),t}}),updateProduct:(e,s)=>u(t,null,function*(){try{console.log("📝 Updating product in Supabase:",e);const{data:t,error:r}=yield on.from("products").update({name:s.name,description:s.description,category:s.category,price:s.price,reseller_price:s.resellerPrice,stock:s.stock,images:s.images,sizes:s.sizes,colors:s.colors,featured:s.featured,flash_sale:s.isFlashSale,flash_sale_price:s.flashSalePrice}).eq("id",e).select().single();if(r)throw console.error("❌ Error updating product:",r),r;return console.log("✅ Product updated in Supabase:",t),yield o(),t}catch(t){throw console.error("❌ Error in updateProduct:",t),t}}),deleteProduct:e=>u(t,null,function*(){try{console.log("🗑️ Deleting product from Supabase:",e);const{error:t}=yield on.from("products").delete().eq("id",e);if(t)throw console.error("❌ Error deleting product:",t),t;return console.log("✅ Product deleted from Supabase:",e),yield o(),!0}catch(t){throw console.error("❌ Error in deleteProduct:",t),t}}),updateProductStock:(e,r)=>u(t,null,function*(){try{console.log("📦 Updating product stock:",e,"quantity:",r);const{data:t,error:a}=yield on.from("products").select("stock").eq("id",e).single();if(a)throw console.error("❌ Error fetching current stock:",a),a;const n=Math.max(0,((null==t?void 0:t.stock)||0)-r),{error:i}=yield on.from("products").update({stock:n}).eq("id",e);if(i)throw console.error("❌ Error updating stock:",i),i;return console.log("✅ Stock updated:",e,"new stock:",n),s(t=>t.map(t=>t.id===e?d(c({},t),{stock:n}):t)),n}catch(t){throw console.error("❌ Error in updateProductStock:",t),t}})}},dn=({onBack:s,user:r})=>{const[a,n]=h.useState(!1),[i,o]=h.useState(!1),[l,m]=h.useState(null),[p,g]=h.useState([]),[f,x]=h.useState(""),[b,y]=h.useState(""),[v,j]=h.useState("name"),[w,N]=h.useState(1),[k,_]=h.useState(50),{products:P,addProduct:C,updateProduct:T,deleteProduct:O,loading:I,error:D,fetchProducts:$}=cn(),[U,L]=h.useState({name:"",category:"",variants:[{sizes:[],colors:[]}],purchasePrice:0,sellingPrice:0,discount:0,unit:"pcs",description:"",condition:"Ready Stock",images:[],stock:0}),B=["Gamis","Khimar","Jilbab Instan","Pashmina","Bergo","Setelan","Dress","Atasan","Bawahan","Aksesoris"];h.useEffect(()=>{$()},[$]);const F=P.filter(e=>{const t=e.name.toLowerCase().includes(f.toLowerCase())||e.description.toLowerCase().includes(f.toLowerCase()),s=!b||e.category===b;return t&&s}).sort((e,t)=>{switch(v){case"name":return e.name.localeCompare(t.name);case"price-asc":return e.retailPrice-t.retailPrice;case"price-desc":return t.retailPrice-e.retailPrice;case"date-newest":return new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime();case"date-oldest":return new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime();default:return 0}}),M=Math.ceil(F.length/k),q=F.slice((w-1)*k,w*k),K=(e,t)=>{L(s=>d(c({},s),{[e]:t}))},J=(e,t,s)=>{L(r=>d(c({},r),{variants:r.variants.map((r,a)=>a===e?d(c({},r),{[t]:s}):r)}))},W=(e,t)=>{if(!t.trim())return;const s=U.variants[e].sizes;s.includes(t.trim())||J(e,"sizes",[...s,t.trim()])},H=(e,t)=>{if(!t.trim())return;const s=U.variants[e].colors;s.includes(t.trim())||J(e,"colors",[...s,t.trim()])};return Ne.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[Ne.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:Ne.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:Ne.jsxs("div",{className:"flex items-center justify-between h-16",children:[Ne.jsxs("div",{className:"flex items-center",children:[Ne.jsx("button",{onClick:s,className:"p-2 rounded-lg hover:bg-gray-100 transition-colors mr-4",children:Ne.jsx(E,{className:"w-5 h-5"})}),Ne.jsxs("div",{className:"flex items-center",children:[Ne.jsx(z,{className:"w-6 h-6 text-purple-600 mr-3"}),Ne.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Kelola Produk"})]})]}),Ne.jsxs("div",{className:"flex items-center space-x-2",children:[Ne.jsxs("span",{className:"text-sm text-gray-500",children:[P.length," produk"]}),Ne.jsxs("button",{onClick:()=>n(!0),className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors flex items-center",children:[Ne.jsx(A,{className:"w-4 h-4 mr-2"}),"Tambah Produk"]})]})]})})}),Ne.jsx("div",{className:"bg-white border-b",children:Ne.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:Ne.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[Ne.jsx("div",{className:"flex-1 min-w-[200px]",children:Ne.jsxs("div",{className:"relative",children:[Ne.jsx(S,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),Ne.jsx("input",{type:"text",placeholder:"Cari produk...",value:f,onChange:e=>x(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500"})]})}),Ne.jsxs("select",{value:b,onChange:e=>y(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[Ne.jsx("option",{value:"",children:"Semua Kategori"}),B.map(e=>Ne.jsx("option",{value:e,children:e},e))]}),Ne.jsxs("select",{value:v,onChange:e=>j(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[Ne.jsx("option",{value:"name",children:"Nama (A-Z)"}),Ne.jsx("option",{value:"price-asc",children:"Harga (Rendah ke Tinggi)"}),Ne.jsx("option",{value:"price-desc",children:"Harga (Tinggi ke Rendah)"}),Ne.jsx("option",{value:"date-newest",children:"Terbaru"}),Ne.jsx("option",{value:"date-oldest",children:"Terlama"})]})]})})}),Ne.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:I?Ne.jsx("div",{className:"flex items-center justify-center h-64",children:Ne.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"})}):D?Ne.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-center",children:[Ne.jsxs("p",{className:"text-red-600",children:["Error: ",D]}),Ne.jsx("button",{onClick:()=>$(),className:"mt-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Coba Lagi"})]}):0===q.length?Ne.jsxs("div",{className:"text-center py-12",children:[Ne.jsx(z,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),Ne.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Belum ada produk"}),Ne.jsx("p",{className:"text-gray-500 mb-4",children:f||b?"Tidak ada produk yang cocok dengan filter":"Mulai dengan menambahkan produk pertama Anda"}),Ne.jsx("button",{onClick:()=>n(!0),className:"bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors",children:"Tambah Produk Pertama"})]}):Ne.jsxs(Ne.Fragment,{children:[Ne.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6",children:q.map(e=>Ne.jsx("div",{className:"bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow",children:Ne.jsxs("div",{className:"p-4",children:[Ne.jsxs("div",{className:"flex items-start justify-between mb-3",children:[Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:e.name}),Ne.jsx("p",{className:"text-sm text-gray-500",children:e.category})]}),Ne.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium "+("ready"===e.status?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"),children:"ready"===e.status?"Ready Stock":"PO"})]}),Ne.jsxs("div",{className:"space-y-2 mb-3",children:[Ne.jsxs("div",{className:"flex justify-between text-sm",children:[Ne.jsx("span",{className:"text-gray-500",children:"Harga Retail:"}),Ne.jsxs("span",{className:"font-medium",children:["Rp ",e.retailPrice.toLocaleString("id-ID")]})]}),Ne.jsxs("div",{className:"flex justify-between text-sm",children:[Ne.jsx("span",{className:"text-gray-500",children:"Harga Reseller:"}),Ne.jsxs("span",{className:"font-medium text-blue-600",children:["Rp ",e.resellerPrice.toLocaleString("id-ID")]})]}),Ne.jsxs("div",{className:"flex justify-between text-sm",children:[Ne.jsx("span",{className:"text-gray-500",children:"Stok:"}),Ne.jsxs("span",{className:"font-medium "+(e.stock<=5?"text-red-600":"text-green-600"),children:[e.stock," ",e.unit]})]})]}),Ne.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.variants&&e.variants.sizes&&e.variants.sizes.length>0&&Ne.jsx("div",{className:"flex items-center text-xs text-gray-500",children:Ne.jsxs("span",{children:["Size: ",e.variants.sizes.join(", ")]})}),e.variants&&e.variants.colors&&e.variants.colors.length>0&&Ne.jsx("div",{className:"flex items-center text-xs text-gray-500",children:Ne.jsxs("span",{children:["Color: ",e.variants.colors.join(", ")]})})]}),Ne.jsxs("div",{className:"flex space-x-2",children:[Ne.jsxs("button",{onClick:()=>(e=>{var t,s;m(e),L({name:e.name||"",category:e.category||"",variants:[{sizes:(null==(t=e.variants)?void 0:t.sizes)||[],colors:(null==(s=e.variants)?void 0:s.colors)||[]}],purchasePrice:e.costPrice||0,sellingPrice:e.retailPrice||0,discount:0,unit:"pcs",description:e.description||"",condition:"ready"===e.status?"Ready Stock":"PO",images:e.images||[],stock:e.stock||0}),o(!0)})(e),className:"flex-1 bg-blue-600 text-white py-2 px-3 rounded-lg hover:bg-blue-700 transition-colors text-sm flex items-center justify-center",children:[Ne.jsx(he,{className:"w-3 h-3 mr-1"}),"Edit"]}),Ne.jsxs("button",{onClick:()=>{return s=e.id,u(t,null,function*(){if(confirm("Apakah Anda yakin ingin menghapus produk ini?"))try{yield O(s),console.log("✅ Product deleted successfully via Supabase"),alert("✅ Produk berhasil dihapus!")}catch(e){console.error("❌ Failed to delete product:",e),alert("Gagal menghapus produk: "+e.message)}});var s},className:"flex-1 bg-red-600 text-white py-2 px-3 rounded-lg hover:bg-red-700 transition-colors text-sm flex items-center justify-center",children:[Ne.jsx(R,{className:"w-3 h-3 mr-1"}),"Hapus"]})]})]})},e.id))}),M>1&&Ne.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[Ne.jsx("button",{onClick:()=>N(e=>Math.max(1,e-1)),disabled:1===w,className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),Ne.jsxs("span",{className:"px-4 py-2 text-sm text-gray-600",children:["Halaman ",w," dari ",M]}),Ne.jsx("button",{onClick:()=>N(e=>Math.min(M,e+1)),disabled:w===M,className:"px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})}),a&&Ne.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:Ne.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:Ne.jsxs("div",{className:"p-6",children:[Ne.jsxs("div",{className:"flex items-center justify-between mb-4",children:[Ne.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Tambah Produk Baru"}),Ne.jsx("button",{onClick:()=>n(!1),className:"p-2 hover:bg-gray-100 rounded-lg",children:Ne.jsx(G,{className:"w-5 h-5"})})]}),Ne.jsxs("form",{onSubmit:e=>u(t,null,function*(){e.preventDefault();try{if(!U.name.trim())return void alert("Nama produk harus diisi");if(!U.category)return void alert("Kategori harus dipilih");if(U.sellingPrice<=0)return void alert("Harga jual harus lebih dari 0");if(U.stock<0)return void alert("Stok tidak boleh negatif");const e=U.sellingPrice-U.sellingPrice*U.discount/100,t=U.variants.flatMap(e=>e.sizes),s=U.variants.flatMap(e=>e.colors),r=[...new Set(t)],a=[...new Set(s)],i={id:Date.now().toString(),name:U.name,description:U.description,category:U.category,images:U.images,variants:{sizes:r,colors:a},retailPrice:Math.round(e),resellerPrice:Math.round(.8*e),costPrice:U.purchasePrice,stock:U.stock,status:"Ready Stock"===U.condition?"ready":"po",isFlashSale:!1,flashSalePrice:Math.round(e),createdAt:new Date,salesCount:0,isFeatured:!1};yield C(i),console.log("✅ Product added successfully via Supabase"),L({name:"",category:"",variants:[{sizes:[],colors:[]}],purchasePrice:0,sellingPrice:0,discount:0,unit:"pcs",description:"",condition:"Ready Stock",images:[],stock:0}),n(!1),alert("✅ Produk berhasil ditambahkan!")}catch(t){console.error("❌ Failed to add product:",t),alert("Gagal menambahkan produk: "+t.message)}}),className:"space-y-4",children:[Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nama Produk"}),Ne.jsx("input",{type:"text",value:U.name,onChange:e=>K("name",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"Masukkan nama produk",required:!0})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kategori"}),Ne.jsxs("select",{value:U.category,onChange:e=>K("category",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",required:!0,children:[Ne.jsx("option",{value:"",children:"Pilih Kategori"}),B.map(e=>Ne.jsx("option",{value:e,children:e},e))]})]}),Ne.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Harga Beli"}),Ne.jsx("input",{type:"number",value:U.purchasePrice,onChange:e=>K("purchasePrice",parseInt(e.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"0",min:"0"})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Harga Jual"}),Ne.jsx("input",{type:"number",value:U.sellingPrice,onChange:e=>K("sellingPrice",parseInt(e.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"0",min:"0",required:!0})]})]}),Ne.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Stok"}),Ne.jsx("input",{type:"number",value:U.stock,onChange:e=>K("stock",parseInt(e.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",placeholder:"0",min:"0",required:!0})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kondisi"}),Ne.jsxs("select",{value:U.condition,onChange:e=>K("condition",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[Ne.jsx("option",{value:"Ready Stock",children:"Ready Stock"}),Ne.jsx("option",{value:"PO",children:"PO (Pre Order)"})]})]})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Deskripsi"}),Ne.jsx("textarea",{value:U.description,onChange:e=>K("description",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",rows:3,placeholder:"Deskripsi produk..."})]}),Ne.jsxs("div",{children:[Ne.jsxs("div",{className:"flex items-center justify-between mb-2",children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Variasi Produk"}),Ne.jsx("button",{type:"button",onClick:()=>{L(e=>d(c({},e),{variants:[...e.variants,{sizes:[],colors:[]}]}))},className:"text-purple-600 hover:text-purple-700 text-sm",children:"+ Tambah Variasi"})]}),U.variants.map((t,s)=>Ne.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 mb-3",children:[U.variants.length>1&&Ne.jsxs("div",{className:"flex items-center justify-between mb-3",children:[Ne.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Variasi ",s+1]}),Ne.jsx("button",{type:"button",onClick:()=>{return e=s,void L(t=>d(c({},t),{variants:t.variants.filter((t,s)=>s!==e)}));var e},className:"text-red-600 hover:text-red-700 text-sm",children:"Hapus"})]}),Ne.jsxs("div",{className:"mb-3",children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Size"}),Ne.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:t.sizes.map((e,t)=>Ne.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm bg-gray-100 text-gray-800",children:[e,Ne.jsx("button",{type:"button",onClick:()=>((e,t)=>{const s=U.variants[e].sizes;J(e,"sizes",s.filter(e=>e!==t))})(s,e),className:"ml-2 text-gray-500 hover:text-red-600",children:"×"})]},t))}),Ne.jsxs("div",{className:"flex gap-2",children:[Ne.jsx("input",{type:"text",placeholder:"Tambah size (contoh: S, M, L)",className:"flex-1 px-3 py-1 border border-gray-300 rounded-lg text-sm",onKeyPress:e=>{"Enter"===e.key&&(W(s,e.currentTarget.value),e.currentTarget.value="")}}),Ne.jsx("button",{type:"button",onClick:()=>{const t=e.currentTarget.previousElementSibling;W(s,t.value),t.value=""},className:"px-3 py-1 bg-gray-200 text-gray-700 rounded-lg text-sm hover:bg-gray-300",children:"+"})]})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Warna"}),Ne.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:t.colors.map((e,t)=>Ne.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm bg-gray-100 text-gray-800",children:[e,Ne.jsx("button",{type:"button",onClick:()=>((e,t)=>{const s=U.variants[e].colors;J(e,"colors",s.filter(e=>e!==t))})(s,e),className:"ml-2 text-gray-500 hover:text-red-600",children:"×"})]},t))}),Ne.jsxs("div",{className:"flex gap-2",children:[Ne.jsx("input",{type:"text",placeholder:"Tambah warna (contoh: Hitam, Putih)",className:"flex-1 px-3 py-1 border border-gray-300 rounded-lg text-sm",onKeyPress:e=>{"Enter"===e.key&&(H(s,e.currentTarget.value),e.currentTarget.value="")}}),Ne.jsx("button",{type:"button",onClick:()=>{const t=e.currentTarget.previousElementSibling;H(s,t.value),t.value=""},className:"px-3 py-1 bg-gray-200 text-gray-700 rounded-lg text-sm hover:bg-gray-300",children:"+"})]})]})]},s))]}),Ne.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[Ne.jsx("button",{type:"button",onClick:()=>n(!1),className:"px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Batal"}),Ne.jsx("button",{type:"submit",className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Tambah Produk"})]})]})]})})}),i&&l&&Ne.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:Ne.jsx("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:Ne.jsxs("div",{className:"p-6",children:[Ne.jsxs("div",{className:"flex items-center justify-between mb-4",children:[Ne.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Edit Produk"}),Ne.jsx("button",{onClick:()=>o(!1),className:"p-2 hover:bg-gray-100 rounded-lg",children:Ne.jsx(G,{className:"w-5 h-5"})})]}),Ne.jsxs("form",{onSubmit:e=>u(t,null,function*(){var t,s;if(e.preventDefault(),l)try{const e=U.sellingPrice-U.sellingPrice*U.discount/100,r=d(c({},l),{name:U.name,description:U.description,category:U.category,variants:{sizes:(null==(t=U.variants[0])?void 0:t.sizes)||[],colors:(null==(s=U.variants[0])?void 0:s.colors)||[]},retailPrice:Math.round(e),resellerPrice:Math.round(.8*e),costPrice:U.purchasePrice,stock:U.stock,status:"Ready Stock"===U.condition?"ready":"po",images:U.images});yield T(l.id,r),console.log("✅ Product updated successfully via Supabase"),o(!1),m(null),alert("✅ Produk berhasil diperbarui!")}catch(r){console.error("❌ Failed to update product:",r),alert("Gagal memperbarui produk: "+r.message)}}),className:"space-y-4",children:[Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nama Produk"}),Ne.jsx("input",{type:"text",value:U.name,onChange:e=>K("name",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",required:!0})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kategori"}),Ne.jsx("select",{value:U.category,onChange:e=>K("category",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",required:!0,children:B.map(e=>Ne.jsx("option",{value:e,children:e},e))})]}),Ne.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Harga Beli"}),Ne.jsx("input",{type:"number",value:U.purchasePrice,onChange:e=>K("purchasePrice",parseInt(e.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",min:"0"})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Harga Jual"}),Ne.jsx("input",{type:"number",value:U.sellingPrice,onChange:e=>K("sellingPrice",parseInt(e.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",min:"0",required:!0})]})]}),Ne.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Stok"}),Ne.jsx("input",{type:"number",value:U.stock,onChange:e=>K("stock",parseInt(e.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",min:"0",required:!0})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kondisi"}),Ne.jsxs("select",{value:U.condition,onChange:e=>K("condition",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",children:[Ne.jsx("option",{value:"Ready Stock",children:"Ready Stock"}),Ne.jsx("option",{value:"PO",children:"PO (Pre Order)"})]})]})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Deskripsi"}),Ne.jsx("textarea",{value:U.description,onChange:e=>K("description",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500",rows:3})]}),Ne.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[Ne.jsx("button",{type:"button",onClick:()=>o(!1),className:"px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Batal"}),Ne.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Update Produk"})]})]})]})})})]})},un=({onBack:e,user:t})=>{var s,r,a,n,i,o,l,c,d;const{orders:u,updateOrderStatus:m,updateOrderPayment:p,deleteOrder:g,getOrdersByStatus:f,getTotalRevenue:x,getTodayOrders:b}=Ee(),[y,v]=h.useState(""),[j,w]=h.useState("all"),[N,_]=h.useState(""),[P,C]=h.useState(!1),[T,O]=h.useState(null),[A,I]=h.useState(!1),[R,D]=h.useState(""),[F,M]=h.useState("");h.useEffect(()=>{const e=e=>{console.log("AdminOrdersPage: Order update received",e.detail),v(e=>e+" "),setTimeout(()=>v(e=>e.trim()),100)};return window.addEventListener("orderUpdated",e),()=>window.removeEventListener("orderUpdated",e)},[]);const q={pending:{label:"Menunggu Pembayaran",icon:ee,color:"text-orange-600 bg-orange-100"},awaiting_verification:{label:"Menunggu Verifikasi",icon:ee,color:"text-yellow-600 bg-yellow-100"},paid:{label:"Dibayar",icon:B,color:"text-blue-600 bg-blue-100"},processing:{label:"Diproses",icon:z,color:"text-purple-600 bg-purple-100"},shipped:{label:"Dikirim",icon:Q,color:"text-indigo-600 bg-indigo-100"},delivered:{label:"Selesai",icon:B,color:"text-green-600 bg-green-100"},cancelled:{label:"Dibatalkan",icon:Z,color:"text-red-600 bg-red-100"}},K=u.filter(e=>{const t=""===y||e.id.toLowerCase().includes(y.toLowerCase())||e.userName.toLowerCase().includes(y.toLowerCase())||e.userEmail.toLowerCase().includes(y.toLowerCase()),s="all"===j||e.status===j,r=""===N||new Date(e.createdAt).toISOString().split("T")[0]===N;return t&&s&&r}),J=e=>{O(e),I(!0)},W=(e,t)=>{m(e,t)},V=e=>{T&&("paid"===e?p(T.id,R||"payment_verified",e):m(T.id,e),I(!1),O(null),D(""),M(""))};return Ne.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[Ne.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4",children:Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx("button",{onClick:e,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:Ne.jsx(E,{className:"w-5 h-5"})}),Ne.jsx("h1",{className:"text-xl font-bold",children:"Kelola Pesanan"})]})}),Ne.jsxs("div",{className:"p-4 space-y-4",children:[Ne.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[Ne.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[Ne.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-1",children:"Total Pesanan"}),Ne.jsx("p",{className:"text-2xl font-bold text-blue-600",children:u.length})]}),Ne.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[Ne.jsx("h4",{className:"text-sm font-medium text-orange-800 mb-1",children:"Menunggu"}),Ne.jsx("p",{className:"text-2xl font-bold text-orange-600",children:f("pending").length+f("awaiting_verification").length})]}),Ne.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[Ne.jsx("h4",{className:"text-sm font-medium text-green-800 mb-1",children:"Selesai"}),Ne.jsx("p",{className:"text-2xl font-bold text-green-600",children:f("delivered").length})]}),Ne.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[Ne.jsx("h4",{className:"text-sm font-medium text-purple-800 mb-1",children:"Total Revenue"}),Ne.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[Math.round(x()/1e3),"K"]})]})]}),Ne.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:Ne.jsxs("div",{className:"flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3",children:[Ne.jsxs("div",{className:"flex-1 relative",children:[Ne.jsx(S,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),Ne.jsx("input",{type:"text",placeholder:"Cari pesanan...",value:y,onChange:e=>v(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),Ne.jsxs("select",{value:j,onChange:e=>w(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[Ne.jsx("option",{value:"all",children:"Semua Status"}),Object.entries(q).map(([e,t])=>Ne.jsx("option",{value:e,children:t.label},e))]}),Ne.jsx("input",{type:"date",value:N,onChange:e=>_(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),Ne.jsx("button",{className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:Ne.jsx(me,{className:"w-4 h-4"})})]})}),Ne.jsx("div",{className:"space-y-3",children:0===K.length?Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-8 text-center",children:[Ne.jsx(z,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),Ne.jsx("p",{className:"text-gray-500",children:"Belum ada pesanan"}),Ne.jsx("p",{className:"text-sm text-gray-400",children:"Pesanan akan muncul di sini ketika ada checkout"})]}):K.map(e=>{const s=q[e.status],r=s.icon;return Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 hover:shadow-md transition-shadow",children:[Ne.jsxs("div",{className:"flex items-center justify-between mb-3",children:[Ne.jsxs("div",{children:[Ne.jsxs("p",{className:"font-semibold text-lg",children:["#",e.id]}),Ne.jsxs("p",{className:"text-sm text-gray-600",children:[e.userName," • ",e.userEmail]}),Ne.jsx("p",{className:"text-xs text-gray-500",children:new Date(e.createdAt).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})})]}),Ne.jsxs("div",{className:"text-right",children:[Ne.jsxs("div",{className:`inline-flex items-center space-x-1 px-3 py-1 rounded-full text-xs font-medium ${s.color}`,children:[Ne.jsx(r,{className:"w-3 h-3"}),Ne.jsx("span",{children:s.label})]}),Ne.jsxs("p",{className:"text-lg font-semibold text-pink-600 mt-1",children:["Rp ",e.finalTotal.toLocaleString("id-ID")]})]})]}),Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"text-sm text-gray-600",children:[e.items.length," item • ","transfer"===e.paymentMethod?"Transfer Bank":"COD"]}),Ne.jsxs("div",{className:"flex items-center space-x-2",children:[Ne.jsxs("button",{onClick:()=>(e=>{O(e),C(!0)})(e),className:"flex items-center space-x-1 text-blue-600 hover:text-blue-700 text-sm font-medium",children:[Ne.jsx(H,{className:"w-4 h-4"}),Ne.jsx("span",{children:"Detail"})]}),"pending"===e.status||"awaiting_verification"===e.status?Ne.jsxs("button",{onClick:()=>J(e),className:"flex items-center space-x-1 text-green-600 hover:text-green-700 text-sm font-medium",children:[Ne.jsx(B,{className:"w-4 h-4"}),Ne.jsx("span",{children:"Verifikasi"})]}):null,"paid"===e.status&&Ne.jsxs("button",{onClick:()=>W(e.id,"processing"),className:"flex items-center space-x-1 text-purple-600 hover:text-purple-700 text-sm font-medium",children:[Ne.jsx(z,{className:"w-4 h-4"}),Ne.jsx("span",{children:"Proses"})]}),"processing"===e.status&&Ne.jsxs("button",{onClick:()=>W(e.id,"shipped"),className:"flex items-center space-x-1 text-indigo-600 hover:text-indigo-700 text-sm font-medium",children:[Ne.jsx(Q,{className:"w-4 h-4"}),Ne.jsx("span",{children:"Kirim"})]}),"shipped"===e.status&&Ne.jsxs("button",{onClick:()=>W(e.id,"delivered"),className:"flex items-center space-x-1 text-green-600 hover:text-green-700 text-sm font-medium",children:[Ne.jsx(B,{className:"w-4 h-4"}),Ne.jsx("span",{children:"Selesai"})]}),("owner"===(null==t?void 0:t.role)||"admin"===(null==t?void 0:t.role))&&Ne.jsxs("button",{onClick:()=>{return t=e.id,void(window.confirm("Apakah Anda yakin ingin menghapus pesanan ini?")&&g(t));var t},className:"flex items-center space-x-1 text-red-600 hover:text-red-700 text-sm font-medium",children:[Ne.jsx(Z,{className:"w-4 h-4"}),Ne.jsx("span",{children:"Batal"})]})]})]})]},e.id)})})]}),P&&T&&Ne.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:Ne.jsxs("div",{className:"bg-white rounded-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[Ne.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4",children:Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("h2",{className:"text-xl font-bold text-gray-800",children:["Detail Pesanan #",T.id]}),Ne.jsx("button",{onClick:()=>C(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:Ne.jsx(G,{className:"w-5 h-5 text-gray-500"})})]})}),Ne.jsxs("div",{className:"p-6 space-y-6",children:[Ne.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[Ne.jsxs("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center",children:[Ne.jsx(k,{className:"w-4 h-4 mr-2"}),"Informasi Pelanggan"]}),Ne.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[Ne.jsxs("div",{children:[Ne.jsx("p",{className:"text-gray-600",children:"Nama"}),Ne.jsx("p",{className:"font-medium",children:T.userName})]}),Ne.jsxs("div",{children:[Ne.jsx("p",{className:"text-gray-600",children:"Email"}),Ne.jsx("p",{className:"font-medium",children:T.userEmail})]})]})]}),Ne.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[Ne.jsxs("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center",children:[Ne.jsx(U,{className:"w-4 h-4 mr-2"}),"Informasi Pengiriman"]}),Ne.jsxs("div",{className:"space-y-2 text-sm",children:[Ne.jsxs("div",{children:[Ne.jsx("p",{className:"text-gray-600",children:"Nama Penerima"}),Ne.jsx("p",{className:"font-medium",children:(null==(s=T.shippingInfo)?void 0:s.name)||"-"})]}),Ne.jsxs("div",{children:[Ne.jsx("p",{className:"text-gray-600",children:"No. Telepon"}),Ne.jsxs("p",{className:"font-medium flex items-center",children:[Ne.jsx($,{className:"w-3 h-3 mr-1"}),(null==(r=T.shippingInfo)?void 0:r.phone)||"-"]})]}),Ne.jsxs("div",{children:[Ne.jsx("p",{className:"text-gray-600",children:"Alamat"}),Ne.jsx("p",{className:"font-medium",children:(null==(a=T.shippingInfo)?void 0:a.address)||"-"})]}),(null==(n=T.shippingInfo)?void 0:n.isDropship)&&Ne.jsx("div",{className:"mt-2 p-2 bg-yellow-100 rounded",children:Ne.jsxs("p",{className:"text-xs text-yellow-800",children:[Ne.jsx("strong",{children:"Dropship:"})," ",T.shippingInfo.dropshipName," (",T.shippingInfo.dropshipPhone,")"]})})]})]}),Ne.jsxs("div",{children:[Ne.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Detail Produk"}),Ne.jsx("div",{className:"space-y-3",children:null==(i=T.items)?void 0:i.map((e,t)=>{var s,r;return Ne.jsxs("div",{className:"flex items-center space-x-4 p-3 bg-gray-50 rounded-lg",children:[Ne.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",children:Ne.jsx(z,{className:"w-6 h-6 text-gray-400"})}),Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("p",{className:"font-medium",children:e.productName}),Ne.jsxs("p",{className:"text-sm text-gray-600",children:[null==(s=e.selectedVariant)?void 0:s.size,", ",null==(r=e.selectedVariant)?void 0:r.color," • ",e.quantity," pcs"]})]}),Ne.jsxs("div",{className:"text-right",children:[Ne.jsxs("p",{className:"font-medium",children:["Rp ",e.price.toLocaleString("id-ID")]}),Ne.jsxs("p",{className:"text-sm text-gray-600",children:["Total: Rp ",e.total.toLocaleString("id-ID")]})]})]},t)})})]}),Ne.jsx("div",{className:"border-t pt-4",children:Ne.jsxs("div",{className:"space-y-2 text-sm",children:[Ne.jsxs("div",{className:"flex justify-between",children:[Ne.jsx("span",{className:"text-gray-600",children:"Subtotal"}),Ne.jsxs("span",{className:"font-medium",children:["Rp ",null==(o=T.totalAmount)?void 0:o.toLocaleString("id-ID")]})]}),Ne.jsxs("div",{className:"flex justify-between",children:[Ne.jsx("span",{className:"text-gray-600",children:"Ongkos Kirim"}),Ne.jsxs("span",{className:"font-medium",children:["Rp ",null==(l=T.shippingCost)?void 0:l.toLocaleString("id-ID")]})]}),Ne.jsxs("div",{className:"flex justify-between text-lg font-bold pt-2 border-t",children:[Ne.jsx("span",{children:"Total"}),Ne.jsxs("span",{className:"text-pink-600",children:["Rp ",null==(c=T.finalTotal)?void 0:c.toLocaleString("id-ID")]})]})]})}),T.paymentProof&&Ne.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[Ne.jsxs("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center",children:[Ne.jsx(L,{className:"w-4 h-4 mr-2"}),"Bukti Pembayaran"]}),T.paymentProofUrl?Ne.jsx("img",{src:T.paymentProofUrl,alt:"Payment Proof",className:"w-full max-w-md rounded-lg border-2 border-green-200"}):Ne.jsx("p",{className:"text-sm text-green-800",children:"Bukti pembayaran telah tersimpan"})]}),T.notes&&Ne.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4",children:[Ne.jsx("h3",{className:"font-semibold text-gray-800 mb-2",children:"Catatan"}),Ne.jsx("p",{className:"text-sm text-gray-700",children:T.notes})]}),Ne.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t",children:[Ne.jsx("button",{onClick:()=>C(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"Tutup"}),("pending"===T.status||"awaiting_verification"===T.status)&&Ne.jsxs("button",{onClick:()=>{C(!1),J(T)},className:"px-4 py-2 bg-green-600 text-white hover:bg-green-700 rounded-lg transition-colors flex items-center space-x-2",children:[Ne.jsx(B,{className:"w-4 h-4"}),Ne.jsx("span",{children:"Verifikasi Pembayaran"})]})]})]})]})}),A&&T&&Ne.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:Ne.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full",children:[Ne.jsx("div",{className:"border-b border-gray-200 px-6 py-4",children:Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Verifikasi Pembayaran"}),Ne.jsx("button",{onClick:()=>I(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:Ne.jsx(G,{className:"w-5 h-5 text-gray-500"})})]})}),Ne.jsxs("div",{className:"p-6 space-y-4",children:[Ne.jsxs("div",{className:"text-center",children:[Ne.jsx(B,{className:"w-12 h-12 text-green-600 mx-auto mb-3"}),Ne.jsxs("h3",{className:"font-medium text-gray-800 mb-2",children:["Pesanan #",T.id]}),Ne.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Total: Rp ",null==(d=T.finalTotal)?void 0:d.toLocaleString("id-ID")]})]}),Ne.jsx("div",{className:"space-y-3",children:Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Catatan Verifikasi"}),Ne.jsx("textarea",{value:F,onChange:e=>M(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Tambahkan catatan jika diperlukan..."})]})}),Ne.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:Ne.jsxs("p",{className:"text-sm text-blue-800",children:[Ne.jsx("strong",{children:"Periksa:"})," Pastikan bukti pembayaran sudah sesuai dengan jumlah yang dibayarkan."]})}),Ne.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t",children:[Ne.jsx("button",{onClick:()=>V("cancelled"),className:"px-4 py-2 text-red-700 bg-red-100 hover:bg-red-200 rounded-lg transition-colors",children:"Tolak"}),Ne.jsxs("button",{onClick:()=>V("paid"),className:"px-4 py-2 bg-green-600 text-white hover:bg-green-700 rounded-lg transition-colors flex items-center space-x-2",children:[Ne.jsx(pe,{className:"w-4 h-4"}),Ne.jsx("span",{children:"Konfirmasi"})]})]})]})]})})]})},hn=({onBack:e,user:t})=>{const[s,r]=h.useState("sales"),[a,n]=h.useState("today"),[i,o]=h.useState((new Date).toISOString().split("T")[0]),[l,c]=h.useState((new Date).toISOString().split("T")[0]),d={sales:{totalSales:25e5,totalOrders:45,avgOrderValue:55555,topProduct:"Hijab Segi Empat Premium",topCategory:"Hijab",growth:15.5},products:{totalProducts:12,lowStock:3,outOfStock:0,topSelling:"Gamis Syari Elegant",worstSelling:"Khimar Basic",avgPrice:125e3},customers:{totalCustomers:234,newCustomers:28,activeCustomers:189,topCustomer:"Siti Nurhaliza",avgOrdersPerCustomer:2.3}},u=d[s]||d.sales;return Ne.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[Ne.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4",children:Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx("button",{onClick:e,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:Ne.jsx(E,{className:"w-5 h-5"})}),Ne.jsx("h1",{className:"text-xl font-bold",children:"Laporan"})]})}),Ne.jsxs("div",{className:"p-4 space-y-4",children:[Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Jenis Laporan"}),Ne.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[Ne.jsxs("button",{onClick:()=>r("sales"),className:"p-3 rounded-lg border-2 transition-colors "+("sales"===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"),children:[Ne.jsx(ae,{className:"w-6 h-6 mx-auto mb-2"}),Ne.jsx("p",{className:"text-sm font-medium",children:"Penjualan"})]}),Ne.jsxs("button",{onClick:()=>r("products"),className:"p-3 rounded-lg border-2 transition-colors "+("products"===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"),children:[Ne.jsx(z,{className:"w-6 h-6 mx-auto mb-2"}),Ne.jsx("p",{className:"text-sm font-medium",children:"Produk"})]}),Ne.jsxs("button",{onClick:()=>r("customers"),className:"p-3 rounded-lg border-2 transition-colors "+("customers"===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"),children:[Ne.jsx(ne,{className:"w-6 h-6 mx-auto mb-2"}),Ne.jsx("p",{className:"text-sm font-medium",children:"Pelanggan"})]}),Ne.jsxs("button",{onClick:()=>r("financial"),className:"p-3 rounded-lg border-2 transition-colors "+("financial"===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"),children:[Ne.jsx(ie,{className:"w-6 h-6 mx-auto mb-2"}),Ne.jsx("p",{className:"text-sm font-medium",children:"Keuangan"})]})]})]}),Ne.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:Ne.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:space-x-4 space-y-3 md:space-y-0",children:[Ne.jsxs("div",{className:"flex-1",children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Periode"}),Ne.jsxs("select",{value:a,onChange:e=>n(e.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[Ne.jsx("option",{value:"today",children:"Hari Ini"}),Ne.jsx("option",{value:"week",children:"Minggu Ini"}),Ne.jsx("option",{value:"month",children:"Bulan Ini"}),Ne.jsx("option",{value:"year",children:"Tahun Ini"}),Ne.jsx("option",{value:"custom",children:"Custom"})]})]}),"custom"===a&&Ne.jsxs(Ne.Fragment,{children:[Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dari"}),Ne.jsx("input",{type:"date",value:i,onChange:e=>o(e.target.value),className:"p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),Ne.jsxs("div",{children:[Ne.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sampai"}),Ne.jsx("input",{type:"date",value:l,onChange:e=>c(e.target.value),className:"p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),Ne.jsxs("button",{className:"p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[Ne.jsx(ge,{className:"w-4 h-4"}),Ne.jsx("span",{children:"Generate"})]}),Ne.jsx("button",{className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:Ne.jsx(me,{className:"w-4 h-4"})})]})}),Ne.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsxs("div",{className:"flex items-center justify-between mb-2",children:[Ne.jsxs("h3",{className:"text-sm font-medium text-gray-600",children:["Total ","sales"===s?"Penjualan":"products"===s?"Produk":"Pelanggan"]}),Ne.jsx(ie,{className:"w-4 h-4 text-green-500"})]}),Ne.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["sales"===s&&`Rp ${u.totalSales.toLocaleString("id-ID")}`,"products"===s&&u.totalProducts,"customers"===s&&u.totalCustomers,"financial"===s&&"Rp 5.2M"]}),Ne.jsx("p",{className:"text-xs text-green-600",children:"+15.5% dari periode lalu"})]}),Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsxs("div",{className:"flex items-center justify-between mb-2",children:[Ne.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Transaksi"}),Ne.jsx(z,{className:"w-4 h-4 text-blue-500"})]}),Ne.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["sales"===s&&u.totalOrders,"products"===s&&u.lowStock,"customers"===s&&u.newCustomers,"financial"===s&&"142"]}),Ne.jsxs("p",{className:"text-xs text-gray-500",children:["sales"===s&&"Total pesanan","products"===s&&"Stok rendah","customers"===s&&"Pelanggan baru","financial"===s&&"Total transaksi"]})]}),Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsxs("div",{className:"flex items-center justify-between mb-2",children:[Ne.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Rata-rata"}),Ne.jsx(fe,{className:"w-4 h-4 text-purple-500"})]}),Ne.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["sales"===s&&`Rp ${u.avgOrderValue.toLocaleString("id-ID")}`,"products"===s&&`Rp ${u.avgPrice.toLocaleString("id-ID")}`,"customers"===s&&u.avgOrdersPerCustomer,"financial"===s&&"Rp 36K"]}),Ne.jsxs("p",{className:"text-xs text-gray-500",children:["sales"===s&&"Nilai per order","products"===s&&"Harga rata-rata","customers"===s&&"Order per pelanggan","financial"===s&&"Transaksi rata-rata"]})]}),Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsxs("div",{className:"flex items-center justify-between mb-2",children:[Ne.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Terbaik"}),Ne.jsx(ae,{className:"w-4 h-4 text-orange-500"})]}),Ne.jsx("p",{className:"text-lg font-bold text-gray-800 truncate",children:u.topProduct||u.topCustomer||"Hijab"}),Ne.jsxs("p",{className:"text-xs text-gray-500 truncate",children:["sales"===s&&"Produk terlaris","products"===s&&"Produk terlaris","customers"===s&&"Pelanggan terbaik","financial"===s&&"Kategori terlaris"]})]})]}),Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[Ne.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Grafik ","sales"===s?"Penjualan":"products"===s?"Produk":"Pelanggan"]}),Ne.jsx("div",{className:"h-64 bg-gray-100 rounded-lg flex items-center justify-center",children:Ne.jsxs("div",{className:"text-center",children:[Ne.jsx(ae,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),Ne.jsx("p",{className:"text-gray-500",children:"Grafik akan ditampilkan di sini"}),Ne.jsx("p",{className:"text-sm text-gray-400",children:"Integrasi chart library diperlukan"})]})})]}),Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsxs("div",{className:"flex items-center justify-between mb-4",children:[Ne.jsxs("h3",{className:"text-lg font-semibold",children:["Detail ","sales"===s?"Penjualan":"Data"]}),Ne.jsx("button",{className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:Ne.jsx(me,{className:"w-4 h-4"})})]}),Ne.jsx("div",{className:"overflow-x-auto",children:Ne.jsxs("table",{className:"w-full text-sm",children:[Ne.jsx("thead",{children:Ne.jsxs("tr",{className:"border-b",children:[Ne.jsx("th",{className:"text-left py-2",children:"Tanggal"}),Ne.jsx("th",{className:"text-left py-2",children:"Deskripsi"}),Ne.jsx("th",{className:"text-right py-2",children:"Jumlah"}),Ne.jsx("th",{className:"text-right py-2",children:"Total"})]})}),Ne.jsxs("tbody",{children:[Ne.jsxs("tr",{className:"border-b",children:[Ne.jsx("td",{className:"py-2",children:"15 Jan 2024"}),Ne.jsx("td",{className:"py-2",children:"Penjualan Hijab Premium"}),Ne.jsx("td",{className:"text-right",children:"5"}),Ne.jsx("td",{className:"text-right font-medium",children:"Rp 425.000"})]}),Ne.jsxs("tr",{className:"border-b",children:[Ne.jsx("td",{className:"py-2",children:"14 Jan 2024"}),Ne.jsx("td",{className:"py-2",children:"Penjualan Gamis Syari"}),Ne.jsx("td",{className:"text-right",children:"3"}),Ne.jsx("td",{className:"text-right font-medium",children:"Rp 495.000"})]})]})]})})]})]})]})},mn=({onBack:e,user:t})=>{const[s,r]=h.useState(""),[a,n]=h.useState("all"),[i,o]=h.useState("all"),l=[{id:"USR001",name:"Siti Nurhaliza",email:"siti@email.com",phone:"08123456789",role:"customer",status:"active",joinDate:"2024-01-10",totalOrders:5,totalSpent:125e4},{id:"USR002",name:"Ahmad Fauzi",email:"ahmad@email.com",phone:"08234567890",role:"reseller",status:"active",joinDate:"2024-01-05",totalOrders:12,totalSpent:24e5,points:450},{id:"USR003",name:"Ratna Dewi",email:"ratna@email.com",phone:"08345678901",role:"customer",status:"active",joinDate:"2024-01-08",totalOrders:3,totalSpent:675e3},{id:"USR004",name:"Budi Santoso",email:"budi@email.com",phone:"08456789012",role:"admin",status:"active",joinDate:"2024-01-01",totalOrders:0,totalSpent:0}],c={owner:{label:"Owner",color:"text-red-600 bg-red-100",icon:le},admin:{label:"Administrator",color:"text-purple-600 bg-purple-100",icon:le},reseller:{label:"Reseller",color:"text-blue-600 bg-blue-100",icon:ue},customer:{label:"Customer",color:"text-green-600 bg-green-100",icon:ne}},d=l.filter(e=>{const t=e.name.toLowerCase().includes(s.toLowerCase())||e.email.toLowerCase().includes(s.toLowerCase()),r="all"===a||e.role===a,n="all"===i||e.status===i;return t&&r&&n});return Ne.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[Ne.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4",children:Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx("button",{onClick:e,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:Ne.jsx(E,{className:"w-5 h-5"})}),Ne.jsx("h1",{className:"text-xl font-bold",children:"Kelola Pengguna"})]}),Ne.jsxs("button",{className:"bg-white text-blue-600 px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors flex items-center space-x-2",children:[Ne.jsx(A,{className:"w-4 h-4"}),Ne.jsx("span",{children:"Tambah User"})]})]})}),Ne.jsxs("div",{className:"p-4 space-y-4",children:[Ne.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[Ne.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[Ne.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-1",children:"Total User"}),Ne.jsx("p",{className:"text-2xl font-bold text-blue-600",children:l.length}),Ne.jsx("p",{className:"text-xs text-blue-600",children:"Semua role"})]}),Ne.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[Ne.jsx("h4",{className:"text-sm font-medium text-green-800 mb-1",children:"User Aktif"}),Ne.jsx("p",{className:"text-2xl font-bold text-green-600",children:l.filter(e=>"active"===e.status).length}),Ne.jsxs("p",{className:"text-xs text-green-600",children:[Math.round(l.filter(e=>"active"===e.status).length/l.length*100),"% aktivasi"]})]}),Ne.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[Ne.jsx("h4",{className:"text-sm font-medium text-purple-800 mb-1",children:"Reseller"}),Ne.jsx("p",{className:"text-2xl font-bold text-purple-600",children:l.filter(e=>"reseller"===e.role).length}),Ne.jsx("p",{className:"text-xs text-purple-600",children:"Partner bisnis"})]}),Ne.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[Ne.jsx("h4",{className:"text-sm font-medium text-orange-800 mb-1",children:"User Baru"}),Ne.jsx("p",{className:"text-2xl font-bold text-orange-600",children:"2"}),Ne.jsx("p",{className:"text-xs text-orange-600",children:"Bulan ini"})]})]}),Ne.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:Ne.jsxs("div",{className:"flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3",children:[Ne.jsxs("div",{className:"flex-1 relative",children:[Ne.jsx(S,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),Ne.jsx("input",{type:"text",placeholder:"Cari user...",value:s,onChange:e=>r(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),Ne.jsxs("select",{value:a,onChange:e=>n(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[Ne.jsx("option",{value:"all",children:"Semua Role"}),Ne.jsx("option",{value:"customer",children:"Customer"}),Ne.jsx("option",{value:"reseller",children:"Reseller"}),Ne.jsx("option",{value:"admin",children:"Admin"}),Ne.jsx("option",{value:"owner",children:"Owner"})]}),Ne.jsxs("select",{value:i,onChange:e=>o(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[Ne.jsx("option",{value:"all",children:"Semua Status"}),Ne.jsx("option",{value:"active",children:"Aktif"}),Ne.jsx("option",{value:"inactive",children:"Non-aktif"}),Ne.jsx("option",{value:"banned",children:"Banned"})]}),Ne.jsx("button",{className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:Ne.jsx(_,{className:"w-4 h-4"})})]})}),Ne.jsx("div",{className:"space-y-3",children:d.map(e=>{const s=c[e.role],r=s.icon;return Ne.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[Ne.jsxs("div",{className:"flex items-center justify-between mb-3",children:[Ne.jsxs("div",{className:"flex items-center space-x-3",children:[Ne.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-100 to-purple-100 rounded-full flex items-center justify-center",children:Ne.jsx(ne,{className:"w-6 h-6 text-blue-600"})}),Ne.jsxs("div",{children:[Ne.jsx("p",{className:"font-semibold text-lg",children:e.name}),Ne.jsx("p",{className:"text-sm text-gray-600",children:e.email}),Ne.jsxs("p",{className:"text-xs text-gray-500",children:[e.phone," • Bergabung: ",e.joinDate]})]})]}),Ne.jsxs("div",{className:"text-right",children:[Ne.jsxs("div",{className:`inline-flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium ${s.color}`,children:[Ne.jsx(r,{className:"w-3 h-3"}),Ne.jsx("span",{children:s.label})]}),Ne.jsx("div",{className:"mt-1",children:Ne.jsxs("span",{className:"inline-flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium "+("active"===e.status?"text-green-600 bg-green-100":"text-gray-600 bg-gray-100"),children:[Ne.jsx("span",{className:"w-2 h-2 bg-current rounded-full"}),Ne.jsx("span",{children:"active"===e.status?"Aktif":"Non-aktif"})]})})]})]}),Ne.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-3",children:[Ne.jsxs("div",{className:"text-center p-2 bg-gray-50 rounded",children:[Ne.jsx("p",{className:"text-xs text-gray-600",children:"Total Order"}),Ne.jsx("p",{className:"font-semibold",children:e.totalOrders})]}),Ne.jsxs("div",{className:"text-center p-2 bg-gray-50 rounded",children:[Ne.jsx("p",{className:"text-xs text-gray-600",children:"Total Belanja"}),Ne.jsxs("p",{className:"font-semibold",children:["Rp ",e.totalSpent.toLocaleString("id-ID")]})]}),"reseller"===e.role&&Ne.jsxs("div",{className:"text-center p-2 bg-blue-50 rounded",children:[Ne.jsx("p",{className:"text-xs text-blue-600",children:"Poin Reseller"}),Ne.jsxs("p",{className:"font-semibold text-blue-600",children:[e.points||0," pts"]})]}),Ne.jsxs("div",{className:"text-center p-2 bg-gray-50 rounded",children:[Ne.jsx("p",{className:"text-xs text-gray-600",children:"User ID"}),Ne.jsx("p",{className:"font-semibold text-xs",children:e.id})]})]}),Ne.jsxs("div",{className:"flex items-center justify-between",children:[Ne.jsx("div",{className:"text-xs text-gray-500",children:"Terakhir login: 2 hari yang lalu"}),Ne.jsxs("div",{className:"flex items-center space-x-2",children:[Ne.jsx("button",{className:"p-1 text-blue-600 hover:text-blue-700 transition-colors",children:Ne.jsx(H,{className:"w-4 h-4"})}),Ne.jsx("button",{className:"p-1 text-green-600 hover:text-green-700 transition-colors",children:Ne.jsx(he,{className:"w-4 h-4"})}),"owner"===(null==t?void 0:t.role)&&Ne.jsx("button",{className:"p-1 text-red-600 hover:text-red-700 transition-colors",children:Ne.jsx(R,{className:"w-4 h-4"})})]})]})]},e.id)})})]})]})},pn=({currentPage:e,onPageChange:t})=>{const s=[{id:"home",label:"Beranda",icon:xe},{id:"flash-sale",label:"Flash Sale",icon:Y},{id:"orders",label:"Pesanan",icon:z},{id:"account",label:"⚙️ Pengaturan",icon:k}];return Ne.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg",children:Ne.jsx("div",{className:"flex",children:s.map(s=>{const r=s.icon,a=e===s.id;return Ne.jsxs("button",{onClick:()=>t(s.id),className:"flex-1 flex flex-col items-center py-3 px-2 transition-colors "+(a?"text-pink-600 bg-pink-50":"text-gray-600 hover:text-pink-600 hover:bg-gray-50"),children:[Ne.jsx(r,{className:"w-6 h-6 mb-1 "+(a?"text-pink-600":"text-gray-600")}),Ne.jsx("span",{className:"text-xs font-medium "+(a?"text-pink-600":"text-gray-600"),children:s.label})]},s.id)})})})};function gn(){console.log("🔥 FINAL VERSION 9.0 - SUPABASE AUTH! 🔥");const[e,s]=h.useState("home"),[r,a]=h.useState(null),[n,i]=h.useState(!1),{products:o,loading:l,updateProductStock:c}=cn(),{addOrder:d}=Ee(),{user:m,loading:p,login:g,logout:f}=en(),{cartItems:x,loading:b,addToCart:y,removeFromCart:v,updateCartItem:j}=(e=>{const[s,r]=h.useState([]),[a,n]=h.useState(!1),i=e=>u(t,null,function*(){if(e){n(!0);try{const{data:t,error:s}=yield on.from("cart_items").select("*").eq("user_id",e).order("added_at",{ascending:!1});if(s)throw s;r(t||[]),console.log("✅ Cart items fetched from Supabase:",(null==t?void 0:t.length)||0)}catch(t){console.error("❌ Error fetching cart items:",t);const e=localStorage.getItem("azzahra_cart");if(e)try{const t=JSON.parse(e);r(t)}catch(s){console.error("❌ Error parsing localStorage cart:",s)}}finally{n(!1)}}});return h.useEffect(()=>{e?i(e):r([])},[e]),{cartItems:s,loading:a,fetchCartItems:i,addToCart:(s,a,n,i="customer")=>u(t,null,function*(){var t;if(!e)return console.error("❌ No user ID provided for cart operation"),{success:!1,error:"User not logged in"};const i={user_id:e,product_id:s.id,product_name:s.name,product_image:(null==(t=s.images)?void 0:t[0])||"",variant_size:null==a?void 0:a.size,variant_color:null==a?void 0:a.color,quantity:n,price:s.price,reseller_price:s.resellerPrice||s.price,cart_id:`${s.id}-${(null==a?void 0:a.size)||"default"}-${(null==a?void 0:a.color)||"default"}`,added_at:(new Date).toISOString()};try{const{data:t}=yield on.from("cart_items").select("*").eq("user_id",e).eq("cart_id",i.cart_id);if(t&&t.length>0){const e=t[0],{data:s,error:a}=yield on.from("cart_items").update({quantity:e.quantity+n,added_at:(new Date).toISOString()}).eq("id",e.id).select().single();if(a)throw a;return r(t=>t.map(t=>t.id===e.id?s:t)),console.log("✅ Cart item updated in Supabase"),{success:!0,data:s}}{const{data:e,error:t}=yield on.from("cart_items").insert(i).select().single();if(t)throw t;return r(t=>[e,...t]),console.log("✅ Cart item added to Supabase"),{success:!0,data:e}}}catch(o){return console.error("❌ Error adding to cart:",o),{success:!1,error:o.message}}}),updateCartItem:(s,a)=>u(t,null,function*(){if(!e)return{success:!1,error:"User not logged in"};try{const{data:t,error:n}=yield on.from("cart_items").update({quantity:a}).eq("user_id",e).eq("cart_id",s).select().single();if(n)throw n;return r(e=>e.map(e=>e.cart_id===s?t:e)),{success:!0,data:t}}catch(t){return console.error("❌ Error updating cart item:",t),{success:!1,error:t.message}}}),removeFromCart:s=>u(t,null,function*(){if(!e)return{success:!1,error:"User not logged in"};try{const{error:t}=yield on.from("cart_items").delete().eq("user_id",e).eq("cart_id",s);if(t)throw t;return r(e=>e.filter(e=>e.cart_id!==s)),console.log("✅ Cart item removed from Supabase"),{success:!0}}catch(t){return console.error("❌ Error removing from cart:",t),{success:!1,error:t.message}}}),clearCart:()=>u(t,null,function*(){if(!e)return{success:!1,error:"User not logged in"};try{const{error:t}=yield on.from("cart_items").delete().eq("user_id",e);if(t)throw t;return r([]),console.log("✅ Cart cleared in Supabase"),{success:!0}}catch(t){return console.error("❌ Error clearing cart:",t),{success:!1,error:t.message}}}),calculateTotals:(e="customer")=>{const t=s.reduce((t,s)=>t+("reseller"===e?s.reseller_price:s.price)*s.quantity,0),r=s.length>0?15e3:0;return{subtotal:t,shipping:r,total:t+r}}}})(null==m?void 0:m.id),w=p||l||b;h.useEffect(()=>{console.log("🚀 App initializing with Supabase integration..."),u(t,null,function*(){console.log("🔍 Testing Supabase connection...");try{const{data:e,error:t}=yield on.from("products").select("count").single();if(t)return console.error("❌ Supabase connection failed:",t),{success:!1,error:t.message};console.log("✅ Supabase connection successful!"),console.log("📊 Products count:",(null==e?void 0:e.count)||0);const{data:s,error:r}=yield on.from("products").select("*").limit(5);return r?(console.error("❌ Error fetching products:",r),{success:!1,error:r.message}):(console.log("📦 Sample products:",(null==s?void 0:s.length)||0,"items"),null==s||s.forEach((e,t)=>{console.log(`  ${t+1}. ${e.name} - Rp${e.price}`)}),{success:!0,productsCount:(null==e?void 0:e.count)||0,sampleProducts:s||[]})}catch(e){return console.error("❌ Unexpected error:",e),{success:!1,error:"Unexpected error occurred"}}}).then(e=>{e.success?console.log("✅ Supabase integration ready!"):console.error("❌ Supabase connection failed:",e.error)}),console.log("🔍 Checking localStorage..."),Se.initializeApp(),Se.validateAndSyncFeaturedProducts(),console.log("🚀 App initialized with featured products validation"),console.log("🔐 User authentication is now handled by Supabase Auth"),console.log("ℹ️ Cart is now managed by Supabase"),console.log("✅ App initialization complete")},[]);const N=e=>{a(e),s("product-detail")},k=()=>{i(!0)},S=e=>u(this,null,function*(){i(!1);const t=yield g(e.email,e.password);t.success?console.log("✅ User logged in via Supabase Auth:",e.name):(console.error("❌ Login failed:",t.error),alert("Login gagal: "+t.error),i(!0))}),_=()=>u(this,null,function*(){console.log("🔃 User logging out");const e=yield f();e.success?(s("home"),console.log("✅ User logged out via Supabase Auth")):console.error("❌ Logout failed:",e.error)}),P=(e,t,s)=>u(this,null,function*(){if(m)try{const r=yield y(e,t,s,m.role);r.success?(console.log("✅ Product added to Supabase cart"),alert("Produk berhasil ditambahkan ke keranjang!")):(console.error("❌ Failed to add to cart:",r.error),alert("Gagal menambahkan ke keranjang: "+r.error))}catch(r){console.error("❌ Error adding to cart:",r),alert("Terjadi kesalahan saat menambahkan ke keranjang")}else k()}),E=e=>{if(!m)return void k();const t={size:e.variants.sizes[0],color:e.variants.colors[0]};P(e,t,1)},C=(e,t,r)=>{m?(P(e,t,r),setTimeout(()=>{s("checkout")},500)):k()},T=(e,t)=>u(this,null,function*(){try{const s=yield j(e,Math.max(1,t));s.success?console.log("✅ Cart quantity updated in Supabase"):console.error("❌ Failed to update cart quantity:",s.error)}catch(s){console.error("❌ Error updating cart quantity:",s)}}),O=e=>u(this,null,function*(){try{const t=yield v(e);t.success?console.log("✅ Item removed from Supabase cart"):console.error("❌ Failed to remove from cart:",t.error)}catch(t){console.error("❌ Error removing from cart:",t)}}),A=e=>{const t="AZF"+Date.now().toString().slice(-8);return d({id:t,userId:m.id,userName:m.name,userEmail:m.email,items:x.map(e=>({productId:e.product_id,productName:e.product_name,selectedVariant:{size:e.variant_size,color:e.variant_color},quantity:e.quantity,price:"reseller"===(null==m?void 0:m.role)?e.reseller_price:e.price,total:("reseller"===(null==m?void 0:m.role)?e.reseller_price:e.price)*e.quantity})),shippingInfo:e.shippingInfo,paymentMethod:e.paymentMethod,status:"pending",totalAmount:I(),shippingCost:15e3,finalTotal:I()+15e3,notes:e.notes}),x.forEach(e=>{c(e.id,e.quantity)}),setCartItems([]),localStorage.removeItem("azzahra_cart"),console.log("Cart cleared after order completion"),t},I=()=>x.reduce((e,t)=>e+("reseller"===(null==m?void 0:m.role)?t.reseller_price:t.price)*t.quantity,0),R=()=>{s("cart")},D=()=>{s("checkout")},$=()=>{s("flash-sale")},U=()=>{s("admin-products")},L=()=>{s("admin-orders")},z=()=>{s("admin-reports")},B=()=>{s("admin-users")};return Ne.jsx(Ce,{children:Ne.jsxs("div",{className:"min-h-screen bg-gray-50",children:[(()=>{if(w)return Ne.jsx("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 to-purple-50 flex items-center justify-center",children:Ne.jsxs("div",{className:"text-center",children:[Ne.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),Ne.jsx("p",{className:"text-gray-600",children:"Memuat aplikasi..."})]})});if(n)return Ne.jsx(sn,{onSuccess:S,onClose:()=>i(!1)});switch(e){case"home":default:return Ne.jsx(Ie,{user:m,cartItems:x,products:o,loading:l,onProductClick:N,onLoginRequired:k,onCartClick:R,onAddToCart:E,onNavigateToFlashSale:$});case"flash-sale":return Ne.jsx(an,{user:m,cartItems:x,products:o,loading:l,onProductClick:N,onLoginRequired:k,onCartClick:R,onAddToCart:E});case"orders":return Ne.jsx(nn,{user:m});case"account":return console.log("App: Rendering AccountPage with user:",m),console.log("App: isLoading state:",w),Ne.jsx(ln,{user:m,onLogout:_,onNavigateToAdminProducts:U,onNavigateToAdminOrders:L,onNavigateToAdminReports:z,onNavigateToAdminUsers:B});case"admin-products":return console.log("App: Rendering AdminProductsPage with user:",m),Ne.jsx(dn,{onBack:()=>s("account"),user:m});case"admin-orders":return console.log("App: Rendering AdminOrdersPage with user:",m),Ne.jsx(un,{onBack:()=>s("account"),user:m});case"admin-reports":return console.log("App: Rendering AdminReportsPage with user:",m),Ne.jsx(hn,{onBack:()=>s("account"),user:m});case"admin-users":return console.log("App: Rendering AdminUsersPage with user:",m),Ne.jsx(mn,{onBack:()=>s("account"),user:m});case"product-detail":return Ne.jsx(Re,{product:r,user:m,onBack:()=>s("home"),onLoginRequired:k,onAddToCart:P,onBuyNow:C,onNavigateToCart:()=>s("cart")});case"cart":return Ne.jsx(De,{cartItems:x,user:m,updateQuantity:T,removeFromCart:O,getTotalPrice:I,onBack:()=>s("home"),onCheckout:D});case"checkout":return Ne.jsx(Le,{cartItems:x,user:m,getTotalPrice:I,clearCart:A,onBack:()=>s("cart")})}})(),!n&&!e.startsWith("admin-")&&Ne.jsx(pn,{currentPage:e,onPageChange:s})]})})}function fn(){return Ne.jsx(Pe,{children:Ne.jsx(gn,{})})}je(document.getElementById("root")).render(Ne.jsx(h.StrictMode,{children:Ne.jsx(fn,{})}))}},function(){return ye||(0,be[a(be)[0]])((ye={exports:{}}).exports,ye),ye.exports});export default ve();
