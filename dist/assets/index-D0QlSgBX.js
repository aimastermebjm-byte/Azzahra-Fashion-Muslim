var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertyNames,n=Object.getOwnPropertySymbols,i=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=Reflect.get,c=(t,s,r)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r,d=(e,t)=>{for(var s in t||(t={}))a.call(t,s)&&c(e,s,t[s]);if(n)for(var s of n(t))o.call(t,s)&&c(e,s,t[s]);return e},u=(e,r)=>t(e,s(r)),h=(e,t)=>{var s={};for(var r in e)a.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&n)for(var r of n(e))t.indexOf(r)<0&&o.call(e,r)&&(s[r]=e[r]);return s},m=(e,t,s)=>c(e,"symbol"!=typeof t?t+"":t,s),p=(e,t,s)=>l(i(e),s,t),g=(e,t,s)=>new Promise((r,n)=>{var i=e=>{try{o(s.next(e))}catch(t){n(t)}},a=e=>{try{o(s.throw(e))}catch(t){n(t)}},o=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,a);o((s=s.apply(e,t)).next())});import{r as f,a as x,R as y}from"./vendor-BXk_ma1u.js";import{S as b,a as v,C as w,M as N,T as j,b as k,c as I,U as S,d as _,R as E,e as T,F as C,A,f as P,g as D,H as R,h as O,P as L,i as M,j as F,k as U,l as V,L as B,m as z,n as $,o as q,p as K,X as G,q as H,r as W,E as J,s as Q,t as Y,u as X,v as Z,w as ee,Z as te,x as se,y as re,z as ne,B as ie,D as ae,G as oe,I as le,J as ce,K as de,N as ue,O as he,Q as me,V as pe,W as ge,Y as fe,_ as xe,$ as ye,a0 as be,a1 as ve,a2 as we,a3 as Ne}from"./ui-CHCJI2fv.js";var je,ke,Ie=(je={"assets/index-D0QlSgBX.js"(e){!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var t={exports:{}},s={},r=f,n=Symbol.for("react.element"),i=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,s){var r,i={},c=null,d=null;for(r in void 0!==s&&(c=""+s),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)a.call(t,r)&&!l.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:n,type:e,key:c,ref:d,props:i,_owner:o.current}}s.Fragment=i,s.jsx=c,s.jsxs=c,t.exports=s;var je,ke=t.exports,Ie=x;je=Ie.createRoot,Ie.hydrateRoot;const Se={};var _e={};
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Ee=function(e){const t=[];let s=0;for(let r=0;r<e.length;r++){let n=e.charCodeAt(r);n<128?t[s++]=n:n<2048?(t[s++]=n>>6|192,t[s++]=63&n|128):55296==(64512&n)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(n=65536+((1023&n)<<10)+(1023&e.charCodeAt(++r)),t[s++]=n>>18|240,t[s++]=n>>12&63|128,t[s++]=n>>6&63|128,t[s++]=63&n|128):(t[s++]=n>>12|224,t[s++]=n>>6&63|128,t[s++]=63&n|128)}return t},Te={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let n=0;n<e.length;n+=3){const t=e[n],i=n+1<e.length,a=i?e[n+1]:0,o=n+2<e.length,l=o?e[n+2]:0,c=t>>2,d=(3&t)<<4|a>>4;let u=(15&a)<<2|l>>6,h=63&l;o||(h=64,i||(u=64)),r.push(s[c],s[d],s[u],s[h])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(Ee(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let s=0,r=0;for(;s<e.length;){const n=e[s++];if(n<128)t[r++]=String.fromCharCode(n);else if(n>191&&n<224){const i=e[s++];t[r++]=String.fromCharCode((31&n)<<6|63&i)}else if(n>239&&n<365){const i=((7&n)<<18|(63&e[s++])<<12|(63&e[s++])<<6|63&e[s++])-65536;t[r++]=String.fromCharCode(55296+(i>>10)),t[r++]=String.fromCharCode(56320+(1023&i))}else{const i=e[s++],a=e[s++];t[r++]=String.fromCharCode((15&n)<<12|(63&i)<<6|63&a)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const s=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let n=0;n<e.length;){const t=s[e.charAt(n++)],i=n<e.length?s[e.charAt(n)]:0;++n;const a=n<e.length?s[e.charAt(n)]:64;++n;const o=n<e.length?s[e.charAt(n)]:64;if(++n,null==t||null==i||null==a||null==o)throw new Ce;const l=t<<2|i>>4;if(r.push(l),64!==a){const e=i<<4&240|a>>2;if(r.push(e),64!==o){const e=a<<6&192|o;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class Ce extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Ae=function(e){return function(e){const t=Ee(e);return Te.encodeByteArray(t,!0)}(e).replace(/\./g,"")},Pe=function(e){try{return Te.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function De(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Re=()=>{try{return De().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process)return;const e=_e.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(s){return}const t=e&&Pe(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},Oe=e=>{var t,s;return null==(s=null==(t=Re())?void 0:t.emulatorHosts)?void 0:s[e]},Le=e=>{const t=Oe(e);if(!t)return;const s=t.lastIndexOf(":");if(s<=0||s+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(s+1),10);return"["===t[0]?[t.substring(1,s-1),r]:[t.substring(0,s),r]},Me=()=>{var e;return null==(e=Re())?void 0:e.config},Fe=e=>{var t;return null==(t=Re())?void 0:t[`_${e}`]};
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Ue{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,s))}}}
/**
     * @license
     * Copyright 2025 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Ve(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch(t){return!1}}function Be(e){return g(this,null,function*(){return(yield fetch(e,{credentials:"include"})).ok})}
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function ze(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s=t||"demo-project",r=e.iat||0,n=e.sub||e.user_id;if(!n)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const i=d({iss:`https://securetoken.google.com/${s}`,aud:s,iat:r,exp:r+3600,auth_time:r,sub:n,user_id:n,firebase:{sign_in_provider:"custom",identities:{}}},e);return[Ae(JSON.stringify({alg:"none",type:"JWT"})),Ae(JSON.stringify(i)),""].join(".")}const $e={};let qe=!1;function Ke(e,t){if("undefined"==typeof window||"undefined"==typeof document||!Ve(window.location.host)||$e[e]===t||$e[e]||qe)return;function s(e){return`__firebase__banner__${e}`}$e[e]=t;const r="__firebase__banner",n=function(){const e={prod:[],emulator:[]};for(const t of Object.keys($e))$e[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function i(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{qe=!0,function(){const e=document.getElementById(r);e&&e.remove()}()},e}function a(){const e=function(e){let t=document.getElementById(e),s=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),s=!0),{created:s,element:t}}(r),t=s("text"),a=document.getElementById(t)||document.createElement("span"),o=s("learnmore"),l=document.getElementById(o)||document.createElement("a"),c=s("preprendIcon"),d=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(l,o);const s=i();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(d,c),t.append(d,a,l,s),document.body.appendChild(t)}n?(a.innerText="Preview backend disconnected.",d.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(d.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',a.innerText="Preview backend running in this workspace."),a.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",a):a()}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Ge(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function He(){var e;const t=null==(e=Re())?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(s){return!1}}function We(){return!He()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Je(){return!He()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Qe(){try{return"object"==typeof indexedDB}catch(e){return!1}}class Ye extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name="FirebaseError",Object.setPrototypeOf(this,Ye.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Xe.prototype.create)}}class Xe{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},r=`${this.service}/${e}`,n=this.errors[e],i=n?function(e,t){return e.replace(Ze,(e,s)=>{const r=t[s];return null!=r?String(r):`<${s}?>`})}(n,s):"Error",a=`${this.serviceName}: ${i} (${r}).`;return new Ye(r,a,s)}}const Ze=/\{\$([^}]+)}/g;function et(e,t){if(e===t)return!0;const s=Object.keys(e),r=Object.keys(t);for(const n of s){if(!r.includes(n))return!1;const s=e[n],i=t[n];if(tt(s)&&tt(i)){if(!et(s,i))return!1}else if(s!==i)return!1}for(const n of r)if(!s.includes(n))return!1;return!0}function tt(e){return null!==e&&"object"==typeof e}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function st(e){const t=[];for(const[s,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(s)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(s)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function rt(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[s,r]=e.split("=");t[decodeURIComponent(s)]=decodeURIComponent(r)}}),t}function nt(e){const t=e.indexOf("?");if(!t)return"";const s=e.indexOf("#",t);return e.substring(t,s>0?s:void 0)}class it{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,s){let r;if(void 0===e&&void 0===t&&void 0===s)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const s of t)if(s in e&&"function"==typeof e[s])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:s},void 0===r.next&&(r.next=at),void 0===r.error&&(r.error=at),void 0===r.complete&&(r.complete=at);const n=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),n}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(s){"undefined"!=typeof console&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function at(){}
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function ot(e){return e&&e._delegate?e._delegate:e}class lt{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const ct="[DEFAULT]";
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class dt{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new Ue;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&e.resolve(s)}catch(s){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const s=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!=(t=null==e?void 0:e.optional)&&t;if(!this.isInitialized(s)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:s})}catch(n){if(r)return null;throw n}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(e))try{this.getOrInitializeService({instanceIdentifier:ct})}catch(t){}for(const[e,s]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:r});s.resolve(e)}catch(t){}}}}clearInstance(e=ct){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return g(this,null,function*(){const e=Array.from(this.instances.values());yield Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])})}isComponentSet(){return null!=this.component}isInitialized(e=ct){return this.instances.has(e)}getOptions(e=ct){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[n,i]of this.instancesDeferred.entries())s===this.normalizeInstanceIdentifier(n)&&i.resolve(r);return r}onInit(e,t){var s;const r=this.normalizeInstanceIdentifier(t),n=null!=(s=this.onInitCallbacks.get(r))?s:new Set;n.add(e),this.onInitCallbacks.set(r,n);const i=this.instances.get(r);return i&&e(i,r),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const n of s)try{n(e,t)}catch(r){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===ct?void 0:r),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch(n){}var r;return s||null}normalizeInstanceIdentifier(e=ct){return this.component?this.component.multipleInstances?e:ct:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ut{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new dt(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var ht,mt;(mt=ht||(ht={}))[mt.DEBUG=0]="DEBUG",mt[mt.VERBOSE=1]="VERBOSE",mt[mt.INFO=2]="INFO",mt[mt.WARN=3]="WARN",mt[mt.ERROR=4]="ERROR",mt[mt.SILENT=5]="SILENT";const pt={debug:ht.DEBUG,verbose:ht.VERBOSE,info:ht.INFO,warn:ht.WARN,error:ht.ERROR,silent:ht.SILENT},gt=ht.INFO,ft={[ht.DEBUG]:"log",[ht.VERBOSE]:"log",[ht.INFO]:"info",[ht.WARN]:"warn",[ht.ERROR]:"error"},xt=(e,t,...s)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),n=ft[t];if(!n)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[n](`[${r}]  ${e.name}:`,...s)};class yt{constructor(e){this.name=e,this._logLevel=gt,this._logHandler=xt,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ht))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?pt[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ht.DEBUG,...e),this._logHandler(this,ht.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ht.VERBOSE,...e),this._logHandler(this,ht.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ht.INFO,...e),this._logHandler(this,ht.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ht.WARN,...e),this._logHandler(this,ht.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ht.ERROR,...e),this._logHandler(this,ht.ERROR,...e)}}let bt,vt;const wt=new WeakMap,Nt=new WeakMap,jt=new WeakMap,kt=new WeakMap,It=new WeakMap;let St={get(e,t,s){if(e instanceof IDBTransaction){if("done"===t)return Nt.get(e);if("objectStoreNames"===t)return e.objectStoreNames||jt.get(e);if("store"===t)return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return Tt(e[t])},set:(e,t,s)=>(e[t]=s,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function _t(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(vt||(vt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(Ct(this),t),Tt(wt.get(this))}:function(...t){return Tt(e.apply(Ct(this),t))}:function(t,...s){const r=e.call(Ct(this),t,...s);return jt.set(r,t.sort?t.sort():[t]),Tt(r)}}function Et(e){return"function"==typeof e?_t(e):(e instanceof IDBTransaction&&function(e){if(Nt.has(e))return;const t=new Promise((t,s)=>{const r=()=>{e.removeEventListener("complete",n),e.removeEventListener("error",i),e.removeEventListener("abort",i)},n=()=>{t(),r()},i=()=>{s(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",n),e.addEventListener("error",i),e.addEventListener("abort",i)});Nt.set(e,t)}(e),t=e,(bt||(bt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,St):e);var t}function Tt(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,s)=>{const r=()=>{e.removeEventListener("success",n),e.removeEventListener("error",i)},n=()=>{t(Tt(e.result)),r()},i=()=>{s(e.error),r()};e.addEventListener("success",n),e.addEventListener("error",i)});return t.then(t=>{t instanceof IDBCursor&&wt.set(t,e)}).catch(()=>{}),It.set(t,e),t}(e);if(kt.has(e))return kt.get(e);const t=Et(e);return t!==e&&(kt.set(e,t),It.set(t,e)),t}const Ct=e=>It.get(e),At=["get","getKey","getAll","getAllKeys","count"],Pt=["put","add","delete","clear"],Dt=new Map;function Rt(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Dt.get(t))return Dt.get(t);const s=t.replace(/FromIndex$/,""),r=t!==s,n=Pt.includes(s);if(!(s in(r?IDBIndex:IDBObjectStore).prototype)||!n&&!At.includes(s))return;const i=function(e,...t){return g(this,null,function*(){const i=this.transaction(e,n?"readwrite":"readonly");let a=i.store;return r&&(a=a.index(t.shift())),(yield Promise.all([a[s](...t),n&&i.done]))[0]})};return Dt.set(t,i),i}var Ot;St=u(d({},Ot=St),{get:(e,t,s)=>Rt(e,t)||Ot.get(e,t,s),has:(e,t)=>!!Rt(e,t)||Ot.has(e,t)});
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Lt{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const Mt="@firebase/app",Ft="0.14.4",Ut=new yt("@firebase/app"),Vt="@firebase/app-compat",Bt="@firebase/analytics-compat",zt="@firebase/analytics",$t="@firebase/app-check-compat",qt="@firebase/app-check",Kt="@firebase/auth",Gt="@firebase/auth-compat",Ht="@firebase/database",Wt="@firebase/data-connect",Jt="@firebase/database-compat",Qt="@firebase/functions",Yt="@firebase/functions-compat",Xt="@firebase/installations",Zt="@firebase/installations-compat",es="@firebase/messaging",ts="@firebase/messaging-compat",ss="@firebase/performance",rs="@firebase/performance-compat",ns="@firebase/remote-config",is="@firebase/remote-config-compat",as="@firebase/storage",os="@firebase/storage-compat",ls="@firebase/firestore",cs="@firebase/ai",ds="@firebase/firestore-compat",us="firebase",hs="[DEFAULT]",ms={[Mt]:"fire-core",[Vt]:"fire-core-compat",[zt]:"fire-analytics",[Bt]:"fire-analytics-compat",[qt]:"fire-app-check",[$t]:"fire-app-check-compat",[Kt]:"fire-auth",[Gt]:"fire-auth-compat",[Ht]:"fire-rtdb",[Wt]:"fire-data-connect",[Jt]:"fire-rtdb-compat",[Qt]:"fire-fn",[Yt]:"fire-fn-compat",[Xt]:"fire-iid",[Zt]:"fire-iid-compat",[es]:"fire-fcm",[ts]:"fire-fcm-compat",[ss]:"fire-perf",[rs]:"fire-perf-compat",[ns]:"fire-rc",[is]:"fire-rc-compat",[as]:"fire-gcs",[os]:"fire-gcs-compat",[ls]:"fire-fst",[ds]:"fire-fst-compat",[cs]:"fire-vertex","fire-js":"fire-js",[us]:"fire-js-all"},ps=new Map,gs=new Map,fs=new Map;function xs(e,t){try{e.container.addComponent(t)}catch(s){Ut.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,s)}}function ys(e){const t=e.name;if(fs.has(t))return Ut.debug(`There were multiple attempts to register component ${t}.`),!1;fs.set(t,e);for(const s of ps.values())xs(s,e);for(const s of gs.values())xs(s,e);return!0}function bs(e,t){const s=e.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),e.container.getProvider(t)}function vs(e){return null!=e&&void 0!==e.settings}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const ws=new Xe("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Ns{constructor(e,t,s){this._isDeleted=!1,this._options=d({},e),this._config=d({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new lt("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ws.create("app-deleted",{appName:this._name})}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const js="12.4.0";function ks(e,t={}){let s=e;"object"!=typeof t&&(t={name:t});const r=d({name:hs,automaticDataCollectionEnabled:!0},t),n=r.name;if("string"!=typeof n||!n)throw ws.create("bad-app-name",{appName:String(n)});if(s||(s=Me()),!s)throw ws.create("no-options");const i=ps.get(n);if(i){if(et(s,i.options)&&et(r,i.config))return i;throw ws.create("duplicate-app",{appName:n})}const a=new ut(n);for(const l of fs.values())a.addComponent(l);const o=new Ns(s,r,a);return ps.set(n,o),o}function Is(e=hs){const t=ps.get(e);if(!t&&e===hs&&Me())return ks();if(!t)throw ws.create("no-app",{appName:e});return t}function Ss(e,t,s){var r;let n=null!=(r=ms[e])?r:e;s&&(n+=`-${s}`);const i=n.match(/\s|\//),a=t.match(/\s|\//);if(i||a){const e=[`Unable to register library "${n}" with version "${t}":`];return i&&e.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Ut.warn(e.join(" "))}ys(new lt(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const _s="firebase-heartbeat-store";let Es=null;function Ts(){return Es||(Es=function(e,t,{blocked:s,upgrade:r,blocking:n,terminated:i}={}){const a=indexedDB.open(e,t),o=Tt(a);return r&&a.addEventListener("upgradeneeded",e=>{r(Tt(a.result),e.oldVersion,e.newVersion,Tt(a.transaction),e)}),s&&a.addEventListener("blocked",e=>s(e.oldVersion,e.newVersion,e)),o.then(e=>{i&&e.addEventListener("close",()=>i()),n&&e.addEventListener("versionchange",e=>n(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(_s)}catch(s){console.warn(s)}}}).catch(e=>{throw ws.create("idb-open",{originalErrorMessage:e.message})})),Es}function Cs(e,t){return g(this,null,function*(){try{const s=(yield Ts()).transaction(_s,"readwrite"),r=s.objectStore(_s);yield r.put(t,As(e)),yield s.done}catch(s){if(s instanceof Ye)Ut.warn(s.message);else{const e=ws.create("idb-set",{originalErrorMessage:null==s?void 0:s.message});Ut.warn(e.message)}}})}function As(e){return`${e.name}!${e.options.appId}`}
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ps{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Rs(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}triggerHeartbeat(){return g(this,null,function*(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Ds();if(null==(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,null==(null==(t=this._heartbeatsCache)?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(e=>e.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:s}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,s=e[0].date;for(let r=1;r<e.length;r++)e[r].date<s&&(s=e[r].date,t=r);return t}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(s){Ut.warn(s)}})}getHeartbeatsHeader(){return g(this,null,function*(){var e;try{if(null===this._heartbeatsCache&&(yield this._heartbeatsCachePromise),null==(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=Ds(),{heartbeatsToSend:s,unsentEntries:r}=function(e,t=1024){const s=[];let r=e.slice();for(const n of e){const e=s.find(e=>e.agent===n.agent);if(e){if(e.dates.push(n.date),Os(s)>t){e.dates.pop();break}}else if(s.push({agent:n.agent,dates:[n.date]}),Os(s)>t){s.pop();break}r=r.slice(1)}return{heartbeatsToSend:s,unsentEntries:r}}(this._heartbeatsCache.heartbeats),n=Ae(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}catch(t){return Ut.warn(t),""}})}}function Ds(){return(new Date).toISOString().substring(0,10)}class Rs{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return g(this,null,function*(){return!!Qe()&&new Promise((e,t)=>{try{let s=!0;const r="validate-browser-context-for-indexeddb-analytics-module",n=self.indexedDB.open(r);n.onsuccess=()=>{n.result.close(),s||self.indexedDB.deleteDatabase(r),e(!0)},n.onupgradeneeded=()=>{s=!1},n.onerror=()=>{var e;t((null==(e=n.error)?void 0:e.message)||"")}}catch(s){t(s)}}).then(()=>!0).catch(()=>!1)})}read(){return g(this,null,function*(){if(yield this._canUseIndexedDBPromise){const e=yield function(e){return g(this,null,function*(){try{const t=(yield Ts()).transaction(_s),s=yield t.objectStore(_s).get(As(e));return yield t.done,s}catch(t){if(t instanceof Ye)Ut.warn(t.message);else{const e=ws.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});Ut.warn(e.message)}}})}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}})}overwrite(e){return g(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){const s=yield this.read();return Cs(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}})}add(e){return g(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){const s=yield this.read();return Cs(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}})}}function Os(e){return Ae(JSON.stringify({version:2,heartbeats:e})).length}var Ls;Ls="",ys(new lt("platform-logger",e=>new Lt(e),"PRIVATE")),ys(new lt("heartbeat",e=>new Ps(e),"PRIVATE")),Ss(Mt,Ft,Ls),Ss(Mt,Ft,"esm2020"),Ss("fire-js",""),
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
Ss("firebase","12.4.0","app");var Ms,Fs,Us="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};
/** @license
    Copyright The Closure Library Authors.
    SPDX-License-Identifier: Apache-2.0
    */(function(){var e;
/** @license
      
       Copyright The Closure Library Authors.
       SPDX-License-Identifier: Apache-2.0
      */function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function s(e,t,s){s||(s=0);const r=Array(16);if("string"==typeof t)for(var n=0;n<16;++n)r[n]=t.charCodeAt(s++)|t.charCodeAt(s++)<<8|t.charCodeAt(s++)<<16|t.charCodeAt(s++)<<24;else for(n=0;n<16;++n)r[n]=t[s++]|t[s++]<<8|t[s++]<<16|t[s++]<<24;t=e.g[0],s=e.g[1],n=e.g[2];let i,a=e.g[3];i=t+(a^s&(n^a))+r[0]+3614090360&4294967295,i=a+(n^(t=s+(i<<7&4294967295|i>>>25))&(s^n))+r[1]+3905402710&4294967295,a=t+(i<<12&4294967295|i>>>20),i=n+(s^a&(t^s))+r[2]+606105819&4294967295,i=s+(t^(n=a+(i<<17&4294967295|i>>>15))&(a^t))+r[3]+3250441966&4294967295,i=t+(a^(s=n+(i<<22&4294967295|i>>>10))&(n^a))+r[4]+4118548399&4294967295,i=a+(n^(t=s+(i<<7&4294967295|i>>>25))&(s^n))+r[5]+1200080426&4294967295,a=t+(i<<12&4294967295|i>>>20),i=n+(s^a&(t^s))+r[6]+2821735955&4294967295,i=s+(t^(n=a+(i<<17&4294967295|i>>>15))&(a^t))+r[7]+4249261313&4294967295,i=t+(a^(s=n+(i<<22&4294967295|i>>>10))&(n^a))+r[8]+1770035416&4294967295,i=a+(n^(t=s+(i<<7&4294967295|i>>>25))&(s^n))+r[9]+2336552879&4294967295,a=t+(i<<12&4294967295|i>>>20),i=n+(s^a&(t^s))+r[10]+4294925233&4294967295,i=s+(t^(n=a+(i<<17&4294967295|i>>>15))&(a^t))+r[11]+2304563134&4294967295,i=t+(a^(s=n+(i<<22&4294967295|i>>>10))&(n^a))+r[12]+1804603682&4294967295,i=a+(n^(t=s+(i<<7&4294967295|i>>>25))&(s^n))+r[13]+4254626195&4294967295,a=t+(i<<12&4294967295|i>>>20),i=n+(s^a&(t^s))+r[14]+2792965006&4294967295,i=s+(t^(n=a+(i<<17&4294967295|i>>>15))&(a^t))+r[15]+1236535329&4294967295,i=t+(n^a&((s=n+(i<<22&4294967295|i>>>10))^n))+r[1]+4129170786&4294967295,i=a+(s^n&((t=s+(i<<5&4294967295|i>>>27))^s))+r[6]+3225465664&4294967295,a=t+(i<<9&4294967295|i>>>23),i=n+(t^s&(a^t))+r[11]+643717713&4294967295,i=s+(a^t&((n=a+(i<<14&4294967295|i>>>18))^a))+r[0]+3921069994&4294967295,i=t+(n^a&((s=n+(i<<20&4294967295|i>>>12))^n))+r[5]+3593408605&4294967295,i=a+(s^n&((t=s+(i<<5&4294967295|i>>>27))^s))+r[10]+38016083&4294967295,a=t+(i<<9&4294967295|i>>>23),i=n+(t^s&(a^t))+r[15]+3634488961&4294967295,i=s+(a^t&((n=a+(i<<14&4294967295|i>>>18))^a))+r[4]+3889429448&4294967295,i=t+(n^a&((s=n+(i<<20&4294967295|i>>>12))^n))+r[9]+568446438&4294967295,i=a+(s^n&((t=s+(i<<5&4294967295|i>>>27))^s))+r[14]+3275163606&4294967295,a=t+(i<<9&4294967295|i>>>23),i=n+(t^s&(a^t))+r[3]+4107603335&4294967295,i=s+(a^t&((n=a+(i<<14&4294967295|i>>>18))^a))+r[8]+1163531501&4294967295,i=t+(n^a&((s=n+(i<<20&4294967295|i>>>12))^n))+r[13]+2850285829&4294967295,i=a+(s^n&((t=s+(i<<5&4294967295|i>>>27))^s))+r[2]+4243563512&4294967295,a=t+(i<<9&4294967295|i>>>23),i=n+(t^s&(a^t))+r[7]+1735328473&4294967295,i=s+(a^t&((n=a+(i<<14&4294967295|i>>>18))^a))+r[12]+2368359562&4294967295,i=t+((s=n+(i<<20&4294967295|i>>>12))^n^a)+r[5]+4294588738&4294967295,i=a+((t=s+(i<<4&4294967295|i>>>28))^s^n)+r[8]+2272392833&4294967295,a=t+(i<<11&4294967295|i>>>21),i=n+(a^t^s)+r[11]+1839030562&4294967295,i=s+((n=a+(i<<16&4294967295|i>>>16))^a^t)+r[14]+4259657740&4294967295,i=t+((s=n+(i<<23&4294967295|i>>>9))^n^a)+r[1]+2763975236&4294967295,i=a+((t=s+(i<<4&4294967295|i>>>28))^s^n)+r[4]+1272893353&4294967295,a=t+(i<<11&4294967295|i>>>21),i=n+(a^t^s)+r[7]+4139469664&4294967295,i=s+((n=a+(i<<16&4294967295|i>>>16))^a^t)+r[10]+3200236656&4294967295,i=t+((s=n+(i<<23&4294967295|i>>>9))^n^a)+r[13]+681279174&4294967295,i=a+((t=s+(i<<4&4294967295|i>>>28))^s^n)+r[0]+3936430074&4294967295,a=t+(i<<11&4294967295|i>>>21),i=n+(a^t^s)+r[3]+3572445317&4294967295,i=s+((n=a+(i<<16&4294967295|i>>>16))^a^t)+r[6]+76029189&4294967295,i=t+((s=n+(i<<23&4294967295|i>>>9))^n^a)+r[9]+3654602809&4294967295,i=a+((t=s+(i<<4&4294967295|i>>>28))^s^n)+r[12]+3873151461&4294967295,a=t+(i<<11&4294967295|i>>>21),i=n+(a^t^s)+r[15]+530742520&4294967295,i=s+((n=a+(i<<16&4294967295|i>>>16))^a^t)+r[2]+3299628645&4294967295,i=t+(n^((s=n+(i<<23&4294967295|i>>>9))|~a))+r[0]+4096336452&4294967295,i=a+(s^((t=s+(i<<6&4294967295|i>>>26))|~n))+r[7]+1126891415&4294967295,a=t+(i<<10&4294967295|i>>>22),i=n+(t^(a|~s))+r[14]+2878612391&4294967295,i=s+(a^((n=a+(i<<15&4294967295|i>>>17))|~t))+r[5]+4237533241&4294967295,i=t+(n^((s=n+(i<<21&4294967295|i>>>11))|~a))+r[12]+1700485571&4294967295,i=a+(s^((t=s+(i<<6&4294967295|i>>>26))|~n))+r[3]+2399980690&4294967295,a=t+(i<<10&4294967295|i>>>22),i=n+(t^(a|~s))+r[10]+4293915773&4294967295,i=s+(a^((n=a+(i<<15&4294967295|i>>>17))|~t))+r[1]+2240044497&4294967295,i=t+(n^((s=n+(i<<21&4294967295|i>>>11))|~a))+r[8]+1873313359&4294967295,i=a+(s^((t=s+(i<<6&4294967295|i>>>26))|~n))+r[15]+4264355552&4294967295,a=t+(i<<10&4294967295|i>>>22),i=n+(t^(a|~s))+r[6]+2734768916&4294967295,i=s+(a^((n=a+(i<<15&4294967295|i>>>17))|~t))+r[13]+1309151649&4294967295,i=t+(n^((s=n+(i<<21&4294967295|i>>>11))|~a))+r[4]+4149444226&4294967295,i=a+(s^((t=s+(i<<6&4294967295|i>>>26))|~n))+r[11]+3174756917&4294967295,a=t+(i<<10&4294967295|i>>>22),i=n+(t^(a|~s))+r[2]+718787259&4294967295,i=s+(a^((n=a+(i<<15&4294967295|i>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(n+(i<<21&4294967295|i>>>11))&4294967295,e.g[2]=e.g[2]+n&4294967295,e.g[3]=e.g[3]+a&4294967295}function r(e,t){this.h=t;const s=[];let r=!0;for(let n=e.length-1;n>=0;n--){const i=0|e[n];r&&i==t||(s[n]=i,r=!1)}this.g=s}!function(e,t){function s(){}s.prototype=t.prototype,e.F=t.prototype,e.prototype=new s,e.prototype.constructor=e,e.D=function(e,s,r){for(var n=Array(arguments.length-2),i=2;i<arguments.length;i++)n[i-2]=arguments[i];return t.prototype[s].apply(e,n)}}(t,function(){this.blockSize=-1}),t.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.v=function(e,t){void 0===t&&(t=e.length);const r=t-this.blockSize,n=this.C;let i=this.h,a=0;for(;a<t;){if(0==i)for(;a<=r;)s(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(n[i++]=e.charCodeAt(a++),i==this.blockSize){s(this,n),i=0;break}}else for(;a<t;)if(n[i++]=e[a++],i==this.blockSize){s(this,n),i=0;break}}this.h=i,this.o+=t},t.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var s=e.length-8;s<e.length;++s)e[s]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,s=0;s<4;++s)for(let r=0;r<32;r+=8)e[t++]=this.g[s]>>>r&255;return e};var n={};function i(e){return-128<=e&&e<128?function(e,t){var s=n;return Object.prototype.hasOwnProperty.call(s,e)?s[e]:s[e]=t(e)}(e,function(e){return new r([0|e],e<0?-1:0)}):new r([0|e],e<0?-1:0)}function a(e){if(isNaN(e)||!isFinite(e))return o;if(e<0)return h(a(-e));const t=[];let s=1;for(let r=0;e>=s;r++)t[r]=e/s|0,s*=4294967296;return new r(t,0)}var o=i(0),l=i(1),c=i(16777216);function d(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function u(e){return-1==e.h}function h(e){const t=e.g.length,s=[];for(let r=0;r<t;r++)s[r]=~e.g[r];return new r(s,~e.h).add(l)}function m(e,t){return e.add(h(t))}function p(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function g(e,t){this.g=e,this.h=t}function f(e,t){if(d(t))throw Error("division by zero");if(d(e))return new g(o,o);if(u(e))return t=f(h(e),t),new g(h(t.g),h(t.h));if(u(t))return t=f(e,h(t)),new g(h(t.g),t.h);if(e.g.length>30){if(u(e)||u(t))throw Error("slowDivide_ only works with positive integers.");for(var s=l,r=t;r.l(e)<=0;)s=x(s),r=x(r);var n=y(s,1),i=y(r,1);for(r=y(r,2),s=y(s,2);!d(r);){var c=i.add(r);c.l(e)<=0&&(n=n.add(s),i=c),r=y(r,1),s=y(s,1)}return t=m(e,n.j(t)),new g(n,t)}for(n=o;e.l(t)>=0;){for(s=Math.max(1,Math.floor(e.m()/t.m())),r=(r=Math.ceil(Math.log(s)/Math.LN2))<=48?1:Math.pow(2,r-48),c=(i=a(s)).j(t);u(c)||c.l(e)>0;)c=(i=a(s-=r)).j(t);d(i)&&(i=l),n=n.add(i),e=m(e,c)}return new g(n,e)}function x(e){const t=e.g.length+1,s=[];for(let r=0;r<t;r++)s[r]=e.i(r)<<1|e.i(r-1)>>>31;return new r(s,e.h)}function y(e,t){const s=t>>5;t%=32;const n=e.g.length-s,i=[];for(let r=0;r<n;r++)i[r]=t>0?e.i(r+s)>>>t|e.i(r+s+1)<<32-t:e.i(r+s);return new r(i,e.h)}(e=r.prototype).m=function(){if(u(this))return-h(this).m();let e=0,t=1;for(let s=0;s<this.g.length;s++){const r=this.i(s);e+=(r>=0?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(d(this))return"0";if(u(this))return"-"+h(this).toString(e);const t=a(Math.pow(e,6));var s=this;let r="";for(;;){const n=f(s,t).g;let i=(((s=m(s,n.j(t))).g.length>0?s.g[0]:s.h)>>>0).toString(e);if(d(s=n))return i+r;for(;i.length<6;)i="0"+i;r=i+r}},e.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return u(e=m(this,e))?-1:d(e)?0:1},e.abs=function(){return u(this)?h(this):this},e.add=function(e){const t=Math.max(this.g.length,e.g.length),s=[];let n=0;for(let r=0;r<=t;r++){let t=n+(65535&this.i(r))+(65535&e.i(r)),i=(t>>>16)+(this.i(r)>>>16)+(e.i(r)>>>16);n=i>>>16,t&=65535,i&=65535,s[r]=i<<16|t}return new r(s,-2147483648&s[s.length-1]?-1:0)},e.j=function(e){if(d(this)||d(e))return o;if(u(this))return u(e)?h(this).j(h(e)):h(h(this).j(e));if(u(e))return h(this.j(h(e)));if(this.l(c)<0&&e.l(c)<0)return a(this.m()*e.m());const t=this.g.length+e.g.length,s=[];for(var n=0;n<2*t;n++)s[n]=0;for(n=0;n<this.g.length;n++)for(let t=0;t<e.g.length;t++){const r=this.i(n)>>>16,i=65535&this.i(n),a=e.i(t)>>>16,o=65535&e.i(t);s[2*n+2*t]+=i*o,p(s,2*n+2*t),s[2*n+2*t+1]+=r*o,p(s,2*n+2*t+1),s[2*n+2*t+1]+=i*a,p(s,2*n+2*t+1),s[2*n+2*t+2]+=r*a,p(s,2*n+2*t+2)}for(e=0;e<t;e++)s[e]=s[2*e+1]<<16|s[2*e];for(e=t;e<2*t;e++)s[e]=0;return new r(s,0)},e.B=function(e){return f(this,e).h},e.and=function(e){const t=Math.max(this.g.length,e.g.length),s=[];for(let r=0;r<t;r++)s[r]=this.i(r)&e.i(r);return new r(s,this.h&e.h)},e.or=function(e){const t=Math.max(this.g.length,e.g.length),s=[];for(let r=0;r<t;r++)s[r]=this.i(r)|e.i(r);return new r(s,this.h|e.h)},e.xor=function(e){const t=Math.max(this.g.length,e.g.length),s=[];for(let r=0;r<t;r++)s[r]=this.i(r)^e.i(r);return new r(s,this.h^e.h)},t.prototype.digest=t.prototype.A,t.prototype.reset=t.prototype.u,t.prototype.update=t.prototype.v,Fs=t,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.B,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=a,r.fromString=function e(t,s){if(0==t.length)throw Error("number format error: empty string");if((s=s||10)<2||36<s)throw Error("radix out of range: "+s);if("-"==t.charAt(0))return h(e(t.substring(1),s));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');const r=a(Math.pow(s,8));let n=o;for(let o=0;o<t.length;o+=8){var i=Math.min(8,t.length-o);const e=parseInt(t.substring(o,o+i),s);i<8?(i=a(Math.pow(s,i)),n=n.j(i).add(a(e))):(n=n.j(r),n=n.add(a(e)))}return n},Ms=r}).apply(void 0!==Us?Us:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var Vs,Bs,zs,$s,qs,Ks,Gs,Hs,Ws="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};
/** @license
    Copyright The Closure Library Authors.
    SPDX-License-Identifier: Apache-2.0
    */(function(){var e,t=Object.defineProperty,s=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Ws&&Ws];for(var t=0;t<e.length;++t){var s=e[t];if(s&&s.Math==Math)return s}throw Error("Cannot find global object")}(this);function r(e,r){if(r)e:{var n=s;e=e.split(".");for(var i=0;i<e.length-1;i++){var a=e[i];if(!(a in n))break e;n=n[a]}(r=r(i=n[e=e[e.length-1]]))!=i&&null!=r&&t(n,e,{configurable:!0,writable:!0,value:r})}}r("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(e){return e||function(e){var t,s=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&s.push([t,e[t]]);return s}});
/** @license
      
       Copyright The Closure Library Authors.
       SPDX-License-Identifier: Apache-2.0
      */
var n=n||{},i=this||self;function a(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function o(e,t,s){return e.call.apply(e.bind,arguments)}function l(e,t,s){return(l=o).apply(null,arguments)}function c(e,t){var s=Array.prototype.slice.call(arguments,1);return function(){var t=s.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function d(e,t){function s(){}s.prototype=t.prototype,e.Z=t.prototype,e.prototype=new s,e.prototype.constructor=e,e.Ob=function(e,s,r){for(var n=Array(arguments.length-2),i=2;i<arguments.length;i++)n[i-2]=arguments[i];return t.prototype[s].apply(e,n)}}var u="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function h(e){const t=e.length;if(t>0){const s=Array(t);for(let r=0;r<t;r++)s[r]=e[r];return s}return[]}function m(e,t){for(let r=1;r<arguments.length;r++){const t=arguments[r];var s=typeof t;if("array"==(s="object"!=s?s:t?Array.isArray(t)?"array":s:"null")||"object"==s&&"number"==typeof t.length){s=e.length||0;const r=t.length||0;e.length=s+r;for(let n=0;n<r;n++)e[s+n]=t[n]}else e.push(t)}}function p(e){i.setTimeout(()=>{throw e},0)}function g(){var e=v;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var f=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new x,e=>e.reset());class x{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let y,b=!1,v=new class{constructor(){this.h=this.g=null}add(e,t){const s=f.get();s.set(e,t),this.h?this.h.next=s:this.g=s,this.h=s}},w=()=>{const e=Promise.resolve(void 0);y=()=>{e.then(N)}};function N(){for(var e;e=g();){try{e.h.call(e.g)}catch(s){p(s)}var t=f;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}b=!1}function j(){this.u=this.u,this.C=this.C}function k(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}j.prototype.u=!1,j.prototype.dispose=function(){this.u||(this.u=!0,this.N())},j.prototype[Symbol.dispose]=function(){this.dispose()},j.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},k.prototype.h=function(){this.defaultPrevented=!0};var I=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};i.addEventListener("test",e,t),i.removeEventListener("test",e,t)}catch(s){}return e}();function S(e){return/^[\s\xa0]*$/.test(e)}function _(e,t){k.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}d(_,k),_.prototype.init=function(e,t){const s=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==s?t=e.fromElement:"mouseout"==s&&(t=e.toElement)),this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&_.Z.h.call(this)},_.prototype.h=function(){_.Z.h.call(this);const e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var E="closure_listenable_"+(1e6*Math.random()|0),T=0;function C(e,t,s,r,n){this.listener=e,this.proxy=null,this.src=t,this.type=s,this.capture=!!r,this.ha=n,this.key=++T,this.da=this.fa=!1}function A(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function P(e,t,s){for(const r in e)t.call(s,e[r],r,e)}function D(e){const t={};for(const s in e)t[s]=e[s];return t}const R="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function O(e,t){let s,r;for(let n=1;n<arguments.length;n++){for(s in r=arguments[n],r)e[s]=r[s];for(let t=0;t<R.length;t++)s=R[t],Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}}function L(e){this.src=e,this.g={},this.h=0}function M(e,t){const s=t.type;if(s in e.g){var r,n=e.g[s],i=Array.prototype.indexOf.call(n,t,void 0);(r=i>=0)&&Array.prototype.splice.call(n,i,1),r&&(A(t),0==e.g[s].length&&(delete e.g[s],e.h--))}}function F(e,t,s,r){for(let n=0;n<e.length;++n){const i=e[n];if(!i.da&&i.listener==t&&i.capture==!!s&&i.ha==r)return n}return-1}L.prototype.add=function(e,t,s,r,n){const i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);const a=F(e,t,r,n);return a>-1?(t=e[a],s||(t.fa=!1)):((t=new C(t,this.src,i,!!r,n)).fa=s,e.push(t)),t};var U="closure_lm_"+(1e6*Math.random()|0),V={};function B(e,t,s,r,n){if(Array.isArray(t)){for(let i=0;i<t.length;i++)B(e,t[i],s,r,n);return null}return s=W(s),e&&e[E]?e.J(t,s,!!a(r)&&!!r.capture,n):function(e,t,s,r,n,i){if(!t)throw Error("Invalid event type");const o=a(n)?!!n.capture:!!n;let l=G(e);if(l||(e[U]=l=new L(e)),(s=l.add(t,s,r,o,i)).proxy)return s;if(r=function(){function e(s){return t.call(e.src,e.listener,s)}const t=K;return e}(),s.proxy=r,r.src=e,r.listener=s,e.addEventListener)I||(n=o),void 0===n&&(n=!1),e.addEventListener(t.toString(),r,n);else if(e.attachEvent)e.attachEvent(q(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return s}(e,t,s,!1,r,n)}function z(e,t,s,r,n){if(Array.isArray(t))for(var i=0;i<t.length;i++)z(e,t[i],s,r,n);else r=a(r)?!!r.capture:!!r,s=W(s),e&&e[E]?(e=e.i,(i=String(t).toString())in e.g&&(s=F(t=e.g[i],s,r,n))>-1&&(A(t[s]),Array.prototype.splice.call(t,s,1),0==t.length&&(delete e.g[i],e.h--))):e&&(e=G(e))&&(t=e.g[t.toString()],e=-1,t&&(e=F(t,s,r,n)),(s=e>-1?t[e]:null)&&$(s))}function $(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[E])M(t.i,e);else{var s=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(s,r,e.capture):t.detachEvent?t.detachEvent(q(s),r):t.addListener&&t.removeListener&&t.removeListener(r),(s=G(t))?(M(s,e),0==s.h&&(s.src=null,t[U]=null)):A(e)}}}function q(e){return e in V?V[e]:V[e]="on"+e}function K(e,t){if(e.da)e=!0;else{t=new _(t,this);const s=e.listener,r=e.ha||e.src;e.fa&&$(e),e=s.call(r,t)}return e}function G(e){return(e=e[U])instanceof L?e:null}var H="__closure_events_fn_"+(1e9*Math.random()>>>0);function W(e){return"function"==typeof e?e:(e[H]||(e[H]=function(t){return e.handleEvent(t)}),e[H])}function J(){j.call(this),this.i=new L(this),this.M=this,this.G=null}function Q(e,t){var s,r=e.G;if(r)for(s=[];r;r=r.G)s.push(r);if(e=e.M,r=t.type||t,"string"==typeof t)t=new k(t,e);else if(t instanceof k)t.target=t.target||e;else{var n=t;O(t=new k(r,e),n)}let i,a;if(n=!0,s)for(a=s.length-1;a>=0;a--)i=t.g=s[a],n=Y(i,r,!0,t)&&n;if(i=t.g=e,n=Y(i,r,!0,t)&&n,n=Y(i,r,!1,t)&&n,s)for(a=0;a<s.length;a++)i=t.g=s[a],n=Y(i,r,!1,t)&&n}function Y(e,t,s,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let n=!0;for(let i=0;i<t.length;++i){const a=t[i];if(a&&!a.da&&a.capture==s){const t=a.listener,s=a.ha||a.src;a.fa&&M(e.i,a),n=!1!==t.call(s,r)&&n}}return n&&!r.defaultPrevented}function X(e){e.g=function(e,t){if("function"!=typeof e){if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=l(e.handleEvent,e)}return Number(t)>2147483647?-1:i.setTimeout(e,t||0)}(()=>{e.g=null,e.i&&(e.i=!1,X(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}d(J,j),J.prototype[E]=!0,J.prototype.removeEventListener=function(e,t,s,r){z(this,e,t,s,r)},J.prototype.N=function(){if(J.Z.N.call(this),this.i){var e=this.i;for(const t in e.g){const s=e.g[t];for(let e=0;e<s.length;e++)A(s[e]);delete e.g[t],e.h--}}this.G=null},J.prototype.J=function(e,t,s,r){return this.i.add(String(e),t,!1,s,r)},J.prototype.K=function(e,t,s,r){return this.i.add(String(e),t,!0,s,r)};class Z extends j{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:X(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ee(e){j.call(this),this.h=e,this.g={}}d(ee,j);var te=[];function se(e){P(e.g,function(e,t){this.g.hasOwnProperty(t)&&$(e)},e),e.g={}}ee.prototype.N=function(){ee.Z.N.call(this),se(this)},ee.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var re=i.JSON.stringify,ne=i.JSON.parse,ie=class{stringify(e){return i.JSON.stringify(e,void 0)}parse(e){return i.JSON.parse(e,void 0)}};function ae(){}function oe(){}var le={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ce(){k.call(this,"d")}function de(){k.call(this,"c")}d(ce,k),d(de,k);var ue={},he=null;function me(){return he=he||new J}function pe(e){k.call(this,ue.Ia,e)}function ge(e){const t=me();Q(t,new pe(t))}function fe(e,t){k.call(this,ue.STAT_EVENT,e),this.stat=t}function xe(e){const t=me();Q(t,new fe(t,e))}function ye(e,t){k.call(this,ue.Ja,e),this.size=t}function be(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout(function(){e()},t)}function ve(){this.g=!0}function we(e,t,s,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{const i=JSON.parse(t);if(i)for(e=0;e<i.length;e++)if(Array.isArray(i[e])){var s=i[e];if(!(s.length<2)){var r=s[1];if(Array.isArray(r)&&!(r.length<1)){var n=r[0];if("noop"!=n&&"stop"!=n&&"close"!=n)for(let e=1;e<r.length;e++)r[e]=""}}}return re(i)}catch(i){return t}}(e,s)+(r?" "+r:"")})}ue.Ia="serverreachability",d(pe,k),ue.STAT_EVENT="statevent",d(fe,k),ue.Ja="timingevent",d(ye,k),ve.prototype.ua=function(){this.g=!1},ve.prototype.info=function(){};var Ne,je={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},ke={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function Ie(){}function Se(e){return encodeURIComponent(String(e))}function _e(e){var t=1;e=e.split(":");const s=[];for(;t>0&&e.length;)s.push(e.shift()),t--;return e.length&&s.push(e.join(":")),s}function Ee(e,t,s,r){this.j=e,this.i=t,this.l=s,this.S=r||1,this.V=new ee(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Te}function Te(){this.i=null,this.g="",this.h=!1}d(Ie,ae),Ie.prototype.g=function(){return new XMLHttpRequest},Ne=new Ie;var Ce={},Ae={};function Pe(e,t,s){e.M=1,e.A=rt(Xe(t)),e.u=s,e.R=!0,De(e,null)}function De(e,t){e.F=Date.now(),Le(e),e.B=Xe(e.A);var s=e.B,r=e.S;Array.isArray(r)||(r=[String(r)]),xt(s.i,"t",r),e.C=0,s=e.j.L,e.h=new Te,e.g=rs(e.j,s?t:null,!e.u),e.P>0&&(e.O=new Z(l(e.Y,e,e.g),e.P)),t=e.V,s=e.g,r=e.ba;var n="readystatechange";Array.isArray(n)||(n&&(te[0]=n.toString()),n=te);for(let i=0;i<n.length;i++){const e=B(s,n[i],r||t.handleEvent,!1,t.h||t);if(!e)break;t.g[e.key]=e}t=e.J?D(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),ge(),function(e,t,s,r,n,i){e.info(function(){if(e.g)if(i){var a="",o=i.split("&");for(let e=0;e<o.length;e++){var l=o[e].split("=");if(l.length>1){const e=l[0];l=l[1];const t=e.split("_");a=t.length>=2&&"type"==t[1]?a+(e+"=")+l+"&":a+(e+"=redacted&")}}}else a=null;else a=i;return"XMLHTTP REQ ("+r+") [attempt "+n+"]: "+t+"\n"+s+"\n"+a})}(e.i,e.v,e.B,e.l,e.S,e.u)}function Re(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function Oe(e,t){var s=e.C,r=t.indexOf("\n",s);return-1==r?Ae:(s=Number(t.substring(s,r)),isNaN(s)?Ce:(r+=1)+s>t.length?Ae:(t=t.slice(r,r+s),e.C=r+s,t))}function Le(e){e.T=Date.now()+e.H,Me(e,e.H)}function Me(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=be(l(e.aa,e),t)}function Fe(e){e.D&&(i.clearTimeout(e.D),e.D=null)}function Ue(e){0==e.j.I||e.K||Xt(e.j,e)}function Ve(e){Fe(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,se(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function Be(e,t){try{var s=e.j;if(0!=s.I&&(s.g==e||Ge(s.h,e)))if(!e.L&&Ge(s.h,e)&&3==s.I){try{var r=s.Ba.g.parse(t)}catch(d){r=null}if(Array.isArray(r)&&3==r.length){var n=r;if(0==n[0]){e:if(!s.v){if(s.g){if(!(s.g.F+3e3<e.F))break e;Yt(s),Bt(s)}Wt(s),xe(18)}}else s.xa=n[1],0<s.xa-s.K&&n[2]<37500&&s.F&&0==s.A&&!s.C&&(s.C=be(l(s.Va,s),6e3));Ke(s.h)<=1&&s.ta&&(s.ta=void 0)}else es(s,11)}else if((e.L||s.g==e)&&Yt(s),!S(t))for(n=s.Ba.g.parse(t),t=0;t<n.length;t++){let l=n[t];const d=l[0];if(!(d<=s.K))if(s.K=d,l=l[1],2==s.I)if("c"==l[0]){s.M=l[1],s.ba=l[2];const t=l[3];null!=t&&(s.ka=t,s.j.info("VER="+s.ka));const n=l[4];null!=n&&(s.za=n,s.j.info("SVER="+s.za));const d=l[5];null!=d&&"number"==typeof d&&d>0&&(r=1.5*d,s.O=r,s.j.info("backChannelRequestTimeoutMs_="+r)),r=s;const u=e.g;if(u){const e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var i=r.h;i.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(He(i,i.h),i.h=null))}if(r.G){const e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.wa=e,st(r.J,r.G,e))}}s.I=3,s.l&&s.l.ra(),s.aa&&(s.T=Date.now()-e.F,s.j.info("Handshake RTT: "+s.T+"ms"));var a=e;if((r=s).na=ss(r,r.L?r.ba:null,r.W),a.L){We(r.h,a);var o=a,c=r.O;c&&(o.H=c),o.D&&(Fe(o),Le(o)),r.g=a}else Ht(r);s.i.length>0&&$t(s)}else"stop"!=l[0]&&"close"!=l[0]||es(s,7);else 3==s.I&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?es(s,7):Vt(s):"noop"!=l[0]&&s.l&&s.l.qa(l),s.A=0)}ge()}catch(d){}}Ee.prototype.ba=function(e){e=e.target;const t=this.O;t&&3==Lt(e)?t.j():this.Y(e)},Ee.prototype.Y=function(e){try{if(e==this.g)e:{const l=Lt(this.g),c=this.g.ya();if(this.g.ca(),!(l<3)&&(3!=l||this.g&&(this.h.h||this.g.la()||Mt(this.g)))){this.K||4!=l||7==c||ge(),Fe(this);var t=this.g.ca();this.X=t;var s=function(e){if(!Re(e))return e.g.la();const t=Mt(e.g);if(""===t)return"";let s="";const r=t.length,n=4==Lt(e.g);if(!e.h.i){if("undefined"==typeof TextDecoder)return Ve(e),Ue(e),"";e.h.i=new i.TextDecoder}for(let i=0;i<r;i++)e.h.h=!0,s+=e.h.i.decode(t[i],{stream:!(n&&i==r-1)});return t.length=0,e.h.g+=s,e.C=0,e.h.g}(this);if(this.o=200==t,function(e,t,s,r,n,i,a){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+n+"]: "+t+"\n"+s+"\n"+i+" "+a})}(this.i,this.v,this.B,this.l,this.S,l,t),this.o){if(this.U&&!this.L){t:{if(this.g){var r,n=this.g;if((r=n.g?n.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!S(r)){var a=r;break t}}a=null}if(!(e=a)){this.o=!1,this.m=3,xe(12),Ve(this),Ue(this);break e}we(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Be(this,e)}if(this.R){let t;for(e=!0;!this.K&&this.C<s.length;){if(t=Oe(this,s),t==Ae){4==l&&(this.m=4,xe(14),e=!1),we(this.i,this.l,null,"[Incomplete Response]");break}if(t==Ce){this.m=4,xe(15),we(this.i,this.l,s,"[Invalid Chunk]"),e=!1;break}we(this.i,this.l,t,null),Be(this,t)}if(Re(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=l||0!=s.length||this.h.h||(this.m=1,xe(16),e=!1),this.o=this.o&&e,e){if(s.length>0&&!this.W){this.W=!0;var o=this.j;o.g==this&&o.aa&&!o.P&&(o.j.info("Great, no buffering proxy detected. Bytes received: "+s.length),Jt(o),o.P=!0,xe(11))}}else we(this.i,this.l,s,"[Invalid Chunked Response]"),Ve(this),Ue(this)}else we(this.i,this.l,s,null),Be(this,s);4==l&&Ve(this),this.o&&!this.K&&(4==l?Xt(this.j,this):(this.o=!1,Le(this)))}else(function(e){const t={};e=(e.g&&Lt(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(S(e[r]))continue;var s=_e(e[r]);const n=s[0];if("string"!=typeof(s=s[1]))continue;s=s.trim();const i=t[n]||[];t[n]=i,i.push(s)}!function(e,t){for(const s in e)t.call(void 0,e[s],s,e)}(t,function(e){return e.join(", ")})})(this.g),400==t&&s.indexOf("Unknown SID")>0?(this.m=3,xe(12)):(this.m=0,xe(13)),Ve(this),Ue(this)}}}catch(l){}},Ee.prototype.cancel=function(){this.K=!0,Ve(this)},Ee.prototype.aa=function(){this.D=null;const e=Date.now();e-this.T>=0?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.B),2!=this.M&&(ge(),xe(17)),Ve(this),this.m=2,Ue(this)):Me(this,this.T-e)};var ze=class{constructor(e,t){this.g=e,this.map=t}};function $e(e){this.l=e||10,e=i.PerformanceNavigationTiming?(e=i.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function qe(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Ke(e){return e.h?1:e.g?e.g.size:0}function Ge(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function He(e,t){e.g?e.g.add(t):e.h=t}function We(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Je(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const s of e.g.values())t=t.concat(s.G);return t}return h(e.i)}$e.prototype.cancel=function(){if(this.i=Je(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var Qe=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ye(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof Ye?(this.l=e.l,Ze(this,e.j),this.o=e.o,this.g=e.g,et(this,e.u),this.h=e.h,tt(this,yt(e.i)),this.m=e.m):e&&(t=String(e).match(Qe))?(this.l=!1,Ze(this,t[1]||"",!0),this.o=nt(t[2]||""),this.g=nt(t[3]||"",!0),et(this,t[4]),this.h=nt(t[5]||"",!0),tt(this,t[6]||"",!0),this.m=nt(t[7]||"")):(this.l=!1,this.i=new ht(null,this.l))}function Xe(e){return new Ye(e)}function Ze(e,t,s){e.j=s?nt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function et(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function tt(e,t,s){t instanceof ht?(e.i=t,function(e,t){t&&!e.j&&(mt(e),e.i=null,e.g.forEach(function(e,t){const s=t.toLowerCase();t!=s&&(pt(this,t),xt(this,s,e))},e)),e.j=t}(e.i,e.l)):(s||(t=it(t,dt)),e.i=new ht(t,e.l))}function st(e,t,s){e.i.set(t,s)}function rt(e){return st(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function nt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function it(e,t,s){return"string"==typeof e?(e=encodeURI(e).replace(t,at),s&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function at(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Ye.prototype.toString=function(){const e=[];var t=this.j;t&&e.push(it(t,ot,!0),":");var s=this.g;return(s||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(it(t,ot,!0),"@"),e.push(Se(s).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(s=this.u)&&e.push(":",String(s))),(s=this.h)&&(this.g&&"/"!=s.charAt(0)&&e.push("/"),e.push(it(s,"/"==s.charAt(0)?ct:lt,!0))),(s=this.i.toString())&&e.push("?",s),(s=this.m)&&e.push("#",it(s,ut)),e.join("")},Ye.prototype.resolve=function(e){const t=Xe(this);let s=!!e.j;s?Ze(t,e.j):s=!!e.o,s?t.o=e.o:s=!!e.g,s?t.g=e.g:s=null!=e.u;var r=e.h;if(s)et(t,e.u);else if(s=!!e.h){if("/"!=r.charAt(0))if(this.g&&!this.h)r="/"+r;else{var n=t.h.lastIndexOf("/");-1!=n&&(r=t.h.slice(0,n+1)+r)}if(".."==(n=r)||"."==n)r="";else if(-1!=n.indexOf("./")||-1!=n.indexOf("/.")){r=0==n.lastIndexOf("/",0),n=n.split("/");const e=[];for(let t=0;t<n.length;){const s=n[t++];"."==s?r&&t==n.length&&e.push(""):".."==s?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),r&&t==n.length&&e.push("")):(e.push(s),r=!0)}r=e.join("/")}else r=n}return s?t.h=r:s=""!==e.i.toString(),s?tt(t,yt(e.i)):s=!!e.m,s&&(t.m=e.m),t};var ot=/[#\/\?@]/g,lt=/[#\?:]/g,ct=/[#\?]/g,dt=/[#\?@]/g,ut=/#/g;function ht(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function mt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let s=0;s<e.length;s++){const r=e[s].indexOf("=");let n,i=null;r>=0?(n=e[s].substring(0,r),i=e[s].substring(r+1)):n=e[s],t(n,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,s){e.add(decodeURIComponent(t.replace(/\+/g," ")),s)}))}function pt(e,t){mt(e),t=bt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function gt(e,t){return mt(e),t=bt(e,t),e.g.has(t)}function ft(e,t){mt(e);let s=[];if("string"==typeof t)gt(e,t)&&(s=s.concat(e.g.get(bt(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)s=s.concat(e[t]);return s}function xt(e,t,s){pt(e,t),s.length>0&&(e.i=null,e.g.set(bt(e,t),h(s)),e.h+=s.length)}function yt(e){const t=new ht;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function bt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function vt(e,t,s,r,n){try{n&&(n.onload=null,n.onerror=null,n.onabort=null,n.ontimeout=null),r(s)}catch(i){}}function wt(){this.g=new ie}function Nt(e){this.i=e.Sb||null,this.h=e.ab||!1}function jt(e,t){J.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function kt(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function It(e){e.readyState=4,e.l=null,e.j=null,e.B=null,St(e)}function St(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function _t(e){let t="";return P(e,function(e,s){t+=s,t+=":",t+=e,t+="\r\n"}),t}function Et(e,t,s){e:{for(r in s){var r=!1;break e}r=!0}r||(s=_t(s),"string"==typeof e?null!=s&&Se(s):st(e,t,s))}function Tt(e){J.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(e=ht.prototype).add=function(e,t){mt(this),this.i=null,e=bt(this,e);let s=this.g.get(e);return s||this.g.set(e,s=[]),s.push(t),this.h+=1,this},e.forEach=function(e,t){mt(this),this.g.forEach(function(s,r){s.forEach(function(s){e.call(t,s,r,this)},this)},this)},e.set=function(e,t){return mt(this),this.i=null,gt(this,e=bt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&(e=ft(this,e)).length>0?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(let r=0;r<t.length;r++){var s=t[r];const n=Se(s);s=ft(this,s);for(let t=0;t<s.length;t++){let r=n;""!==s[t]&&(r+="="+Se(s[t])),e.push(r)}}return this.i=e.join("&")},d(Nt,ae),Nt.prototype.g=function(){return new jt(this.i,this.h)},d(jt,J),(e=jt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,St(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||i).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,It(this)),this.readyState=0},e.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,St(this)),this.g&&(this.readyState=3,St(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;kt(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},e.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?It(this):St(this),3==this.readyState&&kt(this)}},e.Oa=function(e){this.g&&(this.response=this.responseText=e,It(this))},e.Na=function(e){this.g&&(this.response=e,It(this))},e.ga=function(){this.g&&It(this)},e.setRequestHeader=function(e,t){this.A.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var s=t.next();!s.done;)s=s.value,e.push(s[0]+": "+s[1]),s=t.next();return e.join("\r\n")},Object.defineProperty(jt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),d(Tt,J);var Ct=/^https?$/i,At=["POST","PUT"];function Pt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,Dt(e),Ot(e)}function Dt(e){e.A||(e.A=!0,Q(e,"complete"),Q(e,"error"))}function Rt(e){if(e.h&&void 0!==n)if(e.v&&4==Lt(e))setTimeout(e.Ca.bind(e),0);else if(Q(e,"readystatechange"),4==Lt(e)){e.h=!1;try{const n=e.ca();e:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var s;if(!(s=t)){var r;if(r=0===n){let t=String(e.D).match(Qe)[1]||null;!t&&i.self&&i.self.location&&(t=i.self.location.protocol.slice(0,-1)),r=!Ct.test(t?t.toLowerCase():"")}s=r}if(s)Q(e,"complete"),Q(e,"success");else{e.o=6;try{var a=Lt(e)>2?e.g.statusText:""}catch(o){a=""}e.l=a+" ["+e.ca()+"]",Dt(e)}}finally{Ot(e)}}}function Ot(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);const r=e.g;e.g=null,t||Q(e,"ready");try{r.onreadystatechange=null}catch(s){}}}function Lt(e){return e.g?e.g.readyState:0}function Mt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Ft(e,t,s){return s&&s.internalChannelParams&&s.internalChannelParams[e]||t}function Ut(e){this.za=0,this.i=[],this.j=new ve,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Ft("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Ft("baseRetryDelayMs",5e3,e),this.Za=Ft("retryDelaySeedMs",1e4,e),this.Ta=Ft("forwardChannelMaxRetries",2,e),this.va=Ft("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new $e(e&&e.concurrentRequestLimit),this.Ba=new wt,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function Vt(e){if(zt(e),3==e.I){var t=e.V++,s=Xe(e.J);if(st(s,"SID",e.M),st(s,"RID",t),st(s,"TYPE","terminate"),Kt(e,s),(t=new Ee(e,e.j,t)).M=2,t.A=rt(Xe(s)),s=!1,i.navigator&&i.navigator.sendBeacon)try{s=i.navigator.sendBeacon(t.A.toString(),"")}catch(r){}!s&&i.Image&&((new Image).src=t.A,s=!0),s||(t.g=rs(t.j,null),t.g.ea(t.A)),t.F=Date.now(),Le(t)}ts(e)}function Bt(e){e.g&&(Jt(e),e.g.cancel(),e.g=null)}function zt(e){Bt(e),e.v&&(i.clearTimeout(e.v),e.v=null),Yt(e),e.h.cancel(),e.m&&("number"==typeof e.m&&i.clearTimeout(e.m),e.m=null)}function $t(e){if(!qe(e.h)&&!e.m){e.m=!0;var t=e.Ea;y||w(),b||(y(),b=!0),v.add(t,e),e.D=0}}function qt(e,t){var s;s=t?t.l:e.V++;const r=Xe(e.J);st(r,"SID",e.M),st(r,"RID",s),st(r,"AID",e.K),Kt(e,r),e.u&&e.o&&Et(r,e.u,e.o),s=new Ee(e,e.j,s,e.D+1),null===e.u&&(s.J=e.o),t&&(e.i=t.G.concat(e.i)),t=Gt(e,s,1e3),s.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),He(e.h,s),Pe(s,r,t)}function Kt(e,t){e.H&&P(e.H,function(e,s){st(t,s,e)}),e.l&&P({},function(e,s){st(t,s,e)})}function Gt(e,t,s){s=Math.min(e.i.length,s);const r=e.l?l(e.l.Ka,e.l,e):null;e:{var n=e.i;let t=-1;for(;;){const e=["count="+s];-1==t?s>0?(t=n[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let l=!0;for(let d=0;d<s;d++){var i=n[d].g;const s=n[d].map;if((i-=t)<0)t=Math.max(0,n[d].g-100),l=!1;else try{i="req"+i+"_"||"";try{var o=s instanceof Map?s:Object.entries(s);for(const[t,s]of o){let r=s;a(s)&&(r=re(s)),e.push(i+t+"="+encodeURIComponent(r))}}catch(c){throw e.push(i+"type="+encodeURIComponent("_badmap")),c}}catch(c){r&&r(s)}}if(l){o=e.join("&");break e}}o=void 0}return e=e.i.splice(0,s),t.G=e,o}function Ht(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;y||w(),b||(y(),b=!0),v.add(t,e),e.A=0}}function Wt(e){return!(e.g||e.v||e.A>=3||(e.Y++,e.v=be(l(e.Da,e),Zt(e,e.A)),e.A++,0))}function Jt(e){null!=e.B&&(i.clearTimeout(e.B),e.B=null)}function Qt(e){e.g=new Ee(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=Xe(e.na);st(t,"RID","rpc"),st(t,"SID",e.M),st(t,"AID",e.K),st(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&st(t,"TO",e.ia),st(t,"TYPE","xmlhttp"),Kt(e,t),e.u&&e.o&&Et(t,e.u,e.o),e.O&&(e.g.H=e.O);var s=e.g;e=e.ba,s.M=1,s.A=rt(Xe(t)),s.u=null,s.R=!0,De(s,e)}function Yt(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function Xt(e,t){var s=null;if(e.g==t){Yt(e),Jt(e),e.g=null;var r=2}else{if(!Ge(e.h,t))return;s=t.G,We(e.h,t),r=1}if(0!=e.I)if(t.o)if(1==r){s=t.u?t.u.length:0,t=Date.now()-t.F;var n=e.D;Q(r=me(),new ye(r,s)),$t(e)}else Ht(e);else if(3==(n=t.m)||0==n&&t.X>0||!(1==r&&function(e,t){return!(Ke(e.h)>=e.h.j-(e.m?1:0)||(e.m?(e.i=t.G.concat(e.i),0):1==e.I||2==e.I||e.D>=(e.Sa?0:e.Ta)||(e.m=be(l(e.Ea,e,t),Zt(e,e.D)),e.D++,0)))}(e,t)||2==r&&Wt(e)))switch(s&&s.length>0&&(t=e.h,t.i=t.i.concat(s)),n){case 1:es(e,5);break;case 4:es(e,10);break;case 3:es(e,6);break;default:es(e,2)}}function Zt(e,t){let s=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(s*=2),s*t}function es(e,t){if(e.j.info("Error code "+t),2==t){var s=l(e.bb,e),r=e.Ua;const t=!r;r=new Ye(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||Ze(r,"https"),rt(r),t?function(e,t){const s=new ve;if(i.Image){const r=new Image;r.onload=c(vt,s,"TestLoadImage: loaded",!0,t,r),r.onerror=c(vt,s,"TestLoadImage: error",!1,t,r),r.onabort=c(vt,s,"TestLoadImage: abort",!1,t,r),r.ontimeout=c(vt,s,"TestLoadImage: timeout",!1,t,r),i.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(r.toString(),s):function(e,t){new ve;const s=new AbortController,r=setTimeout(()=>{s.abort(),vt(0,0,!1,t)},1e4);fetch(e,{signal:s.signal}).then(e=>{clearTimeout(r),e.ok?vt(0,0,!0,t):vt(0,0,!1,t)}).catch(()=>{clearTimeout(r),vt(0,0,!1,t)})}(r.toString(),s)}else xe(2);e.I=0,e.l&&e.l.pa(t),ts(e),zt(e)}function ts(e){if(e.I=0,e.ja=[],e.l){const t=Je(e.h);0==t.length&&0==e.i.length||(m(e.ja,t),m(e.ja,e.i),e.h.i.length=0,h(e.i),e.i.length=0),e.l.oa()}}function ss(e,t,s){var r=s instanceof Ye?Xe(s):new Ye(s);if(""!=r.g)t&&(r.g=t+"."+r.g),et(r,r.u);else{var n=i.location;r=n.protocol,t=t?t+"."+n.hostname:n.hostname,n=+n.port;const e=new Ye(null);r&&Ze(e,r),t&&(e.g=t),n&&et(e,n),s&&(e.h=s),r=e}return s=e.G,t=e.wa,s&&t&&st(r,s,t),st(r,"VER",e.ka),Kt(e,r),r}function rs(e,t,s){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Aa&&!e.ma?new Tt(new Nt({ab:s})):new Tt(e.ma)).Fa(e.L),t}function ns(){}function is(){}function as(e,t){J.call(this),this.g=new Ut(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!S(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!S(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new cs(this)}function os(e){ce.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const s in t){e=s;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function ls(){de.call(this),this.status=1}function cs(e){this.g=e}(e=Tt.prototype).Fa=function(e){this.H=e},e.ea=function(e,t,s,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Ne.g(),this.g.onreadystatechange=u(l(this.Ca,this));try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(a){return void Pt(this,a)}if(e=s||"",s=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var n in r)s.set(n,r[n]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())s.set(e,r.get(e))}r=Array.from(s.keys()).find(e=>"content-type"==e.toLowerCase()),n=i.FormData&&e instanceof i.FormData,!(Array.prototype.indexOf.call(At,t,void 0)>=0)||r||n||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,o]of s)this.g.setRequestHeader(i,o);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(e),this.v=!1}catch(a){Pt(this,a)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,Q(this,"complete"),Q(this,"abort"),Ot(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ot(this,!0)),Tt.Z.N.call(this)},e.Ca=function(){this.u||(this.B||this.v||this.j?Rt(this):this.Xa())},e.Xa=function(){Rt(this)},e.isActive=function(){return!!this.g},e.ca=function(){try{return Lt(this)>2?this.g.status:-1}catch(e){return-1}},e.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ne(t)}},e.ya=function(){return this.o},e.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=Ut.prototype).ka=8,e.I=1,e.connect=function(e,t,s,r){xe(0),this.W=e,this.H=t||{},s&&void 0!==r&&(this.H.OSID=s,this.H.OAID=r),this.F=this.X,this.J=ss(this,null,this.W),$t(this)},e.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const n=new Ee(this,this.j,e);let i=this.o;if(this.U&&(i?(i=D(i),O(i,this.U)):i=this.U),null!==this.u||this.R||(n.J=i,i=null),this.S)e:{for(var t=0,s=0;s<this.i.length;s++){var r=this.i[s];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if((t+=r)>4096){t=s;break e}if(4096===t||s===this.i.length-1){t=s+1;break e}}t=1e3}else t=1e3;t=Gt(this,n,t),st(s=Xe(this.J),"RID",e),st(s,"CVER",22),this.G&&st(s,"X-HTTP-Session-Id",this.G),Kt(this,s),i&&(this.R?t="headers="+Se(_t(i))+"&"+t:this.u&&Et(s,this.u,i)),He(this.h,n),this.Ra&&st(s,"TYPE","init"),this.S?(st(s,"$req",t),st(s,"SID","null"),n.U=!0,Pe(n,s,null)):Pe(n,s,t),this.I=2}}else 3==this.I&&(e?qt(this,e):0==this.i.length||qe(this.h)||qt(this))},e.Da=function(){if(this.v=null,Qt(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=be(l(this.Wa,this),e)}},e.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,xe(10),Bt(this),Qt(this))},e.Va=function(){null!=this.C&&(this.C=null,Bt(this),Wt(this),xe(19))},e.bb=function(e){e?(this.j.info("Successfully pinged google.com"),xe(2)):(this.j.info("Failed to ping google.com"),xe(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=ns.prototype).ra=function(){},e.qa=function(){},e.pa=function(){},e.oa=function(){},e.isActive=function(){return!0},e.Ka=function(){},is.prototype.g=function(e,t){return new as(e,t)},d(as,J),as.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},as.prototype.close=function(){Vt(this.g)},as.prototype.o=function(e){var t=this.g;if("string"==typeof e){var s={};s.__data__=e,e=s}else this.v&&((s={}).__data__=re(e),e=s);t.i.push(new ze(t.Ya++,e)),3==t.I&&$t(t)},as.prototype.N=function(){this.g.l=null,delete this.j,Vt(this.g),delete this.g,as.Z.N.call(this)},d(os,ce),d(ls,de),d(cs,ns),cs.prototype.ra=function(){Q(this.g,"a")},cs.prototype.qa=function(e){Q(this.g,new os(e))},cs.prototype.pa=function(e){Q(this.g,new ls)},cs.prototype.oa=function(){Q(this.g,"b")},is.prototype.createWebChannel=is.prototype.g,as.prototype.send=as.prototype.o,as.prototype.open=as.prototype.m,as.prototype.close=as.prototype.close,Hs=function(){return new is},Gs=function(){return me()},Ks=ue,qs={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},je.NO_ERROR=0,je.TIMEOUT=8,je.HTTP_ERROR=6,$s=je,ke.COMPLETE="complete",zs=ke,oe.EventType=le,le.OPEN="a",le.CLOSE="b",le.ERROR="c",le.MESSAGE="d",J.prototype.listen=J.prototype.J,Bs=oe,Tt.prototype.listenOnce=Tt.prototype.K,Tt.prototype.getLastError=Tt.prototype.Ha,Tt.prototype.getLastErrorCode=Tt.prototype.ya,Tt.prototype.getStatus=Tt.prototype.ca,Tt.prototype.getResponseJson=Tt.prototype.La,Tt.prototype.getResponseText=Tt.prototype.la,Tt.prototype.send=Tt.prototype.ea,Tt.prototype.setWithCredentials=Tt.prototype.Fa,Vs=Tt}).apply(void 0!==Ws?Ws:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const Js="@firebase/firestore",Qs="4.9.2";
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ys{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ys.UNAUTHENTICATED=new Ys(null),Ys.GOOGLE_CREDENTIALS=new Ys("google-credentials-uid"),Ys.FIRST_PARTY=new Ys("first-party-uid"),Ys.MOCK_USER=new Ys("mock-user");
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
let Xs="12.3.0";
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Zs=new yt("@firebase/firestore");function er(){return Zs.logLevel}function tr(e,...t){if(Zs.logLevel<=ht.DEBUG){const s=t.map(nr);Zs.debug(`Firestore (${Xs}): ${e}`,...s)}}function sr(e,...t){if(Zs.logLevel<=ht.ERROR){const s=t.map(nr);Zs.error(`Firestore (${Xs}): ${e}`,...s)}}function rr(e,...t){if(Zs.logLevel<=ht.WARN){const s=t.map(nr);Zs.warn(`Firestore (${Xs}): ${e}`,...s)}}function nr(e){if("string"==typeof e)return e;try{
/**
        * @license
        * Copyright 2020 Google LLC
        *
        * Licensed under the Apache License, Version 2.0 (the "License");
        * you may not use this file except in compliance with the License.
        * You may obtain a copy of the License at
        *
        *   http://www.apache.org/licenses/LICENSE-2.0
        *
        * Unless required by applicable law or agreed to in writing, software
        * distributed under the License is distributed on an "AS IS" BASIS,
        * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
        * See the License for the specific language governing permissions and
        * limitations under the License.
        */
return t=e,JSON.stringify(t)}catch(s){return e}var t}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function ir(e,t,s){let r="Unexpected state";"string"==typeof t?r=t:s=t,ar(e,r,s)}function ar(e,t,s){let r=`FIRESTORE (${Xs}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==s)try{r+=" CONTEXT: "+JSON.stringify(s)}catch(n){r+=" CONTEXT: "+s}throw sr(r),new Error(r)}function or(e,t,s,r){let n="Unexpected state";"string"==typeof s?n=s:r=s,e||ar(t,n,r)}function lr(e,t){return e}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const cr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class dr extends Ye{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class ur{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class hr{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class mr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ys.UNAUTHENTICATED))}shutdown(){}}class pr{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class gr{constructor(e){this.t=e,this.currentUser=Ys.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){or(void 0===this.o,42304);let s=this.i;const r=e=>this.i!==s?(s=this.i,t(e)):Promise.resolve();let n=new ur;this.o=()=>{this.i++,this.currentUser=this.u(),n.resolve(),n=new ur,e.enqueueRetryable(()=>r(this.currentUser))};const i=()=>{const t=n;e.enqueueRetryable(()=>g(this,null,function*(){yield t.promise,yield r(this.currentUser)}))},a=e=>{tr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),i())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?a(e):(tr("FirebaseAuthCredentialsProvider","Auth not yet detected"),n.resolve(),n=new ur)}},0),i()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(tr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(or("string"==typeof t.accessToken,31837,{l:t}),new hr(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return or(null===e||"string"==typeof e,2055,{h:e}),new Ys(e)}}class fr{constructor(e,t,s){this.P=e,this.T=t,this.I=s,this.type="FirstParty",this.user=Ys.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class xr{constructor(e,t,s){this.P=e,this.T=t,this.I=s}getToken(){return Promise.resolve(new fr(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Ys.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class yr{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class br{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,vs(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){or(void 0===this.o,3512);const s=e=>{null!=e.error&&tr("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const s=e.token!==this.m;return this.m=e.token,tr("FirebaseAppCheckTokenProvider",`Received ${s?"new":"existing"} token.`),s?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>s(t))};const r=e=>{tr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?r(e):tr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new yr(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(or("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new yr(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function vr(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),s=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(s);else for(let r=0;r<e;r++)s[r]=Math.floor(256*Math.random());return s}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class wr{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const s=vr(40);for(let r=0;r<s.length;++r)t.length<20&&s[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(s[r]%62))}return t}}function Nr(e,t){return e<t?-1:e>t?1:0}function jr(e,t){const s=Math.min(e.length,t.length);for(let r=0;r<s;r++){const s=e.charAt(r),n=t.charAt(r);if(s!==n)return kr(s)===kr(n)?Nr(s,n):kr(s)?1:-1}return Nr(e.length,t.length)}function kr(e){const t=e.charCodeAt(0);return t>=55296&&t<=57343}function Ir(e,t,s){return e.length===t.length&&e.every((e,r)=>s(e,t[r]))}function Sr(e){return e+"\0"}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const _r="__name__";class Er{constructor(e,t,s){void 0===t?t=0:t>e.length&&ir(637,{offset:t,range:e.length}),void 0===s?s=e.length-t:s>e.length-t&&ir(1746,{length:s,range:e.length-t}),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return 0===Er.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Er?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let r=0;r<s;r++){const s=Er.compareSegments(e.get(r),t.get(r));if(0!==s)return s}return Nr(e.length,t.length)}static compareSegments(e,t){const s=Er.isNumericId(e),r=Er.isNumericId(t);return s&&!r?-1:!s&&r?1:s&&r?Er.extractNumericId(e).compare(Er.extractNumericId(t)):jr(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Ms.fromString(e.substring(4,e.length-2))}}class Tr extends Er{construct(e,t,s){return new Tr(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new dr(cr.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter(e=>e.length>0))}return new Tr(t)}static emptyPath(){return new Tr([])}}const Cr=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ar extends Er{construct(e,t,s){return new Ar(e,t,s)}static isValidIdentifier(e){return Cr.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ar.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===_r}static keyField(){return new Ar([_r])}static fromServerFormat(e){const t=[];let s="",r=0;const n=()=>{if(0===s.length)throw new dr(cr.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let i=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new dr(cr.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new dr(cr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=t,r+=2}else"`"===t?(i=!i,r++):"."!==t||i?(s+=t,r++):(n(),r++)}if(n(),i)throw new dr(cr.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ar(t)}static emptyPath(){return new Ar([])}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Pr{constructor(e){this.path=e}static fromPath(e){return new Pr(Tr.fromString(e))}static fromName(e){return new Pr(Tr.fromString(e).popFirst(5))}static empty(){return new Pr(Tr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Tr.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Tr.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Pr(new Tr(e.slice()))}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Dr(e,t,s){if(!s)throw new dr(cr.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Rr(e,t,s,r){if(!0===t&&!0===r)throw new dr(cr.INVALID_ARGUMENT,`${e} and ${s} cannot be used together.`)}function Or(e){if(!Pr.isDocumentKey(e))throw new dr(cr.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Lr(e){if(Pr.isDocumentKey(e))throw new dr(cr.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Mr(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function Fr(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const s=(t=e).constructor?t.constructor.name:null;return s?`a custom ${s} object`:"an object"}}var t;return"function"==typeof e?"a function":ir(12329,{type:typeof e})}function Ur(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new dr(cr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const s=Fr(e);throw new dr(cr.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${s}`)}}return e}
/**
     * @license
     * Copyright 2025 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function Vr(e,t){const s={typeString:e};return t&&(s.value=t),s}function Br(e,t){if(!Mr(e))throw new dr(cr.INVALID_ARGUMENT,"JSON must be an object");let s;for(const r in t)if(t[r]){const n=t[r].typeString,i="value"in t[r]?{value:t[r].value}:void 0;if(!(r in e)){s=`JSON missing required field: '${r}'`;break}const a=e[r];if(n&&typeof a!==n){s=`JSON field '${r}' must be a ${n}.`;break}if(void 0!==i&&a!==i.value){s=`Expected '${r}' field to equal '${i.value}'`;break}}if(s)throw new dr(cr.INVALID_ARGUMENT,s);return!0}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const zr=-62135596800,$r=1e6;class qr{static now(){return qr.fromMillis(Date.now())}static fromDate(e){return qr.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor((e-1e3*t)*$r);return new qr(t,s)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new dr(cr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new dr(cr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<zr)throw new dr(cr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new dr(cr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/$r}_compareTo(e){return this.seconds===e.seconds?Nr(this.nanoseconds,e.nanoseconds):Nr(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:qr._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Br(e,qr._jsonSchema))return new qr(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-zr;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}qr._jsonSchemaVersion="firestore/timestamp/1.0",qr._jsonSchema={type:Vr("string",qr._jsonSchemaVersion),seconds:Vr("number"),nanoseconds:Vr("number")};
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Kr{static fromTimestamp(e){return new Kr(e)}static min(){return new Kr(new qr(0,0))}static max(){return new Kr(new qr(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Gr{constructor(e,t,s,r){this.indexId=e,this.collectionGroup=t,this.fields=s,this.indexState=r}}function Hr(e){return e.fields.find(e=>2===e.kind)}function Wr(e){return e.fields.filter(e=>2!==e.kind)}Gr.UNKNOWN_ID=-1;class Jr{constructor(e,t){this.fieldPath=e,this.kind=t}}class Qr{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Qr(0,Xr.min())}}function Yr(e){return new Xr(e.readTime,e.key,-1)}class Xr{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new Xr(Kr.min(),Pr.empty(),-1)}static max(){return new Xr(Kr.max(),Pr.empty(),-1)}}function Zr(e,t){let s=e.readTime.compareTo(t.readTime);return 0!==s?s:(s=Pr.comparator(e.documentKey,t.documentKey),0!==s?s:Nr(e.largestBatchId,t.largestBatchId)
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */)}const en="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class tn{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function sn(e){return g(this,null,function*(){if(e.code!==cr.FAILED_PRECONDITION||e.message!==en)throw e;tr("LocalStore","Unexpectedly lost primary lease")})}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class rn{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ir(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new rn((s,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(s,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(s,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof rn?t:rn.resolve(t)}catch(t){return rn.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):rn.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):rn.reject(t)}static resolve(e){return new rn((t,s)=>{t(e)})}static reject(e){return new rn((t,s)=>{s(e)})}static waitFor(e){return new rn((t,s)=>{let r=0,n=0,i=!1;e.forEach(e=>{++r,e.next(()=>{++n,i&&n===r&&t()},e=>s(e))}),i=!0,n===r&&t()})}static or(e){let t=rn.resolve(!1);for(const s of e)t=t.next(e=>e?rn.resolve(e):s());return t}static forEach(e,t){const s=[];return e.forEach((e,r)=>{s.push(t.call(this,e,r))}),this.waitFor(s)}static mapArray(e,t){return new rn((s,r)=>{const n=e.length,i=new Array(n);let a=0;for(let o=0;o<n;o++){const l=o;t(e[l]).next(e=>{i[l]=e,++a,a===n&&s(i)},e=>r(e))}})}static doWhile(e,t){return new rn((s,r)=>{const n=()=>{!0===e()?t().next(()=>{n()},r):s()};n()})}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const nn="SimpleDb";class an{static open(e,t,s,r){try{return new an(t,e.transaction(r,s))}catch(n){throw new dn(t,n)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new ur,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new dn(e,t.error)):this.S.resolve()},this.transaction.onerror=t=>{const s=gn(t.target.error);this.S.reject(new dn(e,s))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(tr(nn,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new hn(t)}}class on{static delete(e){return tr(nn,"Removing database:",e),mn(De().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!Qe())return!1;if(on.F())return!0;const e=Ge(),t=on.M(e),s=0<t&&t<10,r=ln(e),n=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||s||n)}static F(){var e;return"undefined"!=typeof process&&"YES"===(null==(e=process.__PRIVATE_env)?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)}static O(e,t){return e.store(t)}static M(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),s=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(s)}constructor(e,t,s){this.name=e,this.version=t,this.N=s,this.B=null,12.2===on.M(Ge())&&sr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}L(e){return g(this,null,function*(){return this.db||(tr(nn,"Opening database:",this.name),this.db=yield new Promise((t,s)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const s=e.target.result;t(s)},r.onblocked=()=>{s(new dn(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?s(new dr(cr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?s(new dr(cr.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):s(new dn(e,r))},r.onupgradeneeded=e=>{tr(nn,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.N.k(t,r.transaction,e.oldVersion,this.version).next(()=>{tr(nn,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=e=>this.q(e)),this.db})}$(e){this.q=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,s,r){return g(this,null,function*(){const n="readonly"===t;let i=0;for(;;){++i;try{this.db=yield this.L(e);const t=an.open(this.db,e,n?"readonly":"readwrite",s),i=r(t).next(e=>(t.C(),e)).catch(e=>(t.abort(e),rn.reject(e))).toPromise();return i.catch(()=>{}),yield t.D,i}catch(a){const e=a,t="FirebaseError"!==e.name&&i<3;if(tr(nn,"Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}})}close(){this.db&&this.db.close(),this.db=void 0}}function ln(e){const t=e.match(/Android ([\d.]+)/i),s=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(s)}class cn{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return mn(this.U.delete())}}class dn extends dr{constructor(e,t){super(cr.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function un(e){return"IndexedDbTransactionError"===e.name}class hn{constructor(e){this.store=e}put(e,t){let s;return void 0!==t?(tr(nn,"PUT",this.store.name,e,t),s=this.store.put(t,e)):(tr(nn,"PUT",this.store.name,"<auto-key>",e),s=this.store.put(e)),mn(s)}add(e){return tr(nn,"ADD",this.store.name,e,e),mn(this.store.add(e))}get(e){return mn(this.store.get(e)).next(t=>(void 0===t&&(t=null),tr(nn,"GET",this.store.name,e,t),t))}delete(e){return tr(nn,"DELETE",this.store.name,e),mn(this.store.delete(e))}count(){return tr(nn,"COUNT",this.store.name),mn(this.store.count())}J(e,t){const s=this.options(e,t),r=s.index?this.store.index(s.index):this.store;if("function"==typeof r.getAll){const e=r.getAll(s.range);return new rn((t,s)=>{e.onerror=e=>{s(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{const e=this.cursor(s),t=[];return this.H(e,(e,s)=>{t.push(s)}).next(()=>t)}}Y(e,t){const s=this.store.getAll(e,null===t?void 0:t);return new rn((e,t)=>{s.onerror=e=>{t(e.target.error)},s.onsuccess=t=>{e(t.target.result)}})}Z(e,t){tr(nn,"DELETE ALL",this.store.name);const s=this.options(e,t);s.X=!1;const r=this.cursor(s);return this.H(r,(e,t,s)=>s.delete())}ee(e,t){let s;t?s=e:(s={},t=e);const r=this.cursor(s);return this.H(r,t)}te(e){const t=this.cursor({});return new rn((s,r)=>{t.onerror=e=>{const t=gn(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next(e=>{e?r.continue():s()}):s()}})}H(e,t){const s=[];return new rn((r,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{const n=e.target.result;if(!n)return void r();const i=new cn(n),a=t(n.primaryKey,n.value,i);if(a instanceof rn){const e=a.catch(e=>(i.done(),rn.reject(e)));s.push(e)}i.isDone?r():null===i.G?n.continue():n.continue(i.G)}}).next(()=>rn.waitFor(s))}options(e,t){let s;return void 0!==e&&("string"==typeof e?s=e:t=e),{index:s,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const s=this.store.index(e.index);return e.X?s.openKeyCursor(e.range,t):s.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function mn(e){return new rn((t,s)=>{e.onsuccess=e=>{const s=e.target.result;t(s)},e.onerror=e=>{const t=gn(e.target.error);s(t)}})}let pn=!1;function gn(e){const t=on.M(Ge());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new dr("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return pn||(pn=!0,setTimeout(()=>{throw e},0)),e}}return e}const fn="IndexBackfiller";class xn{constructor(e,t){this.asyncQueue=e,this.ne=t,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}re(e){tr(fn,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>g(this,null,function*(){this.task=null;try{const e=yield this.ne.ie();tr(fn,`Documents written: ${e}`)}catch(e){un(e)?tr(fn,"Ignoring IndexedDB error during index backfill: ",e):yield sn(e)}yield this.re(6e4)}))}}class yn{constructor(e,t){this.localStore=e,this.persistence=t}ie(e=50){return g(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.se(t,e))})}se(e,t){const s=new Set;let r=t,n=!0;return rn.doWhile(()=>!0===n&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(null!==t&&!s.has(t))return tr(fn,`Processing collection: ${t}`),this.oe(e,t,r).next(e=>{r-=e,s.add(t)});n=!1})).next(()=>t-r)}oe(e,t,s){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,s).next(s=>{const n=s.changes;return this.localStore.indexManager.updateIndexEntries(e,n).next(()=>this._e(r,s)).next(s=>(tr(fn,`Updating offset: ${s}`),this.localStore.indexManager.updateCollectionGroup(e,t,s))).next(()=>n.size)}))}_e(e,t){let s=e;return t.changes.forEach((e,t)=>{const r=Yr(t);Zr(r,s)>0&&(s=r)}),new Xr(s.readTime,s.documentKey,Math.max(t.batchId,e.largestBatchId))}}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class bn{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}bn.ce=-1;
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const vn=-1;function wn(e){return null==e}function Nn(e){return 0===e&&1/e==-1/0}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const jn="";function kn(e){let t="";for(let s=0;s<e.length;s++)t.length>0&&(t=Sn(t)),t=In(e.get(s),t);return Sn(t)}function In(e,t){let s=t;const r=e.length;for(let n=0;n<r;n++){const t=e.charAt(n);switch(t){case"\0":s+="";break;case jn:s+="";break;default:s+=t}}return s}function Sn(e){return e+jn+""}function _n(e){const t=e.length;if(or(t>=2,64408,{path:e}),2===t)return or(e.charAt(0)===jn&&""===e.charAt(1),56145,{path:e}),Tr.emptyPath();const s=t-2,r=[];let n="";for(let i=0;i<t;){const t=e.indexOf(jn,i);switch((t<0||t>s)&&ir(50515,{path:e}),e.charAt(t+1)){case"":const s=e.substring(i,t);let a;0===n.length?a=s:(n+=s,a=n,n=""),r.push(a);break;case"":n+=e.substring(i,t),n+="\0";break;case"":n+=e.substring(i,t+1);break;default:ir(61167,{path:e})}i=t+2}return new Tr(r)}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const En="remoteDocuments",Tn="owner",Cn="owner",An="mutationQueues",Pn="mutations",Dn="batchId",Rn="userMutationsIndex",On=["userId","batchId"];
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Ln(e,t){return[e,kn(t)]}function Mn(e,t,s){return[e,kn(t),s]}const Fn={},Un="documentMutations",Vn="remoteDocumentsV14",Bn=["prefixPath","collectionGroup","readTime","documentId"],zn="documentKeyIndex",$n=["prefixPath","collectionGroup","documentId"],qn="collectionGroupIndex",Kn=["collectionGroup","readTime","prefixPath","documentId"],Gn="remoteDocumentGlobal",Hn="remoteDocumentGlobalKey",Wn="targets",Jn="queryTargetsIndex",Qn=["canonicalId","targetId"],Yn="targetDocuments",Xn=["targetId","path"],Zn="documentTargetsIndex",ei=["path","targetId"],ti="targetGlobalKey",si="targetGlobal",ri="collectionParents",ni=["collectionId","parent"],ii="clientMetadata",ai="bundles",oi="namedQueries",li="indexConfiguration",ci="collectionGroupIndex",di="indexState",ui=["indexId","uid"],hi="sequenceNumberIndex",mi=["uid","sequenceNumber"],pi="indexEntries",gi=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],fi="documentKeyIndex",xi=["indexId","uid","orderedDocumentKey"],yi="documentOverlays",bi=["userId","collectionPath","documentId"],vi="collectionPathOverlayIndex",wi=["userId","collectionPath","largestBatchId"],Ni="collectionGroupOverlayIndex",ji=["userId","collectionGroup","largestBatchId"],ki="globals",Ii=[An,Pn,Un,En,Wn,Tn,si,Yn,ii,Gn,ri,ai,oi],Si=[...Ii,yi],_i=[An,Pn,Un,Vn,Wn,Tn,si,Yn,ii,Gn,ri,ai,oi,yi],Ei=_i,Ti=[...Ei,li,di,pi],Ci=Ti,Ai=[...Ti,ki],Pi=Ai;
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Di extends tn{constructor(e,t){super(),this.le=e,this.currentSequenceNumber=t}}function Ri(e,t){const s=lr(e);return on.O(s.le,t)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Oi(e){let t=0;for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&t++;return t}function Li(e,t){for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&t(s,e[s])}function Mi(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Fi{constructor(e,t){this.comparator=e,this.root=t||Vi.EMPTY}insert(e,t){return new Fi(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Vi.BLACK,null,null))}remove(e){return new Fi(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Vi.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(0===s)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const r=this.comparator(e,s.key);if(0===r)return t+s.left.size;r<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,s)=>(e(t,s),!1))}toString(){const e=[];return this.inorderTraversal((t,s)=>(e.push(`${t}:${s}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ui(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ui(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ui(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ui(this.root,e,this.comparator,!0)}}class Ui{constructor(e,t,s,r){this.isReverse=r,this.nodeStack=[];let n=1;for(;!e.isEmpty();)if(n=t?s(e.key,t):1,t&&r&&(n*=-1),n<0)e=this.isReverse?e.left:e.right;else{if(0===n){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Vi{constructor(e,t,s,r,n){this.key=e,this.value=t,this.color=null!=s?s:Vi.RED,this.left=null!=r?r:Vi.EMPTY,this.right=null!=n?n:Vi.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,r,n){return new Vi(null!=e?e:this.key,null!=t?t:this.value,null!=s?s:this.color,null!=r?r:this.left,null!=n?n:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let r=this;const n=s(e,r.key);return r=n<0?r.copy(null,null,null,r.left.insert(e,t,s),null):0===n?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,s)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Vi.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Vi.EMPTY;s=r.right.min(),r=r.copy(s.key,s.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Vi.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Vi.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ir(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ir(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw ir(27949);return e+(this.isRed()?0:1)}}Vi.EMPTY=null,Vi.RED=!0,Vi.BLACK=!1,Vi.EMPTY=new class{constructor(){this.size=0}get key(){throw ir(57766)}get value(){throw ir(16141)}get color(){throw ir(16727)}get left(){throw ir(29726)}get right(){throw ir(36894)}copy(e,t,s,r,n){return this}insert(e,t,s){return new Vi(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Bi{constructor(e){this.comparator=e,this.data=new Fi(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,s)=>(e(t),!1))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const r=s.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let s;for(s=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new zi(this.data.getIterator())}getIteratorFrom(e){return new zi(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof Bi))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=s.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Bi(this.comparator);return t.data=e,t}}class zi{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function $i(e){return e.hasNext()?e.getNext():void 0}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class qi{constructor(e){this.fields=e,e.sort(Ar.comparator)}static empty(){return new qi([])}unionWith(e){let t=new Bi(Ar.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new qi(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ir(this.fields,e.fields,(e,t)=>e.isEqual(t))}}
/**
     * @license
     * Copyright 2023 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ki extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Gi{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new Ki("Invalid base64 string: "+t):t}}(e);return new Gi(t)}static fromUint8Array(e){const t=function(e){let t="";for(let s=0;s<e.length;++s)t+=String.fromCharCode(e[s]);return t}(e);return new Gi(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let s=0;s<e.length;s++)t[s]=e.charCodeAt(s);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Nr(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Gi.EMPTY_BYTE_STRING=new Gi("");const Hi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Wi(e){if(or(!!e,39018),"string"==typeof e){let t=0;const s=Hi.exec(e);if(or(!!s,46558,{timestamp:e}),s[1]){let e=s[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Ji(e.seconds),nanos:Ji(e.nanos)}}function Ji(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Qi(e){return"string"==typeof e?Gi.fromBase64String(e):Gi.fromUint8Array(e)}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Yi="server_timestamp",Xi="__type__",Zi="__previous_value__",ea="__local_write_time__";function ta(e){var t,s;return(null==(s=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[Xi])?void 0:s.stringValue)===Yi}function sa(e){const t=e.mapValue.fields[Zi];return ta(t)?sa(t):t}function ra(e){const t=Wi(e.mapValue.fields[ea].timestampValue);return new qr(t.seconds,t.nanos)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class na{constructor(e,t,s,r,n,i,a,o,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=r,this.ssl=n,this.forceLongPolling=i,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=c}}const ia="(default)";class aa{constructor(e,t){this.projectId=e,this.database=t||ia}static empty(){return new aa("","")}get isDefaultDatabase(){return this.database===ia}isEqual(e){return e instanceof aa&&e.projectId===this.projectId&&e.database===this.database}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const oa="__type__",la="__max__",ca={mapValue:{fields:{__type__:{stringValue:la}}}},da="__vector__",ua="value",ha={nullValue:"NULL_VALUE"};function ma(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ta(e)?4:Ca(e)?9007199254740991:Ea(e)?10:11:ir(28295,{value:e})}function pa(e,t){if(e===t)return!0;const s=ma(e);if(s!==ma(t))return!1;switch(s){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return ra(e).isEqual(ra(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const s=Wi(e.timestampValue),r=Wi(t.timestampValue);return s.seconds===r.seconds&&s.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return r=t,Qi(e.bytesValue).isEqual(Qi(r.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Ji(e.geoPointValue.latitude)===Ji(t.geoPointValue.latitude)&&Ji(e.geoPointValue.longitude)===Ji(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Ji(e.integerValue)===Ji(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const s=Ji(e.doubleValue),r=Ji(t.doubleValue);return s===r?Nn(s)===Nn(r):isNaN(s)&&isNaN(r)}return!1}(e,t);case 9:return Ir(e.arrayValue.values||[],t.arrayValue.values||[],pa);case 10:case 11:return function(e,t){const s=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Oi(s)!==Oi(r))return!1;for(const n in s)if(s.hasOwnProperty(n)&&(void 0===r[n]||!pa(s[n],r[n])))return!1;return!0}(e,t);default:return ir(52216,{left:e})}var r}function ga(e,t){return void 0!==(e.values||[]).find(e=>pa(e,t))}function fa(e,t){if(e===t)return 0;const s=ma(e),r=ma(t);if(s!==r)return Nr(s,r);switch(s){case 0:case 9007199254740991:return 0;case 1:return Nr(e.booleanValue,t.booleanValue);case 2:return function(e,t){const s=Ji(e.integerValue||e.doubleValue),r=Ji(t.integerValue||t.doubleValue);return s<r?-1:s>r?1:s===r?0:isNaN(s)?isNaN(r)?0:-1:1}(e,t);case 3:return xa(e.timestampValue,t.timestampValue);case 4:return xa(ra(e),ra(t));case 5:return jr(e.stringValue,t.stringValue);case 6:return function(e,t){const s=Qi(e),r=Qi(t);return s.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const s=e.split("/"),r=t.split("/");for(let n=0;n<s.length&&n<r.length;n++){const e=Nr(s[n],r[n]);if(0!==e)return e}return Nr(s.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const s=Nr(Ji(e.latitude),Ji(t.latitude));return 0!==s?s:Nr(Ji(e.longitude),Ji(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return ya(e.arrayValue,t.arrayValue);case 10:return function(e,t){var s,r,n,i;const a=e.fields||{},o=t.fields||{},l=null==(s=a[ua])?void 0:s.arrayValue,c=null==(r=o[ua])?void 0:r.arrayValue,d=Nr((null==(n=null==l?void 0:l.values)?void 0:n.length)||0,(null==(i=null==c?void 0:c.values)?void 0:i.length)||0);return 0!==d?d:ya(l,c)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===ca.mapValue&&t===ca.mapValue)return 0;if(e===ca.mapValue)return 1;if(t===ca.mapValue)return-1;const s=e.fields||{},r=Object.keys(s),n=t.fields||{},i=Object.keys(n);r.sort(),i.sort();for(let a=0;a<r.length&&a<i.length;++a){const e=jr(r[a],i[a]);if(0!==e)return e;const t=fa(s[r[a]],n[i[a]]);if(0!==t)return t}return Nr(r.length,i.length)}(e.mapValue,t.mapValue);default:throw ir(23264,{he:s})}}function xa(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Nr(e,t);const s=Wi(e),r=Wi(t),n=Nr(s.seconds,r.seconds);return 0!==n?n:Nr(s.nanos,r.nanos)}function ya(e,t){const s=e.values||[],r=t.values||[];for(let n=0;n<s.length&&n<r.length;++n){const e=fa(s[n],r[n]);if(e)return e}return Nr(s.length,r.length)}function ba(e){return va(e)}function va(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Wi(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Qi(e.bytesValue).toBase64():"referenceValue"in e?function(e){return Pr.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",s=!0;for(const r of e.values||[])s?s=!1:t+=",",t+=va(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let s="{",r=!0;for(const n of t)r?r=!1:s+=",",s+=`${n}:${va(e.fields[n])}`;return s+"}"}(e.mapValue):ir(61005,{value:e})}function wa(e){switch(ma(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=sa(e);return t?16+wa(t):16;case 5:return 2*e.stringValue.length;case 6:return Qi(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return(e.arrayValue.values||[]).reduce((e,t)=>e+wa(t),0);case 10:case 11:return function(e){let t=0;return Li(e.fields,(e,s)=>{t+=e.length+wa(s)}),t}(e.mapValue);default:throw ir(13486,{value:e})}}function Na(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function ja(e){return!!e&&"integerValue"in e}function ka(e){return!!e&&"arrayValue"in e}function Ia(e){return!!e&&"nullValue"in e}function Sa(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function _a(e){return!!e&&"mapValue"in e}function Ea(e){var t,s;return(null==(s=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[oa])?void 0:s.stringValue)===da}function Ta(e){if(e.geoPointValue)return{geoPointValue:d({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:d({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Li(e.mapValue.fields,(e,s)=>t.mapValue.fields[e]=Ta(s)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let s=0;s<(e.arrayValue.values||[]).length;++s)t.arrayValue.values[s]=Ta(e.arrayValue.values[s]);return t}return d({},e)}function Ca(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===la}const Aa={mapValue:{fields:{[oa]:{stringValue:da},[ua]:{arrayValue:{}}}}};function Pa(e){return"nullValue"in e?ha:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?Na(aa.empty(),Pr.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?Ea(e)?Aa:{mapValue:{}}:ir(35942,{value:e})}function Da(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?Na(aa.empty(),Pr.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?Aa:"mapValue"in e?Ea(e)?{mapValue:{}}:ca:ir(61959,{value:e})}function Ra(e,t){const s=fa(e.value,t.value);return 0!==s?s:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Oa(e,t){const s=fa(e.value,t.value);return 0!==s?s:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class La{constructor(e){this.value=e}static empty(){return new La({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!_a(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ta(t)}setAll(e){let t=Ar.emptyPath(),s={},r=[];e.forEach((e,n)=>{if(!t.isImmediateParentOf(n)){const e=this.getFieldsMap(t);this.applyChanges(e,s,r),s={},r=[],t=n.popLast()}e?s[n.lastSegment()]=Ta(e):r.push(n.lastSegment())});const n=this.getFieldsMap(t);this.applyChanges(n,s,r)}delete(e){const t=this.field(e.popLast());_a(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return pa(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let r=t.mapValue.fields[e.get(s)];_a(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,s){Li(t,(t,s)=>e[t]=s);for(const r of s)delete e[r]}clone(){return new La(Ta(this.value))}}function Ma(e){const t=[];return Li(e.fields,(e,s)=>{const r=new Ar([e]);if(_a(s)){const e=Ma(s.mapValue).fields;if(0===e.length)t.push(r);else for(const s of e)t.push(r.child(s))}else t.push(r)}),new qi(t)
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */}class Fa{constructor(e,t,s,r,n,i,a){this.key=e,this.documentType=t,this.version=s,this.readTime=r,this.createTime=n,this.data=i,this.documentState=a}static newInvalidDocument(e){return new Fa(e,0,Kr.min(),Kr.min(),Kr.min(),La.empty(),0)}static newFoundDocument(e,t,s,r){return new Fa(e,1,t,Kr.min(),s,r,0)}static newNoDocument(e,t){return new Fa(e,2,t,Kr.min(),Kr.min(),La.empty(),0)}static newUnknownDocument(e,t){return new Fa(e,3,t,Kr.min(),Kr.min(),La.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Kr.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=La.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=La.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Kr.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Fa&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Fa(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ua{constructor(e,t){this.position=e,this.inclusive=t}}function Va(e,t,s){let r=0;for(let n=0;n<e.position.length;n++){const i=t[n],a=e.position[n];if(r=i.field.isKeyField()?Pr.comparator(Pr.fromName(a.referenceValue),s.key):fa(a,s.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function Ba(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let s=0;s<e.position.length;s++)if(!pa(e.position[s],t.position[s]))return!1;return!0}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class za{constructor(e,t="asc"){this.field=e,this.dir=t}}function $a(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class qa{}class Ka extends qa{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,s):new to(e,t,s):"array-contains"===t?new io(e,s):"in"===t?new ao(e,s):"not-in"===t?new oo(e,s):"array-contains-any"===t?new lo(e,s):new Ka(e,t,s)}static createKeyFieldInFilter(e,t,s){return"in"===t?new so(e,s):new ro(e,s)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(fa(t,this.value)):null!==t&&ma(this.value)===ma(t)&&this.matchesComparison(fa(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return ir(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ga extends qa{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new Ga(e,t)}matches(e){return Ha(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Ha(e){return"and"===e.op}function Wa(e){return"or"===e.op}function Ja(e){return Qa(e)&&Ha(e)}function Qa(e){for(const t of e.filters)if(t instanceof Ga)return!1;return!0}function Ya(e){if(e instanceof Ka)return e.field.canonicalString()+e.op.toString()+ba(e.value);if(Ja(e))return e.filters.map(e=>Ya(e)).join(",");{const t=e.filters.map(e=>Ya(e)).join(",");return`${e.op}(${t})`}}function Xa(e,t){return e instanceof Ka?(s=e,(r=t)instanceof Ka&&s.op===r.op&&s.field.isEqual(r.field)&&pa(s.value,r.value)):e instanceof Ga?function(e,t){return t instanceof Ga&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,s,r)=>e&&Xa(s,t.filters[r]),!0)}(e,t):void ir(19439);var s,r}function Za(e,t){const s=e.filters.concat(t);return Ga.create(s,e.op)}function eo(e){return e instanceof Ka?`${(t=e).field.canonicalString()} ${t.op} ${ba(t.value)}`:e instanceof Ga?function(e){return e.op.toString()+" {"+e.getFilters().map(eo).join(" ,")+"}"}(e):"Filter";var t}class to extends Ka{constructor(e,t,s){super(e,t,s),this.key=Pr.fromName(s.referenceValue)}matches(e){const t=Pr.comparator(e.key,this.key);return this.matchesComparison(t)}}class so extends Ka{constructor(e,t){super(e,"in",t),this.keys=no(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class ro extends Ka{constructor(e,t){super(e,"not-in",t),this.keys=no(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function no(e,t){var s;return((null==(s=t.arrayValue)?void 0:s.values)||[]).map(e=>Pr.fromName(e.referenceValue))}class io extends Ka{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return ka(t)&&ga(t.arrayValue,this.value)}}class ao extends Ka{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&ga(this.value.arrayValue,t)}}class oo extends Ka{constructor(e,t){super(e,"not-in",t)}matches(e){if(ga(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!ga(this.value.arrayValue,t)}}class lo extends Ka{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!ka(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>ga(this.value.arrayValue,e))}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class co{constructor(e,t=null,s=[],r=[],n=null,i=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=r,this.limit=n,this.startAt=i,this.endAt=a,this.Te=null}}function uo(e,t=null,s=[],r=[],n=null,i=null,a=null){return new co(e,t,s,r,n,i,a)}function ho(e){const t=lr(e);if(null===t.Te){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>Ya(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>{return(t=e).field.canonicalString()+t.dir;var t}).join(","),wn(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>ba(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>ba(e)).join(",")),t.Te=e}return t.Te}function mo(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let s=0;s<e.orderBy.length;s++)if(!$a(e.orderBy[s],t.orderBy[s]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let s=0;s<e.filters.length;s++)if(!Xa(e.filters[s],t.filters[s]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Ba(e.startAt,t.startAt)&&Ba(e.endAt,t.endAt)}function po(e){return Pr.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function go(e,t){return e.filters.filter(e=>e instanceof Ka&&e.field.isEqual(t))}function fo(e,t,s){let r=ha,n=!0;for(const i of go(e,t)){let e=ha,t=!0;switch(i.op){case"<":case"<=":e=Pa(i.value);break;case"==":case"in":case">=":e=i.value;break;case">":e=i.value,t=!1;break;case"!=":case"not-in":e=ha}Ra({value:r,inclusive:n},{value:e,inclusive:t})<0&&(r=e,n=t)}if(null!==s)for(let i=0;i<e.orderBy.length;++i)if(e.orderBy[i].field.isEqual(t)){const e=s.position[i];Ra({value:r,inclusive:n},{value:e,inclusive:s.inclusive})<0&&(r=e,n=s.inclusive);break}return{value:r,inclusive:n}}function xo(e,t,s){let r=ca,n=!0;for(const i of go(e,t)){let e=ca,t=!0;switch(i.op){case">=":case">":e=Da(i.value),t=!1;break;case"==":case"in":case"<=":e=i.value;break;case"<":e=i.value,t=!1;break;case"!=":case"not-in":e=ca}Oa({value:r,inclusive:n},{value:e,inclusive:t})>0&&(r=e,n=t)}if(null!==s)for(let i=0;i<e.orderBy.length;++i)if(e.orderBy[i].field.isEqual(t)){const e=s.position[i];Oa({value:r,inclusive:n},{value:e,inclusive:s.inclusive})>0&&(r=e,n=s.inclusive);break}return{value:r,inclusive:n}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class yo{constructor(e,t=null,s=[],r=[],n=null,i="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=r,this.limit=n,this.limitType=i,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function bo(e){return new yo(e)}function vo(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function wo(e){return null!==e.collectionGroup}function No(e){const t=lr(e);if(null===t.Ie){t.Ie=[];const e=new Set;for(const r of t.explicitOrderBy)t.Ie.push(r),e.add(r.field.canonicalString());const s=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(e){let t=new Bi(Ar.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t})(t).forEach(r=>{e.has(r.canonicalString())||r.isKeyField()||t.Ie.push(new za(r,s))}),e.has(Ar.keyField().canonicalString())||t.Ie.push(new za(Ar.keyField(),s))}return t.Ie}function jo(e){const t=lr(e);return t.Ee||(t.Ee=function(e,t){if("F"===e.limitType)return uo(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new za(e.field,t)});const s=e.endAt?new Ua(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new Ua(e.startAt.position,e.startAt.inclusive):null;return uo(e.path,e.collectionGroup,t,e.filters,e.limit,s,r)}}(t,No(e))),t.Ee}function ko(e,t){const s=e.filters.concat([t]);return new yo(e.path,e.collectionGroup,e.explicitOrderBy.slice(),s,e.limit,e.limitType,e.startAt,e.endAt)}function Io(e,t,s){return new yo(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,s,e.startAt,e.endAt)}function So(e,t){return mo(jo(e),jo(t))&&e.limitType===t.limitType}function _o(e){return`${ho(jo(e))}|lt:${e.limitType}`}function Eo(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>eo(e)).join(", ")}]`),wn(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>{return`${(t=e).field.canonicalString()} (${t.dir})`;var t}).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>ba(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>ba(e)).join(",")),`Target(${t})`}(jo(e))}; limitType=${e.limitType})`}function To(e,t){return t.isFoundDocument()&&function(e,t){const s=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(s):Pr.isDocumentKey(e.path)?e.path.isEqual(s):e.path.isImmediateParentOf(s)}(e,t)&&function(e,t){for(const s of No(e))if(!s.field.isKeyField()&&null===t.data.field(s.field))return!1;return!0}(e,t)&&function(e,t){for(const s of e.filters)if(!s.matches(t))return!1;return!0}(e,t)&&(r=t,!((s=e).startAt&&!function(e,t,s){const r=Va(e,t,s);return e.inclusive?r<=0:r<0}(s.startAt,No(s),r)||s.endAt&&!function(e,t,s){const r=Va(e,t,s);return e.inclusive?r>=0:r>0}(s.endAt,No(s),r)));var s,r}function Co(e){return(t,s)=>{let r=!1;for(const n of No(e)){const e=Ao(n,t,s);if(0!==e)return e;r=r||n.field.isKeyField()}return 0}}function Ao(e,t,s){const r=e.field.isKeyField()?Pr.comparator(t.key,s.key):function(e,t,s){const r=t.data.field(e),n=s.data.field(e);return null!==r&&null!==n?fa(r,n):ir(42886)}(e.field,t,s);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return ir(19790,{direction:e.dir})}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Po{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(void 0!==s)for(const[r,n]of s)if(this.equalsFn(r,e))return n}has(e){return void 0!==this.get(e)}set(e,t){const s=this.mapKeyFn(e),r=this.inner[s];if(void 0===r)return this.inner[s]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(void 0===s)return!1;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return 1===s.length?delete this.inner[t]:s.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Li(this.inner,(t,s)=>{for(const[r,n]of s)e(r,n)})}isEmpty(){return Mi(this.inner)}size(){return this.innerSize}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Do=new Fi(Pr.comparator);function Ro(){return Do}const Oo=new Fi(Pr.comparator);function Lo(...e){let t=Oo;for(const s of e)t=t.insert(s.key,s);return t}function Mo(e){let t=Oo;return e.forEach((e,s)=>t=t.insert(e,s.overlayedDocument)),t}function Fo(){return Vo()}function Uo(){return Vo()}function Vo(){return new Po(e=>e.toString(),(e,t)=>e.isEqual(t))}const Bo=new Fi(Pr.comparator),zo=new Bi(Pr.comparator);function $o(...e){let t=zo;for(const s of e)t=t.add(s);return t}const qo=new Bi(Nr);
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function Ko(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Nn(t)?"-0":t}}function Go(e){return{integerValue:""+e}}function Ho(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!Nn(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?Go(t):Ko(e,t)}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Wo{constructor(){this._=void 0}}function Jo(e,t,s){return e instanceof Xo?function(e,t){const s={fields:{[Xi]:{stringValue:Yi},[ea]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&ta(t)&&(t=sa(t)),t&&(s.fields[Zi]=t),{mapValue:s}}(s,t):e instanceof Zo?el(e,t):e instanceof tl?sl(e,t):function(e,t){const s=Yo(e,t),r=nl(s)+nl(e.Ae);return ja(s)&&ja(e.Ae)?Go(r):Ko(e.serializer,r)}(e,t)}function Qo(e,t,s){return e instanceof Zo?el(e,t):e instanceof tl?sl(e,t):s}function Yo(e,t){return e instanceof rl?ja(s=t)||(r=s)&&"doubleValue"in r?t:{integerValue:0}:null;var s,r}class Xo extends Wo{}class Zo extends Wo{constructor(e){super(),this.elements=e}}function el(e,t){const s=il(t);for(const r of e.elements)s.some(e=>pa(e,r))||s.push(r);return{arrayValue:{values:s}}}class tl extends Wo{constructor(e){super(),this.elements=e}}function sl(e,t){let s=il(t);for(const r of e.elements)s=s.filter(e=>!pa(e,r));return{arrayValue:{values:s}}}class rl extends Wo{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function nl(e){return Ji(e.integerValue||e.doubleValue)}function il(e){return ka(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class al{constructor(e,t){this.field=e,this.transform=t}}class ol{constructor(e,t){this.version=e,this.transformResults=t}}class ll{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ll}static exists(e){return new ll(void 0,e)}static updateTime(e){return new ll(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function cl(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class dl{}function ul(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new wl(e.key,ll.none()):new fl(e.key,e.data,ll.none());{const s=e.data,r=La.empty();let n=new Bi(Ar.comparator);for(let e of t.fields)if(!n.has(e)){let t=s.field(e);null===t&&e.length>1&&(e=e.popLast(),t=s.field(e)),null===t?r.delete(e):r.set(e,t),n=n.add(e)}return new xl(e.key,r,new qi(n.toArray()),ll.none())}}function hl(e,t,s){var r;e instanceof fl?function(e,t,s){const r=e.value.clone(),n=bl(e.fieldTransforms,t,s.transformResults);r.setAll(n),t.convertToFoundDocument(s.version,r).setHasCommittedMutations()}(e,t,s):e instanceof xl?function(e,t,s){if(!cl(e.precondition,t))return void t.convertToUnknownDocument(s.version);const r=bl(e.fieldTransforms,t,s.transformResults),n=t.data;n.setAll(yl(e)),n.setAll(r),t.convertToFoundDocument(s.version,n).setHasCommittedMutations()}(e,t,s):(r=s,t.convertToNoDocument(r.version).setHasCommittedMutations())}function ml(e,t,s,r){return e instanceof fl?function(e,t,s,r){if(!cl(e.precondition,t))return s;const n=e.value.clone(),i=vl(e.fieldTransforms,r,t);return n.setAll(i),t.convertToFoundDocument(t.version,n).setHasLocalMutations(),null}(e,t,s,r):e instanceof xl?function(e,t,s,r){if(!cl(e.precondition,t))return s;const n=vl(e.fieldTransforms,r,t),i=t.data;return i.setAll(yl(e)),i.setAll(n),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null===s?null:s.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,s,r):(n=t,i=s,cl(e.precondition,n)?(n.convertToNoDocument(n.version).setHasLocalMutations(),null):i);var n,i}function pl(e,t){let s=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),n=Yo(r.transform,e||null);null!=n&&(null===s&&(s=La.empty()),s.set(r.field,n))}return s||null}function gl(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(s=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===s&&void 0===r||s&&r&&Ir(s,r,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(s=e.transform,r=t.transform,s instanceof Zo&&r instanceof Zo||s instanceof tl&&r instanceof tl?Ir(s.elements,r.elements,pa):s instanceof rl&&r instanceof rl?pa(s.Ae,r.Ae):s instanceof Xo&&r instanceof Xo);var s,r}(e,t)))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var s,r}class fl extends dl{constructor(e,t,s,r=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class xl extends dl{constructor(e,t,s,r,n=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=r,this.fieldTransforms=n,this.type=1}getFieldMask(){return this.fieldMask}}function yl(e){const t=new Map;return e.fieldMask.fields.forEach(s=>{if(!s.isEmpty()){const r=e.data.field(s);t.set(s,r)}}),t}function bl(e,t,s){const r=new Map;or(e.length===s.length,32656,{Re:s.length,Ve:e.length});for(let n=0;n<s.length;n++){const i=e[n],a=i.transform,o=t.data.field(i.field);r.set(i.field,Qo(a,o,s[n]))}return r}function vl(e,t,s){const r=new Map;for(const n of e){const e=n.transform,i=s.data.field(n.field);r.set(n.field,Jo(e,i,t))}return r}class wl extends dl{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Nl extends dl{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class jl{constructor(e,t,s,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=r}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&hl(t,e,s[r])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=ml(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=ml(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=Uo();return this.mutations.forEach(r=>{const n=e.get(r.key),i=n.overlayedDocument;let a=this.applyToLocalView(i,n.mutatedFields);a=t.has(r.key)?null:a;const o=ul(i,a);null!==o&&s.set(r.key,o),i.isValidDocument()||i.convertToNoDocument(Kr.min())}),s}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),$o())}isEqual(e){return this.batchId===e.batchId&&Ir(this.mutations,e.mutations,(e,t)=>gl(e,t))&&Ir(this.baseMutations,e.baseMutations,(e,t)=>gl(e,t))}}class kl{constructor(e,t,s,r){this.batch=e,this.commitVersion=t,this.mutationResults=s,this.docVersions=r}static from(e,t,s){or(e.mutations.length===s.length,58842,{me:e.mutations.length,fe:s.length});let r=function(){return Bo}();const n=e.mutations;for(let i=0;i<n.length;i++)r=r.insert(n[i].key,s[i].version);return new kl(e,t,s,r)}}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Il{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Sl{constructor(e,t){this.count=e,this.unchangedNames=t}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var _l,El;function Tl(e){switch(e){case cr.OK:return ir(64938);case cr.CANCELLED:case cr.UNKNOWN:case cr.DEADLINE_EXCEEDED:case cr.RESOURCE_EXHAUSTED:case cr.INTERNAL:case cr.UNAVAILABLE:case cr.UNAUTHENTICATED:return!1;case cr.INVALID_ARGUMENT:case cr.NOT_FOUND:case cr.ALREADY_EXISTS:case cr.PERMISSION_DENIED:case cr.FAILED_PRECONDITION:case cr.ABORTED:case cr.OUT_OF_RANGE:case cr.UNIMPLEMENTED:case cr.DATA_LOSS:return!0;default:return ir(15467,{code:e})}}function Cl(e){if(void 0===e)return sr("GRPC error has no .code"),cr.UNKNOWN;switch(e){case _l.OK:return cr.OK;case _l.CANCELLED:return cr.CANCELLED;case _l.UNKNOWN:return cr.UNKNOWN;case _l.DEADLINE_EXCEEDED:return cr.DEADLINE_EXCEEDED;case _l.RESOURCE_EXHAUSTED:return cr.RESOURCE_EXHAUSTED;case _l.INTERNAL:return cr.INTERNAL;case _l.UNAVAILABLE:return cr.UNAVAILABLE;case _l.UNAUTHENTICATED:return cr.UNAUTHENTICATED;case _l.INVALID_ARGUMENT:return cr.INVALID_ARGUMENT;case _l.NOT_FOUND:return cr.NOT_FOUND;case _l.ALREADY_EXISTS:return cr.ALREADY_EXISTS;case _l.PERMISSION_DENIED:return cr.PERMISSION_DENIED;case _l.FAILED_PRECONDITION:return cr.FAILED_PRECONDITION;case _l.ABORTED:return cr.ABORTED;case _l.OUT_OF_RANGE:return cr.OUT_OF_RANGE;case _l.UNIMPLEMENTED:return cr.UNIMPLEMENTED;case _l.DATA_LOSS:return cr.DATA_LOSS;default:return ir(39323,{code:e})}}(El=_l||(_l={}))[El.OK=0]="OK",El[El.CANCELLED=1]="CANCELLED",El[El.UNKNOWN=2]="UNKNOWN",El[El.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",El[El.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",El[El.NOT_FOUND=5]="NOT_FOUND",El[El.ALREADY_EXISTS=6]="ALREADY_EXISTS",El[El.PERMISSION_DENIED=7]="PERMISSION_DENIED",El[El.UNAUTHENTICATED=16]="UNAUTHENTICATED",El[El.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",El[El.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",El[El.ABORTED=10]="ABORTED",El[El.OUT_OF_RANGE=11]="OUT_OF_RANGE",El[El.UNIMPLEMENTED=12]="UNIMPLEMENTED",El[El.INTERNAL=13]="INTERNAL",El[El.UNAVAILABLE=14]="UNAVAILABLE",El[El.DATA_LOSS=15]="DATA_LOSS";
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const Al=new Ms([4294967295,4294967295],0);function Pl(e){const t=(new TextEncoder).encode(e),s=new Fs;return s.update(t),new Uint8Array(s.digest())}function Dl(e){const t=new DataView(e.buffer),s=t.getUint32(0,!0),r=t.getUint32(4,!0),n=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new Ms([s,r],0),new Ms([n,i],0)]}class Rl{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new Ol(`Invalid padding: ${t}`);if(s<0)throw new Ol(`Invalid hash count: ${s}`);if(e.length>0&&0===this.hashCount)throw new Ol(`Invalid hash count: ${s}`);if(0===e.length&&0!==t)throw new Ol(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Ms.fromNumber(this.ge)}ye(e,t,s){let r=e.add(t.multiply(Ms.fromNumber(s)));return 1===r.compare(Al)&&(r=new Ms([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;const t=Pl(e),[s,r]=Dl(t);for(let n=0;n<this.hashCount;n++){const e=this.ye(s,r,n);if(!this.we(e))return!1}return!0}static create(e,t,s){const r=e%8==0?0:8-e%8,n=new Uint8Array(Math.ceil(e/8)),i=new Rl(n,r,t);return s.forEach(e=>i.insert(e)),i}insert(e){if(0===this.ge)return;const t=Pl(e),[s,r]=Dl(t);for(let n=0;n<this.hashCount;n++){const e=this.ye(s,r,n);this.Se(e)}}Se(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class Ol extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ll{constructor(e,t,s,r,n){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=r,this.resolvedLimboDocuments=n}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const r=new Map;return r.set(e,Ml.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new Ll(Kr.min(),r,new Fi(Nr),Ro(),$o())}}class Ml{constructor(e,t,s,r,n){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=r,this.removedDocuments=n}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new Ml(s,t,$o(),$o(),$o())}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Fl{constructor(e,t,s,r){this.be=e,this.removedTargetIds=t,this.key=s,this.De=r}}class Ul{constructor(e,t){this.targetId=e,this.Ce=t}}class Vl{constructor(e,t,s=Gi.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=r}}class Bl{constructor(){this.ve=0,this.Fe=ql(),this.Me=Gi.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=$o(),t=$o(),s=$o();return this.Fe.forEach((r,n)=>{switch(n){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:s=s.add(r);break;default:ir(38017,{changeType:n})}}),new Ml(this.Me,this.xe,e,t,s)}qe(){this.Oe=!1,this.Fe=ql()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,or(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class zl{constructor(e){this.Ge=e,this.ze=new Map,this.je=Ro(),this.Je=$l(),this.He=$l(),this.Ye=new Fi(Nr)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const s=this.nt(t);switch(e.state){case 0:this.rt(t)&&s.Le(e.resumeToken);break;case 1:s.Ke(),s.Ne||s.qe(),s.Le(e.resumeToken);break;case 2:s.Ke(),s.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(s.We(),s.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),s.Le(e.resumeToken));break;default:ir(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,s)=>{this.rt(s)&&t(s)})}st(e){const t=e.targetId,s=e.Ce.count,r=this.ot(t);if(r){const n=r.target;if(po(n))if(0===s){const e=new Pr(n.path);this.et(t,e,Fa.newNoDocument(e,Kr.min()))}else or(1===s,20013,{expectedCount:s});else{const r=this._t(t);if(r!==s){const s=this.ut(e),n=s?this.ct(s,e,r):1;if(0!==n){this.it(t);const e=2===n?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,e)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:r=0},hashCount:n=0}=t;let i,a;try{i=Qi(s).toUint8Array()}catch(o){if(o instanceof Ki)return rr("Decoding the base64 bloom filter in existence filter failed ("+o.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw o}try{a=new Rl(i,r,n)}catch(o){return rr(o instanceof Ol?"BloomFilter error: ":"Applying bloom filter failed: ",o),null}return 0===a.ge?null:a}ct(e,t,s){return t.Ce.count===s-this.Pt(e,t.targetId)?0:2}Pt(e,t){const s=this.Ge.getRemoteKeysForTarget(t);let r=0;return s.forEach(s=>{const n=this.Ge.ht(),i=`projects/${n.projectId}/databases/${n.database}/documents/${s.path.canonicalString()}`;e.mightContain(i)||(this.et(t,s,null),r++)}),r}Tt(e){const t=new Map;this.ze.forEach((s,r)=>{const n=this.ot(r);if(n){if(s.current&&po(n.target)){const t=new Pr(n.target.path);this.It(t).has(r)||this.Et(r,t)||this.et(r,t,Fa.newNoDocument(t,e))}s.Be&&(t.set(r,s.ke()),s.qe())}});let s=$o();this.He.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{const t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(s=s.add(e))}),this.je.forEach((t,s)=>s.setReadTime(e));const r=new Ll(e,t,this.Ye,this.je,s);return this.je=Ro(),this.Je=$l(),this.He=$l(),this.Ye=new Fi(Nr),r}Xe(e,t){if(!this.rt(e))return;const s=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,s),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,s){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),s&&(this.je=this.je.insert(t,s))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new Bl,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new Bi(Nr),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new Bi(Nr),this.Je=this.Je.insert(e,t)),t}rt(e){const t=null!==this.ot(e);return t||tr("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Bl),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function $l(){return new Fi(Pr.comparator)}function ql(){return new Fi(Pr.comparator)}const Kl=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),Gl=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),Hl=(()=>({and:"AND",or:"OR"}))();class Wl{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Jl(e,t){return e.useProto3Json||wn(t)?t:{value:t}}function Ql(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Yl(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Xl(e,t){return Ql(e,t.toTimestamp())}function Zl(e){return or(!!e,49232),Kr.fromTimestamp(function(e){const t=Wi(e);return new qr(t.seconds,t.nanos)}(e))}function ec(e,t){return tc(e,t).canonicalString()}function tc(e,t){const s=(r=e,new Tr(["projects",r.projectId,"databases",r.database])).child("documents");var r;return void 0===t?s:s.child(t)}function sc(e){const t=Tr.fromString(e);return or(jc(t),10190,{key:t.toString()}),t}function rc(e,t){return ec(e.databaseId,t.path)}function nc(e,t){const s=sc(t);if(s.get(1)!==e.databaseId.projectId)throw new dr(cr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+s.get(1)+" vs "+e.databaseId.projectId);if(s.get(3)!==e.databaseId.database)throw new dr(cr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+s.get(3)+" vs "+e.databaseId.database);return new Pr(lc(s))}function ic(e,t){return ec(e.databaseId,t)}function ac(e){const t=sc(e);return 4===t.length?Tr.emptyPath():lc(t)}function oc(e){return new Tr(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function lc(e){return or(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function cc(e,t,s){return{name:rc(e,t),fields:s.value.mapValue.fields}}function dc(e,t){let s;if(t instanceof fl)s={update:cc(e,t.key,t.value)};else if(t instanceof wl)s={delete:rc(e,t.key)};else if(t instanceof xl)s={update:cc(e,t.key,t.data),updateMask:Nc(t.fieldMask)};else{if(!(t instanceof Nl))return ir(16599,{Vt:t.type});s={verify:rc(e,t.key)}}return t.fieldTransforms.length>0&&(s.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const s=t.transform;if(s instanceof Xo)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(s instanceof Zo)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:s.elements}};if(s instanceof tl)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:s.elements}};if(s instanceof rl)return{fieldPath:t.field.canonicalString(),increment:s.Ae};throw ir(20930,{transform:t.transform})}(0,e))),t.precondition.isNone||(s.currentDocument=(r=e,void 0!==(n=t.precondition).updateTime?{updateTime:Xl(r,n.updateTime)}:void 0!==n.exists?{exists:n.exists}:ir(27497))),s;var r,n}function uc(e,t){const s=t.currentDocument?void 0!==(n=t.currentDocument).updateTime?ll.updateTime(Zl(n.updateTime)):void 0!==n.exists?ll.exists(n.exists):ll.none():ll.none(),r=t.updateTransforms?t.updateTransforms.map(t=>function(e,t){let s=null;if("setToServerValue"in t)or("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),s=new Xo;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];s=new Zo(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];s=new tl(e)}else"increment"in t?s=new rl(e,t.increment):ir(16584,{proto:t});const r=Ar.fromServerFormat(t.fieldPath);return new al(r,s)}(e,t)):[];var n;if(t.update){t.update.name;const n=nc(e,t.update.name),i=new La({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new qi(t.map(e=>Ar.fromServerFormat(e)))}(t.updateMask);return new xl(n,i,e,s,r)}return new fl(n,i,s,r)}if(t.delete){const r=nc(e,t.delete);return new wl(r,s)}if(t.verify){const r=nc(e,t.verify);return new Nl(r,s)}return ir(1463,{proto:t})}function hc(e,t){return{documents:[ic(e,t.path)]}}function mc(e,t){const s={structuredQuery:{}},r=t.path;let n;null!==t.collectionGroup?(n=r,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n=r.popLast(),s.structuredQuery.from=[{collectionId:r.lastSegment()}]),s.parent=ic(e,n);const i=function(e){if(0!==e.length)return wc(Ga.create(e,"and"))}(t.filters);i&&(s.structuredQuery.where=i);const a=function(e){if(0!==e.length)return e.map(e=>{return{field:bc((t=e).field),direction:fc(t.dir)};var t})}(t.orderBy);a&&(s.structuredQuery.orderBy=a);const o=Jl(e,t.limit);return null!==o&&(s.structuredQuery.limit=o),t.startAt&&(s.structuredQuery.startAt={before:(l=t.startAt).inclusive,values:l.position}),t.endAt&&(s.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ft:s,parent:n};var l}function pc(e){let t=ac(e.parent);const s=e.structuredQuery,r=s.from?s.from.length:0;let n=null;if(r>0){or(1===r,65062);const e=s.from[0];e.allDescendants?n=e.collectionId:t=t.child(e.collectionId)}let i=[];s.where&&(i=function(e){const t=gc(e);return t instanceof Ga&&Ja(t)?t.getFilters():[t]}(s.where));let a=[];s.orderBy&&(a=s.orderBy.map(e=>{return new za(vc((t=e).field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction));var t}));let o=null;s.limit&&(o=function(e){let t;return t="object"==typeof e?e.value:e,wn(t)?null:t}(s.limit));let l=null;s.startAt&&(l=function(e){const t=!!e.before,s=e.values||[];return new Ua(s,t)}(s.startAt));let c=null;return s.endAt&&(c=function(e){const t=!e.before,s=e.values||[];return new Ua(s,t)}(s.endAt)),function(e,t,s,r,n,i,a,o){return new yo(e,t,s,r,n,i,a,o)}(t,n,a,i,o,"F",l,c)}function gc(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=vc(e.unaryFilter.field);return Ka.create(t,"==",{doubleValue:NaN});case"IS_NULL":const s=vc(e.unaryFilter.field);return Ka.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=vc(e.unaryFilter.field);return Ka.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const n=vc(e.unaryFilter.field);return Ka.create(n,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ir(61313);default:return ir(60726)}}(e):void 0!==e.fieldFilter?(t=e,Ka.create(vc(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ir(58110);default:return ir(50506)}}(t.fieldFilter.op),t.fieldFilter.value)):void 0!==e.compositeFilter?function(e){return Ga.create(e.compositeFilter.filters.map(e=>gc(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return ir(1026)}}(e.compositeFilter.op))}(e):ir(30097,{filter:e});var t}function fc(e){return Kl[e]}function xc(e){return Gl[e]}function yc(e){return Hl[e]}function bc(e){return{fieldPath:e.canonicalString()}}function vc(e){return Ar.fromServerFormat(e.fieldPath)}function wc(e){return e instanceof Ka?function(e){if("=="===e.op){if(Sa(e.value))return{unaryFilter:{field:bc(e.field),op:"IS_NAN"}};if(Ia(e.value))return{unaryFilter:{field:bc(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Sa(e.value))return{unaryFilter:{field:bc(e.field),op:"IS_NOT_NAN"}};if(Ia(e.value))return{unaryFilter:{field:bc(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:bc(e.field),op:xc(e.op),value:e.value}}}(e):e instanceof Ga?function(e){const t=e.getFilters().map(e=>wc(e));return 1===t.length?t[0]:{compositeFilter:{op:yc(e.op),filters:t}}}(e):ir(54877,{filter:e})}function Nc(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function jc(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class kc{constructor(e,t,s,r,n=Kr.min(),i=Kr.min(),a=Gi.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=r,this.snapshotVersion=n,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new kc(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new kc(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new kc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new kc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ic{constructor(e){this.yt=e}}function Sc(e,t){let s;if(t.document)s=function(e,t,s){const r=nc(e,t.name),n=Zl(t.updateTime),i=t.createTime?Zl(t.createTime):Kr.min(),a=new La({mapValue:{fields:t.fields}}),o=Fa.newFoundDocument(r,n,i,a);return s&&o.setHasCommittedMutations(),s?o.setHasCommittedMutations():o}(e.yt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=Pr.fromSegments(t.noDocument.path),r=Cc(t.noDocument.readTime);s=Fa.newNoDocument(e,r),t.hasCommittedMutations&&s.setHasCommittedMutations()}else{if(!t.unknownDocument)return ir(56709);{const e=Pr.fromSegments(t.unknownDocument.path),r=Cc(t.unknownDocument.version);s=Fa.newUnknownDocument(e,r)}}return t.readTime&&s.setReadTime(function(e){const t=new qr(e[0],e[1]);return Kr.fromTimestamp(t)}(t.readTime)),s}function _c(e,t){const s=t.key,r={prefixPath:s.getCollectionPath().popLast().toArray(),collectionGroup:s.collectionGroup,documentId:s.path.lastSegment(),readTime:Ec(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document={name:rc(n=e.yt,(i=t).key),fields:i.data.value.mapValue.fields,updateTime:Ql(n,i.version.toTimestamp()),createTime:Ql(n,i.createTime.toTimestamp())};else if(t.isNoDocument())r.noDocument={path:s.path.toArray(),readTime:Tc(t.version)};else{if(!t.isUnknownDocument())return ir(57904,{document:t});r.unknownDocument={path:s.path.toArray(),version:Tc(t.version)}}var n,i;return r}function Ec(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Tc(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Cc(e){const t=new qr(e.seconds,e.nanoseconds);return Kr.fromTimestamp(t)}function Ac(e,t){const s=(t.baseMutations||[]).map(t=>uc(e.yt,t));for(let i=0;i<t.mutations.length-1;++i){const e=t.mutations[i];if(i+1<t.mutations.length&&void 0!==t.mutations[i+1].transform){const s=t.mutations[i+1];e.updateTransforms=s.transform.fieldTransforms,t.mutations.splice(i+1,1),++i}}const r=t.mutations.map(t=>uc(e.yt,t)),n=qr.fromMillis(t.localWriteTimeMs);return new jl(t.batchId,n,s,r)}function Pc(e){const t=Cc(e.readTime),s=void 0!==e.lastLimboFreeSnapshotVersion?Cc(e.lastLimboFreeSnapshotVersion):Kr.min();let r;return r=void 0!==e.query.documents?function(e){const t=e.documents.length;return or(1===t,1966,{count:t}),jo(bo(ac(e.documents[0])))}(e.query):function(e){return jo(pc(e))}(e.query),new kc(r,e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,t,s,Gi.fromBase64String(e.resumeToken))}function Dc(e,t){const s=Tc(t.snapshotVersion),r=Tc(t.lastLimboFreeSnapshotVersion);let n;n=po(t.target)?hc(e.yt,t.target):mc(e.yt,t.target).ft;const i=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:ho(t.target),readTime:s,resumeToken:i,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:n}}function Rc(e){const t=pc({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Io(t,t.limit,"L"):t}function Oc(e,t){return new Il(t.largestBatchId,uc(e.yt,t.overlayMutation))}function Lc(e,t){const s=t.path.lastSegment();return[e,kn(t.path.popLast()),s]}function Mc(e,t,s,r){return{indexId:e,uid:t,sequenceNumber:s,readTime:Tc(r.readTime),documentKey:kn(r.documentKey.path),largestBatchId:r.largestBatchId}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Fc{getBundleMetadata(e,t){return Uc(e).get(t).next(e=>{if(e)return{id:(t=e).bundleId,createTime:Cc(t.createTime),version:t.version};var t})}saveBundleMetadata(e,t){return Uc(e).put({bundleId:(s=t).id,createTime:Tc(Zl(s.createTime)),version:s.version});var s}getNamedQuery(e,t){return Vc(e).get(t).next(e=>{if(e)return{name:(t=e).name,query:Rc(t.bundledQuery),readTime:Cc(t.readTime)};var t})}saveNamedQuery(e,t){return Vc(e).put({name:(s=t).name,readTime:Tc(Zl(s.readTime)),bundledQuery:s.bundledQuery});var s}}function Uc(e){return Ri(e,ai)}function Vc(e){return Ri(e,oi)}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Bc{constructor(e,t){this.serializer=e,this.userId=t}static wt(e,t){const s=t.uid||"";return new Bc(e,s)}getOverlay(e,t){return zc(e).get(Lc(this.userId,t)).next(e=>e?Oc(this.serializer,e):null)}getOverlays(e,t){const s=Fo();return rn.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&s.set(t,e)})).next(()=>s)}saveOverlays(e,t,s){const r=[];return s.forEach((s,n)=>{const i=new Il(t,n);r.push(this.St(e,i))}),rn.waitFor(r)}removeOverlaysForBatchId(e,t,s){const r=new Set;t.forEach(e=>r.add(kn(e.getCollectionPath())));const n=[];return r.forEach(t=>{const r=IDBKeyRange.bound([this.userId,t,s],[this.userId,t,s+1],!1,!0);n.push(zc(e).Z(vi,r))}),rn.waitFor(n)}getOverlaysForCollection(e,t,s){const r=Fo(),n=kn(t),i=IDBKeyRange.bound([this.userId,n,s],[this.userId,n,Number.POSITIVE_INFINITY],!0);return zc(e).J(vi,i).next(e=>{for(const t of e){const e=Oc(this.serializer,t);r.set(e.getKey(),e)}return r})}getOverlaysForCollectionGroup(e,t,s,r){const n=Fo();let i;const a=IDBKeyRange.bound([this.userId,t,s],[this.userId,t,Number.POSITIVE_INFINITY],!0);return zc(e).ee({index:Ni,range:a},(e,t,s)=>{const a=Oc(this.serializer,t);n.size()<r||a.largestBatchId===i?(n.set(a.getKey(),a),i=a.largestBatchId):s.done()}).next(()=>n)}St(e,t){return zc(e).put(function(e,t,s){const[r,n,i]=Lc(t,s.mutation.key);return{userId:t,collectionPath:n,documentId:i,collectionGroup:s.mutation.key.getCollectionGroup(),largestBatchId:s.largestBatchId,overlayMutation:dc(e.yt,s.mutation)}}(this.serializer,this.userId,t))}}function zc(e){return Ri(e,yi)}
/**
     * @license
     * Copyright 2024 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class $c{bt(e){return Ri(e,ki)}getSessionToken(e){return this.bt(e).get("sessionToken").next(e=>{const t=null==e?void 0:e.value;return t?Gi.fromUint8Array(t):Gi.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.bt(e).put({name:"sessionToken",value:t.toUint8Array()})}}
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class qc{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(Ji(e.integerValue));else if("doubleValue"in e){const s=Ji(e.doubleValue);isNaN(s)?this.Ft(t,13):(this.Ft(t,15),Nn(s)?t.Mt(0):t.Mt(s))}else if("timestampValue"in e){let s=e.timestampValue;this.Ft(t,20),"string"==typeof s&&(s=Wi(s)),t.xt(`${s.seconds||""}`),t.Mt(s.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(Qi(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const s=e.geoPointValue;this.Ft(t,45),t.Mt(s.latitude||0),t.Mt(s.longitude||0)}else"mapValue"in e?Ca(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):Ea(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):ir(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const s=e.fields||{};this.Ft(t,55);for(const r of Object.keys(s))this.Ot(r,t),this.Ct(s[r],t)}kt(e,t){var s,r;const n=e.fields||{};this.Ft(t,53);const i=ua,a=(null==(r=null==(s=n[i].arrayValue)?void 0:s.values)?void 0:r.length)||0;this.Ft(t,15),t.Mt(Ji(a)),this.Ot(i,t),this.Ct(n[i],t)}Qt(e,t){const s=e.values||[];this.Ft(t,50);for(const r of s)this.Ct(r,t)}Lt(e,t){this.Ft(t,37),Pr.fromName(e).path.forEach(e=>{this.Ft(t,60),this.Ut(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}qc.Kt=new qc;
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law | agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const Kc=255;function Gc(e){if(0===e)return 8;let t=0;return e>>4||(t+=4,e<<=4),e>>6||(t+=2,e<<=2),e>>7||(t+=1),t}function Hc(e){const t=64-function(e){let t=0;for(let s=0;s<8;++s){const r=Gc(255&e[s]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}class Wc{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const t=e[Symbol.iterator]();let s=t.next();for(;!s.done;)this.Gt(s.value),s=t.next();this.zt()}jt(e){const t=e[Symbol.iterator]();let s=t.next();for(;!s.done;)this.Jt(s.value),s=t.next();this.Ht()}Yt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Gt(e);else if(e<2048)this.Gt(960|e>>>6),this.Gt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Gt(480|e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e);else{const e=t.codePointAt(0);this.Gt(240|e>>>18),this.Gt(128|63&e>>>12),this.Gt(128|63&e>>>6),this.Gt(128|63&e)}}this.zt()}Zt(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.Jt(e);else if(e<2048)this.Jt(960|e>>>6),this.Jt(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.Jt(480|e>>>12),this.Jt(128|63&e>>>6),this.Jt(128|63&e);else{const e=t.codePointAt(0);this.Jt(240|e>>>18),this.Jt(128|63&e>>>12),this.Jt(128|63&e>>>6),this.Jt(128|63&e)}}this.Ht()}Xt(e){const t=this.en(e),s=Hc(t);this.tn(1+s),this.buffer[this.position++]=255&s;for(let r=t.length-s;r<t.length;++r)this.buffer[this.position++]=255&t[r]}nn(e){const t=this.en(e),s=Hc(t);this.tn(1+s),this.buffer[this.position++]=~(255&s);for(let r=t.length-s;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}rn(){this.sn(Kc),this.sn(255)}_n(){this.an(Kc),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),s=!!(128&t[0]);t[0]^=s?255:128;for(let r=1;r<t.length;++r)t[r]^=s?255:0;return t}Gt(e){const t=255&e;0===t?(this.sn(0),this.sn(255)):t===Kc?(this.sn(Kc),this.sn(0)):this.sn(t)}Jt(e){const t=255&e;0===t?(this.an(0),this.an(255)):t===Kc?(this.an(Kc),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const t=e+this.position;if(t<=this.buffer.length)return;let s=2*this.buffer.length;s<t&&(s=t);const r=new Uint8Array(s);r.set(this.buffer),this.buffer=r}}class Jc{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class Qc{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class Yc{constructor(){this.cn=new Wc,this.ln=new Jc(this.cn),this.hn=new Qc(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return 0===e?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Xc{constructor(e,t,s,r){this.Tn=e,this.In=t,this.En=s,this.dn=r}An(){const e=this.dn.length,t=0===e||255===this.dn[e-1]?e+1:e,s=new Uint8Array(t);return s.set(this.dn,0),t!==e?s.set([0],this.dn.length):++s[s.length-1],new Xc(this.Tn,this.In,this.En,s)}Rn(e,t,s){return{indexId:this.Tn,uid:e,arrayValue:td(this.En),directionalValue:td(this.dn),orderedDocumentKey:td(t),documentKey:s.path.toArray()}}Vn(e,t,s){const r=this.Rn(e,t,s);return[r.indexId,r.uid,r.arrayValue,r.directionalValue,r.orderedDocumentKey,r.documentKey]}}function Zc(e,t){let s=e.Tn-t.Tn;return 0!==s?s:(s=ed(e.En,t.En),0!==s?s:(s=ed(e.dn,t.dn),0!==s?s:Pr.comparator(e.In,t.In)))}function ed(e,t){for(let s=0;s<e.length&&s<t.length;++s){const r=e[s]-t[s];if(0!==r)return r}return e.length-t.length}function td(e){return Je()?function(e){let t="";for(let s=0;s<e.length;s++)t+=String.fromCharCode(e[s]);return t}(e):e}function sd(e){return"string"!=typeof e?e:function(e){const t=new Uint8Array(e.length);for(let s=0;s<e.length;s++)t[s]=e.charCodeAt(s);return t}(e)}class rd{constructor(e){this.mn=new Bi((e,t)=>Ar.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const t of e.filters){const e=t;e.isInequality()?this.mn=this.mn.add(e):this.gn.push(e)}}get pn(){return this.mn.size>1}yn(e){if(or(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const t=Hr(e);if(void 0!==t&&!this.wn(t))return!1;const s=Wr(e);let r=new Set,n=0,i=0;for(;n<s.length&&this.wn(s[n]);++n)r=r.add(s[n].fieldPath.canonicalString());if(n===s.length)return!0;if(this.mn.size>0){const e=this.mn.getIterator().getNext();if(!r.has(e.field.canonicalString())){const t=s[n];if(!this.Sn(e,t)||!this.bn(this.fn[i++],t))return!1}++n}for(;n<s.length;++n){const e=s[n];if(i>=this.fn.length||!this.bn(this.fn[i++],e))return!1}return!0}Dn(){if(this.pn)return null;let e=new Bi(Ar.comparator);const t=[];for(const s of this.gn)if(!s.field.isKeyField())if("array-contains"===s.op||"array-contains-any"===s.op)t.push(new Jr(s.field,2));else{if(e.has(s.field))continue;e=e.add(s.field),t.push(new Jr(s.field,0))}for(const s of this.fn)s.field.isKeyField()||e.has(s.field)||(e=e.add(s.field),t.push(new Jr(s.field,"asc"===s.dir?0:1)));return new Gr(Gr.UNKNOWN_ID,this.collectionId,t,Qr.empty())}wn(e){for(const t of this.gn)if(this.Sn(t,e))return!0;return!1}Sn(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const s="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===s}bn(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function nd(e){var t,s;if(or(e instanceof Ka||e instanceof Ga,20012),e instanceof Ka){if(e instanceof ao){const r=(null==(s=null==(t=e.value.arrayValue)?void 0:t.values)?void 0:s.map(t=>Ka.create(e.field,"==",t)))||[];return Ga.create(r,"or")}return e}const r=e.filters.map(e=>nd(e));return Ga.create(r,e.op)}function id(e){if(0===e.getFilters().length)return[];const t=cd(nd(e));return or(ld(t),7391),ad(t)||od(t)?[t]:t.getFilters()}function ad(e){return e instanceof Ka}function od(e){return e instanceof Ga&&Ja(e)}function ld(e){return ad(e)||od(e)||function(e){if(e instanceof Ga&&Wa(e)){for(const t of e.getFilters())if(!ad(t)&&!od(t))return!1;return!0}return!1}(e)}function cd(e){if(or(e instanceof Ka||e instanceof Ga,34018),e instanceof Ka)return e;if(1===e.filters.length)return cd(e.filters[0]);const t=e.filters.map(e=>cd(e));let s=Ga.create(t,e.op);return s=hd(s),ld(s)?s:(or(s instanceof Ga,64498),or(Ha(s),40251),or(s.filters.length>1,57927),s.filters.reduce((e,t)=>dd(e,t)))}function dd(e,t){let s;return or(e instanceof Ka||e instanceof Ga,38388),or(t instanceof Ka||t instanceof Ga,25473),s=e instanceof Ka?t instanceof Ka?(r=e,n=t,Ga.create([r,n],"and")):ud(e,t):t instanceof Ka?ud(t,e):function(e,t){if(or(e.filters.length>0&&t.filters.length>0,48005),Ha(e)&&Ha(t))return Za(e,t.getFilters());const s=Wa(e)?e:t,r=Wa(e)?t:e,n=s.filters.map(e=>dd(e,r));return Ga.create(n,"or")}(e,t),hd(s);var r,n}function ud(e,t){if(Ha(t))return Za(t,e.getFilters());{const s=t.filters.map(t=>dd(e,t));return Ga.create(s,"or")}}function hd(e){if(or(e instanceof Ka||e instanceof Ga,11850),e instanceof Ka)return e;const t=e.getFilters();if(1===t.length)return hd(t[0]);if(Qa(e))return e;const s=t.map(e=>hd(e)),r=[];return s.forEach(t=>{t instanceof Ka?r.push(t):t instanceof Ga&&(t.op===e.op?r.push(...t.filters):r.push(t))}),1===r.length?r[0]:Ga.create(r,e.op)
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */}class md{constructor(){this.Cn=new pd}addToCollectionParentIndex(e,t){return this.Cn.add(t),rn.resolve()}getCollectionParents(e,t){return rn.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return rn.resolve()}deleteFieldIndex(e,t){return rn.resolve()}deleteAllFieldIndexes(e){return rn.resolve()}createTargetIndexes(e,t){return rn.resolve()}getDocumentsMatchingTarget(e,t){return rn.resolve(null)}getIndexType(e,t){return rn.resolve(0)}getFieldIndexes(e,t){return rn.resolve([])}getNextCollectionGroupToUpdate(e){return rn.resolve(null)}getMinOffset(e,t){return rn.resolve(Xr.min())}getMinOffsetFromCollectionGroup(e,t){return rn.resolve(Xr.min())}updateCollectionGroup(e,t,s){return rn.resolve()}updateIndexEntries(e,t){return rn.resolve()}}class pd{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t]||new Bi(Tr.comparator),n=!r.has(s);return this.index[t]=r.add(s),n}has(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t];return r&&r.has(s)}getEntries(e){return(this.index[e]||new Bi(Tr.comparator)).toArray()}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const gd="IndexedDbIndexManager",fd=new Uint8Array(0);class xd{constructor(e,t){this.databaseId=t,this.vn=new pd,this.Fn=new Po(e=>ho(e),(e,t)=>mo(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){const s=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});const n={collectionId:s,parent:kn(r)};return yd(e).put(n)}return rn.resolve()}getCollectionParents(e,t){const s=[],r=IDBKeyRange.bound([t,""],[Sr(t),""],!1,!0);return yd(e).J(r).next(e=>{for(const r of e){if(r.collectionId!==t)break;s.push(_n(r.parent))}return s})}addFieldIndex(e,t){const s=vd(e),r={indexId:(n=t).indexId,collectionGroup:n.collectionGroup,fields:n.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])};var n;delete r.indexId;const i=s.add(r);if(t.indexState){const s=wd(e);return i.next(e=>{s.put(Mc(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return i.next()}deleteFieldIndex(e,t){const s=vd(e),r=wd(e),n=bd(e);return s.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>n.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=vd(e),s=bd(e),r=wd(e);return t.Z().next(()=>s.Z()).next(()=>r.Z())}createTargetIndexes(e,t){return rn.forEach(this.Mn(t),t=>this.getIndexType(e,t).next(s=>{if(0===s||1===s){const s=new rd(t).Dn();if(null!=s)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){const s=bd(e);let r=!0;const n=new Map;return rn.forEach(this.Mn(t),t=>this.xn(e,t).next(e=>{r&&(r=!!e),n.set(t,e)})).next(()=>{if(r){let e=$o();const r=[];return rn.forEach(n,(n,i)=>{var a;tr(gd,`Using index ${a=n,`id=${a.indexId}|cg=${a.collectionGroup}|f=${a.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`} to execute ${ho(t)}`);const o=function(e,t){const s=Hr(t);if(void 0===s)return null;for(const r of go(e,s.fieldPath))switch(r.op){case"array-contains-any":return r.value.arrayValue.values||[];case"array-contains":return[r.value]}return null}(i,n),l=function(e,t){const s=new Map;for(const r of Wr(t))for(const t of go(e,r.fieldPath))switch(t.op){case"==":case"in":s.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return s.set(r.fieldPath.canonicalString(),t.value),Array.from(s.values())}return null}(i,n),c=function(e,t){const s=[];let r=!0;for(const n of Wr(t)){const t=0===n.kind?fo(e,n.fieldPath,e.startAt):xo(e,n.fieldPath,e.startAt);s.push(t.value),r&&(r=t.inclusive)}return new Ua(s,r)}(i,n),d=function(e,t){const s=[];let r=!0;for(const n of Wr(t)){const t=0===n.kind?xo(e,n.fieldPath,e.endAt):fo(e,n.fieldPath,e.endAt);s.push(t.value),r&&(r=t.inclusive)}return new Ua(s,r)}(i,n),u=this.On(n,i,c),h=this.On(n,i,d),m=this.Nn(n,i,l),p=this.Bn(n.indexId,o,u,c.inclusive,h,d.inclusive,m);return rn.forEach(p,n=>s.Y(n,t.limit).next(t=>{t.forEach(t=>{const s=Pr.fromSegments(t.documentKey);e.has(s)||(e=e.add(s),r.push(s))})}))}).next(()=>r)}return rn.resolve(null)})}Mn(e){let t=this.Fn.get(e);return t||(t=0===e.filters.length?[e]:id(Ga.create(e.filters,"and")).map(t=>uo(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,t),t)}Bn(e,t,s,r,n,i,a){const o=(null!=t?t.length:1)*Math.max(s.length,n.length),l=o/(null!=t?t.length:1),c=[];for(let d=0;d<o;++d){const o=t?this.Ln(t[d/l]):fd,u=this.kn(e,o,s[d%l],r),h=this.qn(e,o,n[d%l],i),m=a.map(t=>this.kn(e,o,t,!0));c.push(...this.createRange(u,h,m))}return c}kn(e,t,s,r){const n=new Xc(e,Pr.empty(),t,s);return r?n:n.An()}qn(e,t,s,r){const n=new Xc(e,Pr.empty(),t,s);return r?n.An():n}xn(e,t){const s=new rd(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(e=>{let t=null;for(const r of e)s.yn(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t})}getIndexType(e,t){let s=2;const r=this.Mn(t);return rn.forEach(r,t=>this.xn(e,t).next(e=>{e?0!==s&&e.fields.length<function(e){let t=new Bi(Ar.comparator),s=!1;for(const r of e.filters)for(const e of r.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?s=!0:t=t.add(e.field));for(const r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+(s?1:0)}(t)&&(s=1):s=0})).next(()=>null!==t.limit&&r.length>1&&2===s?1:s)}Qn(e,t){const s=new Yc;for(const r of Wr(e)){const e=t.data.field(r.fieldPath);if(null==e)return null;const n=s.Pn(r.kind);qc.Kt.Dt(e,n)}return s.un()}Ln(e){const t=new Yc;return qc.Kt.Dt(e,t.Pn(0)),t.un()}$n(e,t){const s=new Yc;return qc.Kt.Dt(Na(this.databaseId,t),s.Pn(function(e){const t=Wr(e);return 0===t.length?0:t[t.length-1].kind}(e))),s.un()}Nn(e,t,s){if(null===s)return[];let r=[];r.push(new Yc);let n=0;for(const i of Wr(e)){const e=s[n++];for(const s of r)if(this.Un(t,i.fieldPath)&&ka(e))r=this.Kn(r,i,e);else{const t=s.Pn(i.kind);qc.Kt.Dt(e,t)}}return this.Wn(r)}On(e,t,s){return this.Nn(e,t,s.position)}Wn(e){const t=[];for(let s=0;s<e.length;++s)t[s]=e[s].un();return t}Kn(e,t,s){const r=[...e],n=[];for(const i of s.arrayValue.values||[])for(const e of r){const s=new Yc;s.seed(e.un()),qc.Kt.Dt(i,s.Pn(t.kind)),n.push(s)}return n}Un(e,t){return!!e.filters.find(e=>e instanceof Ka&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){const s=vd(e),r=wd(e);return(t?s.J(ci,IDBKeyRange.bound(t,t)):s.J()).next(e=>{const t=[];return rn.forEach(e,e=>r.get([e.indexId,this.uid]).next(s=>{t.push(function(e,t){const s=t?new Qr(t.sequenceNumber,new Xr(Cc(t.readTime),new Pr(_n(t.documentKey)),t.largestBatchId)):Qr.empty(),r=e.fields.map(([e,t])=>new Jr(Ar.fromServerFormat(e),t));return new Gr(e.indexId,e.collectionGroup,r,s)}(e,s))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{const s=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==s?s:Nr(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,s){const r=vd(e),n=wd(e);return this.Gn(e).next(e=>r.J(ci,IDBKeyRange.bound(t,t)).next(t=>rn.forEach(t,t=>n.put(Mc(t.indexId,this.uid,e,s)))))}updateIndexEntries(e,t){const s=new Map;return rn.forEach(t,(t,r)=>{const n=s.get(t.collectionGroup);return(n?rn.resolve(n):this.getFieldIndexes(e,t.collectionGroup)).next(n=>(s.set(t.collectionGroup,n),rn.forEach(n,s=>this.zn(e,t,s).next(t=>{const n=this.jn(r,s);return t.isEqual(n)?rn.resolve():this.Jn(e,r,s,t,n)}))))})}Hn(e,t,s,r){return bd(e).put(r.Rn(this.uid,this.$n(s,t.key),t.key))}Yn(e,t,s,r){return bd(e).delete(r.Vn(this.uid,this.$n(s,t.key),t.key))}zn(e,t,s){const r=bd(e);let n=new Bi(Zc);return r.ee({index:fi,range:IDBKeyRange.only([s.indexId,this.uid,td(this.$n(s,t))])},(e,r)=>{n=n.add(new Xc(s.indexId,t,sd(r.arrayValue),sd(r.directionalValue)))}).next(()=>n)}jn(e,t){let s=new Bi(Zc);const r=this.Qn(t,e);if(null==r)return s;const n=Hr(t);if(null!=n){const i=e.data.field(n.fieldPath);if(ka(i))for(const n of i.arrayValue.values||[])s=s.add(new Xc(t.indexId,e.key,this.Ln(n),r))}else s=s.add(new Xc(t.indexId,e.key,fd,r));return s}Jn(e,t,s,r,n){tr(gd,"Updating index entries for document '%s'",t.key);const i=[];return function(e,t,s,r,n){const i=e.getIterator(),a=t.getIterator();let o=$i(i),l=$i(a);for(;o||l;){let e=!1,t=!1;if(o&&l){const r=s(o,l);r<0?t=!0:r>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(r(l),l=$i(a)):t?(n(o),o=$i(i)):(o=$i(i),l=$i(a))}}(r,n,Zc,r=>{i.push(this.Hn(e,t,s,r))},r=>{i.push(this.Yn(e,t,s,r))}),rn.waitFor(i)}Gn(e){let t=1;return wd(e).ee({index:hi,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,s,r)=>{r.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,s){s=s.sort((e,t)=>Zc(e,t)).filter((e,t,s)=>!t||0!==Zc(e,s[t-1]));const r=[];r.push(e);for(const i of s){const s=Zc(i,e),n=Zc(i,t);if(0===s)r[0]=e.An();else if(s>0&&n<0)r.push(i),r.push(i.An());else if(n>0)break}r.push(t);const n=[];for(let i=0;i<r.length;i+=2){if(this.Zn(r[i],r[i+1]))return[];const e=r[i].Vn(this.uid,fd,Pr.empty()),t=r[i+1].Vn(this.uid,fd,Pr.empty());n.push(IDBKeyRange.bound(e,t))}return n}Zn(e,t){return Zc(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Nd)}getMinOffset(e,t){return rn.mapArray(this.Mn(t),t=>this.xn(e,t).next(e=>e||ir(44426))).next(Nd)}}function yd(e){return Ri(e,ri)}function bd(e){return Ri(e,pi)}function vd(e){return Ri(e,li)}function wd(e){return Ri(e,di)}function Nd(e){or(0!==e.length,28825);let t=e[0].indexState.offset,s=t.largestBatchId;for(let r=1;r<e.length;r++){const n=e[r].indexState.offset;Zr(n,t)<0&&(t=n),s<n.largestBatchId&&(s=n.largestBatchId)}return new Xr(t.readTime,t.documentKey,s)}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const jd={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},kd=41943040;class Id{static withCacheSize(e){return new Id(e,Id.DEFAULT_COLLECTION_PERCENTILE,Id.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Sd(e,t,s){const r=e.store(Pn),n=e.store(Un),i=[],a=IDBKeyRange.only(s.batchId);let o=0;const l=r.ee({range:a},(e,t,s)=>(o++,s.delete()));i.push(l.next(()=>{or(1===o,47070,{batchId:s.batchId})}));const c=[];for(const d of s.mutations){const e=Mn(t,d.key.path,s.batchId);i.push(n.delete(e)),c.push(d.key)}return rn.waitFor(i).next(()=>c)}function _d(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw ir(14731);t=e.noDocument}return JSON.stringify(t).length}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */Id.DEFAULT_COLLECTION_PERCENTILE=10,Id.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Id.DEFAULT=new Id(kd,Id.DEFAULT_COLLECTION_PERCENTILE,Id.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Id.DISABLED=new Id(-1,0,0);class Ed{constructor(e,t,s,r){this.userId=e,this.serializer=t,this.indexManager=s,this.referenceDelegate=r,this.Xn={}}static wt(e,t,s,r){or(""!==e.uid,64387);const n=e.isAuthenticated()?e.uid:"";return new Ed(n,t,s,r)}checkEmpty(e){let t=!0;const s=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Cd(e).ee({index:Rn,range:s},(e,s,r)=>{t=!1,r.done()}).next(()=>t)}addMutationBatch(e,t,s,r){const n=Ad(e),i=Cd(e);return i.add({}).next(a=>{or("number"==typeof a,49019);const o=new jl(a,t,s,r),l=function(e,t,s){const r=s.baseMutations.map(t=>dc(e.yt,t)),n=s.mutations.map(t=>dc(e.yt,t));return{userId:t,batchId:s.batchId,localWriteTimeMs:s.localWriteTime.toMillis(),baseMutations:r,mutations:n}}(this.serializer,this.userId,o),c=[];let d=new Bi((e,t)=>Nr(e.canonicalString(),t.canonicalString()));for(const e of r){const t=Mn(this.userId,e.key.path,a);d=d.add(e.key.path.popLast()),c.push(i.put(l)),c.push(n.put(t,Fn))}return d.forEach(t=>{c.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.Xn[a]=o.keys()}),rn.waitFor(c).next(()=>o)})}lookupMutationBatch(e,t){return Cd(e).get(t).next(e=>e?(or(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),Ac(this.serializer,e)):null)}er(e,t){return this.Xn[t]?rn.resolve(this.Xn[t]):this.lookupMutationBatch(e,t).next(e=>{if(e){const s=e.keys();return this.Xn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=IDBKeyRange.lowerBound([this.userId,s]);let n=null;return Cd(e).ee({index:Rn,range:r},(e,t,r)=>{t.userId===this.userId&&(or(t.batchId>=s,47524,{tr:s}),n=Ac(this.serializer,t)),r.done()}).next(()=>n)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let s=vn;return Cd(e).ee({index:Rn,range:t,reverse:!0},(e,t,r)=>{s=t.batchId,r.done()}).next(()=>s)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,vn],[this.userId,Number.POSITIVE_INFINITY]);return Cd(e).J(Rn,t).next(e=>e.map(e=>Ac(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){const s=Ln(this.userId,t.path),r=IDBKeyRange.lowerBound(s),n=[];return Ad(e).ee({range:r},(s,r,i)=>{const[a,o,l]=s,c=_n(o);if(a===this.userId&&t.path.isEqual(c))return Cd(e).get(l).next(e=>{if(!e)throw ir(61480,{nr:s,batchId:l});or(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),n.push(Ac(this.serializer,e))});i.done()}).next(()=>n)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new Bi(Nr);const r=[];return t.forEach(t=>{const n=Ln(this.userId,t.path),i=IDBKeyRange.lowerBound(n),a=Ad(e).ee({range:i},(e,r,n)=>{const[i,a,o]=e,l=_n(a);i===this.userId&&t.path.isEqual(l)?s=s.add(o):n.done()});r.push(a)}),rn.waitFor(r).next(()=>this.rr(e,s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1,n=Ln(this.userId,s),i=IDBKeyRange.lowerBound(n);let a=new Bi(Nr);return Ad(e).ee({range:i},(e,t,n)=>{const[i,o,l]=e,c=_n(o);i===this.userId&&s.isPrefixOf(c)?c.length===r&&(a=a.add(l)):n.done()}).next(()=>this.rr(e,a))}rr(e,t){const s=[],r=[];return t.forEach(t=>{r.push(Cd(e).get(t).next(e=>{if(null===e)throw ir(35274,{batchId:t});or(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),s.push(Ac(this.serializer,e))}))}),rn.waitFor(r).next(()=>s)}removeMutationBatch(e,t){return Sd(e.le,this.userId,t).next(s=>(e.addOnCommittedListener(()=>{this.ir(t.batchId)}),rn.forEach(s,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return rn.resolve();const s=IDBKeyRange.lowerBound(function(e){return[e]}(this.userId)),r=[];return Ad(e).ee({range:s},(e,t,s)=>{if(e[0]===this.userId){const t=_n(e[1]);r.push(t)}else s.done()}).next(()=>{or(0===r.length,56720,{sr:r.map(e=>e.canonicalString())})})})}containsKey(e,t){return Td(e,this.userId,t)}_r(e){return Pd(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:vn,lastStreamToken:""})}}function Td(e,t,s){const r=Ln(t,s.path),n=r[1],i=IDBKeyRange.lowerBound(r);let a=!1;return Ad(e).ee({range:i,X:!0},(e,s,r)=>{const[i,o,l]=e;i===t&&o===n&&(a=!0),r.done()}).next(()=>a)}function Cd(e){return Ri(e,Pn)}function Ad(e){return Ri(e,Un)}function Pd(e){return Ri(e,An)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Dd{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Dd(0)}static cr(){return new Dd(-1)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Rd{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.lr(e).next(t=>{const s=new Dd(t.highestTargetId);return t.highestTargetId=s.next(),this.hr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(e=>Kr.fromTimestamp(new qr(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,s){return this.lr(e).next(r=>(r.highestListenSequenceNumber=t,s&&(r.lastRemoteSnapshotVersion=s.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.hr(e,r)))}addTargetData(e,t){return this.Pr(e,t).next(()=>this.lr(e).next(s=>(s.targetCount+=1,this.Tr(t,s),this.hr(e,s))))}updateTargetData(e,t){return this.Pr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Od(e).delete(t.targetId)).next(()=>this.lr(e)).next(t=>(or(t.targetCount>0,8065),t.targetCount-=1,this.hr(e,t)))}removeTargets(e,t,s){let r=0;const n=[];return Od(e).ee((i,a)=>{const o=Pc(a);o.sequenceNumber<=t&&null===s.get(o.targetId)&&(r++,n.push(this.removeTargetData(e,o)))}).next(()=>rn.waitFor(n)).next(()=>r)}forEachTarget(e,t){return Od(e).ee((e,s)=>{const r=Pc(s);t(r)})}lr(e){return Ld(e).get(ti).next(e=>(or(null!==e,2888),e))}hr(e,t){return Ld(e).put(ti,t)}Pr(e,t){return Od(e).put(Dc(this.serializer,t))}Tr(e,t){let s=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,s=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,s=!0),s}getTargetCount(e){return this.lr(e).next(e=>e.targetCount)}getTargetData(e,t){const s=ho(t),r=IDBKeyRange.bound([s,Number.NEGATIVE_INFINITY],[s,Number.POSITIVE_INFINITY]);let n=null;return Od(e).ee({range:r,index:Jn},(e,s,r)=>{const i=Pc(s);mo(t,i.target)&&(n=i,r.done())}).next(()=>n)}addMatchingKeys(e,t,s){const r=[],n=Md(e);return t.forEach(t=>{const i=kn(t.path);r.push(n.put({targetId:s,path:i})),r.push(this.referenceDelegate.addReference(e,s,t))}),rn.waitFor(r)}removeMatchingKeys(e,t,s){const r=Md(e);return rn.forEach(t,t=>{const n=kn(t.path);return rn.waitFor([r.delete([s,n]),this.referenceDelegate.removeReference(e,s,t)])})}removeMatchingKeysForTargetId(e,t){const s=Md(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return s.delete(r)}getMatchingKeysForTargetId(e,t){const s=IDBKeyRange.bound([t],[t+1],!1,!0),r=Md(e);let n=$o();return r.ee({range:s,X:!0},(e,t,s)=>{const r=_n(e[1]),i=new Pr(r);n=n.add(i)}).next(()=>n)}containsKey(e,t){const s=kn(t.path),r=IDBKeyRange.bound([s],[Sr(s)],!1,!0);let n=0;return Md(e).ee({index:Zn,X:!0,range:r},([e,t],s,r)=>{0!==e&&(n++,r.done())}).next(()=>n>0)}At(e,t){return Od(e).get(t).next(e=>e?Pc(e):null)}}function Od(e){return Ri(e,Wn)}function Ld(e){return Ri(e,si)}function Md(e){return Ri(e,Yn)}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Fd="LruGarbageCollector";function Ud([e,t],[s,r]){const n=Nr(e,s);return 0===n?Nr(t,r):n}class Vd{constructor(e){this.Ir=e,this.buffer=new Bi(Ud),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Ud(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Bd{constructor(e,t,s){this.garbageCollector=e,this.asyncQueue=t,this.localStore=s,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){tr(Fd,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>g(this,null,function*(){this.Rr=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){un(e)?tr(Fd,"Ignoring IndexedDB error during garbage collection: ",e):yield sn(e)}yield this.Vr(3e5)}))}}class zd{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return rn.resolve(bn.ce);const s=new Vd(t);return this.mr.forEachTarget(e,e=>s.Ar(e.sequenceNumber)).next(()=>this.mr.pr(e,e=>s.Ar(e))).next(()=>s.maxValue)}removeTargets(e,t,s){return this.mr.removeTargets(e,t,s)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(tr("LruGarbageCollector","Garbage collection skipped; disabled"),rn.resolve(jd)):this.getCacheSize(e).next(s=>s<this.params.cacheSizeCollectionThreshold?(tr("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),jd):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let s,r,n,i,a,o,l;const c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(tr("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,i=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(s=r,a=Date.now(),this.removeTargets(e,s,t))).next(t=>(n=t,o=Date.now(),this.removeOrphanedDocuments(e,s))).next(e=>(l=Date.now(),er()<=ht.DEBUG&&tr("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-c}ms\n\tDetermined least recently used ${r} in `+(a-i)+`ms\n\tRemoved ${n} targets in `+(o-a)+`ms\n\tRemoved ${e} documents in `+(l-o)+`ms\nTotal Duration: ${l-c}ms`),rn.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:n,documentsRemoved:e})))}}function $d(e,t){return new zd(e,t)}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class qd{constructor(e,t){this.db=e,this.garbageCollector=$d(this,t)}gr(e){const t=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}pr(e,t){return this.Sr(e,(e,s)=>t(s))}addReference(e,t,s){return Kd(e,s)}removeReference(e,t,s){return Kd(e,s)}removeTargets(e,t,s){return this.db.getTargetCache().removeTargets(e,t,s)}markPotentiallyOrphaned(e,t){return Kd(e,t)}br(e,t){return function(e,t){let s=!1;return Pd(e).te(r=>Td(e,r,t).next(e=>(e&&(s=!0),rn.resolve(!e)))).next(()=>s)}(e,t)}removeOrphanedDocuments(e,t){const s=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let n=0;return this.Sr(e,(i,a)=>{if(a<=t){const t=this.br(e,i).next(t=>{if(!t)return n++,s.getEntry(e,i).next(()=>(s.removeEntry(i,Kr.min()),Md(e).delete([0,kn(i.path)])))});r.push(t)}}).next(()=>rn.waitFor(r)).next(()=>s.apply(e)).next(()=>n)}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,s)}updateLimboDocument(e,t){return Kd(e,t)}Sr(e,t){const s=Md(e);let r,n=bn.ce;return s.ee({index:Zn},([e,s],{path:i,sequenceNumber:a})=>{0===e?(n!==bn.ce&&t(new Pr(_n(r)),n),n=a,r=i):n=bn.ce}).next(()=>{n!==bn.ce&&t(new Pr(_n(r)),n)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Kd(e,t){return Md(e).put((s=t,r=e.currentSequenceNumber,{targetId:0,path:kn(s.path),sequenceNumber:r}));var s,r}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Gd{constructor(){this.changes=new Po(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Fa.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return void 0!==s?rn.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Hd{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,s){return Yd(e).put(s)}removeEntry(e,t,s){return Yd(e).delete(function(e,t){const s=e.path.toArray();return[s.slice(0,s.length-2),s[s.length-2],Ec(t),s[s.length-1]]}(t,s))}updateMetadata(e,t){return this.getMetadata(e).next(s=>(s.byteSize+=t,this.Dr(e,s)))}getEntry(e,t){let s=Fa.newInvalidDocument(t);return Yd(e).ee({index:zn,range:IDBKeyRange.only(Xd(t))},(e,r)=>{s=this.Cr(t,r)}).next(()=>s)}vr(e,t){let s={size:0,document:Fa.newInvalidDocument(t)};return Yd(e).ee({index:zn,range:IDBKeyRange.only(Xd(t))},(e,r)=>{s={document:this.Cr(t,r),size:_d(r)}}).next(()=>s)}getEntries(e,t){let s=Ro();return this.Fr(e,t,(e,t)=>{const r=this.Cr(e,t);s=s.insert(e,r)}).next(()=>s)}Mr(e,t){let s=Ro(),r=new Fi(Pr.comparator);return this.Fr(e,t,(e,t)=>{const n=this.Cr(e,t);s=s.insert(e,n),r=r.insert(e,_d(t))}).next(()=>({documents:s,Or:r}))}Fr(e,t,s){if(t.isEmpty())return rn.resolve();let r=new Bi(eu);t.forEach(e=>r=r.add(e));const n=IDBKeyRange.bound(Xd(r.first()),Xd(r.last())),i=r.getIterator();let a=i.getNext();return Yd(e).ee({index:zn,range:n},(e,t,r)=>{const n=Pr.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&eu(a,n)<0;)s(a,null),a=i.getNext();a&&a.isEqual(n)&&(s(a,t),a=i.hasNext()?i.getNext():null),a?r.j(Xd(a)):r.done()}).next(()=>{for(;a;)s(a,null),a=i.hasNext()?i.getNext():null})}getDocumentsMatchingQuery(e,t,s,r,n){const i=t.path,a=[i.popLast().toArray(),i.lastSegment(),Ec(s.readTime),s.documentKey.path.isEmpty()?"":s.documentKey.path.lastSegment()],o=[i.popLast().toArray(),i.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Yd(e).J(IDBKeyRange.bound(a,o,!0)).next(e=>{null==n||n.incrementDocumentReadCount(e.length);let s=Ro();for(const n of e){const e=this.Cr(Pr.fromSegments(n.prefixPath.concat(n.collectionGroup,n.documentId)),n);e.isFoundDocument()&&(To(t,e)||r.has(e.key))&&(s=s.insert(e.key,e))}return s})}getAllFromCollectionGroup(e,t,s,r){let n=Ro();const i=Zd(t,s),a=Zd(t,Xr.max());return Yd(e).ee({index:qn,range:IDBKeyRange.bound(i,a,!0)},(e,t,s)=>{const i=this.Cr(Pr.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);n=n.insert(i.key,i),n.size===r&&s.done()}).next(()=>n)}newChangeBuffer(e){return new Jd(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return Qd(e).get(Hn).next(e=>(or(!!e,20021),e))}Dr(e,t){return Qd(e).put(Hn,t)}Cr(e,t){if(t){const e=Sc(this.serializer,t);if(!e.isNoDocument()||!e.version.isEqual(Kr.min()))return e}return Fa.newInvalidDocument(e)}}function Wd(e){return new Hd(e)}class Jd extends Gd{constructor(e,t){super(),this.Nr=e,this.trackRemovals=t,this.Br=new Po(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){const t=[];let s=0,r=new Bi((e,t)=>Nr(e.canonicalString(),t.canonicalString()));return this.changes.forEach((n,i)=>{const a=this.Br.get(n);if(t.push(this.Nr.removeEntry(e,n,a.readTime)),i.isValidDocument()){const o=_c(this.Nr.serializer,i);r=r.add(n.path.popLast());const l=_d(o);s+=l-a.size,t.push(this.Nr.addEntry(e,n,o))}else if(s-=a.size,this.trackRemovals){const s=_c(this.Nr.serializer,i.convertToNoDocument(Kr.min()));t.push(this.Nr.addEntry(e,n,s))}}),r.forEach(s=>{t.push(this.Nr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.Nr.updateMetadata(e,s)),rn.waitFor(t)}getFromCache(e,t){return this.Nr.vr(e,t).next(e=>(this.Br.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.Nr.Mr(e,t).next(({documents:e,Or:t})=>(t.forEach((t,s)=>{this.Br.set(t,{size:s,readTime:e.get(t).readTime})}),e))}}function Qd(e){return Ri(e,Gn)}function Yd(e){return Ri(e,Vn)}function Xd(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Zd(e,t){const s=t.documentKey.path.toArray();return[e,Ec(t.readTime),s.slice(0,s.length-2),s.length>0?s[s.length-1]:""]}function eu(e,t){const s=e.path.toArray(),r=t.path.toArray();let n=0;for(let i=0;i<s.length-2&&i<r.length-2;++i)if(n=Nr(s[i],r[i]),n)return n;return n=Nr(s.length,r.length),n||(n=Nr(s[s.length-2],r[r.length-2]),n||Nr(s[s.length-1],r[r.length-1])
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */)}class tu{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class su{constructor(e,t,s,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=r}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(s=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==s&&ml(s.mutation,e,qi.empty(),qr.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,$o()).next(()=>t))}getLocalViewOfDocuments(e,t,s=$o()){const r=Fo();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,s).next(e=>{let t=Lo();return e.forEach((e,s)=>{t=t.insert(e,s.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const s=Fo();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,$o()))}populateOverlays(e,t,s){const r=[];return s.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,s)=>{t.set(e,s)})})}computeViews(e,t,s,r){let n=Ro();const i=Vo(),a=Vo();return t.forEach((e,t)=>{const a=s.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof xl)?n=n.insert(t.key,t):void 0!==a?(i.set(t.key,a.mutation.getFieldMask()),ml(a.mutation,t,a.mutation.getFieldMask(),qr.now())):i.set(t.key,qi.empty())}),this.recalculateAndSaveOverlays(e,n).next(e=>(e.forEach((e,t)=>i.set(e,t)),t.forEach((e,t)=>{var s;return a.set(e,new tu(t,null!=(s=i.get(e))?s:null))}),a))}recalculateAndSaveOverlays(e,t){const s=Vo();let r=new Fi((e,t)=>e-t),n=$o();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const n of e)n.keys().forEach(e=>{const i=t.get(e);if(null===i)return;let a=s.get(e)||qi.empty();a=n.applyToLocalView(i,a),s.set(e,a);const o=(r.get(n.batchId)||$o()).add(e);r=r.insert(n.batchId,o)})}).next(()=>{const i=[],a=r.getReverseIterator();for(;a.hasNext();){const r=a.getNext(),o=r.key,l=r.value,c=Uo();l.forEach(e=>{if(!n.has(e)){const r=ul(t.get(e),s.get(e));null!==r&&c.set(e,r),n=n.add(e)}}),i.push(this.documentOverlayCache.saveOverlays(e,o,c))}return rn.waitFor(i)}).next(()=>s)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,s,r){return n=t,Pr.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):wo(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,r):this.getDocumentsMatchingCollectionQuery(e,t,s,r);var n}getNextDocuments(e,t,s,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,r).next(n=>{const i=r-n.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,r-n.size):rn.resolve(Fo());let a=-1,o=n;return i.next(t=>rn.forEach(t,(t,s)=>(a<s.largestBatchId&&(a=s.largestBatchId),n.get(t)?rn.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,n)).next(()=>this.computeViews(e,o,t,$o())).next(e=>({batchId:a,changes:Mo(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Pr(t)).next(e=>{let t=Lo();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,s,r){const n=t.collectionGroup;let i=Lo();return this.indexManager.getCollectionParents(e,n).next(a=>rn.forEach(a,a=>{const o=(l=t,c=a.child(n),new yo(c,null,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt));var l,c;return this.getDocumentsMatchingCollectionQuery(e,o,s,r).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,s,r){let n;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next(i=>(n=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,n,r))).next(e=>{n.forEach((t,s)=>{const r=s.getKey();null===e.get(r)&&(e=e.insert(r,Fa.newInvalidDocument(r)))});let s=Lo();return e.forEach((e,r)=>{const i=n.get(e);void 0!==i&&ml(i.mutation,r,qi.empty(),qr.now()),To(t,r)&&(s=s.insert(e,r))}),s})}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class ru{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return rn.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,{id:(s=t).id,version:s.version,createTime:Zl(s.createTime)}),rn.resolve();var s}getNamedQuery(e,t){return rn.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,{name:(s=t).name,query:Rc(s.bundledQuery),readTime:Zl(s.readTime)}),rn.resolve();var s}}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class nu{constructor(){this.overlays=new Fi(Pr.comparator),this.qr=new Map}getOverlay(e,t){return rn.resolve(this.overlays.get(t))}getOverlays(e,t){const s=Fo();return rn.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&s.set(t,e)})).next(()=>s)}saveOverlays(e,t,s){return s.forEach((s,r)=>{this.St(e,t,r)}),rn.resolve()}removeOverlaysForBatchId(e,t,s){const r=this.qr.get(s);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(s)),rn.resolve()}getOverlaysForCollection(e,t,s){const r=Fo(),n=t.length+1,i=new Pr(t.child("")),a=this.overlays.getIteratorFrom(i);for(;a.hasNext();){const e=a.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===n&&e.largestBatchId>s&&r.set(e.getKey(),e)}return rn.resolve(r)}getOverlaysForCollectionGroup(e,t,s,r){let n=new Fi((e,t)=>e-t);const i=this.overlays.getIterator();for(;i.hasNext();){const e=i.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>s){let t=n.get(e.largestBatchId);null===t&&(t=Fo(),n=n.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const a=Fo(),o=n.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return rn.resolve(a)}St(e,t,s){const r=this.overlays.get(s.key);if(null!==r){const e=this.qr.get(r.largestBatchId).delete(s.key);this.qr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(s.key,new Il(t,s));let n=this.qr.get(t);void 0===n&&(n=$o(),this.qr.set(t,n)),this.qr.set(t,n.add(s.key))}}
/**
     * @license
     * Copyright 2024 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class iu{constructor(){this.sessionToken=Gi.EMPTY_BYTE_STRING}getSessionToken(e){return rn.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,rn.resolve()}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class au{constructor(){this.Qr=new Bi(ou.$r),this.Ur=new Bi(ou.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const s=new ou(e,t);this.Qr=this.Qr.add(s),this.Ur=this.Ur.add(s)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new ou(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){const t=new Pr(new Tr([])),s=new ou(t,e),r=new ou(t,e+1),n=[];return this.Ur.forEachInRange([s,r],e=>{this.Gr(e),n.push(e.key)}),n}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new Pr(new Tr([])),s=new ou(t,e),r=new ou(t,e+1);let n=$o();return this.Ur.forEachInRange([s,r],e=>{n=n.add(e.key)}),n}containsKey(e){const t=new ou(e,0),s=this.Qr.firstAfterOrEqual(t);return null!==s&&e.isEqual(s.key)}}class ou{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return Pr.comparator(e.key,t.key)||Nr(e.Yr,t.Yr)}static Kr(e,t){return Nr(e.Yr,t.Yr)||Pr.comparator(e.key,t.key)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class lu{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new Bi(ou.$r)}checkEmpty(e){return rn.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,s,r){const n=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new jl(n,t,s,r);this.mutationQueue.push(i);for(const a of r)this.Zr=this.Zr.add(new ou(a.key,n)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return rn.resolve(i)}lookupMutationBatch(e,t){return rn.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=this.ei(s),n=r<0?0:r;return rn.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return rn.resolve(0===this.mutationQueue.length?vn:this.tr-1)}getAllMutationBatches(e){return rn.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new ou(t,0),r=new ou(t,Number.POSITIVE_INFINITY),n=[];return this.Zr.forEachInRange([s,r],e=>{const t=this.Xr(e.Yr);n.push(t)}),rn.resolve(n)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new Bi(Nr);return t.forEach(e=>{const t=new ou(e,0),r=new ou(e,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([t,r],e=>{s=s.add(e.Yr)})}),rn.resolve(this.ti(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1;let n=s;Pr.isDocumentKey(n)||(n=n.child(""));const i=new ou(new Pr(n),0);let a=new Bi(Nr);return this.Zr.forEachWhile(e=>{const t=e.key.path;return!!s.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.Yr)),!0)},i),rn.resolve(this.ti(a))}ti(e){const t=[];return e.forEach(e=>{const s=this.Xr(e);null!==s&&t.push(s)}),t}removeMutationBatch(e,t){or(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let s=this.Zr;return rn.forEach(t.mutations,r=>{const n=new ou(r.key,t.batchId);return s=s.delete(n),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Zr=s})}ir(e){}containsKey(e,t){const s=new ou(t,0),r=this.Zr.firstAfterOrEqual(s);return rn.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,rn.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class cu{constructor(e){this.ri=e,this.docs=new Fi(Pr.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,r=this.docs.get(s),n=r?r.size:0,i=this.ri(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:i}),this.size+=i-n,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return rn.resolve(s?s.document.mutableCopy():Fa.newInvalidDocument(t))}getEntries(e,t){let s=Ro();return t.forEach(e=>{const t=this.docs.get(e);s=s.insert(e,t?t.document.mutableCopy():Fa.newInvalidDocument(e))}),rn.resolve(s)}getDocumentsMatchingQuery(e,t,s,r){let n=Ro();const i=t.path,a=new Pr(i.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){const{key:e,value:{document:a}}=o.getNext();if(!i.isPrefixOf(e.path))break;e.path.length>i.length+1||Zr(Yr(a),s)<=0||(r.has(a.key)||To(t,a))&&(n=n.insert(a.key,a.mutableCopy()))}return rn.resolve(n)}getAllFromCollectionGroup(e,t,s,r){ir(9500)}ii(e,t){return rn.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new du(this)}getSize(e){return rn.resolve(this.size)}}class du extends Gd{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((s,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(s)}),rn.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class uu{constructor(e){this.persistence=e,this.si=new Po(e=>ho(e),mo),this.lastRemoteSnapshotVersion=Kr.min(),this.highestTargetId=0,this.oi=0,this._i=new au,this.targetCount=0,this.ai=Dd.ur()}forEachTarget(e,t){return this.si.forEach((e,s)=>t(s)),rn.resolve()}getLastRemoteSnapshotVersion(e){return rn.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return rn.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),rn.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.oi&&(this.oi=t),rn.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Dd(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,rn.resolve()}updateTargetData(e,t){return this.Pr(t),rn.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,rn.resolve()}removeTargets(e,t,s){let r=0;const n=[];return this.si.forEach((i,a)=>{a.sequenceNumber<=t&&null===s.get(a.targetId)&&(this.si.delete(i),n.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),rn.waitFor(n).next(()=>r)}getTargetCount(e){return rn.resolve(this.targetCount)}getTargetData(e,t){const s=this.si.get(t)||null;return rn.resolve(s)}addMatchingKeys(e,t,s){return this._i.Wr(t,s),rn.resolve()}removeMatchingKeys(e,t,s){this._i.zr(t,s);const r=this.persistence.referenceDelegate,n=[];return r&&t.forEach(t=>{n.push(r.markPotentiallyOrphaned(e,t))}),rn.waitFor(n)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),rn.resolve()}getMatchingKeysForTargetId(e,t){const s=this._i.Hr(t);return rn.resolve(s)}containsKey(e,t){return rn.resolve(this._i.containsKey(t))}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class hu{constructor(e,t){this.ui={},this.overlays={},this.ci=new bn(0),this.li=!1,this.li=!0,this.hi=new iu,this.referenceDelegate=e(this),this.Pi=new uu(this),this.indexManager=new md,this.remoteDocumentCache=new cu(e=>this.referenceDelegate.Ti(e)),this.serializer=new Ic(t),this.Ii=new ru(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new nu,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this.ui[e.toKey()];return s||(s=new lu(t,this.referenceDelegate),this.ui[e.toKey()]=s),s}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,s){tr("MemoryPersistence","Starting transaction:",e);const r=new mu(this.ci.next());return this.referenceDelegate.Ei(),s(r).next(e=>this.referenceDelegate.di(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ai(e,t){return rn.or(Object.values(this.ui).map(s=>()=>s.containsKey(e,t)))}}class mu extends tn{constructor(e){super(),this.currentSequenceNumber=e}}class pu{constructor(e){this.persistence=e,this.Ri=new au,this.Vi=null}static mi(e){return new pu(e)}get fi(){if(this.Vi)return this.Vi;throw ir(60996)}addReference(e,t,s){return this.Ri.addReference(s,t),this.fi.delete(s.toString()),rn.resolve()}removeReference(e,t,s){return this.Ri.removeReference(s,t),this.fi.add(s.toString()),rn.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),rn.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>s.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return rn.forEach(this.fi,s=>{const r=Pr.fromPath(s);return this.gi(e,r).next(e=>{e||t.removeEntry(r,Kr.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return rn.or([()=>rn.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class gu{constructor(e,t){this.persistence=e,this.pi=new Po(e=>kn(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=$d(this,t)}static mi(e,t){return new gu(e,t)}Ei(){}di(e){return rn.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}pr(e,t){return rn.forEach(this.pi,(s,r)=>this.br(e,s,r).next(e=>e?rn.resolve():t(r)))}removeTargets(e,t,s){return this.persistence.getTargetCache().removeTargets(e,t,s)}removeOrphanedDocuments(e,t){let s=0;const r=this.persistence.getRemoteDocumentCache(),n=r.newChangeBuffer();return r.ii(e,r=>this.br(e,r,t).next(e=>{e||(s++,n.removeEntry(r,Kr.min()))})).next(()=>n.apply(e)).next(()=>s)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),rn.resolve()}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),rn.resolve()}removeReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),rn.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),rn.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=wa(e.data.value)),t}br(e,t,s){return rn.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.pi.get(t);return rn.resolve(void 0!==e&&e>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class fu{constructor(e){this.serializer=e}k(e,t,s,r){const n=new an("createOrUpgrade",t);s<1&&r>=1&&(e.createObjectStore(Tn),function(e){e.createObjectStore(An,{keyPath:"userId"}),e.createObjectStore(Pn,{keyPath:Dn,autoIncrement:!0}).createIndex(Rn,On,{unique:!0}),e.createObjectStore(Un)}(e),xu(e),function(e){e.createObjectStore(En)}(e));let i=rn.resolve();return s<3&&r>=3&&(0!==s&&(function(e){e.deleteObjectStore(Yn),e.deleteObjectStore(Wn),e.deleteObjectStore(si)}(e),xu(e)),i=i.next(()=>function(e){const t=e.store(si),s={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Kr.min().toTimestamp(),targetCount:0};return t.put(ti,s)}(n))),s<4&&r>=4&&(0!==s&&(i=i.next(()=>function(e,t){return t.store(Pn).J().next(s=>{e.deleteObjectStore(Pn),e.createObjectStore(Pn,{keyPath:Dn,autoIncrement:!0}).createIndex(Rn,On,{unique:!0});const r=t.store(Pn),n=s.map(e=>r.put(e));return rn.waitFor(n)})}(e,n))),i=i.next(()=>{!function(e){e.createObjectStore(ii,{keyPath:"clientId"})}(e)})),s<5&&r>=5&&(i=i.next(()=>this.yi(n))),s<6&&r>=6&&(i=i.next(()=>(function(e){e.createObjectStore(Gn)}(e),this.wi(n)))),s<7&&r>=7&&(i=i.next(()=>this.Si(n))),s<8&&r>=8&&(i=i.next(()=>this.bi(e,n))),s<9&&r>=9&&(i=i.next(()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)})),s<10&&r>=10&&(i=i.next(()=>this.Di(n))),s<11&&r>=11&&(i=i.next(()=>{!function(e){e.createObjectStore(ai,{keyPath:"bundleId"})}(e),function(e){e.createObjectStore(oi,{keyPath:"name"})}(e)})),s<12&&r>=12&&(i=i.next(()=>{!function(e){const t=e.createObjectStore(yi,{keyPath:bi});t.createIndex(vi,wi,{unique:!1}),t.createIndex(Ni,ji,{unique:!1})}(e)})),s<13&&r>=13&&(i=i.next(()=>function(e){const t=e.createObjectStore(Vn,{keyPath:Bn});t.createIndex(zn,$n),t.createIndex(qn,Kn)}(e)).next(()=>this.Ci(e,n)).next(()=>e.deleteObjectStore(En))),s<14&&r>=14&&(i=i.next(()=>this.Fi(e,n))),s<15&&r>=15&&(i=i.next(()=>function(e){e.createObjectStore(li,{keyPath:"indexId",autoIncrement:!0}).createIndex(ci,"collectionGroup",{unique:!1}),e.createObjectStore(di,{keyPath:ui}).createIndex(hi,mi,{unique:!1}),e.createObjectStore(pi,{keyPath:gi}).createIndex(fi,xi,{unique:!1})}(e))),s<16&&r>=16&&(i=i.next(()=>{t.objectStore(di).clear()}).next(()=>{t.objectStore(pi).clear()})),s<17&&r>=17&&(i=i.next(()=>{!function(e){e.createObjectStore(ki,{keyPath:"name"})}(e)})),s<18&&r>=18&&Je()&&(i=i.next(()=>{t.objectStore(di).clear()}).next(()=>{t.objectStore(pi).clear()})),i}wi(e){let t=0;return e.store(En).ee((e,s)=>{t+=_d(s)}).next(()=>{const s={byteSize:t};return e.store(Gn).put(Hn,s)})}yi(e){const t=e.store(An),s=e.store(Pn);return t.J().next(t=>rn.forEach(t,t=>{const r=IDBKeyRange.bound([t.userId,vn],[t.userId,t.lastAcknowledgedBatchId]);return s.J(Rn,r).next(s=>rn.forEach(s,s=>{or(s.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:s.batchId});const r=Ac(this.serializer,s);return Sd(e,t.userId,r).next(()=>{})}))}))}Si(e){const t=e.store(Yn),s=e.store(En);return e.store(si).get(ti).next(e=>{const r=[];return s.ee((s,n)=>{const i=new Tr(s),a=[0,kn(i)];r.push(t.get(a).next(s=>{return s?rn.resolve():(r=i,t.put({targetId:0,path:kn(r),sequenceNumber:e.highestListenSequenceNumber}));var r}))}).next(()=>rn.waitFor(r))})}bi(e,t){e.createObjectStore(ri,{keyPath:ni});const s=t.store(ri),r=new pd,n=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return s.put({collectionId:t,parent:kn(r)})}};return t.store(En).ee({X:!0},(e,t)=>{const s=new Tr(e);return n(s.popLast())}).next(()=>t.store(Un).ee({X:!0},([e,t,s],r)=>{const i=_n(t);return n(i.popLast())}))}Di(e){const t=e.store(Wn);return t.ee((e,s)=>{const r=Pc(s),n=Dc(this.serializer,r);return t.put(n)})}Ci(e,t){const s=t.store(En),r=[];return s.ee((e,s)=>{const n=t.store(Vn),i=(o=s,o.document?new Pr(Tr.fromString(o.document.name).popFirst(5)):o.noDocument?Pr.fromSegments(o.noDocument.path):o.unknownDocument?Pr.fromSegments(o.unknownDocument.path):ir(36783)).path.toArray(),a={prefixPath:i.slice(0,i.length-2),collectionGroup:i[i.length-2],documentId:i[i.length-1],readTime:s.readTime||[0,0],unknownDocument:s.unknownDocument,noDocument:s.noDocument,document:s.document,hasCommittedMutations:!!s.hasCommittedMutations};var o;r.push(n.put(a))}).next(()=>rn.waitFor(r))}Fi(e,t){const s=t.store(Pn),r=Wd(this.serializer),n=new hu(pu.mi,this.serializer.yt);return s.J().next(e=>{const s=new Map;return e.forEach(e=>{var t;let r=null!=(t=s.get(e.userId))?t:$o();Ac(this.serializer,e).keys().forEach(e=>r=r.add(e)),s.set(e.userId,r)}),rn.forEach(s,(e,s)=>{const i=new Ys(s),a=Bc.wt(this.serializer,i),o=n.getIndexManager(i),l=Ed.wt(i,this.serializer,o,n.referenceDelegate);return new su(r,l,a,o).recalculateAndSaveOverlaysForDocumentKeys(new Di(t,bn.ce),e).next()})})}}function xu(e){e.createObjectStore(Yn,{keyPath:Xn}).createIndex(Zn,ei,{unique:!0}),e.createObjectStore(Wn,{keyPath:"targetId"}).createIndex(Jn,Qn,{unique:!0}),e.createObjectStore(si)}const yu="IndexedDbPersistence",bu=18e5,vu=5e3,wu="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Nu{constructor(e,t,s,r,n,i,a,o,l,c,d=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=s,this.Mi=n,this.window=i,this.document=a,this.xi=l,this.Oi=c,this.Ni=d,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=e=>Promise.resolve(),!Nu.v())throw new dr(cr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new qd(this,r),this.$i=t+"main",this.serializer=new Ic(o),this.Ui=new on(this.$i,this.Ni,new fu(this.serializer)),this.hi=new $c,this.Pi=new Rd(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Wd(this.serializer),this.Ii=new Fc,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,!1===c&&sr(yu,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new dr(cr.FAILED_PRECONDITION,wu);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new bn(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=t=>g(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(t=>g(this,null,function*(){null===t.newVersion&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(()=>g(this,null,function*(){this.started&&(yield this.Wi())})))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>ku(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(e=>{e||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(t=>this.isPrimary&&!t?this.Zi(e).next(()=>!1):!!t&&this.Xi(e).next(()=>!0))).catch(e=>{if(un(e))return tr(yu,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return tr(yu,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return ju(e).get(Cn).next(e=>rn.resolve(this.es(e)))}ts(e){return ku(e).delete(this.clientId)}ns(){return g(this,null,function*(){if(this.isPrimary&&!this.rs(this.qi,bu)){this.qi=Date.now();const e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{const t=Ri(e,ii);return t.J().next(e=>{const s=this.ss(e,bu),r=e.filter(e=>-1===s.indexOf(e));return rn.forEach(r,e=>t.delete(e.clientId)).next(()=>r)})}).catch(()=>[]);if(this.Ki)for(const t of e)this.Ki.removeItem(this._s(t.clientId))}})}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?rn.resolve(!0):ju(e).get(Cn).next(t=>{if(null!==t&&this.rs(t.leaseTimestampMs,vu)&&!this.us(t.ownerId)){if(this.es(t)&&this.networkEnabled)return!0;if(!this.es(t)){if(!t.allowTabSynchronization)throw new dr(cr.FAILED_PRECONDITION,wu);return!1}}return!(!this.networkEnabled||!this.inForeground)||ku(e).J().next(e=>void 0===this.ss(e,vu).find(e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,s=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||s&&r)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&tr(yu,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}shutdown(){return g(this,null,function*(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),yield this.Ui.runTransaction("shutdown","readwrite",[Tn,ii],e=>{const t=new Di(e,bn.ce);return this.Zi(t).next(()=>this.ts(t))}),this.Ui.close(),this.Ps()})}ss(e,t){return e.filter(e=>this.rs(e.updateTimeMs,t)&&!this.us(e.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>ku(e).J().next(e=>this.ss(e,bu).map(e=>e.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,t){return Ed.wt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new xd(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return Bc.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,t,s){tr(yu,"Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",n=18===(i=this.Ni)?Pi:17===i?Ai:16===i?Ci:15===i?Ti:14===i?Ei:13===i?_i:12===i?Si:11===i?Ii:void ir(60245);var i;let a;return this.Ui.runTransaction(e,r,n,r=>(a=new Di(r,this.ci?this.ci.next():bn.ce),"readwrite-primary"===t?this.Hi(a).next(e=>!!e||this.Yi(a)).next(t=>{if(!t)throw sr(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new dr(cr.FAILED_PRECONDITION,en);return s(a)}).next(e=>this.Xi(a).next(()=>e)):this.Is(a).next(()=>s(a)))).then(e=>(a.raiseOnCommittedEvent(),e))}Is(e){return ju(e).get(Cn).next(e=>{if(null!==e&&this.rs(e.leaseTimestampMs,vu)&&!this.us(e.ownerId)&&!this.es(e)&&!(this.Oi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new dr(cr.FAILED_PRECONDITION,wu)})}Xi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ju(e).put(Cn,t)}static v(){return on.v()}Zi(e){const t=ju(e);return t.get(Cn).next(e=>this.es(e)?(tr(yu,"Releasing primary lease."),t.delete(Cn)):rn.resolve())}rs(e,t){const s=Date.now();return!(e<s-t||e>s&&(sr(`Detected an update time that is in the future: ${e} > ${s}`),1))}Gi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground="visible"===this.document.visibilityState)}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;"function"==typeof(null==(e=this.window)?void 0:e.addEventListener)&&(this.Bi=()=>{this.cs();const e=/(?:Version|Mobile)\/1[456]/;We()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var t;try{const s=null!==(null==(t=this.Ki)?void 0:t.getItem(this._s(e)));return tr(yu,`Client '${e}' ${s?"is":"is not"} zombied in LocalStorage`),s}catch(s){return sr(yu,"Failed to get zombied client id.",s),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){sr("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch(e){}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function ju(e){return Ri(e,Tn)}function ku(e){return Ri(e,ii)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Iu{constructor(e,t,s,r){this.targetId=e,this.fromCache=t,this.Es=s,this.ds=r}static As(e,t){let s=$o(),r=$o();for(const n of t.docChanges)switch(n.type){case 0:s=s.add(n.doc.key);break;case 1:r=r.add(n.doc.key)}return new Iu(e,t.fromCache,s,r)}}
/**
     * @license
     * Copyright 2023 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Su{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class _u{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=We()?8:ln(Ge())>0?6:4}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,s,r){const n={result:null};return this.ys(e,t).next(e=>{n.result=e}).next(()=>{if(!n.result)return this.ws(e,t,r,s).next(e=>{n.result=e})}).next(()=>{if(n.result)return;const s=new Su;return this.Ss(e,t,s).next(r=>{if(n.result=r,this.Vs)return this.bs(e,t,s,r.size)})}).next(()=>n.result)}bs(e,t,s,r){return s.documentReadCount<this.fs?(er()<=ht.DEBUG&&tr("QueryEngine","SDK will not create cache indexes for query:",Eo(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),rn.resolve()):(er()<=ht.DEBUG&&tr("QueryEngine","Query:",Eo(t),"scans",s.documentReadCount,"local documents and returns",r,"documents as results."),s.documentReadCount>this.gs*r?(er()<=ht.DEBUG&&tr("QueryEngine","The SDK decides to create cache indexes for query:",Eo(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,jo(t))):rn.resolve())}ys(e,t){if(vo(t))return rn.resolve(null);let s=jo(t);return this.indexManager.getIndexType(e,s).next(r=>0===r?null:(null!==t.limit&&1===r&&(t=Io(t,null,"F"),s=jo(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next(r=>{const n=$o(...r);return this.ps.getDocuments(e,n).next(r=>this.indexManager.getMinOffset(e,s).next(s=>{const i=this.Ds(t,r);return this.Cs(t,i,n,s.readTime)?this.ys(e,Io(t,null,"F")):this.vs(e,i,t,s)}))})))}ws(e,t,s,r){return vo(t)||r.isEqual(Kr.min())?rn.resolve(null):this.ps.getDocuments(e,s).next(n=>{const i=this.Ds(t,n);return this.Cs(t,i,s,r)?rn.resolve(null):(er()<=ht.DEBUG&&tr("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Eo(t)),this.vs(e,i,t,function(e,t){const s=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,n=Kr.fromTimestamp(1e9===r?new qr(s+1,0):new qr(s,r));return new Xr(n,Pr.empty(),t)}(r,-1)).next(e=>e))})}Ds(e,t){let s=new Bi(Co(e));return t.forEach((t,r)=>{To(e,r)&&(s=s.add(r))}),s}Cs(e,t,s,r){if(null===e.limit)return!1;if(s.size!==t.size)return!0;const n="F"===e.limitType?t.last():t.first();return!!n&&(n.hasPendingWrites||n.version.compareTo(r)>0)}Ss(e,t,s){return er()<=ht.DEBUG&&tr("QueryEngine","Using full collection scan to execute query:",Eo(t)),this.ps.getDocumentsMatchingQuery(e,t,Xr.min(),s)}vs(e,t,s,r){return this.ps.getDocumentsMatchingQuery(e,s,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Eu="LocalStore";class Tu{constructor(e,t,s,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new Fi(Nr),this.xs=new Po(e=>ho(e),mo),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(s)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new su(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function Cu(e,t,s,r){return new Tu(e,t,s,r)}function Au(e,t){return g(this,null,function*(){const s=lr(e);return yield s.persistence.runTransaction("Handle user change","readonly",e=>{let r;return s.mutationQueue.getAllMutationBatches(e).next(n=>(r=n,s.Bs(t),s.mutationQueue.getAllMutationBatches(e))).next(t=>{const n=[],i=[];let a=$o();for(const e of r){n.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}for(const e of t){i.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}return s.localDocuments.getDocuments(e,a).next(e=>({Ls:e,removedBatchIds:n,addedBatchIds:i}))})})})}function Pu(e){const t=lr(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Pi.getLastRemoteSnapshotVersion(e))}function Du(e,t){const s=lr(e),r=t.snapshotVersion;let n=s.Ms;return s.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const i=s.Ns.newChangeBuffer({trackRemovals:!0});n=s.Ms;const a=[];t.targetChanges.forEach((i,o)=>{const l=n.get(o);if(!l)return;a.push(s.Pi.removeMatchingKeys(e,i.removedDocuments,o).next(()=>s.Pi.addMatchingKeys(e,i.addedDocuments,o)));let c=l.withSequenceNumber(e.currentSequenceNumber);var d,u,h;null!==t.targetMismatches.get(o)?c=c.withResumeToken(Gi.EMPTY_BYTE_STRING,Kr.min()).withLastLimboFreeSnapshotVersion(Kr.min()):i.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(i.resumeToken,r)),n=n.insert(o,c),u=c,h=i,(0===(d=l).resumeToken.approximateByteSize()||u.snapshotVersion.toMicroseconds()-d.snapshotVersion.toMicroseconds()>=3e8||h.addedDocuments.size+h.modifiedDocuments.size+h.removedDocuments.size>0)&&a.push(s.Pi.updateTargetData(e,c))});let o=Ro(),l=$o();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&a.push(s.persistence.referenceDelegate.updateLimboDocument(e,r))}),a.push(function(e,t,s){let r=$o(),n=$o();return s.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=Ro();return s.forEach((s,i)=>{const a=e.get(s);i.isFoundDocument()!==a.isFoundDocument()&&(n=n.add(s)),i.isNoDocument()&&i.version.isEqual(Kr.min())?(t.removeEntry(s,i.readTime),r=r.insert(s,i)):!a.isValidDocument()||i.version.compareTo(a.version)>0||0===i.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(i),r=r.insert(s,i)):tr(Eu,"Ignoring outdated watch update for ",s,". Current version:",a.version," Watch version:",i.version)}),{ks:r,qs:n}})}(e,i,t.documentUpdates).next(e=>{o=e.ks,l=e.qs})),!r.isEqual(Kr.min())){const t=s.Pi.getLastRemoteSnapshotVersion(e).next(t=>s.Pi.setTargetsMetadata(e,e.currentSequenceNumber,r));a.push(t)}return rn.waitFor(a).next(()=>i.apply(e)).next(()=>s.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(s.Ms=n,e))}function Ru(e,t){const s=lr(e);return s.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=vn),s.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function Ou(e,t,s){return g(this,null,function*(){const r=lr(e),n=r.Ms.get(t),i=s?"readwrite":"readwrite-primary";try{s||(yield r.persistence.runTransaction("Release target",i,e=>r.persistence.referenceDelegate.removeTarget(e,n)))}catch(a){if(!un(a))throw a;tr(Eu,`Failed to update sequence numbers for target ${t}: ${a}`)}r.Ms=r.Ms.remove(t),r.xs.delete(n.target)})}function Lu(e,t,s){const r=lr(e);let n=Kr.min(),i=$o();return r.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,s){const r=lr(e),n=r.xs.get(s);return void 0!==n?rn.resolve(r.Ms.get(n)):r.Pi.getTargetData(t,s)}(r,e,jo(t)).next(t=>{if(t)return n=t.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(e,t.targetId).next(e=>{i=e})}).next(()=>r.Fs.getDocumentsMatchingQuery(e,t,s?n:Kr.min(),s?i:$o())).next(e=>(function(e,t,s){let r=e.Os.get(t)||Kr.min();s.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.Os.set(t,r)}(r,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,Qs:i})))}class Mu{constructor(){this.activeTargetIds=qo}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Fu{constructor(){this.Mo=new Mu,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,s){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Mu,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Uu{Oo(e){}shutdown(){}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Vu="ConnectivityMonitor";class Bu{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){tr(Vu,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){tr(Vu,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}
/**
     * @license
     * Copyright 2023 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */let zu=null;function $u(){return null===zu?zu=268435456+Math.round(2147483648*Math.random()):zu++,"0x"+zu.toString(16)
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */}const qu="RestConnection",Ku={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Gu{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${s}/databases/${r}`,this.Wo=this.databaseId.database===ia?`project_id=${s}`:`project_id=${s}&database_id=${r}`}Go(e,t,s,r,n){const i=$u(),a=this.zo(e,t.toUriEncodedString());tr(qu,`Sending RPC '${e}' ${i}:`,a,s);const o={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(o,r,n);const{host:l}=new URL(a),c=Ve(l);return this.Jo(e,a,o,s,c).then(t=>(tr(qu,`Received RPC '${e}' ${i}: `,t),t),t=>{throw rr(qu,`RPC '${e}' ${i} failed with error: `,t,"url: ",a,"request:",s),t})}Ho(e,t,s,r,n,i){return this.Go(e,t,s,r,n)}jo(e,t,s){e["X-Goog-Api-Client"]="gl-js/ fire/"+Xs,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,s)=>e[s]=t),s&&s.headers.forEach((t,s)=>e[s]=t)}zo(e,t){const s=Ku[e];return`${this.Uo}/v1/${t}:${s}`}terminate(){}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Hu{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Wu="WebChannelConnection";class Ju extends Gu{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,s,r,n){const i=$u();return new Promise((n,a)=>{const o=new Vs;o.setWithCredentials(!0),o.listenOnce(zs.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case $s.NO_ERROR:const t=o.getResponseJson();tr(Wu,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),n(t);break;case $s.TIMEOUT:tr(Wu,`RPC '${e}' ${i} timed out`),a(new dr(cr.DEADLINE_EXCEEDED,"Request time out"));break;case $s.HTTP_ERROR:const s=o.getStatus();if(tr(Wu,`RPC '${e}' ${i} failed with status:`,s,"response text:",o.getResponseText()),s>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(cr).indexOf(t)>=0?t:cr.UNKNOWN}(t.status);a(new dr(e,t.message))}else a(new dr(cr.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new dr(cr.UNAVAILABLE,"Connection failed."));break;default:ir(9055,{l_:e,streamId:i,h_:o.getLastErrorCode(),P_:o.getLastError()})}}finally{tr(Wu,`RPC '${e}' ${i} completed.`)}});const l=JSON.stringify(r);tr(Wu,`RPC '${e}' ${i} sending request:`,r),o.send(t,"POST",l,s,15)})}T_(e,t,s){const r=$u(),n=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=Hs(),a=Gs(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.jo(o.initMessageHeaders,t,s),o.encodeInitMessageHeaders=!0;const c=n.join("");tr(Wu,`Creating RPC '${e}' stream ${r}: ${c}`,o);const d=i.createWebChannel(c,o);this.I_(d);let u=!1,h=!1;const m=new Hu({Yo:t=>{h?tr(Wu,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(u||(tr(Wu,`Opening RPC '${e}' stream ${r} transport.`),d.open(),u=!0),tr(Wu,`RPC '${e}' stream ${r} sending:`,t),d.send(t))},Zo:()=>d.close()}),p=(e,t,s)=>{e.listen(t,e=>{try{s(e)}catch(t){setTimeout(()=>{throw t},0)}})};return p(d,Bs.EventType.OPEN,()=>{h||(tr(Wu,`RPC '${e}' stream ${r} transport opened.`),m.o_())}),p(d,Bs.EventType.CLOSE,()=>{h||(h=!0,tr(Wu,`RPC '${e}' stream ${r} transport closed`),m.a_(),this.E_(d))}),p(d,Bs.EventType.ERROR,t=>{h||(h=!0,rr(Wu,`RPC '${e}' stream ${r} transport errored. Name:`,t.name,"Message:",t.message),m.a_(new dr(cr.UNAVAILABLE,"The operation could not be completed")))}),p(d,Bs.EventType.MESSAGE,t=>{var s;if(!h){const n=t.data[0];or(!!n,16349);const i=n,a=(null==i?void 0:i.error)||(null==(s=i[0])?void 0:s.error);if(a){tr(Wu,`RPC '${e}' stream ${r} received error:`,a);const t=a.status;let s=function(e){const t=_l[e];if(void 0!==t)return Cl(t)}(t),n=a.message;void 0===s&&(s=cr.INTERNAL,n="Unknown error status: "+t+" with message "+a.message),h=!0,m.a_(new dr(s,n)),d.close()}else tr(Wu,`RPC '${e}' stream ${r} received:`,n),m.u_(n)}}),p(a,Ks.STAT_EVENT,t=>{t.stat===qs.PROXY?tr(Wu,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===qs.NOPROXY&&tr(Wu,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{m.__()},0),m}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Qu(){return"undefined"!=typeof document?document:null}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Yu(e){return new Wl(e,!0)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Xu{constructor(e,t,s=1e3,r=1.5,n=6e4){this.Mi=e,this.timerId=t,this.d_=s,this.A_=r,this.R_=n,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),s=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-s);r>0&&tr("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Zu="PersistentStream";class eh{constructor(e,t,s,r,n,i,a,o){this.Mi=e,this.S_=s,this.b_=r,this.connection=n,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Xu(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}stop(){return g(this,null,function*(){this.x_()&&(yield this.close(0))})}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}k_(){return g(this,null,function*(){if(this.O_())return this.close(0)})}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(e,t){return g(this,null,function*(){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===cr.RESOURCE_EXHAUSTED?(sr(t.toString()),sr("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===cr.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.r_(t)})}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,s])=>{this.D_===t&&this.G_(e,s)},t=>{e(()=>{const e=new dr(cr.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){const s=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{s(()=>this.listener.Xo())}),this.stream.t_(()=>{s(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(e=>{s(()=>this.z_(e))}),this.stream.onMessage(e=>{s(()=>1==++this.F_?this.J_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(()=>g(this,null,function*(){this.state=0,this.start()}))}z_(e){return tr(Zu,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(tr(Zu,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class th extends eh{constructor(e,t,s,r,n,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,r,i),this.serializer=n}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=function(e,t){let s;if("targetChange"in t){t.targetChange;const n="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:ir(39313,{state:r}),i=t.targetChange.targetIds||[],a=function(e,t){return e.useProto3Json?(or(void 0===t||"string"==typeof t,58123),Gi.fromBase64String(t||"")):(or(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),Gi.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,l=o&&function(e){const t=void 0===e.code?cr.UNKNOWN:Cl(e.code);return new dr(t,e.message||"")}(o);s=new Vl(n,i,a,l||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const n=nc(e,r.document.name),i=Zl(r.document.updateTime),a=r.document.createTime?Zl(r.document.createTime):Kr.min(),o=new La({mapValue:{fields:r.document.fields}}),l=Fa.newFoundDocument(n,i,a,o),c=r.targetIds||[],d=r.removedTargetIds||[];s=new Fl(c,d,l.key,l)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const n=nc(e,r.document),i=r.readTime?Zl(r.readTime):Kr.min(),a=Fa.newNoDocument(n,i),o=r.removedTargetIds||[];s=new Fl([],o,a.key,a)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const n=nc(e,r.document),i=r.removedTargetIds||[];s=new Fl([],i,n,null)}else{if(!("filter"in t))return ir(11601,{Rt:t});{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:n}=e,i=new Sl(r,n),a=e.targetId;s=new Ul(a,i)}}var r;return s}(this.serializer,e),s=function(e){if(!("targetChange"in e))return Kr.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Kr.min():t.readTime?Zl(t.readTime):Kr.min()}(e);return this.listener.H_(t,s)}Y_(e){const t={};t.database=oc(this.serializer),t.addTarget=function(e,t){let s;const r=t.target;if(s=po(r)?{documents:hc(e,r)}:{query:mc(e,r).ft},s.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){s.resumeToken=Yl(e,t.resumeToken);const r=Jl(e,t.expectedCount);null!==r&&(s.expectedCount=r)}else if(t.snapshotVersion.compareTo(Kr.min())>0){s.readTime=Ql(e,t.snapshotVersion.toTimestamp());const r=Jl(e,t.expectedCount);null!==r&&(s.expectedCount=r)}return s}(this.serializer,e);const s=function(e,t){const s=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ir(28987,{purpose:e})}}(t.purpose);return null==s?null:{"goog-listen-tags":s}}(this.serializer,e);s&&(t.labels=s),this.q_(t)}Z_(e){const t={};t.database=oc(this.serializer),t.removeTarget=e,this.q_(t)}}class sh extends eh{constructor(e,t,s,r,n,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,s,r,i),this.serializer=n}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return or(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,or(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){or(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=function(e,t){return e&&e.length>0?(or(void 0!==t,14353),e.map(e=>function(e,t){let s=e.updateTime?Zl(e.updateTime):Zl(t);return s.isEqual(Kr.min())&&(s=Zl(t)),new ol(s,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),s=Zl(e.commitTime);return this.listener.na(s,t)}ra(){const e={};e.database=oc(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>dc(this.serializer,e))};this.q_(t)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class rh{}class nh extends rh{constructor(e,t,s,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new dr(cr.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,s,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([n,i])=>this.connection.Go(e,tc(t,s),r,n,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===cr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new dr(cr.UNKNOWN,e.toString())})}Ho(e,t,s,r,n){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Ho(e,tc(t,s),r,i,a,n)).catch(e=>{throw"FirebaseError"===e.name?(e.code===cr.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new dr(cr.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class ih{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(sr(t),this.aa=!1):tr("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const ah="RemoteStore";class oh{constructor(e,t,s,r,n){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=n,this.Aa.Oo(e=>{s.enqueueAndForget(()=>g(this,null,function*(){fh(this)&&(tr(ah,"Restarting streams for network reachability change."),yield function(e){return g(this,null,function*(){const t=lr(e);t.Ea.add(4),yield ch(t),t.Ra.set("Unknown"),t.Ea.delete(4),yield lh(t)})}(this))}))}),this.Ra=new ih(s,r)}}function lh(e){return g(this,null,function*(){if(fh(e))for(const t of e.da)yield t(!0)})}function ch(e){return g(this,null,function*(){for(const t of e.da)yield t(!1)})}function dh(e,t){const s=lr(e);s.Ia.has(t.targetId)||(s.Ia.set(t.targetId,t),gh(s)?ph(s):Rh(s).O_()&&hh(s,t))}function uh(e,t){const s=lr(e),r=Rh(s);s.Ia.delete(t),r.O_()&&mh(s,t),0===s.Ia.size&&(r.O_()?r.L_():fh(s)&&s.Ra.set("Unknown"))}function hh(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Kr.min())>0){const s=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(s)}Rh(e).Y_(t)}function mh(e,t){e.Va.Ue(t),Rh(e).Z_(t)}function ph(e){e.Va=new zl({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),Rh(e).start(),e.Ra.ua()}function gh(e){return fh(e)&&!Rh(e).x_()&&e.Ia.size>0}function fh(e){return 0===lr(e).Ea.size}function xh(e){e.Va=void 0}function yh(e){return g(this,null,function*(){e.Ra.set("Online")})}function bh(e){return g(this,null,function*(){e.Ia.forEach((t,s)=>{hh(e,t)})})}function vh(e,t){return g(this,null,function*(){xh(e),gh(e)?(e.Ra.ha(t),ph(e)):e.Ra.set("Unknown")})}function wh(e,t,s){return g(this,null,function*(){if(e.Ra.set("Online"),t instanceof Vl&&2===t.state&&t.cause)try{yield function(e,t){return g(this,null,function*(){const s=t.cause;for(const r of t.targetIds)e.Ia.has(r)&&(yield e.remoteSyncer.rejectListen(r,s),e.Ia.delete(r),e.Va.removeTarget(r))})}(e,t)}catch(r){tr(ah,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),yield Nh(e,r)}else if(t instanceof Fl?e.Va.Ze(t):t instanceof Ul?e.Va.st(t):e.Va.tt(t),!s.isEqual(Kr.min()))try{const t=yield Pu(e.localStore);s.compareTo(t)>=0&&(yield function(e,t){const s=e.Va.Tt(t);return s.targetChanges.forEach((s,r)=>{if(s.resumeToken.approximateByteSize()>0){const n=e.Ia.get(r);n&&e.Ia.set(r,n.withResumeToken(s.resumeToken,t))}}),s.targetMismatches.forEach((t,s)=>{const r=e.Ia.get(t);if(!r)return;e.Ia.set(t,r.withResumeToken(Gi.EMPTY_BYTE_STRING,r.snapshotVersion)),mh(e,t);const n=new kc(r.target,t,s,r.sequenceNumber);hh(e,n)}),e.remoteSyncer.applyRemoteEvent(s)}(e,s))}catch(n){tr(ah,"Failed to raise snapshot:",n),yield Nh(e,n)}})}function Nh(e,t,s){return g(this,null,function*(){if(!un(t))throw t;e.Ea.add(1),yield ch(e),e.Ra.set("Offline"),s||(s=()=>Pu(e.localStore)),e.asyncQueue.enqueueRetryable(()=>g(this,null,function*(){tr(ah,"Retrying IndexedDB access"),yield s(),e.Ea.delete(1),yield lh(e)}))})}function jh(e,t){return t().catch(s=>Nh(e,s,t))}function kh(e){return g(this,null,function*(){const t=lr(e),s=Oh(t);let r=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:vn;for(;Ih(t);)try{const e=yield Ru(t.localStore,r);if(null===e){0===t.Ta.length&&s.L_();break}r=e.batchId,Sh(t,e)}catch(n){yield Nh(t,n)}_h(t)&&Eh(t)})}function Ih(e){return fh(e)&&e.Ta.length<10}function Sh(e,t){e.Ta.push(t);const s=Oh(e);s.O_()&&s.X_&&s.ea(t.mutations)}function _h(e){return fh(e)&&!Oh(e).x_()&&e.Ta.length>0}function Eh(e){Oh(e).start()}function Th(e){return g(this,null,function*(){Oh(e).ra()})}function Ch(e){return g(this,null,function*(){const t=Oh(e);for(const s of e.Ta)t.ea(s.mutations)})}function Ah(e,t,s){return g(this,null,function*(){const r=e.Ta.shift(),n=kl.from(r,t,s);yield jh(e,()=>e.remoteSyncer.applySuccessfulWrite(n)),yield kh(e)})}function Ph(e,t){return g(this,null,function*(){t&&Oh(e).X_&&(yield function(e,t){return g(this,null,function*(){if(Tl(s=t.code)&&s!==cr.ABORTED){const s=e.Ta.shift();Oh(e).B_(),yield jh(e,()=>e.remoteSyncer.rejectFailedWrite(s.batchId,t)),yield kh(e)}var s})}(e,t)),_h(e)&&Eh(e)})}function Dh(e,t){return g(this,null,function*(){const s=lr(e);s.asyncQueue.verifyOperationInProgress(),tr(ah,"RemoteStore received new credentials");const r=fh(s);s.Ea.add(3),yield ch(s),r&&s.Ra.set("Unknown"),yield s.remoteSyncer.handleCredentialChange(t),s.Ea.delete(3),yield lh(s)})}function Rh(e){return e.ma||(e.ma=function(e,t,s){const r=lr(e);return r.sa(),new th(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,s)}(e.datastore,e.asyncQueue,{Xo:yh.bind(null,e),t_:bh.bind(null,e),r_:vh.bind(null,e),H_:wh.bind(null,e)}),e.da.push(t=>g(this,null,function*(){t?(e.ma.B_(),gh(e)?ph(e):e.Ra.set("Unknown")):(yield e.ma.stop(),xh(e))}))),e.ma}function Oh(e){return e.fa||(e.fa=function(e,t,s){const r=lr(e);return r.sa(),new sh(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,s)}(e.datastore,e.asyncQueue,{Xo:()=>Promise.resolve(),t_:Th.bind(null,e),r_:Ph.bind(null,e),ta:Ch.bind(null,e),na:Ah.bind(null,e)}),e.da.push(t=>g(this,null,function*(){t?(e.fa.B_(),yield kh(e)):(yield e.fa.stop(),e.Ta.length>0&&(tr(ah,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))}))),e.fa
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */}class Lh{constructor(e,t,s,r,n){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=r,this.removalCallback=n,this.deferred=new ur,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,r,n){const i=Date.now()+s,a=new Lh(e,t,i,r,n);return a.start(s),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new dr(cr.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Mh(e,t){if(sr("AsyncQueue",`${t}: ${e}`),un(e))return new dr(cr.UNAVAILABLE,`${t}: ${e}`);throw e}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Fh{static emptySet(e){return new Fh(e.comparator)}constructor(e){this.comparator=e?(t,s)=>e(t,s)||Pr.comparator(t.key,s.key):(e,t)=>Pr.comparator(e.key,t.key),this.keyedMap=Lo(),this.sortedSet=new Fi(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,s)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Fh))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=s.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const s=new Fh;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Uh{constructor(){this.ga=new Fi(Pr.comparator)}track(e){const t=e.doc.key,s=this.ga.get(t);s?0!==e.type&&3===s.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==s.type?this.ga=this.ga.insert(t,{type:s.type,doc:e.doc}):2===e.type&&2===s.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===s.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===s.type?this.ga=this.ga.remove(t):1===e.type&&2===s.type?this.ga=this.ga.insert(t,{type:1,doc:s.doc}):0===e.type&&1===s.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):ir(63341,{Rt:e,pa:s}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,s)=>{e.push(s)}),e}}class Vh{constructor(e,t,s,r,n,i,a,o,l){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=r,this.mutatedKeys=n,this.fromCache=i,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,s,r,n){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new Vh(e,t,Fh.emptySet(t),i,s,r,!0,!1,n)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&So(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==s[r].type||!t[r].doc.isEqual(s[r].doc))return!1;return!0}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Bh{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class zh{constructor(){this.queries=$h(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(e,t){const s=lr(e),r=s.queries;s.queries=$h(),r.forEach((e,s)=>{for(const r of s.Sa)r.onError(t)})}(this,new dr(cr.ABORTED,"Firestore shutting down"))}}function $h(){return new Po(e=>_o(e),So)}function qh(e,t){return g(this,null,function*(){const s=lr(e);let r=3;const n=t.query;let i=s.queries.get(n);i?!i.ba()&&t.Da()&&(r=2):(i=new Bh,r=t.Da()?0:1);try{switch(r){case 0:i.wa=yield s.onListen(n,!0);break;case 1:i.wa=yield s.onListen(n,!1);break;case 2:yield s.onFirstRemoteStoreListen(n)}}catch(a){const e=Mh(a,`Initialization of query '${Eo(t.query)}' failed`);return void t.onError(e)}s.queries.set(n,i),i.Sa.push(t),t.va(s.onlineState),i.wa&&t.Fa(i.wa)&&Wh(s)})}function Kh(e,t){return g(this,null,function*(){const s=lr(e),r=t.query;let n=3;const i=s.queries.get(r);if(i){const e=i.Sa.indexOf(t);e>=0&&(i.Sa.splice(e,1),0===i.Sa.length?n=t.Da()?0:1:!i.ba()&&t.Da()&&(n=2))}switch(n){case 0:return s.queries.delete(r),s.onUnlisten(r,!0);case 1:return s.queries.delete(r),s.onUnlisten(r,!1);case 2:return s.onLastRemoteStoreUnlisten(r);default:return}})}function Gh(e,t){const s=lr(e);let r=!1;for(const n of t){const e=n.query,t=s.queries.get(e);if(t){for(const e of t.Sa)e.Fa(n)&&(r=!0);t.wa=n}}r&&Wh(s)}function Hh(e,t,s){const r=lr(e),n=r.queries.get(t);if(n)for(const i of n.Sa)i.onError(s);r.queries.delete(t)}function Wh(e){e.Ca.forEach(e=>{e.next()})}var Jh,Qh;(Qh=Jh||(Jh={})).Ma="default",Qh.Cache="cache";class Yh{constructor(e,t,s){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=s||{}}Fa(e){if(!this.options.includeMetadataChanges){const t=[];for(const s of e.docChanges)3!==s.type&&t.push(s);e=new Vh(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache)return!0;if(!this.Da())return!0;const s="Offline"!==t;return(!this.options.qa||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=Vh.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Jh.Cache}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Xh{constructor(e){this.key=e}}class Zh{constructor(e){this.key=e}}class em{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=$o(),this.mutatedKeys=$o(),this.eu=Co(e),this.tu=new Fh(this.eu)}get nu(){return this.Ya}ru(e,t){const s=t?t.iu:new Uh,r=t?t.tu:this.tu;let n=t?t.mutatedKeys:this.mutatedKeys,i=r,a=!1;const o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{const c=r.get(e),d=To(this.query,t)?t:null,u=!!c&&this.mutatedKeys.has(c.key),h=!!d&&(d.hasLocalMutations||this.mutatedKeys.has(d.key)&&d.hasCommittedMutations);let m=!1;c&&d?c.data.isEqual(d.data)?u!==h&&(s.track({type:3,doc:d}),m=!0):this.su(c,d)||(s.track({type:2,doc:d}),m=!0,(o&&this.eu(d,o)>0||l&&this.eu(d,l)<0)&&(a=!0)):!c&&d?(s.track({type:0,doc:d}),m=!0):c&&!d&&(s.track({type:1,doc:c}),m=!0,(o||l)&&(a=!0)),m&&(d?(i=i.add(d),n=h?n.add(e):n.delete(e)):(i=i.delete(e),n=n.delete(e)))}),null!==this.query.limit)for(;i.size>this.query.limit;){const e="F"===this.query.limitType?i.last():i.first();i=i.delete(e.key),n=n.delete(e.key),s.track({type:1,doc:e})}return{tu:i,iu:s,Cs:a,mutatedKeys:n}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,r){const n=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const i=e.iu.ya();i.sort((e,t)=>function(e,t){const s=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ir(20277,{Rt:e})}};return s(e)-s(t)}(e.type,t.type)||this.eu(e.doc,t.doc)),this.ou(s),r=null!=r&&r;const a=t&&!r?this._u():[],o=0===this.Xa.size&&this.current&&!r?1:0,l=o!==this.Za;return this.Za=o,0!==i.length||l?{snapshot:new Vh(this.query,e.tu,n,i,e.mutatedKeys,0===o,l,!1,!!s&&s.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Uh,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=$o(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))});const t=[];return e.forEach(e=>{this.Xa.has(e)||t.push(new Zh(e))}),this.Xa.forEach(s=>{e.has(s)||t.push(new Xh(s))}),t}cu(e){this.Ya=e.Qs,this.Xa=$o();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Vh.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}const tm="SyncEngine";class sm{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class rm{constructor(e){this.key=e,this.hu=!1}}class nm{constructor(e,t,s,r,n,i){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=r,this.currentUser=n,this.maxConcurrentLimboResolutions=i,this.Pu={},this.Tu=new Po(e=>_o(e),So),this.Iu=new Map,this.Eu=new Set,this.du=new Fi(Pr.comparator),this.Au=new Map,this.Ru=new au,this.Vu={},this.mu=new Map,this.fu=Dd.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}function im(e,t,s=!0){return g(this,null,function*(){const r=Im(e);let n;const i=r.Tu.get(t);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),n=i.view.lu()):n=yield om(r,t,s,!0),n})}function am(e,t){return g(this,null,function*(){const s=Im(e);yield om(s,t,!0,!1)})}function om(e,t,s,r){return g(this,null,function*(){const n=yield function(e,t){const s=lr(e);return s.persistence.runTransaction("Allocate target","readwrite",e=>{let r;return s.Pi.getTargetData(e,t).next(n=>n?(r=n,rn.resolve(r)):s.Pi.allocateTargetId(e).next(n=>(r=new kc(t,n,"TargetPurposeListen",e.currentSequenceNumber),s.Pi.addTargetData(e,r).next(()=>r))))}).then(e=>{const r=s.Ms.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(s.Ms=s.Ms.insert(e.targetId,e),s.xs.set(t,e.targetId)),e})}(e.localStore,jo(t)),i=n.targetId,a=e.sharedClientState.addLocalQueryTarget(i,s);let o;return r&&(o=yield function(e,t,s,r,n){return g(this,null,function*(){e.pu=(t,s,r)=>function(e,t,s,r){return g(this,null,function*(){let n=t.view.ru(s);n.Cs&&(n=yield Lu(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,n)));const i=r&&r.targetChanges.get(t.targetId),a=r&&null!=r.targetMismatches.get(t.targetId),o=t.view.applyChanges(n,e.isPrimaryClient,i,a);return bm(e,t.targetId,o.au),o.snapshot})}(e,t,s,r);const i=yield Lu(e.localStore,t,!0),a=new em(t,i.Qs),o=a.ru(i.documents),l=Ml.createSynthesizedTargetChangeForCurrentChange(s,r&&"Offline"!==e.onlineState,n),c=a.applyChanges(o,e.isPrimaryClient,l);bm(e,s,c.au);const d=new sm(t,s,a);return e.Tu.set(t,d),e.Iu.has(s)?e.Iu.get(s).push(t):e.Iu.set(s,[t]),c.snapshot})}(e,t,i,"current"===a,n.resumeToken)),e.isPrimaryClient&&s&&dh(e.remoteStore,n),o})}function lm(e,t,s){return g(this,null,function*(){const r=lr(e),n=r.Tu.get(t),i=r.Iu.get(n.targetId);if(i.length>1)return r.Iu.set(n.targetId,i.filter(e=>!So(e,t))),void r.Tu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(n.targetId),r.sharedClientState.isActiveQueryTarget(n.targetId)||(yield Ou(r.localStore,n.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(n.targetId),s&&uh(r.remoteStore,n.targetId),xm(r,n.targetId)}).catch(sn))):(xm(r,n.targetId),yield Ou(r.localStore,n.targetId,!0))})}function cm(e,t){return g(this,null,function*(){const s=lr(e),r=s.Tu.get(t),n=s.Iu.get(r.targetId);s.isPrimaryClient&&1===n.length&&(s.sharedClientState.removeLocalQueryTarget(r.targetId),uh(s.remoteStore,r.targetId))})}function dm(e,t){return g(this,null,function*(){const s=lr(e);try{const e=yield Du(s.localStore,t);t.targetChanges.forEach((e,t)=>{const r=s.Au.get(t);r&&(or(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?r.hu=!0:e.modifiedDocuments.size>0?or(r.hu,14607):e.removedDocuments.size>0&&(or(r.hu,42227),r.hu=!1))}),yield Nm(s,e,t)}catch(r){yield sn(r)}})}function um(e,t,s){const r=lr(e);if(r.isPrimaryClient&&0===s||!r.isPrimaryClient&&1===s){const e=[];r.Tu.forEach((s,r)=>{const n=r.view.va(t);n.snapshot&&e.push(n.snapshot)}),function(e,t){const s=lr(e);s.onlineState=t;let r=!1;s.queries.forEach((e,s)=>{for(const n of s.Sa)n.va(t)&&(r=!0)}),r&&Wh(s)}(r.eventManager,t),e.length&&r.Pu.H_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function hm(e,t,s){return g(this,null,function*(){const r=lr(e);r.sharedClientState.updateQueryState(t,"rejected",s);const n=r.Au.get(t),i=n&&n.key;if(i){let e=new Fi(Pr.comparator);e=e.insert(i,Fa.newNoDocument(i,Kr.min()));const s=$o().add(i),n=new Ll(Kr.min(),new Map,new Fi(Nr),e,s);yield dm(r,n),r.du=r.du.remove(i),r.Au.delete(t),wm(r)}else yield Ou(r.localStore,t,!1).then(()=>xm(r,t,s)).catch(sn)})}function mm(e,t){return g(this,null,function*(){const s=lr(e),r=t.batch.batchId;try{const e=yield function(e,t){const s=lr(e);return s.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const r=t.batch.keys(),n=s.Ns.newChangeBuffer({trackRemovals:!0});return function(e,t,s,r){const n=s.batch,i=n.keys();let a=rn.resolve();return i.forEach(e=>{a=a.next(()=>r.getEntry(t,e)).next(t=>{const i=s.docVersions.get(e);or(null!==i,48541),t.version.compareTo(i)<0&&(n.applyToRemoteDocument(t,s),t.isValidDocument()&&(t.setReadTime(s.commitVersion),r.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,n))}(s,e,t,n).next(()=>n.apply(e)).next(()=>s.mutationQueue.performConsistencyCheck(e)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=$o();for(let s=0;s<e.mutationResults.length;++s)e.mutationResults[s].transformResults.length>0&&(t=t.add(e.batch.mutations[s].key));return t}(t))).next(()=>s.localDocuments.getDocuments(e,r))})}(s.localStore,t);fm(s,r,null),gm(s,r),s.sharedClientState.updateMutationState(r,"acknowledged"),yield Nm(s,e)}catch(n){yield sn(n)}})}function pm(e,t,s){return g(this,null,function*(){const r=lr(e);try{const e=yield function(e,t){const s=lr(e);return s.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return s.mutationQueue.lookupMutationBatch(e,t).next(t=>(or(null!==t,37113),r=t.keys(),s.mutationQueue.removeMutationBatch(e,t))).next(()=>s.mutationQueue.performConsistencyCheck(e)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>s.localDocuments.getDocuments(e,r))})}(r.localStore,t);fm(r,t,s),gm(r,t),r.sharedClientState.updateMutationState(t,"rejected",s),yield Nm(r,e)}catch(n){yield sn(n)}})}function gm(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function fm(e,t,s){const r=lr(e);let n=r.Vu[r.currentUser.toKey()];if(n){const e=n.get(t);e&&(s?e.reject(s):e.resolve(),n=n.remove(t)),r.Vu[r.currentUser.toKey()]=n}}function xm(e,t,s=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Iu.get(t))e.Tu.delete(r),s&&e.Pu.yu(r,s);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach(t=>{e.Ru.containsKey(t)||ym(e,t)})}function ym(e,t){e.Eu.delete(t.path.canonicalString());const s=e.du.get(t);null!==s&&(uh(e.remoteStore,s),e.du=e.du.remove(t),e.Au.delete(s),wm(e))}function bm(e,t,s){for(const r of s)r instanceof Xh?(e.Ru.addReference(r.key,t),vm(e,r)):r instanceof Zh?(tr(tm,"Document no longer in limbo: "+r.key),e.Ru.removeReference(r.key,t),e.Ru.containsKey(r.key)||ym(e,r.key)):ir(19791,{wu:r})}function vm(e,t){const s=t.key,r=s.path.canonicalString();e.du.get(s)||e.Eu.has(r)||(tr(tm,"New document in limbo: "+s),e.Eu.add(r),wm(e))}function wm(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){const t=e.Eu.values().next().value;e.Eu.delete(t);const s=new Pr(Tr.fromString(t)),r=e.fu.next();e.Au.set(r,new rm(s)),e.du=e.du.insert(s,r),dh(e.remoteStore,new kc(jo(bo(s.path)),r,"TargetPurposeLimboResolution",bn.ce))}}function Nm(e,t,s){return g(this,null,function*(){const r=lr(e),n=[],i=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach((e,o)=>{a.push(r.pu(o,t,s).then(e=>{var t;if((e||s)&&r.isPrimaryClient){const n=e?!e.fromCache:null==(t=null==s?void 0:s.targetChanges.get(o.targetId))?void 0:t.current;r.sharedClientState.updateQueryState(o.targetId,n?"current":"not-current")}if(e){n.push(e);const t=Iu.As(o.targetId,e);i.push(t)}}))}),yield Promise.all(a),r.Pu.H_(n),yield function(e,t){return g(this,null,function*(){const s=lr(e);try{yield s.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>rn.forEach(t,t=>rn.forEach(t.Es,r=>s.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>rn.forEach(t.ds,r=>s.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(r){if(!un(r))throw r;tr(Eu,"Failed to update sequence numbers: "+r)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=s.Ms.get(t),r=e.snapshotVersion,n=e.withLastLimboFreeSnapshotVersion(r);s.Ms=s.Ms.insert(t,n)}}})}(r.localStore,i))})}function jm(e,t){return g(this,null,function*(){const s=lr(e);if(!s.currentUser.isEqual(t)){tr(tm,"User change. New user:",t.toKey());const e=yield Au(s.localStore,t);s.currentUser=t,n="'waitForPendingWrites' promise is rejected due to a user change.",(r=s).mu.forEach(e=>{e.forEach(e=>{e.reject(new dr(cr.CANCELLED,n))})}),r.mu.clear(),s.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),yield Nm(s,e.Ls)}var r,n})}function km(e,t){const s=lr(e),r=s.Au.get(t);if(r&&r.hu)return $o().add(r.key);{let e=$o();const r=s.Iu.get(t);if(!r)return e;for(const t of r){const r=s.Tu.get(t);e=e.unionWith(r.view.nu)}return e}}function Im(e){const t=lr(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=dm.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=km.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=hm.bind(null,t),t.Pu.H_=Gh.bind(null,t.eventManager),t.Pu.yu=Hh.bind(null,t.eventManager),t}function Sm(e){const t=lr(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=mm.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=pm.bind(null,t),t}class _m{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(e){return g(this,null,function*(){this.serializer=Yu(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),yield this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)})}Fu(e,t){return null}Mu(e,t){return null}vu(e){return Cu(this.persistence,new _u,e.initialUser,this.serializer)}Cu(e){return new hu(pu.mi,this.serializer)}Du(e){return new Fu}terminate(){return g(this,null,function*(){var e,t;null==(e=this.gcScheduler)||e.stop(),null==(t=this.indexBackfillerScheduler)||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}_m.provider={build:()=>new _m};class Em extends _m{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){or(this.persistence.referenceDelegate instanceof gu,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new Bd(s,e.asyncQueue,t)}Cu(e){const t=void 0!==this.cacheSizeBytes?Id.withCacheSize(this.cacheSizeBytes):Id.DEFAULT;return new hu(e=>gu.mi(e,t),this.serializer)}}class Tm extends _m{constructor(e,t,s){super(),this.xu=e,this.cacheSizeBytes=t,this.forceOwnership=s,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return g(this,null,function*(){yield p(Tm.prototype,this,"initialize").call(this,e),yield this.xu.initialize(this,e),yield Sm(this.xu.syncEngine),yield kh(this.xu.remoteStore),yield this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}vu(e){return Cu(this.persistence,new _u,e.initialUser,this.serializer)}Fu(e,t){const s=this.persistence.referenceDelegate.garbageCollector;return new Bd(s,e.asyncQueue,t)}Mu(e,t){const s=new yn(t,this.persistence);return new xn(e.asyncQueue,s)}Cu(e){const t=function(e,t){let s=e.projectId;return e.isDefaultDatabase||(s+="."+e.database),"firestore/"+t+"/"+s+"/"}(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),s=void 0!==this.cacheSizeBytes?Id.withCacheSize(this.cacheSizeBytes):Id.DEFAULT;return new Nu(this.synchronizeTabs,t,e.clientId,s,e.asyncQueue,"undefined"!=typeof window?window:null,Qu(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new Fu}}class Cm{initialize(e,t){return g(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>um(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=jm.bind(null,this.syncEngine),yield function(e,t){return g(this,null,function*(){const s=lr(e);t?(s.Ea.delete(2),yield lh(s)):t||(s.Ea.add(2),yield ch(s),s.Ra.set("Unknown"))})}(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return new zh}createDatastore(e){const t=Yu(e.databaseInfo.databaseId),s=(r=e.databaseInfo,new Ju(r));var r;return function(e,t,s,r){return new nh(e,t,s,r)}(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return t=this.localStore,s=this.datastore,r=e.asyncQueue,n=e=>um(this.syncEngine,e,0),i=Bu.v()?new Bu:new Uu,new oh(t,s,r,n,i);var t,s,r,n,i}createSyncEngine(e,t){return function(e,t,s,r,n,i,a){const o=new nm(e,t,s,r,n,i);return a&&(o.gu=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return g(this,null,function*(){var e,t;yield function(e){return g(this,null,function*(){const t=lr(e);tr(ah,"RemoteStore shutting down."),t.Ea.add(5),yield ch(t),t.Aa.shutdown(),t.Ra.set("Unknown")})}(this.remoteStore),null==(e=this.datastore)||e.terminate(),null==(t=this.eventManager)||t.terminate()})}}Cm.provider={build:()=>new Cm};
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Am{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):sr("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Pm{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return g(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new dr(cr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=yield function(e,t){return g(this,null,function*(){const s=lr(e),r={documents:t.map(e=>rc(s.serializer,e))},n=yield s.Ho("BatchGetDocuments",s.serializer.databaseId,Tr.emptyPath(),r,t.length),i=new Map;n.forEach(e=>{const t=function(e,t){return"found"in t?function(e,t){or(!!t.found,43571),t.found.name,t.found.updateTime;const s=nc(e,t.found.name),r=Zl(t.found.updateTime),n=t.found.createTime?Zl(t.found.createTime):Kr.min(),i=new La({mapValue:{fields:t.found.fields}});return Fa.newFoundDocument(s,r,n,i)}(e,t):"missing"in t?function(e,t){or(!!t.missing,3894),or(!!t.readTime,22933);const s=nc(e,t.missing),r=Zl(t.readTime);return Fa.newNoDocument(s,r)}(e,t):ir(7234,{result:t})}(s.serializer,e);i.set(t.key.toString(),t)});const a=[];return t.forEach(e=>{const t=i.get(e.toString());or(!!t,55234,{key:e}),a.push(t)}),a})}(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(s){this.lastTransactionError=s}this.writtenDocs.add(e.toString())}delete(e){this.write(new wl(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return g(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{const s=Pr.fromPath(t);this.mutations.push(new Nl(s,this.precondition(s)))}),yield function(e,t){return g(this,null,function*(){const s=lr(e),r={writes:t.map(e=>dc(s.serializer,e))};yield s.Go("Commit",s.serializer.databaseId,Tr.emptyPath(),r)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw ir(50498,{Gu:e.constructor.name});t=Kr.min()}const s=this.readVersions.get(e.key.toString());if(s){if(!t.isEqual(s))throw new dr(cr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Kr.min())?ll.exists(!1):ll.updateTime(t):ll.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Kr.min()))throw new dr(cr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ll.updateTime(t)}return ll.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Dm{constructor(e,t,s,r,n){this.asyncQueue=e,this.datastore=t,this.options=s,this.updateFunction=r,this.deferred=n,this.zu=s.maxAttempts,this.M_=new Xu(this.asyncQueue,"transaction_retry")}ju(){this.zu-=1,this.Ju()}Ju(){this.M_.p_(()=>g(this,null,function*(){const e=new Pm(this.datastore),t=this.Hu(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.Yu(e)}))}).catch(e=>{this.Yu(e)})}))}Hu(e){try{const t=this.updateFunction(e);return!wn(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Yu(e){this.zu>0&&this.Zu(e)?(this.zu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ju(),Promise.resolve()))):this.deferred.reject(e)}Zu(e){if("FirebaseError"===(null==e?void 0:e.name)){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Tl(t)}return!1}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Rm="FirestoreClient";class Om{constructor(e,t,s,r,n){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this.databaseInfo=r,this.user=Ys.UNAUTHENTICATED,this.clientId=wr.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=n,this.authCredentials.start(s,e=>g(this,null,function*(){tr(Rm,"Received user=",e.uid),yield this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(s,e=>(tr(Rm,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new ur;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>g(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=Mh(t,"Failed to shutdown persistence");e.reject(s)}})),e.promise}}function Lm(e,t){return g(this,null,function*(){e.asyncQueue.verifyOperationInProgress(),tr(Rm,"Initializing OfflineComponentProvider");const s=e.configuration;yield t.initialize(s);let r=s.initialUser;e.setCredentialChangeListener(e=>g(this,null,function*(){r.isEqual(e)||(yield Au(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t})}function Mm(e,t){return g(this,null,function*(){e.asyncQueue.verifyOperationInProgress();const s=yield function(e){return g(this,null,function*(){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){tr(Rm,"Using user provided OfflineComponentProvider");try{yield Lm(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!("FirebaseError"===(s=n).name?s.code===cr.FAILED_PRECONDITION||s.code===cr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&s instanceof DOMException)||22===s.code||20===s.code||11===s.code))throw n;rr("Error using user provided cache. Falling back to memory cache: "+n),yield Lm(e,new _m)}}else tr(Rm,"Using default OfflineComponentProvider"),yield Lm(e,new Em(void 0));var s;return e._offlineComponents})}(e);tr(Rm,"Initializing OnlineComponentProvider"),yield t.initialize(s,e.configuration),e.setCredentialChangeListener(e=>Dh(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,s)=>Dh(t.remoteStore,s)),e._onlineComponents=t})}function Fm(e){return g(this,null,function*(){return e._onlineComponents||(e._uninitializedComponentsProvider?(tr(Rm,"Using user provided OnlineComponentProvider"),yield Mm(e,e._uninitializedComponentsProvider._online)):(tr(Rm,"Using default OnlineComponentProvider"),yield Mm(e,new Cm))),e._onlineComponents})}function Um(e){return g(this,null,function*(){const t=yield Fm(e),s=t.eventManager;return s.onListen=im.bind(null,t.syncEngine),s.onUnlisten=lm.bind(null,t.syncEngine),s.onFirstRemoteStoreListen=am.bind(null,t.syncEngine),s.onLastRemoteStoreUnlisten=cm.bind(null,t.syncEngine),s})}
/**
     * @license
     * Copyright 2023 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function Vm(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */}const Bm=new Map,zm="firestore.googleapis.com",$m=!0;
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class qm{constructor(e){var t,s;if(void 0===e.host){if(void 0!==e.ssl)throw new dr(cr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=zm,this.ssl=$m}else this.host=e.host,this.ssl=null!=(t=e.ssl)?t:$m;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=kd;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new dr(cr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Rr("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Vm(null!=(s=e.experimentalLongPollingOptions)?s:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new dr(cr.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new dr(cr.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new dr(cr.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,s=e.experimentalLongPollingOptions,t.timeoutSeconds===s.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,s}}class Km{constructor(e,t,s,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new qm({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new dr(cr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new dr(cr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new qm(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new mr;switch(e.type){case"firstParty":return new xr(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new dr(cr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return g(this,null,function*(){"notTerminated"===this._terminateTask?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Bm.get(e);t&&(tr("ComponentProvider","Removing Datastore"),Bm.delete(e),t.terminate())}(this),Promise.resolve()}}function Gm(e,t,s,r={}){var n;e=Ur(e,Km);const i=Ve(t),a=e._getSettings(),o=u(d({},a),{emulatorOptions:e._getEmulatorOptions()}),l=`${t}:${s}`;i&&(Be(`https://${l}`),Ke("Firestore",!0)),a.host!==zm&&a.host!==l&&rr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c=u(d({},a),{host:l,ssl:i,emulatorOptions:r});if(!et(c,o)&&(e._setSettings(c),r.mockUserToken)){let t,s;if("string"==typeof r.mockUserToken)t=r.mockUserToken,s=Ys.MOCK_USER;else{t=ze(r.mockUserToken,null==(n=e._app)?void 0:n.options.projectId);const i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new dr(cr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");s=new Ys(i)}e._authCredentials=new pr(new hr(t,s))}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Hm{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new Hm(this.firestore,e,this._query)}}class Wm{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Jm(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Wm(this.firestore,e,this._key)}toJSON(){return{type:Wm._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,s){if(Br(t,Wm._jsonSchema))return new Wm(e,s||null,new Pr(Tr.fromString(t.referencePath)))}}Wm._jsonSchemaVersion="firestore/documentReference/1.0",Wm._jsonSchema={type:Vr("string",Wm._jsonSchemaVersion),referencePath:Vr("string")};class Jm extends Hm{constructor(e,t,s){super(e,t,bo(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Wm(this.firestore,null,new Pr(e))}withConverter(e){return new Jm(this.firestore,e,this._path)}}function Qm(e,t,...s){if(e=ot(e),Dr("collection","path",t),e instanceof Km){const r=Tr.fromString(t,...s);return Lr(r),new Jm(e,null,r)}{if(!(e instanceof Wm||e instanceof Jm))throw new dr(cr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(Tr.fromString(t,...s));return Lr(r),new Jm(e.firestore,null,r)}}function Ym(e,t,...s){if(e=ot(e),1===arguments.length&&(t=wr.newId()),Dr("doc","path",t),e instanceof Km){const r=Tr.fromString(t,...s);return Or(r),new Wm(e,null,new Pr(r))}{if(!(e instanceof Wm||e instanceof Jm))throw new dr(cr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(Tr.fromString(t,...s));return Or(r),new Wm(e.firestore,e instanceof Jm?e.converter:null,new Pr(r))}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Xm="AsyncQueue";class Zm{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Xu(this,"async_queue_retry"),this._c=()=>{const e=Qu();e&&tr(Xm,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=Qu();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Qu();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new ur;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}lc(){return g(this,null,function*(){if(0!==this.Xu.length){try{yield this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!un(e))throw e;tr(Xm,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}})}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,sr("INTERNAL UNHANDLED ERROR: ",ep(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,s){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=Lh.createAndSchedule(this,e,t,s,e=>this.hc(e));return this.tc.push(r),r}uc(){this.nc&&ir(47125,{Pc:ep(this.nc)})}verifyOperationInProgress(){}Tc(){return g(this,null,function*(){let e;do{e=this.ac,yield e}while(e!==this.ac)})}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function ep(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */}function tp(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const s=e;for(const r of t)if(r in s&&"function"==typeof s[r])return!0;return!1}(e,["next","error","complete"])}class sp extends Km{constructor(e,t,s,r){super(e,t,s,r),this.type="firestore",this._queue=new Zm,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return g(this,null,function*(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Zm(e),this._firestoreClient=void 0,yield e}})}}function rp(e,t){const s="object"==typeof e?e:Is(),r="string"==typeof e?e:ia,n=bs(s,"firestore").getImmediate({identifier:r});if(!n._initialized){const e=Le("firestore");e&&Gm(n,...e)}return n}function np(e){if(e._terminated)throw new dr(cr.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||ip(e),e._firestoreClient}function ip(e){var t,s,r;const n=e._freezeSettings(),i=(a=e._databaseId,o=(null==(t=e._app)?void 0:t.options.appId)||"",l=e._persistenceKey,new na(a,o,l,(c=n).host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,Vm(c.experimentalLongPollingOptions),c.useFetchStreams,c.isUsingEmulator));var a,o,l,c;e._componentsProvider||(null==(s=n.localCache)?void 0:s._offlineComponentProvider)&&(null==(r=n.localCache)?void 0:r._onlineComponentProvider)&&(e._componentsProvider={_offline:n.localCache._offlineComponentProvider,_online:n.localCache._onlineComponentProvider}),e._firestoreClient=new Om(e._authCredentials,e._appCheckCredentials,e._queue,i,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}function ap(e,t){rr("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const s=e._freezeSettings();return function(e,t,s){if((e=Ur(e,sp))._firestoreClient||e._terminated)throw new dr(cr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(e._componentsProvider||e._getSettings().localCache)throw new dr(cr.FAILED_PRECONDITION,"SDK cache is already specified.");e._componentsProvider={_online:t,_offline:s},ip(e)}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(e,Cm.provider,{build:e=>new Tm(e,s.cacheSizeBytes,null==t?void 0:t.forceOwnership)}),Promise.resolve()}class op{constructor(e){this._byteString=e}static fromBase64String(e){try{return new op(Gi.fromBase64String(e))}catch(t){throw new dr(cr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new op(Gi.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:op._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Br(e,op._jsonSchema))return op.fromBase64String(e.bytes)}}op._jsonSchemaVersion="firestore/bytes/1.0",op._jsonSchema={type:Vr("string",op._jsonSchemaVersion),bytes:Vr("string")};
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class lp{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new dr(cr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ar(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class cp{constructor(e){this._methodName=e}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class dp{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new dr(cr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new dr(cr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Nr(this._lat,e._lat)||Nr(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:dp._jsonSchemaVersion}}static fromJSON(e){if(Br(e,dp._jsonSchema))return new dp(e.latitude,e.longitude)}}dp._jsonSchemaVersion="firestore/geoPoint/1.0",dp._jsonSchema={type:Vr("string",dp._jsonSchemaVersion),latitude:Vr("number"),longitude:Vr("number")};
/**
     * @license
     * Copyright 2024 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class up{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let s=0;s<e.length;++s)if(e[s]!==t[s])return!1;return!0}(this._values,e._values)}toJSON(){return{type:up._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Br(e,up._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new up(e.vectorValues);throw new dr(cr.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}up._jsonSchemaVersion="firestore/vectorValue/1.0",up._jsonSchema={type:Vr("string",up._jsonSchemaVersion),vectorValues:Vr("object")};
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const hp=/^__.*__$/;class mp{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return null!==this.fieldMask?new xl(e,this.data,this.fieldMask,t,this.fieldTransforms):new fl(e,this.data,t,this.fieldTransforms)}}class pp{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return new xl(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function gp(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ir(40011,{Ac:e})}}class fp{constructor(e,t,s,r,n,i){this.settings=e,this.databaseId=t,this.serializer=s,this.ignoreUndefinedProperties=r,void 0===n&&this.Rc(),this.fieldTransforms=n||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new fp(d(d({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var t;const s=null==(t=this.path)?void 0:t.child(e),r=this.Vc({path:s,fc:!1});return r.gc(e),r}yc(e){var t;const s=null==(t=this.path)?void 0:t.child(e),r=this.Vc({path:s,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Ap(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(gp(this.Ac)&&hp.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class xp{constructor(e,t,s){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=s||Yu(e)}Cc(e,t,s,r=!1){return new fp({Ac:e,methodName:t,Dc:s,path:Ar.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function yp(e){const t=e._freezeSettings(),s=Yu(e._databaseId);return new xp(e._databaseId,!!t.ignoreUndefinedProperties,s)}function bp(e,t,s,r,n,i={}){const a=e.Cc(i.merge||i.mergeFields?2:0,t,s,n);_p("Data must be an object, but it was:",a,r);const o=Ip(r,a);let l,c;if(i.merge)l=new qi(a.fieldMask),c=a.fieldTransforms;else if(i.mergeFields){const e=[];for(const r of i.mergeFields){const n=Ep(t,r,s);if(!a.contains(n))throw new dr(cr.INVALID_ARGUMENT,`Field '${n}' is specified in your field mask but missing from your input data.`);Pp(e,n)||e.push(n)}l=new qi(e),c=a.fieldTransforms.filter(e=>l.covers(e.field))}else l=null,c=a.fieldTransforms;return new mp(new La(o),l,c)}class vp extends cp{_toFieldTransform(e){if(2!==e.Ac)throw 1===e.Ac?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof vp}}function wp(e,t,s,r){const n=e.Cc(1,t,s);_p("Data must be an object, but it was:",n,r);const i=[],a=La.empty();Li(r,(e,r)=>{const o=Cp(t,e,s);r=ot(r);const l=n.yc(o);if(r instanceof vp)i.push(o);else{const e=kp(r,l);null!=e&&(i.push(o),a.set(o,e))}});const o=new qi(i);return new pp(a,o,n.fieldTransforms)}function Np(e,t,s,r,n,i){const a=e.Cc(1,t,s),o=[Ep(t,r,s)],l=[n];if(i.length%2!=0)throw new dr(cr.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let h=0;h<i.length;h+=2)o.push(Ep(t,i[h])),l.push(i[h+1]);const c=[],d=La.empty();for(let h=o.length-1;h>=0;--h)if(!Pp(c,o[h])){const e=o[h];let t=l[h];t=ot(t);const s=a.yc(e);if(t instanceof vp)c.push(e);else{const r=kp(t,s);null!=r&&(c.push(e),d.set(e,r))}}const u=new qi(c);return new pp(d,u,a.fieldTransforms)}function jp(e,t,s,r=!1){return kp(s,e.Cc(r?4:3,t))}function kp(e,t){if(Sp(e=ot(e)))return _p("Unsupported field value:",t,e),Ip(e,t);if(e instanceof cp)return function(e,t){if(!gp(t.Ac))throw t.Sc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Sc(`${e._methodName}() is not currently supported inside arrays`);const s=e._toFieldTransform(t);s&&t.fieldTransforms.push(s)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&4!==t.Ac)throw t.Sc("Nested arrays are not supported");return function(e,t){const s=[];let r=0;for(const n of e){let e=kp(n,t.wc(r));null==e&&(e={nullValue:"NULL_VALUE"}),s.push(e),r++}return{arrayValue:{values:s}}}(e,t)}return function(e,t){if(null===(e=ot(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Ho(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const s=qr.fromDate(e);return{timestampValue:Ql(t.serializer,s)}}if(e instanceof qr){const s=new qr(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Ql(t.serializer,s)}}if(e instanceof dp)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof op)return{bytesValue:Yl(t.serializer,e._byteString)};if(e instanceof Wm){const s=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(s))throw t.Sc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:ec(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof up)return s=e,r=t,{mapValue:{fields:{[oa]:{stringValue:da},[ua]:{arrayValue:{values:s.toArray().map(e=>{if("number"!=typeof e)throw r.Sc("VectorValues must only contain numeric values.");return Ko(r.serializer,e)})}}}}};var s,r;throw t.Sc(`Unsupported field value: ${Fr(e)}`)}(e,t)}function Ip(e,t){const s={};return Mi(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Li(e,(e,r)=>{const n=kp(r,t.mc(e));null!=n&&(s[e]=n)}),{mapValue:{fields:s}}}function Sp(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof qr||e instanceof dp||e instanceof op||e instanceof Wm||e instanceof cp||e instanceof up)}function _p(e,t,s){if(!Sp(s)||!Mr(s)){const r=Fr(s);throw"an object"===r?t.Sc(e+" a custom object"):t.Sc(e+" "+r)}}function Ep(e,t,s){if((t=ot(t))instanceof lp)return t._internalPath;if("string"==typeof t)return Cp(e,t);throw Ap("Field path arguments must be of type string or ",e,!1,void 0,s)}const Tp=new RegExp("[~\\*/\\[\\]]");function Cp(e,t,s){if(t.search(Tp)>=0)throw Ap(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,s);try{return new lp(...t.split("."))._internalPath}catch(r){throw Ap(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,s)}}function Ap(e,t,s,r,n){const i=r&&!r.isEmpty(),a=void 0!==n;let o=`Function ${t}() called with invalid data`;s&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(i||a)&&(l+=" (found",i&&(l+=` in field ${r}`),a&&(l+=` in document ${n}`),l+=")"),new dr(cr.INVALID_ARGUMENT,o+e+l)}function Pp(e,t){return e.some(e=>e.isEqual(t))}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Dp{constructor(e,t,s,r,n){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=r,this._converter=n}get id(){return this._key.path.lastSegment()}get ref(){return new Wm(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Rp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Op("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Rp extends Dp{data(){return super.data()}}function Op(e,t){return"string"==typeof t?Cp(e,t):t instanceof lp?t._internalPath:t._delegate._internalPath}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Lp(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new dr(cr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Mp{}class Fp extends Mp{}function Up(e,t,...s){let r=[];t instanceof Mp&&r.push(t),r=r.concat(s),function(e){const t=e.filter(e=>e instanceof zp).length,s=e.filter(e=>e instanceof Vp).length;if(t>1||t>0&&s>0)throw new dr(cr.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const n of r)e=n._apply(e);return e}class Vp extends Fp{constructor(e,t,s){super(),this._field=e,this._op=t,this._value=s,this.type="where"}static _create(e,t,s){return new Vp(e,t,s)}_apply(e){const t=this._parse(e);return Yp(e._query,t),new Hm(e.firestore,e.converter,ko(e._query,t))}_parse(e){const t=yp(e.firestore);return function(e,t,s,r,n,i,a){let o;if(n.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new dr(cr.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){Qp(a,i);const t=[];for(const s of a)t.push(Jp(r,e,s));o={arrayValue:{values:t}}}else o=Jp(r,e,a)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Qp(a,i),o=jp(s,t,a,"in"===i||"not-in"===i);return Ka.create(n,i,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Bp(e,t,s){const r=t,n=Op("where",e);return Vp._create(n,r,s)}class zp extends Mp{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new zp(e,t)}_parse(e){const t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:Ga.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let s=e;const r=t.getFlattenedFilters();for(const n of r)Yp(s,n),s=ko(s,n)}(e._query,t),new Hm(e.firestore,e.converter,ko(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class $p extends Fp{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new $p(e,t)}_apply(e){const t=function(e,t,s){if(null!==e.startAt)throw new dr(cr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new dr(cr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new za(t,s)}(e._query,this._field,this._direction);return new Hm(e.firestore,e.converter,function(e,t){const s=e.explicitOrderBy.concat([t]);return new yo(e.path,e.collectionGroup,s,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function qp(e,t="asc"){const s=t,r=Op("orderBy",e);return $p._create(r,s)}class Kp extends Fp{constructor(e,t,s){super(),this.type=e,this._limit=t,this._limitType=s}static _create(e,t,s){return new Kp(e,t,s)}_apply(e){return new Hm(e.firestore,e.converter,Io(e._query,this._limit,this._limitType))}}function Gp(e){return function(e,t){if(t<=0)throw new dr(cr.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}("limit",e),Kp._create("limit",e,"F")}class Hp extends Fp{constructor(e,t,s){super(),this.type=e,this._docOrFields=t,this._inclusive=s}static _create(e,t,s){return new Hp(e,t,s)}_apply(e){const t=function(e,t,s,r){if(s[0]=ot(s[0]),s[0]instanceof Dp)return function(e,t,s,r,n){if(!r)throw new dr(cr.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${s}().`);const i=[];for(const a of No(e))if(a.field.isKeyField())i.push(Na(t,r.key));else{const e=r.data.field(a.field);if(ta(e))throw new dr(cr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=a.field.canonicalString();throw new dr(cr.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}i.push(e)}return new Ua(i,n)}(e._query,e.firestore._databaseId,t,s[0]._document,r);{const n=yp(e.firestore);return function(e,t,s,r,n,i){const a=e.explicitOrderBy;if(n.length>a.length)throw new dr(cr.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const o=[];for(let l=0;l<n.length;l++){const i=n[l];if(a[l].field.isKeyField()){if("string"!=typeof i)throw new dr(cr.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof i}`);if(!wo(e)&&-1!==i.indexOf("/"))throw new dr(cr.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${i}' contains a slash.`);const s=e.path.child(Tr.fromString(i));if(!Pr.isDocumentKey(s))throw new dr(cr.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${s}' is not because it contains an odd number of segments.`);const n=new Pr(s);o.push(Na(t,n))}else{const e=jp(s,r,i);o.push(e)}}return new Ua(o,i)}(e._query,e.firestore._databaseId,n,t,s,r)}}(e,this.type,this._docOrFields,this._inclusive);return new Hm(e.firestore,e.converter,(s=e._query,r=t,new yo(s.path,s.collectionGroup,s.explicitOrderBy.slice(),s.filters.slice(),s.limit,s.limitType,r,s.endAt)));var s,r}}function Wp(...e){return Hp._create("startAfter",e,!1)}function Jp(e,t,s){if("string"==typeof(s=ot(s))){if(""===s)throw new dr(cr.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!wo(t)&&-1!==s.indexOf("/"))throw new dr(cr.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${s}' contains a '/' character.`);const r=t.path.child(Tr.fromString(s));if(!Pr.isDocumentKey(r))throw new dr(cr.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Na(e,new Pr(r))}if(s instanceof Wm)return Na(e,s._key);throw new dr(cr.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Fr(s)}.`)}function Qp(e,t){if(!Array.isArray(e)||0===e.length)throw new dr(cr.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Yp(e,t){const s=function(e,t){for(const s of e)for(const e of s.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==s)throw s===t.op?new dr(cr.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new dr(cr.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${s.toString()}' filters.`)}class Xp{convertValue(e,t="none"){switch(ma(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ji(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Qi(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw ir(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return Li(e,(e,r)=>{s[e]=this.convertValue(r,t)}),s}convertVectorValue(e){var t,s,r;const n=null==(r=null==(s=null==(t=e.fields)?void 0:t[ua].arrayValue)?void 0:s.values)?void 0:r.map(e=>Ji(e.doubleValue));return new up(n)}convertGeoPoint(e){return new dp(Ji(e.latitude),Ji(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const s=sa(e);return null==s?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(ra(e));default:return null}}convertTimestamp(e){const t=Wi(e);return new qr(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=Tr.fromString(e);or(jc(s),9688,{name:e});const r=new aa(s.get(1),s.get(3)),n=new Pr(s.popFirst(5));return r.isEqual(t)||sr(`Document ${n} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),n}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Zp(e,t,s){let r;return r=e?s&&(s.merge||s.mergeFields)?e.toFirestore(t,s):e.toFirestore(t):t,r}class eg extends Xp{constructor(e){super(),this.firestore=e}convertBytes(e){return new op(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Wm(this.firestore,null,t)}}class tg{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class sg extends Dp{constructor(e,t,s,r,n,i){super(e,t,s,r,i),this._firestore=e,this._firestoreImpl=e,this.metadata=n}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new rg(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(Op("DocumentSnapshot.get",e));if(null!==s)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new dr(cr.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=sg._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t):t}}sg._jsonSchemaVersion="firestore/documentSnapshot/1.0",sg._jsonSchema={type:Vr("string",sg._jsonSchemaVersion),bundleSource:Vr("string","DocumentSnapshot"),bundleName:Vr("string"),bundle:Vr("string")};class rg extends sg{data(e={}){return super.data(e)}}class ng{constructor(e,t,s,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new tg(r.hasPendingWrites,r.fromCache),this.query=s}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(s=>{e.call(t,new rg(this._firestore,this._userDataWriter,s.key,s,new tg(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new dr(cr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(s=>{const r=new rg(e._firestore,e._userDataWriter,s.doc.key,s.doc,new tg(e._snapshot.mutatedKeys.has(s.doc.key),e._snapshot.fromCache),e.query.converter);return s.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let s=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const r=new rg(e._firestore,e._userDataWriter,t.doc.key,t.doc,new tg(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let n=-1,i=-1;return 0!==t.type&&(n=s.indexOf(t.doc.key),s=s.delete(t.doc.key)),1!==t.type&&(s=s.add(t.doc),i=s.indexOf(t.doc.key)),{type:ig(t.type),doc:r,oldIndex:n,newIndex:i}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new dr(cr.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=ng._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=wr.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],s=[],r=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),s.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),r.push(e.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function ig(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ir(61501,{type:e})}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function ag(e){e=Ur(e,Wm);const t=Ur(e.firestore,sp);return function(e,t,s={}){const r=new ur;return e.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return function(e,t,s,r,n){const i=new Am({next:o=>{i.Nu(),t.enqueueAndForget(()=>Kh(e,a));const l=o.docs.has(s);!l&&o.fromCache?n.reject(new dr(cr.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&o.fromCache&&r&&"server"===r.source?n.reject(new dr(cr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):n.resolve(o)},error:e=>n.reject(e)}),a=new Yh(bo(s.path),i,{includeMetadataChanges:!0,qa:!0});return qh(e,a)}(yield Um(e),e.asyncQueue,t,s,r)})),r.promise}(np(t),e._key).then(s=>gg(t,e,s))}ng._jsonSchemaVersion="firestore/querySnapshot/1.0",ng._jsonSchema={type:Vr("string",ng._jsonSchemaVersion),bundleSource:Vr("string","QuerySnapshot"),bundleName:Vr("string"),bundle:Vr("string")};class og extends Xp{constructor(e){super(),this.firestore=e}convertBytes(e){return new op(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Wm(this.firestore,null,t)}}function lg(e){e=Ur(e,Hm);const t=Ur(e.firestore,sp),s=np(t),r=new og(t);return Lp(e._query),function(e,t,s={}){const r=new ur;return e.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return function(e,t,s,r,n){const i=new Am({next:s=>{i.Nu(),t.enqueueAndForget(()=>Kh(e,a)),s.fromCache&&"server"===r.source?n.reject(new dr(cr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):n.resolve(s)},error:e=>n.reject(e)}),a=new Yh(s,i,{includeMetadataChanges:!0,qa:!0});return qh(e,a)}(yield Um(e),e.asyncQueue,t,s,r)})),r.promise}(s,e._query).then(s=>new ng(t,r,e,s))}function cg(e,t,s){e=Ur(e,Wm);const r=Ur(e.firestore,sp),n=Zp(e.converter,t,s);return pg(r,[bp(yp(r),"setDoc",e._key,n,null!==e.converter,s).toMutation(e._key,ll.none())])}function dg(e,t,s,...r){e=Ur(e,Wm);const n=Ur(e.firestore,sp),i=yp(n);let a;return a="string"==typeof(t=ot(t))||t instanceof lp?Np(i,"updateDoc",e._key,t,s,r):wp(i,"updateDoc",e._key,t),pg(n,[a.toMutation(e._key,ll.exists(!0))])}function ug(e){return pg(Ur(e.firestore,sp),[new wl(e._key,ll.none())])}function hg(e,t){const s=Ur(e.firestore,sp),r=Ym(e),n=Zp(e.converter,t);return pg(s,[bp(yp(e.firestore),"addDoc",r._key,n,null!==e.converter,{}).toMutation(r._key,ll.exists(!1))]).then(()=>r)}function mg(e,...t){var s,r,n;e=ot(e);let i={includeMetadataChanges:!1,source:"default"},a=0;"object"!=typeof t[a]||tp(t[a])||(i=t[a++]);const o={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(tp(t[a])){const e=t[a];t[a]=null==(s=e.next)?void 0:s.bind(e),t[a+1]=null==(r=e.error)?void 0:r.bind(e),t[a+2]=null==(n=e.complete)?void 0:n.bind(e)}let l,c,d;if(e instanceof Wm)c=Ur(e.firestore,sp),d=bo(e._key.path),l={next:s=>{t[a]&&t[a](gg(c,e,s))},error:t[a+1],complete:t[a+2]};else{const s=Ur(e,Hm);c=Ur(s.firestore,sp),d=s._query;const r=new og(c);l={next:e=>{t[a]&&t[a](new ng(c,r,s,e))},error:t[a+1],complete:t[a+2]},Lp(e._query)}return function(e,t,s,r){const n=new Am(r),i=new Yh(t,n,s);return e.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return qh(yield Um(e),i)})),()=>{n.Nu(),e.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return Kh(yield Um(e),i)}))}}(np(c),d,o,l)}function pg(e,t){return function(e,t){const s=new ur;return e.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return function(t,s,r){return g(this,null,function*(){const n=Sm(t);try{const e=yield function(e,t){const s=lr(e),r=qr.now(),n=t.reduce((e,t)=>e.add(t.key),$o());let i,a;return s.persistence.runTransaction("Locally write mutations","readwrite",e=>{let o=Ro(),l=$o();return s.Ns.getEntries(e,n).next(e=>{o=e,o.forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>s.localDocuments.getOverlayedDocuments(e,o)).next(n=>{i=n;const a=[];for(const e of t){const t=pl(e,i.get(e.key).overlayedDocument);null!=t&&a.push(new xl(e.key,t,Ma(t.value.mapValue),ll.exists(!0)))}return s.mutationQueue.addMutationBatch(e,r,a,t)}).next(t=>{a=t;const r=t.applyToLocalDocumentSet(i,l);return s.documentOverlayCache.saveOverlays(e,t.batchId,r)})}).then(()=>({batchId:a.batchId,changes:Mo(i)}))}(n.localStore,s);n.sharedClientState.addPendingMutation(e.batchId),function(e,t,s){let r=e.Vu[e.currentUser.toKey()];r||(r=new Fi(Nr)),r=r.insert(t,s),e.Vu[e.currentUser.toKey()]=r}(n,e.batchId,r),yield Nm(n,e.changes),yield kh(n.remoteStore)}catch(e){const s=Mh(e,"Failed to persist write");r.reject(s)}})}(yield function(e){return Fm(e).then(e=>e.syncEngine)}(e),t,s)})),s.promise}(np(e),t)}function gg(e,t,s){const r=s.docs.get(t._key),n=new og(e);return new sg(e,n,t._key,r,new tg(s.hasPendingWrites,s.fromCache),t.converter)}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const fg={maxAttempts:5};function xg(e,t){if((e=ot(e)).firestore!==t)throw new dr(cr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class yg{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=yp(e)}get(e){const t=xg(e,this._firestore),s=new eg(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return ir(24041);const r=e[0];if(r.isFoundDocument())return new Dp(this._firestore,s,r.key,r,t.converter);if(r.isNoDocument())return new Dp(this._firestore,s,t._key,null,t.converter);throw ir(18433,{doc:r})})}set(e,t,s){const r=xg(e,this._firestore),n=Zp(r.converter,t,s),i=bp(this._dataReader,"Transaction.set",r._key,n,null!==r.converter,s);return this._transaction.set(r._key,i),this}update(e,t,s,...r){const n=xg(e,this._firestore);let i;return i="string"==typeof(t=ot(t))||t instanceof lp?Np(this._dataReader,"Transaction.update",n._key,t,s,r):wp(this._dataReader,"Transaction.update",n._key,t),this._transaction.update(n._key,i),this}delete(e){const t=xg(e,this._firestore);return this._transaction.delete(t._key),this}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class bg extends yg{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=xg(e,this._firestore),s=new og(this._firestore);return super.get(e).then(e=>new sg(this._firestore,s,t._key,e._document,new tg(!1,!1),t.converter))}}!function(e,t=!0){Xs=js,ys(new lt("firestore",(e,{instanceIdentifier:s,options:r})=>{const n=e.getProvider("app").getImmediate(),i=new sp(new gr(e.getProvider("auth-internal")),new br(n,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new dr(cr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new aa(e.options.projectId,t)}(n,s),n);return r=d({useFetchStreams:t},r),i._setSettings(r),i},"PUBLIC").setMultipleInstances(!0)),Ss(Js,Qs,e),Ss(Js,Qs,"esm2020")}();const vg=Object.freeze(Object.defineProperty({__proto__:null,AbstractUserDataWriter:Xp,Bytes:op,CollectionReference:Jm,DocumentReference:Wm,DocumentSnapshot:sg,FieldPath:lp,FieldValue:cp,Firestore:sp,FirestoreError:dr,GeoPoint:dp,Query:Hm,QueryCompositeFilterConstraint:zp,QueryConstraint:Fp,QueryDocumentSnapshot:rg,QueryFieldFilterConstraint:Vp,QueryLimitConstraint:Kp,QueryOrderByConstraint:$p,QuerySnapshot:ng,QueryStartAtConstraint:Hp,SnapshotMetadata:tg,Timestamp:qr,Transaction:bg,VectorValue:up,_AutoId:wr,_ByteString:Gi,_DatabaseId:aa,_DocumentKey:Pr,_EmptyAuthCredentialsProvider:mr,_FieldPath:Ar,_cast:Ur,_logWarn:rr,_validateIsNotUsedTogether:Rr,addDoc:hg,collection:Qm,connectFirestoreEmulator:Gm,deleteDoc:ug,doc:Ym,enableIndexedDbPersistence:ap,ensureFirestoreConfigured:np,executeWrite:pg,getDoc:ag,getDocs:lg,getFirestore:rp,limit:Gp,onSnapshot:mg,orderBy:qp,query:Up,runTransaction:function(e,t,s){e=Ur(e,sp);const r=d(d({},fg),s);return function(e){if(e.maxAttempts<1)throw new dr(cr.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(e,t,s){const r=new ur;return e.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){const n=yield function(e){return Fm(e).then(e=>e.datastore)}(e);new Dm(e.asyncQueue,n,s,t,r).ju()})),r.promise}(np(e),s=>t(new bg(e,s)),r)},setDoc:cg,startAfter:Wp,updateDoc:dg,where:Bp},Symbol.toStringTag,{value:"Module"})),wg="firebasestorage.googleapis.com",Ng="storageBucket";
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class jg extends Ye{constructor(e,t,s=0){super(Eg(e),`Firebase Storage: ${t} (${Eg(e)})`),this.status_=s,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,jg.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Eg(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var kg,Ig,Sg,_g;function Eg(e){return"storage/"+e}function Tg(){return new jg(kg.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function Cg(e){return new jg(kg.INVALID_ARGUMENT,e)}function Ag(){return new jg(kg.APP_DELETED,"The Firebase app was deleted.")}function Pg(e,t){return new jg(kg.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function Dg(e){throw new jg(kg.INTERNAL_ERROR,"Internal error: "+e)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(Ig=kg||(kg={})).UNKNOWN="unknown",Ig.OBJECT_NOT_FOUND="object-not-found",Ig.BUCKET_NOT_FOUND="bucket-not-found",Ig.PROJECT_NOT_FOUND="project-not-found",Ig.QUOTA_EXCEEDED="quota-exceeded",Ig.UNAUTHENTICATED="unauthenticated",Ig.UNAUTHORIZED="unauthorized",Ig.UNAUTHORIZED_APP="unauthorized-app",Ig.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",Ig.INVALID_CHECKSUM="invalid-checksum",Ig.CANCELED="canceled",Ig.INVALID_EVENT_NAME="invalid-event-name",Ig.INVALID_URL="invalid-url",Ig.INVALID_DEFAULT_BUCKET="invalid-default-bucket",Ig.NO_DEFAULT_BUCKET="no-default-bucket",Ig.CANNOT_SLICE_BLOB="cannot-slice-blob",Ig.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",Ig.NO_DOWNLOAD_URL="no-download-url",Ig.INVALID_ARGUMENT="invalid-argument",Ig.INVALID_ARGUMENT_COUNT="invalid-argument-count",Ig.APP_DELETED="app-deleted",Ig.INVALID_ROOT_OPERATION="invalid-root-operation",Ig.INVALID_FORMAT="invalid-format",Ig.INTERNAL_ERROR="internal-error",Ig.UNSUPPORTED_ENVIRONMENT="unsupported-environment";class Rg{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let s;try{s=Rg.makeFromUrl(e,t)}catch(n){return new Rg(e,"")}if(""===s.path)return s;throw r=e,new jg(kg.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.");var r}static makeFromUrl(e,t){let s=null;const r="([A-Za-z0-9.\\-_]+)",n=new RegExp("^gs://"+r+"(/(.*))?$","i");function i(e){e.path_=decodeURIComponent(e.path)}const a=t.replace(/[.]/g,"\\."),o=[{regex:n,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${a}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:i},{regex:new RegExp(`^https?://${t===wg?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:i}];for(let l=0;l<o.length;l++){const t=o[l],r=t.regex.exec(e);if(r){const e=r[t.indices.bucket];let n=r[t.indices.path];n||(n=""),s=new Rg(e,n),t.postModify(s);break}}if(null==s)throw function(e){return new jg(kg.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return s}}class Og{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Lg(e){return"string"==typeof e||e instanceof String}function Mg(e){return Fg()&&e instanceof Blob}function Fg(){return"undefined"!=typeof Blob}function Ug(e,t,s,r){if(r<t)throw Cg(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>s)throw Cg(`Invalid value for '${e}'. Expected ${s} or less.`)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Vg(e,t,s){let r=t;return null==s&&(r=`https://${t}`),`${s}://${r}/v0${e}`}function Bg(e){const t=encodeURIComponent;let s="?";for(const r in e)e.hasOwnProperty(r)&&(s=s+(t(r)+"=")+t(e[r])+"&");return s=s.slice(0,-1),s}(_g=Sg||(Sg={}))[_g.NO_ERROR=0]="NO_ERROR",_g[_g.NETWORK_ERROR=1]="NETWORK_ERROR",_g[_g.ABORT=2]="ABORT";
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class zg{constructor(e,t,s,r,n,i,a,o,l,c,d,u=!0,h=!1){this.url_=e,this.method_=t,this.headers_=s,this.body_=r,this.successCodes_=n,this.additionalRetryCodes_=i,this.callback_=a,this.errorCallback_=o,this.timeout_=l,this.progressCallback_=c,this.connectionFactory_=d,this.retry=u,this.isUsingEmulator=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){const e=(e,t)=>{if(t)return void e(!1,new $g(!1,null,!0));const s=this.connectionFactory_();this.pendingConnection_=s;const r=e=>{const t=e.loaded,s=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,s)};null!==this.progressCallback_&&s.addUploadProgressListener(r),s.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&s.removeUploadProgressListener(r),this.pendingConnection_=null;const t=s.getErrorCode()===Sg.NO_ERROR,n=s.getStatus();if(!t||
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function(e,t){const s=e>=500&&e<600,r=-1!==[408,429].indexOf(e),n=-1!==t.indexOf(e);return s||r||n}(n,this.additionalRetryCodes_)&&this.retry){const t=s.getErrorCode()===Sg.ABORT;return void e(!1,new $g(!1,null,t))}const i=-1!==this.successCodes_.indexOf(n);e(!0,new $g(i,s))})},t=(e,t)=>{const s=this.resolve_,r=this.reject_,n=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(n,n.getResponse());void 0!==e?s(e):s()}catch(i){r(i)}else if(null!==n){const e=Tg();e.serverResponse=n.getErrorText(),this.errorCallback_?r(this.errorCallback_(n,e)):r(e)}else t.canceled?r(this.appDelete_?Ag():new jg(kg.CANCELED,"User canceled the upload/download.")):r(new jg(kg.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))};this.canceled_?t(0,new $g(!1,null,!0)):this.backoffId_=function(e,t,s){let r=1,n=null,i=null,a=!1,o=0;function l(){return 2===o}let c=!1;function d(...e){c||(c=!0,t.apply(null,e))}function u(t){n=setTimeout(()=>{n=null,e(m,l())},t)}function h(){i&&clearTimeout(i)}function m(e,...t){if(c)return void h();if(e)return h(),void d.call(null,e,...t);if(l()||a)return h(),void d.call(null,e,...t);let s;r<64&&(r*=2),1===o?(o=2,s=0):s=1e3*(r+Math.random()),u(s)}let p=!1;function g(e){p||(p=!0,h(),c||(null!==n?(e||(o=2),clearTimeout(n),u(0)):e||(o=1)))}return u(0),i=setTimeout(()=>{a=!0,g(!0)},s),g}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class $g{constructor(e,t,s){this.wasSuccessCode=e,this.connection=t,this.canceled=!!s}}function qg(...e){const t="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0;if(void 0!==t){const s=new t;for(let t=0;t<e.length;t++)s.append(e[t]);return s.getBlob()}if(Fg())return new Blob(e);throw new jg(kg.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function Kg(e){if("undefined"==typeof atob)throw t="base-64",new jg(kg.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`);var t;return atob(e)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Gg="raw",Hg="base64",Wg="base64url",Jg="data_url";class Qg{constructor(e,t){this.data=e,this.contentType=t||null}}function Yg(e,t){switch(e){case Gg:return new Qg(Xg(t));case Hg:case Wg:return new Qg(Zg(e,t));case Jg:return new Qg(function(e){const t=new ef(e);return t.base64?Zg(Hg,t.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(s){throw Pg(Jg,"Malformed data URL.")}return Xg(t)}(t.rest)}(t),new ef(t).contentType)}throw Tg()}function Xg(e){const t=[];for(let s=0;s<e.length;s++){let r=e.charCodeAt(s);r<=127?t.push(r):r<=2047?t.push(192|r>>6,128|63&r):55296==(64512&r)?s<e.length-1&&56320==(64512&e.charCodeAt(s+1))?(r=65536|(1023&r)<<10|1023&e.charCodeAt(++s),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)):t.push(239,191,189):56320==(64512&r)?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function Zg(e,t){switch(e){case Hg:{const s=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(s||r)throw Pg(e,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case Wg:{const s=-1!==t.indexOf("+"),r=-1!==t.indexOf("/");if(s||r)throw Pg(e,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let s;try{s=Kg(t)}catch(n){if(n.message.includes("polyfill"))throw n;throw Pg(e,"Invalid character found")}const r=new Uint8Array(s.length);for(let i=0;i<s.length;i++)r[i]=s.charCodeAt(i);return r}class ef{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw Pg(Jg,"Must be formatted 'data:[<mediatype>][;base64],<data>");const s=t[1]||null;var r,n;
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */null!=s&&(this.base64=(n=";base64",(r=s).length>=n.length&&r.substring(r.length-n.length)===n),this.contentType=this.base64?s.substring(0,s.length-7):s),this.rest=e.substring(e.indexOf(",")+1)}}class tf{constructor(e,t){let s=0,r="";Mg(e)?(this.data_=e,s=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),s=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),s=e.length),this.size_=s,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(Mg(this.data_)){const i=this.data_,a=(r=e,n=t,(s=i).webkitSlice?s.webkitSlice(r,n):s.mozSlice?s.mozSlice(r,n):s.slice?s.slice(r,n):null);return null===a?null:new tf(a)}{const s=new Uint8Array(this.data_.buffer,e,t-e);return new tf(s,!0)}var s,r,n}static getBlob(...e){if(Fg()){const t=e.map(e=>e instanceof tf?e.data_:e);return new tf(qg.apply(null,t))}{const t=e.map(e=>Lg(e)?Yg(Gg,e).data:e.data_);let s=0;t.forEach(e=>{s+=e.byteLength});const r=new Uint8Array(s);let n=0;return t.forEach(e=>{for(let t=0;t<e.length;t++)r[n++]=e[t]}),new tf(r,!0)}}uploadData(){return this.data_}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function sf(e){let t;try{t=JSON.parse(e)}catch(r){return null}return"object"!=typeof(s=t)||Array.isArray(s)?null:t;var s}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function rf(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function nf(e,t){return t}class af{constructor(e,t,s,r){this.server=e,this.local=t||e,this.writable=!!s,this.xform=r||nf}}let of=null;function lf(){if(of)return of;const e=[];e.push(new af("bucket")),e.push(new af("generation")),e.push(new af("metageneration")),e.push(new af("name","fullPath",!0));const t=new af("name");t.xform=function(e,t){return function(e){return!Lg(e)||e.length<2?e:rf(e)}(t)},e.push(t);const s=new af("size");return s.xform=function(e,t){return void 0!==t?Number(t):t},e.push(s),e.push(new af("timeCreated")),e.push(new af("updated")),e.push(new af("md5Hash",null,!0)),e.push(new af("cacheControl",null,!0)),e.push(new af("contentDisposition",null,!0)),e.push(new af("contentEncoding",null,!0)),e.push(new af("contentLanguage",null,!0)),e.push(new af("contentType",null,!0)),e.push(new af("metadata","customMetadata",!0)),of=e,of}function cf(e,t,s){const r={type:"file"},n=s.length;for(let i=0;i<n;i++){const e=s[i];r[e.local]=e.xform(r,t[e.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){const s=e.bucket,r=e.fullPath,n=new Rg(s,r);return t._makeStorageReference(n)}})}(r,e),r}function df(e,t,s){const r=sf(t);return null===r?null:cf(e,r,s)}class uf{constructor(e,t,s,r){this.url=e,this.method=t,this.handler=s,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function hf(e){if(!e)throw Tg()}function mf(e,t){return function(s,r){const n=df(e,r,t);return hf(null!==n),function(e,t,s,r){const n=sf(t);if(null===n)return null;if(!Lg(n.downloadTokens))return null;const i=n.downloadTokens;if(0===i.length)return null;const a=encodeURIComponent;return i.split(",").map(t=>{const n=e.bucket,i=e.fullPath;return Vg("/b/"+a(n)+"/o/"+a(i),s,r)+Bg({alt:"media",token:t})})[0]}(n,r,e.host,e._protocol)}}function pf(e){return function(t,s){let r;var n,i;return 401===t.getStatus()?r=t.getErrorText().includes("Firebase App Check token is invalid")?new jg(kg.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new jg(kg.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(i=e.bucket,r=new jg(kg.QUOTA_EXCEEDED,"Quota for bucket '"+i+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(n=e.path,r=new jg(kg.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")):r=s,r.status=t.getStatus(),r.serverResponse=s.serverResponse,r}}function gf(e){const t=pf(e);return function(s,r){let n=t(s,r);var i;return 404===s.getStatus()&&(i=e.path,n=new jg(kg.OBJECT_NOT_FOUND,"Object '"+i+"' does not exist.")),n.serverResponse=r.serverResponse,n}}function ff(e,t,s,r,n){const i=t.bucketOnlyServerUrl(),a={"X-Goog-Upload-Protocol":"multipart"},o=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();a["Content-Type"]="multipart/related; boundary="+o;const l=function(e,t,s){const r=Object.assign({},s);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=function(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}(null,t)),r}(t,r,n),c=function(e,t){const s={},r=t.length;for(let n=0;n<r;n++){const r=t[n];r.writable&&(s[r.server]=e[r.local])}return JSON.stringify(s)}(l,s),d="--"+o+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+c+"\r\n--"+o+"\r\nContent-Type: "+l.contentType+"\r\n\r\n",u="\r\n--"+o+"--",h=tf.getBlob(d,r,u);if(null===h)throw new jg(kg.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.");const m={name:l.fullPath},p=Vg(i,e.host,e._protocol),g=e.maxUploadRetryTime,f=new uf(p,"POST",function(e,t){return function(s,r){const n=df(e,r,t);return hf(null!==n),n}}(e,s),g);return f.urlParams=m,f.headers=a,f.body=h.uploadData(),f.errorHandler=pf(t),f}class xf{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Sg.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Sg.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Sg.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,s,r,n){if(this.sent_)throw Dg("cannot .send() more than once");if(Ve(e)&&s&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==n)for(const i in n)n.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,n[i].toString());return void 0!==r?this.xhr_.send(r):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Dg("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Dg("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw Dg("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Dg("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class yf extends xf{initXhr(){this.xhr_.responseType="text"}}function bf(){return new yf}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class vf{constructor(e,t){this._service=e,this._location=t instanceof Rg?t:Rg.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new vf(e,t)}get root(){const e=new Rg(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return rf(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new Rg(this._location.bucket,e);return new vf(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new jg(kg.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function wf(e){e._throwIfRoot("getDownloadURL");const t=function(e,t,s){const r=Vg(t.fullServerUrl(),e.host,e._protocol),n=e.maxOperationRetryTime,i=new uf(r,"GET",mf(e,s),n);return i.errorHandler=gf(t),i}(e.storage,e._location,lf());return e.storage.makeRequestWithTokens(t,bf).then(e=>{if(null===e)throw new jg(kg.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e})}function Nf(e,t){if(e instanceof If){const s=e;if(null==s._bucket)throw new jg(kg.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+Ng+"' property when initializing the app?");const r=new vf(s,s._bucket);return null!=t?Nf(r,t):r}return void 0!==t?function(e,t){const s=function(e,t){const s=t.split("/").filter(e=>e.length>0).join("/");return 0===e.length?s:e+"/"+s}(e._location.path,t),r=new Rg(e._location.bucket,s);return new vf(e.storage,r)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(e,t):e}function jf(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof If)return new vf(e,t);throw Cg("To use ref(service, url), the first argument must be a Storage instance.")}return Nf(e,t)}function kf(e,t){const s=null==t?void 0:t[Ng];return null==s?null:Rg.makeFromBucketSpec(s,e)}class If{constructor(e,t,s,r,n,i=!1){this.app=e,this._authProvider=t,this._appCheckProvider=s,this._url=r,this._firebaseVersion=n,this._isUsingEmulator=i,this._bucket=null,this._host=wg,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?Rg.makeFromBucketSpec(r,this._host):kf(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=Rg.makeFromBucketSpec(this._url,e):this._bucket=kf(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Ug("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Ug("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}_getAuthToken(){return g(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=yield e.getToken();if(null!==t)return t.accessToken}return null})}_getAppCheckToken(){return g(this,null,function*(){if(vs(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(yield e.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new vf(this,e)}_makeRequest(e,t,s,r,n=!0){if(this._deleted)return new Og(Ag());{const i=function(e,t,s,r,n,i,a=!0,o=!1){const l=Bg(e.urlParams),c=e.url+l,d=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(d,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(d,s),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!=t?t:"AppManager")}(d,i),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(d,r),new zg(c,e.method,d,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,n,a,o)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(e,this._appId,s,r,t,this._firebaseVersion,n,this._isUsingEmulator);return this._requests.add(i),i.getPromise().then(()=>this._requests.delete(i),()=>this._requests.delete(i)),i}}makeRequestWithTokens(e,t){return g(this,null,function*(){const[s,r]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,s,r).getPromise()})}}const Sf="@firebase/storage",_f="0.14.0",Ef="storage";function Tf(e,t,s){return function(e,t,s){e._throwIfRoot("uploadBytes");const r=ff(e.storage,e._location,lf(),new tf(t,!0),s);return e.storage.makeRequestWithTokens(r,bf).then(t=>({metadata:t,ref:e}))}(e=ot(e),t,s)}function Cf(e=Is(),t){const s=bs(e=ot(e),Ef).getImmediate({identifier:t}),r=Le("storage");return r&&function(e,t,s,r={}){!function(e,t,s,r={}){e.host=`${t}:${s}`;const n=Ve(t);n&&(Be(`https://${e.host}/b`),Ke("Storage",!0)),e._isUsingEmulator=!0,e._protocol=n?"https":"http";const{mockUserToken:i}=r;i&&(e._overrideAuthToken="string"==typeof i?i:ze(i,e.app.options.projectId))}(e,t,s,r)}(s,...r),s}function Af(e,{instanceIdentifier:t}){const s=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),n=e.getProvider("app-check-internal");return new If(s,r,n,t,js)}function Pf(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}ys(new lt(Ef,Af,"PUBLIC").setMultipleInstances(!0)),Ss(Sf,_f,""),Ss(Sf,_f,"esm2020");const Df=Pf,Rf=new Xe("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Of=new yt("@firebase/auth");function Lf(e,...t){Of.logLevel<=ht.ERROR&&Of.error(`Auth (${js}): ${e}`,...t)}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Mf(e,...t){throw Bf(e,...t)}function Ff(e,...t){return Bf(e,...t)}function Uf(e,t,s){const r=u(d({},Df()),{[t]:s});return new Xe("auth","Firebase",r).create(t,{appName:e.name})}function Vf(e){return Uf(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Bf(e,...t){if("string"!=typeof e){const s=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(s,...r)}return Rf.create(e,...t)}function zf(e,t,...s){if(!e)throw Bf(t,...s)}function $f(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Lf(t),new Error(t)}function qf(e,t){e||$f(t)}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Kf(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.href)||""}function Gf(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.protocol)||null}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Hf(){return"undefined"==typeof navigator||!navigator||!("onLine"in navigator)||"boolean"!=typeof navigator.onLine||"http:"!==Gf()&&"https:"!==Gf()&&!function(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()&&!("connection"in navigator)||navigator.onLine}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Wf{constructor(e,t){this.shortDelay=e,this.longDelay=t,qf(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ge())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return Hf()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Jf(e,t){qf(e.emulator,"Emulator should always be set here");const{url:s}=e.emulator;return t?`${s}${t.startsWith("/")?t.slice(1):t}`:s}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Qf{static initialize(e,t,s){this.fetchImpl=e,t&&(this.headersImpl=t),s&&(this.responseImpl=s)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void $f("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void $f("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void $f("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Yf={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Xf=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Zf=new Wf(3e4,6e4);
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function ex(e,t){return e.tenantId&&!t.tenantId?u(d({},t),{tenantId:e.tenantId}):t}function tx(e,t,s,r){return g(this,arguments,function*(e,t,s,r,n={}){return sx(e,n,()=>g(this,null,function*(){let n={},i={};r&&("GET"===t?i=r:n={body:JSON.stringify(r)});const a=st(d({key:e.config.apiKey},i)).slice(1),o=yield e._getAdditionalHeaders();o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode);const l=d({method:t,headers:o},n);return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(l.referrerPolicy="no-referrer"),e.emulatorConfig&&Ve(e.emulatorConfig.host)&&(l.credentials="include"),Qf.fetch()(yield nx(e,e.config.apiHost,s,a),l)}))})}function sx(e,t,s){return g(this,null,function*(){e._canInitEmulator=!1;const r=d(d({},Yf),t);try{const t=new ax(e),n=yield Promise.race([s(),t.promise]);t.clearNetworkTimeout();const i=yield n.json();if("needConfirmation"in i)throw ox(e,"account-exists-with-different-credential",i);if(n.ok&&!("errorMessage"in i))return i;{const t=n.ok?i.errorMessage:i.error.message,[s,a]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===s)throw ox(e,"credential-already-in-use",i);if("EMAIL_EXISTS"===s)throw ox(e,"email-already-in-use",i);if("USER_DISABLED"===s)throw ox(e,"user-disabled",i);const o=r[s]||s.toLowerCase().replace(/[_\s]+/g,"-");if(a)throw Uf(e,o,a);Mf(e,o)}}catch(n){if(n instanceof Ye)throw n;Mf(e,"network-request-failed",{message:String(n)})}})}function rx(e,t,s,r){return g(this,arguments,function*(e,t,s,r,n={}){const i=yield tx(e,t,s,r,n);return"mfaPendingCredential"in i&&Mf(e,"multi-factor-auth-required",{_serverResponse:i}),i})}function nx(e,t,s,r){return g(this,null,function*(){const n=`${t}${s}?${r}`,i=e,a=i.config.emulator?Jf(e.config,n):`${e.config.apiScheme}://${n}`;return Xf.includes(s)&&(yield i._persistenceManagerAvailable,"COOKIE"===i._getPersistenceType())?i._getPersistence()._getFinalTarget(a).toString():a})}function ix(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class ax{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(Ff(this.auth,"network-request-failed")),Zf.get())})}}function ox(e,t,s){const r={appName:e.name};s.email&&(r.email=s.email),s.phoneNumber&&(r.phoneNumber=s.phoneNumber);const n=Ff(e,t,r);return n.customData._tokenResponse=s,n}function lx(e){return void 0!==e&&void 0!==e.enterprise}class cx{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return ix(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}function dx(e,t){return g(this,null,function*(){return tx(e,"POST","/v1/accounts:lookup",t)})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function ux(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function hx(e){return 1e3*Number(e)}function mx(e){const[t,s,r]=e.split(".");if(void 0===t||void 0===s||void 0===r)return Lf("JWT malformed, contained fewer than 3 sections"),null;try{const e=Pe(s);return e?JSON.parse(e):(Lf("Failed to decode base64 JWT payload"),null)}catch(n){return Lf("Caught error parsing JWT payload as JSON",null==n?void 0:n.toString()),null}}function px(e){const t=mx(e);return zf(t,"internal-error"),zf(void 0!==t.exp,"internal-error"),zf(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function gx(e,t,s=!1){return g(this,null,function*(){if(s)return t;try{return yield t}catch(r){throw r instanceof Ye&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(r)&&e.auth.currentUser===e&&(yield e.auth.signOut()),r}})}class fx{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!=(t=this.user.stsTokenManager.expirationTime)?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(()=>g(this,null,function*(){yield this.iteration()}),t)}iteration(){return g(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()})}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class xx{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ux(this.lastLoginAt),this.creationTime=ux(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function yx(e){return g(this,null,function*(){var t;const s=e.auth,r=yield e.getIdToken(),n=yield gx(e,dx(s,{idToken:r}));zf(null==n?void 0:n.users.length,s,"internal-error");const i=n.users[0];e._notifyReloadListener(i);const a=(null==(t=i.providerUserInfo)?void 0:t.length)?bx(i.providerUserInfo):[],o=(l=e.providerData,c=a,[...l.filter(e=>!c.some(t=>t.providerId===e.providerId)),...c]);var l,c;const d=e.isAnonymous,u=!(e.email&&i.passwordHash||(null==o?void 0:o.length)),h=!!d&&u,m={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new xx(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(e,m)})}function bx(e){return e.map(e=>{var t=e,{providerId:s}=t,r=h(t,["providerId"]);return{providerId:s,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class vx{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){zf(e.idToken,"internal-error"),zf(void 0!==e.idToken,"internal-error"),zf(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):px(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){zf(0!==e.length,"internal-error");const t=px(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return g(this,null,function*(){return t||!this.accessToken||this.isExpired?(zf(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return g(this,null,function*(){const{accessToken:s,refreshToken:r,expiresIn:n}=yield function(e,t){return g(this,null,function*(){const s=yield sx(e,{},()=>g(this,null,function*(){const s=st({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:n}=e.config,i=yield nx(e,r,"/v1/token",`key=${n}`),a=yield e._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const o={method:"POST",headers:a,body:s};return e.emulatorConfig&&Ve(e.emulatorConfig.host)&&(o.credentials="include"),Qf.fetch()(i,o)}));return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}})}(e,t);this.updateTokensAndExpiration(s,r,Number(n))})}updateTokensAndExpiration(e,t,s){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*s}static fromJSON(e,t){const{refreshToken:s,accessToken:r,expirationTime:n}=t,i=new vx;return s&&(zf("string"==typeof s,"internal-error",{appName:e}),i.refreshToken=s),r&&(zf("string"==typeof r,"internal-error",{appName:e}),i.accessToken=r),n&&(zf("number"==typeof n,"internal-error",{appName:e}),i.expirationTime=n),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new vx,this.toJSON())}_performRefresh(){return $f("not implemented")}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function wx(e,t){zf("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Nx{constructor(e){var t=e,{uid:s,auth:r,stsTokenManager:n}=t,i=h(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new fx(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=s,this.auth=r,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new xx(i.createdAt||void 0,i.lastLoginAt||void 0)}getIdToken(e){return g(this,null,function*(){const t=yield gx(this,this.stsTokenManager.getToken(this.auth,e));return zf(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return function(e,t=!1){return g(this,null,function*(){const s=ot(e),r=yield s.getIdToken(t),n=mx(r);zf(n&&n.exp&&n.auth_time&&n.iat,s.auth,"internal-error");const i="object"==typeof n.firebase?n.firebase:void 0,a=null==i?void 0:i.sign_in_provider;return{claims:n,token:r,authTime:ux(hx(n.auth_time)),issuedAtTime:ux(hx(n.iat)),expirationTime:ux(hx(n.exp)),signInProvider:a||null,signInSecondFactor:(null==i?void 0:i.sign_in_second_factor)||null}})}(this,e)}reload(){return function(e){return g(this,null,function*(){const t=ot(e);yield yx(t),yield t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)})}(this)}_assign(e){this!==e&&(zf(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>d({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Nx(u(d({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){zf(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return g(this,null,function*(){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),t&&(yield yx(this)),yield this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)})}delete(){return g(this,null,function*(){if(vs(this.auth.app))return Promise.reject(Vf(this.auth));const e=yield this.getIdToken();return yield gx(this,
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function(e,t){return g(this,null,function*(){return tx(e,"POST","/v1/accounts:delete",t)})}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return u(d({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>d({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var s,r,n,i,a,o,l,c;const u=null!=(s=t.displayName)?s:void 0,h=null!=(r=t.email)?r:void 0,m=null!=(n=t.phoneNumber)?n:void 0,p=null!=(i=t.photoURL)?i:void 0,g=null!=(a=t.tenantId)?a:void 0,f=null!=(o=t._redirectEventId)?o:void 0,x=null!=(l=t.createdAt)?l:void 0,y=null!=(c=t.lastLoginAt)?c:void 0,{uid:b,emailVerified:v,isAnonymous:w,providerData:N,stsTokenManager:j}=t;zf(b&&j,e,"internal-error");const k=vx.fromJSON(this.name,j);zf("string"==typeof b,e,"internal-error"),wx(u,e.name),wx(h,e.name),zf("boolean"==typeof v,e,"internal-error"),zf("boolean"==typeof w,e,"internal-error"),wx(m,e.name),wx(p,e.name),wx(g,e.name),wx(f,e.name),wx(x,e.name),wx(y,e.name);const I=new Nx({uid:b,auth:e,email:h,emailVerified:v,displayName:u,isAnonymous:w,photoURL:p,phoneNumber:m,tenantId:g,stsTokenManager:k,createdAt:x,lastLoginAt:y});return N&&Array.isArray(N)&&(I.providerData=N.map(e=>d({},e))),f&&(I._redirectEventId=f),I}static _fromIdTokenResponse(e,t,s=!1){return g(this,null,function*(){const r=new vx;r.updateFromServerResponse(t);const n=new Nx({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:s});return yield yx(n),n})}static _fromGetAccountInfoResponse(e,t,s){return g(this,null,function*(){const r=t.users[0];zf(void 0!==r.localId,"internal-error");const n=void 0!==r.providerUserInfo?bx(r.providerUserInfo):[],i=!(r.email&&r.passwordHash||(null==n?void 0:n.length)),a=new vx;a.updateFromIdToken(s);const o=new Nx({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:i}),l={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:n,metadata:new xx(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash||(null==n?void 0:n.length))};return Object.assign(o,l),o})}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const jx=new Map;function kx(e){qf(e instanceof Function,"Expected a class definition");let t=jx.get(e);return t?(qf(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,jx.set(e,t),t)}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ix{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return g(this,null,function*(){return!0})}_set(e,t){return g(this,null,function*(){this.storage[e]=t})}_get(e){return g(this,null,function*(){const t=this.storage[e];return void 0===t?null:t})}_remove(e){return g(this,null,function*(){delete this.storage[e]})}_addListener(e,t){}_removeListener(e,t){}}Ix.type="NONE";const Sx=Ix;
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function _x(e,t,s){return`firebase:${e}:${t}:${s}`}class Ex{constructor(e,t,s){this.persistence=e,this.auth=t,this.userKey=s;const{config:r,name:n}=this.auth;this.fullUserKey=_x(this.userKey,r.apiKey,n),this.fullPersistenceKey=_x("persistence",r.apiKey,n),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return g(this,null,function*(){const e=yield this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){const t=yield dx(this.auth,{idToken:e}).catch(()=>{});return t?Nx._fromGetAccountInfoResponse(this.auth,t,e):null}return Nx._fromJSON(this.auth,e)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return g(this,null,function*(){if(this.persistence===e)return;const t=yield this.getCurrentUser();return yield this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,s="authUser"){return g(this,null,function*(){if(!t.length)return new Ex(kx(Sx),e,s);const r=(yield Promise.all(t.map(e=>g(this,null,function*(){if(yield e._isAvailable())return e})))).filter(e=>e);let n=r[0]||kx(Sx);const i=_x(s,e.config.apiKey,e.name);let a=null;for(const s of t)try{const t=yield s._get(i);if(t){let r;if("string"==typeof t){const s=yield dx(e,{idToken:t}).catch(()=>{});if(!s)break;r=yield Nx._fromGetAccountInfoResponse(e,s,t)}else r=Nx._fromJSON(e,t);s!==n&&(a=r),n=s;break}}catch(l){}const o=r.filter(e=>e._shouldAllowMigration);return n._shouldAllowMigration&&o.length?(n=o[0],a&&(yield n._set(i,a.toJSON())),yield Promise.all(t.map(e=>g(this,null,function*(){if(e!==n)try{yield e._remove(i)}catch(l){}}))),new Ex(n,e,s)):new Ex(n,e,s)})}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Tx(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Dx(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Cx(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Ox(t))return"Blackberry";if(Lx(t))return"Webos";if(Ax(t))return"Safari";if((t.includes("chrome/")||Px(t))&&!t.includes("edge/"))return"Chrome";if(Rx(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=e.match(t);if(2===(null==s?void 0:s.length))return s[1]}return"Other"}function Cx(e=Ge()){return/firefox\//i.test(e)}function Ax(e=Ge()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Px(e=Ge()){return/crios\//i.test(e)}function Dx(e=Ge()){return/iemobile/i.test(e)}function Rx(e=Ge()){return/android/i.test(e)}function Ox(e=Ge()){return/blackberry/i.test(e)}function Lx(e=Ge()){return/webos/i.test(e)}function Mx(e=Ge()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Fx(){return function(){const e=Ge();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()&&10===document.documentMode}function Ux(e=Ge()){return Mx(e)||Rx(e)||Lx(e)||Ox(e)||/windows phone/i.test(e)||Dx(e)}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Vx(e,t=[]){let s;switch(e){case"Browser":s=Tx(Ge());break;case"Worker":s=`${Tx(Ge())}-${e}`;break;default:s=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${s}/JsCore/${js}/${r}`}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Bx{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const s=t=>new Promise((s,r)=>{try{s(e(t))}catch(n){r(n)}});s.onAbort=t,this.queue.push(s);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}runMiddleware(e){return g(this,null,function*(){if(this.auth.currentUser===e)return;const t=[];try{for(const s of this.queue)yield s(e),s.onAbort&&t.push(s.onAbort)}catch(s){t.reverse();for(const e of t)try{e()}catch(r){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==s?void 0:s.message})}})}}
/**
     * @license
     * Copyright 2023 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class zx{constructor(e){var t,s,r,n;const i=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!=(t=i.minPasswordLength)?t:6,i.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=i.maxPasswordLength),void 0!==i.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=i.containsLowercaseCharacter),void 0!==i.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=i.containsUppercaseCharacter),void 0!==i.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=i.containsNumericCharacter),void 0!==i.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=i.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!=(r=null==(s=e.allowedNonAlphanumericCharacters)?void 0:s.join(""))?r:"",this.forceUpgradeOnSignin=null!=(n=e.forceUpgradeOnSignin)&&n,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,s,r,n,i,a;const o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=null==(t=o.meetsMinPasswordLength)||t),o.isValid&&(o.isValid=null==(s=o.meetsMaxPasswordLength)||s),o.isValid&&(o.isValid=null==(r=o.containsLowercaseLetter)||r),o.isValid&&(o.isValid=null==(n=o.containsUppercaseLetter)||n),o.isValid&&(o.isValid=null==(i=o.containsNumericCharacter)||i),o.isValid&&(o.isValid=null==(a=o.containsNonAlphanumericCharacter)||a),o}validatePasswordLengthOptions(e,t){const s=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;s&&(t.meetsMinPasswordLength=e.length>=s),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let s;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)s=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,t,s,r,n){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=n))}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class $x{constructor(e,t,s,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=s,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Kx(this),this.idTokenSubscription=new Kx(this),this.beforeStateQueue=new Bx(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Rf,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=kx(t)),this._initializationPromise=this.queue(()=>g(this,null,function*(){var s,r,n;if(!this._deleted&&(this.persistenceManager=yield Ex.create(this,e),null==(s=this._resolvePersistenceManagerAvailable)||s.call(this),!this._deleted)){if(null==(r=this._popupRedirectResolver)?void 0:r._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch(i){}yield this.initializeCurrentUser(t),this.lastNotifiedUid=(null==(n=this.currentUser)?void 0:n.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return g(this,null,function*(){if(this._deleted)return;const e=yield this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void(yield this.currentUser.getIdToken())):void(yield this._updateCurrentUser(e,!0)):void 0})}initializeCurrentUserFromIdToken(e){return g(this,null,function*(){try{const t=yield dx(this,{idToken:e}),s=yield Nx._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(s)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return g(this,null,function*(){var t;if(vs(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const s=yield this.assertedPersistence.getCurrentUser();let r=s,n=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();const s=null==(t=this.redirectUser)?void 0:t._redirectEventId,i=null==r?void 0:r._redirectEventId,a=yield this.tryRedirectSignIn(e);s&&s!==i||!(null==a?void 0:a.user)||(r=a.user,n=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(n)try{yield this.beforeStateQueue.runMiddleware(r)}catch(i){r=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(i))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return zf(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)})}tryRedirectSignIn(e){return g(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(s){yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return g(this,null,function*(){try{yield yx(e)}catch(t){if("auth/network-request-failed"!==(null==t?void 0:t.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}_delete(){return g(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return g(this,null,function*(){if(vs(this.app))return Promise.reject(Vf(this));const t=e?ot(e):null;return t&&zf(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return g(this,null,function*(){if(!this._deleted)return e&&zf(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>g(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return g(this,null,function*(){return vs(this.app)?Promise.reject(Vf(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return vs(this.app)?Promise.reject(Vf(this)):this.queue(()=>g(this,null,function*(){yield this.assertedPersistence.setPersistence(kx(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return g(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return g(this,null,function*(){const e=yield function(e){return g(this,arguments,function*(e,t={}){return tx(e,"GET","/v2/passwordPolicy",ex(e,t))})}
/**
     * @license
     * Copyright 2023 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(this),t=new zx(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Xe("auth","Firebase",e())}onAuthStateChanged(e,t,s){return this.registerStateListener(this.authStateSubscription,e,t,s)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,s){return this.registerStateListener(this.idTokenSubscription,e,t,s)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},t)}})}revokeAccessToken(e){return g(this,null,function*(){if(this.currentUser){const t=yield this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};null!=this.tenantId&&(s.tenantId=this.tenantId),yield function(e,t){return g(this,null,function*(){return tx(e,"POST","/v2/accounts:revokeToken",ex(e,t))})}(this,s)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null==(e=this._currentUser)?void 0:e.toJSON()}}_setRedirectUser(e,t){return g(this,null,function*(){const s=yield this.getOrInitRedirectPersistenceManager(t);return null===e?s.removeCurrentUser():s.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return g(this,null,function*(){if(!this.redirectPersistenceManager){const t=e&&kx(e)||this._popupRedirectResolver;zf(t,this,"argument-error"),this.redirectPersistenceManager=yield Ex.create(this,[kx(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return g(this,null,function*(){var t,s;return this._isInitialized&&(yield this.queue(()=>g(this,null,function*(){}))),(null==(t=this._currentUser)?void 0:t._redirectEventId)===e?this._currentUser:(null==(s=this.redirectUser)?void 0:s._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return g(this,null,function*(){if(e===this.currentUser)return this.queue(()=>g(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const s=null!=(t=null==(e=this.currentUser)?void 0:e.uid)?t:null;this.lastNotifiedUid!==s&&(this.lastNotifiedUid=s,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,s,r){if(this._deleted)return()=>{};const n="function"==typeof t?t:t.next.bind(t);let i=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(zf(a,this,"internal-error"),a.then(()=>{i||n(this.currentUser)}),"function"==typeof t){const n=e.addObserver(t,s,r);return()=>{i=!0,n()}}{const s=e.addObserver(t);return()=>{i=!0,s()}}}directlySetCurrentUser(e){return g(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return zf(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Vx(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return g(this,null,function*(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const s=yield null==(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))?void 0:e.getHeartbeatsHeader();s&&(t["X-Firebase-Client"]=s);const r=yield this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t})}_getAppCheckToken(){return g(this,null,function*(){var e;if(vs(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=yield null==(e=this.appCheckServiceProvider.getImmediate({optional:!0}))?void 0:e.getToken();return(null==t?void 0:t.error)&&function(e,...t){Of.logLevel<=ht.WARN&&Of.warn(`Auth (${js}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token})}}function qx(e){return ot(e)}class Kx{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const s=new it(e,t);return s.subscribe.bind(s)}(e=>this.observer=e)}get next(){return zf(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */let Gx={loadJS(){return g(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Hx(e){return Gx.loadJS(e)}class Wx{constructor(){this.enterprise=new Jx}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class Jx{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const Qx="NO_RECAPTCHA";class Yx{constructor(e){this.type="recaptcha-enterprise",this.auth=qx(e)}verify(e="verify",t=!1){return g(this,null,function*(){function s(e){return g(this,null,function*(){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((t,s)=>g(this,null,function*(){(function(e,t){return g(this,null,function*(){return tx(e,"GET","/v2/recaptchaConfig",ex(e,t))})})(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(r=>{if(void 0!==r.recaptchaKey){const s=new cx(r);return null==e.tenantId?e._agentRecaptchaConfig=s:e._tenantRecaptchaConfigs[e.tenantId]=s,t(s.siteKey)}s(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{s(e)})}))})}function r(t,s,r){const n=window.grecaptcha;lx(n)?n.enterprise.ready(()=>{n.enterprise.execute(t,{action:e}).then(e=>{s(e)}).catch(()=>{s(Qx)})}):r(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?(new Wx).execute("siteKey",{action:"verify"}):new Promise((e,n)=>{s(this.auth).then(s=>{if(!t&&lx(window.grecaptcha))r(s,e,n);else{if("undefined"==typeof window)return void n(new Error("RecaptchaVerifier is only supported in browser"));let t=Gx.recaptchaEnterpriseScript;0!==t.length&&(t+=s),Hx(t).then(()=>{r(s,e,n)}).catch(e=>{n(e)})}}).catch(e=>{n(e)})})})}}function Xx(e,t,s,r=!1,n=!1){return g(this,null,function*(){const i=new Yx(e);let a;if(n)a=Qx;else try{a=yield i.verify(s)}catch(l){a=yield i.verify(s,!0)}const o=d({},t);if("mfaSmsEnrollment"===s||"mfaSmsSignIn"===s){if("phoneEnrollmentInfo"in o){const e=o.phoneEnrollmentInfo.phoneNumber,t=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){const e=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return r?Object.assign(o,{captchaResp:a}):Object.assign(o,{captchaResponse:a}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o})}function Zx(e,t,s,r,n){return g(this,null,function*(){var n;if(null==(n=e._getRecaptchaConfig())?void 0:n.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const n=yield Xx(e,t,s,"getOobCode"===s);return r(e,n)}return r(e,t).catch(n=>g(this,null,function*(){if("auth/missing-recaptcha-token"===n.code){console.log(`${s} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const n=yield Xx(e,t,s,"getOobCode"===s);return r(e,n)}return Promise.reject(n)}))})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function ey(e,t,s){const r=qx(e);zf(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const n=ty(t),{host:i,port:a}=function(e){const t=ty(e),s=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!s)return{host:"",port:null};const r=s[2].split("@").pop()||"",n=/^(\[[^\]]+\])(:|$)/.exec(r);if(n){const e=n[1];return{host:e,port:sy(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:sy(t)}}}(t),o=null===a?"":`:${a}`,l={url:`${n}//${i}${o}/`},c=Object.freeze({host:i,port:a,protocol:n.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!r._canInitEmulator)return zf(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),void zf(et(l,r.config.emulator)&&et(c,r.emulatorConfig),r,"emulator-config-failed");r.config.emulator=l,r.emulatorConfig=c,r.settings.appVerificationDisabledForTesting=!0,Ve(i)?(Be(`${n}//${i}${o}`),Ke("Auth",!0)):function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */()}function ty(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function sy(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class ry{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return $f("not implemented")}_getIdTokenResponse(e){return $f("not implemented")}_linkToIdToken(e,t){return $f("not implemented")}_getReauthenticationResolver(e){return $f("not implemented")}}function ny(e,t){return g(this,null,function*(){return tx(e,"POST","/v1/accounts:signUp",t)})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function iy(e,t){return g(this,null,function*(){return rx(e,"POST","/v1/accounts:signInWithPassword",ex(e,t))})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class ay extends ry{constructor(e,t,s,r=null){super("password",s),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new ay(e,t,"password")}static _fromEmailAndCode(e,t,s=null){return new ay(e,t,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){return g(this,null,function*(){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Zx(e,t,"signInWithPassword",iy);case"emailLink":return function(e,t){return g(this,null,function*(){return rx(e,"POST","/v1/accounts:signInWithEmailLink",ex(e,t))})}(e,{email:this._email,oobCode:this._password});default:Mf(e,"internal-error")}})}_linkToIdToken(e,t){return g(this,null,function*(){switch(this.signInMethod){case"password":const s={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Zx(e,s,"signUpPassword",ny);case"emailLink":return function(e,t){return g(this,null,function*(){return rx(e,"POST","/v1/accounts:signInWithEmailLink",ex(e,t))})}(e,{idToken:t,email:this._email,oobCode:this._password});default:Mf(e,"internal-error")}})}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function oy(e,t){return g(this,null,function*(){return rx(e,"POST","/v1/accounts:signInWithIdp",ex(e,t))})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class ly extends ry{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ly(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Mf("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:s,signInMethod:r}=t,n=h(t,["providerId","signInMethod"]);if(!s||!r)return null;const i=new ly(s,r);return i.idToken=n.idToken||void 0,i.accessToken=n.accessToken||void 0,i.secret=n.secret,i.nonce=n.nonce,i.pendingToken=n.pendingToken||null,i}_getIdTokenResponse(e){return oy(e,this.buildRequest())}_linkToIdToken(e,t){const s=this.buildRequest();return s.idToken=t,oy(e,s)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,oy(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=st(t)}return e}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class cy{constructor(e){var t,s,r,n,i,a;const o=rt(nt(e)),l=null!=(t=o.apiKey)?t:null,c=null!=(s=o.oobCode)?s:null,d=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!=(r=o.mode)?r:null);zf(l&&c&&d,"argument-error"),this.apiKey=l,this.operation=d,this.code=c,this.continueUrl=null!=(n=o.continueUrl)?n:null,this.languageCode=null!=(i=o.lang)?i:null,this.tenantId=null!=(a=o.tenantId)?a:null}static parseLink(e){const t=function(e){const t=rt(nt(e)).link,s=t?rt(nt(t)).deep_link_id:null,r=rt(nt(e)).deep_link_id;return(r?rt(nt(r)).link:null)||r||s||t||e}(e);try{return new cy(t)}catch(s){return null}}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class dy{constructor(){this.providerId=dy.PROVIDER_ID}static credential(e,t){return ay._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const s=cy.parseLink(t);return zf(s,"argument-error"),ay._fromEmailAndCode(e,s.code,s.tenantId)}}dy.PROVIDER_ID="password",dy.EMAIL_PASSWORD_SIGN_IN_METHOD="password",dy.EMAIL_LINK_SIGN_IN_METHOD="emailLink";
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class uy{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class hy extends uy{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class my extends hy{constructor(){super("facebook.com")}static credential(e){return ly._fromParams({providerId:my.PROVIDER_ID,signInMethod:my.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return my.credentialFromTaggedObject(e)}static credentialFromError(e){return my.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return my.credential(e.oauthAccessToken)}catch(t){return null}}}my.FACEBOOK_SIGN_IN_METHOD="facebook.com",my.PROVIDER_ID="facebook.com";
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class py extends hy{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ly._fromParams({providerId:py.PROVIDER_ID,signInMethod:py.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return py.credentialFromTaggedObject(e)}static credentialFromError(e){return py.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:s}=e;if(!t&&!s)return null;try{return py.credential(t,s)}catch(r){return null}}}py.GOOGLE_SIGN_IN_METHOD="google.com",py.PROVIDER_ID="google.com";
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class gy extends hy{constructor(){super("github.com")}static credential(e){return ly._fromParams({providerId:gy.PROVIDER_ID,signInMethod:gy.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return gy.credentialFromTaggedObject(e)}static credentialFromError(e){return gy.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return gy.credential(e.oauthAccessToken)}catch(t){return null}}}gy.GITHUB_SIGN_IN_METHOD="github.com",gy.PROVIDER_ID="github.com";
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class fy extends hy{constructor(){super("twitter.com")}static credential(e,t){return ly._fromParams({providerId:fy.PROVIDER_ID,signInMethod:fy.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return fy.credentialFromTaggedObject(e)}static credentialFromError(e){return fy.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:s}=e;if(!t||!s)return null;try{return fy.credential(t,s)}catch(r){return null}}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function xy(e,t){return g(this,null,function*(){return rx(e,"POST","/v1/accounts:signUp",ex(e,t))})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */fy.TWITTER_SIGN_IN_METHOD="twitter.com",fy.PROVIDER_ID="twitter.com";class yy{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,s,r=!1){return g(this,null,function*(){const n=yield Nx._fromIdTokenResponse(e,s,r),i=by(s);return new yy({user:n,providerId:i,_tokenResponse:s,operationType:t})})}static _forOperation(e,t,s){return g(this,null,function*(){yield e._updateTokensIfNecessary(s,!0);const r=by(s);return new yy({user:e,providerId:r,_tokenResponse:s,operationType:t})})}}function by(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class vy extends Ye{constructor(e,t,s,r){var n;super(t.code,t.message),this.operationType=s,this.user=r,Object.setPrototypeOf(this,vy.prototype),this.customData={appName:e.name,tenantId:null!=(n=e.tenantId)?n:void 0,_serverResponse:t.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,t,s,r){return new vy(e,t,s,r)}}function wy(e,t,s,r){return("reauthenticate"===t?s._getReauthenticationResolver(e):s._getIdTokenResponse(e)).catch(s=>{if("auth/multi-factor-auth-required"===s.code)throw vy._fromErrorAndOperation(e,s,t,r);throw s})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function Ny(e,t,s=!1){return g(this,null,function*(){if(vs(e.app))return Promise.reject(Vf(e));const r="signIn",n=yield wy(e,r,t),i=yield yy._fromIdTokenResponse(e,r,n);return s||(yield e._updateCurrentUser(i.user)),i})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function jy(e){return g(this,null,function*(){const t=qx(e);t._getPasswordPolicyInternal()&&(yield t._updatePasswordPolicy())})}function ky(e,t,s){return vs(e.app)?Promise.reject(Vf(e)):function(e,t){return g(this,null,function*(){return Ny(qx(e),t)})}(ot(e),dy.credential(t,s)).catch(t=>g(this,null,function*(){throw"auth/password-does-not-meet-requirements"===t.code&&jy(e),t}))}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function Iy(e,t){return g(this,arguments,function*(e,{displayName:t,photoURL:s}){if(void 0===t&&void 0===s)return;const r=ot(e),n={idToken:yield r.getIdToken(),displayName:t,photoUrl:s,returnSecureToken:!0},i=yield gx(r,function(e,t){return g(this,null,function*(){return tx(e,"POST","/v1/accounts:update",t)})}(r.auth,n));r.displayName=i.displayName||null,r.photoURL=i.photoUrl||null;const a=r.providerData.find(({providerId:e})=>"password"===e);a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),yield r._updateTokensIfNecessary(i)})}const Sy="__sak";
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class _y{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Sy,"1"),this.storage.removeItem(Sy),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ey extends _y{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Ux(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const s=this.storage.getItem(t),r=this.localCache[t];s!==r&&e(t,r,s)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,s)=>{this.notifyListeners(e,s)});const s=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const e=this.storage.getItem(s);(t||this.localCache[s]!==e)&&this.notifyListeners(s,e)},n=this.storage.getItem(s);Fx()&&n!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:s}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(e,t){return g(this,null,function*(){yield p(Ey.prototype,this,"_set").call(this,e,t),this.localCache[e]=JSON.stringify(t)})}_get(e){return g(this,null,function*(){const t=yield p(Ey.prototype,this,"_get").call(this,e);return this.localCache[e]=JSON.stringify(t),t})}_remove(e){return g(this,null,function*(){yield p(Ey.prototype,this,"_remove").call(this,e),delete this.localCache[e]})}}Ey.type="LOCAL";const Ty=Ey;
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Cy extends _y{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Cy.type="SESSION";const Ay=Cy;
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Py{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const s=new Py(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}handleEvent(e){return g(this,null,function*(){const t=e,{eventId:s,eventType:r,data:n}=t.data,i=this.handlersMap[r];if(!(null==i?void 0:i.size))return;t.ports[0].postMessage({status:"ack",eventId:s,eventType:r});const a=Array.from(i).map(e=>g(this,null,function*(){return e(t.origin,n)})),o=yield function(e){return Promise.all(e.map(e=>g(this,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}(a);t.ports[0].postMessage({status:"done",eventId:s,eventType:r,response:o})})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function Dy(e="",t=10){let s="";for(let r=0;r<t;r++)s+=Math.floor(10*Math.random());return e+s}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */Py.receivers=[];class Ry{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,s=50){return g(this,null,function*(){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let n,i;return new Promise((a,o)=>{const l=Dy("",20);r.port1.start();const c=setTimeout(()=>{o(new Error("unsupported_event"))},s);i={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===l)switch(t.data.status){case"ack":clearTimeout(c),n=setTimeout(()=>{o(new Error("timeout"))},3e3);break;case"done":clearTimeout(n),a(t.data.response);break;default:clearTimeout(c),clearTimeout(n),o(new Error("invalid_response"))}}},this.handlers.add(i),r.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[r.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})})}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Oy(){return window}
/**
     * @license
     * Copyright 2020 Google LLC.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function Ly(){return void 0!==Oy().WorkerGlobalScope&&"function"==typeof Oy().importScripts}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const My="firebaseLocalStorageDb",Fy="firebaseLocalStorage",Uy="fbase_key";class Vy{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function By(e,t){return e.transaction([Fy],t?"readwrite":"readonly").objectStore(Fy)}function zy(){const e=indexedDB.open(My,1);return new Promise((t,s)=>{e.addEventListener("error",()=>{s(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(Fy,{keyPath:Uy})}catch(r){s(r)}}),e.addEventListener("success",()=>g(this,null,function*(){const s=e.result;s.objectStoreNames.contains(Fy)?t(s):(s.close(),yield function(){const e=indexedDB.deleteDatabase(My);return new Vy(e).toPromise()}(),t(yield zy()))}))})}function $y(e,t,s){return g(this,null,function*(){const r=By(e,!0).put({[Uy]:t,value:s});return new Vy(r).toPromise()})}function qy(e,t){const s=By(e,!0).delete(t);return new Vy(s).toPromise()}class Ky{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return g(this,null,function*(){return this.db||(this.db=yield zy()),this.db})}_withRetries(e){return g(this,null,function*(){let t=0;for(;;)try{const t=yield this._openDb();return yield e(t)}catch(s){if(t++>3)throw s;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return g(this,null,function*(){return Ly()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return g(this,null,function*(){this.receiver=Py._getInstance(Ly()?self:null),this.receiver._subscribe("keyChanged",(e,t)=>g(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(t.key)}})),this.receiver._subscribe("ping",(e,t)=>g(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return g(this,null,function*(){var e,t;if(this.activeServiceWorker=yield function(){return g(this,null,function*(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(yield navigator.serviceWorker.ready).active}catch(e){return null}})}(),!this.activeServiceWorker)return;this.sender=new Ry(this.activeServiceWorker);const s=yield this.sender._send("ping",{},800);s&&(null==(e=s[0])?void 0:e.fulfilled)&&(null==(t=s[0])?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(e){return g(this,null,function*(){var t;if(this.sender&&this.activeServiceWorker&&((null==(t=null==navigator?void 0:navigator.serviceWorker)?void 0:t.controller)||null)===this.activeServiceWorker)try{yield this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(s){}})}_isAvailable(){return g(this,null,function*(){try{if(!indexedDB)return!1;const e=yield zy();return yield $y(e,Sy,"1"),yield qy(e,Sy),!0}catch(e){}return!1})}_withPendingWrite(e){return g(this,null,function*(){this.pendingWrites++;try{yield e()}finally{this.pendingWrites--}})}_set(e,t){return g(this,null,function*(){return this._withPendingWrite(()=>g(this,null,function*(){return yield this._withRetries(s=>$y(s,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)}))})}_get(e){return g(this,null,function*(){const t=yield this._withRetries(t=>function(e,t){return g(this,null,function*(){const s=By(e,!1).get(t),r=yield new Vy(s).toPromise();return void 0===r?null:r.value})}(t,e));return this.localCache[e]=t,t})}_remove(e){return g(this,null,function*(){return this._withPendingWrite(()=>g(this,null,function*(){return yield this._withRetries(t=>qy(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)}))})}_poll(){return g(this,null,function*(){const e=yield this._withRetries(e=>{const t=By(e,!1).getAll();return new Vy(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],s=new Set;if(0!==e.length)for(const{fbase_key:r,value:n}of e)s.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(n)&&(this.notifyListeners(r,n),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!s.has(r)&&(this.notifyListeners(r,null),t.push(r));return t})}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>g(this,null,function*(){return this._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Ky.type="LOCAL";const Gy=Ky;new Wf(3e4,6e4);
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Hy extends ry{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return oy(e,this._buildIdpRequest())}_linkToIdToken(e,t){return oy(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return oy(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Wy(e){return Ny(e.auth,new Hy(e),e.bypassAuthState)}function Jy(e){const{auth:t,user:s}=e;return zf(s,t,"internal-error"),
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function(e,t,s=!1){return g(this,null,function*(){const{auth:r}=e;if(vs(r.app))return Promise.reject(Vf(r));const n="reauthenticate";try{const i=yield gx(e,wy(r,n,t,e),s);zf(i.idToken,r,"internal-error");const a=mx(i.idToken);zf(a,r,"internal-error");const{sub:o}=a;return zf(e.uid===o,r,"user-mismatch"),yy._forOperation(e,n,i)}catch(i){throw"auth/user-not-found"===(null==i?void 0:i.code)&&Mf(r,"user-mismatch"),i}})}(s,new Hy(e),e.bypassAuthState)}function Qy(e){return g(this,null,function*(){const{auth:t,user:s}=e;return zf(s,t,"internal-error"),function(e,t,s=!1){return g(this,null,function*(){const r=yield gx(e,t._linkToIdToken(e.auth,yield e.getIdToken()),s);return yy._forOperation(e,"link",r)})}(s,new Hy(e),e.bypassAuthState)})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Yy{constructor(e,t,s,r,n=!1){this.auth=e,this.resolver=s,this.user=r,this.bypassAuthState=n,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>g(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}}))}onAuthEvent(e){return g(this,null,function*(){const{urlResponse:t,sessionId:s,postBody:r,tenantId:n,error:i,type:a}=e;if(i)return void this.reject(i);const o={auth:this.auth,requestUri:t,sessionId:s,tenantId:n||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(a)(o))}catch(l){this.reject(l)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Wy;case"linkViaPopup":case"linkViaRedirect":return Qy;case"reauthViaPopup":case"reauthViaRedirect":return Jy;default:Mf(this.auth,"internal-error")}}resolve(e){qf(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){qf(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Xy=new Wf(2e3,1e4);class Zy extends Yy{constructor(e,t,s,r,n){super(e,t,r,n),this.provider=s,this.authWindow=null,this.pollId=null,Zy.currentPopupAction&&Zy.currentPopupAction.cancel(),Zy.currentPopupAction=this}executeNotNull(){return g(this,null,function*(){const e=yield this.execute();return zf(e,this.auth,"internal-error"),e})}onExecution(){return g(this,null,function*(){qf(1===this.filter.length,"Popup operations only handle one event");const e=Dy();this.authWindow=yield this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(Ff(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()})}get eventId(){var e;return(null==(e=this.authWindow)?void 0:e.associatedEvent)||null}cancel(){this.reject(Ff(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Zy.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,s;(null==(s=null==(t=this.authWindow)?void 0:t.window)?void 0:s.closed)?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ff(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,Xy.get())};e()}}Zy.currentPopupAction=null;
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const eb="pendingRedirect",tb=new Map;class sb extends Yy{constructor(e,t,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,s),this.eventId=null}execute(){return g(this,null,function*(){let e=tb.get(this.auth._key());if(!e){try{const t=(yield function(e,t){return g(this,null,function*(){const s=function(e){return _x(eb,e.config.apiKey,e.name)}(t),r=function(e){return kx(e._redirectPersistence)}(e);if(!(yield r._isAvailable()))return!1;const n="true"===(yield r._get(s));return yield r._remove(s),n})}(this.resolver,this.auth))?yield p(sb.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}tb.set(this.auth._key(),e)}return this.bypassAuthState||tb.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return g(this,null,function*(){if("signInViaRedirect"===e.type)return p(sb.prototype,this,"onAuthEvent").call(this,e);if("unknown"!==e.type){if(e.eventId){const t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,p(sb.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}}else this.resolve(null)})}onExecution(){return g(this,null,function*(){})}cleanUp(){}}function rb(e,t){tb.set(e._key(),t)}function nb(e,t,s=!1){return g(this,null,function*(){if(vs(e.app))return Promise.reject(Vf(e));const r=qx(e),n=
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function(e,t){return t?kx(t):(zf(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}(r,t),i=new sb(r,n,s),a=yield i.execute();return a&&!s&&(delete a.user._redirectEventId,yield r._persistUserIfCurrent(a.user),yield r._setRedirectUser(null,t)),a})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class ib{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(t=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ob(e);default:return!1}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var s;if(e.error&&!ob(e)){const r=(null==(s=e.error.code)?void 0:s.split("auth/")[1])||"internal-error";t.onError(Ff(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const s=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(ab(e))}saveEventToCache(e){this.cachedEventUids.add(ab(e)),this.lastProcessedEventTime=Date.now()}}function ab(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function ob({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const lb=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,cb=/^https?/;function db(e){return g(this,null,function*(){if(e.config.emulator)return;const{authorizedDomains:t}=yield function(e){return g(this,arguments,function*(e,t={}){return tx(e,"GET","/v1/projects",t)})}(e);for(const e of t)try{if(ub(e))return}catch(s){}Mf(e,"unauthorized-domain")})}function ub(e){const t=Kf(),{protocol:s,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const n=new URL(e);return""===n.hostname&&""===r?"chrome-extension:"===s&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===s&&n.hostname===r}if(!cb.test(s))return!1;if(lb.test(e))return r===e;const n=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+n+"|"+n+")$","i").test(r)}
/**
     * @license
     * Copyright 2020 Google LLC.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const hb=new Wf(3e4,6e4);function mb(){const e=Oy().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let s=0;s<e.CP.length;s++)e.CP[s]=null}function pb(e){return new Promise((t,s)=>{var r,n,i;function a(){mb(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{mb(),s(Ff(e,"network-request-failed"))},timeout:hb.get()})}if(null==(n=null==(r=Oy().gapi)?void 0:r.iframes)?void 0:n.Iframe)t(gapi.iframes.getContext());else{if(!(null==(i=Oy().gapi)?void 0:i.load)){const t=`__iframefcb${Math.floor(1e6*Math.random())}`;return Oy()[t]=()=>{gapi.load?a():s(Ff(e,"network-request-failed"))},Hx(`${Gx.gapiScript}?onload=${t}`).catch(e=>s(e))}a()}}).catch(e=>{throw gb=null,e})}let gb=null;
/**
     * @license
     * Copyright 2020 Google LLC.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const fb=new Wf(5e3,15e3),xb={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},yb=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function bb(e){const t=e.config;zf(t.authDomain,e,"auth-domain-config-required");const s=t.emulator?Jf(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:js},n=yb.get(e.config.apiHost);n&&(r.eid=n);const i=e._getFrameworks();return i.length&&(r.fw=i.join(",")),`${s}?${st(r).slice(1)}`}function vb(e){return g(this,null,function*(){const t=yield function(e){return gb=gb||pb(e),gb}(e),s=Oy().gapi;return zf(s,e,"internal-error"),t.open({where:document.body,url:bb(e),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:xb,dontclear:!0},t=>new Promise((s,r)=>g(this,null,function*(){yield t.restyle({setHideOnLeave:!1});const n=Ff(e,"network-request-failed"),i=Oy().setTimeout(()=>{r(n)},fb.get());function a(){Oy().clearTimeout(i),s(t)}t.ping(a).then(a,()=>{r(n)})})))})}
/**
     * @license
     * Copyright 2020 Google LLC.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const wb={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Nb{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function jb(e,t,s,r=500,n=600){const i=Math.max((window.screen.availHeight-n)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let o="";const l=u(d({},wb),{width:r.toString(),height:n.toString(),top:i,left:a}),c=Ge().toLowerCase();s&&(o=Px(c)?"_blank":s),Cx(c)&&(t=t||"http://localhost",l.scrollbars="yes");const h=Object.entries(l).reduce((e,[t,s])=>`${e}${t}=${s},`,"");if(function(e=Ge()){var t;return Mx(e)&&!!(null==(t=window.navigator)?void 0:t.standalone)}(c)&&"_self"!==o)return function(e,t){const s=document.createElement("a");s.href=e,s.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(r)}
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(t||"",o),new Nb(null);const m=window.open(t||"",o,h);zf(m,e,"popup-blocked");try{m.focus()}catch(p){}return new Nb(m)}const kb="__/auth/handler",Ib="emulator/auth/handler",Sb=encodeURIComponent("fac");function _b(e,t,s,r,n,i){return g(this,null,function*(){zf(e.config.authDomain,e,"auth-domain-config-required"),zf(e.config.apiKey,e,"invalid-api-key");const i={apiKey:e.config.apiKey,appName:e.name,authType:s,redirectUrl:r,v:js,eventId:n};if(t instanceof uy){t.setDefaultLanguage(e.languageCode),i.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(i.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries({}))i[e]=t}if(t instanceof hy){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(i.scopes=e.join(","))}e.tenantId&&(i.tid=e.tenantId);const a=i;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];const o=yield e._getAppCheckToken(),l=o?`#${Sb}=${encodeURIComponent(o)}`:"";return`${function({config:e}){return e.emulator?Jf(e,Ib):`https://${e.authDomain}/${kb}`}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(e)}?${st(a).slice(1)}${l}`})}const Eb="webStorageSupport",Tb=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Ay,this._completeRedirectFn=nb,this._overrideRedirectResult=rb}_openPopup(e,t,s,r){return g(this,null,function*(){var n;qf(null==(n=this.eventManagers[e._key()])?void 0:n.manager,"_initialize() not called before _openPopup()");const i=yield _b(e,t,s,Kf(),r);return jb(e,i,Dy())})}_openRedirect(e,t,s,r){return g(this,null,function*(){return yield this._originValidation(e),function(e){Oy().location.href=e}(yield _b(e,t,s,Kf(),r)),new Promise(()=>{})})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:s}=this.eventManagers[t];return e?Promise.resolve(e):(qf(s,"If manager is not set, promise should be"),s)}const s=this.initAndGetManager(e);return this.eventManagers[t]={promise:s},s.catch(()=>{delete this.eventManagers[t]}),s}initAndGetManager(e){return g(this,null,function*(){const t=yield vb(e),s=new ib(e);return t.register("authEvent",t=>(zf(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:s.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=t,s})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Eb,{type:Eb},s=>{var r;const n=null==(r=null==s?void 0:s[0])?void 0:r[Eb];void 0!==n&&t(!!n),Mf(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=db(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Ux()||Ax()||Mx()}};var Cb="@firebase/auth",Ab="1.11.0";
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Pb{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null==(e=this.auth.currentUser)?void 0:e.uid)||null}getToken(e){return g(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){zf(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const Db=Fe("authIdTokenMaxAge")||300;let Rb=null;function Ob(t=Is()){const s=bs(t,"auth");if(s.isInitialized())return s.getImmediate();const r=function(e,t){const s=bs(e,"auth");if(s.isInitialized()){const e=s.getImmediate();if(et(s.getOptions(),null!=t?t:{}))return e;Mf(e,"already-initialized")}return s.initialize({options:t})}(t,{popupRedirectResolver:Tb,persistence:[Gy,Ty,Ay]}),n=Fe("authTokenSyncURL");if(n&&"boolean"==typeof isSecureContext&&isSecureContext){const t=new URL(n,location.origin);if(location.origin===t.origin){const s=(i=t.toString(),t=>g(e,null,function*(){const e=t&&(yield t.getIdTokenResult()),s=e&&((new Date).getTime()-Date.parse(e.issuedAtTime))/1e3;if(s&&s>Db)return;const r=null==e?void 0:e.token;Rb!==r&&(Rb=r,yield fetch(i,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))}));!function(e,t,s){ot(e).beforeAuthStateChanged(t,s)}(r,s,()=>s(r.currentUser)),function(e,t,s,r){ot(e).onIdTokenChanged(t,s,r)}(r,e=>s(e))}}var i;const a=Oe("auth");return a&&ey(r,`http://${a}`),r}var Lb;Gx={loadJS:e=>new Promise((t,s)=>{const r=document.createElement("script");var n,i;r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=Ff("internal-error");t.customData=e,s(t)},r.type="text/javascript",r.charset="UTF-8",(null!=(i=null==(n=document.getElementsByTagName("head"))?void 0:n[0])?i:document).appendChild(r)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},Lb="Browser",ys(new lt("auth",(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),n=e.getProvider("app-check-internal"),{apiKey:i,authDomain:a}=s.options;zf(i&&!i.includes(":"),"invalid-api-key",{appName:s.name});const o={apiKey:i,authDomain:a,clientPlatform:Lb,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Vx(Lb)},l=new $x(s,r,n,o);return function(e,t){const s=(null==t?void 0:t.persistence)||[],r=(Array.isArray(s)?s:[s]).map(kx);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(l,t),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,s)=>{e.getProvider("auth-internal").initialize()})),ys(new lt("auth-internal",e=>{const t=qx(e.getProvider("auth").getImmediate());return new Pb(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ss(Cb,Ab,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(Lb)),Ss(Cb,Ab,"esm2020");const Mb=ks({apiKey:"AIzaSyDYGOfg7BSk1W8KuqjA0RzVMGOmfKZdOUs",authDomain:"azzahra-fashion-muslim-ab416.firebaseapp.com",projectId:"azzahra-fashion-muslim-ab416",storageBucket:"azzahra-fashion-muslim-ab416.firebasestorage.app",messagingSenderId:"822661485961",appId:"1:822661485961:web:4603488d8bef0119f3fd58",measurementId:"G-NZSXEKPQER"});console.log(" Firebase initialized");const Fb=rp(Mb);"undefined"!=typeof window&&ap(Fb).then(()=>{console.log(" Firestore persistence enabled - data available offline")}).catch(e=>{"failed-precondition"===e.code?console.log(" Multiple tabs open, persistence disabled - will use memory cache"):"unimplemented"===e.code?console.log(" Browser doesn't support persistence"):console.log(" Persistence error:",e.message)}),Cf(Mb);const Ub=Ob(Mb),Vb=Mb,Bb=new class{constructor(){m(this,"collection","orders")}createOrder(e){return g(this,null,function*(){try{console.log(" Creating order in Firebase...");const t=Ub.currentUser;if(!t)throw new Error("User not authenticated");const s=u(d({},e),{id:this.generateOrderId(),userId:t.uid,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),timestamp:Date.now()}),r=Ym(Fb,this.collection,s.id);return yield cg(r,s),console.log(" Order created in Firebase:",s.id),s}catch(t){throw console.error(" Error creating order:",t),t}})}getUserOrders(){return g(this,null,function*(){try{console.log(" Loading orders from Firebase...");const e=Ub.currentUser;if(!e)throw new Error("User not authenticated");const t=Up(Qm(Fb,this.collection),Bp("userId","==",e.uid)),s=yield lg(t),r=[];return s.forEach(e=>{const t=e.data();r.push(u(d({},t),{id:e.id,createdAt:t.createdAt||(new Date).toISOString(),updatedAt:t.updatedAt||t.createdAt||(new Date).toISOString()}))}),console.log(" Orders loaded from Firebase:",r.length,"orders"),r}catch(e){throw console.error(" Error getting user orders:",e),e}})}updateOrderStatus(e,t){return g(this,null,function*(){try{console.log(" Updating order status in Firebase:",e,"",t);const s=Ym(Fb,this.collection,e),r=(yield ag(s)).data();return"cancelled"===t&&"cancelled"!==r.status&&(console.log(" Restoring stock for cancelled order:",e),yield this.restoreStockForOrder(r)),yield dg(s,{status:t,updatedAt:(new Date).toISOString()}),console.log(" Order status updated successfully"),!0}catch(s){return console.error(" Error updating order status:",s),!1}})}restoreStockForOrder(e){return g(this,null,function*(){try{console.log(" RESTORING STOCK FOR CANCELLED ORDER:",e.id),console.log(" Order items to restore:",e.items);for(const t of e.items)if(console.log(" Processing item for stock restoration:",{productId:t.productId,productName:t.productName,selectedVariant:t.selectedVariant,quantity:t.quantity}),t.productId&&t.selectedVariant){const e=Ym(Fb,"products",t.productId),s=yield ag(e);if(s.exists()){const r=s.data();console.log(" Current product data before restoration:",{productId:t.productId,currentStock:r.stock,currentVariants:r.variants});const n=r.variants||{sizes:[],colors:[],stock:{}};if(n.stock&&n.stock[t.selectedVariant.size]&&void 0!==n.stock[t.selectedVariant.size][t.selectedVariant.color]){const s=Number(n.stock[t.selectedVariant.size][t.selectedVariant.color]||0),r=s+t.quantity;n.stock[t.selectedVariant.size][t.selectedVariant.color]=r;let i=0;n.stock&&Object.values(n.stock).forEach(e=>{Object.values(e).forEach(e=>{i+=Number(e||0)})}),yield dg(e,{variants:n,stock:i,updatedAt:(new Date).toISOString()}),console.log(` RESTORED ${t.quantity} units to product ${t.productId} (${t.selectedVariant.size}, ${t.selectedVariant.color})`),console.log(` Variant stock: ${s}  ${r}`),console.log(` New total stock: ${i}`)}else{console.warn(" VARIANT STRUCTURE NOT FOUND:",{"variants.stock exists":!!n.stock,"selectedVariant.size":t.selectedVariant.size,"selectedVariant.color":t.selectedVariant.color,"variants.stock keys":n.stock?Object.keys(n.stock):"N/A","sizeStock exists":n.stock&&n.stock[t.selectedVariant.size]?"YES":"NO","colorStock exists":n.stock&&n.stock[t.selectedVariant.size]&&void 0!==n.stock[t.selectedVariant.size][t.selectedVariant.color]?"YES":"NO"});const s=Number(r.stock||0),i=s+t.quantity;yield dg(e,{stock:i,updatedAt:(new Date).toISOString()}),console.log(` FALLBACK: Restored ${t.quantity} units to main product stock (no variant structure found)`),console.log(` Main stock: ${s}  ${i}`)}}else console.error(" PRODUCT NOT FOUND for stock restoration:",t.productId)}else console.warn(" SKIPPING item - missing productId or selectedVariant:",{productId:t.productId,selectedVariant:t.selectedVariant})}catch(t){console.error(" ERROR restoring stock for order:",e.id,t)}})}updateOrderPayment(e,t,s){return g(this,null,function*(){try{console.log(" Updating order payment in Firebase Firestore:",e);let n="",i="";if(t instanceof File){n=t.name;try{console.log(" Converting payment proof to base64 (FREE storage)...");const e=new FileReader,s=new Promise((s,r)=>{e.onload=()=>{const t=e.result,r=t.split(",")[1]||t;s(r)},e.onerror=r,e.readAsDataURL(t)});i=yield s,console.log(" Payment proof converted to base64, size:",i.length,"characters"),console.log(" FREE storage in Firestore - No Firebase Storage cost!")}catch(r){console.error(" Error converting file to base64:",r),n=t.name,i=""}}else"string"==typeof t&&t.length>100?(i=t,n="payment_proof.jpg"):n=t;const a={paymentProof:n,paymentProofData:i,paymentProofUrl:"",updatedAt:(new Date).toISOString()};s&&(a.status=s);const o=Ym(Fb,this.collection,e);return yield dg(o,a),console.log(" Order payment updated in Firebase Firestore (FREE storage!)"),!0}catch(n){return console.error(" Error updating order payment in Firebase Firestore:",n),!1}})}restoreStockForOrderManually(e){return g(this,null,function*(){yield this.restoreStockForOrder(e)})}deleteOrder(e){return g(this,null,function*(){try{console.log(" Deleting order from Firebase:",e);const t=Ym(Fb,this.collection,e);return yield ug(t),console.log(" Order deleted successfully"),!0}catch(t){return console.error(" Error deleting order:",t),!1}})}getAllOrders(){return g(this,null,function*(){try{console.log(" Loading all orders from Firebase...");const e=Qm(Fb,this.collection),t=yield lg(e),s=[];return t.forEach(e=>{const t=e.data();s.push(u(d({},t),{id:e.id,createdAt:t.createdAt||(new Date).toISOString(),updatedAt:t.updatedAt||t.createdAt||(new Date).toISOString()}))}),console.log(" All orders loaded from Firebase:",s.length,"orders"),s}catch(e){throw console.error(" Error getting all orders:",e),e}})}generateOrderId(){return"AZF"+Date.now().toString().slice(-8)}},zb=f.createContext(null),$b=({children:t})=>{const[s,r]=f.useState([]),[n,i]=f.useState([]),a={orders:s,flashSales:n,addOrder:t=>g(e,null,function*(){try{const e=u(d({},t),{id:`AZF${Date.now().toString().slice(-8)}`,timestamp:Date.now(),createdAt:new Date,updatedAt:new Date});yield Bb.createOrder(e),console.log(" Order saved to Firebase:",e.id)}catch(e){console.error(" Error saving order:",e)}}),updateOrderStatus:(t,s)=>g(e,null,function*(){try{yield Bb.updateOrderStatus(t,s),console.log(" Order status updated:",t,"",s)}catch(e){console.error(" Error updating order status:",e)}}),updateOrderPayment:(t,s,r="pending")=>g(e,null,function*(){try{yield Bb.updateOrderPayment(t,s,r),console.log(" Order payment updated:",t)}catch(e){console.error(" Error updating payment:",e)}}),deleteOrder:t=>g(e,null,function*(){try{yield Bb.deleteOrder(t),console.log(" Order deleted:",t)}catch(e){console.error(" Error deleting order:",e)}}),getOrdersByStatus:e=>s.filter(t=>t.status===e),getTotalRevenue:()=>s.filter(e=>"delivered"===e.status).reduce((e,t)=>e+t.finalTotal,0),getTodayOrders:()=>{const e=new Date;return e.setHours(0,0,0,0),s.filter(t=>new Date(t.timestamp)>=e)},createFlashSale:e=>{const t=u(d({},e),{id:`fs_${Date.now()}`});i(e=>[...e,t])},updateFlashSale:(e,t)=>{i(s=>s.map(s=>s.id===e?d(d({},s),t):s))},deleteFlashSale:e=>{i(t=>t.filter(t=>t.id!==e))},getActiveFlashSales:()=>{const e=new Date;return n.filter(t=>t.active&&new Date(t.startDate)<=e&&new Date(t.endDate)>=e)},updateProductStock:(t,s,r)=>g(e,null,function*(){console.log(" Stock update requested:",t,s,r)})};return ke.jsx(zb.Provider,{value:a,children:t})};class qb extends y.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e,t)}render(){return this.state.hasError?this.props.fallback||ke.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:ke.jsxs("div",{className:"text-center",children:[ke.jsx("div",{className:"text-red-500 mb-4",children:ke.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:ke.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),ke.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Terjadi Kesalahan"}),ke.jsx("p",{className:"text-gray-600 mb-4",children:"Mohon muat ulang halaman atau coba lagi nanti."}),ke.jsx("button",{onClick:()=>window.location.reload(),className:"bg-pink-500 text-white px-6 py-2 rounded-lg hover:bg-pink-600 transition-colors",children:"Muat Ulang"})]})}):this.props.children}}const Kb=({product:e,onProductClick:t,onAddToCart:s,isFlashSale:r=!1,isFeatured:n=!1,user:i})=>{var a;const[o,l]=f.useState(!1),c=e=>{e.stopPropagation(),"reseller"!==(null==i?void 0:i.role)&&l(!o)},d=t=>{t.stopPropagation();const s=encodeURIComponent(`Halo Admin, saya tertarik dengan produk ${e.name} dan ingin menanyakan tentang harga reseller. Mohon info lebih lanjut. Terima kasih.`);window.open(`https://wa.me/6287815990944?text=${s}`,"_blank"),l(!1)};return ke.jsxs("div",{onClick:()=>t(e),className:"bg-white rounded-lg shadow-md hover:shadow-lg transition-all duration-300 cursor-pointer group overflow-hidden "+(n?"ring-2 ring-yellow-400 shadow-lg":""),children:[ke.jsxs("div",{className:"relative",children:[ke.jsx("img",{src:e.image||(null==(a=e.images)?void 0:a[0])||"/placeholder-product.jpg",alt:e.name,className:"w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300",onError:e=>{const t=e.target;t.style.display="none";const s=t.parentElement;s&&(s.style.background="linear-gradient(135deg, #667eea 0%, #764ba2 100%)",s.innerHTML='<div class="flex items-center justify-center h-full text-white text-center p-4"><div><div class="text-2xl mb-2"></div><div class="text-sm">No Image</div></div></div>')}}),(()=>{const t=e.stock||0,s=e.status||("baru"===e.condition?"ready":"po"),r="ready"===s?`Ready (${t})`:`PO (${t})`;return ke.jsx("div",{className:"absolute top-2 left-2 text-xs px-2 py-1 rounded font-medium "+("ready"===s?"bg-green-500 text-white":"bg-orange-500 text-white"),children:r})})(),n&&ke.jsx("div",{className:"absolute top-2 right-2 bg-yellow-400 text-white p-1.5 rounded-full shadow-lg",children:ke.jsx(b,{className:"w-4 h-4 fill-current"})}),ke.jsx("div",{className:"absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:ke.jsx("button",{onClick:t=>{t.stopPropagation(),s(e)},className:"bg-pink-500 text-white p-2 rounded-full hover:bg-pink-600 transition-colors shadow-lg",children:ke.jsx(v,{className:"w-4 h-4"})})})]}),ke.jsxs("div",{className:"p-4",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-3 line-clamp-2 group-hover:text-pink-600 transition-colors",children:e.name}),r&&e.flashSalePrice&&e.flashSalePrice>0?ke.jsxs("div",{className:"space-y-1",children:[ke.jsxs("div",{className:"flex items-center space-x-2",children:[ke.jsxs("span",{className:"text-lg font-bold text-red-600",children:["Rp ",e.flashSalePrice.toLocaleString("id-ID")]}),ke.jsxs("span",{className:"bg-red-100 text-red-600 text-xs px-2 py-1 rounded",children:["-",Math.round(100*(1-e.flashSalePrice/(e.originalRetailPrice||e.retailPrice))),"%"]})]}),ke.jsxs("div",{className:"text-sm text-gray-500 line-through",children:["Rp ",(e.originalRetailPrice||e.retailPrice).toLocaleString("id-ID")]})]}):ke.jsxs("div",{className:"space-y-1 relative",children:[ke.jsxs("div",{className:"text-lg font-bold text-pink-600",children:["Rp ",e.retailPrice.toLocaleString("id-ID")]}),ke.jsxs("div",{className:"relative",children:["reseller"===(null==i?void 0:i.role)?ke.jsxs("div",{className:"text-sm text-pink-600",children:["Reseller: Rp ",e.resellerPrice.toLocaleString("id-ID")]}):ke.jsxs("button",{onClick:c,className:"text-sm text-pink-600 hover:text-pink-700 font-medium transition-colors flex items-center space-x-1",children:[ke.jsxs("span",{children:["Reseller: Rp ",e.resellerPrice.toLocaleString("id-ID")]}),ke.jsx(w,{className:"w-3 h-3 transition-transform "+(o?"rotate-180":"")})]}),o&&"reseller"!==(null==i?void 0:i.role)&&ke.jsxs("div",{className:"absolute bottom-full left-0 right-0 mb-2 bg-white rounded-lg shadow-lg border border-gray-200 z-10",children:[ke.jsxs("button",{onClick:d,className:"w-full px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors flex items-center space-x-2 rounded-t-lg",children:[ke.jsx(N,{className:"w-4 h-4 text-green-600"}),ke.jsx("span",{children:"Info Reseller via WhatsApp"})]}),ke.jsx("div",{className:"text-xs text-gray-500 px-3 pb-2 text-center",children:"Hubungi admin untuk harga reseller"})]})]})]})]})]})},Gb=({onBannerClick:e})=>{const[t,s]=f.useState(0),[r,n]=f.useState([]),i=[];return f.useEffect(()=>{const e=localStorage.getItem("azzahra-banners");if(e)try{const t=JSON.parse(e);n([...i,...t])}catch(t){n(i)}else n(i)},[]),f.useEffect(()=>{if(r.length<=1)return;const e=setInterval(()=>{s(e=>(e+1)%r.length)},3e3);return()=>clearInterval(e)},[r.length]),0===r.length?null:ke.jsxs("div",{className:"relative w-full h-48 md:h-56 lg:h-64 overflow-hidden rounded-lg",children:[ke.jsx("div",{className:"relative h-full",children:r.map((s,r)=>ke.jsx("div",{className:"absolute inset-0 transition-opacity duration-500 "+(r===t?"opacity-100":"opacity-0"),children:ke.jsx("div",{className:"w-full h-full cursor-pointer "+("flashsale"===s.type?"bg-gradient-to-r from-red-500 to-pink-500":"bg-gradient-to-r from-purple-500 to-pink-500"),onClick:()=>(t=>{e&&e(t)})(s),children:ke.jsx("div",{className:"flex items-center justify-center h-full p-8 text-white",children:ke.jsxs("div",{className:"text-center",children:["flashsale"===s.type&&ke.jsx(j,{className:"w-8 h-8 mx-auto mb-2"}),ke.jsx("h2",{className:"text-2xl md:text-3xl font-bold mb-2",children:s.title}),"flashsale"===s.type&&ke.jsx("p",{className:"text-red-100",children:"Diskon terbatas! Buruan sebelum kehabisan!"}),"promo"===s.type&&ke.jsx("p",{className:"text-purple-100",children:"Promo spesial untuk Anda!"})]})})})},s.id))}),r.length>1&&ke.jsxs(ke.Fragment,{children:[ke.jsx("button",{onClick:()=>{s(e=>(e-1+r.length)%r.length)},className:"absolute left-4 top-1/2 transform -translate-y-1/2 bg-white/20 hover:bg-white/30 rounded-full p-2 transition-colors",children:ke.jsx(k,{className:"w-5 h-5 text-white"})}),ke.jsx("button",{onClick:()=>{s(e=>(e+1)%r.length)},className:"absolute right-4 top-1/2 transform -translate-y-1/2 bg-white/20 hover:bg-white/30 rounded-full p-2 transition-colors",children:ke.jsx(I,{className:"w-5 h-5 text-white"})})]}),r.length>1&&ke.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2",children:r.map((e,r)=>ke.jsx("button",{onClick:()=>s(r),className:"w-2 h-2 rounded-full transition-colors "+(r===t?"bg-white":"bg-white/50")},r))})]})};function Hb(e){return e&&"object"==typeof e&&e.id&&e.name?d({id:String(e.id),name:String(e.name),description:e.description?String(e.description):"",category:e.category?String(e.category):"other",images:Array.isArray(e.images)?e.images:[],variants:e.variants&&"object"==typeof e.variants?{sizes:Array.isArray(e.variants.sizes)?e.variants.sizes:[],colors:Array.isArray(e.variants.colors)?e.variants.colors:[],stock:e.variants.stock&&"object"==typeof e.variants.stock?e.variants.stock:{}}:{sizes:[],colors:[],stock:{}},retailPrice:"number"==typeof e.retailPrice?e.retailPrice:0,resellerPrice:"number"==typeof e.resellerPrice?e.resellerPrice:0,costPrice:"number"==typeof e.costPrice?e.costPrice:0,stock:"number"==typeof e.stock?e.stock:0,status:"ready"===e.status||"po"===e.status?e.status:"ready",isFlashSale:Boolean(e.isFlashSale),flashSalePrice:"number"==typeof e.flashSalePrice?e.flashSalePrice:0,createdAt:e.createdAt?e.createdAt instanceof Date?e.createdAt:new Date(e.createdAt):new Date,salesCount:"number"==typeof e.salesCount?e.salesCount:0,isFeatured:Boolean(e.isFeatured),featuredOrder:"number"==typeof e.featuredOrder?e.featuredOrder:void 0},Object.keys(e).reduce((t,s)=>(["id","name","description","category","images","variants","retailPrice","resellerPrice","costPrice","stock","status","isFlashSale","flashSalePrice","createdAt","salesCount","isFeatured","featuredOrder"].includes(s)||(t[s]=e[s]),t),{})):null}const Wb=()=>{const[t,s]=f.useState([]),[r,n]=f.useState(!1),[i,a]=f.useState(null),[o,l]=f.useState(!1),[c,m]=f.useState(null),[p,x]=f.useState({hours:0,minutes:0,seconds:0});f.useEffect(()=>{g(e,null,function*(){try{console.log(" Loading flash sale config (1 read total)...");const e=Ym(Fb,"flashSale","config"),t=yield ag(e);if(t.exists()){const e=t.data(),s=(new Date).getTime(),r=new Date(e.endTime).getTime(),n=s>r;m(r);const i=!n&&e.isActive;l(i),console.log(` Flash sale loaded (1 read total): isActive=${i}, hasEnded=${n}`),console.log(` Flash sale ${i?"ACTIVE":"INACTIVE"} - ${n?"EXPIRED":"VALID"}`)}else l(!1),console.log(" No flash sale config found - flash sale inactive")}catch(e){console.error(" Error loading flash sale config:",e),l(!1)}})},[]),f.useEffect(()=>{const e=setInterval(()=>{if(!o||!c)return void x({hours:0,minutes:0,seconds:0});const e=(new Date).getTime(),t=c-e;if(t>0){const e=Math.floor(t%864e5/36e5),s=Math.floor(t%36e5/6e4),r=Math.floor(t%6e4/1e3);x({hours:e,minutes:s,seconds:r})}else x({hours:0,minutes:0,seconds:0}),o&&(console.log(" Flash sale time ended - triggering automatic cleanup..."),l(!1),y())},1e3);return()=>clearInterval(e)},[o,c]);const y=()=>g(e,null,function*(){try{console.log(" Starting automatic flash sale cleanup...");const e=Up(Qm(Fb,"productBatches"),Bp("__name__","==","batch_1")),t=yield lg(e);if(!t.empty&&t.docs[0].exists()){const e=t.docs[0].data();let s=e.products||[],r=0;s=s.map(e=>{if(e.isFlashSale||e.flashSalePrice||e.flashSaleDiscount){r++,console.log(` Auto-cleaning flash sale from: ${e.name}`);const t=e,{isFlashSale:s,flashSalePrice:n,flashSaleDiscount:i,originalRetailPrice:a,originalResellerPrice:o}=t;return h(t,["isFlashSale","flashSalePrice","flashSaleDiscount","originalRetailPrice","originalResellerPrice"])}return e}),yield setDoc(Ym(Fb,"productBatches","batch_1"),u(d({},e),{products:s,totalProducts:s.length,updatedAt:(new Date).toISOString()})),yield setDoc(Ym(Fb,"flashSale","config"),{isActive:!1,endTime:(new Date).toISOString(),updatedAt:(new Date).toISOString()},{merge:!0}),console.log(` Auto-cleaned ${r} products from flash sale`),console.log(" Flash sale automatically deactivated!"),window.dispatchEvent(new CustomEvent("flashSaleExpired"))}else console.log(" Batch system not found for auto-cleanup")}catch(e){console.error(" Error during automatic flash sale cleanup:",e)}}),b=f.useCallback(()=>g(e,null,function*(){if(!(r||t.length>0)){n(!0),a(null),console.log(" Loading flash sale products from BATCH SYSTEM...");try{const e=Up(Qm(Fb,"productBatches"),Bp("__name__","==","batch_1")),r=yield lg(e);if(!r.empty&&r.docs[0].exists()){const e=r.docs[0].data(),t=(e.products||[]).filter(e=>e.isFlashSale&&e.stock>0);s(t),console.log(` Flash sale products loaded from batch: ${t.length} products`)}return n(!1),t}catch(e){return console.error(" Error loading flash sale products:",e),a("Gagal memuat produk flash sale"),n(!1),[]}}}),[r]);return f.useEffect(()=>{b()},[]),{flashSaleProducts:t,loading:r,error:i,timeLeft:p,isFlashSaleActive:o,loadFlashSaleProducts:b,debug:{totalLoaded:t.length,reads:"1 read total (batch + flash sale config)"}}},Jb=new class{constructor(){m(this,"storageKey","azzahra_cart_cache"),m(this,"version","1.0.0"),m(this,"ttl",6e5),m(this,"maxCacheAge",3e5)}getCart(e){try{const t=localStorage.getItem(this.storageKey);if(!t)return console.log(" No cart cache found"),null;const s=JSON.parse(t),r=Date.now();return s.userId!==e?(console.log(" Cart cache userId mismatch - ignoring cache"),null):s.version!==this.version?(console.log(" Cart cache version mismatch - ignoring cache"),null):r-s.lastUpdated>this.maxCacheAge?(console.log(" Cart cache expired - ignoring cache"),null):(console.log(" Using cached cart:",s.items.length,"items"),s.items)}catch(t){return console.error(" Error reading cart cache:",t),null}}setCart(e,t){try{const s={items:t,lastUpdated:Date.now(),version:this.version,userId:e};localStorage.setItem(this.storageKey,JSON.stringify(s)),console.log(" Cart cached:",t.length,"items")}catch(s){console.error(" Error saving cart cache:",s)}}updateItemQuantity(e,t,s,r){const n=this.getCart(e);if(!n)return;const i=n.map(e=>e.productId===t&&JSON.stringify(e.variant)===JSON.stringify(r)?u(d({},e),{quantity:s}):e);this.setCart(e,i)}addItem(e,t){const s=this.getCart(e)||[],r=s.findIndex(e=>e.productId===t.productId&&JSON.stringify(e.variant)===JSON.stringify(t.variant));r>=0?s[r]=u(d({},s[r]),{quantity:s[r].quantity+t.quantity}):s.push(t),this.setCart(e,s)}removeItem(e,t,s){const r=this.getCart(e);if(!r)return;const n=r.filter(e=>!(e.productId===t&&JSON.stringify(e.variant)===JSON.stringify(s)));this.setCart(e,n)}clearCart(e){try{localStorage.removeItem(this.storageKey),console.log(" Cart cache cleared")}catch(t){console.error(" Error clearing cart cache:",t)}}isCacheValid(e){return null!==this.getCart(e)}getCacheAge(e){try{const t=localStorage.getItem(this.storageKey);if(!t)return 1/0;const s=JSON.parse(t);return s.userId!==e?1/0:Date.now()-s.lastUpdated}catch(t){return 1/0}}triggerSync(){localStorage.setItem("cart_sync_trigger",Date.now().toString()),setTimeout(()=>{localStorage.removeItem("cart_sync_trigger")},100)}onSync(e){const t=t=>{"cart_sync_trigger"===t.key&&(console.log(" Cart sync detected from other device"),e())};return window.addEventListener("storage",t),()=>window.removeEventListener("storage",t)}},Qb=new class{constructor(){m(this,"FIREBASE_COLLECTION","user_carts")}getCart(){return g(this,null,function*(){try{const e=Ub.currentUser;if(!e)return console.log(" No user logged in - cart requires authentication"),[];console.log(" Trying cache first for cart...");const t=Jb.getCart(e.uid);if(t)return console.log(" Using cached cart:",t.length,"items"),Jb.getCacheAge(e.uid)>3e5&&(console.log(" Cart cache expired, background syncing..."),setTimeout(()=>this.syncFromFirebase(e.uid),1e3)),t;console.log(" Loading cart from Firebase for user:",e.uid);const s=yield this.getCartFromFirebase(e.uid);return s&&s.length>0?(console.log(" Cart loaded from Firebase:",s.length,"items"),Jb.setCart(e.uid,s),s):(console.log(" No cart found in Firebase - returning empty cart"),Jb.setCart(e.uid,[]),[])}catch(e){return console.error(" Error getting cart from Firebase:",e),[]}})}onCartChange(e){const t=Ub.currentUser;return t?(console.log(" Setting up real-time cart listener for user:",t.uid),mg(Ym(Fb,this.FIREBASE_COLLECTION,t.uid),t=>{if(t.exists()){const s=t.data(),r=(null==s?void 0:s.items)||[];console.log(" Real-time cart update:",r.length,"items"),e(r)}else console.log(" Real-time cart update: empty cart"),e([])},e=>{console.error(" Real-time cart listener error:",e)})):(console.log(" No user for real-time cart listener"),()=>{})}addToCart(e){return g(this,null,function*(){try{const t=Ub.currentUser;if(!t)throw new Error("User not authenticated - cannot add to cart");if(!(yield this.checkProductStock(e.productId,e.quantity,e.variant)))throw new Error("Insufficient stock available");const s=u(d({},e),{id:this.generateId(),addedAt:(new Date).toISOString()}),r=yield this.getCart(),n=r.findIndex(t=>t.productId===e.productId&&JSON.stringify(t.variant)===JSON.stringify(e.variant));let i;return i=-1!==n?r.map((e,t)=>t===n?u(d({},e),{quantity:e.quantity+s.quantity}):e):[...r,s],yield this.saveCartToFirebase(t.uid,i),console.log(" Cart updated in Firebase:",i.length,"items"),i}catch(t){throw console.error("Error adding to cart:",t),t}})}updateQuantity(e,t){return g(this,null,function*(){try{const s=Ub.currentUser;if(!s)throw new Error("User not authenticated - cannot update cart");if(0===t)return this.removeFromCart(e);const r=yield this.getCart(),n=r.find(t=>t.id===e);if(!n)throw new Error("Item not found in cart");const i=t-n.quantity;if(i>0&&!(yield this.checkProductStock(n.productId,i,n.variant)))throw new Error("Insufficient stock available for quantity increase");const a=r.map(s=>s.id===e?u(d({},s),{quantity:t}):s);return yield this.saveCartToFirebase(s.uid,a),console.log(" Cart quantity updated in Firebase"),a}catch(s){throw console.error("Error updating quantity:",s),s}})}removeFromCart(e){return g(this,null,function*(){try{const t=Ub.currentUser;if(!t)throw new Error("User not authenticated - cannot remove from cart");const s=(yield this.getCart()).filter(t=>t.id!==e);return yield this.saveCartToFirebase(t.uid,s),console.log(" Item removed from Firebase cart:",e),s}catch(t){throw console.error("Error removing from cart:",t),t}})}checkProductStock(e,t,s){return g(this,null,function*(){var r;try{console.log(" Checking stock for product:",e,"Quantity:",t,"Variant:",s);const n=Ym(Fb,"products",e),i=yield ag(n);if(!i.exists())return console.error(" Product not found:",e),!1;const a=i.data(),o=Number(a.stock||0);if(o<t)return console.error(" Insufficient stock. Available:",o,"Requested:",t),!1;if((null==s?void 0:s.size)&&(null==s?void 0:s.color)&&(null==(r=a.variants)?void 0:r.stock)){const{size:e,color:r}=s,n=a.variants.stock;if(n[e]&&void 0!==n[e][r]){const s=Number(n[e][r]||0);if(s<t)return console.error(" Insufficient variant stock. Available:",s,"Requested:",t),!1;console.log(` Sufficient variant stock: ${e}-${r} has ${s} available`)}else console.warn(" Variant stock not found for:",e,r,"- checking total stock only")}return console.log(" Stock check passed - sufficient stock available"),!0}catch(n){return console.error(" Error checking product stock:",n),!1}})}clearCart(){return g(this,null,function*(){try{console.log(" Clearing cart from Firebase...");const e=Ub.currentUser;if(!e)return void console.log(" No user logged in - cannot clear cart");yield this.saveCartToFirebase(e.uid,[]),console.log(" Firebase cart cleared for user:",e.uid),yield new Promise(e=>setTimeout(e,300));const t=yield this.getCartFromFirebase(e.uid);t&&t.length>0&&(console.warn(" Firebase still has items, forcing clear again..."),yield this.saveCartToFirebase(e.uid,[])),console.log(" Cart PERMANENTLY cleared from Firebase - all devices")}catch(e){throw console.error(" Error clearing cart:",e),e}})}handleLogout(){return g(this,null,function*(){try{Ub.currentUser&&(yield this.clearCart(),console.log(" Cart cleared on logout"))}catch(e){console.error("Error handling logout:",e)}})}getCartTotal(){return g(this,null,function*(){return(yield this.getCart()).reduce((e,t)=>e+t.price*t.quantity,0)})}getCartCount(){return g(this,null,function*(){return(yield this.getCart()).reduce((e,t)=>e+t.quantity,0)})}isInCart(e,t){return g(this,null,function*(){return(yield this.getCart()).some(s=>s.productId===e&&JSON.stringify(s.variant)===JSON.stringify(t))})}getCartFromFirebase(e){return g(this,null,function*(){try{console.log(" Loading cart from Firebase for user:",e);const t=Ym(Fb,"user_carts",e),s=yield ag(t);if(s.exists()){const e=s.data(),t=(null==e?void 0:e.items)||[];return console.log(" Cart loaded from Firebase:",t.length,"items"),t}return console.log(" No cart found in Firebase for user:",e),null}catch(t){return console.error(" Error getting cart from Firebase:",t),null}})}saveCartToFirebase(e,t){return g(this,null,function*(){try{console.log(" Saving cart to Firebase for user:",e,"Items:",t.length);const s=Ym(Fb,"user_carts",e);yield cg(s,{userId:e,items:t,lastUpdated:(new Date).toISOString()}),Jb.setCart(e,t),Jb.triggerSync(),console.log(" Cart saved to Firebase successfully")}catch(s){throw console.error(" Error saving cart to Firebase:",s),s}})}syncFromFirebase(e){return g(this,null,function*(){try{console.log(" Syncing cart from Firebase for user:",e);const t=yield this.getCartFromFirebase(e);t?(Jb.setCart(e,t),console.log(" Cart synced from Firebase:",t.length,"items")):(Jb.setCart(e,[]),console.log(" Cart synced from Firebase: empty"))}catch(t){console.error(" Error syncing cart from Firebase:",t)}})}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}},Yb=({user:t,products:s,loading:r,onProductClick:n,onLoginRequired:i,onCartClick:a,onAddToCart:o,onNavigateToFlashSale:l,onLoadMore:c,hasMore:h=!0,onRefreshProducts:m,searchProducts:p})=>{var x;const[w,N]=f.useState(""),[j,k]=f.useState("all"),[I,P]=f.useState("all"),[D,R]=f.useState(0),[O,L]=f.useState("terbaru"),M=s.filter(e=>e.isFeatured),[F,U]=f.useState([]),[V,B]=f.useState(!1),[z,$]=f.useState(!1),q=f.useRef(null),K=f.useRef(null),{timeLeft:G,isFlashSaleActive:H,flashSaleProducts:W,loading:J}=Wb(),Q=()=>g(e,null,function*(){if(null==t?void 0:t.uid)try{const e=yield Qb.getCart();R(e.length)}catch(e){console.error("Failed to load cart count:",e),R(0)}});f.useEffect(()=>{(null==t?void 0:t.uid)?Q():R(0)},[t]),f.useEffect(()=>{if(!c||!h)return;const e=q.current;return e&&e.disconnect(),q.current=new IntersectionObserver(e=>{const[t]=e;t.isIntersecting&&h&&!r&&c()},{threshold:.1,rootMargin:"100px"}),K.current&&q.current.observe(K.current),()=>{e&&e.disconnect()}},[c,h,r]),f.useEffect(()=>{const e=setInterval(()=>{Q()},15e3);return()=>{clearInterval(e)}},[t]),f.useEffect(()=>{if(!w||!p)return $(!1),void U([]);const s=setTimeout(()=>g(e,null,function*(){var e;B(!0);try{console.log(" Searching with cache support:",w);const s={query:w,category:"all"!==j?j:void 0,status:"all"!==I?I:void 0,sortBy:O,userRole:(null==t?void 0:t.role)||"customer",page:1},r=yield p(s);U(r.products||[]),$(!0),console.log(" Search completed:",null==(e=r.products)?void 0:e.length,"results")}catch(s){console.error(" Search error:",s),U([]),$(!0)}finally{B(!1)}}),300);return()=>clearTimeout(s)},[w,j,I,O,null==t?void 0:t.role,p]);const Y=[{id:"all",name:"Semua",icon:""},{id:"hijab",name:"Hijab",icon:""},{id:"gamis",name:"Gamis",icon:""},{id:"khimar",name:"Khimar",icon:""},{id:"tunik",name:"Tunik",icon:""},{id:"abaya",name:"Abaya",icon:""}],X=e=>{o(e)},Z=y.useMemo(()=>{const e=function(e){if(!Array.isArray(e))return console.warn(" validateProducts: Input is not an array"),[];const t=e.map(Hb).filter(e=>null!==e);return t}(s);return e.map(e=>{var t,s,r;return u(d({},e),{description:e.description||"",category:e.category||"other",images:e.images||[],variants:{sizes:(null==(t=e.variants)?void 0:t.sizes)||[],colors:(null==(s=e.variants)?void 0:s.colors)||[],stock:(null==(r=e.variants)?void 0:r.stock)||{}},retailPrice:e.retailPrice||0,resellerPrice:e.resellerPrice||0,costPrice:e.costPrice||0,stock:e.stock||0,status:e.status||"ready",isFlashSale:e.isFlashSale||!1,flashSalePrice:e.flashSalePrice||0,createdAt:e.createdAt||new Date,salesCount:e.salesCount||0,isFeatured:e.isFeatured||!1})})},[s]),ee=Z.filter(e=>{const t=e.name.toLowerCase().includes(w.toLowerCase())||e.description.toLowerCase().includes(w.toLowerCase()),s="all"===j||e.category===j,r="all"===I||e.status===I;return t&&s&&r}),te=[...ee].sort((e,s)=>{switch(O){case"terbaru":return new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime();case"termurah":return("reseller"===(null==t?void 0:t.role)?e.resellerPrice:e.retailPrice)-("reseller"===(null==t?void 0:t.role)?s.resellerPrice:s.retailPrice);default:return 0}}),se=y.useMemo(()=>{try{return Array.isArray(te)?te:Z||[]}catch(e){return Z||[]}},[te,Z]),re=z?F:se;return f.useEffect(()=>{const e=e=>{},t=e=>{},s=e=>{};return window.addEventListener("featuredProductsUpdated",e),window.addEventListener("productsUpdated",t),window.addEventListener("flashSaleUpdated",s),window.addEventListener("productAdded",t),window.addEventListener("productUpdated",t),window.addEventListener("productDeleted",t),()=>{window.removeEventListener("featuredProductsUpdated",e),window.removeEventListener("productsUpdated",t),window.removeEventListener("flashSaleUpdated",s),window.removeEventListener("productAdded",t),window.removeEventListener("productUpdated",t),window.removeEventListener("productDeleted",t)}},[]),f.useEffect(()=>{const e=e=>{var t;"time_expired"===(null==(t=e.detail)?void 0:t.reason)&&(window.flashSaleRefreshTimer&&clearTimeout(window.flashSaleRefreshTimer),window.flashSaleRefreshTimer=setTimeout(()=>{window.location.reload()},4e3))};return window.addEventListener("flashSaleEnded",e),()=>{window.removeEventListener("flashSaleEnded",e)}},[]),r?ke.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:ke.jsxs("div",{className:"text-center",children:[ke.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-4 border-pink-500 mx-auto mb-4"}),ke.jsx("p",{className:"text-gray-600 font-medium",children:"Memuat produk..."})]})}):ke.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[ke.jsxs("div",{className:"bg-gradient-to-r from-pink-500 to-purple-600 text-white p-4",children:[ke.jsxs("div",{className:"flex items-center justify-between mb-4",children:[ke.jsxs("div",{children:[ke.jsx("h1",{className:"text-xl font-bold",children:"Azzahra Fashion"}),ke.jsx("p",{className:"text-pink-100 text-sm",children:"Muslim Fashion Store"})]}),ke.jsx("div",{className:"flex items-center space-x-3",children:t?ke.jsxs("div",{className:"flex items-center space-x-2",children:[ke.jsx(S,{className:"w-5 h-5"}),ke.jsx("span",{className:"text-sm",children:t.name})]}):ke.jsx("button",{onClick:i,className:"bg-white/20 px-3 py-1 rounded-full text-sm hover:bg-white/30 transition-colors",children:"Login"})})]}),ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsxs("div",{className:"flex-1 relative",children:[ke.jsx(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),ke.jsx("input",{type:"text",placeholder:"Cari produk...",value:w,onChange:e=>N(e.target.value),className:"w-full pl-10 pr-4 py-3 rounded-lg text-gray-800 focus:outline-none focus:ring-2 focus:ring-white/50"})]}),ke.jsx("button",{onClick:m,className:"p-2 bg-white rounded-full shadow-md hover:shadow-lg transition-shadow",title:"Refresh produk",children:ke.jsx(E,{className:"w-5 h-5 text-gray-600"})}),ke.jsxs("button",{onClick:a,className:"relative p-2 bg-white rounded-full shadow-md hover:shadow-lg transition-shadow",children:[ke.jsx(v,{className:"w-6 h-6 text-gray-600"}),D>0&&ke.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:D})]})]})]}),ke.jsx("div",{className:"p-4",children:ke.jsx(Gb,{onBannerClick:e=>{"flashsale"===e.type&&l&&l()}})}),ke.jsx("div",{className:"px-4 mb-6",children:ke.jsxs("div",{className:"bg-gradient-to-br from-red-600 via-red-500 to-orange-500 rounded-xl p-5 text-white shadow-xl relative overflow-hidden",children:[ke.jsxs("div",{className:"absolute inset-0 opacity-10",children:[ke.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white rounded-full -mr-16 -mt-16 animate-pulse"}),ke.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white rounded-full -ml-12 -mb-12 animate-pulse delay-75"})]}),ke.jsx("div",{className:"relative z-10",children:ke.jsxs("div",{className:"flex items-center justify-between mb-4",children:[ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx("div",{className:"bg-white/20 backdrop-blur-sm p-3 rounded-full shadow-lg",children:ke.jsx("span",{className:"text-3xl",children:""})}),ke.jsxs("div",{children:[ke.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-yellow-200 to-white bg-clip-text text-transparent",children:"Flash Sale"}),ke.jsx("p",{className:"text-red-100 text-sm font-medium",children:H?"Diskon Terbatas!":"Nantikan Flash Sale Kami Selanjutnya"}),H&&G&&ke.jsxs("div",{className:"flex items-center space-x-2 mt-2 bg-white/20 backdrop-blur-sm rounded-full px-3 py-1",children:[ke.jsx(T,{className:"w-4 h-4 text-yellow-200"}),ke.jsx("span",{className:"text-sm font-bold text-yellow-200",children:`${G.hours.toString().padStart(2,"0")}:${G.minutes.toString().padStart(2,"0")}:${G.seconds.toString().padStart(2,"0")}`})]})]})]}),ke.jsx("button",{onClick:l,className:"bg-white text-red-500 px-4 py-2 rounded-full text-sm font-bold hover:bg-red-50 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105",children:H?"Lihat Semua":"Lihat Produk"})]})}),J?ke.jsx("div",{className:"grid grid-cols-2 gap-3",children:[...Array(2)].map((e,t)=>ke.jsxs("div",{className:"bg-white/10 rounded-lg p-3 backdrop-blur-sm",children:[ke.jsx("div",{className:"w-full h-24 bg-white/20 rounded animate-pulse mb-2"}),ke.jsx("div",{className:"h-3 bg-white/20 rounded animate-pulse mb-1"}),ke.jsx("div",{className:"h-3 bg-white/20 rounded w-3/4 animate-pulse"})]},`flash-skeleton-${t}`))}):ke.jsx("div",{className:"grid grid-cols-2 gap-3",children:W.slice(0,2).map(e=>{var t;const s={id:e.id,name:e.name,description:"",category:e.category,price:e.price,retailPrice:e.retailPrice||e.price,resellerPrice:e.resellerPrice,costPrice:e.costPrice,stock:e.stock,images:e.images,image:e.image,variants:e.variants,status:e.status,isFlashSale:e.isFlashSale,flashSalePrice:e.flashSalePrice,originalRetailPrice:e.originalRetailPrice,originalResellerPrice:e.originalResellerPrice,createdAt:e.createdAt,salesCount:0,isFeatured:e.isFeatured||!1,featuredOrder:e.featuredOrder||0,weight:0,unit:"gram",estimatedReady:void 0},r=Math.round(((e.originalRetailPrice||e.retailPrice)-e.flashSalePrice)/(e.originalRetailPrice||e.retailPrice)*100);return ke.jsxs("div",{onClick:()=>n(s),className:"bg-white/10 rounded-lg p-3 backdrop-blur-sm hover:bg-white/20 transition-colors cursor-pointer",children:[ke.jsxs("div",{className:"relative",children:[ke.jsx("img",{src:s.image||(null==(t=s.images)?void 0:t[0])||"/placeholder-product.jpg",alt:s.name,className:"w-full h-24 object-cover rounded mb-2"}),ke.jsxs("div",{className:"absolute top-1 right-1 bg-red-600 text-white text-xs px-2 py-1 rounded-full",children:["-",r,"%"]})]}),ke.jsx("h3",{className:"text-white font-medium text-sm mb-1 truncate",children:s.name}),ke.jsxs("div",{className:"flex items-center space-x-2",children:[ke.jsxs("span",{className:"text-white font-bold text-sm",children:["Rp ",s.flashSalePrice.toLocaleString("id-ID")]}),ke.jsxs("span",{className:"text-red-200 line-through text-xs",children:["Rp ",(s.originalRetailPrice||s.retailPrice).toLocaleString("id-ID")]})]})]},`flash-${s.id}`)})}),0===W.length&&!J&&H&&ke.jsxs("div",{className:"text-center py-4 text-red-100",children:[ke.jsx("span",{className:"text-3xl",children:""}),ke.jsx("p",{className:"text-sm mt-1",children:"Tidak ada Flash Sale saat ini"})]})]})}),ke.jsxs("div",{className:"px-4 mb-6",children:[ke.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[ke.jsx(b,{className:"w-5 h-5 text-yellow-500 fill-current"}),ke.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"Produk Unggulan"})]}),r?ke.jsx("div",{className:"grid grid-cols-2 gap-4",children:[...Array(2)].map((e,t)=>ke.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[ke.jsx("div",{className:"w-full h-48 bg-gray-200 animate-pulse"}),ke.jsxs("div",{className:"p-4",children:[ke.jsx("div",{className:"h-4 bg-gray-200 rounded mb-2 animate-pulse"}),ke.jsx("div",{className:"h-3 bg-gray-200 rounded mb-3 animate-pulse"}),ke.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 animate-pulse"})]})]},`skeleton-${t}`))}):M.length>0?ke.jsx("div",{className:"grid grid-cols-2 gap-4",children:M.map(e=>ke.jsx(Kb,{product:e,onProductClick:n,onAddToCart:X,user:t,isFeatured:!0},`featured-${e.id}`))}):ke.jsxs("div",{className:"text-center py-8 text-gray-500 bg-white rounded-lg",children:[ke.jsx(b,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),ke.jsx("p",{children:"Belum ada produk unggulan"})]})]}),ke.jsx("div",{className:"px-4",children:ke.jsxs("div",{className:"flex flex-col space-y-3",children:[ke.jsx("div",{className:"flex space-x-3 overflow-x-auto pb-2",children:Y.map(e=>ke.jsxs("button",{onClick:()=>k(e.id),className:"flex-shrink-0 flex items-center space-x-2 px-4 py-2 rounded-full transition-colors "+(j===e.id?"bg-pink-500 text-white":"bg-white text-gray-600 hover:bg-gray-100"),children:[ke.jsx("span",{children:e.icon}),ke.jsx("span",{className:"text-sm font-medium",children:e.name})]},e.id))}),ke.jsxs("div",{className:"flex space-x-3 overflow-x-auto pb-2",children:[ke.jsx("button",{onClick:()=>P("all"),className:"flex-shrink-0 flex items-center space-x-2 px-4 py-2 rounded-full transition-colors "+("all"===I?"bg-gray-700 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:ke.jsx("span",{className:"text-sm font-medium",children:"Semua Status"})}),ke.jsxs("button",{onClick:()=>P("ready"),className:"flex-shrink-0 flex items-center space-x-2 px-4 py-2 rounded-full transition-colors "+("ready"===I?"bg-green-500 text-white":"bg-white text-gray-600 hover:bg-gray-100 border border-green-300"),children:[ke.jsx("span",{className:"w-2 h-2 bg-current rounded-full"}),ke.jsx("span",{className:"text-sm font-medium",children:"Ready"})]}),ke.jsxs("button",{onClick:()=>P("po"),className:"flex-shrink-0 flex items-center space-x-2 px-4 py-2 rounded-full transition-colors "+("po"===I?"bg-orange-500 text-white":"bg-white text-gray-600 hover:bg-gray-100 border border-orange-300"),children:[ke.jsx("span",{className:"w-2 h-2 bg-current rounded-full"}),ke.jsx("span",{className:"text-sm font-medium",children:"PO"})]})]})]})}),ke.jsxs("div",{className:"px-4",children:[ke.jsxs("div",{className:"flex flex-col space-y-3 mb-4",children:[ke.jsxs("div",{className:"flex items-center justify-between",children:[ke.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"all"===j?"Semua Produk":null==(x=Y.find(e=>e.id===j))?void 0:x.name}),ke.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[ke.jsx(C,{className:"w-4 h-4 mr-1"}),ee.length," produk"]})]}),ke.jsxs("div",{className:"flex items-center space-x-2 overflow-x-auto pb-2",children:[ke.jsxs("div",{className:"flex items-center text-sm text-gray-600 mr-2",children:[ke.jsx(A,{className:"w-4 h-4 mr-1"}),"Urutkan:"]}),ke.jsx("button",{onClick:()=>L("terbaru"),className:"flex-shrink-0 px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+("terbaru"===O?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"Terbaru"}),ke.jsx("button",{onClick:()=>L("termurah"),className:"flex-shrink-0 px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+("termurah"===O?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"Termurah"})]})]}),V?ke.jsxs("div",{className:"text-center py-12",children:[ke.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500 mx-auto mb-4"}),ke.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"Mencari produk..."}),ke.jsx("p",{className:"text-gray-500",children:"Mohon tunggu sebentar"})]}):0===re.length?ke.jsxs("div",{className:"text-center py-12",children:[ke.jsx("div",{className:"text-gray-400 mb-4",children:ke.jsx(_,{className:"w-12 h-12 mx-auto"})}),ke.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:z?"Tidak ada hasil pencarian":"Produk tidak ditemukan"}),ke.jsx("p",{className:"text-gray-500",children:z?"Coba kata kunci pencarian lain atau filter berbeda":"Coba kata kunci lain atau pilih kategori berbeda"})]}):ke.jsxs(ke.Fragment,{children:[ke.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:re.map(e=>ke.jsx(Kb,{product:e,onProductClick:n,onAddToCart:X,user:t},e.id))}),h&&ke.jsx("div",{className:"mt-6 text-center",children:ke.jsx("div",{ref:K,className:"inline-flex items-center justify-center p-4",children:r?ke.jsxs("div",{className:"flex items-center space-x-2",children:[ke.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-pink-500"}),ke.jsx("span",{className:"text-gray-600 text-sm",children:"Memuat lebih banyak produk..."})]}):ke.jsx("div",{className:"h-1"})})})]})]}),t&&ke.jsx("div",{className:"fixed bottom-24 right-4 bg-white rounded-lg shadow-lg p-3 border-l-4 border-pink-500",children:ke.jsx("div",{className:"text-xs text-gray-600",children:"reseller"===t.role?ke.jsxs("div",{className:"flex items-center space-x-1",children:[ke.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full"}),ke.jsx("span",{children:"Harga Reseller Aktif"})]}):ke.jsxs("div",{className:"flex items-center space-x-1",children:[ke.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),ke.jsx("span",{children:"Harga Retail"})]})})})]})},Xb=({product:e,user:t,onBack:s,onLoginRequired:r,onAddToCart:n,onBuyNow:i,onNavigateToCart:a})=>{var o,l,c,d,u,h,m;const[p,g]=f.useState(""),[x,y]=f.useState(""),[w,N]=f.useState(1),[j,k]=f.useState(0),I=(t,s)=>{var r,n,i,a,o,l;if(void 0!==(null==(i=null==(n=null==(r=e.variants)?void 0:r.stock)?void 0:n[t])?void 0:i[s]))return Number(e.variants.stock[t][s]||0);if(!(null==(a=e.variants)?void 0:a.sizes)||0===e.variants.sizes.length)return e.stock||0;if((null==(o=e.variants)?void 0:o.sizes)&&(null==(l=e.variants)?void 0:l.colors)){const t=e.variants.sizes.length*e.variants.colors.length;if(t>0&&e.stock>0)return Math.floor(e.stock/t)}return console.warn(" No stock data found for variant:",{size:t,color:s}),0},S=()=>p&&x?I(p,x):e.stock||0,_=()=>{var t;if(null==(t=e.variants)?void 0:t.stock){let t=0;return Object.values(e.variants.stock).forEach(e=>{Object.values(e).forEach(e=>{t+=e})}),t}return e.stock||0};return ke.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[ke.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:ke.jsxs("div",{className:"flex items-center justify-between p-4",children:[ke.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-full",children:ke.jsx(P,{className:"w-6 h-6 text-gray-600"})}),ke.jsx("h1",{className:"text-lg font-semibold",children:"Detail Produk"}),ke.jsxs("div",{className:"flex items-center space-x-2",children:[ke.jsx("button",{onClick:a||(()=>{}),className:"p-2 rounded-full transition-colors relative "+(t?"bg-pink-500 text-white hover:bg-pink-600":"bg-gray-100 text-gray-400"),children:ke.jsx(v,{className:"w-5 h-5"})}),ke.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-full",children:ke.jsx(D,{className:"w-5 h-5 text-gray-600"})}),ke.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-full",children:ke.jsx(R,{className:"w-5 h-5 text-gray-600"})})]})]})}),ke.jsxs("div",{className:"bg-white",children:[ke.jsxs("div",{className:"relative",children:[ke.jsx("img",{src:(null==(o=e.images)?void 0:o[j])||e.image||"/placeholder-product.jpg",alt:e.name,className:"w-full h-96 object-cover",onError:e=>{e.target.src="/placeholder-product.jpg"}}),e.isFlashSale&&ke.jsx("div",{className:"absolute top-4 left-4 bg-red-500 text-white px-3 py-1 rounded-full text-sm font-semibold",children:"FLASH SALE"}),"po"===e.status&&ke.jsx("div",{className:"absolute top-4 right-4 bg-orange-500 text-white px-3 py-1 rounded-full text-sm font-semibold",children:"PRE ORDER"})]}),e.images&&e.images.length>1&&ke.jsx("div",{className:"flex space-x-2 p-4 overflow-x-auto",children:e.images.map((t,s)=>ke.jsx("button",{onClick:()=>k(s),className:"flex-shrink-0 w-16 h-16 rounded-lg overflow-hidden border-2 "+(j===s?"border-pink-500":"border-gray-200"),children:ke.jsx("img",{src:t,alt:`${e.name} ${s+1}`,className:"w-full h-full object-cover",onError:e=>{e.target.src="/placeholder-product.jpg"}})},s))})]}),ke.jsxs("div",{className:"bg-white mt-2 p-4",children:[ke.jsx("div",{className:"flex items-start justify-between mb-3",children:ke.jsxs("div",{className:"flex-1",children:[ke.jsx("h1",{className:"text-xl font-bold text-gray-800 mb-2",children:e.name}),ke.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[ke.jsxs("div",{className:"flex items-center",children:[[...Array(5)].map((e,t)=>ke.jsx(b,{className:"w-4 h-4 text-yellow-400 fill-current"},t)),ke.jsx("span",{className:"text-sm text-gray-600 ml-1",children:"(4.8)"})]}),ke.jsx("span",{className:"text-sm text-gray-500",children:" Terjual 150+"})]})]})}),ke.jsx("div",{className:"mb-4",children:e.isFlashSale&&e.flashSalePrice>0?ke.jsxs("div",{className:"space-y-1",children:[ke.jsxs("div",{className:"flex items-center space-x-2",children:[ke.jsxs("span",{className:"text-2xl font-bold text-red-600",children:["Rp ",e.flashSalePrice.toLocaleString("id-ID")]}),ke.jsxs("span",{className:"bg-red-100 text-red-600 text-xs px-2 py-1 rounded",children:["-",Math.round(100*(1-e.flashSalePrice/(e.originalRetailPrice||e.retailPrice))),"%"]})]}),ke.jsxs("div",{className:"text-lg text-gray-500 line-through",children:["Rp ",(e.originalRetailPrice||e.retailPrice).toLocaleString("id-ID")]})]}):ke.jsxs("div",{className:"space-y-1",children:[ke.jsxs("div",{className:"text-2xl font-bold text-pink-600",children:["Rp ",(e.isFlashSale&&e.flashSalePrice>0?e.flashSalePrice:"reseller"===(null==t?void 0:t.role)?e.resellerPrice:e.retailPrice).toLocaleString("id-ID")]}),"reseller"===(null==t?void 0:t.role)?ke.jsxs("div",{className:"text-sm text-blue-600 font-medium",children:["Harga Reseller (Retail: Rp ",e.retailPrice.toLocaleString("id-ID"),")"]}):ke.jsx("button",{onClick:()=>{if("reseller"!==(null==t?void 0:t.role)){const t=encodeURIComponent(`Halo Admin, saya tertarik dengan produk ${e.name} dan ingin menanyakan tentang harga reseller. Mohon info lebih lanjut. Terima kasih.`);window.open(`https://wa.me/6287815990944?text=${t}`,"_blank")}},className:"text-sm text-green-600 font-medium hover:text-green-700 underline transition-colors",children:" Info Harga Reseller?"})]})}),ke.jsx("div",{className:"flex items-center justify-between mb-4 p-3 bg-gray-50 rounded-lg",children:ke.jsxs("div",{className:"flex items-center space-x-4",children:[ke.jsxs("div",{className:"text-sm",children:[ke.jsx("span",{className:"text-gray-600",children:"Total Stok: "}),ke.jsx("span",{className:"font-semibold "+(_()>10?"text-green-600":_()>0?"text-yellow-600":"text-red-600"),children:_()})]}),ke.jsxs("div",{className:"text-sm",children:[ke.jsx("span",{className:"text-gray-600",children:"Status: "}),ke.jsx("span",{className:"font-semibold "+("ready"===e.status?"text-green-600":"text-orange-600"),children:"ready"===e.status?"Ready Stock":"Pre Order"})]})]})}),p&&x&&ke.jsx("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg border border-blue-200",children:ke.jsxs("div",{className:"text-sm",children:[ke.jsxs("span",{className:"text-blue-600 font-medium",children:["Stok ",p," - ",x,": "]}),ke.jsxs("span",{className:"font-bold "+(S()>5?"text-green-600":S()>0?"text-yellow-600":"text-red-600"),children:[S()," pcs"]})]})}),ke.jsx("div",{className:"border-t pt-4",children:ke.jsx("p",{className:"text-gray-600 leading-relaxed",children:e.description})})]}),(null==(l=e.variants)?void 0:l.sizes)&&e.variants.sizes.length>0&&ke.jsxs("div",{className:"bg-white mt-2 p-4",children:[ke.jsxs("div",{className:"mb-6",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Pilih Ukuran"}),ke.jsx("div",{className:"flex flex-wrap gap-2",children:((null==(c=e.variants)?void 0:c.sizes)||[]).map(t=>{var s;const r=((null==(s=e.variants)?void 0:s.colors)||[]).reduce((e,s)=>e+I(t,s),0);return ke.jsxs("button",{onClick:()=>g(t),disabled:0===r,className:"px-4 py-2 border rounded-lg font-medium transition-colors relative "+(p===t?"border-pink-500 bg-pink-50 text-pink-600":0===r?"border-gray-200 text-gray-400 cursor-not-allowed bg-gray-50":"border-gray-300 text-gray-600 hover:border-gray-400"),children:[ke.jsx("span",{children:t}),0===r&&ke.jsx("span",{className:"absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full"}),e.variants.stock&&ke.jsx("span",{className:"text-xs text-gray-500 block",children:r>0?`${r} pcs`:"Habis"})]},t)})})]}),ke.jsxs("div",{className:"mb-6",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Pilih Warna"}),ke.jsx("div",{className:"flex flex-wrap gap-2",children:((null==(d=e.variants)?void 0:d.colors)||[]).map(t=>{var s;const r=p?I(p,t):((null==(s=e.variants)?void 0:s.sizes)||[]).reduce((e,s)=>e+I(s,t),0),n=!!p&&0===r;return ke.jsxs("button",{onClick:()=>y(t),disabled:n,className:"px-4 py-2 border rounded-lg font-medium transition-colors relative "+(x===t?"border-pink-500 bg-pink-50 text-pink-600":n?"border-gray-200 text-gray-400 cursor-not-allowed bg-gray-50":"border-gray-300 text-gray-600 hover:border-gray-400"),children:[ke.jsx("span",{children:t}),n&&ke.jsx("span",{className:"absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full"}),e.variants.stock&&ke.jsx("span",{className:"text-xs text-gray-500 block",children:r>0?`${r} pcs`:"Habis"})]},t)})}),p&&ke.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[" Stok warna ditampilkan untuk ukuran ",p]})]})]}),ke.jsx("div",{className:"bg-white mt-2 p-4",children:ke.jsxs("div",{className:"mb-6",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Jumlah"}),ke.jsxs("div",{className:"flex items-center space-x-4",children:[ke.jsxs("div",{className:"flex items-center space-x-3 bg-gray-100 rounded-lg p-1",children:[ke.jsx("button",{onClick:()=>N(Math.max(1,w-1)),className:"w-10 h-10 flex items-center justify-center rounded-md hover:bg-gray-200 transition-colors",children:ke.jsx(O,{className:"w-4 h-4"})}),ke.jsx("span",{className:"w-12 text-center font-semibold",children:w}),ke.jsx("button",{onClick:()=>{const e=S();w<e&&N(w+1)},disabled:w>=S(),className:"w-10 h-10 flex items-center justify-center rounded-md transition-colors "+(w>=S()?"bg-gray-200 text-gray-400 cursor-not-allowed":"hover:bg-gray-200"),children:ke.jsx(L,{className:"w-4 h-4"})})]}),ke.jsx("div",{className:"text-sm text-gray-600",children:p&&x?ke.jsxs(ke.Fragment,{children:["Stok ",p," - ",x,":"," ",ke.jsxs("span",{className:"font-semibold "+(S()>5?"text-green-600":S()>0?"text-yellow-600":"text-red-600"),children:[S()," pcs"]})]}):ke.jsxs(ke.Fragment,{children:["Stok tersedia:"," ",ke.jsxs("span",{className:"font-semibold",children:[_()," pcs"]})]})})]}),p&&x&&w>=S()&&ke.jsx("div",{className:"mt-2 p-2 bg-yellow-50 border border-yellow-200 rounded-lg",children:ke.jsxs("p",{className:"text-xs text-yellow-700",children:[" Maksimal pembelian untuk ",p," - ",x," adalah ",S()," pcs"]})})]})}),ke.jsxs("div",{className:"bg-white mt-2 p-4",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Detail Produk"}),ke.jsxs("div",{className:"space-y-2 text-sm",children:[ke.jsxs("div",{className:"flex justify-between",children:[ke.jsx("span",{className:"text-gray-600",children:"Kategori:"}),ke.jsx("span",{className:"font-medium capitalize",children:e.category})]}),"po"===e.status&&e.estimatedReady&&ke.jsxs("div",{className:"flex justify-between",children:[ke.jsx("span",{className:"text-gray-600",children:"Estimasi Ready:"}),ke.jsx("span",{className:"font-medium",children:e.estimatedReady.toLocaleDateString("id-ID")})]}),ke.jsxs("div",{className:"flex justify-between",children:[ke.jsx("span",{className:"text-gray-600",children:"Berat:"}),ke.jsxs("span",{className:"font-medium",children:[e.weight," gram"]})]}),ke.jsxs("div",{className:"flex justify-between",children:[ke.jsx("span",{className:"text-gray-600",children:"Kondisi:"}),ke.jsx("span",{className:"font-medium text-green-600",children:"Baru"})]}),ke.jsxs("div",{className:"flex justify-between",children:[ke.jsx("span",{className:"text-gray-600",children:"Garansi:"}),ke.jsx("span",{className:"font-medium",children:"Garansi Toko"})]})]})]}),ke.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 shadow-lg z-50",children:[ke.jsxs("div",{className:"flex space-x-3",children:[ke.jsxs("button",{onClick:()=>{var s,i,a;if(!t)return void r();if((null==(s=e.variants)?void 0:s.sizes)&&e.variants.sizes.length>0&&(!p||!x))return void alert("Pilih ukuran dan warna terlebih dahulu");const o=S();if(w>o){const t=(null==(i=e.variants)?void 0:i.sizes)&&e.variants.sizes.length>0?`Stok tidak mencukupi! Stok tersedia untuk ${p} - ${x} adalah ${o} pcs`:`Stok tidak mencukupi! Stok tersedia adalah ${o} pcs`;return void alert(t)}const l=(null==(a=e.variants)?void 0:a.sizes)&&e.variants.sizes.length>0?{size:p,color:x}:null;n(e,l,w),g(""),y(""),N(1)},disabled:!(!((null==(u=e.variants)?void 0:u.sizes)&&e.variants.sizes.length>0)||p&&x),className:"flex-1 bg-pink-100 text-pink-600 py-4 rounded-lg font-semibold hover:bg-pink-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:[ke.jsx(v,{className:"w-5 h-5"}),ke.jsx("span",{children:"Tambah ke Keranjang"})]}),ke.jsx("button",{onClick:()=>{var s,n,a;if(!t)return void r();if((null==(s=e.variants)?void 0:s.sizes)&&e.variants.sizes.length>0&&(!p||!x))return void alert("Pilih ukuran dan warna terlebih dahulu");const o=S();if(w>o){const t=(null==(n=e.variants)?void 0:n.sizes)&&e.variants.sizes.length>0?`Stok tidak mencukupi! Stok tersedia untuk ${p} - ${x} adalah ${o} pcs`:`Stok tidak mencukupi! Stok tersedia adalah ${o} pcs`;return void alert(t)}const l=(null==(a=e.variants)?void 0:a.sizes)&&e.variants.sizes.length>0?{size:p,color:x}:null;i(e,l,w)},disabled:!(!((null==(h=e.variants)?void 0:h.sizes)&&e.variants.sizes.length>0)||p&&x),className:"flex-1 bg-gradient-to-r from-pink-500 to-purple-600 text-white py-4 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"Beli Sekarang"})]}),(null==(m=e.variants)?void 0:m.sizes)&&e.variants.sizes.length>0&&(!p||!x)&&ke.jsx("p",{className:"text-center text-sm text-gray-500 mt-2",children:"Pilih ukuran dan warna terlebih dahulu"})]})]})},Zb=()=>{const[t,s]=f.useState([]),[r,n]=f.useState(!0),[i,a]=f.useState(null);return f.useEffect(()=>{let t=null;return g(e,null,function*(){try{if(n(!0),a(null),!Ub.currentUser)return s([]),void n(!1);const e=yield Qb.getCart();s(e),t=Qb.onCartChange(e=>{s(e),n(!1),a(null)})}catch(e){console.error(" Error setting up cart listener:",e),a(e instanceof Error?e.message:"Unknown error"),n(!1)}}),()=>{t&&t()}},[]),{cartItems:t,loading:r,error:i}},ev=({user:t,onBack:s,onCheckout:r})=>{const{cartItems:n,loading:i,error:a}=Zb(),o=(t,s,r)=>g(e,null,function*(){try{const e=n.find(e=>e.productId===t&&JSON.stringify(e.variant)===JSON.stringify(s));if(!e)return void console.error(" Item not found in cart");0===r?yield Qb.removeFromCart(e.id):yield Qb.updateQuantity(e.id,r)}catch(e){console.error(" Failed to update quantity:",e)}});if(i)return ke.jsxs("div",{className:"min-h-screen bg-gray-50",children:[ke.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:ke.jsxs("div",{className:"flex items-center p-4",children:[ke.jsx("button",{onClick:s,className:"mr-4",children:ke.jsx(P,{className:"w-6 h-6 text-gray-600"})}),ke.jsx("h1",{className:"text-lg font-semibold",children:"Keranjang Belanja"})]})}),ke.jsxs("div",{className:"flex flex-col items-center justify-center h-96",children:[ke.jsx("div",{className:"w-16 h-16 border-4 border-gray-300 border-t-pink-500 rounded-full animate-spin mb-4"}),ke.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"Memuat Keranjang..."})]})]});if(a)return ke.jsxs("div",{className:"min-h-screen bg-gray-50",children:[ke.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:ke.jsxs("div",{className:"flex items-center p-4",children:[ke.jsx("button",{onClick:s,className:"mr-4",children:ke.jsx(P,{className:"w-6 h-6 text-gray-600"})}),ke.jsx("h1",{className:"text-lg font-semibold",children:"Keranjang Belanja"})]})}),ke.jsxs("div",{className:"flex flex-col items-center justify-center h-96",children:[ke.jsx(M,{className:"w-16 h-16 text-red-300 mb-4"}),ke.jsx("h3",{className:"text-lg font-semibold text-red-600 mb-2",children:"Error Loading Cart"}),ke.jsx("p",{className:"text-gray-500 text-center mb-6",children:a}),ke.jsx("button",{onClick:s,className:"bg-gradient-to-r from-pink-500 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition-all",children:"Kembali"})]})]});if(0===n.length)return ke.jsxs("div",{className:"min-h-screen bg-gray-50",children:[ke.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:ke.jsxs("div",{className:"flex items-center p-4",children:[ke.jsx("button",{onClick:s,className:"mr-4",children:ke.jsx(P,{className:"w-6 h-6 text-gray-600"})}),ke.jsx("h1",{className:"text-lg font-semibold",children:"Keranjang Belanja"})]})}),ke.jsxs("div",{className:"flex flex-col items-center justify-center h-96",children:[ke.jsx(M,{className:"w-16 h-16 text-gray-300 mb-4"}),ke.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"Keranjang Kosong"}),ke.jsxs("p",{className:"text-gray-500 text-center mb-6",children:["Belum ada produk di keranjang Anda.",ke.jsx("br",{}),"Yuk mulai belanja!"]}),ke.jsx("button",{onClick:s,className:"bg-gradient-to-r from-pink-500 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition-all",children:"Mulai Belanja"})]})]});const l=n.reduce((e,t)=>t?e+(t.price||0)*(t.quantity||1):e,0);return ke.jsxs("div",{className:"min-h-screen bg-gray-50 pb-32",children:[ke.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:ke.jsxs("div",{className:"flex items-center p-4",children:[ke.jsx("button",{onClick:s,className:"mr-4",children:ke.jsx(P,{className:"w-6 h-6 text-gray-600"})}),ke.jsx("h1",{className:"text-lg font-semibold",children:"Keranjang Belanja"}),ke.jsx("span",{className:"ml-2 bg-pink-100 text-pink-600 text-xs px-2 py-1 rounded-full",children:n.length})]})}),ke.jsx("div",{className:"p-4 space-y-4",children:n.map((t,s)=>{if(!t)return console.error(" Cart item is null or undefined at index:",s),null;const r=t.price||0,i=t.quantity||1,a=r*i,l=t.name||"Product",c=t.image||`data:image/svg+xml;base64,${btoa('<svg width="80" height="80" xmlns="http://www.w3.org/2000/svg"><rect width="80" height="80" fill="#f3f4f6"/><text x="40" y="45" text-anchor="middle" fill="#6b7280" font-size="12" font-family="Arial">Product</text></svg>')}`,d=t.productId||t.id||`product-${s}`,u=t.variant||{};return ke.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:ke.jsxs("div",{className:"flex space-x-4",children:[ke.jsx("img",{src:c,alt:l,className:"w-20 h-20 object-cover rounded-lg"}),ke.jsxs("div",{className:"flex-1",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-1",children:l}),u&&(u.size||u.color)&&ke.jsxs("p",{className:"text-sm text-gray-500 mb-2",children:["Ukuran: ",u.size||"Standard"," | Warna: ",u.color||"Default"]}),ke.jsxs("div",{className:"flex items-center justify-between",children:[ke.jsx("div",{className:"flex flex-col",children:ke.jsxs("span",{className:"text-lg font-bold text-pink-600",children:["Rp ",r.toLocaleString("id-ID")]})}),ke.jsx("div",{className:"flex items-center space-x-3",children:ke.jsxs("div",{className:"flex items-center space-x-2 bg-gray-100 rounded-lg p-1",children:[i>1?ke.jsx("button",{onClick:()=>o(d,u,i-1),className:"w-8 h-8 flex items-center justify-center rounded-md hover:bg-gray-200 transition-colors",children:ke.jsx(O,{className:"w-4 h-4"})}):ke.jsx("button",{onClick:()=>((t,s)=>g(e,null,function*(){try{const e=n.find(e=>e.productId===t&&JSON.stringify(e.variant)===JSON.stringify(s));if(!e)return void console.error(" Item not found in cart");yield Qb.removeFromCart(e.id)}catch(e){console.error(" Failed to remove from cart:",e)}}))(d,u),className:"w-8 h-8 flex items-center justify-center text-red-500 hover:bg-red-50 rounded-md transition-colors",children:ke.jsx(F,{className:"w-4 h-4"})}),ke.jsx("span",{className:"w-8 text-center font-semibold",children:i}),ke.jsx("button",{onClick:()=>o(d,u,i+1),className:"w-8 h-8 flex items-center justify-center rounded-md hover:bg-gray-200 transition-colors",children:ke.jsx(L,{className:"w-4 h-4"})})]})})]}),ke.jsxs("div",{className:"mt-2 text-right",children:[ke.jsx("span",{className:"text-sm text-gray-600",children:"Subtotal: "}),ke.jsxs("span",{className:"font-semibold text-gray-800",children:["Rp ",a.toLocaleString("id-ID")]})]})]})]})},`${d}-${u.size||"default"}-${u.color||"default"}`)}).filter(Boolean)}),ke.jsxs("div",{className:"fixed bottom-20 left-0 right-0 bg-white border-t border-gray-200 p-4 shadow-lg",children:[ke.jsxs("div",{className:"flex items-center justify-between mb-3",children:[ke.jsxs("span",{className:"text-gray-600",children:["Total (",n.length," item)"]}),ke.jsxs("span",{className:"text-xl font-bold text-pink-600",children:["Rp ",l.toLocaleString("id-ID")]})]}),ke.jsx("button",{onClick:r,className:"w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-4 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition-all",children:"Checkout Sekarang"})]})]})},tv=new class{constructor(){m(this,"collection","user_addresses")}getUserAddresses(){return g(this,null,function*(){try{const e=Ub.currentUser;if(!e)throw new Error("User not authenticated");console.log(" Loading addresses from Firebase for user:",e.uid);const t=Up(Qm(Fb,this.collection),Bp("userId","==",e.uid)),s=yield lg(t),r=[];return s.forEach(e=>{const t=e.data();r.push(u(d({},t),{id:e.id,createdAt:t.createdAt||(new Date).toISOString(),updatedAt:t.updatedAt||t.createdAt||(new Date).toISOString()}))}),console.log(" Addresses loaded from Firebase:",r.length,"addresses"),r}catch(e){return console.error(" Error getting user addresses:",e),[]}})}onAddressesChange(e){const t=Ub.currentUser;return t?(console.log(" Setting up real-time address listener for user:",t.uid),mg(Up(Qm(Fb,this.collection),Bp("userId","==",t.uid)),t=>{const s=[];t.forEach(e=>{const t=e.data();s.push(u(d({},t),{id:e.id,createdAt:t.createdAt||(new Date).toISOString(),updatedAt:t.updatedAt||t.createdAt||(new Date).toISOString()}))}),console.log(" Real-time addresses update:",s.length,"addresses"),e(s)},e=>{console.error(" Real-time address listener error:",e)})):(console.log(" No user for real-time address listener"),()=>{})}saveAddress(e){return g(this,null,function*(){try{const t=Ub.currentUser;if(!t)throw new Error("User not authenticated");console.log(" Saving address to Firebase..."),e.isDefault&&(yield this.unsetAllDefaultAddressesInFirebase(t.uid));const s=u(d({},e),{id:this.generateId(),userId:t.uid,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}),r=Ym(Fb,this.collection,s.id);return yield cg(r,s),console.log(" Address saved to Firebase:",s.id),s}catch(t){throw console.error(" Error saving address:",t),t}})}updateAddress(e,t){return g(this,null,function*(){try{const s=Ub.currentUser;if(!s)throw new Error("User not authenticated");const r=Ym(Fb,this.collection,e),n=yield ag(r);if(!n.exists()||n.data().userId!==s.uid)throw new Error("Address not found");t.isDefault&&(yield this.unsetAllDefaultAddressesInFirebase(s.uid));const i=u(d(d({},n.data()),t),{updatedAt:(new Date).toISOString()});return yield cg(r,i),console.log(" Address updated in Firebase:",e),i}catch(s){throw console.error(" Error updating address:",s),s}})}deleteAddress(e){return g(this,null,function*(){try{const t=Ub.currentUser;if(!t)throw new Error("User not authenticated");console.log(" Deleting address from Firebase:",e);const s=Ym(Fb,this.collection,e),r=yield ag(s);if(!r.exists()||r.data().userId!==t.uid)throw new Error("Address not found");const n=r.data().isDefault;if(yield ug(s),console.log(" Address deleted from Firebase:",e),n){const e=yield this.getUserAddresses();e.length>0&&(yield this.setAsDefault(e[0].id))}}catch(t){throw console.error(" Error deleting address:",t),t}})}setAsDefault(e){return g(this,null,function*(){try{const t=Ub.currentUser;if(!t)throw new Error("User not authenticated");return yield this.unsetAllDefaultAddressesInFirebase(t.uid),yield this.updateAddress(e,{isDefault:!0})}catch(t){throw console.error(" Error setting default address:",t),t}})}getDefaultAddress(){return g(this,null,function*(){try{return(yield this.getUserAddresses()).find(e=>e.isDefault)||null}catch(e){return console.error(" Error getting default address:",e),null}})}getAddressById(e){return g(this,null,function*(){try{const t=Ub.currentUser;if(!t)throw new Error("User not authenticated");const s=Ym(Fb,this.collection,e),r=yield ag(s);if(!r.exists()||r.data().userId!==t.uid)return null;const n=r.data();return u(d({},n),{createdAt:n.createdAt||(new Date).toISOString(),updatedAt:n.updatedAt||n.createdAt||(new Date).toISOString()})}catch(t){return console.error(" Error getting address by ID:",t),null}})}unsetAllDefaultAddressesInFirebase(e){return g(this,null,function*(){try{const t=Up(Qm(Fb,this.collection),Bp("userId","==",e),Bp("isDefault","==",!0)),s=(yield lg(t)).docs.map(e=>cg(e.ref,{isDefault:!1,updatedAt:(new Date).toISOString()},{merge:!0}));yield Promise.all(s),console.log(" All default addresses unset in Firebase")}catch(t){throw console.error(" Error unsetting default addresses:",t),t}})}generateId(){return Date.now().toString(36)+Math.random().toString(36).substring(2)}formatAddress(e){return[e.fullAddress,e.subdistrict,e.district,e.city,e.province,e.postalCode].filter(Boolean).join(", ")}getShortAddress(e){return[e.subdistrict,e.district,e.city,e.province].filter(Boolean).join(", ")}},sv=({initialData:t,onSave:s,onCancel:r})=>{const[n,i]=f.useState({name:(null==t?void 0:t.name)||"",phone:(null==t?void 0:t.phone)||"",fullAddress:(null==t?void 0:t.fullAddress)||"",province:(null==t?void 0:t.province)||"",provinceId:(null==t?void 0:t.provinceId)||"",city:(null==t?void 0:t.city)||"",cityId:(null==t?void 0:t.cityId)||"",district:(null==t?void 0:t.district)||"",districtId:(null==t?void 0:t.districtId)||"",subdistrict:(null==t?void 0:t.subdistrict)||"",subdistrictId:(null==t?void 0:t.subdistrictId)||"",postalCode:(null==t?void 0:t.postalCode)||"",isDefault:(null==t?void 0:t.isDefault)||!1}),[a,o]=f.useState([]),[l,c]=f.useState([]),[h,m]=f.useState([]),[p,x]=f.useState([]),[y,b]=f.useState(!1),[v,w]=f.useState(!1),[N,j]=f.useState(!1),[k,I]=f.useState(!1),[S,_]=f.useState(""),[E,T]=f.useState({}),[C,A]=f.useState(new Map);f.useEffect(()=>{P(),["11","12","31","34","10","6"].forEach(t=>g(e,null,function*(){try{const e=`cities_${t}`;if(!C.has(e)){const s=yield fetch(`/api/address-cached?type=cities&provinceId=${t}`),r=yield s.json();r.success&&r.data&&A(t=>new Map(t).set(e,r.data))}}catch(e){}}))},[]),f.useEffect(()=>{n.provinceId&&(D(),m([]),x([]),i(e=>u(d({},e),{city:"",cityId:"",district:"",districtId:"",subdistrict:"",subdistrictId:"",postalCode:""})))},[n.provinceId]),f.useEffect(()=>{n.cityId&&(R(),x([]),i(e=>u(d({},e),{district:"",districtId:"",subdistrict:"",subdistrictId:"",postalCode:""})))},[n.cityId]),f.useEffect(()=>{n.districtId&&(O(),i(e=>u(d({},e),{subdistrict:"",subdistrictId:"",postalCode:""})))},[n.districtId]);const P=()=>g(e,null,function*(){b(!0);try{const e="provinces";if(C.has(e)){const t=C.get(e);return void o(t)}const t=yield fetch("/api/address-cached?type=provinces"),s=yield t.json();s.success&&s.data?(o(s.data),A(t=>new Map(t).set(e,s.data))):console.error(" Failed to load provinces from cache:",s.message)}catch(e){console.error("Error loading provinces from cache:",e)}finally{b(!1)}}),D=()=>g(e,null,function*(){if(n.provinceId){w(!0);try{const e=`cities_${n.provinceId}`;if(C.has(e)){const t=C.get(e);return void c(t)}const t=yield fetch(`/api/address-cached?type=cities&provinceId=${n.provinceId}`),s=yield t.json();s.success&&s.data?(c(s.data),A(t=>new Map(t).set(e,s.data))):console.error(" Failed to load cities:",s.message)}catch(e){console.error("Error loading cities:",e)}finally{w(!1)}}}),R=()=>g(e,null,function*(){if(n.cityId){j(!0);try{const e=`districts_${n.cityId}`;if(C.has(e)){const t=C.get(e);return void m(t)}const t=yield fetch(`/api/address-cached?type=districts&cityId=${n.cityId}`),s=yield t.json();s.success&&s.data?(m(s.data),A(t=>new Map(t).set(e,s.data))):console.error(" Failed to load districts:",s.message)}catch(e){console.error("Error loading districts:",e)}finally{j(!1)}}}),O=()=>g(e,null,function*(){if(n.districtId){I(!0);try{const e=`subdistricts_${n.districtId}`;if(C.has(e)){const t=C.get(e);return void x(t)}const t=yield fetch(`/api/address-cached?type=subdistricts&districtId=${n.districtId}`),s=yield t.json();s.success&&s.data?(x(s.data),A(t=>new Map(t).set(e,s.data))):console.error(" Failed to load subdistricts:",s.message)}catch(e){console.error("Error loading subdistricts:",e)}finally{I(!1)}}}),L=e=>{const{name:t,value:s,type:r}=e.target;let n="checkbox"===r?e.target.checked:s;i(e=>{const r=u(d({},e),{[t]:n});if("provinceId"===t){const e=a.find(e=>e.province_id===s);e&&(r.province=e.province)}if("cityId"===t){const e=l.find(e=>e.city_id===s);e&&(r.city=`${e.type} ${e.city_name}`)}if("districtId"===t){const e=h.find(e=>e.district_id===s);e&&(r.district=e.district_name)}if("subdistrictId"===t){const e=p.find(e=>e.subdistrict_id===s);e&&(r.subdistrict=e.subdistrict_name)}return r}),E[t]&&T(e=>u(d({},e),{[t]:void 0}))};return ke.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),(()=>{const e={};return n.name.trim()||(e.name="Nama harus diisi"),n.phone.trim()||(e.phone="Nomor telepon harus diisi"),n.provinceId||(e.provinceId="Provinsi harus diisi"),n.cityId||(e.cityId="Kota harus diisi"),n.districtId||(e.districtId="Kecamatan harus diisi"),n.subdistrictId||(e.subdistrictId="Kelurahan harus diisi"),n.postalCode.trim()||(e.postalCode="Kode pos harus diisi"),T(e),0===Object.keys(e).length})()){const e=`${n.fullAddress}, ${n.subdistrict}, ${n.district}, ${n.city}, ${n.province}`,t=u(d({},n),{fullAddress:e});s(t)}},className:"space-y-4",children:[S&&ke.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:ke.jsxs("div",{className:"flex items-center text-red-800",children:[ke.jsx(U,{className:"w-4 h-4 mr-2"}),ke.jsx("span",{className:"text-sm",children:S})]})}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nama Lengkap *"}),ke.jsx("input",{type:"text",name:"name",value:n.name,onChange:L,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(E.name?"border-red-500":"border-gray-300"),placeholder:"Masukkan nama lengkap"}),E.name&&ke.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.name})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nomor Telepon *"}),ke.jsx("input",{type:"tel",name:"phone",value:n.phone,onChange:L,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(E.phone?"border-red-500":"border-gray-300"),placeholder:"Masukkan nomor telepon aktif"}),E.phone&&ke.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.phone})]}),ke.jsxs("div",{children:[ke.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[ke.jsx(V,{className:"w-4 h-4 inline mr-1"}),"Provinsi *"]}),ke.jsxs("select",{name:"provinceId",value:n.provinceId,onChange:L,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(E.provinceId?"border-red-500":"border-gray-300"),disabled:y,children:[ke.jsx("option",{value:"",children:"Pilih provinsi"}),a.map(e=>ke.jsx("option",{value:e.province_id,children:e.province},e.province_id))]}),y&&ke.jsxs("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:[ke.jsx(B,{className:"w-4 h-4 animate-spin mr-1"}),"Memuat provinsi..."]}),E.provinceId&&ke.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.provinceId})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kota/Kabupaten *"}),ke.jsxs("select",{name:"cityId",value:n.cityId,onChange:L,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(E.cityId?"border-red-500":"border-gray-300"),disabled:!n.provinceId||v,children:[ke.jsx("option",{value:"",children:"Pilih kota/kabupaten"}),l.map(e=>ke.jsxs("option",{value:e.city_id,children:[e.type," ",e.city_name]},e.city_id))]}),v&&ke.jsxs("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:[ke.jsx(B,{className:"w-4 h-4 animate-spin mr-1"}),"Memuat kota..."]}),E.cityId&&ke.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.cityId})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kecamatan *"}),ke.jsxs("select",{name:"districtId",value:n.districtId,onChange:L,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(E.districtId?"border-red-500":"border-gray-300"),disabled:!n.cityId||N,children:[ke.jsx("option",{value:"",children:"Pilih kecamatan"}),h.map(e=>ke.jsx("option",{value:e.district_id,children:e.district_name},e.district_id))]}),N&&ke.jsxs("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:[ke.jsx(B,{className:"w-4 h-4 animate-spin mr-1"}),"Memuat kecamatan..."]}),E.districtId&&ke.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.districtId})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kelurahan/Desa *"}),ke.jsxs("select",{name:"subdistrictId",value:n.subdistrictId,onChange:L,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(E.subdistrictId?"border-red-500":"border-gray-300"),disabled:!n.districtId||k,children:[ke.jsx("option",{value:"",children:"Pilih kelurahan/desa"}),p.map(e=>ke.jsx("option",{value:e.subdistrict_id,children:e.subdistrict_name},e.subdistrict_id))]}),k&&ke.jsxs("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:[ke.jsx(B,{className:"w-4 h-4 animate-spin mr-1"}),"Memuat kelurahan/desa..."]}),E.subdistrictId&&ke.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.subdistrictId})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kode Pos *"}),ke.jsx("input",{type:"text",name:"postalCode",value:n.postalCode,onChange:L,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(E.postalCode?"border-red-500":"border-gray-300"),placeholder:"Masukkan kode pos",maxLength:5}),E.postalCode&&ke.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.postalCode})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Alamat Detail (Jalan, RT/RW, No. Rumah) *"}),ke.jsx("textarea",{name:"fullAddress",value:n.fullAddress,onChange:L,rows:3,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(E.fullAddress?"border-red-500":"border-gray-300"),placeholder:"Contoh: Jl. Merdeka No. 123, RT 001/RW 002"}),E.fullAddress&&ke.jsx("p",{className:"text-red-500 text-xs mt-1",children:E.fullAddress})]}),ke.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:ke.jsxs("p",{className:"text-sm text-blue-800",children:[ke.jsx("strong",{children:"Preview Alamat:"}),ke.jsx("br",{}),n.fullAddress&&`${n.fullAddress}, `,n.subdistrict,", ",n.district,", ",n.city,", ",n.province,", ",n.postalCode]})}),ke.jsxs("div",{className:"flex items-center",children:[ke.jsx("input",{type:"checkbox",name:"isDefault",checked:n.isDefault,onChange:L,className:"w-4 h-4 text-pink-600 border-gray-300 rounded focus:ring-pink-500"}),ke.jsx("label",{className:"ml-2 text-sm text-gray-700",children:"Jadikan alamat utama"})]}),ke.jsxs("div",{className:"flex space-x-3 pt-4",children:[ke.jsx("button",{type:"button",onClick:r,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Batal"}),ke.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition-colors font-medium",children:t?"Update":"Simpan"})]})]})},rv=[{code:"jnt",name:"J&T Express"},{code:"jne",name:"Jalur Nugraha Ekakurir (JNE)"},{code:"pos",name:"POS Indonesia"},{code:"tiki",name:"TIKI"},{code:"ide",name:"IDExpress"},{code:"lion",name:"Lion Parcel"}],nv=new class{constructor(){m(this,"baseUrl","/api/rajaongkir"),m(this,"useCache",!0)}calculateShippingCost(e,t,s,r,n="lowest"){return g(this,null,function*(){try{const i=this.useCache?`${this.baseUrl}/cost-cached`:`${this.baseUrl}/cost`;console.log(` Using ${this.useCache?"CACHED":"DIRECT"} endpoint:`,i);const a=yield fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({origin:e,destination:t,weight:s,courier:r,price:n,getAllCouriers:!1})});if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);const o=yield a.json();if("success"===o.meta.status&&o.data)return o.data;throw new Error(o.meta.message)}catch(i){throw i}})}getAllCouriersCost(e,t,s,r="lowest"){return g(this,null,function*(){try{const n=this.useCache?`${this.baseUrl}/cost-cached`:`${this.baseUrl}/cost`;console.log(` Using ${this.useCache?"CACHED":"DIRECT"} endpoint:`,n);const i=yield fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({origin:e,destination:t,weight:s,courier:"all",price:r,getAllCouriers:!0})});if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);const a=yield i.json();if("success"===a.meta.status&&a.data)return a.data;throw new Error(a.meta.message)}catch(n){throw n}})}isCourierSupported(e){return rv.some(t=>t.code===e)}getCourierName(e){const t=rv.find(t=>t.code===e);return(null==t?void 0:t.name)||e.toUpperCase()}formatFullAddress(e){return[e.subdistrict,e.district,e.cityName,e.provinceName].filter(Boolean).join(", ")}},iv=({user:t,clearCart:s,onBack:r})=>{const[n,i]=f.useState([]),[a,o]=f.useState(!0);f.useEffect(()=>{g(e,null,function*(){try{o(!0);const e=yield Qb.getCart();i(e||[])}catch(e){console.error("Failed to load cart for checkout:",e),i([])}finally{o(!1)}})},[t]);const[l,c]=f.useState(!1),[h,m]=f.useState(""),[p,x]=f.useState(null),[y,b]=f.useState([]),[v,w]=f.useState(!0);f.useEffect(()=>{const e=tv.onAddressesChange(e=>{b(e)});return()=>e()},[]);const N=()=>y.find(e=>e.isDefault)||y[0],[j,k]=f.useState(!1),[I,_]=f.useState([]),[E,T]=f.useState(""),[C,A]=f.useState(null),D=()=>n.reduce((e,t)=>{var s;const r=(null==(s=t.product)?void 0:s.weight)||t.weight||1e3;return e+t.quantity*r},0),R=(t,s,r)=>g(e,null,function*(){if(!t||!s||!r)return;s&&"undefined"!==s&&""!==s||(s="607");try{k(!0),T("");const e="jnt"===t&&n.length>1?Math.max(r,1e3):r,i=yield nv.calculateShippingCost("2425",s,e,t);if(i&&i.length>0){_(i);const e=i[0];A(e),M(t=>u(d({},t),{shippingCost:e.cost,shippingService:e.service,shippingETD:e.etd}))}else T("Tidak dapat menghitung ongkir untuk kurir ini")}catch(i){console.error("Error calculating shipping cost:",i),T("Gagal menghitung ongkir. Silakan coba lagi.")}finally{k(!1)}const e=setTimeout(()=>{k(!1)},100);return()=>clearTimeout(e)}),[O,M]=f.useState({name:(null==t?void 0:t.name)||"",phone:"",address:"",provinceId:"",cityId:"",isDropship:!1,dropshipName:"",dropshipPhone:"",paymentMethod:"transfer",shippingCourier:"jnt",shippingCost:0,shippingService:"",shippingETD:"",notes:""}),V=[{id:"jnt",name:"J&T Express",code:"jnt",price:0},{id:"jne",name:"JNE",code:"jne",price:0},{id:"pos",name:"POS Indonesia",code:"pos",price:0},{id:"tiki",name:"TIKI",code:"tiki",price:0},{id:"ojek",name:"OJEK",code:null,price:0},{id:"lion",name:"Lion Parcel",code:"lion",price:0},{id:"idexpress",name:"IDExpress",code:"ide",price:0}];f.useEffect(()=>{if(y.length>0&&!h){const e=N();e&&(m(e.id),M(t=>u(d({},t),{name:t.isDropship?t.name:e.name,phone:t.isDropship?t.phone:e.phone,address:e.fullAddress,provinceId:e.provinceId||"607",cityId:e.cityId||"607"})))}const e=V.find(e=>e.code);e&&!O.shippingCourier&&M(t=>u(d({},t),{shippingCourier:e.id}))},[y,h,O.isDropship]),f.useEffect(()=>{const e=N(),t=V.find(e=>e.id===O.shippingCourier);if((null==t?void 0:t.code)&&e&&O.shippingCourier){const s=D(),r=e.subdistrictId||e.cityId||"607",n=setTimeout(()=>{R(t.code,r,s)},25);return()=>clearTimeout(n)}},[O.shippingCourier,h,y.length]);const G=e=>{const{name:t,value:s,type:r}=e.target,n="checkbox"===r?e.target.checked:"number"===r?parseInt(s)||0:s;if(M(e=>u(d({},e),{[t]:n})),"shippingCourier"===t)return V.find(e=>e.id===s),M(e=>u(d({},e),{shippingCourier:n,shippingCost:0,shippingService:"",shippingETD:""})),_([]),void A(null)};f.useEffect(()=>{const e=N();e&&(m(e.id),M(t=>u(d({},t),{name:e.name,phone:e.phone,address:e.fullAddress})))},[y]);const H=t=>{if(window.confirm("Apakah Anda yakin ingin menghapus alamat ini?")&&((t=>{g(e,null,function*(){try{yield tv.deleteAddress(t)}catch(e){throw console.error("Failed to delete address:",e),e}})})(t),h===t)){const e=N();e&&(e=>{m(e);const t=y.find(t=>t.id===e);if(t){M(e=>u(d({},e),{name:O.isDropship?e.name:t.name,phone:O.isDropship?e.phone:t.phone,address:O.isDropship?e.address:t.fullAddress}));const e=V.find(e=>e.id===O.shippingCourier);if(null==e?void 0:e.code){const s=D(),r=t.subdistrictId||t.cityId||"607";setTimeout(()=>{R(e.code,r,s)},25)}}})(e.id)}},W=(e,t)=>{navigator.clipboard.writeText(e),alert(` Nomor rekening ${t} berhasil disalin!\n\n${e}\na.n. Fahrin`)},J=n.reduce((e,t)=>t?e+(t.price||0)*(t.quantity||1):e,0),Q=O.shippingCost||0,Y=J+Q,X=V.find(e=>e.id===O.shippingCourier),Z=!!(null==X?void 0:X.code);return ke.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[ke.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:ke.jsxs("div",{className:"flex items-center p-4",children:[ke.jsx("button",{onClick:r,className:"mr-4",children:ke.jsx(P,{className:"w-6 h-6 text-gray-600"})}),ke.jsx("h1",{className:"text-lg font-semibold",children:"Checkout"})]})}),ke.jsxs("div",{className:"p-4 space-y-4",children:[ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsx("h3",{className:"font-semibold mb-3",children:"Produk Pesanan"}),ke.jsx("div",{className:"space-y-3",children:n.map((e,t)=>{if(!e)return null;const s=e.name||"Product",r=e.image||`data:image/svg+xml;base64,${btoa('<svg width="80" height="80" xmlns="http://www.w3.org/2000/svg"><rect width="80" height="80" fill="#f3f4f6"/><text x="40" y="45" text-anchor="middle" fill="#6b7280" font-size="12" font-family="Arial">Product</text></svg>')}`,n=e.price||0,i=e.quantity||1,a=e.variant||{},o=e.productId||e.id||`product-${t}`;return ke.jsxs("div",{className:"flex space-x-3",children:[ke.jsx("img",{src:r,alt:s,className:"w-16 h-16 object-cover rounded-lg"}),ke.jsxs("div",{className:"flex-1",children:[ke.jsx("h4",{className:"font-medium text-sm",children:s}),a&&(a.size||a.color)&&ke.jsxs("p",{className:"text-xs text-gray-500",children:[a.size||"Standard"," - ",a.color||"Default"]}),ke.jsxs("div",{className:"flex justify-between items-center mt-1",children:[ke.jsxs("span",{className:"text-sm font-semibold text-pink-600",children:["Rp ",n.toLocaleString("id-ID")]}),ke.jsxs("span",{className:"text-sm text-gray-500",children:["x",i]})]})]})]},`${o}-${a.size||"default"}-${a.color||"default"}`)}).filter(Boolean)})]}),ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsx("h3",{className:"font-semibold mb-3",children:"Informasi Penerima"}),ke.jsxs("div",{className:"space-y-4",children:[ke.jsxs("div",{children:[ke.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[ke.jsx(S,{className:"w-4 h-4 inline mr-1"}),"Nama Penerima"]}),ke.jsx("input",{type:"text",name:"name",value:O.name,onChange:G,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Masukkan nama penerima"})]}),ke.jsxs("div",{children:[ke.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[ke.jsx(z,{className:"w-4 h-4 inline mr-1"}),"Nomor Telepon"]}),ke.jsx("input",{type:"tel",name:"phone",value:O.phone,onChange:G,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Masukkan nomor telepon"})]})]})]}),ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsx("h3",{className:"font-semibold mb-3",children:"Pilih Kurir Pengiriman"}),ke.jsxs("div",{className:"space-y-3",children:[ke.jsxs("div",{children:[ke.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[ke.jsx($,{className:"w-4 h-4 inline mr-1"}),"Kurir"]}),ke.jsx("select",{name:"shippingCourier",value:O.shippingCourier,onChange:G,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",children:V.map(e=>ke.jsxs("option",{value:e.id,children:[e.name," ",e.code?"( Otomatis)":"(Manual)"]},e.id))}),ke.jsx("div",{className:"mt-2 text-xs text-gray-500",children:Z?ke.jsx("div",{className:"text-green-600",children:" Otomatis via RajaOngkir dari Banjarmasin"}):ke.jsx("div",{className:"text-amber-600",children:" Kurir lokal - biaya diinput manual"})}),j&&ke.jsxs("div",{className:"mt-2 flex items-center text-sm text-blue-600",children:[ke.jsx(B,{className:"w-4 h-4 animate-spin mr-1"}),"Menghitung ongkir..."]}),E&&ke.jsxs("div",{className:"mt-2 text-sm text-red-600 flex items-center",children:[ke.jsx(U,{className:"w-4 h-4 mr-1"}),E]})]}),O.shippingCost>0&&ke.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[I.length>1&&ke.jsxs("div",{className:"mb-3",children:[ke.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Pilih Layanan:"}),ke.jsx("select",{value:(null==C?void 0:C.service)||"",onChange:e=>{const t=I.find(t=>t.service===e.target.value);t&&(A(t),M(e=>u(d({},e),{shippingCost:t.cost,shippingService:t.service,shippingETD:t.etd})))},className:"w-full p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-pink-500 focus:border-transparent",children:I.map((e,t)=>ke.jsxs("option",{value:e.service,children:[e.service," - Rp ",e.cost.toLocaleString("id-ID")," (",e.etd,")"]},t))})]}),ke.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 mb-3",children:[ke.jsxs("div",{className:"flex justify-between items-center text-sm",children:[ke.jsx("span",{className:"font-medium text-blue-800",children:"Berat Produk:"}),ke.jsxs("span",{className:"text-blue-600 font-semibold",children:[(D()/1e3).toFixed(2)," kg"]})]}),ke.jsx("div",{className:"text-xs text-blue-600 mt-1",children:" Smart rounding: 0-1.25kg = 1kg, 1.251-2.25kg = 2kg, dst."})]}),ke.jsxs("div",{className:"flex justify-between items-center",children:[ke.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Biaya Ongkir:"}),ke.jsxs("span",{className:"text-sm font-semibold text-pink-600",children:["Rp ",O.shippingCost.toLocaleString("id-ID")]})]}),O.shippingService&&ke.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Service: ",O.shippingService," | Estimasi: ",O.shippingETD,I.length>1&&ke.jsxs("span",{className:"ml-2 text-blue-600",children:["(",I.length," layanan tersedia)"]})]})]})]})]}),ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsxs("div",{className:"flex justify-between items-center mb-3",children:[ke.jsx("h3",{className:"font-semibold",children:"Alamat Pengiriman"}),ke.jsxs("button",{onClick:()=>c(!0),className:"text-pink-600 hover:text-pink-700 flex items-center text-sm font-medium",children:[ke.jsx(L,{className:"w-4 h-4 mr-1"}),"Tambah Alamat"]})]}),y.length>0&&ke.jsx("div",{className:"space-y-2 mb-4",children:y.map(e=>ke.jsx("label",{className:"block p-3 border rounded-lg cursor-pointer transition-colors "+(h===e.id?"border-pink-500 bg-pink-50":"border-gray-200 hover:border-gray-300"),children:ke.jsxs("div",{className:"flex items-start justify-between",children:[ke.jsxs("div",{className:"flex-1",children:[ke.jsxs("div",{className:"flex items-center mb-1",children:[ke.jsx("input",{type:"radio",name:"savedAddress",checked:h===e.id,onChange:()=>{if(m(e.id),M(t=>u(d({},t),{name:O.isDropship?t.name:e.name,phone:O.isDropship?t.phone:e.phone,address:e.fullAddress,provinceId:e.provinceId||"",cityId:e.cityId||""})),Z&&O.shippingCourier){const t=V.find(e=>e.id===O.shippingCourier);if(null==t?void 0:t.code){const s=D(),r=e.subdistrictId||e.cityId||"607";setTimeout(()=>{R(t.code,r,s)},25)}}},className:"w-4 h-4 text-pink-600 mr-2"}),ke.jsx("span",{className:"font-medium",children:e.name}),e.isDefault&&ke.jsx("span",{className:"ml-2 text-xs bg-green-100 text-green-600 px-2 py-1 rounded-full",children:"Utama"})]}),ke.jsx("p",{className:"text-sm text-gray-600 ml-6",children:e.phone}),ke.jsx("p",{className:"text-sm text-gray-600 ml-6",children:e.fullAddress})]}),ke.jsxs("div",{className:"flex space-x-2",children:[ke.jsx("button",{onClick:t=>{t.stopPropagation(),x(e),c(!0)},className:"text-blue-600 hover:text-blue-700",children:ke.jsx(q,{className:"w-4 h-4"})}),y.length>1&&ke.jsx("button",{onClick:t=>{t.stopPropagation(),H(e.id)},className:"text-red-600 hover:text-red-700",children:ke.jsx(F,{className:"w-4 h-4"})})]})]})},e.id))}),ke.jsx("div",{className:"border-t pt-4",children:!Z&&ke.jsxs("div",{className:"mt-4",children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Biaya Ongkos Kirim (Rp)"}),ke.jsx("input",{type:"number",name:"shippingCost",value:O.shippingCost||"",onChange:G,min:"0",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Masukkan biaya ongkos kirim"}),ke.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"* Masukkan manual biaya ongkos kirim untuk kurir lokal"})]})})]}),ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsx("h3",{className:"font-semibold mb-3",children:"Opsi Tambahan"}),ke.jsx("div",{className:"mb-4",children:ke.jsxs("label",{className:"flex items-center space-x-3",children:[ke.jsx("input",{type:"checkbox",name:"isDropship",checked:O.isDropship,onChange:G,className:"w-4 h-4 text-pink-600 border-gray-300 rounded focus:ring-pink-500"}),ke.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Kirim sebagai dropship"})]})}),O.isDropship&&ke.jsxs("div",{className:"border-t pt-4 space-y-3",children:[ke.jsx("input",{type:"text",name:"dropshipName",value:O.dropshipName,onChange:G,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Nama pengirim dropship"}),ke.jsx("input",{type:"tel",name:"dropshipPhone",value:O.dropshipPhone,onChange:G,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Nomor telepon pengirim"})]}),ke.jsxs("div",{className:"border-t pt-4",children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Catatan Pesanan"}),ke.jsx("textarea",{name:"notes",value:O.notes,onChange:G,rows:3,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Tambahkan catatan untuk pesanan (opsional)"})]})]}),ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsx("h3",{className:"font-semibold mb-3",children:"Metode Pembayaran"}),ke.jsxs("div",{className:"space-y-3",children:[ke.jsxs("label",{className:"flex items-center space-x-3",children:[ke.jsx("input",{type:"radio",name:"paymentMethod",value:"transfer",checked:"transfer"===O.paymentMethod,onChange:G,className:"w-4 h-4 text-pink-600 border-gray-300 focus:ring-pink-500"}),ke.jsx("span",{className:"text-sm font-medium",children:"Transfer Bank"})]}),ke.jsxs("label",{className:"flex items-center space-x-3",children:[ke.jsx("input",{type:"radio",name:"paymentMethod",value:"cod",checked:"cod"===O.paymentMethod,onChange:G,className:"w-4 h-4 text-pink-600 border-gray-300 focus:ring-pink-500"}),ke.jsx("span",{className:"text-sm font-medium",children:"COD (Bayar di Tempat)"})]})]}),"transfer"===O.paymentMethod&&ke.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:[ke.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Transfer ke:"}),ke.jsxs("div",{className:"space-y-2 text-sm",children:[ke.jsxs("div",{className:"flex justify-between items-center",children:[ke.jsx("span",{children:"BCA: 0511456494"}),ke.jsxs("button",{onClick:()=>W("0511456494","BCA"),className:"text-blue-600 hover:text-blue-700 text-xs",children:[ke.jsx(K,{className:"w-3 h-3 inline mr-1"}),"Salin"]})]}),ke.jsxs("div",{className:"flex justify-between items-center",children:[ke.jsx("span",{children:"BRI: 066301000115566"}),ke.jsxs("button",{onClick:()=>W("066301000115566","BRI"),className:"text-blue-600 hover:text-blue-700 text-xs",children:[ke.jsx(K,{className:"w-3 h-3 inline mr-1"}),"Salin"]})]}),ke.jsxs("div",{className:"flex justify-between items-center",children:[ke.jsx("span",{children:"MANDIRI: 310011008896"}),ke.jsxs("button",{onClick:()=>W("310011008896","MANDIRI"),className:"text-blue-600 hover:text-blue-700 text-xs",children:[ke.jsx(K,{className:"w-3 h-3 inline mr-1"}),"Salin"]})]})]}),ke.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"a.n. Fahrin"})]})]}),ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsx("h3",{className:"font-semibold mb-3",children:"Ringkasan Pesanan"}),ke.jsxs("div",{className:"space-y-2",children:[ke.jsxs("div",{className:"flex justify-between",children:[ke.jsx("span",{className:"text-sm text-gray-600",children:"Subtotal Produk"}),ke.jsxs("span",{className:"text-sm font-medium",children:["Rp ",J.toLocaleString("id-ID")]})]}),ke.jsxs("div",{className:"flex justify-between",children:[ke.jsx("span",{className:"text-sm text-gray-600",children:"Biaya Ongkir"}),ke.jsxs("span",{className:"text-sm font-medium",children:["Rp ",Q.toLocaleString("id-ID")]})]}),ke.jsx("div",{className:"border-t pt-2",children:ke.jsxs("div",{className:"flex justify-between",children:[ke.jsx("span",{className:"font-semibold",children:"Total"}),ke.jsxs("span",{className:"font-semibold text-pink-600",children:["Rp ",Y.toLocaleString("id-ID")]})]})})]})]}),ke.jsx("button",{onClick:()=>{if(!O.name||!O.phone||!O.address)return void alert("Mohon lengkapi semua data pengiriman");if(Z&&(!O.shippingCost||O.shippingCost<=0))return void alert("Mohon tunggu perhitungan ongkir selesai atau pilih kurir lain");if(!Z&&(!O.shippingCost||O.shippingCost<=0))return void alert("Mohon masukkan biaya ongkos kirim untuk kurir lokal");const e={items:n.map(e=>u(d({},e),{price:e.price||0,total:(e.price||0)*(e.quantity||1),productName:e.name||e.productName||"Produk",productId:e.productId||e.id,selectedVariant:e.variant})),shippingInfo:{name:O.name,phone:O.phone,address:O.address,isDropship:O.isDropship,dropshipName:O.dropshipName,dropshipPhone:O.dropshipPhone,courier:O.shippingCourier,shippingCost:O.shippingCost>0?O.shippingCost:null,shippingService:O.shippingService,shippingETD:O.shippingETD},paymentMethod:O.paymentMethod,notes:O.notes,totalAmount:J,shippingCost:Q,finalTotal:Y},t=s(e);"transfer"===O.paymentMethod?alert(` Pesanan berhasil dibuat!\n\nID Pesanan: ${t}\nTotal: Rp ${Y.toLocaleString("id-ID")}\n\nSilakan transfer ke:\n BCA: 0511456494\n BRI: 066301000115566\n MANDIRI: 310011008896\n\na.n. Fahrin\n\nKemudian upload bukti pembayaran di menu "Pesanan"`):alert(` Pesanan berhasil dibuat!\n\nID Pesanan: ${t}\nTotal: Rp ${Y.toLocaleString("id-ID")}\n\nPembayaran Cash on Delivery (COD)\nBarang akan dikirim setelah konfirmasi.`),r()},className:"w-full bg-pink-600 text-white py-4 rounded-lg font-semibold hover:bg-pink-700 transition-colors shadow-lg",children:"Buat Pesanan"})]}),l&&ke.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:ke.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[ke.jsx("h3",{className:"text-lg font-semibold mb-4",children:p?"Edit Alamat":"Tambah Alamat Baru"}),ke.jsx(sv,{initialData:p,onSave:t=>{var s,r;p?(s=p.id,r=t,g(e,null,function*(){try{yield tv.updateAddress(s,r)}catch(e){throw console.error("Failed to update address:",e),e}})):(t=>{g(e,null,function*(){try{yield tv.saveAddress(t)}catch(e){throw console.error("Failed to add address:",e),e}})})(t),c(!1),x(null)},onCancel:()=>{c(!1),x(null)}})]})})]})},av=()=>{const[t,s]=f.useState(null),[r,n]=f.useState(!0),[i,a]=f.useState(null);f.useEffect(()=>Ub.onAuthStateChanged(e=>{var t;if(n(!1),e){const r={uid:e.uid,email:e.email||"",displayName:e.displayName||(null==(t=e.email)?void 0:t.split("@")[0])||"",role:l(e.email||"")};s(r)}else s(null)}),[]);const o=(t,s)=>g(e,null,function*(){var e;try{const r=Ym(Fb,"users",t.uid),n={uid:t.uid,email:t.email,displayName:t.displayName||(null==(e=t.email)?void 0:e.split("@")[0])||"",role:s,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};yield cg(r,n,{merge:!0})}catch(r){console.error(" Error saving user profile:",r)}}),l=e=>{const t=e.toLowerCase();return"v4hrin@gmail.com"===t||t.includes("owner")?"owner":t.includes("admin")?"admin":t.includes("reseller")?"reseller":"customer"},c=e=>{switch(e){case"auth/user-not-found":return"Email tidak terdaftar. Silakan coba lagi.";case"auth/wrong-password":return"Password salah. Silakan coba lagi.";case"auth/email-already-in-use":return"Email sudah terdaftar. Silakan gunakan email lain.";case"auth/weak-password":return"Password terlalu lemah. Gunakan minimal 6 karakter.";case"auth/invalid-email":return"Format email tidak valid. Silakan coba lagi.";case"auth/too-many-requests":return"Terlalu banyak percobaan login. Silakan coba lagi nanti.";case"auth/user-disabled":return"Akun dinonaktifkan. Hubungi admin.";default:return"Login gagal. Silakan coba lagi."}};return{user:t,loading:r,error:i,login:(t,r)=>g(e,null,function*(){var e;try{a(null),n(!0);const i=(yield ky(Ub,t,r)).user;if(i){const t=l(i.email||""),r={uid:i.uid,email:i.email||"",displayName:i.displayName||(null==(e=i.email)?void 0:e.split("@")[0])||"",role:t};return yield o(i,t),s(r),r}}catch(i){throw console.error(" Firebase login error:",i),a(c(i.code)),i}finally{n(!1)}}),register:(t,r,i,d)=>g(e,null,function*(){var e;try{a(null),n(!0);const c=yield function(e,t,s){return g(this,null,function*(){if(vs(e.app))return Promise.reject(Vf(e));const r=qx(e),n=Zx(r,{returnSecureToken:!0,email:t,password:s,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",xy),i=yield n.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&jy(e),t}),a=yield yy._fromIdTokenResponse(r,"signIn",i);return yield r._updateCurrentUser(a.user),a})}(Ub,t,r),u=c.user;if(u&&i&&(yield Iy(u,{displayName:i})),u){const t=d||l(u.email||""),r={uid:u.uid,email:u.email||"",displayName:i||(null==(e=u.email)?void 0:e.split("@")[0])||"",role:t};return yield o(u,t),s(r),r}}catch(u){throw console.error(" Firebase registration error:",u),a(c(u.code)),u}finally{n(!1)}}),logout:()=>g(e,null,function*(){try{yield(e=Ub,ot(e).signOut()),s(null)}catch(t){console.error(" Firebase logout error:",t),a(c(t.code))}var e}),isAuthenticated:!!t}},ov=({onSuccess:t,onClose:s,onShowRegister:r})=>{const[n,i]=f.useState(""),[a,o]=f.useState(""),[l,c]=f.useState(!1),{login:d,loading:u,error:h}=av();return ke.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:ke.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[ke.jsxs("div",{className:"flex justify-between items-center mb-6",children:[ke.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Login"}),ke.jsx("button",{onClick:s,className:"text-gray-500 hover:text-gray-700 transition-colors",children:ke.jsx(G,{size:24})})]}),ke.jsxs("form",{onSubmit:s=>g(e,null,function*(){var e;if(s.preventDefault(),n&&a)try{const s=yield d(n,a);if(s){const r={id:s.uid,name:s.displayName||(null==(e=s.email)?void 0:e.split("@")[0])||"",email:s.email,role:s.role};t(r)}}catch(r){console.error(" Firebase login error:",r)}}),className:"space-y-4",children:[ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),ke.jsxs("div",{className:"relative",children:[ke.jsx(H,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),ke.jsx("input",{type:"email",value:n,onChange:e=>i(e.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"email@example.com",required:!0})]})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),ke.jsxs("div",{className:"relative",children:[ke.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),ke.jsx("input",{type:l?"text":"password",value:a,onChange:e=>o(e.target.value),className:"w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"",required:!0}),ke.jsx("button",{type:"button",onClick:()=>c(!l),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:l?ke.jsx(J,{size:20}):ke.jsx(Q,{size:20})})]})]}),h&&ke.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-3 py-2 rounded",children:h}),ke.jsx("button",{type:"submit",disabled:u,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:u?"Loading...":"Login"})]}),r&&ke.jsx("div",{className:"mt-4 text-center",children:ke.jsx("button",{onClick:r,className:"text-blue-600 hover:text-blue-700 text-sm font-medium transition-colors",children:"Belum punya akun? Daftar di sini"})}),ke.jsxs("div",{className:"mt-4 text-center text-sm text-gray-600",children:[ke.jsx("p",{className:"font-semibold mb-2",children:" Firebase Authentication"}),ke.jsxs("div",{className:"space-y-1 text-xs",children:[ke.jsxs("p",{children:[ke.jsx("strong",{children:"Owner:"})," v4hrin@gmail.com / (password Anda)"]}),ke.jsxs("p",{children:[ke.jsx("strong",{children:"Admin:"})," admin@azzahra.com / admin123"]}),ke.jsxs("p",{children:[ke.jsx("strong",{children:"Reseller:"})," reseller@azzahra.com / reseller123"]}),ke.jsxs("p",{children:[ke.jsx("strong",{children:"Customer:"})," [email lain] / [password]"]})]}),ke.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"* Email harus terdaftar di Firebase Authentication"})]})]})})},lv=({onClose:t,onSuccess:s})=>{const[r,n]=f.useState(""),[i,a]=f.useState(""),[o,l]=f.useState(""),[c,d]=f.useState(""),[u,h]=f.useState("customer"),[m,p]=f.useState(!1),[x,y]=f.useState(!1),[b,v]=f.useState(!1),[w,N]=f.useState(""),[j,k]=f.useState(1),{register:I}=av(),S=e=>{switch(e){case"owner":return"bg-red-500 hover:bg-red-600 text-white";case"admin":return"bg-purple-500 hover:bg-purple-600 text-white";case"reseller":return"bg-blue-500 hover:bg-blue-600 text-white";default:return"bg-green-500 hover:bg-green-600 text-white"}};return 1===j?ke.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:ke.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md",children:[ke.jsx("div",{className:"p-6 border-b border-gray-100",children:ke.jsxs("div",{className:"flex items-center justify-between",children:[ke.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Pilih Role Akun"}),ke.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:ke.jsx(G,{className:"w-5 h-5 text-gray-500"})})]})}),ke.jsxs("div",{className:"p-6",children:[ke.jsx("p",{className:"text-gray-600 mb-6",children:"Pilih jenis akun yang ingin Anda daftarkan:"}),ke.jsx("div",{className:"space-y-3",children:[{role:"owner",title:"Owner",desc:"Pemilik bisnis - Akses penuh"},{role:"admin",title:"Administrator",desc:"Admin - Kelola produk dan pesanan"},{role:"reseller",title:"Reseller",desc:"Penjual reseller - Harga khusus"},{role:"customer",title:"Customer",desc:"Pelanggan - Belanja biasa"}].map(({role:e,title:t,desc:s})=>{const r=(e=>{switch(e){case"owner":return Z;case"admin":return X;default:return Y}})(e);return ke.jsx("button",{onClick:()=>{h(e),k(2)},className:"w-full p-4 rounded-lg border-2 transition-all "+(u===e?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300"),children:ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx("div",{className:`p-2 rounded-lg ${S(e)}`,children:ke.jsx(r,{className:"w-5 h-5"})}),ke.jsxs("div",{className:"text-left",children:[ke.jsx("h3",{className:"font-semibold text-gray-800",children:t}),ke.jsx("p",{className:"text-sm text-gray-600",children:s})]})]})},e)})})]})]})}):ke.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:ke.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md",children:[ke.jsx("div",{className:"p-6 border-b border-gray-100",children:ke.jsxs("div",{className:"flex items-center justify-between",children:[ke.jsxs("h2",{className:"text-xl font-bold text-gray-800",children:["Daftar ","owner"===u?"Owner":"admin"===u?"Admin":"reseller"===u?"Reseller":"Customer"]}),ke.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:ke.jsx(G,{className:"w-5 h-5 text-gray-500"})})]})}),ke.jsxs("div",{className:"p-6",children:[w&&ke.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:ke.jsx("p",{className:"text-red-600 text-sm",children:w})}),ke.jsxs("form",{onSubmit:n=>g(e,null,function*(){if(n.preventDefault(),N(""),r&&i&&o&&c)if(i===o)if(i.length<6)N("Password minimal 6 karakter!");else{v(!0);try{const e=yield I(r,i,c,u);if(e){const r={id:e.uid,name:e.displayName||c,email:e.email,role:e.role};s(r),t()}}catch(e){console.error(" Firebase registration error:",e),N(e.message||"Registrasi gagal. Silakan coba lagi.")}finally{v(!1)}}else N("Password tidak cocok!");else N("Semua field harus diisi!")}),className:"space-y-4",children:[ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nama Lengkap"}),ke.jsx("input",{type:"text",value:c,onChange:e=>d(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Masukkan nama lengkap",required:!0})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),ke.jsx("input",{type:"email",value:r,onChange:e=>n(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:`contoh: ${u}@azzahra.com`,required:!0})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),ke.jsxs("div",{className:"relative",children:[ke.jsx("input",{type:m?"text":"password",value:i,onChange:e=>a(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent pr-10",placeholder:"Minimal 6 karakter",required:!0}),ke.jsx("button",{type:"button",onClick:()=>p(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:m?ke.jsx(J,{className:"w-5 h-5"}):ke.jsx(Q,{className:"w-5 h-5"})})]})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password"}),ke.jsxs("div",{className:"relative",children:[ke.jsx("input",{type:x?"text":"password",value:o,onChange:e=>l(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent pr-10",placeholder:"Konfirmasi password",required:!0}),ke.jsx("button",{type:"button",onClick:()=>y(!x),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:x?ke.jsx(J,{className:"w-5 h-5"}):ke.jsx(Q,{className:"w-5 h-5"})})]})]}),ke.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg",children:[ke.jsxs("p",{className:"text-sm text-purple-700",children:[ke.jsx("strong",{children:"Role:"})," ",u.charAt(0).toUpperCase()+u.slice(1)]}),ke.jsxs("p",{className:"text-xs text-purple-600 mt-1",children:["owner"===u&&"Akses penuh ke semua fitur admin","admin"===u&&"Akses kelola produk dan pesanan","reseller"===u&&"Harga reseller dan poin reward","customer"===u&&"Akses berbelanja biasa"]})]}),ke.jsxs("div",{className:"flex space-x-3 pt-4",children:[ke.jsx("button",{type:"button",onClick:()=>k(1),className:"flex-1 p-3 border border-gray-300 text-gray-600 rounded-lg hover:bg-gray-50 transition-colors",children:"Kembali"}),ke.jsx("button",{type:"submit",disabled:b,className:"flex-1 p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50",children:b?"Mendaftar...":"Daftar"})]})]})]})]})})},cv=({user:e,onProductClick:t,onCartClick:s,onAddToCart:r})=>{const{timeLeft:n,flashSaleProducts:i,loading:a}=Wb(),{cartItems:o}=Zb(),l=e=>{r(e)};return a?ke.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center",children:ke.jsx("div",{className:"text-white text-xl",children:"Loading flash sale products..."})}):0===i.length?ke.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900",children:ke.jsxs("div",{className:"container mx-auto px-4 py-8",children:[ke.jsxs("div",{className:"flex items-center justify-between mb-8",children:[ke.jsx("h1",{className:"text-xl font-bold text-white",children:"Flash Sale "}),ke.jsxs("button",{onClick:s,className:"relative p-2 bg-white/20 rounded-full hover:bg-white/30 transition-colors",children:[ke.jsx(v,{className:"w-6 h-6 text-white"}),o.length>0&&ke.jsx("span",{className:"absolute -top-2 -right-2 bg-yellow-400 text-gray-800 text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold",children:o.length})]})]}),ke.jsxs("div",{className:"bg-gradient-to-br from-gray-700 via-gray-600 to-gray-500 rounded-2xl p-8 text-center max-w-3xl mx-auto shadow-2xl relative overflow-hidden",children:[ke.jsxs("div",{className:"absolute inset-0 opacity-10",children:[ke.jsx("div",{className:"absolute top-4 left-4 w-32 h-32 bg-white rounded-full -ml-16 -mt-16 animate-pulse"}),ke.jsx("div",{className:"absolute bottom-4 right-4 w-24 h-24 bg-white rounded-full -mr-12 -mb-12 animate-pulse delay-100"})]}),ke.jsxs("div",{className:"relative z-10",children:[ke.jsx("div",{className:"bg-white/20 backdrop-blur-sm p-4 rounded-full w-20 h-20 mx-auto mb-6 shadow-lg",children:ke.jsx("span",{className:"text-4xl",children:""})}),ke.jsx("h2",{className:"text-3xl font-bold bg-gradient-to-r from-yellow-200 to-white bg-clip-text text-transparent mb-4",children:"Flash Sale Sedang Disiapkan"}),ke.jsx("p",{className:"text-gray-200 text-lg mb-2",children:"Nantikan Flash Sale Kami Selanjutnya!"}),ke.jsx("p",{className:"text-gray-300 text-sm mb-8",children:"Diskon spesial dan penawaran terbatas akan segera hadir. Pastikan Anda tidak ketinggalan!"}),ke.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[ke.jsx("button",{onClick:()=>window.history.back(),className:"bg-white text-gray-700 px-6 py-3 rounded-full font-bold hover:bg-gray-50 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105",children:"Kembali"}),ke.jsx("button",{onClick:()=>window.location.href="/",className:"bg-purple-600 text-white px-6 py-3 rounded-full font-bold hover:bg-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105",children:"Lihat Produk Lainnya"})]})]})]})]})}):ke.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 pb-20",children:ke.jsxs("div",{className:"container mx-auto px-4 py-8",children:[ke.jsxs("div",{className:"flex items-center justify-between mb-6",children:[ke.jsx("h1",{className:"text-xl font-bold text-white",children:"Flash Sale "}),ke.jsxs("button",{onClick:s,className:"relative p-2 bg-white/20 rounded-full hover:bg-white/30 transition-colors",children:[ke.jsx(v,{className:"w-6 h-6 text-white"}),o.length>0&&ke.jsx("span",{className:"absolute -top-2 -right-2 bg-yellow-400 text-gray-800 text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold",children:o.length})]})]}),ke.jsxs("div",{className:"bg-gradient-to-r from-red-600 to-orange-600 rounded-2xl p-8 mb-6 text-center relative overflow-hidden",children:[ke.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-yellow-400 rounded-full -mr-16 -mt-16 opacity-20"}),ke.jsx("div",{className:"absolute bottom-0 left-0 w-40 h-40 bg-yellow-400 rounded-full -ml-20 -mb-20 opacity-20"}),ke.jsxs("div",{className:"relative z-10",children:[ke.jsxs("div",{className:"flex items-center justify-center mb-4",children:[ke.jsx(ee,{className:"w-12 h-12 text-yellow-300 mr-3"}),ke.jsx("h1",{className:"text-4xl font-bold text-white",children:"FLASH SALE"}),ke.jsx(ee,{className:"w-12 h-12 text-yellow-300 ml-3"})]}),ke.jsx("p",{className:"text-xl text-white/90 mb-6",children:"Diskon Hingga 70%"}),n&&ke.jsxs("div",{className:"bg-black/30 backdrop-blur-sm rounded-xl p-4 mb-4",children:[ke.jsx("p",{className:"text-yellow-300 text-sm mb-2",children:" Flash Sale Berakhir Dalam"}),ke.jsx("div",{className:"text-3xl font-bold text-white tracking-wider",children:`${n.hours.toString().padStart(2,"0")}:${n.minutes.toString().padStart(2,"0")}:${n.seconds.toString().padStart(2,"0")}`})]}),ke.jsxs("div",{className:"flex items-center justify-center space-x-4 text-white/80",children:[ke.jsxs("div",{className:"flex items-center",children:[ke.jsx(te,{className:"w-5 h-5 mr-1"}),ke.jsx("span",{className:"text-sm",children:"Terbatas"})]}),ke.jsxs("div",{className:"flex items-center",children:[ke.jsx(se,{className:"w-5 h-5 mr-1"}),ke.jsx("span",{className:"text-sm",children:"Diskon Spesial"})]})]})]})]}),ke.jsxs("div",{className:"text-center text-white/60 text-sm mb-6",children:[i.length," produk flash sale tersedia"]}),ke.jsx("div",{className:"grid grid-cols-2 gap-4",children:i.map(s=>{const r={id:s.id,name:s.name,price:s.price,retailPrice:s.retailPrice||s.price,resellerPrice:s.resellerPrice||.8*s.price,costPrice:.6*s.price,description:s.name,stock:s.stock,images:s.images,image:s.image,category:s.category,status:s.status,createdAt:s.createdAt,featuredOrder:s.featuredOrder,variants:s.variants,isFlashSale:s.isFlashSale,flashSalePrice:s.flashSalePrice||.8*s.price};return ke.jsx(Kb,{product:r,onProductClick:t,onAddToCart:l,isFlashSale:!0,user:e},`flash-${r.id}`)})})]})})},dv=({user:t})=>{var s,r;const[n,i]=f.useState("all"),[a,o]=f.useState(null),[l,c]=f.useState(!1),[h,m]=f.useState(null),{orders:p,loading:x,error:y}=(()=>{const[t,s]=f.useState([]),[r,n]=f.useState(!0),[i,a]=f.useState(null);return f.useEffect(()=>{let t=null;return g(e,null,function*(){try{const r=Ub.currentUser;if(!r)return s([]),void n(!1);const i=Up(Qm(Fb,"orders"),Bp("userId","==",r.uid));t=mg(i,e=>{const t=[];e.forEach(e=>{const s=e.data();t.push(u(d({},s),{id:e.id,createdAt:s.createdAt||(new Date).toISOString(),updatedAt:s.updatedAt||s.createdAt||(new Date).toISOString()}))}),s(t),n(!1),a(null)},t=>g(e,null,function*(){console.error(" Error listening to orders:",t),a(t.message),n(!1);try{const e=yield Bb.getUserOrders();s(e),a(null)}catch(e){console.error(" Fallback also failed:",e)}}))}catch(r){console.error(" Error setting up orders listener:",r),a(r instanceof Error?r.message:"Unknown error"),n(!1)}}),()=>{t&&t()}},[]),{orders:t,loading:r,error:i}})(),b=e=>{o(e),c(!0)},v=()=>{c(!1),o(null),m(null)},w=(e,t)=>{navigator.clipboard.writeText(e),alert(` Nomor rekening ${t} berhasil disalin!\n\n${e}\na.n. Fahrin`)},N="all"===n?p:p.filter(e=>e.status===n),j={pending:{label:"Menunggu Pembayaran",icon:T,color:"text-orange-600 bg-orange-100"},awaiting_verification:{label:"Menunggu Verifikasi",icon:T,color:"text-yellow-600 bg-yellow-100"},paid:{label:"Dibayar",icon:ne,color:"text-blue-600 bg-blue-100"},processing:{label:"Dikemas",icon:$,color:"text-blue-600 bg-blue-100"},shipped:{label:"Dikirim",icon:ie,color:"text-purple-600 bg-purple-100"},delivered:{label:"Selesai",icon:ne,color:"text-green-600 bg-green-100"},cancelled:{label:"Dibatalkan",icon:re,color:"text-red-600 bg-red-100"}};return ke.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[ke.jsxs("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:[ke.jsx("div",{className:"p-4",children:ke.jsx("h1",{className:"text-lg font-semibold text-center",children:"Pesanan Saya"})}),ke.jsx("div",{className:"px-4 pb-4",children:ke.jsxs("div",{className:"relative",children:[ke.jsx(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),ke.jsx("input",{type:"text",placeholder:"Cari pesanan...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"})]})}),ke.jsx("div",{className:"flex overflow-x-auto px-4 pb-2",children:[{id:"all",label:"Semua"},{id:"pending",label:"Belum Bayar"},{id:"awaiting_verification",label:"Menunggu Verifikasi"},{id:"processing",label:"Dikemas"},{id:"shipped",label:"Dikirim"},{id:"delivered",label:"Selesai"}].map(e=>ke.jsx("button",{onClick:()=>i(e.id),className:"flex-shrink-0 px-4 py-2 mr-2 rounded-full text-sm font-medium transition-colors "+(n===e.id?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:e.label},e.id))})]}),ke.jsx("div",{className:"p-4 space-y-4",children:x?ke.jsxs("div",{className:"text-center py-12",children:[ke.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500 mx-auto mb-4"}),ke.jsx("p",{className:"text-gray-500",children:"Memuat pesanan..."})]}):y?ke.jsxs("div",{className:"text-center py-12",children:[ke.jsx($,{className:"w-16 h-16 text-red-300 mx-auto mb-4"}),ke.jsx("h3",{className:"text-lg font-semibold text-red-600 mb-2",children:"Error Loading Pesanan"}),ke.jsx("p",{className:"text-gray-500",children:y})]}):0===N.length?ke.jsxs("div",{className:"text-center py-12",children:[ke.jsx($,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),ke.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"Belum Ada Pesanan"}),ke.jsx("p",{className:"text-gray-500",children:"Pesanan Anda akan muncul di sini"})]}):N.map(e=>{var t,s;const r=j[e.status],n=r.icon;return ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsxs("div",{className:"flex items-center justify-between mb-3",children:[ke.jsxs("div",{children:[ke.jsxs("p",{className:"font-semibold text-gray-800",children:["#",e.id]}),ke.jsx("p",{className:"text-sm text-gray-500",children:new Date(e.createdAt).toLocaleDateString("id-ID")})]}),ke.jsxs("div",{className:`flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium ${r.color}`,children:[ke.jsx(n,{className:"w-3 h-3"}),ke.jsx("span",{children:r.label})]})]}),ke.jsx("div",{className:"space-y-2 mb-3",children:e.items.map((e,t)=>ke.jsxs("div",{className:"flex justify-between text-sm",children:[ke.jsxs("span",{className:"text-gray-600",children:[e.productName," x",e.quantity]}),ke.jsxs("span",{className:"font-medium",children:["Rp ",e.total.toLocaleString("id-ID")]})]},t))}),e.shippingCost&&e.shippingCost>0&&ke.jsxs("div",{className:"flex justify-between text-sm py-2 border-t border-dashed border-gray-200",children:[ke.jsxs("span",{className:"text-gray-600",children:["Ongkos Kirim (",null==(s=null==(t=e.shippingInfo)?void 0:t.courier)?void 0:s.toUpperCase(),")"]}),ke.jsxs("span",{className:"font-medium text-blue-600",children:["Rp ",e.shippingCost.toLocaleString("id-ID")]})]}),ke.jsxs("div",{className:"border-t pt-3 flex items-center justify-between",children:[ke.jsx("span",{className:"text-sm text-gray-600",children:"Total Pesanan"}),ke.jsxs("span",{className:"font-bold text-pink-600",children:["Rp ",e.finalTotal.toLocaleString("id-ID")]})]}),ke.jsxs("div",{className:"mt-3 flex space-x-2",children:[ke.jsx("button",{onClick:()=>o(e),className:"flex-1 bg-gray-100 text-gray-600 py-2 rounded-lg text-sm font-medium hover:bg-gray-200 transition-colors",children:"Detail"}),"pending"===e.status&&"transfer"===e.paymentMethod&&!e.paymentProof&&ke.jsxs("button",{onClick:()=>b(e),className:"flex-1 bg-orange-500 text-white py-2 rounded-lg text-sm font-medium hover:bg-orange-600 transition-colors flex items-center justify-center space-x-1",children:[ke.jsx(ae,{className:"w-4 h-4"}),ke.jsx("span",{children:"Bayar"})]}),("pending"===e.status||"awaiting_verification"===e.status)&&e.paymentProof&&ke.jsxs("div",{className:"flex-1 flex space-x-2",children:[ke.jsx("div",{className:"flex-1 bg-yellow-100 text-yellow-700 py-2 rounded-lg text-sm font-medium text-center",children:" Menunggu Verifikasi"}),ke.jsxs("button",{onClick:()=>b(e),className:"px-3 py-2 bg-blue-500 text-white rounded-lg text-sm font-medium hover:bg-blue-600 transition-colors flex items-center space-x-1",children:[ke.jsx(oe,{className:"w-3 h-3"}),ke.jsx("span",{children:"Upload Ulang"})]})]}),"paid"===e.status&&ke.jsx("div",{className:"flex-1 bg-blue-100 text-blue-700 py-2 rounded-lg text-sm font-medium text-center",children:" Pembayaran Terverifikasi"}),"delivered"===e.status&&ke.jsx("button",{className:"flex-1 bg-pink-500 text-white py-2 rounded-lg text-sm font-medium hover:bg-pink-600 transition-colors",children:"Beli Lagi"})]})]},e.id)})}),a&&ke.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:ke.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md relative max-h-[90vh] overflow-y-auto",children:[ke.jsx("button",{onClick:()=>o(null),className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600",children:ke.jsx(G,{size:24})}),ke.jsxs("div",{className:"mb-6",children:[ke.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Detail Pesanan"}),ke.jsxs("p",{className:"text-sm text-gray-600",children:["#",a.id]}),ke.jsx("p",{className:"text-xs text-gray-500",children:new Date(a.createdAt).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})})]}),ke.jsxs("div",{className:"mb-6",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Produk Pesanan"}),ke.jsx("div",{className:"space-y-3",children:null==(s=a.items)?void 0:s.map((e,t)=>ke.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[ke.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center overflow-hidden flex-shrink-0",children:e.productImage?ke.jsx("img",{src:e.productImage,alt:e.productName,className:"w-full h-full object-cover"}):ke.jsx($,{className:"w-6 h-6 text-gray-400"})}),ke.jsxs("div",{className:"flex-1",children:[ke.jsx("p",{className:"font-medium text-sm",children:e.productName}),e.selectedVariant&&ke.jsxs("p",{className:"text-xs text-gray-500",children:[e.selectedVariant.size&&`Ukuran: ${e.selectedVariant.size}`,e.selectedVariant.size&&e.selectedVariant.color&&"  ",e.selectedVariant.color&&`Warna: ${e.selectedVariant.color}`]}),ke.jsxs("p",{className:"text-xs text-gray-500",children:["x",e.quantity,"  Rp ",e.price.toLocaleString("id-ID")]})]}),ke.jsxs("span",{className:"font-medium text-sm",children:["Rp ",e.total.toLocaleString("id-ID")]})]},t))})]}),a.shippingInfo&&ke.jsxs("div",{className:"mb-6",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Informasi Pengiriman"}),ke.jsxs("div",{className:"space-y-2 text-sm",children:[ke.jsxs("div",{children:[ke.jsx("span",{className:"text-gray-600",children:"Penerima:"}),ke.jsx("span",{className:"font-medium ml-2",children:a.shippingInfo.name})]}),ke.jsxs("div",{children:[ke.jsx("span",{className:"text-gray-600",children:"Telepon:"}),ke.jsx("span",{className:"font-medium ml-2",children:a.shippingInfo.phone})]}),ke.jsxs("div",{children:[ke.jsx("span",{className:"text-gray-600",children:"Alamat:"}),ke.jsx("span",{className:"font-medium ml-2",children:a.shippingInfo.address})]}),ke.jsxs("div",{children:[ke.jsx("span",{className:"text-gray-600",children:"Kurir:"}),ke.jsxs("span",{className:"font-medium ml-2",children:[null==(r=a.shippingInfo.courier)?void 0:r.toUpperCase(),a.shippingInfo.shippingService&&` - ${a.shippingInfo.shippingService}`]})]}),a.shippingInfo.shippingETD&&ke.jsxs("div",{children:[ke.jsx("span",{className:"text-gray-600",children:"Estimasi:"}),ke.jsx("span",{className:"font-medium ml-2",children:a.shippingInfo.shippingETD})]})]})]}),ke.jsxs("div",{className:"border-t pt-4",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Ringkasan Pembayaran"}),ke.jsxs("div",{className:"space-y-2 text-sm",children:[ke.jsxs("div",{className:"flex justify-between",children:[ke.jsx("span",{className:"text-gray-600",children:"Subtotal Produk"}),ke.jsxs("span",{className:"font-medium",children:["Rp ",(a.totalAmount||0).toLocaleString("id-ID")]})]}),a.shippingCost&&a.shippingCost>0&&ke.jsxs("div",{className:"flex justify-between",children:[ke.jsx("span",{className:"text-gray-600",children:"Ongkos Kirim"}),ke.jsxs("span",{className:"font-medium text-blue-600",children:["Rp ",a.shippingCost.toLocaleString("id-ID")]})]}),ke.jsxs("div",{className:"flex justify-between text-lg font-bold pt-2 border-t",children:[ke.jsx("span",{children:"Total Pembayaran"}),ke.jsxs("span",{className:"text-pink-600",children:["Rp ",a.finalTotal.toLocaleString("id-ID")]})]})]})]}),(a.paymentProof||a.paymentProofData)&&ke.jsxs("div",{className:"mt-4 p-4 bg-green-50 rounded-lg",children:[ke.jsx("p",{className:"text-sm text-green-800 font-medium mb-3",children:" Bukti pembayaran telah diupload"}),a.paymentProofData?ke.jsxs("div",{className:"mt-3",children:[ke.jsx("img",{src:`data:image/*;base64,${a.paymentProofData}`,alt:"Payment Proof",className:"w-full max-w-xs rounded-lg border-2 border-green-200 cursor-pointer hover:scale-105 transition-transform",onClick:()=>{const e=window.open("","_blank");e&&e.document.write(`\n                            <html>\n                              <body style="margin:0;padding:20px;background:#f3f4f6;">\n                                <img src="data:image/*;base64,${a.paymentProofData}"\n                                     style="max-width:100%;height:auto;display:block;margin:0 auto;"\n                                     alt="Payment Proof" />\n                              </body>\n                            </html>\n                          `)}}),ke.jsx("p",{className:"text-xs text-green-600 mt-2 text-center",children:" Klik gambar untuk memperbesar"})]}):ke.jsx("p",{className:"text-xs text-green-600",children:a.paymentProof})]}),a.notes&&ke.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 rounded-lg",children:[ke.jsx("p",{className:"text-sm font-medium text-yellow-800 mb-1",children:"Catatan Pesanan:"}),ke.jsx("p",{className:"text-sm text-yellow-700",children:a.notes})]}),ke.jsx("button",{onClick:()=>o(null),className:"w-full mt-6 bg-gray-100 text-gray-700 py-2 rounded-lg font-medium hover:bg-gray-200 transition-colors",children:"Tutup"})]})}),l&&a&&ke.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:ke.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md relative max-h-[90vh] overflow-y-auto",children:[ke.jsx("button",{onClick:v,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600",children:ke.jsx(G,{size:24})}),ke.jsxs("div",{className:"text-center mb-6",children:[ke.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Pembayaran"}),ke.jsxs("p",{className:"text-sm text-gray-600",children:["Pesanan #",a.id]}),ke.jsxs("p",{className:"text-lg font-bold text-pink-600 mt-2",children:["Rp ",a.finalTotal.toLocaleString("id-ID")]}),a.paymentProof&&ke.jsxs("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[ke.jsx("p",{className:"text-yellow-800 text-sm font-medium",children:" Upload Ulang Bukti Pembayaran"}),ke.jsxs("p",{className:"text-yellow-600 text-xs mt-1",children:["Bukti sebelumnya: ",a.paymentProof]})]})]}),ke.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 mb-6",children:[ke.jsx("h4",{className:"font-semibold text-blue-800 mb-3",children:"Transfer ke Rekening:"}),ke.jsxs("div",{className:"space-y-3 text-sm",children:[ke.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded-lg border border-blue-200",children:[ke.jsxs("div",{children:[ke.jsx("span",{className:"font-medium text-gray-700",children:"BCA"}),ke.jsx("div",{className:"font-mono text-xs text-gray-600",children:"0511456494"})]}),ke.jsxs("button",{onClick:()=>w("0511456494","BCA"),className:"flex items-center space-x-1 text-blue-600 hover:text-blue-700 text-xs font-medium transition-colors",children:[ke.jsx(K,{className:"w-3 h-3"}),ke.jsx("span",{children:"Salin"})]})]}),ke.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded-lg border border-blue-200",children:[ke.jsxs("div",{children:[ke.jsx("span",{className:"font-medium text-gray-700",children:"BRI"}),ke.jsx("div",{className:"font-mono text-xs text-gray-600",children:"066301000115566"})]}),ke.jsxs("button",{onClick:()=>w("066301000115566","BRI"),className:"flex items-center space-x-1 text-blue-600 hover:text-blue-700 text-xs font-medium transition-colors",children:[ke.jsx(K,{className:"w-3 h-3"}),ke.jsx("span",{children:"Salin"})]})]}),ke.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded-lg border border-blue-200",children:[ke.jsxs("div",{children:[ke.jsx("span",{className:"font-medium text-gray-700",children:"MANDIRI"}),ke.jsx("div",{className:"font-mono text-xs text-gray-600",children:"310011008896"})]}),ke.jsxs("button",{onClick:()=>w("310011008896","MANDIRI"),className:"flex items-center space-x-1 text-blue-600 hover:text-blue-700 text-xs font-medium transition-colors",children:[ke.jsx(K,{className:"w-3 h-3"}),ke.jsx("span",{children:"Salin"})]})]}),ke.jsx("div",{className:"text-center mt-3 p-2 bg-blue-100 rounded-lg",children:ke.jsx("p",{className:"text-blue-700 font-semibold text-sm",children:"a.n. Fahrin"})})]})]}),ke.jsxs("div",{className:"mb-6",children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload Bukti Pembayaran"}),ke.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[ke.jsx("input",{type:"file",accept:"image/*",onChange:e=>{e.target.files&&e.target.files[0]&&m(e.target.files[0])},className:"hidden",id:"payment-proof-modal"}),ke.jsxs("label",{htmlFor:"payment-proof-modal",className:"cursor-pointer",children:[ke.jsx(oe,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),ke.jsx("p",{className:"text-sm text-gray-600",children:h?h.name:"Klik untuk upload bukti transfer"})]})]})]}),ke.jsx("button",{onClick:()=>g(e,null,function*(){if(a&&h)try{if(yield Bb.updateOrderPayment(a.id,h,"awaiting_verification")){v();const e=a.paymentProof?"Bukti pembayaran berhasil diupload ulang! Menunggu verifikasi admin.":"Bukti pembayaran berhasil dikirim! Menunggu verifikasi admin.";alert(e)}else alert(" Gagal mengupload bukti pembayaran. Silakan coba lagi.")}catch(e){console.error(" Error submitting payment:",e),alert(" Gagal mengupload bukti pembayaran. Silakan coba lagi.")}}),disabled:!h,className:"w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 px-4 rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed font-semibold transition-all",children:(null==a?void 0:a.paymentProof)?"Upload Ulang Bukti Pembayaran":"Kirim Bukti Pembayaran"})]})})]})},uv=({user:t,onLogout:s,onNavigateToAdminProducts:r,onNavigateToAdminOrders:n,onNavigateToAdminReports:i,onNavigateToAdminUsers:a,onNavigateToAdminCache:o,onNavigateToAddressManagement:l})=>{const[c,h]=f.useState(!1),[m,p]=f.useState(!1),[x,y]=f.useState(!1),[v,w]=f.useState({currentPassword:"",newPassword:"",confirmPassword:""}),N=t,j=t=>g(e,null,function*(){if(t.preventDefault(),v.newPassword===v.confirmPassword)if(v.newPassword.length<6)alert("Password minimal 6 karakter!");else try{alert(" Password berhasil diubah!"),w({currentPassword:"",newPassword:"",confirmPassword:""}),h(!1)}catch(e){alert(" Gagal mengubah password: "+e.message)}else alert("Password baru tidak cocok!")});if(!N)return ke.jsx("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 to-purple-50 flex items-center justify-center",children:ke.jsxs("div",{className:"text-center",children:[ke.jsx(S,{className:"w-16 h-16 text-purple-400 mx-auto mb-4"}),ke.jsx("p",{className:"text-gray-600 mb-4",children:"Silakan login terlebih dahulu"}),ke.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Muat Ulang Halaman"})]})});const k=(e=>{switch(e){case"owner":return{text:"Owner",icon:Z,color:"text-red-600 bg-red-100"};case"admin":return{text:"Administrator",icon:b,color:"text-purple-600 bg-purple-100"};case"reseller":return{text:"Reseller",icon:S,color:"text-blue-600 bg-blue-100"};default:return{text:"Customer",icon:S,color:"text-green-600 bg-green-100"}}})(N.role),I=k.icon;return ke.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[ke.jsxs("div",{className:"bg-gradient-to-r from-pink-500 to-purple-600 text-white p-6",children:[ke.jsxs("div",{className:"flex items-center space-x-4",children:[ke.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-full flex items-center justify-center",children:ke.jsx(S,{className:"w-8 h-8"})}),ke.jsxs("div",{className:"flex-1",children:[ke.jsx("h2",{className:"text-xl font-bold",children:N.name}),ke.jsx("p",{className:"text-pink-100",children:N.email}),ke.jsxs("div",{className:`inline-flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium mt-2 ${k.color}`,children:[ke.jsx(I,{className:"w-3 h-3"}),ke.jsx("span",{className:"text-gray-800",children:k.text})]})]})]}),"reseller"===N.role&&ke.jsx("div",{className:"mt-4 bg-white/10 rounded-lg p-3",children:ke.jsxs("div",{className:"flex items-center justify-between",children:[ke.jsx("span",{className:"text-sm",children:"Total Poin"}),ke.jsxs("span",{className:"text-lg font-bold",children:[N.points||0," pts"]})]})})]}),ke.jsx("div",{className:"p-4",children:(()=>{switch(N.role){case"customer":return ke.jsxs("div",{className:"space-y-4",children:[ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Informasi Akun"}),ke.jsxs("div",{className:"space-y-3",children:[ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx(S,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{children:[ke.jsx("p",{className:"text-sm text-gray-500",children:"Username"}),ke.jsx("p",{className:"font-medium",children:N.name})]})]}),ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx(H,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{children:[ke.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),ke.jsx("p",{className:"font-medium",children:N.email})]})]}),ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx(z,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{children:[ke.jsx("p",{className:"text-sm text-gray-500",children:"Telepon"}),ke.jsx("p",{className:"font-medium",children:N.phone||"Belum diisi"})]})]}),ke.jsxs("button",{onClick:l,className:"flex items-center space-x-3 w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:[ke.jsx(V,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{className:"flex-1",children:[ke.jsx("p",{className:"font-medium",children:"Alamat Saya"}),ke.jsx("p",{className:"text-sm text-gray-500",children:"Kelola alamat pengiriman"})]})]})]})]}),ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Keamanan"}),ke.jsx("button",{onClick:()=>h(!c),className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx(he,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{className:"flex-1",children:[ke.jsx("p",{className:"font-medium",children:"Ubah Password"}),ke.jsx("p",{className:"text-sm text-gray-500",children:"Keamanan akun Anda"})]})]})}),c&&ke.jsxs("form",{onSubmit:j,className:"mt-4 space-y-3",children:[ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Saat Ini"}),ke.jsxs("div",{className:"relative",children:[ke.jsx("input",{type:m?"text":"password",value:v.currentPassword,onChange:e=>w(u(d({},v),{currentPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),ke.jsx("button",{type:"button",onClick:()=>p(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:m?ke.jsx(J,{className:"w-5 h-5"}):ke.jsx(Q,{className:"w-5 h-5"})})]})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Baru"}),ke.jsxs("div",{className:"relative",children:[ke.jsx("input",{type:x?"text":"password",value:v.newPassword,onChange:e=>w(u(d({},v),{newPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),ke.jsx("button",{type:"button",onClick:()=>y(!x),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:x?ke.jsx(J,{className:"w-5 h-5"}):ke.jsx(Q,{className:"w-5 h-5"})})]})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password Baru"}),ke.jsx("input",{type:"password",value:v.confirmPassword,onChange:e=>w(u(d({},v),{confirmPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg",required:!0})]}),ke.jsxs("div",{className:"flex space-x-3",children:[ke.jsx("button",{type:"button",onClick:()=>h(!1),className:"flex-1 p-3 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50",children:"Batal"}),ke.jsx("button",{type:"submit",className:"flex-1 p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Simpan"})]})]})]}),ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Preferensi"}),ke.jsx("div",{className:"space-y-3",children:ke.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx(R,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{className:"flex-1",children:[ke.jsx("p",{className:"font-medium",children:"Wishlist"}),ke.jsx("p",{className:"text-sm text-gray-500",children:"Produk favorit Anda"})]})]})})})]})]});case"reseller":return ke.jsxs("div",{className:"space-y-4",children:[ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Informasi Akun"}),ke.jsxs("div",{className:"space-y-3",children:[ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx(S,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{children:[ke.jsx("p",{className:"text-sm text-gray-500",children:"Username"}),ke.jsx("p",{className:"font-medium",children:N.name})]})]}),ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx(H,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{children:[ke.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),ke.jsx("p",{className:"font-medium",children:N.email})]})]}),ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx(z,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{children:[ke.jsx("p",{className:"text-sm text-gray-500",children:"Telepon"}),ke.jsx("p",{className:"font-medium",children:N.phone||"Belum diisi"})]})]}),ke.jsxs("button",{onClick:l,className:"flex items-center space-x-3 w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:[ke.jsx(V,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{className:"flex-1",children:[ke.jsx("p",{className:"font-medium",children:"Alamat Saya"}),ke.jsx("p",{className:"text-sm text-gray-500",children:"Kelola alamat pengiriman"})]})]})]})]}),ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Point Reseller"}),ke.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg p-4 text-white",children:[ke.jsxs("div",{className:"flex items-center justify-between mb-2",children:[ke.jsx("span",{className:"text-sm opacity-90",children:"Total Poin"}),ke.jsx(me,{className:"w-6 h-6"})]}),ke.jsxs("div",{className:"text-3xl font-bold",children:[N.points||0," pts"]}),ke.jsx("div",{className:"mt-2 text-sm opacity-90",children:"Tukar dengan diskon khusus!"})]})]}),ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Keamanan"}),ke.jsx("button",{onClick:()=>h(!c),className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx(he,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{className:"flex-1",children:[ke.jsx("p",{className:"font-medium",children:"Ubah Password"}),ke.jsx("p",{className:"text-sm text-gray-500",children:"Keamanan akun Anda"})]})]})}),c&&ke.jsxs("form",{onSubmit:j,className:"mt-4 space-y-3",children:[ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Saat Ini"}),ke.jsxs("div",{className:"relative",children:[ke.jsx("input",{type:m?"text":"password",value:v.currentPassword,onChange:e=>w(u(d({},v),{currentPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),ke.jsx("button",{type:"button",onClick:()=>p(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:m?ke.jsx(J,{className:"w-5 h-5"}):ke.jsx(Q,{className:"w-5 h-5"})})]})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Baru"}),ke.jsxs("div",{className:"relative",children:[ke.jsx("input",{type:x?"text":"password",value:v.newPassword,onChange:e=>w(u(d({},v),{newPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),ke.jsx("button",{type:"button",onClick:()=>y(!x),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:x?ke.jsx(J,{className:"w-5 h-5"}):ke.jsx(Q,{className:"w-5 h-5"})})]})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password Baru"}),ke.jsx("input",{type:"password",value:v.confirmPassword,onChange:e=>w(u(d({},v),{confirmPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg",required:!0})]}),ke.jsxs("div",{className:"flex space-x-3",children:[ke.jsx("button",{type:"button",onClick:()=>h(!1),className:"flex-1 p-3 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50",children:"Batal"}),ke.jsx("button",{type:"submit",className:"flex-1 p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Simpan"})]})]})]}),ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Preferensi Reseller"}),ke.jsxs("div",{className:"space-y-3",children:[ke.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx(R,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{className:"flex-1",children:[ke.jsx("p",{className:"font-medium",children:"Wishlist"}),ke.jsx("p",{className:"text-sm text-gray-500",children:"Produk favorit Anda"})]})]})}),ke.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx(me,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{className:"flex-1",children:[ke.jsx("p",{className:"font-medium",children:"Riwayat Poin"}),ke.jsx("p",{className:"text-sm text-gray-500",children:"Lihat transaksi poin"})]})]})})]})]})]});case"admin":return ke.jsxs("div",{className:"space-y-4",children:[ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Informasi Akun Admin"}),ke.jsxs("div",{className:"space-y-3",children:[ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx(S,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{children:[ke.jsx("p",{className:"text-sm text-gray-500",children:"Username"}),ke.jsx("p",{className:"font-medium",children:N.name})]})]}),ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx(H,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{children:[ke.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),ke.jsx("p",{className:"font-medium",children:N.email})]})]}),ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx(z,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{children:[ke.jsx("p",{className:"text-sm text-gray-500",children:"Telepon"}),ke.jsx("p",{className:"font-medium",children:N.phone||"Belum diisi"})]})]}),ke.jsxs("button",{onClick:l,className:"flex items-center space-x-3 w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:[ke.jsx(V,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{className:"flex-1",children:[ke.jsx("p",{className:"font-medium",children:"Alamat Saya"}),ke.jsx("p",{className:"text-sm text-gray-500",children:"Kelola alamat pengiriman"})]})]})]})]}),ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Fitur Admin"}),ke.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[ke.jsxs("button",{onClick:r,className:"p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[ke.jsx($,{className:"w-6 h-6 mx-auto mb-2"}),ke.jsx("p",{className:"text-sm",children:"Kelola Produk"})]}),ke.jsxs("button",{onClick:n,className:"p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[ke.jsx($,{className:"w-6 h-6 mx-auto mb-2"}),ke.jsx("p",{className:"text-sm",children:"Kelola Pesanan"})]}),ke.jsxs("button",{onClick:i,className:"p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[ke.jsx(ce,{className:"w-6 h-6 mx-auto mb-2"}),ke.jsx("p",{className:"text-sm",children:"Laporan"})]}),ke.jsxs("button",{onClick:a,className:"p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[ke.jsx(de,{className:"w-6 h-6 mx-auto mb-2"}),ke.jsx("p",{className:"text-sm",children:"Pelanggan"})]})]})]}),ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Statistik Admin"}),ke.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[ke.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[ke.jsx(ue,{className:"w-6 h-6 text-blue-600 mx-auto mb-2"}),ke.jsx("p",{className:"text-sm text-gray-600",children:"Total Penjualan"}),ke.jsx("p",{className:"text-xl font-bold text-blue-600",children:"Rp 0"})]}),ke.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[ke.jsx($,{className:"w-6 h-6 text-green-600 mx-auto mb-2"}),ke.jsx("p",{className:"text-sm text-gray-600",children:"Total Pesanan"}),ke.jsx("p",{className:"text-xl font-bold text-green-600",children:"0"})]})]})]}),ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Keamanan Admin"}),ke.jsx("button",{onClick:()=>h(!c),className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx(he,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{className:"flex-1",children:[ke.jsx("p",{className:"font-medium",children:"Ubah Password"}),ke.jsx("p",{className:"text-sm text-gray-500",children:"Keamanan akun admin"})]})]})}),c&&ke.jsxs("form",{onSubmit:j,className:"mt-4 space-y-3",children:[ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Saat Ini"}),ke.jsxs("div",{className:"relative",children:[ke.jsx("input",{type:m?"text":"password",value:v.currentPassword,onChange:e=>w(u(d({},v),{currentPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),ke.jsx("button",{type:"button",onClick:()=>p(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:m?ke.jsx(J,{className:"w-5 h-5"}):ke.jsx(Q,{className:"w-5 h-5"})})]})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Baru"}),ke.jsxs("div",{className:"relative",children:[ke.jsx("input",{type:x?"text":"password",value:v.newPassword,onChange:e=>w(u(d({},v),{newPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),ke.jsx("button",{type:"button",onClick:()=>y(!x),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:x?ke.jsx(J,{className:"w-5 h-5"}):ke.jsx(Q,{className:"w-5 h-5"})})]})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password Baru"}),ke.jsx("input",{type:"password",value:v.confirmPassword,onChange:e=>w(u(d({},v),{confirmPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg",required:!0})]}),ke.jsxs("div",{className:"flex space-x-3",children:[ke.jsx("button",{type:"button",onClick:()=>h(!1),className:"flex-1 p-3 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50",children:"Batal"}),ke.jsx("button",{type:"submit",className:"flex-1 p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Simpan"})]})]})]}),ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Preferensi Admin"}),ke.jsxs("div",{className:"space-y-3",children:[ke.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx(X,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{className:"flex-1",children:[ke.jsx("p",{className:"font-medium",children:"Keamanan"}),ke.jsx("p",{className:"text-sm text-gray-500",children:"Pengaturan keamanan"})]})]})}),ke.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx(X,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{className:"flex-1",children:[ke.jsx("p",{className:"font-medium",children:"Pengaturan Sistem"}),ke.jsx("p",{className:"text-sm text-gray-500",children:"Konfigurasi aplikasi"})]})]})})]})]})]});case"owner":return ke.jsxs("div",{className:"space-y-4",children:[ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Informasi Akun Owner"}),ke.jsxs("div",{className:"space-y-3",children:[ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx(S,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{children:[ke.jsx("p",{className:"text-sm text-gray-500",children:"Username"}),ke.jsx("p",{className:"font-medium",children:N.name})]})]}),ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx(H,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{children:[ke.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),ke.jsx("p",{className:"font-medium",children:N.email})]})]}),ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx(z,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{children:[ke.jsx("p",{className:"text-sm text-gray-500",children:"Telepon"}),ke.jsx("p",{className:"font-medium",children:N.phone||"Belum diisi"})]})]}),ke.jsxs("button",{onClick:l,className:"flex items-center space-x-3 w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:[ke.jsx(V,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{className:"flex-1",children:[ke.jsx("p",{className:"font-medium",children:"Alamat Saya"}),ke.jsx("p",{className:"text-sm text-gray-500",children:"Kelola alamat pengiriman"})]})]})]})]}),ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Kontrol Owner"}),ke.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[ke.jsxs("button",{onClick:r,className:"p-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[ke.jsx($,{className:"w-6 h-6 mx-auto mb-2"}),ke.jsx("p",{className:"text-sm",children:"Kelola Produk"})]}),ke.jsxs("button",{onClick:n,className:"p-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[ke.jsx($,{className:"w-6 h-6 mx-auto mb-2"}),ke.jsx("p",{className:"text-sm",children:"Kelola Pesanan"})]}),ke.jsxs("button",{onClick:i,className:"p-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[ke.jsx(ce,{className:"w-6 h-6 mx-auto mb-2"}),ke.jsx("p",{className:"text-sm",children:"Laporan"})]}),ke.jsxs("button",{onClick:a,className:"p-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[ke.jsx(de,{className:"w-6 h-6 mx-auto mb-2"}),ke.jsx("p",{className:"text-sm",children:"Kelola User"})]})]}),"owner"===(null==N?void 0:N.role)&&ke.jsxs("div",{className:"mt-4",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Owner Tools"}),ke.jsx("button",{onClick:o,className:"w-full p-3 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors mb-3",children:ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:ke.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"})}),ke.jsxs("div",{className:"flex-1 text-left",children:[ke.jsx("p",{className:"font-medium",children:"Cache Management"}),ke.jsx("p",{className:"text-sm opacity-90",children:"Kelola cache ongkir & alamat"})]})]})})]})]}),ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Statistik Bisnis"}),ke.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[ke.jsxs("div",{className:"text-center p-3 bg-red-50 rounded-lg",children:[ke.jsx(ue,{className:"w-6 h-6 text-red-600 mx-auto mb-2"}),ke.jsx("p",{className:"text-sm text-gray-600",children:"Total Revenue"}),ke.jsx("p",{className:"text-xl font-bold text-red-600",children:"Rp 0"})]}),ke.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[ke.jsx($,{className:"w-6 h-6 text-green-600 mx-auto mb-2"}),ke.jsx("p",{className:"text-sm text-gray-600",children:"Total Pesanan"}),ke.jsx("p",{className:"text-xl font-bold text-green-600",children:"0"})]})]})]}),ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Keamanan Owner"}),ke.jsx("button",{onClick:()=>h(!c),className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx(he,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{className:"flex-1",children:[ke.jsx("p",{className:"font-medium",children:"Ubah Password"}),ke.jsx("p",{className:"text-sm text-gray-500",children:"Keamanan akun owner"})]})]})}),c&&ke.jsxs("form",{onSubmit:j,className:"mt-4 space-y-3",children:[ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Saat Ini"}),ke.jsxs("div",{className:"relative",children:[ke.jsx("input",{type:m?"text":"password",value:v.currentPassword,onChange:e=>w(u(d({},v),{currentPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),ke.jsx("button",{type:"button",onClick:()=>p(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:m?ke.jsx(J,{className:"w-5 h-5"}):ke.jsx(Q,{className:"w-5 h-5"})})]})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Baru"}),ke.jsxs("div",{className:"relative",children:[ke.jsx("input",{type:x?"text":"password",value:v.newPassword,onChange:e=>w(u(d({},v),{newPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),ke.jsx("button",{type:"button",onClick:()=>y(!x),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:x?ke.jsx(J,{className:"w-5 h-5"}):ke.jsx(Q,{className:"w-5 h-5"})})]})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password Baru"}),ke.jsx("input",{type:"password",value:v.confirmPassword,onChange:e=>w(u(d({},v),{confirmPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg",required:!0})]}),ke.jsxs("div",{className:"flex space-x-3",children:[ke.jsx("button",{type:"button",onClick:()=>h(!1),className:"flex-1 p-3 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50",children:"Batal"}),ke.jsx("button",{type:"submit",className:"flex-1 p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Simpan"})]})]})]}),ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Pengaturan Owner"}),ke.jsxs("div",{className:"space-y-3",children:[ke.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx(X,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{className:"flex-1",children:[ke.jsx("p",{className:"font-medium",children:"Keamanan"}),ke.jsx("p",{className:"text-sm text-gray-500",children:"Pengaturan keamanan tingkat lanjut"})]})]})}),ke.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx(X,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{className:"flex-1",children:[ke.jsx("p",{className:"font-medium",children:"Sistem"}),ke.jsx("p",{className:"text-sm text-gray-500",children:"Konfigurasi aplikasi"})]})]})}),ke.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx(E,{className:"w-5 h-5 text-gray-400"}),ke.jsxs("div",{className:"flex-1",children:[ke.jsx("p",{className:"font-medium",children:"Backup & Restore"}),ke.jsx("p",{className:"text-sm text-gray-500",children:"Cadangkan data"})]})]})})]})]})]});default:return null}})()}),ke.jsx("div",{className:"p-4",children:ke.jsx("div",{className:"bg-white rounded-lg shadow-sm",children:ke.jsxs("button",{onClick:()=>{s()},className:"w-full p-4 flex items-center space-x-3 text-red-600 hover:bg-red-50 transition-colors rounded-lg",children:[ke.jsx(le,{className:"w-5 h-5"}),ke.jsx("span",{children:"Keluar"})]})})})]})},hv=({user:t,onBack:s})=>{const[r,n]=f.useState([]),[i,a]=f.useState(!0),[o,l]=f.useState(null),[c,d]=f.useState(!1),[u,h]=f.useState(null);f.useEffect(()=>{const e=tv.onAddressesChange(e=>{n(e),a(!1),l(null)});return()=>e()},[]);const m=t=>g(e,null,function*(){try{u?yield tv.updateAddress(u.id,{name:t.name,phone:t.phone,fullAddress:t.fullAddress,province:t.province,provinceId:t.provinceId,city:t.city,cityId:t.cityId,district:t.district,districtId:t.districtId,subdistrict:t.subdistrict,subdistrictId:t.subdistrictId,postalCode:t.postalCode,isDefault:t.isDefault,updatedAt:(new Date).toISOString()}):yield tv.saveAddress({name:t.name,phone:t.phone,fullAddress:t.fullAddress,province:t.province,provinceId:t.provinceId,city:t.city,cityId:t.cityId,district:t.district,districtId:t.districtId,subdistrict:t.subdistrict,subdistrictId:t.subdistrictId,postalCode:t.postalCode,isDefault:t.isDefault}),d(!1),h(null)}catch(e){console.error(" Error saving address:",e),alert("Gagal menyimpan alamat. Silakan coba lagi.")}}),p=e=>`${e.fullAddress}, ${e.subdistrict}, ${e.district}, ${e.city}, ${e.province} ${e.postalCode}`;return c?ke.jsx("div",{className:"min-h-screen bg-gray-50",children:ke.jsx(sv,{initialData:u?{name:u.name,phone:u.phone,fullAddress:u.fullAddress,province:u.province,provinceId:u.provinceId,city:u.city,cityId:u.cityId,district:u.district,districtId:u.districtId,subdistrict:u.subdistrict,subdistrictId:u.subdistrictId,postalCode:u.postalCode,isDefault:u.isDefault}:null,onSave:m,onCancel:()=>{d(!1),h(null)}})}):ke.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[ke.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:ke.jsxs("div",{className:"flex items-center p-4",children:[ke.jsx("button",{onClick:s,className:"mr-4",children:ke.jsx(P,{className:"w-6 h-6 text-gray-600"})}),ke.jsx("h1",{className:"text-lg font-semibold",children:"Alamat Saya"})]})}),ke.jsxs("div",{className:"p-4",children:[i?ke.jsx("div",{className:"flex justify-center py-8",children:ke.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-pink-500"})}):o?ke.jsx("div",{className:"text-center py-8",children:ke.jsxs("p",{className:"text-red-600",children:["Error: ",o]})}):0===r.length?ke.jsxs("div",{className:"text-center py-8",children:[ke.jsx(V,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),ke.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"Belum Ada Alamat"}),ke.jsx("p",{className:"text-gray-500 mb-6",children:"Tambahkan alamat pengiriman untuk memudahkan proses checkout"})]}):ke.jsx("div",{className:"space-y-4",children:r.map(t=>ke.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:ke.jsxs("div",{className:"flex items-start justify-between",children:[ke.jsxs("div",{className:"flex-1",children:[ke.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[ke.jsx(pe,{className:"w-4 h-4 text-pink-600"}),t.isDefault&&ke.jsx("span",{className:"bg-pink-100 text-pink-600 text-xs px-2 py-1 rounded-full font-medium",children:"Utama"})]}),ke.jsx("h3",{className:"font-semibold text-gray-800 mb-1",children:t.name}),ke.jsx("p",{className:"text-sm text-gray-600 mb-2",children:t.phone}),ke.jsx("p",{className:"text-sm text-gray-700",children:p(t)})]}),ke.jsxs("div",{className:"flex space-x-2",children:[ke.jsx("button",{onClick:()=>(e=>{h(e),d(!0)})(t),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",children:ke.jsx(ge,{className:"w-4 h-4"})}),r.length>1&&ke.jsx("button",{onClick:()=>{return s=t.id,g(e,null,function*(){if(window.confirm("Apakah Anda yakin ingin menghapus alamat ini?"))try{yield tv.deleteAddress(s)}catch(e){console.error(" Error deleting address:",e),alert("Gagal menghapus alamat. Silakan coba lagi.")}});var s},className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:ke.jsx(F,{className:"w-4 h-4"})}),!t.isDefault&&ke.jsx("button",{onClick:()=>{return s=t.id,g(e,null,function*(){try{yield tv.setAsDefault(s)}catch(e){console.error(" Error setting default address:",e),alert("Gagal mengatur alamat utama. Silakan coba lagi.")}});var s},className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",children:ke.jsx(fe,{className:"w-4 h-4"})})]})]})},t.id))}),ke.jsx("button",{onClick:()=>{d(!0),h(null)},className:"fixed bottom-24 right-4 w-14 h-14 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-full shadow-lg flex items-center justify-center hover:from-pink-600 hover:to-purple-700 transition-all",children:ke.jsx(L,{className:"w-6 h-6"})})]})]})},mv=()=>{const[t,s]=f.useState([]),[r,n]=f.useState(!0),[i,a]=f.useState(null),[o,l]=f.useState(!0);return f.useEffect(()=>{const r=(t=!1)=>g(e,null,function*(){try{if(!Ub.currentUser)return s([]),n(!1),void l(!1);console.log(" Loading products for admin from BATCH SYSTEM...",t?"(FORCE REFRESH)":"");const e=Up(Qm(Fb,"productBatches"),Bp("__name__","==","batch_1")),r=yield lg(e);if(r.empty||!r.docs[0].exists())return console.log(" Batch system not found"),s([]),n(!1),void l(!1);const i=r.docs[0].data().products||[];console.log(" Products loaded from batch:",i.length,"products");const o=[];i.forEach(e=>{var t,s,r,n,i,a,l;const c=Number(e.stock||0),d=(null==(t=e.variants)?void 0:t.stock)?Object.values(e.variants.stock).reduce((e,t)=>e+Object.values(t).reduce((e,t)=>e+Number(t||0),0),0):c,u={sizes:(null==(s=e.variants)?void 0:s.sizes)||e.sizes||[],colors:(null==(r=e.variants)?void 0:r.colors)||e.colors||[],stock:(null==(n=e.variants)?void 0:n.stock)&&"object"==typeof(null==(i=e.variants)?void 0:i.stock)?e.variants.stock:{}};o.push({id:e.id,name:e.name||"",description:e.description||"",category:e.category||"uncategorized",retailPrice:Number(e.retailPrice||e.price||0),resellerPrice:Number(e.resellerPrice)||.8*Number(e.retailPrice||e.price||0),costPrice:Number(e.costPrice)||.6*Number(e.retailPrice||e.price||0),stock:d,images:e.images||[],image:(null==(a=e.images)?void 0:a[0])||"/placeholder-product.jpg",variants:u,isFeatured:Boolean(e.isFeatured||e.featured),isFlashSale:Boolean(e.isFlashSale),flashSalePrice:Number(e.flashSalePrice)||Number(e.retailPrice||e.price||0),originalRetailPrice:Number(e.originalRetailPrice)||Number(e.retailPrice||e.price||0),originalResellerPrice:Number(e.originalResellerPrice)||.8*Number(e.retailPrice||e.price||0),createdAt:e.createdAt?"string"==typeof e.createdAt?new Date(e.createdAt):null==(l=e.createdAt)?void 0:l.toDate():new Date,salesCount:Number(e.salesCount)||0,featuredOrder:Number(e.featuredOrder)||0,weight:Number(e.weight)||0,unit:"gram",status:e.status||("baru"===e.condition?"ready":"po")||"ready",estimatedReady:e.estimatedReady?new Date(e.estimatedReady):void 0})}),s(o),n(!1),l(!1),a(null);const c=o.filter(e=>e.stock<=5).length;console.log(` Admin products loaded: ${c} products with low stock (<=5)`)}catch(e){console.error(" Error loading admin products:",e),a(e instanceof Error?e.message:"Unknown error"),n(!1),l(!1)}});r();const i=e=>{"azzahra_cache_invalidation"===e.key&&"products"===JSON.parse(e.newValue||"{}").type&&(console.log(" Admin: Cross-tab cache invalidation detected - force reloading products..."),setTimeout(()=>r(!0),100))};window.addEventListener("storage",i);const o=()=>{!document.hidden&&t.length>0&&(console.log(" Admin: Page became visible - refreshing products to ensure latest data..."),r(!0))};return document.addEventListener("visibilitychange",o),()=>{window.removeEventListener("storage",i),document.removeEventListener("visibilitychange",o)}},[t.length]),{products:t,loading:r&&o,error:i,initialLoad:o,updateProduct:(t,r)=>g(e,null,function*(){try{console.log(" Updating product in BATCH SYSTEM:",{id:t,updates:r});const e=Up(Qm(Fb,"productBatches"),Bp("__name__","==","batch_1")),n=yield lg(e);if(!n.empty&&n.docs[0].exists()){const e=n.docs[0].data();let i=e.products||[];i=i.map(e=>e.id===t?(console.log(" Found product to update:",e.name),d(d({},e),r)):e),yield cg(Ym(Fb,"productBatches","batch_1"),u(d({},e),{products:i,totalProducts:i.length,updatedAt:(new Date).toISOString()})),console.log(" Product updated successfully in batch system"),s(e=>e.map(e=>e.id===t?d(d({},e),r):e))}else console.error(" Batch system not found")}catch(e){throw console.error(" Error updating product in batch:",e),e}}),updateProductStock:(t,s,r)=>g(e,null,function*(){try{console.log(" Reducing stock from BATCH SYSTEM:",{id:t,quantity:s,variantInfo:r});const e=Up(Qm(Fb,"productBatches"),Bp("__name__","==","batch_1")),n=yield lg(e);if(!n.empty&&n.docs[0].exists()){const e=n.docs[0].data();let i=e.products||[];return i=i.map(e=>{var n,i;if(e.id===t){console.log(" Found product to update stock:",e.name);let t=d({},e);if((null==r?void 0:r.size)&&(null==r?void 0:r.color)&&(null==(n=e.variants)?void 0:n.stock)){const{size:n,color:a}=r,o=Number((null==(i=e.variants.stock[n])?void 0:i[a])||0),l=Math.max(0,o-s);t.variants=u(d({},e.variants),{stock:u(d({},e.variants.stock),{[n]:u(d({},e.variants.stock[n]||{}),{[a]:l})})});const c=Number(e.stock||0);t.stock=Math.max(0,c-s),console.log(` Variant stock updated: ${n}-${a}: ${o}  ${l}`)}else{const r=Number(e.stock||0),n=Math.max(0,r-s);t.stock=n,console.log(` Total stock updated: ${r}  ${n}`)}return t}return e}),yield cg(Ym(Fb,"productBatches","batch_1"),u(d({},e),{products:i,totalProducts:i.length,updatedAt:(new Date).toISOString()})),console.log(" Product stock updated successfully in batch system"),s}return console.error(" Batch system not found for stock update"),0}catch(e){return console.error(" Error updating product stock in batch:",e),0}})}},pv={TTL:{HOME:6e5,SEARCH:18e4,FEATURED:9e5,FLASHSALE:3e5},MAX_SIZE:2097152,VERSION:"1.2.0"},gv="home_products",fv="featured_products",xv="flashsale_products",yv="search_products",bv="ready_products",vv="po_products",wv="cheapest_products",Nv="cache_stats",jv=new class{constructor(){m(this,"config"),m(this,"stats"),m(this,"storageKey","azzahra_product_cache"),m(this,"statsKey","azzahra_cache_stats"),this.config={ttl:pv.TTL.HOME,maxSize:Math.min(pv.MAX_SIZE,2621440),version:pv.VERSION},this.clearIfVersionChanged(),this.stats=this.loadStats(),this.cleanupExpiredEntries(),this.enforceSizeLimit()}generateKey(e,t={}){const s=Object.keys(t).sort().reduce((e,s)=>(void 0!==t[s]&&null!==t[s]&&""!==t[s]&&(e[s]=t[s]),e),{}),r=Object.keys(s).map(e=>`${e}:${s[e]}`).join("|");return r?`${e}_${r}`:e}generateSearchKey(e){return this.generateKey(yv,{q:e.query.toLowerCase().trim(),cat:e.category,status:e.status||"all",sort:e.sortBy||"terbaru",role:e.userRole||"customer",page:e.page||1})}generateProductListKey(e,t=1,s="customer"){return this.generateKey(e,{page:t,role:s})}clearIfVersionChanged(){try{const e=this.storageKey+"_version",t=localStorage.getItem(e);t!==this.config.version&&(console.log(` Cache version changed from ${t} to ${this.config.version}, clearing cache`),this.clear(),localStorage.setItem(e,this.config.version))}catch(e){console.error(" Error checking cache version:",e)}}isValidEntry(e){if(!e||!e.metadata)return!1;const t=Date.now()>e.metadata.expiresAt,s=e.metadata.version===this.config.version;return!t&&s}getFromStorage(e){try{const t=localStorage.getItem(this.storageKey);if(!t)return null;const s=JSON.parse(t),r=s[e];return r?this.isValidEntry(r)?(this.stats.hits++,this.saveStats(),r):(delete s[e],localStorage.setItem(this.storageKey,JSON.stringify(s)),this.stats.misses++,this.saveStats(),null):null}catch(t){return console.error(" Error reading from cache:",t),this.stats.misses++,this.saveStats(),null}}saveToStorage(e,t,s=this.config.ttl){try{const r=this.optimizeDataSize(t),n=localStorage.getItem(this.storageKey),i=n?JSON.parse(n):{},a=Date.now(),o={data:r,metadata:{timestamp:a,expiresAt:a+s,version:this.config.version,source:"localStorage"}};i[e]=o,this.getCacheSize(i)>this.config.maxSize&&this.cleanupOldEntries(i),this.enforceSizeLimit(i);const l=JSON.stringify(i);if(this.isWithinQuota(l))localStorage.setItem(this.storageKey,l),this.triggerSyncEvent(e,"save");else{this.emergencyCleanup(i);const t=JSON.stringify(i);this.isWithinQuota(t)?(localStorage.setItem(this.storageKey,t),this.triggerSyncEvent(e,"save")):(console.warn(" Cache data too large for localStorage, skipping cache save"),this.stats.misses++,this.saveStats())}}catch(r){if("QuotaExceededError"===r.name){console.warn(" localStorage quota exceeded, clearing cache and retrying"),this.clear();try{const r={data:this.optimizeDataSize(t),metadata:{timestamp:Date.now(),expiresAt:Date.now()+s,version:this.config.version,source:"localStorage"}},n={[e]:r},i=JSON.stringify(n);this.isWithinQuota(i)&&(localStorage.setItem(this.storageKey,i),this.triggerSyncEvent(e,"save"))}catch(n){console.error(" Even retry failed, disabling cache temporarily:",n)}}else console.error(" Error saving to cache:",r)}}get(e){const t=this.getFromStorage(e);return t?t.data:null}set(e,t,s){this.saveToStorage(e,t,s)}getSearchResults(e){const t=this.generateSearchKey(e);return this.get(t)}setSearchResults(e,t){const s=this.generateSearchKey(e);this.set(s,t,pv.TTL.SEARCH)}getProductList(e,t=1,s="customer"){const r=this.generateProductListKey(e,t,s);return this.get(r)}setProductList(e,t,s=1,r="customer"){const n=this.generateProductListKey(e,s,r),i=this.getTTLForType(e);this.set(n,t,i)}getFeaturedProducts(){return this.get(fv)}setFeaturedProducts(e){this.set(fv,e,pv.TTL.FEATURED)}getFlashSaleProducts(){return this.get(xv)}setFlashSaleProducts(e){this.set(xv,e,pv.TTL.FLASHSALE)}invalidateCache(e){try{const t=localStorage.getItem(this.storageKey);if(!t)return;const s=JSON.parse(t);let r=[];switch(e.type){case"stock_change":r=Object.keys(s).filter(e=>e.includes(gv)||e.includes(yv)||e.includes(bv)||e.includes(vv)||e.includes(wv));break;case"product_update":r=Object.keys(s).filter(e=>!e.includes(Nv));break;case"featured_update":r=Object.keys(s).filter(e=>e.includes(fv));break;case"flashsale_update":r=Object.keys(s).filter(e=>e.includes(xv))}r.forEach(e=>{delete s[e]}),r.length>0&&(localStorage.setItem(this.storageKey,JSON.stringify(s)),console.log(` Cache invalidated: ${r.length} entries removed`),this.triggerSyncEvent("cache_invalidated","invalidate",{type:e.type,keysRemoved:r.length}))}catch(t){console.error(" Error invalidating cache:",t)}}clear(){try{localStorage.removeItem(this.storageKey),localStorage.removeItem(this.statsKey),this.stats={hits:0,misses:0,totalSize:0,lastCleanup:Date.now()},this.triggerSyncEvent("cache_cleared","clear"),console.log(" All cache cleared")}catch(e){console.error(" Error clearing cache:",e)}}getTTLForType(e){switch(e){case fv:return pv.TTL.FEATURED;case xv:return pv.TTL.FLASHSALE;case yv:return pv.TTL.SEARCH;default:return pv.TTL.HOME}}getCacheSize(e){try{const t=JSON.stringify(e);return new Blob([t]).size}catch(t){return 0}}cleanupOldEntries(e){const t=Object.entries(e);t.sort(([,e],[,t])=>e.metadata.timestamp-t.metadata.timestamp);let s=this.getCacheSize(e);const r=.8*this.config.maxSize;for(const[n]of t){if(s<=r)break;delete e[n],s=this.getCacheSize(e)}}cleanupExpiredEntries(){try{const e=localStorage.getItem(this.storageKey);if(!e)return;const t=JSON.parse(e),s=Date.now();let r=0;Object.keys(t).forEach(e=>{s>t[e].metadata.expiresAt&&(delete t[e],r++)}),r>0&&(localStorage.setItem(this.storageKey,JSON.stringify(t)),console.log(` Cleaned up ${r} expired cache entries`)),this.stats.lastCleanup=s,this.saveStats()}catch(e){console.error(" Error during cleanup:",e)}}loadStats(){try{const e=localStorage.getItem(this.statsKey);if(e)return JSON.parse(e)}catch(e){console.error(" Error loading cache stats:",e)}return{hits:0,misses:0,totalSize:0,lastCleanup:Date.now()}}saveStats(){try{localStorage.setItem(this.statsKey,JSON.stringify(this.stats))}catch(e){console.error(" Error saving cache stats:",e)}}getStats(){return d({},this.stats)}triggerSyncEvent(e,t,s){try{localStorage.setItem("cache_sync_trigger",JSON.stringify({key:e,action:t,timestamp:Date.now(),data:s})),localStorage.removeItem("cache_sync_trigger"),window.dispatchEvent(new CustomEvent("cacheUpdated",{detail:{key:e,action:t,data:s}}))}catch(r){console.error(" Error triggering sync event:",r)}}optimizeDataSize(e){if(Array.isArray(e))return e.map(e=>{var t,s,r;return{id:e.id,name:e.name,price:e.price,retailPrice:e.retailPrice,resellerPrice:e.resellerPrice,stock:e.stock,images:null==(t=e.images)?void 0:t.slice(0,2),category:e.category,status:e.status,variants:e.variants?{sizes:null==(s=e.variants.sizes)?void 0:s.slice(0,3),colors:null==(r=e.variants.colors)?void 0:r.slice(0,3),stock:e.variants.stock}:void 0}});if(e&&"object"==typeof e){if(e.products&&Array.isArray(e.products))return u(d({},e),{products:e.products.slice(0,20).map(e=>{var t,s,r;return{id:e.id,name:e.name,price:e.price,retailPrice:e.retailPrice,resellerPrice:e.resellerPrice,stock:e.stock,images:null==(t=e.images)?void 0:t.slice(0,2),category:e.category,status:e.status,variants:e.variants?{sizes:null==(s=e.variants.sizes)?void 0:s.slice(0,3),colors:null==(r=e.variants.colors)?void 0:r.slice(0,3),stock:e.variants.stock}:void 0}})});const t={};return Object.keys(e).forEach(s=>{"lastVisible"!==s&&"fullSnapshot"!==s&&(t[s]=e[s])}),t}return e}isWithinQuota(e){try{const t="quota_test_"+Date.now();return localStorage.setItem(t,e),localStorage.removeItem(t),!0}catch(t){return!1}}enforceSizeLimit(e){const t=e||(()=>{try{const e=localStorage.getItem(this.storageKey);return e?JSON.parse(e):{}}catch(e){return{}}})();let s=this.getCacheSize(t);const r=.7*this.config.maxSize;if(s>r){const i=Object.entries(t);i.sort(([e,t],[s,r])=>{const n=this.getCachePriority(e),i=this.getCachePriority(s);return n!==i?n-i:t.metadata.timestamp-r.metadata.timestamp});let a=0;for(const[e]of i){if(s<=r)break;delete t[e],s=this.getCacheSize(t),a++}if(a>0&&!e)try{localStorage.setItem(this.storageKey,JSON.stringify(t)),console.log(` Enforced size limit: removed ${a} cache entries`)}catch(n){console.error(" Error saving after size enforcement:",n)}}}getCachePriority(e){return e.includes(fv)?1:e.includes(yv)?2:e.includes(gv)?3:e.includes(xv)?4:5}emergencyCleanup(e){console.warn(" Emergency cache cleanup triggered");const t=Object.entries(e);t.sort(([e],[t])=>this.getCachePriority(e)-this.getCachePriority(t));const s=t.slice(0,3).map(([e])=>e),r=t.slice(3).map(([e])=>e);r.forEach(t=>{delete e[t]}),console.log(` Emergency cleanup: removed ${r.length} entries, kept ${s.length}`)}isAvailable(){try{const e="cache_test";return localStorage.setItem(e,"test"),localStorage.removeItem(e),!0}catch(e){return!1}}},kv=e=>jv.invalidateCache(e),Iv=()=>ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsxs("div",{className:"flex items-center justify-between mb-4",children:[ke.jsx("div",{className:"h-6 bg-gray-200 rounded w-32 animate-pulse"}),ke.jsxs("div",{className:"flex space-x-2",children:[ke.jsx("div",{className:"h-10 bg-gray-200 rounded w-64 animate-pulse"}),ke.jsx("div",{className:"h-10 bg-gray-200 rounded w-32 animate-pulse"}),ke.jsx("div",{className:"h-10 bg-gray-200 rounded w-24 animate-pulse"})]})]}),ke.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden mb-4",children:[ke.jsxs("div",{className:"grid grid-cols-12 gap-4 p-4 bg-gray-50 border-b border-gray-200",children:[ke.jsx("div",{className:"col-span-1 h-4 bg-gray-200 rounded animate-pulse"}),ke.jsx("div",{className:"col-span-4 h-4 bg-gray-200 rounded animate-pulse"}),ke.jsx("div",{className:"col-span-2 h-4 bg-gray-200 rounded animate-pulse"}),ke.jsx("div",{className:"col-span-2 h-4 bg-gray-200 rounded animate-pulse"}),ke.jsx("div",{className:"col-span-1 h-4 bg-gray-200 rounded animate-pulse"}),ke.jsx("div",{className:"col-span-1 h-4 bg-gray-200 rounded animate-pulse"}),ke.jsx("div",{className:"col-span-1 h-4 bg-gray-200 rounded animate-pulse"})]}),[...Array(5)].map((e,t)=>ke.jsxs("div",{className:"grid grid-cols-12 gap-4 p-4 border-b border-gray-100 hover:bg-gray-50",children:[ke.jsx("div",{className:"col-span-1 h-4 bg-gray-100 rounded animate-pulse"}),ke.jsxs("div",{className:"col-span-4",children:[ke.jsx("div",{className:"h-4 bg-gray-100 rounded w-3/4 mb-2 animate-pulse"}),ke.jsx("div",{className:"h-3 bg-gray-50 rounded w-1/2 animate-pulse"})]}),ke.jsx("div",{className:"col-span-2 h-4 bg-gray-100 rounded animate-pulse"}),ke.jsx("div",{className:"col-span-2 h-4 bg-gray-100 rounded animate-pulse"}),ke.jsx("div",{className:"col-span-1 h-4 bg-gray-100 rounded animate-pulse"}),ke.jsx("div",{className:"col-span-1 h-4 bg-gray-100 rounded animate-pulse"}),ke.jsx("div",{className:"col-span-1 h-8 bg-gray-100 rounded animate-pulse"})]},t))]}),ke.jsxs("div",{className:"flex items-center justify-between",children:[ke.jsx("div",{className:"h-4 bg-gray-200 rounded w-48 animate-pulse"}),ke.jsx("div",{className:"flex space-x-1",children:[...Array(5)].map((e,t)=>ke.jsx("div",{className:"h-8 w-8 bg-gray-200 rounded animate-pulse"},t))})]})]}),Sv=Cf(Vb),_v=(t,s,r)=>g(e,null,function*(){try{const i=(n=`products/${s}/${r}`,jf(ot(Sv),n)),a=yield Tf(i,t),o=yield(e=a.ref,wf(e=ot(e)));return console.log(` Image uploaded to Firebase Storage: ${o}`),o}catch(i){throw console.error(" Error uploading image to Firebase Storage:",i),i}var e,n}),Ev=(t,s)=>g(e,null,function*(){const r=t.map((t,r)=>g(e,null,function*(){const e=t.name.split(".").pop()||"jpg",n=`image_${r+1}.${e}`;return yield _v(t,s,n)}));try{const e=yield Promise.all(r);return console.log(` Successfully uploaded ${e.length} images to Firebase Storage`),e}catch(n){throw console.error(" Error uploading multiple images:",n),n}}),Tv=({onBack:t,user:s})=>{var r;const{products:n,loading:i,updateProduct:a}=mv(),{addProduct:o,deleteProduct:l}=(()=>{const[t,s]=f.useState([]),[r,n]=f.useState(!1),[i,a]=f.useState(null),[o,l]=f.useState(!1),[c,h]=f.useState(null),[m,p]=f.useState(1),[x]=f.useState(20),y=f.useRef(!1),b=f.useCallback(()=>g(e,null,function*(){try{console.log(" Manual refresh dimulai - ambil data terbaru"),n(!0);const e=Up(Qm(Fb,"products"),qp("createdAt","desc"),Gp(x)),t=yield lg(e);console.log(" Refresh: Produk diambil dari Firestore:",t.docs.length,"produk");const r=t.docs.map(e=>{var t,s,r,n,i,a,o;const l=e.data(),c=Number(l.stock||0),d=(null==(t=l.variants)?void 0:t.stock)?Object.values(l.variants.stock).reduce((e,t)=>e+Object.values(t).reduce((e,t)=>e+Number(t||0),0),0):c,u={sizes:(null==(s=l.variants)?void 0:s.sizes)||l.sizes||[],colors:(null==(r=l.variants)?void 0:r.colors)||l.colors||[],stock:(null==(n=l.variants)?void 0:n.stock)&&"object"==typeof(null==(i=l.variants)?void 0:i.stock)?l.variants.stock:{}};return{id:e.id,name:l.name||"",description:l.description||"",category:l.category||"uncategorized",retailPrice:Number(l.retailPrice||l.price||0),resellerPrice:Number(l.resellerPrice)||.8*Number(l.retailPrice||l.price||0),costPrice:Number(l.costPrice)||.6*Number(l.retailPrice||l.price||0),stock:d,images:l.images||[],image:(null==(a=l.images)?void 0:a[0])||"/placeholder-product.jpg",variants:u,isFeatured:Boolean(l.isFeatured||l.featured),isFlashSale:Boolean(l.isFlashSale),flashSalePrice:Number(l.flashSalePrice)||Number(l.retailPrice||l.price||0),originalRetailPrice:Number(l.originalRetailPrice)||Number(l.retailPrice||l.price||0),originalResellerPrice:Number(l.originalResellerPrice)||.8*Number(l.retailPrice||l.price||0),createdAt:l.createdAt?"string"==typeof l.createdAt?new Date(l.createdAt):null==(o=l.createdAt)?void 0:o.toDate():new Date,salesCount:Number(l.salesCount)||0,featuredOrder:Number(l.featuredOrder)||0,weight:Number(l.weight)||0,unit:"gram",status:l.status||("baru"===l.condition?"ready":"po")||"ready",estimatedReady:l.estimatedReady?new Date(l.estimatedReady):void 0}});s(r),n(!1),console.log(" Manual refresh selesai - semua data diperbarui");const i=r.filter(e=>e.isFeatured).length,a=r.filter(e=>e.isFlashSale).length;console.log(` Refresh stats: ${i} produk unggulan, ${a} flash sale`)}catch(e){console.error(" Error refreshing products:",e),a(e instanceof Error?e.message:"Unknown error refreshing products"),n(!1)}}),[x]);f.useEffect(()=>(console.log(" Setting up cross-device event-based refresh..."),()=>{console.log(" Cross-device event-based refresh DISABLED to prevent infinite loop")}),[]);const v=f.useCallback(()=>g(e,null,function*(){if(o&&!r){n(!0);try{const e=Up(Qm(Fb,"products"),qp("createdAt","desc"),Wp(c),Gp(x)),t=yield lg(e),r=[];t.forEach(e=>{var t,s,n,i,a,o;const l=e.data(),c=Number(l.stock||0),d=(null==(t=l.variants)?void 0:t.stock)?Object.values(l.variants.stock).reduce((e,t)=>e+Object.values(t).reduce((e,t)=>e+Number(t||0),0),0):c;r.push({id:e.id,name:l.name||"",description:l.description||"",category:l.category||"uncategorized",retailPrice:Number(l.retailPrice||l.price||0),resellerPrice:Number(l.resellerPrice)||.8*Number(l.retailPrice||l.price||0),costPrice:Number(l.costPrice)||.6*Number(l.retailPrice||l.price||0),stock:d,images:l.images||[],image:(null==(s=l.images)?void 0:s[0])||"/placeholder-product.jpg",variants:{sizes:(null==(n=l.variants)?void 0:n.sizes)||l.sizes||[],colors:(null==(i=l.variants)?void 0:i.colors)||l.colors||[],stock:(null==(a=l.variants)?void 0:a.stock)||{}},status:l.status||("baru"===l.condition?"ready":"po")||"ready",isFlashSale:Boolean(l.isFlashSale),flashSalePrice:Number(l.flashSalePrice)||Number(l.retailPrice||l.price||0),createdAt:l.createdAt?"string"==typeof l.createdAt?new Date(l.createdAt):null==(o=l.createdAt)?void 0:o.toDate():new Date,salesCount:Number(l.salesCount)||0,isFeatured:Boolean(l.isFeatured||l.featured),featuredOrder:Number(l.featuredOrder)||0,weight:Number(l.weight)||0,unit:l.unit||"gram",estimatedReady:l.estimatedReady?new Date(l.estimatedReady):void 0})}),r.length>0?(s(e=>[...e,...r]),h(t.docs[t.docs.length-1]),p(e=>e+1),r.length<x&&l(!1)):l(!1)}catch(e){console.error(" Error loading more products:",e)}finally{n(!1)}}}),[o,r,c,x]);return{products:t,loading:r,error:i,addProduct:t=>g(e,null,function*(){var e,s,r;try{console.log(" Adding product to Firestore:",t.name);const n=yield hg(Qm(Fb,"products"),{name:t.name,description:t.description||"",category:t.category||"uncategorized",retailPrice:Number(t.retailPrice)||0,resellerPrice:Number(t.resellerPrice)||0,costPrice:Number(t.costPrice)||0,weight:Number(t.weight)||0,stock:t.stock||0,images:t.images||[],variants:{sizes:(null==(e=t.variants)?void 0:e.sizes)||[],colors:(null==(s=t.variants)?void 0:s.colors)||[],stock:(null==(r=t.variants)?void 0:r.stock)||{}},status:t.status||"ready",featured:t.isFeatured||!1,isFeatured:t.isFeatured||!1,isFlashSale:t.isFlashSale||!1,flashSalePrice:Number(t.flashSalePrice)||Number(t.retailPrice)||0,salesCount:0,unit:"gram",createdAt:new Date});return console.log(" Product added successfully:",n.id),kv({type:"product_update",productIds:[n.id],timestamp:Date.now(),triggerBy:"admin"}),localStorage.setItem("product_change_trigger",Date.now().toString()),window.dispatchEvent(new CustomEvent("productsChanged",{detail:{action:"added",productId:n.id}})),n}catch(n){throw console.error(" Error adding product:",n),n}}),updateProduct:(t,s)=>g(e,null,function*(){try{const e=Ym(Fb,"products",t);"isFeatured"in s&&(s.featured=s.isFeatured),console.log(" Updating product:",t,s),yield dg(e,s),console.log(" Product updated successfully");let r="product_update";"isFeatured"in s?r="featured_update":"isFlashSale"in s&&(r="flashsale_update"),kv({type:r,productIds:[t],timestamp:Date.now(),triggerBy:"admin"}),"isFeatured"in s?localStorage.setItem("featured_products_change_trigger",Date.now().toString()):"isFlashSale"in s?localStorage.setItem("flash_sale_change_trigger",Date.now().toString()):localStorage.setItem("product_change_trigger",Date.now().toString())}catch(e){throw console.error(" Error updating product:",e),e}}),deleteProduct:t=>g(e,null,function*(){try{console.log(" Deleting product:",t),yield ug(Ym(Fb,"products",t)),console.log(" Product deleted successfully"),kv({type:"product_update",productIds:[t],timestamp:Date.now(),triggerBy:"admin"}),localStorage.setItem("product_change_trigger",Date.now().toString()),window.dispatchEvent(new CustomEvent("productsChanged",{detail:{action:"deleted",productId:t}}))}catch(e){throw console.error(" Error deleting product:",e),e}}),updateProductStock:(r,n,i)=>g(e,null,function*(){var e,a,o;try{const l=Ym(Fb,"products",r),c=t.find(e=>e.id===r);if(!c)return console.error(" Product not found:",r),0;console.log(" Reducing stock:",r,"Qty:",n),y.current=!0;const h=yield ag(l);if(!h.exists())return console.error(" Product document not found:",r),0;const m=h.data(),p=Number(m.stock||0),g=Math.max(0,p-n),f={stock:g};if(i&&(null==(e=c.variants)?void 0:e.sizes)&&(null==(a=c.variants)?void 0:a.colors)){const{size:e,color:t}=i;let s=(null==(o=m.variants)?void 0:o.stock)||{};if(!s||0===Object.keys(s).length){const e=c.variants.sizes.length*c.variants.colors.length,t=Math.floor(p/e);s={},c.variants.sizes.forEach(e=>{s[e]={},c.variants.colors.forEach(r=>{s[e][r]=t})})}const r=JSON.parse(JSON.stringify(s));if(r[e]&&void 0!==r[e][t]){const s=Number(r[e][t]||0),i=Math.max(0,s-n);r[e][t]=i,console.log(` Variant ${e}-${t}: ${s}  ${i}`),f.variants=u(d({},m.variants),{stock:r})}}yield dg(l,f),kv({type:"stock_change",productIds:[r],timestamp:Date.now(),triggerBy:"system"}),s(e=>e.map(e=>e.id===r?u(d({},e),{stock:g,variants:f.variants||e.variants}):e)),y.current=!1;const x=Date.now().toString();return localStorage.setItem("stock_change_trigger",x),0===g?(localStorage.setItem("stock_depleted_trigger",x),console.log(" Stock depleted trigger sent for product:",r)):g<=5&&(localStorage.setItem("stock_low_trigger",x),console.log(" Stock low trigger sent for product:",r,"Stock:",g)),setTimeout(()=>{localStorage.setItem("stock_sync_fallback",x)},100),window.dispatchEvent(new CustomEvent("stockChanged",{detail:{action:"stock_updated",productId:r,newStock:g,oldStock:oldStock,variantInfo:i,timestamp:x,isDepleted:0===g,isLow:g<=5}})),setTimeout(()=>{window.dispatchEvent(new CustomEvent("immediateStockSync",{detail:{productId:r,newStock:g,timestamp:x}}))},50),console.log(" Enhanced stock sync triggers sent for product:",r,"New stock:",g),g}catch(l){throw console.error(" Error updating stock:",l),y.current=!1,l}}),setProducts:s,hasMore:o,currentPage:m,productsPerPage:x,setCurrentPage:p,loadMoreProducts:v,refreshProducts:b}})(),{flashSaleProducts:c,isFlashSaleActive:h,timeLeft:m}=Wb(),p={flashSaleDiscount:20,productIds:c.map(e=>e.id)},[x,v]=f.useState(!1),[w,N]=f.useState(!1),[j,S]=f.useState(!1),[E,C]=f.useState(!1),[A,D]=f.useState(!1),[R,O]=f.useState(null),[M,U]=f.useState([]),[V,B]=f.useState(""),[z,q]=f.useState(""),[K,H]=f.useState("name"),[W,J]=f.useState(1),[Q,Y]=f.useState(10),[X,Z]=f.useState({name:"",description:"",category:"Hijab",retailPrice:"",resellerPrice:"",costPrice:"",weight:"",images:[],variants:{sizes:[],colors:[],stock:{}},status:"ready"}),[te,se]=f.useState({category:"",retailPrice:0,discount:0,stock:-1,status:"",isFeatured:!1}),[re,ne]=f.useState({sizes:["Ukuran 1","Ukuran 2"],colors:["A","B","C","D"],stockPerVariant:5}),[ie,ae]=f.useState({isActive:!1,startTime:"",endTime:"",flashSaleDiscount:0,productIds:[]}),oe=["Hijab","Gamis","Khimar","Tunik","Jaket","Bawahan","Aksesoris","Lainnya"],le=()=>{let e=0;return Object.values(X.variants.stock).forEach(t=>{Object.values(t).forEach(t=>{const s="string"==typeof t?parseInt(t)||0:t||0;e+=s})}),e},ce=t=>g(e,null,function*(){const e=t.target.files;if(!e)return;const s=[];if(Array.from(e).forEach(e=>{const t=(e=>e.size>5242880?{isValid:!1,error:`File ${e.name} terlalu besar. Maksimal ukuran file adalah 5MB.`}:e.type.startsWith("image/")?{isValid:!0}:{isValid:!1,error:`File ${e.name} bukan gambar. Silakan pilih file gambar.`})(e);t.isValid?s.push(e):alert(t.error)}),0!==s.length){try{console.log(` Uploading ${s.length} images to Firebase Storage...`);const e=s.map(e=>URL.createObjectURL(e));Z(t=>u(d({},t),{images:[...t.images,...s.map((t,s)=>({file:t,preview:e[s],isUploading:!1}))]})),console.log(` ${s.length} files ready for upload to Firebase Storage`)}catch(r){console.error(" Error preparing images for upload:",r),alert("Gagal mempersiapkan gambar untuk diupload. Silakan coba lagi.")}t.target.value=""}else t.target.value=""}),de=y.useMemo(()=>{let e=[...n];return V&&(e=e.filter(e=>e.name.toLowerCase().includes(V.toLowerCase())||e.category.toLowerCase().includes(V.toLowerCase()))),z&&(e=e.filter(e=>e.category===z)),e.sort((e,t)=>{switch(K){case"price-asc":return e.retailPrice-t.retailPrice;case"price-desc":return t.retailPrice-e.retailPrice;case"date-newest":return new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime();case"date-oldest":return new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime();default:return e.name.localeCompare(t.name)}}),e},[n,V,z,K]),ue=Math.ceil(de.length/Q),he=(W-1)*Q,me=he+Q,pe=de.slice(he,me);f.useEffect(()=>{J(1)},[V,z,K,Q]);const fe=()=>g(e,null,function*(){try{const e=n.filter(e=>e.isFlashSale);for(const t of e)yield a(t.id,{isFlashSale:!1,flashSalePrice:null});yield void console.log("Stop flash sale - akan diimplementasi")}catch(e){console.error("Error ending flash sale:",e),alert("Gagal menghentikan flash sale")}});return ke.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[ke.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4",children:ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx("button",{onClick:t,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:ke.jsx(P,{className:"w-5 h-5"})}),ke.jsx("h1",{className:"text-xl font-bold",children:"Kelola Produk"})]})}),ke.jsxs("div",{className:"p-4 space-y-4",children:[ke.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[ke.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[ke.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-1",children:"Total Produk"}),ke.jsx("p",{className:"text-2xl font-bold text-blue-600",children:n.length})]}),ke.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[ke.jsx("h4",{className:"text-sm font-medium text-green-800 mb-1",children:"Stok Tersedia"}),ke.jsx("p",{className:"text-2xl font-bold text-green-600",children:n.reduce((e,t)=>e+t.stock,0)})]}),ke.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[ke.jsx("h4",{className:"text-sm font-medium text-purple-800 mb-1",children:"Kategori"}),ke.jsx("p",{className:"text-2xl font-bold text-purple-600",children:oe.length})]}),ke.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[ke.jsx("h4",{className:"text-sm font-medium text-orange-800 mb-1",children:"Produk Unggulan"}),ke.jsx("p",{className:"text-2xl font-bold text-orange-600",children:n.filter(e=>e.isFeatured).length})]})]}),h&&ke.jsxs("div",{className:"bg-gradient-to-r from-red-50 to-orange-50 rounded-lg shadow-sm p-4 border border-red-200",children:[ke.jsxs("div",{className:"flex items-center justify-between",children:[ke.jsxs("div",{className:"flex items-center space-x-2",children:[ke.jsx(ee,{className:"w-5 h-5 text-red-600"}),ke.jsx("span",{className:"font-semibold text-red-800",children:"Flash Sale Aktif"})]}),ke.jsxs("div",{className:"flex items-center space-x-3",children:[m&&ke.jsxs("div",{className:"flex items-center space-x-1 bg-red-600 text-white px-3 py-1 rounded-full text-sm",children:[ke.jsx(T,{className:"w-4 h-4"}),ke.jsx("span",{className:"font-medium",children:`${m.hours.toString().padStart(2,"0")}:${m.minutes.toString().padStart(2,"0")}:${m.seconds.toString().padStart(2,"0")}`})]}),ke.jsx("button",{onClick:fe,className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors text-sm",children:"Stop Flash Sale"})]})]}),ke.jsxs("p",{className:"text-sm text-red-700 mt-2",children:[n.filter(e=>e.isFlashSale).length," produk dengan diskon Rp ",(null==(r=null==p?void 0:p.flashSaleDiscount)?void 0:r.toLocaleString("id-ID"))||0]})]}),n.filter(e=>e.isFlashSale).length>0&&!h&&ke.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:[ke.jsxs("div",{className:"flex items-center justify-between mb-2",children:[ke.jsx("h3",{className:"text-sm font-semibold text-yellow-800",children:" Flash Sale Cleanup Needed"}),ke.jsxs("span",{className:"text-xs text-yellow-600",children:[n.filter(e=>e.isFlashSale).length," products stuck"]})]}),ke.jsxs("p",{className:"text-xs text-yellow-700 mb-3",children:["Flash sale is not active but ",n.filter(e=>e.isFlashSale).length," products still have flash sale status. This may cause display issues."]}),ke.jsxs("div",{className:"flex items-center space-x-2",children:[ke.jsx("button",{onClick:fe,className:"bg-yellow-600 text-white px-3 py-1 rounded hover:bg-yellow-700 transition-colors text-xs",children:" Force Clean Up"}),ke.jsx("button",{onClick:()=>{const e=n.filter(e=>e.isFlashSale);alert(`Stuck products: ${e.map(e=>e.name).join(", ")}`)},className:"bg-gray-600 text-white px-3 py-1 rounded hover:bg-gray-700 transition-colors text-xs",children:" Show Details"})]})]}),ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsx("div",{className:"flex items-center justify-between mb-4",children:ke.jsx("h2",{className:"text-lg font-semibold",children:"Menu Utama"})}),ke.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[ke.jsxs("button",{onClick:()=>v(!0),className:"bg-blue-600 text-white p-4 rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-3",children:[ke.jsx(L,{className:"w-6 h-6"}),ke.jsxs("div",{className:"text-left",children:[ke.jsx("p",{className:"font-semibold",children:"Tambah Produk"}),ke.jsx("p",{className:"text-sm opacity-90",children:"Tambah produk baru"})]})]}),ke.jsxs("button",{onClick:()=>{const e=n.filter(e=>e.isFeatured);e.length>0?(U(e.map(e=>e.id)),se(u(d({},te),{isFeatured:void 0})),S(!0)):alert("Belum ada produk unggulan. Pilih produk terlebih dahulu dari daftar produk.")},className:"bg-yellow-500 text-white p-4 rounded-lg hover:bg-yellow-600 transition-colors flex items-center space-x-3",children:[ke.jsx(b,{className:"w-6 h-6"}),ke.jsxs("div",{className:"text-left",children:[ke.jsx("p",{className:"font-semibold",children:"Produk Unggulan"}),ke.jsxs("p",{className:"text-sm opacity-90",children:["Kelola produk unggulan (",n.filter(e=>e.isFeatured).length,")"]})]})]}),ke.jsxs("button",{onClick:()=>D(!0),className:"bg-red-600 text-white p-4 rounded-lg hover:bg-red-700 transition-colors flex items-center space-x-3",children:[ke.jsx(ee,{className:"w-6 h-6"}),ke.jsxs("div",{className:"text-left",children:[ke.jsx("p",{className:"font-semibold",children:"Flash Sale"}),ke.jsxs("p",{className:"text-sm opacity-90",children:["Atur diskon flash sale (",n.filter(e=>e.isFlashSale).length,")"]})]})]})]})]}),ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-4 space-y-4 md:space-y-0",children:[ke.jsxs("h2",{className:"text-lg font-semibold",children:["Daftar Produk ",M.length>0&&`(${M.length} dipilih)`]}),ke.jsxs("div",{className:"flex flex-col md:flex-row md:items-center space-y-3 md:space-y-0 md:space-x-3",children:[ke.jsxs("div",{className:"relative",children:[ke.jsx(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),ke.jsx("input",{type:"text",placeholder:"Cari produk...",value:V,onChange:e=>B(e.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent w-full md:w-64"})]}),ke.jsxs("select",{value:z,onChange:e=>q(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[ke.jsx("option",{value:"",children:"Semua Kategori"}),oe.map(e=>ke.jsx("option",{value:e,children:e},e))]}),ke.jsxs("select",{value:K,onChange:e=>H(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[ke.jsx("option",{value:"name",children:"Nama"}),ke.jsx("option",{value:"price-asc",children:"Harga (Rendah ke Tinggi)"}),ke.jsx("option",{value:"price-desc",children:"Harga (Tinggi ke Rendah)"}),ke.jsx("option",{value:"date-newest",children:"Terbaru"}),ke.jsx("option",{value:"date-oldest",children:"Terlama"})]}),M.length>0&&ke.jsxs("div",{className:"flex flex-wrap gap-2",children:[ke.jsxs("button",{onClick:()=>S(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[ke.jsx(ge,{className:"w-4 h-4"}),ke.jsxs("span",{children:["Edit ",M.length," Produk"]})]}),ke.jsxs("button",{onClick:()=>C(!0),className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors flex items-center space-x-2",children:[ke.jsx($,{className:"w-4 h-4"}),ke.jsxs("span",{children:["Varian ",M.length," Produk"]})]}),ke.jsxs("button",{onClick:()=>g(e,null,function*(){if(0===M.length)return void alert("Pilih setidaknya satu produk");const e=M.map(e=>{const t=n.find(t=>t.id===e);return t?t.name:"Unknown Product"}),t=`Apakah Anda yakin ingin menghapus ${M.length} produk berikut?\n\n${e.join("\n")}\n\n Tindakan ini tidak dapat dibatalkan!`;if(confirm(t))try{console.log(` Menghapus ${M.length} produk...`);for(const e of M)yield l(e);U([]),alert(` Berhasil menghapus ${M.length} produk`)}catch(s){console.error("Error bulk deleting products:",s),alert("Gagal menghapus beberapa produk. Silakan coba lagi.")}}),className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors flex items-center space-x-2",children:[ke.jsx(F,{className:"w-4 h-4"}),ke.jsxs("span",{children:["Hapus ",M.length," Produk"]})]})]})]})]}),i?ke.jsx(Iv,{}):0===pe.length?ke.jsxs("div",{className:"text-center py-8",children:[ke.jsx($,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),ke.jsx("p",{className:"text-gray-500",children:V||z?"Tidak ada produk yang ditemukan":"Belum ada produk"})]}):ke.jsxs(ke.Fragment,{children:[ke.jsx("div",{className:"overflow-x-auto",children:ke.jsxs("table",{className:"w-full",children:[ke.jsx("thead",{children:ke.jsxs("tr",{className:"border-b",children:[ke.jsx("th",{className:"text-left p-3",children:ke.jsx("input",{type:"checkbox",checked:M.length===pe.length,onChange:e=>{e.target.checked?U(pe.map(e=>e.id)):U([])},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),ke.jsx("th",{className:"text-left p-3",children:"Produk"}),ke.jsx("th",{className:"text-left p-3",children:"Kategori"}),ke.jsx("th",{className:"text-left p-3",children:"Harga"}),ke.jsx("th",{className:"text-left p-3",children:"Stok"}),ke.jsx("th",{className:"text-left p-3",children:"Status"}),ke.jsx("th",{className:"text-left p-3",children:"Aksi"})]})}),ke.jsx("tbody",{children:pe.map(t=>{var s;return ke.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[ke.jsx("td",{className:"p-3",children:ke.jsx("input",{type:"checkbox",checked:M.includes(t.id),onChange:e=>{e.target.checked?U([...M,t.id]):U(M.filter(e=>e!==t.id))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),ke.jsx("td",{className:"p-3",children:ke.jsxs("div",{className:"flex items-center space-x-3",children:[t.images.length>0?ke.jsx("img",{src:t.image||t.images[0]||"/placeholder-product.jpg",alt:t.name,className:"w-10 h-10 object-cover rounded-lg"}):ke.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center",children:ke.jsx($,{className:"w-5 h-5 text-gray-400"})}),ke.jsxs("div",{children:[ke.jsx("p",{className:"font-medium text-gray-900",children:t.name}),t.isFeatured&&ke.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800",children:" Unggulan"}),t.isFlashSale&&ke.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800 ml-2",children:" Flash Sale"})]})]})}),ke.jsx("td",{className:"p-3",children:ke.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:t.category})}),ke.jsx("td",{className:"p-3",children:ke.jsx("div",{children:t.isFlashSale?ke.jsxs(ke.Fragment,{children:[ke.jsxs("p",{className:"font-semibold text-red-600",children:["Rp ",null==(s=t.flashSalePrice)?void 0:s.toLocaleString("id-ID")]}),ke.jsxs("p",{className:"text-sm text-gray-400 line-through",children:["Rp ",t.retailPrice.toLocaleString("id-ID")]})]}):ke.jsxs("p",{className:"font-semibold",children:["Rp ",t.retailPrice.toLocaleString("id-ID")]})})}),ke.jsx("td",{className:"p-3",children:ke.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(t.stock>10?"bg-green-100 text-green-800":t.stock>0?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:[t.stock," pcs"]})}),ke.jsx("td",{className:"p-3",children:ke.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+("ready"===t.status?"bg-green-100 text-green-800":"bg-orange-100 text-orange-800"),children:"ready"===t.status?" Ready Stock":" Pre-Order"})}),ke.jsx("td",{className:"p-3",children:ke.jsxs("div",{className:"flex items-center space-x-2",children:[ke.jsx("button",{onClick:()=>(e=>{O(e),Z({name:e.name,description:e.description,category:e.category,retailPrice:String(e.retailPrice||""),resellerPrice:String(e.resellerPrice||""),costPrice:String(e.costPrice||""),weight:String(e.weight||""),images:e.images||[],variants:e.variants||{sizes:[],colors:[],stock:{}},status:e.status||"ready"}),N(!0)})(t),className:"p-1 text-blue-600 hover:bg-blue-100 rounded",children:ke.jsx(ge,{className:"w-4 h-4"})}),ke.jsx("button",{onClick:()=>{return s=t.id,g(e,null,function*(){if(confirm("Apakah Anda yakin ingin menghapus produk ini?"))try{yield l(s)}catch(e){console.error("Error deleting product:",e),alert("Gagal menghapus produk")}});var s},className:"p-1 text-red-600 hover:bg-red-100 rounded",children:ke.jsx(F,{className:"w-4 h-4"})})]})})]},t.id)})})]})}),ue>1&&ke.jsxs("div",{className:"flex items-center justify-between mt-4",children:[ke.jsxs("div",{className:"text-sm text-gray-700",children:["Menampilkan ",he+1," hingga ",Math.min(me,de.length)," dari ",de.length," produk"]}),ke.jsxs("div",{className:"flex items-center space-x-2",children:[ke.jsx("button",{onClick:()=>J(Math.max(1,W-1)),disabled:1===W,className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:ke.jsx(k,{className:"w-4 h-4"})}),Array.from({length:Math.min(5,ue)},(e,t)=>{let s;return s=ue<=5||W<=3?t+1:W>=ue-2?ue-4+t:W-2+t,ke.jsx("button",{onClick:()=>J(s),className:"px-3 py-1 border rounded-lg "+(W===s?"bg-blue-600 text-white border-blue-600":"border-gray-300 hover:bg-gray-50"),children:s},s)}),ke.jsx("button",{onClick:()=>J(Math.min(ue,W+1)),disabled:W===ue,className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:ke.jsx(I,{className:"w-4 h-4"})})]})]})]})]})]}),x&&ke.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:ke.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[ke.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4",children:ke.jsxs("div",{className:"flex items-center justify-between",children:[ke.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Tambah Produk Baru"}),ke.jsx("button",{onClick:()=>v(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:ke.jsx(G,{className:"w-5 h-5 text-gray-500"})})]})}),ke.jsxs("form",{onSubmit:t=>g(e,null,function*(){t.preventDefault();try{const t=le();let s=[];const r=X.images.filter(e=>"object"==typeof e&&e.file);if(r.length>0){console.log(` Uploading ${r.length} images to Firebase Storage...`);const t=`temp_${Date.now()}`;try{s=yield Ev(r.map(e=>e.file),t),console.log(` Successfully uploaded ${s.length} images to Firebase Storage`)}catch(e){return console.error(" Failed to upload images:",e),void alert("Gagal mengupload gambar ke Firebase Storage. Silakan coba lagi.")}}const n=[...X.images.filter(e=>"string"==typeof e),...s],i=u(d({},X),{images:n,retailPrice:parseInt(X.retailPrice)||0,resellerPrice:parseInt(X.resellerPrice)||0,costPrice:parseInt(X.costPrice)||0,weight:parseInt(X.weight)||0,stock:t,variants:{sizes:X.variants.sizes,colors:X.variants.colors,stock:X.variants.stock},status:X.status,createdAt:new Date,salesCount:0,isFeatured:!1,isFlashSale:!1,flashSalePrice:parseInt(X.retailPrice)||0});console.log(" Saving to Firestore:",{name:i.name,sizes:i.variants.sizes,colors:i.variants.colors,status:i.status,weight:i.weight,images:n.length}),yield o(i),Z({name:"",description:"",category:"Hijab",retailPrice:"",resellerPrice:"",costPrice:"",weight:"",images:[],variants:{sizes:[],colors:[],stock:{}},status:"ready"}),v(!1)}catch(s){console.error("Error adding product:",s),alert("Gagal menambahkan produk")}}),className:"p-6 space-y-6",children:[ke.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nama Produk *"}),ke.jsx("input",{type:"text",required:!0,value:X.name,onChange:e=>Z(u(d({},X),{name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kategori *"}),ke.jsx("select",{required:!0,value:X.category,onChange:e=>Z(u(d({},X),{category:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:oe.map(e=>ke.jsx("option",{value:e,children:e},e))})]})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Deskripsi"}),ke.jsx("textarea",{rows:3,value:X.description,onChange:e=>Z(u(d({},X),{description:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" Gambar Produk"}),ke.jsxs("div",{className:"space-y-4",children:[ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Upload Gambar dari Device (opsional)"}),ke.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:ce,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"}),ke.jsx("p",{className:"text-xs text-gray-500 mt-1",children:" Bisa pilih multiple gambar (JPG, PNG, WebP). Maksimal 5MB per gambar."})]}),X.images.length>0&&ke.jsxs("div",{children:[ke.jsxs("label",{className:"block text-xs text-gray-600 mb-2",children:["Gambar yang Ditambahkan (",X.images.length,")"]}),ke.jsx("div",{className:"grid grid-cols-4 gap-2",children:X.images.map((e,t)=>{const s="object"==typeof e,r=s?e.preview:e;return ke.jsxs("div",{className:"relative group",children:[ke.jsx("img",{src:r,alt:`Preview ${t+1}`,className:"w-full h-24 object-cover rounded-lg border border-gray-200",onError:e=>{e.target.src="/placeholder-product.jpg"}}),s&&e.isUploading&&ke.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-lg",children:ke.jsx("div",{className:"text-white text-xs",children:" Uploading..."})}),ke.jsx("button",{type:"button",onClick:()=>{Z(u(d({},X),{images:X.images.filter((e,s)=>s!==t)}))},className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:ke.jsx(G,{className:"w-3 h-3"})}),ke.jsx("div",{className:"absolute bottom-1 left-1 bg-black bg-opacity-50 text-white text-xs px-1 rounded",children:t+1})]},t)})}),ke.jsx("p",{className:"text-xs text-gray-500 mt-1",children:" Gambar pertama akan menjadi gambar utama produk"})]}),0===X.images.length&&ke.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 text-center",children:[ke.jsx("div",{className:"text-gray-400 mb-2",children:ke.jsx("svg",{className:"w-8 h-8 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:ke.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),ke.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Belum ada gambar produk"}),ke.jsx("p",{className:"text-xs text-gray-500",children:"Upload gambar dari device atau lanjutkan tanpa gambar (gambar placeholder akan digunakan)"})]})]})]}),ke.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Harga Jual (Rp) *"}),ke.jsx("input",{type:"number",required:!0,min:"0",placeholder:"0",value:X.retailPrice,onChange:e=>Z(u(d({},X),{retailPrice:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Harga Reseller (Rp)"}),ke.jsx("input",{type:"number",min:"0",placeholder:"0",value:X.resellerPrice,onChange:e=>Z(u(d({},X),{resellerPrice:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Harga Modal (Rp)"}),ke.jsx("input",{type:"number",min:"0",placeholder:"0",value:X.costPrice,onChange:e=>Z(u(d({},X),{costPrice:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Berat Produk (gram) *"}),ke.jsx("input",{type:"number",required:!0,min:"1",step:"1",placeholder:"1000",value:X.weight,onChange:e=>Z(u(d({},X),{weight:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),ke.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Berat produk dalam gram (contoh: 1000 = 1kg)"})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kondisi Produk *"}),ke.jsxs("select",{value:X.status,onChange:e=>Z(u(d({},X),{status:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[ke.jsx("option",{value:"ready",children:"Ready Stock"}),ke.jsx("option",{value:"po",children:"Pre-Order (PO)"})]}),ke.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"ready"===X.status?" Produk siap dikirim":" Produk butuh waktu pengerjaan"})]}),ke.jsxs("div",{className:"space-y-4",children:[ke.jsxs("div",{children:[ke.jsxs("div",{className:"flex items-center justify-between mb-3",children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700",children:" Ukuran Produk"}),ke.jsx("button",{type:"button",onClick:()=>{const e=`Ukuran ${X.variants.sizes.length+1}`;Z(u(d({},X),{variants:u(d({},X.variants),{sizes:[...X.variants.sizes,e],stock:u(d({},X.variants.stock),{[e]:X.variants.colors.reduce((e,t)=>u(d({},e),{[t]:""}),{})})})}))},className:"px-3 py-1 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors text-sm",children:"+ Tambah Ukuran"})]}),ke.jsx("div",{className:"flex flex-wrap gap-2",children:X.variants.sizes.map((e,t)=>ke.jsxs("div",{className:"flex items-center space-x-2 bg-gray-50 px-3 py-2 rounded-lg",children:[ke.jsx("input",{type:"text",value:e,onChange:e=>{const s=[...X.variants.sizes];s[t]=e.target.value;const r=X.variants.sizes[t],n=d({},X.variants.stock);r!==e.target.value&&n[r]&&(n[e.target.value]=n[r],delete n[r]),Z(u(d({},X),{variants:u(d({},X.variants),{sizes:s,stock:n})}))},className:"px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"contoh: S, M, L"}),ke.jsx("button",{type:"button",onClick:()=>(e=>{const t=X.variants.sizes.filter(t=>t!==e),s=d({},X.variants.stock);delete s[e],Z(u(d({},X),{variants:u(d({},X.variants),{sizes:t,stock:s})}))})(e),className:"text-red-500 hover:text-red-700",children:ke.jsx(G,{className:"w-4 h-4"})})]},t))}),0===X.variants.sizes.length&&ke.jsx("p",{className:"text-sm text-gray-500",children:"Tambahkan ukuran untuk mulai mengelola varian"})]}),ke.jsxs("div",{children:[ke.jsxs("div",{className:"flex items-center justify-between mb-3",children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700",children:" Warna Produk"}),ke.jsx("button",{type:"button",onClick:()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[X.variants.colors.length%26];Z(u(d({},X),{variants:u(d({},X.variants),{colors:[...X.variants.colors,e],stock:Object.keys(X.variants.stock).reduce((t,s)=>{const r=X.variants.stock[s]||{};return u(d({},t),{[s]:u(d({},r),{[e]:""})})},{})})}))},className:"px-3 py-1 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition-colors text-sm",children:"+ Tambah Warna"})]}),ke.jsx("div",{className:"flex flex-wrap gap-2",children:X.variants.colors.map((e,t)=>ke.jsxs("div",{className:"flex items-center space-x-2 bg-gray-50 px-3 py-2 rounded-lg",children:[ke.jsx("input",{type:"text",value:e,onChange:e=>{const s=[...X.variants.colors],r=X.variants.colors[t];s[t]=e.target.value;const n=Object.keys(X.variants.stock).reduce((t,s)=>(t[s]=d({},X.variants.stock[s]),r!==e.target.value&&void 0!==t[s][r]&&(t[s][e.target.value]=t[s][r],delete t[s][r]),t),{});Z(u(d({},X),{variants:u(d({},X.variants),{colors:s,stock:n})}))},className:"px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"contoh: Merah, Biru"}),ke.jsx("button",{type:"button",onClick:()=>(e=>{const t=X.variants.colors.filter(t=>t!==e),s=Object.keys(X.variants.stock).reduce((t,s)=>{const r=d({},X.variants.stock[s]);return delete r[e],t[s]=r,t},{});Z(u(d({},X),{variants:u(d({},X.variants),{colors:t,stock:s})}))})(e),className:"text-red-500 hover:text-red-700",children:ke.jsx(G,{className:"w-4 h-4"})})]},t))}),0===X.variants.colors.length&&ke.jsx("p",{className:"text-sm text-gray-500",children:"Tambahkan warna untuk mulai mengelola varian"})]}),X.variants.sizes.length>0&&X.variants.colors.length>0&&ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:" Stok per Varian"}),ke.jsx("div",{className:"bg-gray-50 rounded-lg p-4 overflow-x-auto",children:ke.jsxs("table",{className:"w-full text-sm",children:[ke.jsx("thead",{children:ke.jsxs("tr",{className:"border-b border-gray-200",children:[ke.jsx("th",{className:"text-left py-2 px-2 font-medium text-gray-700",children:"Ukuran \\ Warna"}),X.variants.colors.map((e,t)=>ke.jsx("th",{className:"text-center py-2 px-2 font-medium text-gray-700",children:e},t))]})}),ke.jsx("tbody",{children:X.variants.sizes.map((e,t)=>ke.jsxs("tr",{className:"border-b border-gray-100",children:[ke.jsx("td",{className:"py-2 px-2 font-medium text-gray-600",children:e}),X.variants.colors.map((t,s)=>{var r;return ke.jsx("td",{className:"py-2 px-2 text-center",children:ke.jsx("input",{type:"number",min:"0",placeholder:"0",value:(null==(r=X.variants.stock[e])?void 0:r[t])||"",onChange:s=>((e,t,s)=>{const r="string"==typeof s?parseInt(s)||0:s;Z(u(d({},X),{variants:u(d({},X.variants),{stock:u(d({},X.variants.stock),{[e]:u(d({},X.variants.stock[e]),{[t]:r})})})}))})(e,t,s.target.value),className:"w-16 px-2 py-1 border border-gray-300 rounded text-center text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"})},s)})]},t))})]})}),ke.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[ke.jsxs("p",{className:"text-sm text-gray-600",children:["Total Stok: ",ke.jsxs("span",{className:"font-semibold text-blue-600",children:[le()," pcs"]})]}),ke.jsx("p",{className:"text-xs text-gray-500",children:" Total stok akan dihitung otomatis dari semua varian"})]})]})]}),ke.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[ke.jsx("button",{type:"button",onClick:()=>v(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Batal"}),ke.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Tambah Produk"})]})]})]})}),w&&R&&ke.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:ke.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[ke.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4",children:ke.jsxs("div",{className:"flex items-center justify-between",children:[ke.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Edit Produk"}),ke.jsx("button",{onClick:()=>{N(!1),O(null)},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:ke.jsx(G,{className:"w-5 h-5 text-gray-500"})})]})}),ke.jsxs("form",{onSubmit:t=>g(e,null,function*(){if(t.preventDefault(),R)try{let t=[];const s=X.images.filter(e=>"object"==typeof e&&e.file);if(s.length>0){console.log(` Uploading ${s.length} new images to Firebase Storage...`);try{t=yield Ev(s.map(e=>e.file),R.id),console.log(` Successfully uploaded ${t.length} new images to Firebase Storage`)}catch(e){return console.error(" Failed to upload images:",e),void alert("Gagal mengupload gambar ke Firebase Storage. Silakan coba lagi.")}}const r=[...X.images.filter(e=>"string"==typeof e),...t],n=u(d({},X),{images:r,retailPrice:parseInt(X.retailPrice)||0,resellerPrice:parseInt(X.resellerPrice)||0,costPrice:parseInt(X.costPrice)||0,weight:parseInt(X.weight)||0,variants:X.variants.sizes.length>0?X.variants:void 0,stock:X.variants.sizes.length>0?le():void 0,status:X.status});console.log(" Updating product in Firestore:",{id:R.id,name:n.name,newImages:t.length,totalImages:r.length}),yield a(R.id,n),N(!1),O(null)}catch(s){console.error("Error updating product:",s),alert("Gagal memperbarui produk")}}),className:"p-6 space-y-6",children:[ke.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nama Produk *"}),ke.jsx("input",{type:"text",required:!0,value:X.name,onChange:e=>Z(u(d({},X),{name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kategori *"}),ke.jsx("select",{required:!0,value:X.category,onChange:e=>Z(u(d({},X),{category:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:oe.map(e=>ke.jsx("option",{value:e,children:e},e))})]})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Deskripsi"}),ke.jsx("textarea",{rows:3,value:X.description,onChange:e=>Z(u(d({},X),{description:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" Gambar Produk"}),ke.jsxs("div",{className:"space-y-4",children:[ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Upload Gambar dari Device (opsional)"}),ke.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:ce,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"}),ke.jsx("p",{className:"text-xs text-gray-500 mt-1",children:" Bisa pilih multiple gambar (JPG, PNG, WebP). Maksimal 5MB per gambar."})]}),X.images.length>0&&ke.jsxs("div",{children:[ke.jsxs("label",{className:"block text-xs text-gray-600 mb-2",children:["Gambar yang Ditambahkan (",X.images.length,")"]}),ke.jsx("div",{className:"grid grid-cols-4 gap-2",children:X.images.map((e,t)=>{const s="object"==typeof e,r=s?e.preview:e;return ke.jsxs("div",{className:"relative group",children:[ke.jsx("img",{src:r,alt:`Preview ${t+1}`,className:"w-full h-24 object-cover rounded-lg border border-gray-200",onError:e=>{e.target.src="/placeholder-product.jpg"}}),s&&e.isUploading&&ke.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-lg",children:ke.jsx("div",{className:"text-white text-xs",children:" Uploading..."})}),ke.jsx("button",{type:"button",onClick:()=>{Z(u(d({},X),{images:X.images.filter((e,s)=>s!==t)}))},className:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:ke.jsx(G,{className:"w-3 h-3"})}),ke.jsx("div",{className:"absolute bottom-1 left-1 bg-black bg-opacity-50 text-white text-xs px-1 rounded",children:t+1})]},t)})}),ke.jsx("p",{className:"text-xs text-gray-500 mt-1",children:" Gambar pertama akan menjadi gambar utama produk"})]}),0===X.images.length&&ke.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 text-center",children:[ke.jsx("div",{className:"text-gray-400 mb-2",children:ke.jsx("svg",{className:"w-8 h-8 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:ke.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),ke.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Belum ada gambar produk"}),ke.jsx("p",{className:"text-xs text-gray-500",children:"Upload gambar dari device atau lanjutkan tanpa gambar (gambar placeholder akan digunakan)"})]})]})]}),ke.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Harga Jual (Rp) *"}),ke.jsx("input",{type:"number",required:!0,min:"0",placeholder:"0",value:X.retailPrice,onChange:e=>Z(u(d({},X),{retailPrice:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Harga Reseller (Rp)"}),ke.jsx("input",{type:"number",min:"0",placeholder:"0",value:X.resellerPrice,onChange:e=>Z(u(d({},X),{resellerPrice:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Harga Modal (Rp)"}),ke.jsx("input",{type:"number",min:"0",placeholder:"0",value:X.costPrice,onChange:e=>Z(u(d({},X),{costPrice:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Berat Produk (gram) *"}),ke.jsx("input",{type:"number",required:!0,min:"1",step:"1",placeholder:"1000",value:X.weight,onChange:e=>Z(u(d({},X),{weight:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),ke.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Berat produk dalam gram (contoh: 1000 = 1kg)"})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kondisi Produk *"}),ke.jsxs("select",{value:X.status,onChange:e=>Z(u(d({},X),{status:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[ke.jsx("option",{value:"ready",children:"Ready Stock"}),ke.jsx("option",{value:"po",children:"Pre-Order (PO)"})]}),ke.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"ready"===X.status?" Produk siap dikirim":" Produk butuh waktu pengerjaan"})]}),ke.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[ke.jsx("button",{type:"button",onClick:()=>{N(!1),O(null)},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Batal"}),ke.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Simpan Perubahan"})]})]})]})}),j&&ke.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:ke.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[ke.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4",children:ke.jsxs("div",{className:"flex items-center justify-between",children:[ke.jsxs("h2",{className:"text-xl font-bold text-gray-800",children:["Edit ",M.length," Produk Terpilih"]}),ke.jsx("button",{onClick:()=>{S(!1),U([])},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:ke.jsx(G,{className:"w-5 h-5 text-gray-500"})})]})}),ke.jsxs("div",{className:"p-6 space-y-6",children:[ke.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[ke.jsx("h4",{className:"font-medium text-gray-800 mb-3",children:"Produk yang akan diedit:"}),ke.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:M.map(e=>{const t=n.find(t=>t.id===e);return t?ke.jsxs("div",{className:"flex items-center justify-between text-sm",children:[ke.jsx("span",{className:"font-medium",children:t.name}),ke.jsx("span",{className:"text-gray-500",children:t.category})]},t.id):null})})]}),M.length>0&&M.every(e=>{var t;return null==(t=n.find(t=>t.id===e))?void 0:t.isFeatured})&&ke.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:ke.jsxs("p",{className:"text-sm text-yellow-800",children:[" ",ke.jsx("strong",{children:"Info:"}),' Saat ini semua produk yang dipilih adalah produk unggulan. Pilih "Hapus dari Unggulan" untuk menghapus status unggulan dari produk ini.']})}),ke.jsxs("div",{className:"space-y-4",children:[ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ubah Kategori (kosongkan jika tidak ingin mengubah)"}),ke.jsxs("select",{value:te.category,onChange:e=>se(u(d({},te),{category:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[ke.jsx("option",{value:"",children:"-- Tidak Diubah --"}),oe.map(e=>ke.jsx("option",{value:e,children:e},e))]})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ubah Harga Jual (Rp)"}),ke.jsx("input",{type:"number",min:"0",value:te.retailPrice||"",onChange:e=>se(u(d({},te),{retailPrice:parseInt(e.target.value)||0})),placeholder:"Kosongkan jika tidak ingin mengubah",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ubah Stok"}),ke.jsx("input",{type:"number",min:"0",value:te.stock||"",onChange:e=>se(u(d({},te),{stock:parseInt(e.target.value)||0})),placeholder:"Kosongkan jika tidak ingin mengubah",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ubah Kondisi Produk"}),ke.jsxs("select",{value:te.status||"",onChange:e=>se(u(d({},te),{status:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[ke.jsx("option",{value:"",children:"-- Tidak Diubah --"}),ke.jsx("option",{value:"ready",children:"Ready Stock"}),ke.jsx("option",{value:"po",children:"Pre-Order (PO)"})]})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status Produk Unggulan"}),ke.jsxs("select",{value:void 0===te.isFeatured?"":te.isFeatured?"true":"false",onChange:e=>{const t=e.target.value;se(u(d({},te),""===t?{isFeatured:void 0}:{isFeatured:"true"===t}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[ke.jsx("option",{value:"",children:"-- Pilih Aksi --"}),ke.jsx("option",{value:"false",children:"Hapus dari Unggulan"}),ke.jsx("option",{value:"true",children:"Jadikan Unggulan"})]})]})]}),ke.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[ke.jsx("button",{onClick:()=>{S(!1),U([])},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Batal"}),ke.jsx("button",{onClick:()=>g(e,null,function*(){if(0!==M.length)try{const e={};te.category&&(e.category=te.category),te.retailPrice>0&&(e.retailPrice=te.retailPrice,e.resellerPrice=Math.round(.8*te.retailPrice)),te.stock>=0&&(e.stock=te.stock),te.status&&(e.status=te.status),void 0!==te.isFeatured&&(e.isFeatured=te.isFeatured);for(const t of M)yield a(t,e);U([]),S(!1),se({category:"",retailPrice:0,discount:0,stock:-1,status:"",isFeatured:!1})}catch(e){console.error("Error updating products:",e),alert("Gagal memperbarui produk")}else alert("Pilih setidaknya satu produk")}),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Simpan Perubahan"})]})]})]})}),E&&ke.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:ke.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[ke.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4",children:ke.jsxs("div",{className:"flex items-center justify-between",children:[ke.jsxs("h2",{className:"text-xl font-bold text-gray-800 flex items-center space-x-2",children:[ke.jsx($,{className:"w-5 h-5 text-purple-600"}),ke.jsxs("span",{children:["Edit Varian Massal (",M.length," Produk)"]})]}),ke.jsx("button",{onClick:()=>C(!1),className:"text-gray-400 hover:text-gray-600",children:ke.jsx(G,{className:"w-5 h-5"})})]})}),ke.jsxs("div",{className:"p-6 space-y-6",children:[ke.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[ke.jsx("h4",{className:"font-medium text-gray-800 mb-3",children:"Produk yang akan diedit:"}),ke.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:M.map(e=>{const t=n.find(t=>t.id===e);return t?ke.jsxs("div",{className:"flex items-center justify-between text-sm",children:[ke.jsx("span",{className:"font-medium",children:t.name}),ke.jsx("span",{className:"text-gray-500",children:t.category})]},t.id):null})})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:" Ukuran Produk"}),ke.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:re.sizes.map((e,t)=>ke.jsxs("div",{className:"flex items-center space-x-2 bg-gray-50 px-3 py-2 rounded-lg",children:[ke.jsx("input",{type:"text",value:e,onChange:e=>{const s=[...re.sizes];s[t]=e.target.value,ne(u(d({},re),{sizes:s}))},className:"px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"contoh: S, M, L"}),ke.jsx("button",{type:"button",onClick:()=>{const e=re.sizes.filter((e,s)=>s!==t);ne(u(d({},re),{sizes:e}))},className:"text-red-500 hover:text-red-700",children:ke.jsx(G,{className:"w-4 h-4"})})]},t))}),ke.jsx("button",{type:"button",onClick:()=>{const e=`Ukuran ${re.sizes.length+1}`;ne(u(d({},re),{sizes:[...re.sizes,e]}))},className:"px-3 py-1 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition-colors text-sm",children:"+ Tambah Ukuran"})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:" Warna Produk"}),ke.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:re.colors.map((e,t)=>ke.jsxs("div",{className:"flex items-center space-x-2 bg-gray-50 px-3 py-2 rounded-lg",children:[ke.jsx("input",{type:"text",value:e,onChange:e=>{const s=[...re.colors];s[t]=e.target.value,ne(u(d({},re),{colors:s}))},className:"px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"contoh: Merah, Biru"}),ke.jsx("button",{type:"button",onClick:()=>{const e=re.colors.filter((e,s)=>s!==t);ne(u(d({},re),{colors:e}))},className:"text-red-500 hover:text-red-700",children:ke.jsx(G,{className:"w-4 h-4"})})]},t))}),ke.jsx("button",{type:"button",onClick:()=>{const e="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[re.colors.length%26];ne(u(d({},re),{colors:[...re.colors,e]}))},className:"px-3 py-1 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition-colors text-sm",children:"+ Tambah Warna"})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:" Stok per Varian"}),ke.jsx("input",{type:"number",min:"0",value:re.stockPerVariant,onChange:e=>ne(u(d({},re),{stockPerVariant:parseInt(e.target.value)||0})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Masukkan stok per varian"}),ke.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["Total stok per produk: ",re.sizes.length,"  ",re.colors.length,"  ",re.stockPerVariant," = ",re.sizes.length*re.colors.length*re.stockPerVariant," pcs"]})]}),re.sizes.length>0&&re.colors.length>0&&ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:" Preview Stok Matrix"}),ke.jsx("div",{className:"bg-gray-50 rounded-lg p-4 overflow-x-auto",children:ke.jsxs("table",{className:"w-full text-sm",children:[ke.jsx("thead",{children:ke.jsxs("tr",{className:"border-b border-gray-200",children:[ke.jsx("th",{className:"text-left py-2 px-2 font-medium text-gray-700",children:"Ukuran \\ Warna"}),re.colors.map((e,t)=>ke.jsx("th",{className:"text-center py-2 px-2 font-medium text-gray-700",children:e},t))]})}),ke.jsx("tbody",{children:re.sizes.map((e,t)=>ke.jsxs("tr",{className:"border-b border-gray-100",children:[ke.jsx("td",{className:"py-2 px-2 font-medium text-gray-600",children:e}),re.colors.map((e,t)=>ke.jsx("td",{className:"py-2 px-2 text-center",children:ke.jsx("span",{className:"inline-block bg-purple-100 text-purple-700 px-2 py-1 rounded text-xs font-medium",children:re.stockPerVariant})},t))]},t))})]})})]}),ke.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:ke.jsxs("p",{className:"text-sm text-yellow-800",children:[" ",ke.jsx("strong",{children:"Perhatian:"})," Ini akan mengganti semua varian yang ada untuk produk yang dipilih. Semua ukuran, warna, dan stok akan disesuaikan dengan konfigurasi di atas."]})}),ke.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[ke.jsx("button",{onClick:()=>C(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Batal"}),ke.jsxs("button",{onClick:()=>g(e,null,function*(){if(0!==M.length)try{console.log(` Mengupdate varian untuk ${M.length} produk...`);const e={};re.sizes.forEach(t=>{e[t]={},re.colors.forEach(s=>{e[t][s]=re.stockPerVariant})});const t=re.sizes.length*re.colors.length*re.stockPerVariant;for(const s of M)yield a(s,{variants:{sizes:re.sizes,colors:re.colors,stock:e},stock:t});C(!1),U([]),alert(` Berhasil mengupdate varian untuk ${M.length} produk`)}catch(e){console.error("Error bulk updating variants:",e),alert("Gagal mengupdate varian beberapa produk. Silakan coba lagi.")}else alert("Pilih setidaknya satu produk")}),className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors flex items-center space-x-2",children:[ke.jsx($,{className:"w-4 h-4"}),ke.jsx("span",{children:"Update Varian"})]})]})]})]})}),A&&ke.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:ke.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[ke.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4",children:ke.jsxs("div",{className:"flex items-center justify-between",children:[ke.jsxs("h2",{className:"text-xl font-bold text-gray-800 flex items-center space-x-2",children:[ke.jsx(ee,{className:"w-6 h-6 text-red-600"}),ke.jsx("span",{children:"Konfigurasi Flash Sale"})]}),ke.jsx("button",{onClick:()=>D(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:ke.jsx(G,{className:"w-5 h-5 text-gray-500"})})]})}),ke.jsxs("div",{className:"p-6 space-y-6",children:[ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Pilih Produk untuk Flash Sale"}),ke.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-60 overflow-y-auto border border-gray-200 rounded-lg p-3",children:n.filter(e=>!e.isFlashSale).map(e=>ke.jsxs("label",{className:"flex items-center space-x-3 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[ke.jsx("input",{type:"checkbox",checked:ie.productIds.includes(e.id),onChange:t=>{t.target.checked?ae(u(d({},ie),{productIds:[...ie.productIds,e.id]})):ae(u(d({},ie),{productIds:ie.productIds.filter(t=>t!==e.id)}))},className:"rounded border-gray-300 text-red-600 focus:ring-red-500"}),ke.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.images.length>0?ke.jsx("img",{src:e.image||e.images[0]||"/placeholder-product.jpg",alt:e.name,className:"w-8 h-8 object-cover rounded"}):ke.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded flex items-center justify-center",children:ke.jsx($,{className:"w-4 h-4 text-gray-400"})}),ke.jsxs("div",{className:"flex-1",children:[ke.jsx("p",{className:"text-sm font-medium",children:e.name}),ke.jsxs("p",{className:"text-xs text-gray-500",children:["Rp ",e.retailPrice.toLocaleString("id-ID")]})]})]})]},e.id))}),ke.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:[ie.productIds.length," produk dipilih"]})]}),ke.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[ke.jsxs("div",{children:[ke.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[ke.jsx(T,{className:"w-4 h-4 inline mr-1"}),"Waktu Mulai"]}),ke.jsx("input",{type:"datetime-local",value:ie.startTime,onChange:e=>ae(u(d({},ie),{startTime:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"})]}),ke.jsxs("div",{children:[ke.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[ke.jsx(T,{className:"w-4 h-4 inline mr-1"}),"Waktu Berakhir"]}),ke.jsx("input",{type:"datetime-local",value:ie.endTime,onChange:e=>ae(u(d({},ie),{endTime:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"})]})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Diskon Flash Sale (Rp)"}),ke.jsx("input",{type:"number",value:ie.flashSaleDiscount||"",onChange:e=>ae(u(d({},ie),{flashSaleDiscount:parseInt(e.target.value)||0})),placeholder:"Masukkan jumlah diskon",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"})]}),ke.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[ke.jsx("button",{onClick:()=>D(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Batal"}),ke.jsxs("div",{className:"flex items-center space-x-2",children:[h&&ke.jsxs("button",{onClick:fe,className:"bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors flex items-center space-x-2",children:[ke.jsx(ee,{className:"w-4 h-4"}),ke.jsx("span",{children:"Stop Flash Sale"})]}),ie.productIds.length>0&&ke.jsxs("button",{onClick:()=>g(e,null,function*(){if(0!==ie.productIds.length)try{for(const e of ie.productIds){const t=n.find(t=>t.id===e);if(t){const s=Math.round(t.retailPrice-ie.flashSaleDiscount);yield a(e,{isFlashSale:!0,flashSalePrice:Math.max(s,1e3)})}}yield void console.log("Start flash sale - akan diimplementasi"),D(!1),ae({isActive:!1,startTime:"",endTime:"",flashSaleDiscount:0,productIds:[]})}catch(e){console.error("Error starting flash sale:",e),alert("Gagal memulai flash sale")}else alert("Pilih setidaknya satu produk untuk flash sale")}),className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors flex items-center space-x-2",children:[ke.jsx(ee,{className:"w-4 h-4"}),ke.jsx("span",{children:"Mulai Flash Sale"})]})]})]})]})]})})]})},Cv=({onBack:t,user:s,onRefreshProducts:r,onNavigateToHome:n})=>{var i,a,o,l,c,h,m,p,x,y;const{orders:b}=(()=>{const[t,s]=f.useState([]),[r,n]=f.useState(!0),[i,a]=f.useState(null),[o,l]=f.useState(!0);return f.useEffect(()=>{let t=null;const i=setTimeout(()=>{r&&o&&(console.warn("Loading taking too long, triggering fallback"),n(!1),l(!1),a("Loading terlalu lama, silakan refresh halaman"))},8e3);return g(e,null,function*(){try{if(!Ub.currentUser)return s([]),n(!1),void l(!1);const r=Qm(Fb,"orders"),i=(Up(r,qp("timestamp","desc")),Up(r,qp("timestamp","desc")));t=mg(i,e=>{const t=[];e.forEach(e=>{const s=e.data();t.push(u(d({},s),{id:e.id,createdAt:s.createdAt||(new Date).toISOString(),updatedAt:s.updatedAt||s.createdAt||(new Date).toISOString()}))}),s(t),n(!1),l(!1),a(null)},t=>g(e,null,function*(){console.error("Error listening to admin orders:",t),a(t.message),n(!1),l(!1);try{const e=yield Bb.getAllOrders();s(e),a(null)}catch(e){console.error("Fallback also failed:",e)}}))}catch(r){console.error("Error setting up admin orders listener:",r),a(r instanceof Error?r.message:"Unknown error"),n(!1),l(!1)}}),()=>{t&&t(),i&&clearTimeout(i)}},[]),{orders:t,loading:r&&o,error:i,initialLoad:o}})(),[v,w]=f.useState(""),[N,j]=f.useState("all"),[k,I]=f.useState("all"),[E,C]=f.useState("all"),[A,D]=f.useState(!1),[R,O]=f.useState(null),[L,M]=f.useState(!1),[F,U]=f.useState(""),[B,q]=f.useState(""),[K,H]=f.useState(""),[W,J]=f.useState(!1),[Y,X]=f.useState(!1),[Z,ee]=f.useState(null),[te,se]=f.useState(!1),[le,ce]=f.useState({title:"",message:"",onConfirm:()=>{},confirmText:"Ya, Lanjutkan",cancelText:"Batal",type:"warning"}),de=(t,s)=>g(e,null,function*(){return yield Bb.updateOrderStatus(t,s)}),ue=(t,s,r)=>g(e,null,function*(){return yield Bb.updateOrderPayment(t,s,r)}),he=(e,t,s,r={})=>{ce({title:e,message:t,onConfirm:()=>{s(),se(!1)},confirmText:r.confirmText||"Ya, Lanjutkan",cancelText:r.cancelText||"Batal",type:r.type||"warning"}),se(!0)},me=(e,t,s="info")=>{ce({title:e,message:t,onConfirm:()=>se(!1),confirmText:"OK",cancelText:"",type:s}),se(!0)},pe=t=>g(e,null,function*(){return yield Bb.deleteOrder(t)}),ge=e=>b.filter(t=>t.status===e);f.useEffect(()=>{const e=e=>{w(e=>e+" "),setTimeout(()=>w(e=>e.trim()),100)};return window.addEventListener("orderUpdated",e),()=>window.removeEventListener("orderUpdated",e)},[]);const ve={pending:{label:"Menunggu Pembayaran",icon:T,color:"text-orange-600 bg-orange-100"},awaiting_verification:{label:"Menunggu Verifikasi",icon:T,color:"text-yellow-600 bg-yellow-100"},paid:{label:"Dibayar",icon:ne,color:"text-blue-600 bg-blue-100"},processing:{label:"Diproses",icon:$,color:"text-purple-600 bg-purple-100"},shipped:{label:"Dikirim",icon:ie,color:"text-indigo-600 bg-indigo-100"},delivered:{label:"Selesai",icon:ne,color:"text-green-600 bg-green-100"},cancelled:{label:"Dibatalkan",icon:re,color:"text-red-600 bg-red-100"}},we=b.filter(e=>{const t=""===v||e.id.toLowerCase().includes(v.toLowerCase())||e.userName.toLowerCase().includes(v.toLowerCase())||e.userEmail.toLowerCase().includes(v.toLowerCase()),s="all"===N||e.status===N,r="all"===k||`${e.userName} (${e.userEmail})`===k,n="all"===E||e.items&&e.items.some(e=>e.productName===E);return t&&s&&r&&n}),Ne=e=>{O(e),M(!0)},je=(e,t,s="")=>{let r="",n="";switch(t){case"processing":n="Proses Pesanan",r=`Apakah barang sudah datang dan siap untuk diproses?\n\nPesanan #${s} akan diproses.`;break;case"shipped":n="Kirim Pesanan",r=`Apakah barang sudah dikirim ke pelanggan?\n\nPesanan #${s} akan ditandai sebagai terkirim.`;break;case"delivered":n="Selesaikan Pesanan",r=`Apakah barang sudah diterima pelanggan dan selesai?\n\nPesanan #${s} akan ditandai sebagai selesai.`;break;default:r=`Apakah Anda yakin ingin mengubah status pesanan #${s}?`}he(n,r,()=>{de(e,t)},{type:"warning"})},Ie=t=>g(e,null,function*(){if(R)try{"paid"===t?yield ue(R.id,F||"payment_verified","paid"):(console.log(" CANCELLING ORDER - Status will be set to:",t),yield de(R.id,t),console.log(" Order cancelled, refreshing products..."),r&&r(),n&&(console.log(" Navigating to home after order cancellation..."),setTimeout(()=>{n()},1e3))),M(!1),O(null),U(""),q("")}catch(e){console.error(" Error confirming verification:",e),me("Error","Gagal memperbarui verifikasi pesanan","error")}});return ke.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[ke.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4",children:ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx("button",{onClick:t,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:ke.jsx(P,{className:"w-5 h-5"})}),ke.jsx("h1",{className:"text-xl font-bold",children:"Kelola Pesanan"})]})}),ke.jsxs("div",{className:"p-4 space-y-4",children:[ke.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[ke.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[ke.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-1",children:"Total Pesanan"}),ke.jsx("p",{className:"text-2xl font-bold text-blue-600",children:b.length})]}),ke.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[ke.jsx("h4",{className:"text-sm font-medium text-orange-800 mb-1",children:"Menunggu"}),ke.jsx("p",{className:"text-2xl font-bold text-orange-600",children:ge("pending").length+ge("awaiting_verification").length})]}),ke.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[ke.jsx("h4",{className:"text-sm font-medium text-green-800 mb-1",children:"Selesai"}),ke.jsx("p",{className:"text-2xl font-bold text-green-600",children:ge("delivered").length})]}),ke.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[ke.jsx("h4",{className:"text-sm font-medium text-purple-800 mb-1",children:"Total Revenue"}),ke.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[Math.round(b.reduce((e,t)=>e+t.finalTotal,0)/1e3),"K"]})]})]}),ke.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:ke.jsxs("div",{className:"space-y-3",children:[ke.jsx("div",{className:"flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3",children:ke.jsxs("div",{className:"flex-1 relative",children:[ke.jsx(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),ke.jsx("input",{type:"text",placeholder:"Cari pesanan...",value:v,onChange:e=>w(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),ke.jsxs("div",{className:"flex flex-wrap gap-2",children:[ke.jsxs("select",{value:N,onChange:e=>j(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[ke.jsx("option",{value:"all",children:"Semua Status"}),Object.entries(ve).map(([e,t])=>ke.jsx("option",{value:e,children:t.label},e))]}),ke.jsxs("select",{value:k,onChange:e=>I(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm min-w-[200px]",children:[ke.jsx("option",{value:"all",children:"Semua Pelanggan"}),(()=>{const e=new Set;return b.forEach(t=>{t.userName&&t.userEmail&&e.add(`${t.userName} (${t.userEmail})`)}),Array.from(e).sort()})().map((e,t)=>ke.jsx("option",{value:e,children:e},t))]}),ke.jsxs("select",{value:E,onChange:e=>C(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm min-w-[150px]",children:[ke.jsx("option",{value:"all",children:"Semua Produk"}),(()=>{const e=new Set;return b.forEach(t=>{t.items&&t.items.forEach(t=>{t.productName&&e.add(t.productName)})}),Array.from(e).sort()})().map((e,t)=>ke.jsx("option",{value:e,children:e},t))]}),ke.jsx("input",{type:"date",value:K,onChange:e=>H(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"}),ke.jsx("button",{className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:ke.jsx(xe,{className:"w-4 h-4"})}),("all"!==N||"all"!==k||"all"!==E||v||K)&&ke.jsx("button",{onClick:()=>{w(""),j("all"),I("all"),C("all"),H("")},className:"px-3 py-2 bg-red-50 text-red-600 border border-red-200 rounded-lg hover:bg-red-100 transition-colors text-sm font-medium",children:"Reset Filter"})]})]})}),ke.jsx("div",{className:"space-y-3",children:0===we.length?ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-8 text-center",children:[ke.jsx($,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),ke.jsx("p",{className:"text-gray-500",children:"Belum ada pesanan"}),ke.jsx("p",{className:"text-sm text-gray-400",children:"Pesanan akan muncul di sini ketika ada checkout"})]}):we.map(e=>{const t=ve[e.status],i=t.icon;return ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 hover:shadow-md transition-shadow",children:[ke.jsxs("div",{className:"flex items-center justify-between mb-3",children:[ke.jsxs("div",{children:[ke.jsxs("p",{className:"font-semibold text-lg",children:["#",e.id]}),ke.jsxs("p",{className:"text-sm text-gray-600",children:[e.userName,"  ",e.userEmail]}),ke.jsx("p",{className:"text-xs text-gray-500",children:new Date(e.createdAt).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})})]}),ke.jsxs("div",{className:"text-right",children:[ke.jsxs("div",{className:`inline-flex items-center space-x-1 px-3 py-1 rounded-full text-xs font-medium ${t.color}`,children:[ke.jsx(i,{className:"w-3 h-3"}),ke.jsx("span",{children:t.label})]}),ke.jsxs("p",{className:"text-lg font-semibold text-pink-600 mt-1",children:["Rp ",e.finalTotal.toLocaleString("id-ID")]})]})]}),ke.jsxs("div",{className:"flex items-center justify-between",children:[ke.jsxs("div",{className:"text-sm text-gray-600",children:[e.items.length," item  ","transfer"===e.paymentMethod?"Transfer Bank":"COD"]}),ke.jsxs("div",{className:"flex items-center space-x-2",children:[ke.jsxs("button",{onClick:()=>(e=>{O(e),D(!0)})(e),className:"flex items-center space-x-1 text-blue-600 hover:text-blue-700 text-sm font-medium",children:[ke.jsx(Q,{className:"w-4 h-4"}),ke.jsx("span",{children:"Detail"})]}),"pending"===e.status||"awaiting_verification"===e.status?"owner"===(null==s?void 0:s.role)?ke.jsxs("button",{onClick:()=>Ne(e),className:"flex items-center space-x-1 text-green-600 hover:text-green-700 text-sm font-medium",children:[ke.jsx(ne,{className:"w-4 h-4"}),ke.jsx("span",{children:"Verifikasi"})]}):ke.jsxs("div",{className:"flex items-center space-x-1 text-gray-400 text-sm font-medium",children:[ke.jsx(ne,{className:"w-4 h-4"}),ke.jsx("span",{children:"Verifikasi (Owner Only)"})]}):"paid"===e.status&&(e.paymentProof||e.paymentProofData)?ke.jsxs("div",{className:"flex items-center space-x-1 text-blue-600 text-sm font-medium",children:[ke.jsx(ae,{className:"w-4 h-4"}),ke.jsx("span",{children:"Sudah Diverifikasi"})]}):null,"paid"===e.status&&ke.jsxs("button",{onClick:()=>je(e.id,"processing",e.id),className:"flex items-center space-x-1 text-purple-600 hover:text-purple-700 text-sm font-medium",children:[ke.jsx($,{className:"w-4 h-4"}),ke.jsx("span",{children:"Proses"})]}),"processing"===e.status&&ke.jsxs("button",{onClick:()=>je(e.id,"shipped",e.id),className:"flex items-center space-x-1 text-indigo-600 hover:text-indigo-700 text-sm font-medium",children:[ke.jsx(ie,{className:"w-4 h-4"}),ke.jsx("span",{children:"Kirim"})]}),"shipped"===e.status&&ke.jsxs("button",{onClick:()=>je(e.id,"delivered",e.id),className:"flex items-center space-x-1 text-green-600 hover:text-green-700 text-sm font-medium",children:[ke.jsx(ne,{className:"w-4 h-4"}),ke.jsx("span",{children:"Selesai"})]}),"owner"===(null==s?void 0:s.role)&&ke.jsxs("button",{onClick:()=>{return t=e.id,void he("Konfirmasi Hapus","Apakah Anda yakin ingin menghapus pesanan ini? Stock akan dikembalikan.",()=>{const e=b.find(e=>e.id===t);e?(console.log(" RESTORING STOCK BEFORE DELETING ORDER:",t),Bb.restoreStockForOrderManually(e).then(()=>{console.log(" Stock restored, deleting order:",t),pe(t),window.dispatchEvent(new CustomEvent("orderCancelled",{detail:{action:"cancelled",orderId:t,restoredStock:!0}})),r&&(console.log(" Refreshing products after stock restoration..."),r()),n&&(console.log(" Navigating to home page..."),setTimeout(()=>{n()},1e3))}).catch(e=>{console.error(" Error restoring stock before deletion:",e),pe(t),r&&r()})):pe(t)},{type:"error",confirmText:"Ya, Hapus",cancelText:"Batal"});var t},className:"flex items-center space-x-1 text-red-600 hover:text-red-700 text-sm font-medium",children:[ke.jsx(re,{className:"w-4 h-4"}),ke.jsx("span",{children:"Batal"})]})]})]})]},e.id)})})]}),A&&R&&ke.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:ke.jsxs("div",{className:"bg-white rounded-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[ke.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4",children:ke.jsxs("div",{className:"flex items-center justify-between",children:[ke.jsxs("h2",{className:"text-xl font-bold text-gray-800",children:["Detail Pesanan #",R.id]}),ke.jsx("button",{onClick:()=>D(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:ke.jsx(G,{className:"w-5 h-5 text-gray-500"})})]})}),ke.jsxs("div",{className:"p-6 space-y-6",children:[ke.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[ke.jsxs("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center",children:[ke.jsx(S,{className:"w-4 h-4 mr-2"}),"Informasi Pelanggan"]}),ke.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[ke.jsxs("div",{children:[ke.jsx("p",{className:"text-gray-600",children:"Nama"}),ke.jsx("p",{className:"font-medium",children:R.userName})]}),ke.jsxs("div",{children:[ke.jsx("p",{className:"text-gray-600",children:"Email"}),ke.jsx("p",{className:"font-medium",children:R.userEmail})]})]})]}),ke.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[ke.jsxs("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center",children:[ke.jsx(V,{className:"w-4 h-4 mr-2"}),"Informasi Pengiriman"]}),ke.jsxs("div",{className:"space-y-2 text-sm",children:[ke.jsxs("div",{children:[ke.jsx("p",{className:"text-gray-600",children:"Nama Penerima"}),ke.jsx("p",{className:"font-medium",children:(null==(i=R.shippingInfo)?void 0:i.name)||"-"})]}),ke.jsxs("div",{children:[ke.jsx("p",{className:"text-gray-600",children:"No. Telepon"}),ke.jsxs("p",{className:"font-medium flex items-center",children:[ke.jsx(z,{className:"w-3 h-3 mr-1"}),(null==(a=R.shippingInfo)?void 0:a.phone)||"-"]})]}),ke.jsxs("div",{children:[ke.jsx("p",{className:"text-gray-600",children:"Alamat"}),ke.jsx("p",{className:"font-medium",children:(null==(o=R.shippingInfo)?void 0:o.address)||"-"})]}),(null==(l=R.shippingInfo)?void 0:l.isDropship)&&ke.jsx("div",{className:"mt-2 p-2 bg-yellow-100 rounded",children:ke.jsxs("p",{className:"text-xs text-yellow-800",children:[ke.jsx("strong",{children:"Dropship:"})," ",R.shippingInfo.dropshipName," (",R.shippingInfo.dropshipPhone,")"]})})]})]}),ke.jsxs("div",{children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Detail Produk"}),ke.jsx("div",{className:"space-y-3",children:null==(c=R.items)?void 0:c.map((e,t)=>{var s,r;return ke.jsxs("div",{className:"flex items-center space-x-4 p-3 bg-gray-50 rounded-lg",children:[ke.jsxs("div",{className:"w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center overflow-hidden",children:[e.productImage?ke.jsx("img",{src:e.productImage,alt:e.productName,className:"w-full h-full object-cover",onError:e=>{const t=e.target;t.style.display="none",t.nextElementSibling&&(t.nextElementSibling.style.display="flex")}}):null,ke.jsx($,{className:"w-8 h-8 text-gray-400",style:{display:e.productImage?"none":"flex"}})]}),ke.jsxs("div",{className:"flex-1",children:[ke.jsx("p",{className:"font-medium",children:e.productName}),ke.jsxs("p",{className:"text-sm text-gray-600",children:[null==(s=e.selectedVariant)?void 0:s.size,", ",null==(r=e.selectedVariant)?void 0:r.color,"  ",e.quantity," pcs"]}),ke.jsxs("p",{className:"text-xs text-gray-500",children:["Rp ",e.price.toLocaleString("id-ID"),"  ",e.quantity]})]}),ke.jsxs("div",{className:"text-right",children:[ke.jsxs("p",{className:"font-medium text-lg",children:["Rp ",e.total.toLocaleString("id-ID")]}),ke.jsx("p",{className:"text-sm text-gray-600",children:"Subtotal"})]})]},t)})})]}),ke.jsx("div",{className:"border-t pt-4",children:ke.jsxs("div",{className:"space-y-2 text-sm",children:[ke.jsxs("div",{className:"flex justify-between",children:[ke.jsx("span",{className:"text-gray-600",children:"Subtotal"}),ke.jsxs("span",{className:"font-medium",children:["Rp ",null==(h=R.totalAmount)?void 0:h.toLocaleString("id-ID")]})]}),ke.jsxs("div",{className:"flex justify-between",children:[ke.jsx("span",{className:"text-gray-600",children:"Ongkos Kirim"}),ke.jsxs("span",{className:"font-medium",children:["Rp ",null==(m=R.shippingCost)?void 0:m.toLocaleString("id-ID")]})]}),ke.jsxs("div",{className:"flex justify-between text-lg font-bold pt-2 border-t",children:[ke.jsx("span",{children:"Total"}),ke.jsxs("span",{className:"text-pink-600",children:["Rp ",null==(p=R.finalTotal)?void 0:p.toLocaleString("id-ID")]})]})]})}),ke.jsxs("div",{className:(R.paymentProof||R.paymentProofData?"paid"===R.status?"bg-blue-50":"bg-green-50":"bg-gray-50")+" rounded-lg p-4",children:[ke.jsxs("div",{className:"flex items-center justify-between mb-3",children:[ke.jsxs("h3",{className:"font-semibold text-gray-800 flex items-center",children:[ke.jsx(ae,{className:"w-4 h-4 mr-2"}),"Bukti Pembayaran ","paid"===R.status&&"(Terverifikasi)"]}),!R.paymentProof&&!R.paymentProofData&&ke.jsxs("button",{onClick:()=>(ee(R),void X(!0)),className:"flex items-center space-x-1 text-blue-600 hover:text-blue-700 text-sm font-medium",children:[ke.jsx(oe,{className:"w-4 h-4"}),ke.jsx("span",{children:"Upload"})]})]}),R.paymentProof||R.paymentProofData?ke.jsx("div",{children:R.paymentProofData?ke.jsxs("div",{children:[ke.jsx("img",{src:`data:image/*;base64,${R.paymentProofData}`,alt:"Payment Proof",className:"w-full max-w-md rounded-lg border-2 border-green-200",onClick:()=>{const e=window.open("","_blank");e&&e.document.write(`\n                                <html>\n                                  <body style="margin:0;padding:20px;background:#f3f4f6;">\n                                    <img src="data:image/*;base64,${R.paymentProofData}"\n                                         style="max-width:100%;height:auto;display:block;margin:0 auto;"\n                                         alt="Payment Proof" />\n                                  </body>\n                                </html>\n                              `)},style:{cursor:"pointer"}}),ke.jsx("p",{className:"text-xs text-gray-600 mt-2 text-center",children:" Klik gambar untuk memperbesar"})]}):R.paymentProofUrl?ke.jsxs("div",{children:[ke.jsx("img",{src:R.paymentProofUrl,alt:"Payment Proof",className:"w-full max-w-md rounded-lg border-2 border-green-200",onClick:()=>window.open(R.paymentProofUrl,"_blank"),style:{cursor:"pointer"}}),ke.jsx("p",{className:"text-xs text-gray-600 mt-2 text-center",children:" Klik gambar untuk memperbesar"})]}):ke.jsxs("div",{className:"text-sm text-green-800",children:[ke.jsx("p",{className:"font-medium",children:" File Bukti Pembayaran:"}),ke.jsx("p",{className:"bg-white p-2 rounded border border-green-200 mt-1",children:R.paymentProof}),ke.jsx("p",{className:"text-xs mt-2 text-gray-600",children:"(File tersimpan di Firebase Firestore - Gratis!)"})]})}):ke.jsxs("div",{className:"text-sm text-gray-600 text-center py-4",children:[ke.jsx(oe,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),ke.jsx("p",{children:"Belum ada bukti pembayaran"}),ke.jsx("p",{className:"text-xs",children:'Klik tombol "Upload" untuk menambahkan bukti pembayaran'})]})]}),"paid"===R.status&&ke.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[ke.jsxs("h3",{className:"font-semibold text-gray-800 mb-2 flex items-center",children:[ke.jsx(ne,{className:"w-4 h-4 mr-2 text-blue-600"}),"Status Pembayaran"]}),ke.jsxs("p",{className:"text-sm text-blue-800",children:[" Pembayaran telah diverifikasi pada ",new Date(R.updatedAt).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),R.notes&&ke.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4",children:[ke.jsx("h3",{className:"font-semibold text-gray-800 mb-2",children:"Catatan"}),ke.jsx("p",{className:"text-sm text-gray-700",children:R.notes})]}),ke.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t",children:[ke.jsx("button",{onClick:()=>D(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"Tutup"}),("pending"===R.status||"awaiting_verification"===R.status)&&"owner"===(null==s?void 0:s.role)&&ke.jsxs("button",{onClick:()=>{D(!1),Ne(R)},className:"px-4 py-2 bg-green-600 text-white hover:bg-green-700 rounded-lg transition-colors flex items-center space-x-2",children:[ke.jsx(ne,{className:"w-4 h-4"}),ke.jsx("span",{children:"Verifikasi Pembayaran"})]})]})]})]})}),L&&R&&ke.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:ke.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full",children:[ke.jsx("div",{className:"border-b border-gray-200 px-6 py-4",children:ke.jsxs("div",{className:"flex items-center justify-between",children:[ke.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Verifikasi Pembayaran"}),ke.jsx("button",{onClick:()=>M(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:ke.jsx(G,{className:"w-5 h-5 text-gray-500"})})]})}),ke.jsxs("div",{className:"p-6 space-y-4",children:[ke.jsxs("div",{className:"text-center",children:[ke.jsx(ne,{className:"w-12 h-12 text-green-600 mx-auto mb-3"}),ke.jsxs("h3",{className:"font-medium text-gray-800 mb-2",children:["Pesanan #",R.id]}),ke.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Total: Rp ",null==(x=R.finalTotal)?void 0:x.toLocaleString("id-ID")]})]}),ke.jsx("div",{className:"space-y-3",children:ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Catatan Verifikasi"}),ke.jsx("textarea",{value:B,onChange:e=>q(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Tambahkan catatan jika diperlukan..."})]})}),ke.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:ke.jsxs("p",{className:"text-sm text-blue-800",children:[ke.jsx("strong",{children:"Periksa:"})," Pastikan bukti pembayaran sudah sesuai dengan jumlah yang dibayarkan."]})}),ke.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t",children:[ke.jsx("button",{onClick:()=>Ie("cancelled"),className:"px-4 py-2 text-red-700 bg-red-100 hover:bg-red-200 rounded-lg transition-colors",children:"Tolak"}),ke.jsxs("button",{onClick:()=>Ie("paid"),className:"px-4 py-2 bg-green-600 text-white hover:bg-green-700 rounded-lg transition-colors flex items-center space-x-2",children:[ke.jsx(fe,{className:"w-4 h-4"}),ke.jsx("span",{children:"Konfirmasi"})]})]})]})]})}),Y&&Z&&ke.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:ke.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full",children:[ke.jsx("div",{className:"border-b border-gray-200 px-6 py-4",children:ke.jsxs("div",{className:"flex items-center justify-between",children:[ke.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Upload Bukti Pembayaran"}),ke.jsx("button",{onClick:()=>X(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",disabled:W,children:ke.jsx(G,{className:"w-5 h-5 text-gray-500"})})]})}),ke.jsxs("div",{className:"p-6 space-y-4",children:[ke.jsxs("div",{className:"text-center",children:[ke.jsx(oe,{className:"w-12 h-12 text-blue-600 mx-auto mb-3"}),ke.jsxs("h3",{className:"font-medium text-gray-800 mb-2",children:["Pesanan #",Z.id]}),ke.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Total: Rp ",null==(y=Z.finalTotal)?void 0:y.toLocaleString("id-ID")]})]}),ke.jsx("div",{className:"space-y-3",children:ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pilih File Bukti Pembayaran"}),ke.jsx("input",{id:"payment-proof-file",type:"file",accept:"image/*",onChange:t=>g(e,null,function*(){var s;const r=null==(s=t.target.files)?void 0:s[0];if(r&&Z)if(r.type.startsWith("image/"))if(r.size>5242880)me("Error","Ukuran file maksimal 5MB","error");else{J(!0);try{const t=new FileReader;t.onload=t=>g(e,null,function*(){var e;const s=null==(e=t.target)?void 0:e.result,r=s.split(",")[1]||s;try{const e="pending"===Z.status?"awaiting_verification":Z.status;yield ue(Z.id,r,e),me("Berhasil",' Bukti pembayaran berhasil diupload! Status diubah menjadi "Menunggu Verifikasi".',"success"),X(!1),ee(null),w(e=>e+" "),setTimeout(()=>w(e=>e.trim()),100)}catch(n){console.error(" Error uploading payment proof:",n),me("Error","Gagal mengupload bukti pembayaran","error")}finally{J(!1)}}),t.readAsDataURL(r)}catch(n){console.error(" Error reading file:",n),me("Error","Gagal membaca file","error"),J(!1)}}else me("Error","Harap upload file gambar (JPG, PNG, dll)","error")}),disabled:W,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed"}),ke.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Format: JPG, PNG, maksimal 5MB"})]})}),ke.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:ke.jsxs("p",{className:"text-sm text-blue-800",children:[ke.jsx("strong",{children:"Informasi:"})," Upload bukti pembayaran dari pelanggan jika belum ada."]})}),ke.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t",children:[ke.jsx("button",{onClick:()=>X(!1),disabled:W,className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Batal"}),ke.jsx("button",{onClick:()=>{var e;return null==(e=document.getElementById("payment-proof-file"))?void 0:e.click()},disabled:W,className:"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 rounded-lg transition-colors flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:W?ke.jsxs(ke.Fragment,{children:[ke.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),ke.jsx("span",{children:"Uploading..."})]}):ke.jsxs(ke.Fragment,{children:[ke.jsx(oe,{className:"w-4 h-4"}),ke.jsx("span",{children:"Upload"})]})})]})]})]})}),te&&ke.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4",children:ke.jsxs("div",{className:"bg-white rounded-2xl max-w-lg w-full mx-4 shadow-2xl transform transition-all",children:[ke.jsx("div",{className:"px-6 py-5 rounded-t-2xl "+("error"===le.type?"bg-red-50":"success"===le.type?"bg-green-50":"warning"===le.type?"bg-yellow-50":"bg-blue-50"),children:ke.jsxs("div",{className:"flex items-center space-x-3",children:["error"===le.type&&ke.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center",children:ke.jsx(G,{className:"w-6 h-6 text-red-600"})}),"success"===le.type&&ke.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center",children:ke.jsx(ne,{className:"w-6 h-6 text-green-600"})}),"warning"===le.type&&ke.jsx("div",{className:"w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center",children:ke.jsx(ye,{className:"w-6 h-6 text-yellow-600"})}),"info"===le.type&&ke.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center",children:ke.jsx(be,{className:"w-6 h-6 text-blue-600"})}),ke.jsx("div",{className:"flex-1",children:ke.jsx("h3",{className:"text-xl font-bold "+("error"===le.type?"text-red-800":"success"===le.type?"text-green-800":"warning"===le.type?"text-yellow-800":"text-blue-800"),children:le.title})})]})}),ke.jsx("div",{className:"px-6 py-5",children:ke.jsx("p",{className:"text-gray-700 text-base leading-relaxed whitespace-pre-line",children:le.message})}),ke.jsxs("div",{className:"px-6 py-4 bg-gray-50 rounded-b-2xl flex items-center justify-end space-x-3",children:[le.cancelText&&ke.jsx("button",{onClick:()=>se(!1),className:"px-5 py-2.5 text-gray-700 bg-white border border-gray-300 hover:bg-gray-50 rounded-xl font-medium transition-all hover:shadow-md",children:le.cancelText}),ke.jsx("button",{onClick:le.onConfirm,className:"px-5 py-2.5 text-white rounded-xl font-medium transition-all hover:shadow-lg transform hover:scale-105 "+("error"===le.type?"bg-red-600 hover:bg-red-700":"success"===le.type?"bg-green-600 hover:bg-green-700":"warning"===le.type?"bg-yellow-600 hover:bg-yellow-700":"bg-blue-600 hover:bg-blue-700"),children:le.confirmText})]})]})})]})},Av=({onBack:e,user:t})=>{const[s,r]=f.useState("sales"),[n,i]=f.useState("today"),[a,o]=f.useState((new Date).toISOString().split("T")[0]),[l,c]=f.useState((new Date).toISOString().split("T")[0]),d={sales:{totalSales:25e5,totalOrders:45,avgOrderValue:55555,topProduct:"Hijab Segi Empat Premium",topCategory:"Hijab",growth:15.5},products:{totalProducts:12,lowStock:3,outOfStock:0,topSelling:"Gamis Syari Elegant",worstSelling:"Khimar Basic",avgPrice:125e3},customers:{totalCustomers:234,newCustomers:28,activeCustomers:189,topCustomer:"Siti Nurhaliza",avgOrdersPerCustomer:2.3}},u=d[s]||d.sales;return ke.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[ke.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4",children:ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx("button",{onClick:e,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:ke.jsx(P,{className:"w-5 h-5"})}),ke.jsx("h1",{className:"text-xl font-bold",children:"Laporan"})]})}),ke.jsxs("div",{className:"p-4 space-y-4",children:[ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Jenis Laporan"}),ke.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[ke.jsxs("button",{onClick:()=>r("sales"),className:"p-3 rounded-lg border-2 transition-colors "+("sales"===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"),children:[ke.jsx(ce,{className:"w-6 h-6 mx-auto mb-2"}),ke.jsx("p",{className:"text-sm font-medium",children:"Penjualan"})]}),ke.jsxs("button",{onClick:()=>r("products"),className:"p-3 rounded-lg border-2 transition-colors "+("products"===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"),children:[ke.jsx($,{className:"w-6 h-6 mx-auto mb-2"}),ke.jsx("p",{className:"text-sm font-medium",children:"Produk"})]}),ke.jsxs("button",{onClick:()=>r("customers"),className:"p-3 rounded-lg border-2 transition-colors "+("customers"===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"),children:[ke.jsx(de,{className:"w-6 h-6 mx-auto mb-2"}),ke.jsx("p",{className:"text-sm font-medium",children:"Pelanggan"})]}),ke.jsxs("button",{onClick:()=>r("financial"),className:"p-3 rounded-lg border-2 transition-colors "+("financial"===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"),children:[ke.jsx(ue,{className:"w-6 h-6 mx-auto mb-2"}),ke.jsx("p",{className:"text-sm font-medium",children:"Keuangan"})]})]})]}),ke.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:ke.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:space-x-4 space-y-3 md:space-y-0",children:[ke.jsxs("div",{className:"flex-1",children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Periode"}),ke.jsxs("select",{value:n,onChange:e=>i(e.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[ke.jsx("option",{value:"today",children:"Hari Ini"}),ke.jsx("option",{value:"week",children:"Minggu Ini"}),ke.jsx("option",{value:"month",children:"Bulan Ini"}),ke.jsx("option",{value:"year",children:"Tahun Ini"}),ke.jsx("option",{value:"custom",children:"Custom"})]})]}),"custom"===n&&ke.jsxs(ke.Fragment,{children:[ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dari"}),ke.jsx("input",{type:"date",value:a,onChange:e=>o(e.target.value),className:"p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sampai"}),ke.jsx("input",{type:"date",value:l,onChange:e=>c(e.target.value),className:"p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),ke.jsxs("button",{className:"p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[ke.jsx(ve,{className:"w-4 h-4"}),ke.jsx("span",{children:"Generate"})]}),ke.jsx("button",{className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:ke.jsx(xe,{className:"w-4 h-4"})})]})}),ke.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsxs("div",{className:"flex items-center justify-between mb-2",children:[ke.jsxs("h3",{className:"text-sm font-medium text-gray-600",children:["Total ","sales"===s?"Penjualan":"products"===s?"Produk":"Pelanggan"]}),ke.jsx(ue,{className:"w-4 h-4 text-green-500"})]}),ke.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["sales"===s&&`Rp ${u.totalSales.toLocaleString("id-ID")}`,"products"===s&&u.totalProducts,"customers"===s&&u.totalCustomers,"financial"===s&&"Rp 5.2M"]}),ke.jsx("p",{className:"text-xs text-green-600",children:"+15.5% dari periode lalu"})]}),ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsxs("div",{className:"flex items-center justify-between mb-2",children:[ke.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Transaksi"}),ke.jsx($,{className:"w-4 h-4 text-blue-500"})]}),ke.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["sales"===s&&u.totalOrders,"products"===s&&u.lowStock,"customers"===s&&u.newCustomers,"financial"===s&&"142"]}),ke.jsxs("p",{className:"text-xs text-gray-500",children:["sales"===s&&"Total pesanan","products"===s&&"Stok rendah","customers"===s&&"Pelanggan baru","financial"===s&&"Total transaksi"]})]}),ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsxs("div",{className:"flex items-center justify-between mb-2",children:[ke.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Rata-rata"}),ke.jsx(we,{className:"w-4 h-4 text-purple-500"})]}),ke.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["sales"===s&&`Rp ${u.avgOrderValue.toLocaleString("id-ID")}`,"products"===s&&`Rp ${u.avgPrice.toLocaleString("id-ID")}`,"customers"===s&&u.avgOrdersPerCustomer,"financial"===s&&"Rp 36K"]}),ke.jsxs("p",{className:"text-xs text-gray-500",children:["sales"===s&&"Nilai per order","products"===s&&"Harga rata-rata","customers"===s&&"Order per pelanggan","financial"===s&&"Transaksi rata-rata"]})]}),ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsxs("div",{className:"flex items-center justify-between mb-2",children:[ke.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Terbaik"}),ke.jsx(ce,{className:"w-4 h-4 text-orange-500"})]}),ke.jsx("p",{className:"text-lg font-bold text-gray-800 truncate",children:u.topProduct||u.topCustomer||"Hijab"}),ke.jsxs("p",{className:"text-xs text-gray-500 truncate",children:["sales"===s&&"Produk terlaris","products"===s&&"Produk terlaris","customers"===s&&"Pelanggan terbaik","financial"===s&&"Kategori terlaris"]})]})]}),ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[ke.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Grafik ","sales"===s?"Penjualan":"products"===s?"Produk":"Pelanggan"]}),ke.jsx("div",{className:"h-64 bg-gray-100 rounded-lg flex items-center justify-center",children:ke.jsxs("div",{className:"text-center",children:[ke.jsx(ce,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),ke.jsx("p",{className:"text-gray-500",children:"Grafik akan ditampilkan di sini"}),ke.jsx("p",{className:"text-sm text-gray-400",children:"Integrasi chart library diperlukan"})]})})]}),ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsxs("div",{className:"flex items-center justify-between mb-4",children:[ke.jsxs("h3",{className:"text-lg font-semibold",children:["Detail ","sales"===s?"Penjualan":"Data"]}),ke.jsx("button",{className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:ke.jsx(xe,{className:"w-4 h-4"})})]}),ke.jsx("div",{className:"overflow-x-auto",children:ke.jsxs("table",{className:"w-full text-sm",children:[ke.jsx("thead",{children:ke.jsxs("tr",{className:"border-b",children:[ke.jsx("th",{className:"text-left py-2",children:"Tanggal"}),ke.jsx("th",{className:"text-left py-2",children:"Deskripsi"}),ke.jsx("th",{className:"text-right py-2",children:"Jumlah"}),ke.jsx("th",{className:"text-right py-2",children:"Total"})]})}),ke.jsxs("tbody",{children:[ke.jsxs("tr",{className:"border-b",children:[ke.jsx("td",{className:"py-2",children:"15 Jan 2024"}),ke.jsx("td",{className:"py-2",children:"Penjualan Hijab Premium"}),ke.jsx("td",{className:"text-right",children:"5"}),ke.jsx("td",{className:"text-right font-medium",children:"Rp 425.000"})]}),ke.jsxs("tr",{className:"border-b",children:[ke.jsx("td",{className:"py-2",children:"14 Jan 2024"}),ke.jsx("td",{className:"py-2",children:"Penjualan Gamis Syari"}),ke.jsx("td",{className:"text-right",children:"3"}),ke.jsx("td",{className:"text-right font-medium",children:"Rp 495.000"})]})]})]})})]})]})]})},Pv=({onBack:e,user:t})=>{const[s,r]=f.useState(""),[n,i]=f.useState("all"),[a,o]=f.useState("all"),l=[{id:"USR001",name:"Siti Nurhaliza",email:"siti@email.com",phone:"08123456789",role:"customer",status:"active",joinDate:"2024-01-10",totalOrders:5,totalSpent:125e4},{id:"USR002",name:"Ahmad Fauzi",email:"ahmad@email.com",phone:"08234567890",role:"reseller",status:"active",joinDate:"2024-01-05",totalOrders:12,totalSpent:24e5,points:450},{id:"USR003",name:"Ratna Dewi",email:"ratna@email.com",phone:"08345678901",role:"customer",status:"active",joinDate:"2024-01-08",totalOrders:3,totalSpent:675e3},{id:"USR004",name:"Budi Santoso",email:"budi@email.com",phone:"08456789012",role:"admin",status:"active",joinDate:"2024-01-01",totalOrders:0,totalSpent:0}],c={owner:{label:"Owner",color:"text-red-600 bg-red-100",icon:X},admin:{label:"Administrator",color:"text-purple-600 bg-purple-100",icon:X},reseller:{label:"Reseller",color:"text-blue-600 bg-blue-100",icon:me},customer:{label:"Customer",color:"text-green-600 bg-green-100",icon:de}},d=l.filter(e=>{const t=e.name.toLowerCase().includes(s.toLowerCase())||e.email.toLowerCase().includes(s.toLowerCase()),r="all"===n||e.role===n,i="all"===a||e.status===a;return t&&r&&i});return ke.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[ke.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4",children:ke.jsxs("div",{className:"flex items-center justify-between",children:[ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx("button",{onClick:e,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:ke.jsx(P,{className:"w-5 h-5"})}),ke.jsx("h1",{className:"text-xl font-bold",children:"Kelola Pengguna"})]}),ke.jsxs("button",{className:"bg-white text-blue-600 px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors flex items-center space-x-2",children:[ke.jsx(L,{className:"w-4 h-4"}),ke.jsx("span",{children:"Tambah User"})]})]})}),ke.jsxs("div",{className:"p-4 space-y-4",children:[ke.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[ke.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[ke.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-1",children:"Total User"}),ke.jsx("p",{className:"text-2xl font-bold text-blue-600",children:l.length}),ke.jsx("p",{className:"text-xs text-blue-600",children:"Semua role"})]}),ke.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[ke.jsx("h4",{className:"text-sm font-medium text-green-800 mb-1",children:"User Aktif"}),ke.jsx("p",{className:"text-2xl font-bold text-green-600",children:l.filter(e=>"active"===e.status).length}),ke.jsxs("p",{className:"text-xs text-green-600",children:[Math.round(l.filter(e=>"active"===e.status).length/l.length*100),"% aktivasi"]})]}),ke.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[ke.jsx("h4",{className:"text-sm font-medium text-purple-800 mb-1",children:"Reseller"}),ke.jsx("p",{className:"text-2xl font-bold text-purple-600",children:l.filter(e=>"reseller"===e.role).length}),ke.jsx("p",{className:"text-xs text-purple-600",children:"Partner bisnis"})]}),ke.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[ke.jsx("h4",{className:"text-sm font-medium text-orange-800 mb-1",children:"User Baru"}),ke.jsx("p",{className:"text-2xl font-bold text-orange-600",children:"2"}),ke.jsx("p",{className:"text-xs text-orange-600",children:"Bulan ini"})]})]}),ke.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:ke.jsxs("div",{className:"flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3",children:[ke.jsxs("div",{className:"flex-1 relative",children:[ke.jsx(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),ke.jsx("input",{type:"text",placeholder:"Cari user...",value:s,onChange:e=>r(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),ke.jsxs("select",{value:n,onChange:e=>i(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[ke.jsx("option",{value:"all",children:"Semua Role"}),ke.jsx("option",{value:"customer",children:"Customer"}),ke.jsx("option",{value:"reseller",children:"Reseller"}),ke.jsx("option",{value:"admin",children:"Admin"}),ke.jsx("option",{value:"owner",children:"Owner"})]}),ke.jsxs("select",{value:a,onChange:e=>o(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[ke.jsx("option",{value:"all",children:"Semua Status"}),ke.jsx("option",{value:"active",children:"Aktif"}),ke.jsx("option",{value:"inactive",children:"Non-aktif"}),ke.jsx("option",{value:"banned",children:"Banned"})]}),ke.jsx("button",{className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:ke.jsx(C,{className:"w-4 h-4"})})]})}),ke.jsx("div",{className:"space-y-3",children:d.map(e=>{const s=c[e.role],r=s.icon;return ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ke.jsxs("div",{className:"flex items-center justify-between mb-3",children:[ke.jsxs("div",{className:"flex items-center space-x-3",children:[ke.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-100 to-purple-100 rounded-full flex items-center justify-center",children:ke.jsx(de,{className:"w-6 h-6 text-blue-600"})}),ke.jsxs("div",{children:[ke.jsx("p",{className:"font-semibold text-lg",children:e.name}),ke.jsx("p",{className:"text-sm text-gray-600",children:e.email}),ke.jsxs("p",{className:"text-xs text-gray-500",children:[e.phone,"  Bergabung: ",e.joinDate]})]})]}),ke.jsxs("div",{className:"text-right",children:[ke.jsxs("div",{className:`inline-flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium ${s.color}`,children:[ke.jsx(r,{className:"w-3 h-3"}),ke.jsx("span",{children:s.label})]}),ke.jsx("div",{className:"mt-1",children:ke.jsxs("span",{className:"inline-flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium "+("active"===e.status?"text-green-600 bg-green-100":"text-gray-600 bg-gray-100"),children:[ke.jsx("span",{className:"w-2 h-2 bg-current rounded-full"}),ke.jsx("span",{children:"active"===e.status?"Aktif":"Non-aktif"})]})})]})]}),ke.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-3",children:[ke.jsxs("div",{className:"text-center p-2 bg-gray-50 rounded",children:[ke.jsx("p",{className:"text-xs text-gray-600",children:"Total Order"}),ke.jsx("p",{className:"font-semibold",children:e.totalOrders})]}),ke.jsxs("div",{className:"text-center p-2 bg-gray-50 rounded",children:[ke.jsx("p",{className:"text-xs text-gray-600",children:"Total Belanja"}),ke.jsxs("p",{className:"font-semibold",children:["Rp ",e.totalSpent.toLocaleString("id-ID")]})]}),"reseller"===e.role&&ke.jsxs("div",{className:"text-center p-2 bg-blue-50 rounded",children:[ke.jsx("p",{className:"text-xs text-blue-600",children:"Poin Reseller"}),ke.jsxs("p",{className:"font-semibold text-blue-600",children:[e.points||0," pts"]})]}),ke.jsxs("div",{className:"text-center p-2 bg-gray-50 rounded",children:[ke.jsx("p",{className:"text-xs text-gray-600",children:"User ID"}),ke.jsx("p",{className:"font-semibold text-xs",children:e.id})]})]}),ke.jsxs("div",{className:"flex items-center justify-between",children:[ke.jsx("div",{className:"text-xs text-gray-500",children:"Terakhir login: 2 hari yang lalu"}),ke.jsxs("div",{className:"flex items-center space-x-2",children:[ke.jsx("button",{className:"p-1 text-blue-600 hover:text-blue-700 transition-colors",children:ke.jsx(Q,{className:"w-4 h-4"})}),ke.jsx("button",{className:"p-1 text-green-600 hover:text-green-700 transition-colors",children:ke.jsx(ge,{className:"w-4 h-4"})}),"owner"===(null==t?void 0:t.role)&&ke.jsx("button",{className:"p-1 text-red-600 hover:text-red-700 transition-colors",children:ke.jsx(F,{className:"w-4 h-4"})})]})]})]},e.id)})})]})]})},Dv=({user:t,onBack:s})=>{const[r,n]=f.useState("shipping-settings"),[i,a]=f.useState(!1),[o,l]=f.useState(null),[c,h]=f.useState("shipping"),[m,p]=f.useState({auto_check_days:30,auto_check_enabled:!0,next_auto_check:new Date(Date.now()+2592e6).toISOString().split("T")[0],cache_ttl_hours:720,max_cache_age_days:60,auto_cleanup_expired:!0,refresh_all_couriers:!0,notify_on_price_change:!1}),[x,y]=f.useState([]),[b,v]=f.useState(null),[w,N]=f.useState({origin:"",destination:"",weight:1e3,courier:"all"}),j=()=>g(e,null,function*(){try{const e=Ob().currentUser;return e?yield e.getIdToken():(console.error(" No Firebase user found"),"")}catch(e){return console.error(" Error getting Firebase auth token:",e),""}}),k=()=>g(e,null,function*(){a(!0);try{const e=yield j(),t=yield fetch("/api/admin/cache-settings?action=list",{headers:{Authorization:`Bearer ${e}`}}),s=yield t.json();s.success?(y(s.data.caches),v(s.data.summary),l({type:"success",text:`Found ${s.data.caches.length} cache entries`})):l({type:"error",text:s.message})}catch(e){l({type:"error",text:"Failed to load cache list"})}finally{a(!1)}}),I=t=>g(e,null,function*(){a(!0);try{const e=yield j(),s=yield fetch("/api/admin/cache-settings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({action:"update_settings",settings:t})}),r=yield s.json();if(r.success){const e=r.data.settings||r.data.updated_settings||t;p(t=>d(d({},t),e)),l({type:"success",text:"Cache settings updated successfully"})}else l({type:"error",text:r.message})}catch(e){l({type:"error",text:"Failed to update settings"})}finally{a(!1)}}),S=t=>g(e,null,function*(){if(confirm(`Hapus cache entry: ${t}?`))try{const e=yield j(),s=yield fetch(`/api/admin/cache-settings-temp?action=clear_specific&cache_key=${encodeURIComponent(t)}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`}}),r=yield s.json();r.success?(l({type:"success",text:`Cache entry ${t} deleted`}),k()):l({type:"error",text:r.message})}catch(e){l({type:"error",text:"Failed to delete cache entry"})}});return f.useEffect(()=>{"owner"===(null==t?void 0:t.role)&&g(e,null,function*(){a(!0);try{const e=yield j(),t=yield fetch("/api/admin/cache-settings?action=settings",{headers:{Authorization:`Bearer ${e}`}}),s=yield t.json();s.success?(p(s.data.settings),l({type:"success",text:"Cache settings loaded"})):l({type:"error",text:s.message})}catch(e){l({type:"error",text:"Failed to load cache settings"})}finally{a(!1)}})},[t]),f.useEffect(()=>{"shipping-list"!==r&&"address-list"!==r||"owner"!==(null==t?void 0:t.role)||k()},[r,t]),"owner"!==(null==t?void 0:t.role)?ke.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:ke.jsx("div",{className:"max-w-4xl mx-auto",children:ke.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[ke.jsx("h2",{className:"text-red-800 text-xl font-semibold mb-2",children:"Akses Ditolak"}),ke.jsx("p",{className:"text-red-600",children:"Hanya pengguna dengan role 'owner' yang bisa mengakses manajemen cache."}),ke.jsx("button",{onClick:s,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Go Back"})]})})}):ke.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:ke.jsxs("div",{className:"max-w-6xl mx-auto",children:[ke.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:ke.jsxs("div",{className:"flex justify-between items-center",children:[ke.jsxs("div",{children:[ke.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:" Manajemen Cache"}),ke.jsx("p",{className:"text-gray-600 mt-1",children:"Kelola pengaturan cache biaya pengiriman dan pantau performa"})]}),ke.jsx("button",{onClick:s,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:" Kembali ke Admin"})]})}),o&&ke.jsx("div",{className:"mb-6 p-4 rounded-lg "+("success"===o.type?"bg-green-50 text-green-800 border border-green-200":"error"===o.type?"bg-red-50 text-red-800 border border-red-200":"bg-blue-50 text-blue-800 border border-blue-200"),children:o.text}),ke.jsx("div",{className:"bg-white rounded-lg shadow-sm mb-4",children:ke.jsx("div",{className:"border-b border-gray-200",children:ke.jsxs("nav",{className:"flex space-x-1 px-6",children:[ke.jsx("button",{onClick:()=>h("shipping"),className:"py-3 px-4 border-b-2 font-medium text-sm rounded-t-lg "+("shipping"===c?"border-purple-500 text-purple-600 bg-purple-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"),children:" Cache Ongkir"}),ke.jsx("button",{onClick:()=>h("address"),className:"py-3 px-4 border-b-2 font-medium text-sm rounded-t-lg "+("address"===c?"border-orange-500 text-orange-600 bg-orange-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"),children:" Cache Alamat"})]})})}),ke.jsx("div",{className:"bg-white rounded-lg shadow-sm mb-6",children:ke.jsx("div",{className:"border-b border-gray-200",children:ke.jsx("nav",{className:"flex space-x-8 px-6",children:"shipping"===c?ke.jsxs(ke.Fragment,{children:[ke.jsx("button",{onClick:()=>n("shipping-settings"),className:"py-4 px-1 border-b-2 font-medium text-sm "+("shipping-settings"===r?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:" Auto Check"}),ke.jsx("button",{onClick:()=>n("shipping-list"),className:"py-4 px-1 border-b-2 font-medium text-sm "+("shipping-list"===r?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:" Daftar Cache Ongkir"}),ke.jsx("button",{onClick:()=>n("shipping-actions"),className:"py-4 px-1 border-b-2 font-medium text-sm "+("shipping-actions"===r?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:" Aksi Ongkir"})]}):ke.jsxs(ke.Fragment,{children:[ke.jsx("button",{onClick:()=>n("address-settings"),className:"py-4 px-1 border-b-2 font-medium text-sm "+("address-settings"===r?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:" Pengaturan Alamat"}),ke.jsx("button",{onClick:()=>n("address-list"),className:"py-4 px-1 border-b-2 font-medium text-sm "+("address-list"===r?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:" Daftar Cache Alamat"})]})})})}),"shipping-settings"===r&&"shipping"===c&&ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[ke.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Pengaturan Cache Otomatis"}),ke.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"Sistem akan otomatis mengecek harga ongkir setiap beberapa bulan. Jika harga masih sama, cache akan diperpanjang."}),ke.jsxs("div",{className:"max-w-md",children:[ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cek Otomatis Setiap"}),ke.jsxs("div",{className:"flex items-center space-x-2",children:[ke.jsx("input",{type:"number",min:"1",max:"365",value:m.auto_check_days||30,onChange:e=>p(u(d({},m),{auto_check_days:parseInt(e.target.value)||30})),className:"w-24 px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500 text-center"}),ke.jsx("span",{className:"text-sm text-gray-600",children:"hari sekali"})]}),ke.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Setiap ",m.auto_check_days||30," hari, sistem otomatis cek harga ongkir untuk semua kurir"]})]}),m.last_auto_check&&ke.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded",children:[ke.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Status Auto Check"}),ke.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[ke.jsxs("p",{children:["Terakhir cek: ",new Date(m.last_auto_check).toLocaleDateString("id-ID")]}),m.next_auto_check&&ke.jsxs("p",{children:["Cek berikutnya: ",new Date(m.next_auto_check).toLocaleDateString("id-ID")]}),ke.jsxs("p",{children:["Status: ",m.auto_check_enabled?" Aktif":" Nonaktif"]})]})]})]}),ke.jsx("div",{className:"mt-6 flex justify-end",children:ke.jsx("button",{onClick:()=>I(m),disabled:i,className:"px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:i?"Menyimpan...":"Simpan Pengaturan"})})]}),"address-settings"===r&&"address"===c&&ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[ke.jsx("h2",{className:"text-lg font-semibold mb-6",children:"Pengaturan Cache Alamat"}),ke.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cache TTL Provinsi"}),ke.jsxs("div",{className:"flex items-center space-x-2",children:[ke.jsx("input",{type:"number",min:"24",max:"8760",value:m.address_provinces_ttl_hours||4320,onChange:e=>p(u(d({},m),{address_provinces_ttl_hours:parseInt(e.target.value)})),className:"flex-1 px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"}),ke.jsx("span",{className:"text-sm text-gray-600",children:"jam"})]}),ke.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Default: 4320 jam (6 bulan) - provinsi jarang berubah"})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cache TTL Kota/Kabupaten"}),ke.jsxs("div",{className:"flex items-center space-x-2",children:[ke.jsx("input",{type:"number",min:"24",max:"8760",value:m.address_cities_ttl_hours||720,onChange:e=>p(u(d({},m),{address_cities_ttl_hours:parseInt(e.target.value)})),className:"flex-1 px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"}),ke.jsx("span",{className:"text-sm text-gray-600",children:"jam"})]}),ke.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Default: 720 jam (30 hari)"})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cache TTL Kecamatan"}),ke.jsxs("div",{className:"flex items-center space-x-2",children:[ke.jsx("input",{type:"number",min:"24",max:"8760",value:m.address_districts_ttl_hours||720,onChange:e=>p(u(d({},m),{address_districts_ttl_hours:parseInt(e.target.value)})),className:"flex-1 px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"}),ke.jsx("span",{className:"text-sm text-gray-600",children:"jam"})]}),ke.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Default: 720 jam (30 hari)"})]}),ke.jsxs("div",{children:[ke.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cache TTL Kelurahan/Desa"}),ke.jsxs("div",{className:"flex items-center space-x-2",children:[ke.jsx("input",{type:"number",min:"24",max:"8760",value:m.address_subdistricts_ttl_hours||720,onChange:e=>p(u(d({},m),{address_subdistricts_ttl_hours:parseInt(e.target.value)})),className:"flex-1 px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"}),ke.jsx("span",{className:"text-sm text-gray-600",children:"jam"})]}),ke.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Default: 720 jam (30 hari)"})]}),ke.jsx("div",{className:"md:col-span-2 space-y-3",children:ke.jsxs("label",{className:"flex items-center space-x-3",children:[ke.jsx("input",{type:"checkbox",checked:!1!==m.address_auto_cleanup_expired,onChange:e=>p(u(d({},m),{address_auto_cleanup_expired:e.target.checked})),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),ke.jsx("span",{className:"text-sm text-gray-700",children:"Otomatis Hapus Cache Alamat Kadaluarsa"})]})})]}),ke.jsx("div",{className:"mt-6 flex justify-end",children:ke.jsx("button",{onClick:()=>I(m),disabled:i,className:"px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:i?"Menyimpan...":"Simpan Pengaturan Alamat"})})]}),"shipping-list"===r&&"shipping"===c&&ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[ke.jsxs("div",{className:"flex justify-between items-center mb-6",children:[ke.jsx("h2",{className:"text-lg font-semibold",children:" Cache Ongkir"}),ke.jsx("button",{onClick:k,disabled:i,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:i?"Memuat...":" Refresh"})]}),b&&ke.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[ke.jsxs("div",{className:"bg-purple-50 p-4 rounded",children:[ke.jsx("div",{className:"text-2xl font-bold text-purple-600",children:b.shipping_total||0}),ke.jsx("div",{className:"text-sm text-purple-800",children:"Total Ongkir Cache"})]}),ke.jsxs("div",{className:"bg-green-50 p-4 rounded",children:[ke.jsx("div",{className:"text-2xl font-bold text-green-600",children:(b.shipping_total||0)-(b.shipping_expired||0)}),ke.jsx("div",{className:"text-sm text-green-800",children:"Active"})]}),ke.jsxs("div",{className:"bg-red-50 p-4 rounded",children:[ke.jsx("div",{className:"text-2xl font-bold text-red-600",children:b.shipping_expired||0}),ke.jsx("div",{className:"text-sm text-red-800",children:"Expired"})]}),ke.jsxs("div",{className:"bg-gray-50 p-4 rounded",children:[ke.jsx("div",{className:"text-2xl font-bold text-gray-600",children:b.oldest_cache}),ke.jsx("div",{className:"text-sm text-gray-800",children:"Oldest (days)"})]})]}),ke.jsxs("div",{className:"overflow-x-auto",children:[ke.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[ke.jsx("thead",{className:"bg-gray-50",children:ke.jsxs("tr",{children:[ke.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Route"}),ke.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Weight"}),ke.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Courier"}),ke.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Age"}),ke.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),ke.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),ke.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.filter(e=>"shipping"===e.type).map(e=>{var t;return ke.jsxs("tr",{className:e.is_expired?"bg-red-50":"",children:[ke.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.origin,"  ",e.destination]}),ke.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.weight,"g"]}),ke.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(null==(t=e.courier)?void 0:t.toUpperCase())||"N/A"}),ke.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.age_days," days"]}),ke.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:ke.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full "+(e.is_expired?"bg-red-100 text-red-800":"bg-green-100 text-green-800"),children:e.is_expired?"Expired":"Active"})}),ke.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:ke.jsx("button",{onClick:()=>S(e.cacheKey),className:"text-red-600 hover:text-red-900",children:"Hapus"})})]},e.cacheKey)})})]}),0===x.filter(e=>"shipping"===e.type).length&&ke.jsx("div",{className:"text-center py-8 text-gray-500",children:"Tidak ada cache ongkir yang ditemukan"})]})]}),"address-list"===r&&"address"===c&&ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[ke.jsxs("div",{className:"flex justify-between items-center mb-6",children:[ke.jsx("h2",{className:"text-lg font-semibold",children:" Cache Alamat"}),ke.jsx("button",{onClick:k,disabled:i,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:i?"Memuat...":" Refresh"})]}),b&&ke.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[ke.jsxs("div",{className:"bg-orange-50 p-4 rounded",children:[ke.jsx("div",{className:"text-2xl font-bold text-orange-600",children:b.address_total||0}),ke.jsx("div",{className:"text-sm text-orange-800",children:"Total Address Cache"})]}),ke.jsxs("div",{className:"bg-green-50 p-4 rounded",children:[ke.jsx("div",{className:"text-2xl font-bold text-green-600",children:(b.address_total||0)-(b.address_expired||0)}),ke.jsx("div",{className:"text-sm text-green-800",children:"Active"})]}),ke.jsxs("div",{className:"bg-red-50 p-4 rounded",children:[ke.jsx("div",{className:"text-2xl font-bold text-red-600",children:b.address_expired||0}),ke.jsx("div",{className:"text-sm text-red-800",children:"Expired"})]}),ke.jsxs("div",{className:"bg-gray-50 p-4 rounded",children:[ke.jsx("div",{className:"text-2xl font-bold text-gray-600",children:b.newest_cache}),ke.jsx("div",{className:"text-sm text-gray-800",children:"Newest (days)"})]})]}),ke.jsxs("div",{className:"overflow-x-auto",children:[ke.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[ke.jsx("thead",{className:"bg-gray-50",children:ke.jsxs("tr",{children:[ke.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cache Key"}),ke.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),ke.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data Count"}),ke.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Age"}),ke.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),ke.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),ke.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.filter(e=>"address"===e.type).map(e=>ke.jsxs("tr",{className:e.is_expired?"bg-red-50":"",children:[ke.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.cacheKey}),ke.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:ke.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded bg-orange-100 text-orange-800",children:e.data_type})}),ke.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.data_count||0," items"]}),ke.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.age_days," days"]}),ke.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:ke.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full "+(e.is_expired?"bg-red-100 text-red-800":"bg-green-100 text-green-800"),children:e.is_expired?"Expired":"Active"})}),ke.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:ke.jsx("button",{onClick:()=>S(e.cacheKey),className:"text-red-600 hover:text-red-900",children:"Hapus"})})]},e.cacheKey))})]}),0===x.filter(e=>"address"===e.type).length&&ke.jsx("div",{className:"text-center py-8 text-gray-500",children:"Tidak ada cache alamat yang ditemukan"})]})]}),"shipping-actions"===r&&"shipping"===c&&ke.jsxs("div",{className:"space-y-6",children:[ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[ke.jsx("h2",{className:"text-lg font-semibold mb-6",children:" Refresh Cache Ongkir"}),ke.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Paksa refresh cache ongkir untuk rute dan berat tertentu. Berguna jika ada perubahan harga kurir."}),ke.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[ke.jsx("input",{type:"text",placeholder:"Origin (city ID)",value:w.origin,onChange:e=>N(u(d({},w),{origin:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"}),ke.jsx("input",{type:"text",placeholder:"Destination (city ID)",value:w.destination,onChange:e=>N(u(d({},w),{destination:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"}),ke.jsx("input",{type:"number",placeholder:"Weight (grams)",value:w.weight,onChange:e=>N(u(d({},w),{weight:parseInt(e.target.value)})),className:"px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"}),ke.jsxs("select",{value:w.courier,onChange:e=>N(u(d({},w),{courier:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500",children:[ke.jsx("option",{value:"all",children:"All Couriers"}),ke.jsx("option",{value:"jne",children:"JNE"}),ke.jsx("option",{value:"jnt",children:"J&T"}),ke.jsx("option",{value:"pos",children:"POS"}),ke.jsx("option",{value:"tiki",children:"TIKI"}),ke.jsx("option",{value:"ide",children:"IDExpress"}),ke.jsx("option",{value:"lion",children:"Lion Parcel"})]})]}),ke.jsx("button",{onClick:()=>g(e,null,function*(){if(w.origin&&w.destination){a(!0);try{const e=yield j(),t=yield fetch("/api/admin/cache-settings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(d({action:"refresh_cache"},w))}),s=yield t.json();s.success?(l({type:"success",text:"Cache refresh initiated successfully"}),N({origin:"",destination:"",weight:1e3,courier:"all"}),"shipping-list"!==r&&"address-list"!==r||k()):l({type:"error",text:s.message})}catch(e){l({type:"error",text:"Failed to refresh cache"})}finally{a(!1)}}else l({type:"error",text:"Origin and destination are required"})}),disabled:i,className:"px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:i?"Refreshing...":" Refresh Cache Ongkir"})]}),ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[ke.jsx("h2",{className:"text-lg font-semibold mb-6",children:" Cache Cleanup Ongkir"}),ke.jsxs("div",{className:"space-y-4",children:[ke.jsxs("div",{className:"flex items-center justify-between p-4 bg-yellow-50 border border-yellow-200 rounded",children:[ke.jsxs("div",{children:[ke.jsx("h3",{className:"font-medium text-yellow-800",children:"Hapus Cache Ongkir Kadaluarsa"}),ke.jsx("p",{className:"text-sm text-yellow-600",children:"Hapus cache ongkir yang sudah kadaluarsa"})]}),ke.jsx("button",{onClick:()=>g(e,null,function*(){if(confirm("Apakah Anda yakin ingin menghapus semua cache yang kadaluarsa?")){a(!0);try{const e=yield j(),t=yield fetch("/api/admin/cache-settings-temp?action=clear_expired",{method:"DELETE",headers:{Authorization:`Bearer ${e}`}}),s=yield t.json();s.success?(l({type:"success",text:`Cleared ${s.data.deleted} expired cache entries`}),k()):l({type:"error",text:s.message})}catch(e){l({type:"error",text:"Failed to clear expired cache"})}finally{a(!1)}}}),disabled:i,className:"px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 disabled:opacity-50",children:"Hapus Kadaluarsa"})]}),ke.jsxs("div",{className:"flex items-center justify-between p-4 bg-red-50 border border-red-200 rounded",children:[ke.jsxs("div",{children:[ke.jsx("h3",{className:"font-medium text-red-800",children:" Hapus Semua Cache Ongkir"}),ke.jsx("p",{className:"text-sm text-red-600",children:"BAHAYA: Hapus SEMUA cache ongkir. Ini akan memaksa panggilan API baru!"})]}),ke.jsx("button",{onClick:()=>g(e,null,function*(){if(confirm(" BAHAYA: Ini akan menghapus SEMUA cache dan memaksa panggilan API baru. Lanjutkan?")){a(!0);try{const e=yield j(),t=yield fetch("/api/admin/cache-settings-temp?action=clear_all",{method:"DELETE",headers:{Authorization:`Bearer ${e}`}}),s=yield t.json();s.success?(l({type:"success",text:`Cleared all ${s.data.deleted} cache entries`}),k()):l({type:"error",text:s.message})}catch(e){l({type:"error",text:"Failed to clear all cache"})}finally{a(!1)}}}),disabled:i,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 disabled:opacity-50",children:"Hapus Semua"})]})]})]})]})]})})},Rv=({currentPage:e,onPageChange:t})=>{const s=[{id:"home",label:"Beranda",icon:pe},{id:"flash-sale",label:"Flash Sale",icon:te},{id:"orders",label:"Pesanan",icon:$},{id:"account",label:"Pengaturan",icon:S}];return ke.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg",children:ke.jsx("div",{className:"flex",children:s.map(s=>{const r=s.icon,n=e===s.id;return ke.jsxs("button",{onClick:()=>t(s.id),className:"flex-1 flex flex-col items-center py-3 px-2 transition-colors "+(n?"text-pink-600 bg-pink-50":"text-gray-600 hover:text-pink-600 hover:bg-gray-50"),children:[ke.jsx(r,{className:"w-6 h-6 mb-1 "+(n?"text-pink-600":"text-gray-600")}),ke.jsx("span",{className:"text-xs font-medium "+(n?"text-pink-600":"text-gray-600"),children:s.label})]},s.id)})})})},Ov=({className:e=""})=>ke.jsxs("div",{className:`bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg p-8 text-center ${e}`,children:[ke.jsx($,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),ke.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"Kalkulator Ongkir"}),ke.jsx("p",{className:"text-gray-500 text-sm",children:"Fitur kalkulator ongkir sedang dalam perbaikan. Silakan gunakan fitur checkout untuk menghitung ongkir otomatis."})]}),Lv=({onBack:e})=>{const[t,s]=f.useState(null);return ke.jsxs("div",{className:"min-h-screen bg-gray-50",children:[ke.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:ke.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4",children:ke.jsxs("div",{className:"flex items-center",children:[ke.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors duration-200 mr-3",children:ke.jsx(P,{className:"w-5 h-5"})}),ke.jsxs("div",{className:"flex items-center",children:[ke.jsx(Ne,{className:"w-6 h-6 text-blue-500 mr-3"}),ke.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Cek Ongkos Kirim"})]})]})})}),ke.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-6",children:[ke.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[ke.jsx("div",{className:"lg:col-span-2",children:ke.jsx(Ov,{originCityId:"152",weight:1e3,onCostSelected:(e,t,r,n)=>{s({courier:e,service:t,cost:r,etd:n})}})}),ke.jsx("div",{className:"lg:col-span-1",children:ke.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 sticky top-6",children:[ke.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[ke.jsx($,{className:"w-5 h-5 mr-2"}),"Info Pengiriman"]}),t?ke.jsxs("div",{className:"space-y-4",children:[ke.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[ke.jsx("p",{className:"text-sm font-medium text-green-800 mb-2",children:" Pengiriman Terpilih"}),ke.jsxs("div",{className:"space-y-2",children:[ke.jsxs("div",{children:[ke.jsx("p",{className:"text-sm text-gray-600",children:"Kurir"}),ke.jsx("p",{className:"font-medium text-gray-800",children:(r=t.courier,{jne:"JNE",tiki:"TIKI",pos:"POS Indonesia",jnt:"J&T Express",sicepat:"SiCepat",wahana:"Wahana",anteraja:"AnterAja"}[r]||r.toUpperCase())})]}),ke.jsxs("div",{children:[ke.jsx("p",{className:"text-sm text-gray-600",children:"Layanan"}),ke.jsx("p",{className:"font-medium text-gray-800",children:t.service})]}),ke.jsxs("div",{children:[ke.jsx("p",{className:"text-sm text-gray-600",children:"Estimasi"}),ke.jsx("p",{className:"font-medium text-gray-800",children:t.etd})]}),ke.jsxs("div",{children:[ke.jsx("p",{className:"text-sm text-gray-600",children:"Biaya"}),ke.jsxs("p",{className:"font-bold text-lg text-green-600",children:["Rp ",t.cost.toLocaleString("id-ID")]})]})]})]}),ke.jsx("button",{className:"w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-4 rounded-lg transition-colors duration-200",children:"Lanjut ke Pembayaran"})]}):ke.jsxs("div",{className:"text-center py-8",children:[ke.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:ke.jsx($,{className:"w-8 h-8 text-gray-400"})}),ke.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"Belum ada metode pengiriman yang dipilih"}),ke.jsx("p",{className:"text-gray-400 text-xs",children:"Pilih kurir dan layanan di form sebelah kiri"})]}),ke.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[ke.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"Informasi Tambahan"}),ke.jsxs("div",{className:"space-y-2 text-xs text-gray-500",children:[ke.jsxs("div",{className:"flex items-start",children:[ke.jsx("span",{className:"mr-2",children:""}),ke.jsx("span",{children:"Estimasi waktu pengiriman dapat berubah tergantung kondisi"})]}),ke.jsxs("div",{className:"flex items-start",children:[ke.jsx("span",{className:"mr-2",children:""}),ke.jsx("span",{children:"Biaya yang tertera adalah estimasi dan belum termasuk asuransi"})]}),ke.jsxs("div",{className:"flex items-start",children:[ke.jsx("span",{className:"mr-2",children:""}),ke.jsx("span",{children:"Proses pengiriman akan dilakukan pada hari kerja"})]})]})]})]})})]}),ke.jsxs("div",{className:"mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6",children:[ke.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-4",children:"Cara Penggunaan"}),ke.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[ke.jsxs("div",{className:"text-center",children:[ke.jsx("div",{className:"w-12 h-12 bg-blue-500 text-white rounded-full flex items-center justify-center mx-auto mb-2 font-bold",children:"1"}),ke.jsx("p",{className:"text-sm text-blue-700",children:"Pilih provinsi tujuan"})]}),ke.jsxs("div",{className:"text-center",children:[ke.jsx("div",{className:"w-12 h-12 bg-blue-500 text-white rounded-full flex items-center justify-center mx-auto mb-2 font-bold",children:"2"}),ke.jsx("p",{className:"text-sm text-blue-700",children:"Pilih kota/kabupaten"})]}),ke.jsxs("div",{className:"text-center",children:[ke.jsx("div",{className:"w-12 h-12 bg-blue-500 text-white rounded-full flex items-center justify-center mx-auto mb-2 font-bold",children:"3"}),ke.jsx("p",{className:"text-sm text-blue-700",children:"Pilih kurir"})]}),ke.jsxs("div",{className:"text-center",children:[ke.jsx("div",{className:"w-12 h-12 bg-blue-500 text-white rounded-full flex items-center justify-center mx-auto mb-2 font-bold",children:"4"}),ke.jsx("p",{className:"text-sm text-blue-700",children:'Klik "Cek Ongkir"'})]})]})]})]})]});var r},Mv=25;function Fv(){const[t,s]=f.useState("home"),[r,n]=f.useState(null),[i,a]=f.useState(!1),[o,l]=f.useState(!1),{user:c,logout:h}=av(),{products:m,loading:p,refresh:x}=((t=Mv)=>{const[s,r]=f.useState([]),[n,i]=f.useState(!0),[a,o]=f.useState(null),l=()=>g(e,null,function*(){try{i(!0),o(null),console.log(" Loading products via Firestore persistence...");const e=mg(Ym(Fb,"productBatches","batch_1"),e=>{if(e.exists()){const s=e.data().products||[];console.log(` Products loaded via persistence: ${s.length} products (0 Firestore reads)`),r(s.slice(0,t)),i(!1)}else console.log(" No batch data found, using empty array"),r([]),i(!1)},e=>{console.error(" Error listening to products:",e),o("Failed to load products"),i(!1)});return()=>{console.log(" Unsubscribing from products listener"),e()}}catch(e){return console.error(" Error setting up products listener:",e),o("Failed to initialize products"),i(!1),()=>{}}});return f.useEffect(()=>(g(e,null,function*(){return yield l()}),()=>{}),[t]),{products:s,loading:n,error:a,refresh:()=>g(e,null,function*(){console.log(" Manual refresh requested - triggering persistence sync..."),i(!0);const e=yield l();setTimeout(()=>{null==e||e()},1e3)})}})(),{featuredProducts:y}=(()=>{const[t,s]=f.useState([]),[r,n]=f.useState(!0),[i,a]=f.useState(null),o=()=>g(e,null,function*(){try{n(!0),a(null),console.log(" Loading featured products via Firestore persistence...");const e=mg(Ym(Fb,"productBatches","batch_1"),e=>{if(e.exists()){const t=(e.data().products||[]).filter(e=>!0===e.isFeatured||!0===e.featured);console.log(` Featured products loaded via persistence: ${t.length} products (0 Firestore reads)`),s(t),n(!1)}else console.log(" No batch data found for featured products"),s([]),n(!1)},e=>{console.error(" Error listening to featured products:",e),a("Failed to load featured products"),n(!1)});return()=>{console.log(" Unsubscribing from featured products listener"),e()}}catch(e){return console.error(" Error setting up featured products listener:",e),a("Failed to initialize featured products"),n(!1),()=>{}}});return f.useEffect(()=>(g(e,null,function*(){return yield o()}),()=>{}),[]),{featuredProducts:t,loading:r,error:i,refresh:()=>g(e,null,function*(){console.log(" Manual refresh requested for featured products..."),n(!0);const e=yield o();setTimeout(()=>{null==e||e()},1e3)})}})();mv();const{addOrder:b}=(()=>{const e=f.useContext(zb);if(!e)throw new Error("useAdmin must be used within AdminProvider");return e})();f.useEffect(()=>{"/ongkir-test"===window.location.pathname&&s("ongkir-test")},[]);const v=e=>{var t,r,i;console.log(" App.tsx handleProductClick:",{id:e.id,name:e.name,hasVariants:!!e.variants,variantsStock:null==(t=e.variants)?void 0:t.stock,hasStock:!!((null==(r=e.variants)?void 0:r.stock)&&Object.keys(null==(i=e.variants)?void 0:i.stock).length>0),variantsData:e.variants}),n(e),s("product-detail")},w=()=>{a(!0)},N=e=>{a(!1)},j=()=>{h(),s("home"),Qb.clearCart().catch(e=>{console.error(" Error clearing cart on logout:",e)})},k=(e,t,s)=>g(this,null,function*(){var r;if(null==c?void 0:c.uid)try{let n;n=e.isFlashSale&&e.flashSalePrice?e.flashSalePrice:"reseller"===(null==c?void 0:c.role)?e.resellerPrice:e.retailPrice,yield Qb.addToCart({productId:e.id,name:e.name,price:n,image:(null==(r=e.images)?void 0:r[0])||"",variant:t,quantity:s}),alert("Produk berhasil ditambahkan ke keranjang!")}catch(n){console.error(" Failed to add to cart:",n),alert("Gagal menambahkan produk ke keranjang")}else w()}),I=e=>g(this,null,function*(){if(!(null==c?void 0:c.uid))return void w();const t={size:e.variants.sizes[0],color:e.variants.colors[0]};yield k(e,t,1)}),S=(e,t,r)=>g(this,null,function*(){(null==c?void 0:c.uid)?(yield k(e,t,r),setTimeout(()=>{s("checkout")},500)):w()}),_=e=>g(this,null,function*(){if(!(null==c?void 0:c.uid))return console.error(" Cannot complete order: User not logged in"),null;const t="AZF"+Date.now().toString().slice(-8);try{const s=yield Qb.getCart();if(0===s.length)return alert("Keranjang belanja kosong!"),null;console.log(" Starting ATOMIC transaction for checkout...",s.length,"items");const{runTransaction:r,getDoc:n,doc:i}=yield function(e,t){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),r=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));s=Promise.allSettled(t.map(e=>{if((e=function(e){return"/"+e}(e))in Se)return;Se[e]=!0;const t=e.endsWith(".css"),s=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${s}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script"),n.crossOrigin="",n.href=e,r&&n.setAttribute("nonce",r),document.head.appendChild(n),t?new Promise((t,s)=>{n.addEventListener("load",t),n.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function r(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return s.then(t=>{for(const e of t||[])"rejected"===e.status&&r(e.reason);return e().catch(r)})}(()=>g(this,null,function*(){const{runTransaction:e,getDoc:t,doc:s}=yield Promise.resolve().then(()=>vg);return{runTransaction:e,getDoc:t,doc:s}}),void 0),a=yield r(Fb,e=>g(this,null,function*(){console.log(" ATOMIC TRANSACTION: Reading and validating stock...");const t=[];let r=0;for(const n of s){const s=yield e.get(i(Fb,"products",n.productId));if(!s.exists())throw new Error(`Produk "${n.name}" tidak ditemukan`);const a=s.data(),o=Number(a.stock||0);if(o<n.quantity)throw new Error(`Stok "${n.name}" tidak mencukupi. Tersedia: ${o}, Diminta: ${n.quantity}`);const l=Number(a.retailPrice||a.price||0),h=Number(a.resellerPrice)||.8*l,m="reseller"===(null==c?void 0:c.role)?h:l,p=m*n.quantity;r+=p,t.push(u(d({},n),{price:m,total:p,currentStock:o,newStock:o-n.quantity,validated:!0})),console.log(` Validated: ${n.name} - Stock: ${o}  ${o-n.quantity}, Price: Rp${m.toLocaleString("id-ID")}`)}for(const s of t){const t=i(Fb,"products",s.productId);e.update(t,{stock:s.newStock,lastModified:Date.now()})}return console.log(" ATOMIC TRANSACTION: All stocks updated successfully!"),{validatedItems:t,cartTotal:r}})),{validatedItems:o,cartTotal:l}=a;console.log(" ATOMIC TRANSACTION SUCCESS:",{itemsProcessed:o.length,totalAmount:l});const h=l,m=e.shippingCost||0,p=h+m;b({id:t,userId:c.uid,userName:c.displayName||"User",userEmail:c.email||"user@example.com",items:o.map(e=>({productId:e.productId,productName:e.name||"Product",productImage:e.image||"",selectedVariant:e.variant||{size:"",color:""},quantity:e.quantity,price:e.price||0,total:e.total||0})),shippingInfo:e.shippingInfo,paymentMethod:e.paymentMethod,status:"pending",totalAmount:h,shippingCost:m,finalTotal:p,notes:e.notes}),yield Qb.clearCart();const f={items:o.map(e=>({productId:e.productId,productName:e.name||"Product",productImage:e.image||"",selectedVariant:e.variant||{size:"",color:""},quantity:e.quantity,price:e.price||0,total:e.total||0})),shippingInfo:e.shippingInfo,paymentMethod:e.paymentMethod,status:"pending",totalAmount:h,shippingCost:m,finalTotal:p,notes:e.notes||"",userName:c.displayName||"User",userEmail:c.email||"user@example.com",userId:c.uid,timestamp:Date.now()};return yield Bb.createOrder(f),console.log(" Order completed successfully with ATOMIC transaction"),t}catch(s){return console.error(" ATOMIC TRANSACTION FAILED:",s),s.message.includes("tidak mencukupi")?alert(` CHECKOUT GAGAL:\n\n${s.message}\n\nMohon periksa kembali keranjang Anda atau kurangi jumlah pesanan.`):s.message.includes("tidak ditemukan")?alert(` CHECKOUT GAGAL:\n\n${s.message}\n\nMohon refresh halaman dan coba lagi.`):alert(` CHECKOUT GAGAL:\n\nTerjadi kesalahan saat memproses pesanan. Silakan coba lagi.\n\nError: ${s.message}`),null}}),E=()=>{s("cart")},T=()=>{s("checkout")},C=()=>{s("flash-sale")},A=()=>{s("admin-products")},P=()=>{s("admin-orders")},D=()=>{s("admin-reports")},R=()=>{s("admin-users")},O=()=>{s("admin-cache")};return ke.jsx(qb,{children:ke.jsxs("div",{className:"min-h-screen bg-gray-50",children:[(()=>{if(i)return ke.jsx(ov,{onSuccess:N,onClose:()=>a(!1)});switch(t){case"home":return ke.jsx(Yb,{user:c,products:m,loading:p,onProductClick:v,onLoginRequired:w,onCartClick:E,onAddToCart:I,onNavigateToFlashSale:C,onRefreshProducts:x,featuredProducts:y});case"flash-sale":return ke.jsx(cv,{user:c,onProductClick:v,onCartClick:E,onAddToCart:I});case"orders":return ke.jsx(dv,{user:c});case"account":return ke.jsx(uv,{user:c,onLogout:j,onNavigateToAdminProducts:A,onNavigateToAdminOrders:P,onNavigateToAdminReports:D,onNavigateToAdminUsers:R,onNavigateToAdminCache:O,onNavigateToAddressManagement:()=>s("address-management")});case"address-management":return ke.jsx(hv,{user:c,onBack:()=>s("account")});case"admin-products":return ke.jsx(Tv,{onBack:()=>s("account"),user:c});case"admin-orders":return ke.jsx(Cv,{onBack:()=>s("account"),user:c,onRefreshProducts:refreshProducts,onNavigateToHome:()=>s("home")});case"admin-reports":return ke.jsx(Av,{onBack:()=>s("account"),user:c});case"admin-users":return ke.jsx(Pv,{onBack:()=>s("account"),user:c});case"admin-cache":return ke.jsx(Dv,{onBack:()=>s("account"),user:c});case"ongkir-test":return ke.jsx(Lv,{onBack:()=>s("home")});case"product-detail":return ke.jsx(Xb,{product:r,user:c,onBack:()=>s("home"),onLoginRequired:w,onAddToCart:k,onBuyNow:S,onNavigateToCart:()=>s("cart")});case"cart":return ke.jsx(ev,{user:c,onBack:()=>s("home"),onCheckout:T});case"checkout":return ke.jsx(iv,{user:c,clearCart:_,onBack:()=>s("cart")});default:return ke.jsx(Yb,{user:c,products:m,loading:p,onProductClick:v,onLoginRequired:w,onCartClick:E,onAddToCart:I,onNavigateToFlashSale:C,onLoadMore:loadMore,hasMore:hasMore,onRefreshProducts:x,searchProducts:searchProducts})}})(),!i&&!t.startsWith("admin-")&&ke.jsx(Rv,{currentPage:t,onPageChange:s}),i&&ke.jsx(ov,{onSuccess:N,onClose:()=>a(!1),onShowRegister:()=>{a(!1),l(!0)}}),o&&ke.jsx(lv,{onSuccess:e=>{l(!1)},onClose:()=>l(!1)})]})})}function Uv(){return ke.jsx($b,{children:ke.jsx(Fv,{})})}je(document.getElementById("root")).render(ke.jsx(f.StrictMode,{children:ke.jsx(Uv,{})}))}},function(){return ke||(0,je[r(je)[0]])((ke={exports:{}}).exports,ke),ke.exports});export default Ie();
