var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertyNames,n=Object.getOwnPropertySymbols,i=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=Reflect.get,c=(t,s,r)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r,d=(e,t)=>{for(var s in t||(t={}))a.call(t,s)&&c(e,s,t[s]);if(n)for(var s of n(t))o.call(t,s)&&c(e,s,t[s]);return e},u=(e,r)=>t(e,s(r)),h=(e,t)=>{var s={};for(var r in e)a.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&n)for(var r of n(e))t.indexOf(r)<0&&o.call(e,r)&&(s[r]=e[r]);return s},m=(e,t,s)=>c(e,"symbol"!=typeof t?t+"":t,s),p=(e,t,s)=>l(i(e),s,t),g=(e,t,s)=>new Promise((r,n)=>{var i=e=>{try{o(s.next(e))}catch(t){n(t)}},a=e=>{try{o(s.throw(e))}catch(t){n(t)}},o=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,a);o((s=s.apply(e,t)).next())});import{r as f,a as x,R as y}from"./vendor-BXk_ma1u.js";import{S as b,a as v,C as N,M as w,T as j,b as k,c as S,U as _,d as I,e as C,F as E,A as T,f as A,g as P,H as D,h as R,P as O,i as L,j as F,k as M,l as U,L as V,m as B,n as z,o as $,p as q,X as K,q as H,r as G,E as W,s as J,t as Q,u as Y,v as X,w as Z,Z as ee,x as te,y as se,z as re,B as ne,D as ie,G as ae,I as oe,J as le,K as ce,N as de,O as ue,R as he,Q as me,V as pe,W as ge,Y as fe,_ as xe,$ as ye,a0 as be,a1 as ve}from"./ui-Ic8YKLse.js";var Ne,we,je=(Ne={"assets/index-C3jikruy.js"(e){!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var t={exports:{}},s={},r=f,n=Symbol.for("react.element"),i=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,s){var r,i={},c=null,d=null;for(r in void 0!==s&&(c=""+s),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)a.call(t,r)&&!l.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:n,type:e,key:c,ref:d,props:i,_owner:o.current}}s.Fragment=i,s.jsx=c,s.jsxs=c,t.exports=s;var Ne,we=t.exports,je=x;Ne=je.createRoot,je.hydrateRoot;class ke{static initializeApp(){console.log("ðŸš€ Initializing Azzahra Fashion Muslim App..."),localStorage.getItem(this.KEYS.USERS)||this.initializeUsers(),localStorage.getItem(this.KEYS.ORDERS)||this.initializeOrders(),localStorage.getItem(this.KEYS.CART)||localStorage.setItem(this.KEYS.CART,JSON.stringify([])),console.log("âœ… App initialized successfully!")}static initializeProducts(){const e=[{id:"1",name:"Hijab Segi Empat Premium",description:"Hijab segi empat berbahan premium dengan kualitas terbaik. Nyaman dipakai sehari-hari.",category:"hijab",images:["https://images.pexels.com/photos/3184291/pexels-photo-3184291.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["Regular"],colors:["Navy","Maroon","Black","Cream","Pink","Mint","Gray"]},retailPrice:85e3,resellerPrice:7e4,costPrice:55e3,stock:50,status:"ready",salesCount:15,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"2",name:"Gamis Syari Elegant",description:"Gamis syari dengan desain elegant dan bahan adem. Cocok untuk acara formal maupun casual.",category:"gamis",images:["https://images.pexels.com/photos/3184338/pexels-photo-3184338.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["S","M","L","XL","XXL"],colors:["Black","Navy","Maroon","Army","Dusty"]},retailPrice:285e3,resellerPrice:25e4,costPrice:2e5,stock:25,status:"ready",salesCount:8,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"3",name:"Khimar Instant Modern",description:"Khimar instant dengan pad antem dan material berkualitas. Praktis dan syari.",category:"khimar",images:["https://images.pexels.com/photos/3184461/pexels-photo-3184461.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["Regular","Jumbo"],colors:["Black","White","Cream","Silver","Pink"]},retailPrice:95e3,resellerPrice:8e4,costPrice:65e3,stock:40,status:"ready",salesCount:12,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"4",name:"Tunik Kasual Modern",description:"Tunik dengan desain modern yang cocok untuk OOTD harian. Nyaman dan stylish.",category:"tunik",images:["https://images.pexels.com/photos/3184315/pexels-photo-3184315.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["S","M","L","XL"],colors:["Blue","Pink","White","Black","Mustard"]},retailPrice:165e3,resellerPrice:14e4,costPrice:11e4,stock:30,status:"ready",salesCount:6,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"5",name:"Setelan Celana Kulot",description:"Setelan atasan dengan celana kulot yang nyaman. Modern dan syari.",category:"setelan",images:["https://images.pexels.com/photos/3184339/pexels-photo-3184339.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["S","M","L","XL"],colors:["Army","Navy","Maroon","Gray","Beige"]},retailPrice:225e3,resellerPrice:19e4,costPrice:15e4,stock:20,status:"ready",salesCount:4,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"6",name:"Rok Plisket Premium",description:"Rok plisket dengan bahan premium yang jatuh dan nyaman. Elegan dan modis.",category:"rok",images:["https://images.pexels.com/photos/3184340/pexels-photo-3184340.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["S","M","L","XL"],colors:["Black","Navy","Maroon","Gray","Cream"]},retailPrice:145e3,resellerPrice:12e4,costPrice:95e3,stock:35,status:"ready",salesCount:9,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"7",name:"Blouse Kekinian",description:"Blouse dengan desain kekinian yang nyaman dipakai sehari-hari.",category:"atasan",images:["https://images.pexels.com/photos/3184359/pexels-photo-3184359.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["S","M","L","XL"],colors:["Pink","Blue","White","Yellow","Green"]},retailPrice:125e3,resellerPrice:105e3,costPrice:85e3,stock:28,status:"ready",salesCount:7,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"8",name:"Abaya Simple Elegant",description:"Abaya dengan desain simple namun elegant. Cocok untuk acara formal.",category:"abaya",images:["https://images.pexels.com/photos/3184365/pexels-photo-3184365.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["S","M","L","XL"],colors:["Black","Navy","Gray","Maroon"]},retailPrice:325e3,resellerPrice:28e4,costPrice:22e4,stock:15,status:"ready",salesCount:3,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0}];this.saveData(this.KEYS.PRODUCTS,e),console.log("ðŸ“¦ Products initialized:",e.length)}static initializeUsers(){const e=[{id:"1",name:"Customer",email:"customer@azzahra.com",phone:"08123456789",role:"customer",createdAt:new Date},{id:"2",name:"Admin",email:"admin@azzahra.com",phone:"08123456780",role:"admin",createdAt:new Date},{id:"3",name:"Owner",email:"owner@azzahra.com",phone:"08123456781",role:"owner",createdAt:new Date}];this.saveData(this.KEYS.USERS,e),console.log("ðŸ‘¥ Users initialized:",e.length)}static initializeOrders(){this.saveData(this.KEYS.ORDERS,[]),console.log("ðŸ“‹ Orders initialized: 0")}static saveData(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(s){console.error(`âŒ Error saving data to ${e}:`,s)}}static loadData(e){try{const t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(t){return console.error(`âŒ Error loading data from ${e}:`,t),null}}static getProducts(){return(this.loadData(this.KEYS.PRODUCTS)||[]).map(e=>u(d({},e),{createdAt:new Date(e.createdAt)}))}static saveProducts(e){this.saveData(this.KEYS.PRODUCTS,e)}static getFeaturedProducts(){try{const e=this.getProducts().filter(e=>!0===e.isFeatured).sort((e,t)=>(e.featuredOrder||0)-(t.featuredOrder||0));return console.log(`ðŸŒŸ AppStorage: Found ${e.length} featured products`),e.forEach((e,t)=>{console.log(`  ${t+1}. ${e.name} (Order: ${e.featuredOrder})`)}),e}catch(e){return console.error("ðŸš¨ AppStorage: Error getting featured products:",e),[]}}static reorderFeatured(e,t){const s=this.getProducts(),r=s.filter(e=>e.isFeatured).sort((e,t)=>(e.featuredOrder||0)-(t.featuredOrder||0)),n=r.findIndex(t=>t.id===e);if(-1===n)return s;const i="up"===t?n-1:n+1;if(i<0||i>=r.length)return s;const[a]=r.splice(n,1);r.splice(i,0,a);const o=s.map(e=>{const t=r.findIndex(t=>t.id===e.id);return-1!==t?u(d({},e),{featuredOrder:t+1}):e});return this.saveProducts(o),o}static toggleFeatured(e){const t=this.getProducts(),s=t.find(t=>t.id===e);if(!s)return t;let r;if(s.isFeatured)r=t.map(t=>t.id===e?u(d({},t),{isFeatured:!1,featuredOrder:0}):t.isFeatured&&t.featuredOrder>s.featuredOrder?u(d({},t),{featuredOrder:t.featuredOrder-1}):t);else{const s=t.filter(e=>e.isFeatured);if(s.length>=4)return alert("Maksimal 4 produk unggulan!"),t;r=t.map(t=>t.id===e?u(d({},t),{isFeatured:!0,featuredOrder:s.length+1}):t)}return this.saveProducts(r),"undefined"!=typeof window&&window.dispatchEvent(new CustomEvent("featuredProductsUpdated",{detail:{action:s.isFeatured?"removed":"added",productId:e,featuredProducts:r.filter(e=>e.isFeatured)}})),r}static validateAndSyncFeaturedProducts(){try{const e=this.getProducts(),t=e.filter(e=>e.isFeatured).sort((e,t)=>(e.featuredOrder||0)-(t.featuredOrder||0)),s=e.map(e=>{const s=t.findIndex(t=>t.id===e.id);return-1!==s?u(d({},e),{featuredOrder:s+1}):e});return JSON.stringify(e)!==JSON.stringify(s)&&(this.saveProducts(s),console.log("ðŸ”§ AppStorage: Fixed featured products order consistency")),s}catch(e){return console.error("ðŸš¨ AppStorage: Error validating featured products:",e),this.getProducts()}}static refreshFeaturedProductsCache(){this.getFeaturedProducts(),"undefined"!=typeof window&&window.dispatchEvent(new CustomEvent("featuredProductsRefreshed",{detail:{timestamp:(new Date).toISOString()}}))}static getOrders(){return(this.loadData(this.KEYS.ORDERS)||[]).map(e=>u(d({},e),{createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}))}static saveOrder(e){const t=this.getOrders();t.push(e),this.saveData(this.KEYS.ORDERS,t),console.log("ðŸ’¾ Order saved:",e.id)}static updateOrderStatus(e,t){const s=this.getOrders().map(s=>s.id===e?u(d({},s),{status:t,updatedAt:new Date}):s);this.saveData(this.KEYS.ORDERS,s),console.log("ðŸ“‹ Order status updated:",e,"â†’",t)}static getUsers(){return(this.loadData(this.KEYS.USERS)||[]).map(e=>u(d({},e),{createdAt:new Date(e.createdAt)}))}static saveUser(e){const t=this.getUsers(),s=t.findIndex(t=>t.id===e.id);s>=0?t[s]=e:t.push(e),this.saveData(this.KEYS.USERS,t)}static getCart(){return this.loadData(this.KEYS.CART)||[]}static saveCart(e){this.saveData(this.KEYS.CART,e)}static exportAllData(){const e={products:this.getProducts(),orders:this.getOrders(),users:this.getUsers(),cart:this.getCart(),exportedAt:(new Date).toISOString()};return JSON.stringify(e,null,2)}static importAllData(e){try{const t=JSON.parse(e);return t.products&&this.saveData(this.KEYS.PRODUCTS,t.products),t.orders&&this.saveData(this.KEYS.ORDERS,t.orders),t.users&&this.saveData(this.KEYS.USERS,t.users),t.cart&&this.saveData(this.KEYS.CART,t.cart),console.log("ðŸ“¥ Data imported successfully"),!0}catch(t){return console.error("âŒ Error importing data:",t),!1}}static clearAllData(){Object.values(this.KEYS).forEach(e=>{localStorage.removeItem(e)}),console.log("ðŸ—‘ï¸ All data cleared"),this.initializeApp()}static getStorageInfo(){const e={};return Object.entries(this.KEYS).forEach(([t,s])=>{const r=localStorage.getItem(s);e[t]={size:r?r.length:0,items:r?JSON.parse(r).length:0}}),e}}m(ke,"KEYS",{PRODUCTS:"azzahra_products",ORDERS:"azzahra_orders",USERS:"azzahra_users",CART:"azzahra_cart",FLASH_SALES:"azzahra_flash_sales",APP_STATE:"azzahra_app_state"}),"undefined"!=typeof window&&(window.AppStorage=ke);const Se=f.createContext(void 0),_e=({children:e})=>{const[t,s]=f.useState([]),[r,n]=f.useState([]);return f.useEffect(()=>{const e=ke.getOrders();s(e),console.log("ðŸ“‹ Orders loaded from AppStorage:",e.length)},[]),f.useEffect(()=>{const e=()=>{const e=ke.getOrders();s(e),console.log("ðŸ“‹ Orders updated:",e.length)};return window.addEventListener("orderUpdated",e),()=>window.removeEventListener("orderUpdated",e)},[]),we.jsx(Se.Provider,{value:{orders:t,flashSales:r,addOrder:e=>{const t=u(d({},e),{createdAt:new Date,updatedAt:new Date});ke.saveOrder(t),s(e=>[t,...e]),console.log("ðŸ’¾ Order saved permanently:",t.id),window.dispatchEvent(new CustomEvent("orderUpdated",{detail:t}))},updateOrderStatus:(e,t)=>{ke.updateOrderStatus(e,t),s(s=>s.map(s=>s.id===e?u(d({},s),{status:t,updatedAt:new Date}):s)),console.log("ðŸ“‹ Order status updated:",e,"â†’",t),window.dispatchEvent(new CustomEvent("orderUpdated",{detail:{orderId:e,status:t}}))},updateOrderPayment:(e,r,n="pending")=>{const i=t.map(t=>t.id===e?u(d({},t),{paymentProof:r,paymentProofUrl:"https://images.pexels.com/photos/4386321/pexels-photo-4386321.jpeg?auto=compress&cs=tinysrgb&w=400",status:n,updatedAt:new Date}):t);localStorage.setItem("azzahra_orders",JSON.stringify(i)),s(i),console.log("ðŸ’³ Order payment updated:",e),window.dispatchEvent(new CustomEvent("orderUpdated",{detail:{orderId:e,paymentProof:r,status:n}}))},deleteOrder:e=>{const r=t.filter(t=>t.id!==e);localStorage.setItem("azzahra_orders",JSON.stringify(r)),s(r),console.log("ðŸ—‘ï¸ Order deleted permanently:",e),window.dispatchEvent(new CustomEvent("orderUpdated",{detail:{orderId:e,deleted:!0}}))},getOrdersByStatus:e=>t.filter(t=>t.status===e),getTotalRevenue:()=>t.filter(e=>"delivered"===e.status).reduce((e,t)=>e+t.finalTotal,0),getTodayOrders:()=>{const e=new Date;return e.setHours(0,0,0,0),t.filter(t=>t.createdAt>=e)},createFlashSale:e=>{const t=u(d({},e),{id:"FS"+Date.now().toString(),createdAt:new Date});console.log("Creating flash sale:",t),console.log("Flash sale products:",e.productIds),console.log("Discount:",e.discountType,e.discountValue),n(e=>{const s=[t,...e];return console.log("Updated flash sales:",s),s}),setTimeout(()=>{console.log("Dispatching flashSaleCreated event");const e=new CustomEvent("flashSaleCreated",{detail:t,bubbles:!0});window.dispatchEvent(e),console.log("Event dispatched")},100)},updateFlashSale:(e,t)=>{n(s=>s.map(s=>s.id===e?d(d({},s),t):s)),console.log("Updating flash sale:",e,t);const s=r.find(t=>t.id===e);s&&window.dispatchEvent(new CustomEvent("flashSaleUpdated",{detail:d(d({},s),t)}))},deleteFlashSale:e=>{const t=r.find(t=>t.id===e);t&&(console.log("Deleting flash sale:",t),window.dispatchEvent(new CustomEvent("flashSaleDeleted",{detail:t}))),n(t=>t.filter(t=>t.id!==e))},getActiveFlashSales:()=>{const e=new Date;return r.filter(t=>t.isActive&&t.startDate<=e&&t.endDate>=e)}},children:e})};class Ie extends y.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e,t)}render(){return this.state.hasError?this.props.fallback||we.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:we.jsxs("div",{className:"text-center",children:[we.jsx("div",{className:"text-red-500 mb-4",children:we.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:we.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),we.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Terjadi Kesalahan"}),we.jsx("p",{className:"text-gray-600 mb-4",children:"Mohon muat ulang halaman atau coba lagi nanti."}),we.jsx("button",{onClick:()=>window.location.reload(),className:"bg-pink-500 text-white px-6 py-2 rounded-lg hover:bg-pink-600 transition-colors",children:"Muat Ulang"})]})}):this.props.children}}var Ce={};
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Ee=function(e){const t=[];let s=0;for(let r=0;r<e.length;r++){let n=e.charCodeAt(r);n<128?t[s++]=n:n<2048?(t[s++]=n>>6|192,t[s++]=63&n|128):55296==(64512&n)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(n=65536+((1023&n)<<10)+(1023&e.charCodeAt(++r)),t[s++]=n>>18|240,t[s++]=n>>12&63|128,t[s++]=n>>6&63|128,t[s++]=63&n|128):(t[s++]=n>>12|224,t[s++]=n>>6&63|128,t[s++]=63&n|128)}return t},Te={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const s=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let n=0;n<e.length;n+=3){const t=e[n],i=n+1<e.length,a=i?e[n+1]:0,o=n+2<e.length,l=o?e[n+2]:0,c=t>>2,d=(3&t)<<4|a>>4;let u=(15&a)<<2|l>>6,h=63&l;o||(h=64,i||(u=64)),r.push(s[c],s[d],s[u],s[h])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(Ee(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let s=0,r=0;for(;s<e.length;){const n=e[s++];if(n<128)t[r++]=String.fromCharCode(n);else if(n>191&&n<224){const i=e[s++];t[r++]=String.fromCharCode((31&n)<<6|63&i)}else if(n>239&&n<365){const i=((7&n)<<18|(63&e[s++])<<12|(63&e[s++])<<6|63&e[s++])-65536;t[r++]=String.fromCharCode(55296+(i>>10)),t[r++]=String.fromCharCode(56320+(1023&i))}else{const i=e[s++],a=e[s++];t[r++]=String.fromCharCode((15&n)<<12|(63&i)<<6|63&a)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const s=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let n=0;n<e.length;){const t=s[e.charAt(n++)],i=n<e.length?s[e.charAt(n)]:0;++n;const a=n<e.length?s[e.charAt(n)]:64;++n;const o=n<e.length?s[e.charAt(n)]:64;if(++n,null==t||null==i||null==a||null==o)throw new Ae;const l=t<<2|i>>4;if(r.push(l),64!==a){const e=i<<4&240|a>>2;if(r.push(e),64!==o){const e=a<<6&192|o;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class Ae extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Pe=function(e){return function(e){const t=Ee(e);return Te.encodeByteArray(t,!0)}(e).replace(/\./g,"")},De=function(e){try{return Te.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null},Re=()=>
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */().__FIREBASE_DEFAULTS__,Oe=()=>{try{return Re()||(()=>{if("undefined"==typeof process)return;const e=Ce.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(s){return}const t=e&&De(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},Le=e=>{var t,s;return null==(s=null==(t=Oe())?void 0:t.emulatorHosts)?void 0:s[e]},Fe=e=>{const t=Le(e);if(!t)return;const s=t.lastIndexOf(":");if(s<=0||s+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(s+1),10);return"["===t[0]?[t.substring(1,s-1),r]:[t.substring(0,s),r]},Me=()=>{var e;return null==(e=Oe())?void 0:e.config},Ue=e=>{var t;return null==(t=Oe())?void 0:t[`_${e}`]};
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Ve{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,s))}}}
/**
     * @license
     * Copyright 2025 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Be(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch(t){return!1}}function ze(e){return g(this,null,function*(){return(yield fetch(e,{credentials:"include"})).ok})}
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function $e(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const s=t||"demo-project",r=e.iat||0,n=e.sub||e.user_id;if(!n)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const i=d({iss:`https://securetoken.google.com/${s}`,aud:s,iat:r,exp:r+3600,auth_time:r,sub:n,user_id:n,firebase:{sign_in_provider:"custom",identities:{}}},e);return[Pe(JSON.stringify({alg:"none",type:"JWT"})),Pe(JSON.stringify(i)),""].join(".")}const qe={};let Ke=!1;function He(e,t){if("undefined"==typeof window||"undefined"==typeof document||!Be(window.location.host)||qe[e]===t||qe[e]||Ke)return;function s(e){return`__firebase__banner__${e}`}qe[e]=t;const r="__firebase__banner",n=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(qe))qe[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function i(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{Ke=!0,function(){const e=document.getElementById(r);e&&e.remove()}()},e}function a(){const e=function(e){let t=document.getElementById(e),s=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),s=!0),{created:s,element:t}}(r),t=s("text"),a=document.getElementById(t)||document.createElement("span"),o=s("learnmore"),l=document.getElementById(o)||document.createElement("a"),c=s("preprendIcon"),d=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(l,o);const s=i();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(d,c),t.append(d,a,l,s),document.body.appendChild(t)}n?(a.innerText="Preview backend disconnected.",d.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(d.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',a.innerText="Preview backend running in this workspace."),a.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",a):a()}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Ge(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function We(){return!function(){var e;const t=null==(e=Oe())?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(s){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}class Je extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name="FirebaseError",Object.setPrototypeOf(this,Je.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Qe.prototype.create)}}class Qe{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},r=`${this.service}/${e}`,n=this.errors[e],i=n?function(e,t){return e.replace(Ye,(e,s)=>{const r=t[s];return null!=r?String(r):`<${s}?>`})}(n,s):"Error",a=`${this.serviceName}: ${i} (${r}).`;return new Je(r,a,s)}}const Ye=/\{\$([^}]+)}/g;function Xe(e,t){if(e===t)return!0;const s=Object.keys(e),r=Object.keys(t);for(const n of s){if(!r.includes(n))return!1;const s=e[n],i=t[n];if(Ze(s)&&Ze(i)){if(!Xe(s,i))return!1}else if(s!==i)return!1}for(const n of r)if(!s.includes(n))return!1;return!0}function Ze(e){return null!==e&&"object"==typeof e}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function et(e){const t=[];for(const[s,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(s)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(s)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function tt(e){const t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){const[s,r]=e.split("=");t[decodeURIComponent(s)]=decodeURIComponent(r)}}),t}function st(e){const t=e.indexOf("?");if(!t)return"";const s=e.indexOf("#",t);return e.substring(t,s>0?s:void 0)}class rt{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,s){let r;if(void 0===e&&void 0===t&&void 0===s)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const s of t)if(s in e&&"function"==typeof e[s])return!0;return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:s},void 0===r.next&&(r.next=nt),void 0===r.error&&(r.error=nt),void 0===r.complete&&(r.complete=nt);const n=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),n}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(s){"undefined"!=typeof console&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function nt(){}
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function it(e){return e&&e._delegate?e._delegate:e}class at{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const ot="[DEFAULT]";
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class lt{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new Ve;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&e.resolve(s)}catch(s){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const s=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!=(t=null==e?void 0:e.optional)&&t;if(!this.isInitialized(s)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:s})}catch(n){if(r)return null;throw n}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(e))try{this.getOrInitializeService({instanceIdentifier:ot})}catch(t){}for(const[e,s]of this.instancesDeferred.entries()){const r=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:r});s.resolve(e)}catch(t){}}}}clearInstance(e=ot){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return g(this,null,function*(){const e=Array.from(this.instances.values());yield Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])})}isComponentSet(){return null!=this.component}isInitialized(e=ot){return this.instances.has(e)}getOptions(e=ot){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[n,i]of this.instancesDeferred.entries())s===this.normalizeInstanceIdentifier(n)&&i.resolve(r);return r}onInit(e,t){var s;const r=this.normalizeInstanceIdentifier(t),n=null!=(s=this.onInitCallbacks.get(r))?s:new Set;n.add(e),this.onInitCallbacks.set(r,n);const i=this.instances.get(r);return i&&e(i,r),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const n of s)try{n(e,t)}catch(r){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===ot?void 0:r),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch(n){}var r;return s||null}normalizeInstanceIdentifier(e=ot){return this.component?this.component.multipleInstances?e:ot:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ct{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new lt(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var dt,ut;(ut=dt||(dt={}))[ut.DEBUG=0]="DEBUG",ut[ut.VERBOSE=1]="VERBOSE",ut[ut.INFO=2]="INFO",ut[ut.WARN=3]="WARN",ut[ut.ERROR=4]="ERROR",ut[ut.SILENT=5]="SILENT";const ht={debug:dt.DEBUG,verbose:dt.VERBOSE,info:dt.INFO,warn:dt.WARN,error:dt.ERROR,silent:dt.SILENT},mt=dt.INFO,pt={[dt.DEBUG]:"log",[dt.VERBOSE]:"log",[dt.INFO]:"info",[dt.WARN]:"warn",[dt.ERROR]:"error"},gt=(e,t,...s)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),n=pt[t];if(!n)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[n](`[${r}]  ${e.name}:`,...s)};class ft{constructor(e){this.name=e,this._logLevel=mt,this._logHandler=gt,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in dt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?ht[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,dt.DEBUG,...e),this._logHandler(this,dt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,dt.VERBOSE,...e),this._logHandler(this,dt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,dt.INFO,...e),this._logHandler(this,dt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,dt.WARN,...e),this._logHandler(this,dt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,dt.ERROR,...e),this._logHandler(this,dt.ERROR,...e)}}let xt,yt;const bt=new WeakMap,vt=new WeakMap,Nt=new WeakMap,wt=new WeakMap,jt=new WeakMap;let kt={get(e,t,s){if(e instanceof IDBTransaction){if("done"===t)return vt.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Nt.get(e);if("store"===t)return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return It(e[t])},set:(e,t,s)=>(e[t]=s,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function St(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(yt||(yt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(Ct(this),t),It(bt.get(this))}:function(...t){return It(e.apply(Ct(this),t))}:function(t,...s){const r=e.call(Ct(this),t,...s);return Nt.set(r,t.sort?t.sort():[t]),It(r)}}function _t(e){return"function"==typeof e?St(e):(e instanceof IDBTransaction&&function(e){if(vt.has(e))return;const t=new Promise((t,s)=>{const r=()=>{e.removeEventListener("complete",n),e.removeEventListener("error",i),e.removeEventListener("abort",i)},n=()=>{t(),r()},i=()=>{s(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",n),e.addEventListener("error",i),e.addEventListener("abort",i)});vt.set(e,t)}(e),t=e,(xt||(xt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,kt):e);var t}function It(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,s)=>{const r=()=>{e.removeEventListener("success",n),e.removeEventListener("error",i)},n=()=>{t(It(e.result)),r()},i=()=>{s(e.error),r()};e.addEventListener("success",n),e.addEventListener("error",i)});return t.then(t=>{t instanceof IDBCursor&&bt.set(t,e)}).catch(()=>{}),jt.set(t,e),t}(e);if(wt.has(e))return wt.get(e);const t=_t(e);return t!==e&&(wt.set(e,t),jt.set(t,e)),t}const Ct=e=>jt.get(e),Et=["get","getKey","getAll","getAllKeys","count"],Tt=["put","add","delete","clear"],At=new Map;function Pt(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(At.get(t))return At.get(t);const s=t.replace(/FromIndex$/,""),r=t!==s,n=Tt.includes(s);if(!(s in(r?IDBIndex:IDBObjectStore).prototype)||!n&&!Et.includes(s))return;const i=function(e,...t){return g(this,null,function*(){const i=this.transaction(e,n?"readwrite":"readonly");let a=i.store;return r&&(a=a.index(t.shift())),(yield Promise.all([a[s](...t),n&&i.done]))[0]})};return At.set(t,i),i}var Dt;kt=u(d({},Dt=kt),{get:(e,t,s)=>Pt(e,t)||Dt.get(e,t,s),has:(e,t)=>!!Pt(e,t)||Dt.has(e,t)});
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Rt{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null}).filter(e=>e).join(" ")}}const Ot="@firebase/app",Lt="0.14.4",Ft=new ft("@firebase/app"),Mt="@firebase/app-compat",Ut="@firebase/analytics-compat",Vt="@firebase/analytics",Bt="@firebase/app-check-compat",zt="@firebase/app-check",$t="@firebase/auth",qt="@firebase/auth-compat",Kt="@firebase/database",Ht="@firebase/data-connect",Gt="@firebase/database-compat",Wt="@firebase/functions",Jt="@firebase/functions-compat",Qt="@firebase/installations",Yt="@firebase/installations-compat",Xt="@firebase/messaging",Zt="@firebase/messaging-compat",es="@firebase/performance",ts="@firebase/performance-compat",ss="@firebase/remote-config",rs="@firebase/remote-config-compat",ns="@firebase/storage",is="@firebase/storage-compat",as="@firebase/firestore",os="@firebase/ai",ls="@firebase/firestore-compat",cs="firebase",ds="[DEFAULT]",us={[Ot]:"fire-core",[Mt]:"fire-core-compat",[Vt]:"fire-analytics",[Ut]:"fire-analytics-compat",[zt]:"fire-app-check",[Bt]:"fire-app-check-compat",[$t]:"fire-auth",[qt]:"fire-auth-compat",[Kt]:"fire-rtdb",[Ht]:"fire-data-connect",[Gt]:"fire-rtdb-compat",[Wt]:"fire-fn",[Jt]:"fire-fn-compat",[Qt]:"fire-iid",[Yt]:"fire-iid-compat",[Xt]:"fire-fcm",[Zt]:"fire-fcm-compat",[es]:"fire-perf",[ts]:"fire-perf-compat",[ss]:"fire-rc",[rs]:"fire-rc-compat",[ns]:"fire-gcs",[is]:"fire-gcs-compat",[as]:"fire-fst",[ls]:"fire-fst-compat",[os]:"fire-vertex","fire-js":"fire-js",[cs]:"fire-js-all"},hs=new Map,ms=new Map,ps=new Map;function gs(e,t){try{e.container.addComponent(t)}catch(s){Ft.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,s)}}function fs(e){const t=e.name;if(ps.has(t))return Ft.debug(`There were multiple attempts to register component ${t}.`),!1;ps.set(t,e);for(const s of hs.values())gs(s,e);for(const s of ms.values())gs(s,e);return!0}function xs(e,t){const s=e.container.getProvider("heartbeat").getImmediate({optional:!0});return s&&s.triggerHeartbeat(),e.container.getProvider(t)}function ys(e){return null!=e&&void 0!==e.settings}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const bs=new Qe("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class vs{constructor(e,t,s){this._isDeleted=!1,this._options=d({},e),this._config=d({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new at("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw bs.create("app-deleted",{appName:this._name})}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Ns="12.4.0";function ws(e,t={}){let s=e;"object"!=typeof t&&(t={name:t});const r=d({name:ds,automaticDataCollectionEnabled:!0},t),n=r.name;if("string"!=typeof n||!n)throw bs.create("bad-app-name",{appName:String(n)});if(s||(s=Me()),!s)throw bs.create("no-options");const i=hs.get(n);if(i){if(Xe(s,i.options)&&Xe(r,i.config))return i;throw bs.create("duplicate-app",{appName:n})}const a=new ct(n);for(const l of ps.values())a.addComponent(l);const o=new vs(s,r,a);return hs.set(n,o),o}function js(e=ds){const t=hs.get(e);if(!t&&e===ds&&Me())return ws();if(!t)throw bs.create("no-app",{appName:e});return t}function ks(e,t,s){var r;let n=null!=(r=us[e])?r:e;s&&(n+=`-${s}`);const i=n.match(/\s|\//),a=t.match(/\s|\//);if(i||a){const e=[`Unable to register library "${n}" with version "${t}":`];return i&&e.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Ft.warn(e.join(" "))}fs(new at(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Ss="firebase-heartbeat-store";let _s=null;function Is(){return _s||(_s=function(e,t,{blocked:s,upgrade:r,blocking:n,terminated:i}={}){const a=indexedDB.open(e,t),o=It(a);return r&&a.addEventListener("upgradeneeded",e=>{r(It(a.result),e.oldVersion,e.newVersion,It(a.transaction),e)}),s&&a.addEventListener("blocked",e=>s(e.oldVersion,e.newVersion,e)),o.then(e=>{i&&e.addEventListener("close",()=>i()),n&&e.addEventListener("versionchange",e=>n(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Ss)}catch(s){console.warn(s)}}}).catch(e=>{throw bs.create("idb-open",{originalErrorMessage:e.message})})),_s}function Cs(e,t){return g(this,null,function*(){try{const s=(yield Is()).transaction(Ss,"readwrite"),r=s.objectStore(Ss);yield r.put(t,Es(e)),yield s.done}catch(s){if(s instanceof Je)Ft.warn(s.message);else{const e=bs.create("idb-set",{originalErrorMessage:null==s?void 0:s.message});Ft.warn(e.message)}}})}function Es(e){return`${e.name}!${e.options.appId}`}
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ts{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Ps(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}triggerHeartbeat(){return g(this,null,function*(){var e,t;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=As();if(null==(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,null==(null==(t=this._heartbeatsCache)?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(e=>e.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:s}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,s=e[0].date;for(let r=1;r<e.length;r++)e[r].date<s&&(s=e[r].date,t=r);return t}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(s){Ft.warn(s)}})}getHeartbeatsHeader(){return g(this,null,function*(){var e;try{if(null===this._heartbeatsCache&&(yield this._heartbeatsCachePromise),null==(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=As(),{heartbeatsToSend:s,unsentEntries:r}=function(e,t=1024){const s=[];let r=e.slice();for(const n of e){const e=s.find(e=>e.agent===n.agent);if(e){if(e.dates.push(n.date),Ds(s)>t){e.dates.pop();break}}else if(s.push({agent:n.agent,dates:[n.date]}),Ds(s)>t){s.pop();break}r=r.slice(1)}return{heartbeatsToSend:s,unsentEntries:r}}(this._heartbeatsCache.heartbeats),n=Pe(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}catch(t){return Ft.warn(t),""}})}}function As(){return(new Date).toISOString().substring(0,10)}class Ps{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return g(this,null,function*(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let s=!0;const r="validate-browser-context-for-indexeddb-analytics-module",n=self.indexedDB.open(r);n.onsuccess=()=>{n.result.close(),s||self.indexedDB.deleteDatabase(r),e(!0)},n.onupgradeneeded=()=>{s=!1},n.onerror=()=>{var e;t((null==(e=n.error)?void 0:e.message)||"")}}catch(s){t(s)}}).then(()=>!0).catch(()=>!1)})}read(){return g(this,null,function*(){if(yield this._canUseIndexedDBPromise){const e=yield function(e){return g(this,null,function*(){try{const t=(yield Is()).transaction(Ss),s=yield t.objectStore(Ss).get(Es(e));return yield t.done,s}catch(t){if(t instanceof Je)Ft.warn(t.message);else{const e=bs.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});Ft.warn(e.message)}}})}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}})}overwrite(e){return g(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){const s=yield this.read();return Cs(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}})}add(e){return g(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){const s=yield this.read();return Cs(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}})}}function Ds(e){return Pe(JSON.stringify({version:2,heartbeats:e})).length}var Rs;Rs="",fs(new at("platform-logger",e=>new Rt(e),"PRIVATE")),fs(new at("heartbeat",e=>new Ts(e),"PRIVATE")),ks(Ot,Lt,Rs),ks(Ot,Lt,"esm2020"),ks("fire-js","");var Os,Ls,Fs="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};
/** @license
    Copyright The Closure Library Authors.
    SPDX-License-Identifier: Apache-2.0
    */(function(){var e;
/** @license
      
       Copyright The Closure Library Authors.
       SPDX-License-Identifier: Apache-2.0
      */function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function s(e,t,s){s||(s=0);const r=Array(16);if("string"==typeof t)for(var n=0;n<16;++n)r[n]=t.charCodeAt(s++)|t.charCodeAt(s++)<<8|t.charCodeAt(s++)<<16|t.charCodeAt(s++)<<24;else for(n=0;n<16;++n)r[n]=t[s++]|t[s++]<<8|t[s++]<<16|t[s++]<<24;t=e.g[0],s=e.g[1],n=e.g[2];let i,a=e.g[3];i=t+(a^s&(n^a))+r[0]+3614090360&4294967295,i=a+(n^(t=s+(i<<7&4294967295|i>>>25))&(s^n))+r[1]+3905402710&4294967295,a=t+(i<<12&4294967295|i>>>20),i=n+(s^a&(t^s))+r[2]+606105819&4294967295,i=s+(t^(n=a+(i<<17&4294967295|i>>>15))&(a^t))+r[3]+3250441966&4294967295,i=t+(a^(s=n+(i<<22&4294967295|i>>>10))&(n^a))+r[4]+4118548399&4294967295,i=a+(n^(t=s+(i<<7&4294967295|i>>>25))&(s^n))+r[5]+1200080426&4294967295,a=t+(i<<12&4294967295|i>>>20),i=n+(s^a&(t^s))+r[6]+2821735955&4294967295,i=s+(t^(n=a+(i<<17&4294967295|i>>>15))&(a^t))+r[7]+4249261313&4294967295,i=t+(a^(s=n+(i<<22&4294967295|i>>>10))&(n^a))+r[8]+1770035416&4294967295,i=a+(n^(t=s+(i<<7&4294967295|i>>>25))&(s^n))+r[9]+2336552879&4294967295,a=t+(i<<12&4294967295|i>>>20),i=n+(s^a&(t^s))+r[10]+4294925233&4294967295,i=s+(t^(n=a+(i<<17&4294967295|i>>>15))&(a^t))+r[11]+2304563134&4294967295,i=t+(a^(s=n+(i<<22&4294967295|i>>>10))&(n^a))+r[12]+1804603682&4294967295,i=a+(n^(t=s+(i<<7&4294967295|i>>>25))&(s^n))+r[13]+4254626195&4294967295,a=t+(i<<12&4294967295|i>>>20),i=n+(s^a&(t^s))+r[14]+2792965006&4294967295,i=s+(t^(n=a+(i<<17&4294967295|i>>>15))&(a^t))+r[15]+1236535329&4294967295,i=t+(n^a&((s=n+(i<<22&4294967295|i>>>10))^n))+r[1]+4129170786&4294967295,i=a+(s^n&((t=s+(i<<5&4294967295|i>>>27))^s))+r[6]+3225465664&4294967295,a=t+(i<<9&4294967295|i>>>23),i=n+(t^s&(a^t))+r[11]+643717713&4294967295,i=s+(a^t&((n=a+(i<<14&4294967295|i>>>18))^a))+r[0]+3921069994&4294967295,i=t+(n^a&((s=n+(i<<20&4294967295|i>>>12))^n))+r[5]+3593408605&4294967295,i=a+(s^n&((t=s+(i<<5&4294967295|i>>>27))^s))+r[10]+38016083&4294967295,a=t+(i<<9&4294967295|i>>>23),i=n+(t^s&(a^t))+r[15]+3634488961&4294967295,i=s+(a^t&((n=a+(i<<14&4294967295|i>>>18))^a))+r[4]+3889429448&4294967295,i=t+(n^a&((s=n+(i<<20&4294967295|i>>>12))^n))+r[9]+568446438&4294967295,i=a+(s^n&((t=s+(i<<5&4294967295|i>>>27))^s))+r[14]+3275163606&4294967295,a=t+(i<<9&4294967295|i>>>23),i=n+(t^s&(a^t))+r[3]+4107603335&4294967295,i=s+(a^t&((n=a+(i<<14&4294967295|i>>>18))^a))+r[8]+1163531501&4294967295,i=t+(n^a&((s=n+(i<<20&4294967295|i>>>12))^n))+r[13]+2850285829&4294967295,i=a+(s^n&((t=s+(i<<5&4294967295|i>>>27))^s))+r[2]+4243563512&4294967295,a=t+(i<<9&4294967295|i>>>23),i=n+(t^s&(a^t))+r[7]+1735328473&4294967295,i=s+(a^t&((n=a+(i<<14&4294967295|i>>>18))^a))+r[12]+2368359562&4294967295,i=t+((s=n+(i<<20&4294967295|i>>>12))^n^a)+r[5]+4294588738&4294967295,i=a+((t=s+(i<<4&4294967295|i>>>28))^s^n)+r[8]+2272392833&4294967295,a=t+(i<<11&4294967295|i>>>21),i=n+(a^t^s)+r[11]+1839030562&4294967295,i=s+((n=a+(i<<16&4294967295|i>>>16))^a^t)+r[14]+4259657740&4294967295,i=t+((s=n+(i<<23&4294967295|i>>>9))^n^a)+r[1]+2763975236&4294967295,i=a+((t=s+(i<<4&4294967295|i>>>28))^s^n)+r[4]+1272893353&4294967295,a=t+(i<<11&4294967295|i>>>21),i=n+(a^t^s)+r[7]+4139469664&4294967295,i=s+((n=a+(i<<16&4294967295|i>>>16))^a^t)+r[10]+3200236656&4294967295,i=t+((s=n+(i<<23&4294967295|i>>>9))^n^a)+r[13]+681279174&4294967295,i=a+((t=s+(i<<4&4294967295|i>>>28))^s^n)+r[0]+3936430074&4294967295,a=t+(i<<11&4294967295|i>>>21),i=n+(a^t^s)+r[3]+3572445317&4294967295,i=s+((n=a+(i<<16&4294967295|i>>>16))^a^t)+r[6]+76029189&4294967295,i=t+((s=n+(i<<23&4294967295|i>>>9))^n^a)+r[9]+3654602809&4294967295,i=a+((t=s+(i<<4&4294967295|i>>>28))^s^n)+r[12]+3873151461&4294967295,a=t+(i<<11&4294967295|i>>>21),i=n+(a^t^s)+r[15]+530742520&4294967295,i=s+((n=a+(i<<16&4294967295|i>>>16))^a^t)+r[2]+3299628645&4294967295,i=t+(n^((s=n+(i<<23&4294967295|i>>>9))|~a))+r[0]+4096336452&4294967295,i=a+(s^((t=s+(i<<6&4294967295|i>>>26))|~n))+r[7]+1126891415&4294967295,a=t+(i<<10&4294967295|i>>>22),i=n+(t^(a|~s))+r[14]+2878612391&4294967295,i=s+(a^((n=a+(i<<15&4294967295|i>>>17))|~t))+r[5]+4237533241&4294967295,i=t+(n^((s=n+(i<<21&4294967295|i>>>11))|~a))+r[12]+1700485571&4294967295,i=a+(s^((t=s+(i<<6&4294967295|i>>>26))|~n))+r[3]+2399980690&4294967295,a=t+(i<<10&4294967295|i>>>22),i=n+(t^(a|~s))+r[10]+4293915773&4294967295,i=s+(a^((n=a+(i<<15&4294967295|i>>>17))|~t))+r[1]+2240044497&4294967295,i=t+(n^((s=n+(i<<21&4294967295|i>>>11))|~a))+r[8]+1873313359&4294967295,i=a+(s^((t=s+(i<<6&4294967295|i>>>26))|~n))+r[15]+4264355552&4294967295,a=t+(i<<10&4294967295|i>>>22),i=n+(t^(a|~s))+r[6]+2734768916&4294967295,i=s+(a^((n=a+(i<<15&4294967295|i>>>17))|~t))+r[13]+1309151649&4294967295,i=t+(n^((s=n+(i<<21&4294967295|i>>>11))|~a))+r[4]+4149444226&4294967295,i=a+(s^((t=s+(i<<6&4294967295|i>>>26))|~n))+r[11]+3174756917&4294967295,a=t+(i<<10&4294967295|i>>>22),i=n+(t^(a|~s))+r[2]+718787259&4294967295,i=s+(a^((n=a+(i<<15&4294967295|i>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(n+(i<<21&4294967295|i>>>11))&4294967295,e.g[2]=e.g[2]+n&4294967295,e.g[3]=e.g[3]+a&4294967295}function r(e,t){this.h=t;const s=[];let r=!0;for(let n=e.length-1;n>=0;n--){const i=0|e[n];r&&i==t||(s[n]=i,r=!1)}this.g=s}!function(e,t){function s(){}s.prototype=t.prototype,e.F=t.prototype,e.prototype=new s,e.prototype.constructor=e,e.D=function(e,s,r){for(var n=Array(arguments.length-2),i=2;i<arguments.length;i++)n[i-2]=arguments[i];return t.prototype[s].apply(e,n)}}(t,function(){this.blockSize=-1}),t.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.v=function(e,t){void 0===t&&(t=e.length);const r=t-this.blockSize,n=this.C;let i=this.h,a=0;for(;a<t;){if(0==i)for(;a<=r;)s(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<t;)if(n[i++]=e.charCodeAt(a++),i==this.blockSize){s(this,n),i=0;break}}else for(;a<t;)if(n[i++]=e[a++],i==this.blockSize){s(this,n),i=0;break}}this.h=i,this.o+=t},t.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var s=e.length-8;s<e.length;++s)e[s]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,s=0;s<4;++s)for(let r=0;r<32;r+=8)e[t++]=this.g[s]>>>r&255;return e};var n={};function i(e){return-128<=e&&e<128?function(e,t){var s=n;return Object.prototype.hasOwnProperty.call(s,e)?s[e]:s[e]=t(e)}(e,function(e){return new r([0|e],e<0?-1:0)}):new r([0|e],e<0?-1:0)}function a(e){if(isNaN(e)||!isFinite(e))return o;if(e<0)return h(a(-e));const t=[];let s=1;for(let r=0;e>=s;r++)t[r]=e/s|0,s*=4294967296;return new r(t,0)}var o=i(0),l=i(1),c=i(16777216);function d(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function u(e){return-1==e.h}function h(e){const t=e.g.length,s=[];for(let r=0;r<t;r++)s[r]=~e.g[r];return new r(s,~e.h).add(l)}function m(e,t){return e.add(h(t))}function p(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function g(e,t){this.g=e,this.h=t}function f(e,t){if(d(t))throw Error("division by zero");if(d(e))return new g(o,o);if(u(e))return t=f(h(e),t),new g(h(t.g),h(t.h));if(u(t))return t=f(e,h(t)),new g(h(t.g),t.h);if(e.g.length>30){if(u(e)||u(t))throw Error("slowDivide_ only works with positive integers.");for(var s=l,r=t;r.l(e)<=0;)s=x(s),r=x(r);var n=y(s,1),i=y(r,1);for(r=y(r,2),s=y(s,2);!d(r);){var c=i.add(r);c.l(e)<=0&&(n=n.add(s),i=c),r=y(r,1),s=y(s,1)}return t=m(e,n.j(t)),new g(n,t)}for(n=o;e.l(t)>=0;){for(s=Math.max(1,Math.floor(e.m()/t.m())),r=(r=Math.ceil(Math.log(s)/Math.LN2))<=48?1:Math.pow(2,r-48),c=(i=a(s)).j(t);u(c)||c.l(e)>0;)c=(i=a(s-=r)).j(t);d(i)&&(i=l),n=n.add(i),e=m(e,c)}return new g(n,e)}function x(e){const t=e.g.length+1,s=[];for(let r=0;r<t;r++)s[r]=e.i(r)<<1|e.i(r-1)>>>31;return new r(s,e.h)}function y(e,t){const s=t>>5;t%=32;const n=e.g.length-s,i=[];for(let r=0;r<n;r++)i[r]=t>0?e.i(r+s)>>>t|e.i(r+s+1)<<32-t:e.i(r+s);return new r(i,e.h)}(e=r.prototype).m=function(){if(u(this))return-h(this).m();let e=0,t=1;for(let s=0;s<this.g.length;s++){const r=this.i(s);e+=(r>=0?r:4294967296+r)*t,t*=4294967296}return e},e.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(d(this))return"0";if(u(this))return"-"+h(this).toString(e);const t=a(Math.pow(e,6));var s=this;let r="";for(;;){const n=f(s,t).g;let i=(((s=m(s,n.j(t))).g.length>0?s.g[0]:s.h)>>>0).toString(e);if(d(s=n))return i+r;for(;i.length<6;)i="0"+i;r=i+r}},e.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return u(e=m(this,e))?-1:d(e)?0:1},e.abs=function(){return u(this)?h(this):this},e.add=function(e){const t=Math.max(this.g.length,e.g.length),s=[];let n=0;for(let r=0;r<=t;r++){let t=n+(65535&this.i(r))+(65535&e.i(r)),i=(t>>>16)+(this.i(r)>>>16)+(e.i(r)>>>16);n=i>>>16,t&=65535,i&=65535,s[r]=i<<16|t}return new r(s,-2147483648&s[s.length-1]?-1:0)},e.j=function(e){if(d(this)||d(e))return o;if(u(this))return u(e)?h(this).j(h(e)):h(h(this).j(e));if(u(e))return h(this.j(h(e)));if(this.l(c)<0&&e.l(c)<0)return a(this.m()*e.m());const t=this.g.length+e.g.length,s=[];for(var n=0;n<2*t;n++)s[n]=0;for(n=0;n<this.g.length;n++)for(let t=0;t<e.g.length;t++){const r=this.i(n)>>>16,i=65535&this.i(n),a=e.i(t)>>>16,o=65535&e.i(t);s[2*n+2*t]+=i*o,p(s,2*n+2*t),s[2*n+2*t+1]+=r*o,p(s,2*n+2*t+1),s[2*n+2*t+1]+=i*a,p(s,2*n+2*t+1),s[2*n+2*t+2]+=r*a,p(s,2*n+2*t+2)}for(e=0;e<t;e++)s[e]=s[2*e+1]<<16|s[2*e];for(e=t;e<2*t;e++)s[e]=0;return new r(s,0)},e.B=function(e){return f(this,e).h},e.and=function(e){const t=Math.max(this.g.length,e.g.length),s=[];for(let r=0;r<t;r++)s[r]=this.i(r)&e.i(r);return new r(s,this.h&e.h)},e.or=function(e){const t=Math.max(this.g.length,e.g.length),s=[];for(let r=0;r<t;r++)s[r]=this.i(r)|e.i(r);return new r(s,this.h|e.h)},e.xor=function(e){const t=Math.max(this.g.length,e.g.length),s=[];for(let r=0;r<t;r++)s[r]=this.i(r)^e.i(r);return new r(s,this.h^e.h)},t.prototype.digest=t.prototype.A,t.prototype.reset=t.prototype.u,t.prototype.update=t.prototype.v,Ls=t,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.B,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=a,r.fromString=function e(t,s){if(0==t.length)throw Error("number format error: empty string");if((s=s||10)<2||36<s)throw Error("radix out of range: "+s);if("-"==t.charAt(0))return h(e(t.substring(1),s));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');const r=a(Math.pow(s,8));let n=o;for(let o=0;o<t.length;o+=8){var i=Math.min(8,t.length-o);const e=parseInt(t.substring(o,o+i),s);i<8?(i=a(Math.pow(s,i)),n=n.j(i).add(a(e))):(n=n.j(r),n=n.add(a(e)))}return n},Os=r}).apply(void 0!==Fs?Fs:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var Ms,Us,Vs,Bs,zs,$s,qs,Ks,Hs="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};
/** @license
    Copyright The Closure Library Authors.
    SPDX-License-Identifier: Apache-2.0
    */(function(){var e,t=Object.defineProperty,s=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof Hs&&Hs];for(var t=0;t<e.length;++t){var s=e[t];if(s&&s.Math==Math)return s}throw Error("Cannot find global object")}(this);function r(e,r){if(r)e:{var n=s;e=e.split(".");for(var i=0;i<e.length-1;i++){var a=e[i];if(!(a in n))break e;n=n[a]}(r=r(i=n[e=e[e.length-1]]))!=i&&null!=r&&t(n,e,{configurable:!0,writable:!0,value:r})}}r("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),r("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),r("Object.entries",function(e){return e||function(e){var t,s=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&s.push([t,e[t]]);return s}});
/** @license
      
       Copyright The Closure Library Authors.
       SPDX-License-Identifier: Apache-2.0
      */
var n=n||{},i=this||self;function a(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function o(e,t,s){return e.call.apply(e.bind,arguments)}function l(e,t,s){return(l=o).apply(null,arguments)}function c(e,t){var s=Array.prototype.slice.call(arguments,1);return function(){var t=s.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function d(e,t){function s(){}s.prototype=t.prototype,e.Z=t.prototype,e.prototype=new s,e.prototype.constructor=e,e.Ob=function(e,s,r){for(var n=Array(arguments.length-2),i=2;i<arguments.length;i++)n[i-2]=arguments[i];return t.prototype[s].apply(e,n)}}var u="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function h(e){const t=e.length;if(t>0){const s=Array(t);for(let r=0;r<t;r++)s[r]=e[r];return s}return[]}function m(e,t){for(let r=1;r<arguments.length;r++){const t=arguments[r];var s=typeof t;if("array"==(s="object"!=s?s:t?Array.isArray(t)?"array":s:"null")||"object"==s&&"number"==typeof t.length){s=e.length||0;const r=t.length||0;e.length=s+r;for(let n=0;n<r;n++)e[s+n]=t[n]}else e.push(t)}}function p(e){i.setTimeout(()=>{throw e},0)}function g(){var e=v;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var f=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new x,e=>e.reset());class x{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let y,b=!1,v=new class{constructor(){this.h=this.g=null}add(e,t){const s=f.get();s.set(e,t),this.h?this.h.next=s:this.g=s,this.h=s}},N=()=>{const e=Promise.resolve(void 0);y=()=>{e.then(w)}};function w(){for(var e;e=g();){try{e.h.call(e.g)}catch(s){p(s)}var t=f;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}b=!1}function j(){this.u=this.u,this.C=this.C}function k(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}j.prototype.u=!1,j.prototype.dispose=function(){this.u||(this.u=!0,this.N())},j.prototype[Symbol.dispose]=function(){this.dispose()},j.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},k.prototype.h=function(){this.defaultPrevented=!0};var S=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};i.addEventListener("test",e,t),i.removeEventListener("test",e,t)}catch(s){}return e}();function _(e){return/^[\s\xa0]*$/.test(e)}function I(e,t){k.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}d(I,k),I.prototype.init=function(e,t){const s=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==s?t=e.fromElement:"mouseout"==s&&(t=e.toElement)),this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&I.Z.h.call(this)},I.prototype.h=function(){I.Z.h.call(this);const e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var C="closure_listenable_"+(1e6*Math.random()|0),E=0;function T(e,t,s,r,n){this.listener=e,this.proxy=null,this.src=t,this.type=s,this.capture=!!r,this.ha=n,this.key=++E,this.da=this.fa=!1}function A(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function P(e,t,s){for(const r in e)t.call(s,e[r],r,e)}function D(e){const t={};for(const s in e)t[s]=e[s];return t}const R="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function O(e,t){let s,r;for(let n=1;n<arguments.length;n++){for(s in r=arguments[n],r)e[s]=r[s];for(let t=0;t<R.length;t++)s=R[t],Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}}function L(e){this.src=e,this.g={},this.h=0}function F(e,t){const s=t.type;if(s in e.g){var r,n=e.g[s],i=Array.prototype.indexOf.call(n,t,void 0);(r=i>=0)&&Array.prototype.splice.call(n,i,1),r&&(A(t),0==e.g[s].length&&(delete e.g[s],e.h--))}}function M(e,t,s,r){for(let n=0;n<e.length;++n){const i=e[n];if(!i.da&&i.listener==t&&i.capture==!!s&&i.ha==r)return n}return-1}L.prototype.add=function(e,t,s,r,n){const i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);const a=M(e,t,r,n);return a>-1?(t=e[a],s||(t.fa=!1)):((t=new T(t,this.src,i,!!r,n)).fa=s,e.push(t)),t};var U="closure_lm_"+(1e6*Math.random()|0),V={};function B(e,t,s,r,n){if(Array.isArray(t)){for(let i=0;i<t.length;i++)B(e,t[i],s,r,n);return null}return s=W(s),e&&e[C]?e.J(t,s,!!a(r)&&!!r.capture,n):function(e,t,s,r,n,i){if(!t)throw Error("Invalid event type");const o=a(n)?!!n.capture:!!n;let l=H(e);if(l||(e[U]=l=new L(e)),(s=l.add(t,s,r,o,i)).proxy)return s;if(r=function(){function e(s){return t.call(e.src,e.listener,s)}const t=K;return e}(),s.proxy=r,r.src=e,r.listener=s,e.addEventListener)S||(n=o),void 0===n&&(n=!1),e.addEventListener(t.toString(),r,n);else if(e.attachEvent)e.attachEvent(q(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return s}(e,t,s,!1,r,n)}function z(e,t,s,r,n){if(Array.isArray(t))for(var i=0;i<t.length;i++)z(e,t[i],s,r,n);else r=a(r)?!!r.capture:!!r,s=W(s),e&&e[C]?(e=e.i,(i=String(t).toString())in e.g&&(s=M(t=e.g[i],s,r,n))>-1&&(A(t[s]),Array.prototype.splice.call(t,s,1),0==t.length&&(delete e.g[i],e.h--))):e&&(e=H(e))&&(t=e.g[t.toString()],e=-1,t&&(e=M(t,s,r,n)),(s=e>-1?t[e]:null)&&$(s))}function $(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[C])F(t.i,e);else{var s=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(s,r,e.capture):t.detachEvent?t.detachEvent(q(s),r):t.addListener&&t.removeListener&&t.removeListener(r),(s=H(t))?(F(s,e),0==s.h&&(s.src=null,t[U]=null)):A(e)}}}function q(e){return e in V?V[e]:V[e]="on"+e}function K(e,t){if(e.da)e=!0;else{t=new I(t,this);const s=e.listener,r=e.ha||e.src;e.fa&&$(e),e=s.call(r,t)}return e}function H(e){return(e=e[U])instanceof L?e:null}var G="__closure_events_fn_"+(1e9*Math.random()>>>0);function W(e){return"function"==typeof e?e:(e[G]||(e[G]=function(t){return e.handleEvent(t)}),e[G])}function J(){j.call(this),this.i=new L(this),this.M=this,this.G=null}function Q(e,t){var s,r=e.G;if(r)for(s=[];r;r=r.G)s.push(r);if(e=e.M,r=t.type||t,"string"==typeof t)t=new k(t,e);else if(t instanceof k)t.target=t.target||e;else{var n=t;O(t=new k(r,e),n)}let i,a;if(n=!0,s)for(a=s.length-1;a>=0;a--)i=t.g=s[a],n=Y(i,r,!0,t)&&n;if(i=t.g=e,n=Y(i,r,!0,t)&&n,n=Y(i,r,!1,t)&&n,s)for(a=0;a<s.length;a++)i=t.g=s[a],n=Y(i,r,!1,t)&&n}function Y(e,t,s,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let n=!0;for(let i=0;i<t.length;++i){const a=t[i];if(a&&!a.da&&a.capture==s){const t=a.listener,s=a.ha||a.src;a.fa&&F(e.i,a),n=!1!==t.call(s,r)&&n}}return n&&!r.defaultPrevented}function X(e){e.g=function(e,t){if("function"!=typeof e){if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=l(e.handleEvent,e)}return Number(t)>2147483647?-1:i.setTimeout(e,t||0)}(()=>{e.g=null,e.i&&(e.i=!1,X(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}d(J,j),J.prototype[C]=!0,J.prototype.removeEventListener=function(e,t,s,r){z(this,e,t,s,r)},J.prototype.N=function(){if(J.Z.N.call(this),this.i){var e=this.i;for(const t in e.g){const s=e.g[t];for(let e=0;e<s.length;e++)A(s[e]);delete e.g[t],e.h--}}this.G=null},J.prototype.J=function(e,t,s,r){return this.i.add(String(e),t,!1,s,r)},J.prototype.K=function(e,t,s,r){return this.i.add(String(e),t,!0,s,r)};class Z extends j{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:X(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ee(e){j.call(this),this.h=e,this.g={}}d(ee,j);var te=[];function se(e){P(e.g,function(e,t){this.g.hasOwnProperty(t)&&$(e)},e),e.g={}}ee.prototype.N=function(){ee.Z.N.call(this),se(this)},ee.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var re=i.JSON.stringify,ne=i.JSON.parse,ie=class{stringify(e){return i.JSON.stringify(e,void 0)}parse(e){return i.JSON.parse(e,void 0)}};function ae(){}function oe(){}var le={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ce(){k.call(this,"d")}function de(){k.call(this,"c")}d(ce,k),d(de,k);var ue={},he=null;function me(){return he=he||new J}function pe(e){k.call(this,ue.Ia,e)}function ge(e){const t=me();Q(t,new pe(t))}function fe(e,t){k.call(this,ue.STAT_EVENT,e),this.stat=t}function xe(e){const t=me();Q(t,new fe(t,e))}function ye(e,t){k.call(this,ue.Ja,e),this.size=t}function be(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return i.setTimeout(function(){e()},t)}function ve(){this.g=!0}function Ne(e,t,s,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{const i=JSON.parse(t);if(i)for(e=0;e<i.length;e++)if(Array.isArray(i[e])){var s=i[e];if(!(s.length<2)){var r=s[1];if(Array.isArray(r)&&!(r.length<1)){var n=r[0];if("noop"!=n&&"stop"!=n&&"close"!=n)for(let e=1;e<r.length;e++)r[e]=""}}}return re(i)}catch(i){return t}}(e,s)+(r?" "+r:"")})}ue.Ia="serverreachability",d(pe,k),ue.STAT_EVENT="statevent",d(fe,k),ue.Ja="timingevent",d(ye,k),ve.prototype.ua=function(){this.g=!1},ve.prototype.info=function(){};var we,je={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},ke={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function Se(){}function _e(e){return encodeURIComponent(String(e))}function Ie(e){var t=1;e=e.split(":");const s=[];for(;t>0&&e.length;)s.push(e.shift()),t--;return e.length&&s.push(e.join(":")),s}function Ce(e,t,s,r){this.j=e,this.i=t,this.l=s,this.S=r||1,this.V=new ee(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Ee}function Ee(){this.i=null,this.g="",this.h=!1}d(Se,ae),Se.prototype.g=function(){return new XMLHttpRequest},we=new Se;var Te={},Ae={};function Pe(e,t,s){e.M=1,e.A=rt(Xe(t)),e.u=s,e.R=!0,De(e,null)}function De(e,t){e.F=Date.now(),Le(e),e.B=Xe(e.A);var s=e.B,r=e.S;Array.isArray(r)||(r=[String(r)]),xt(s.i,"t",r),e.C=0,s=e.j.L,e.h=new Ee,e.g=rs(e.j,s?t:null,!e.u),e.P>0&&(e.O=new Z(l(e.Y,e,e.g),e.P)),t=e.V,s=e.g,r=e.ba;var n="readystatechange";Array.isArray(n)||(n&&(te[0]=n.toString()),n=te);for(let i=0;i<n.length;i++){const e=B(s,n[i],r||t.handleEvent,!1,t.h||t);if(!e)break;t.g[e.key]=e}t=e.J?D(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),ge(),function(e,t,s,r,n,i){e.info(function(){if(e.g)if(i){var a="",o=i.split("&");for(let e=0;e<o.length;e++){var l=o[e].split("=");if(l.length>1){const e=l[0];l=l[1];const t=e.split("_");a=t.length>=2&&"type"==t[1]?a+(e+"=")+l+"&":a+(e+"=redacted&")}}}else a=null;else a=i;return"XMLHTTP REQ ("+r+") [attempt "+n+"]: "+t+"\n"+s+"\n"+a})}(e.i,e.v,e.B,e.l,e.S,e.u)}function Re(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function Oe(e,t){var s=e.C,r=t.indexOf("\n",s);return-1==r?Ae:(s=Number(t.substring(s,r)),isNaN(s)?Te:(r+=1)+s>t.length?Ae:(t=t.slice(r,r+s),e.C=r+s,t))}function Le(e){e.T=Date.now()+e.H,Fe(e,e.H)}function Fe(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=be(l(e.aa,e),t)}function Me(e){e.D&&(i.clearTimeout(e.D),e.D=null)}function Ue(e){0==e.j.I||e.K||Xt(e.j,e)}function Ve(e){Me(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,se(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function Be(e,t){try{var s=e.j;if(0!=s.I&&(s.g==e||He(s.h,e)))if(!e.L&&He(s.h,e)&&3==s.I){try{var r=s.Ba.g.parse(t)}catch(d){r=null}if(Array.isArray(r)&&3==r.length){var n=r;if(0==n[0]){e:if(!s.v){if(s.g){if(!(s.g.F+3e3<e.F))break e;Yt(s),Bt(s)}Wt(s),xe(18)}}else s.xa=n[1],0<s.xa-s.K&&n[2]<37500&&s.F&&0==s.A&&!s.C&&(s.C=be(l(s.Va,s),6e3));Ke(s.h)<=1&&s.ta&&(s.ta=void 0)}else es(s,11)}else if((e.L||s.g==e)&&Yt(s),!_(t))for(n=s.Ba.g.parse(t),t=0;t<n.length;t++){let l=n[t];const d=l[0];if(!(d<=s.K))if(s.K=d,l=l[1],2==s.I)if("c"==l[0]){s.M=l[1],s.ba=l[2];const t=l[3];null!=t&&(s.ka=t,s.j.info("VER="+s.ka));const n=l[4];null!=n&&(s.za=n,s.j.info("SVER="+s.za));const d=l[5];null!=d&&"number"==typeof d&&d>0&&(r=1.5*d,s.O=r,s.j.info("backChannelRequestTimeoutMs_="+r)),r=s;const u=e.g;if(u){const e=u.g?u.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var i=r.h;i.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(Ge(i,i.h),i.h=null))}if(r.G){const e=u.g?u.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.wa=e,st(r.J,r.G,e))}}s.I=3,s.l&&s.l.ra(),s.aa&&(s.T=Date.now()-e.F,s.j.info("Handshake RTT: "+s.T+"ms"));var a=e;if((r=s).na=ss(r,r.L?r.ba:null,r.W),a.L){We(r.h,a);var o=a,c=r.O;c&&(o.H=c),o.D&&(Me(o),Le(o)),r.g=a}else Gt(r);s.i.length>0&&$t(s)}else"stop"!=l[0]&&"close"!=l[0]||es(s,7);else 3==s.I&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?es(s,7):Vt(s):"noop"!=l[0]&&s.l&&s.l.qa(l),s.A=0)}ge()}catch(d){}}Ce.prototype.ba=function(e){e=e.target;const t=this.O;t&&3==Lt(e)?t.j():this.Y(e)},Ce.prototype.Y=function(e){try{if(e==this.g)e:{const l=Lt(this.g),c=this.g.ya();if(this.g.ca(),!(l<3)&&(3!=l||this.g&&(this.h.h||this.g.la()||Ft(this.g)))){this.K||4!=l||7==c||ge(),Me(this);var t=this.g.ca();this.X=t;var s=function(e){if(!Re(e))return e.g.la();const t=Ft(e.g);if(""===t)return"";let s="";const r=t.length,n=4==Lt(e.g);if(!e.h.i){if("undefined"==typeof TextDecoder)return Ve(e),Ue(e),"";e.h.i=new i.TextDecoder}for(let i=0;i<r;i++)e.h.h=!0,s+=e.h.i.decode(t[i],{stream:!(n&&i==r-1)});return t.length=0,e.h.g+=s,e.C=0,e.h.g}(this);if(this.o=200==t,function(e,t,s,r,n,i,a){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+n+"]: "+t+"\n"+s+"\n"+i+" "+a})}(this.i,this.v,this.B,this.l,this.S,l,t),this.o){if(this.U&&!this.L){t:{if(this.g){var r,n=this.g;if((r=n.g?n.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!_(r)){var a=r;break t}}a=null}if(!(e=a)){this.o=!1,this.m=3,xe(12),Ve(this),Ue(this);break e}Ne(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Be(this,e)}if(this.R){let t;for(e=!0;!this.K&&this.C<s.length;){if(t=Oe(this,s),t==Ae){4==l&&(this.m=4,xe(14),e=!1),Ne(this.i,this.l,null,"[Incomplete Response]");break}if(t==Te){this.m=4,xe(15),Ne(this.i,this.l,s,"[Invalid Chunk]"),e=!1;break}Ne(this.i,this.l,t,null),Be(this,t)}if(Re(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=l||0!=s.length||this.h.h||(this.m=1,xe(16),e=!1),this.o=this.o&&e,e){if(s.length>0&&!this.W){this.W=!0;var o=this.j;o.g==this&&o.aa&&!o.P&&(o.j.info("Great, no buffering proxy detected. Bytes received: "+s.length),Jt(o),o.P=!0,xe(11))}}else Ne(this.i,this.l,s,"[Invalid Chunked Response]"),Ve(this),Ue(this)}else Ne(this.i,this.l,s,null),Be(this,s);4==l&&Ve(this),this.o&&!this.K&&(4==l?Xt(this.j,this):(this.o=!1,Le(this)))}else(function(e){const t={};e=(e.g&&Lt(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(_(e[r]))continue;var s=Ie(e[r]);const n=s[0];if("string"!=typeof(s=s[1]))continue;s=s.trim();const i=t[n]||[];t[n]=i,i.push(s)}!function(e,t){for(const s in e)t.call(void 0,e[s],s,e)}(t,function(e){return e.join(", ")})})(this.g),400==t&&s.indexOf("Unknown SID")>0?(this.m=3,xe(12)):(this.m=0,xe(13)),Ve(this),Ue(this)}}}catch(l){}},Ce.prototype.cancel=function(){this.K=!0,Ve(this)},Ce.prototype.aa=function(){this.D=null;const e=Date.now();e-this.T>=0?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.B),2!=this.M&&(ge(),xe(17)),Ve(this),this.m=2,Ue(this)):Fe(this,this.T-e)};var ze=class{constructor(e,t){this.g=e,this.map=t}};function $e(e){this.l=e||10,e=i.PerformanceNavigationTiming?(e=i.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function qe(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Ke(e){return e.h?1:e.g?e.g.size:0}function He(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Ge(e,t){e.g?e.g.add(t):e.h=t}function We(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Je(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const s of e.g.values())t=t.concat(s.G);return t}return h(e.i)}$e.prototype.cancel=function(){if(this.i=Je(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var Qe=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ye(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof Ye?(this.l=e.l,Ze(this,e.j),this.o=e.o,this.g=e.g,et(this,e.u),this.h=e.h,tt(this,yt(e.i)),this.m=e.m):e&&(t=String(e).match(Qe))?(this.l=!1,Ze(this,t[1]||"",!0),this.o=nt(t[2]||""),this.g=nt(t[3]||"",!0),et(this,t[4]),this.h=nt(t[5]||"",!0),tt(this,t[6]||"",!0),this.m=nt(t[7]||"")):(this.l=!1,this.i=new ht(null,this.l))}function Xe(e){return new Ye(e)}function Ze(e,t,s){e.j=s?nt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function et(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function tt(e,t,s){t instanceof ht?(e.i=t,function(e,t){t&&!e.j&&(mt(e),e.i=null,e.g.forEach(function(e,t){const s=t.toLowerCase();t!=s&&(pt(this,t),xt(this,s,e))},e)),e.j=t}(e.i,e.l)):(s||(t=it(t,dt)),e.i=new ht(t,e.l))}function st(e,t,s){e.i.set(t,s)}function rt(e){return st(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function nt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function it(e,t,s){return"string"==typeof e?(e=encodeURI(e).replace(t,at),s&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function at(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Ye.prototype.toString=function(){const e=[];var t=this.j;t&&e.push(it(t,ot,!0),":");var s=this.g;return(s||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(it(t,ot,!0),"@"),e.push(_e(s).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(s=this.u)&&e.push(":",String(s))),(s=this.h)&&(this.g&&"/"!=s.charAt(0)&&e.push("/"),e.push(it(s,"/"==s.charAt(0)?ct:lt,!0))),(s=this.i.toString())&&e.push("?",s),(s=this.m)&&e.push("#",it(s,ut)),e.join("")},Ye.prototype.resolve=function(e){const t=Xe(this);let s=!!e.j;s?Ze(t,e.j):s=!!e.o,s?t.o=e.o:s=!!e.g,s?t.g=e.g:s=null!=e.u;var r=e.h;if(s)et(t,e.u);else if(s=!!e.h){if("/"!=r.charAt(0))if(this.g&&!this.h)r="/"+r;else{var n=t.h.lastIndexOf("/");-1!=n&&(r=t.h.slice(0,n+1)+r)}if(".."==(n=r)||"."==n)r="";else if(-1!=n.indexOf("./")||-1!=n.indexOf("/.")){r=0==n.lastIndexOf("/",0),n=n.split("/");const e=[];for(let t=0;t<n.length;){const s=n[t++];"."==s?r&&t==n.length&&e.push(""):".."==s?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),r&&t==n.length&&e.push("")):(e.push(s),r=!0)}r=e.join("/")}else r=n}return s?t.h=r:s=""!==e.i.toString(),s?tt(t,yt(e.i)):s=!!e.m,s&&(t.m=e.m),t};var ot=/[#\/\?@]/g,lt=/[#\?:]/g,ct=/[#\?]/g,dt=/[#\?@]/g,ut=/#/g;function ht(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function mt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let s=0;s<e.length;s++){const r=e[s].indexOf("=");let n,i=null;r>=0?(n=e[s].substring(0,r),i=e[s].substring(r+1)):n=e[s],t(n,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,function(t,s){e.add(decodeURIComponent(t.replace(/\+/g," ")),s)}))}function pt(e,t){mt(e),t=bt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function gt(e,t){return mt(e),t=bt(e,t),e.g.has(t)}function ft(e,t){mt(e);let s=[];if("string"==typeof t)gt(e,t)&&(s=s.concat(e.g.get(bt(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)s=s.concat(e[t]);return s}function xt(e,t,s){pt(e,t),s.length>0&&(e.i=null,e.g.set(bt(e,t),h(s)),e.h+=s.length)}function yt(e){const t=new ht;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function bt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function vt(e,t,s,r,n){try{n&&(n.onload=null,n.onerror=null,n.onabort=null,n.ontimeout=null),r(s)}catch(i){}}function Nt(){this.g=new ie}function wt(e){this.i=e.Sb||null,this.h=e.ab||!1}function jt(e,t){J.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function kt(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function St(e){e.readyState=4,e.l=null,e.j=null,e.B=null,_t(e)}function _t(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function It(e){let t="";return P(e,function(e,s){t+=s,t+=":",t+=e,t+="\r\n"}),t}function Ct(e,t,s){e:{for(r in s){var r=!1;break e}r=!0}r||(s=It(s),"string"==typeof e?null!=s&&_e(s):st(e,t,s))}function Et(e){J.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(e=ht.prototype).add=function(e,t){mt(this),this.i=null,e=bt(this,e);let s=this.g.get(e);return s||this.g.set(e,s=[]),s.push(t),this.h+=1,this},e.forEach=function(e,t){mt(this),this.g.forEach(function(s,r){s.forEach(function(s){e.call(t,s,r,this)},this)},this)},e.set=function(e,t){return mt(this),this.i=null,gt(this,e=bt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&(e=ft(this,e)).length>0?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(let r=0;r<t.length;r++){var s=t[r];const n=_e(s);s=ft(this,s);for(let t=0;t<s.length;t++){let r=n;""!==s[t]&&(r+="="+_e(s[t])),e.push(r)}}return this.i=e.join("&")},d(wt,ae),wt.prototype.g=function(){return new jt(this.i,this.h)},d(jt,J),(e=jt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,_t(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||i).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,St(this)),this.readyState=0},e.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,_t(this)),this.g&&(this.readyState=3,_t(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==i.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;kt(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},e.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?St(this):_t(this),3==this.readyState&&kt(this)}},e.Oa=function(e){this.g&&(this.response=this.responseText=e,St(this))},e.Na=function(e){this.g&&(this.response=e,St(this))},e.ga=function(){this.g&&St(this)},e.setRequestHeader=function(e,t){this.A.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var s=t.next();!s.done;)s=s.value,e.push(s[0]+": "+s[1]),s=t.next();return e.join("\r\n")},Object.defineProperty(jt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),d(Et,J);var Tt=/^https?$/i,At=["POST","PUT"];function Pt(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,Dt(e),Ot(e)}function Dt(e){e.A||(e.A=!0,Q(e,"complete"),Q(e,"error"))}function Rt(e){if(e.h&&void 0!==n)if(e.v&&4==Lt(e))setTimeout(e.Ca.bind(e),0);else if(Q(e,"readystatechange"),4==Lt(e)){e.h=!1;try{const n=e.ca();e:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var s;if(!(s=t)){var r;if(r=0===n){let t=String(e.D).match(Qe)[1]||null;!t&&i.self&&i.self.location&&(t=i.self.location.protocol.slice(0,-1)),r=!Tt.test(t?t.toLowerCase():"")}s=r}if(s)Q(e,"complete"),Q(e,"success");else{e.o=6;try{var a=Lt(e)>2?e.g.statusText:""}catch(o){a=""}e.l=a+" ["+e.ca()+"]",Dt(e)}}finally{Ot(e)}}}function Ot(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);const r=e.g;e.g=null,t||Q(e,"ready");try{r.onreadystatechange=null}catch(s){}}}function Lt(e){return e.g?e.g.readyState:0}function Ft(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Mt(e,t,s){return s&&s.internalChannelParams&&s.internalChannelParams[e]||t}function Ut(e){this.za=0,this.i=[],this.j=new ve,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Mt("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Mt("baseRetryDelayMs",5e3,e),this.Za=Mt("retryDelaySeedMs",1e4,e),this.Ta=Mt("forwardChannelMaxRetries",2,e),this.va=Mt("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new $e(e&&e.concurrentRequestLimit),this.Ba=new Nt,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function Vt(e){if(zt(e),3==e.I){var t=e.V++,s=Xe(e.J);if(st(s,"SID",e.M),st(s,"RID",t),st(s,"TYPE","terminate"),Kt(e,s),(t=new Ce(e,e.j,t)).M=2,t.A=rt(Xe(s)),s=!1,i.navigator&&i.navigator.sendBeacon)try{s=i.navigator.sendBeacon(t.A.toString(),"")}catch(r){}!s&&i.Image&&((new Image).src=t.A,s=!0),s||(t.g=rs(t.j,null),t.g.ea(t.A)),t.F=Date.now(),Le(t)}ts(e)}function Bt(e){e.g&&(Jt(e),e.g.cancel(),e.g=null)}function zt(e){Bt(e),e.v&&(i.clearTimeout(e.v),e.v=null),Yt(e),e.h.cancel(),e.m&&("number"==typeof e.m&&i.clearTimeout(e.m),e.m=null)}function $t(e){if(!qe(e.h)&&!e.m){e.m=!0;var t=e.Ea;y||N(),b||(y(),b=!0),v.add(t,e),e.D=0}}function qt(e,t){var s;s=t?t.l:e.V++;const r=Xe(e.J);st(r,"SID",e.M),st(r,"RID",s),st(r,"AID",e.K),Kt(e,r),e.u&&e.o&&Ct(r,e.u,e.o),s=new Ce(e,e.j,s,e.D+1),null===e.u&&(s.J=e.o),t&&(e.i=t.G.concat(e.i)),t=Ht(e,s,1e3),s.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),Ge(e.h,s),Pe(s,r,t)}function Kt(e,t){e.H&&P(e.H,function(e,s){st(t,s,e)}),e.l&&P({},function(e,s){st(t,s,e)})}function Ht(e,t,s){s=Math.min(e.i.length,s);const r=e.l?l(e.l.Ka,e.l,e):null;e:{var n=e.i;let t=-1;for(;;){const e=["count="+s];-1==t?s>0?(t=n[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let l=!0;for(let d=0;d<s;d++){var i=n[d].g;const s=n[d].map;if((i-=t)<0)t=Math.max(0,n[d].g-100),l=!1;else try{i="req"+i+"_"||"";try{var o=s instanceof Map?s:Object.entries(s);for(const[t,s]of o){let r=s;a(s)&&(r=re(s)),e.push(i+t+"="+encodeURIComponent(r))}}catch(c){throw e.push(i+"type="+encodeURIComponent("_badmap")),c}}catch(c){r&&r(s)}}if(l){o=e.join("&");break e}}o=void 0}return e=e.i.splice(0,s),t.G=e,o}function Gt(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;y||N(),b||(y(),b=!0),v.add(t,e),e.A=0}}function Wt(e){return!(e.g||e.v||e.A>=3||(e.Y++,e.v=be(l(e.Da,e),Zt(e,e.A)),e.A++,0))}function Jt(e){null!=e.B&&(i.clearTimeout(e.B),e.B=null)}function Qt(e){e.g=new Ce(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=Xe(e.na);st(t,"RID","rpc"),st(t,"SID",e.M),st(t,"AID",e.K),st(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&st(t,"TO",e.ia),st(t,"TYPE","xmlhttp"),Kt(e,t),e.u&&e.o&&Ct(t,e.u,e.o),e.O&&(e.g.H=e.O);var s=e.g;e=e.ba,s.M=1,s.A=rt(Xe(t)),s.u=null,s.R=!0,De(s,e)}function Yt(e){null!=e.C&&(i.clearTimeout(e.C),e.C=null)}function Xt(e,t){var s=null;if(e.g==t){Yt(e),Jt(e),e.g=null;var r=2}else{if(!He(e.h,t))return;s=t.G,We(e.h,t),r=1}if(0!=e.I)if(t.o)if(1==r){s=t.u?t.u.length:0,t=Date.now()-t.F;var n=e.D;Q(r=me(),new ye(r,s)),$t(e)}else Gt(e);else if(3==(n=t.m)||0==n&&t.X>0||!(1==r&&function(e,t){return!(Ke(e.h)>=e.h.j-(e.m?1:0)||(e.m?(e.i=t.G.concat(e.i),0):1==e.I||2==e.I||e.D>=(e.Sa?0:e.Ta)||(e.m=be(l(e.Ea,e,t),Zt(e,e.D)),e.D++,0)))}(e,t)||2==r&&Wt(e)))switch(s&&s.length>0&&(t=e.h,t.i=t.i.concat(s)),n){case 1:es(e,5);break;case 4:es(e,10);break;case 3:es(e,6);break;default:es(e,2)}}function Zt(e,t){let s=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(s*=2),s*t}function es(e,t){if(e.j.info("Error code "+t),2==t){var s=l(e.bb,e),r=e.Ua;const t=!r;r=new Ye(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||Ze(r,"https"),rt(r),t?function(e,t){const s=new ve;if(i.Image){const r=new Image;r.onload=c(vt,s,"TestLoadImage: loaded",!0,t,r),r.onerror=c(vt,s,"TestLoadImage: error",!1,t,r),r.onabort=c(vt,s,"TestLoadImage: abort",!1,t,r),r.ontimeout=c(vt,s,"TestLoadImage: timeout",!1,t,r),i.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(r.toString(),s):function(e,t){new ve;const s=new AbortController,r=setTimeout(()=>{s.abort(),vt(0,0,!1,t)},1e4);fetch(e,{signal:s.signal}).then(e=>{clearTimeout(r),e.ok?vt(0,0,!0,t):vt(0,0,!1,t)}).catch(()=>{clearTimeout(r),vt(0,0,!1,t)})}(r.toString(),s)}else xe(2);e.I=0,e.l&&e.l.pa(t),ts(e),zt(e)}function ts(e){if(e.I=0,e.ja=[],e.l){const t=Je(e.h);0==t.length&&0==e.i.length||(m(e.ja,t),m(e.ja,e.i),e.h.i.length=0,h(e.i),e.i.length=0),e.l.oa()}}function ss(e,t,s){var r=s instanceof Ye?Xe(s):new Ye(s);if(""!=r.g)t&&(r.g=t+"."+r.g),et(r,r.u);else{var n=i.location;r=n.protocol,t=t?t+"."+n.hostname:n.hostname,n=+n.port;const e=new Ye(null);r&&Ze(e,r),t&&(e.g=t),n&&et(e,n),s&&(e.h=s),r=e}return s=e.G,t=e.wa,s&&t&&st(r,s,t),st(r,"VER",e.ka),Kt(e,r),r}function rs(e,t,s){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Aa&&!e.ma?new Et(new wt({ab:s})):new Et(e.ma)).Fa(e.L),t}function ns(){}function is(){}function as(e,t){J.call(this),this.g=new Ut(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!_(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!_(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new cs(this)}function os(e){ce.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const s in t){e=s;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function ls(){de.call(this),this.status=1}function cs(e){this.g=e}(e=Et.prototype).Fa=function(e){this.H=e},e.ea=function(e,t,s,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():we.g(),this.g.onreadystatechange=u(l(this.Ca,this));try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(a){return void Pt(this,a)}if(e=s||"",s=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var n in r)s.set(n,r[n]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())s.set(e,r.get(e))}r=Array.from(s.keys()).find(e=>"content-type"==e.toLowerCase()),n=i.FormData&&e instanceof i.FormData,!(Array.prototype.indexOf.call(At,t,void 0)>=0)||r||n||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[i,o]of s)this.g.setRequestHeader(i,o);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(e),this.v=!1}catch(a){Pt(this,a)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,Q(this,"complete"),Q(this,"abort"),Ot(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ot(this,!0)),Et.Z.N.call(this)},e.Ca=function(){this.u||(this.B||this.v||this.j?Rt(this):this.Xa())},e.Xa=function(){Rt(this)},e.isActive=function(){return!!this.g},e.ca=function(){try{return Lt(this)>2?this.g.status:-1}catch(e){return-1}},e.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),ne(t)}},e.ya=function(){return this.o},e.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=Ut.prototype).ka=8,e.I=1,e.connect=function(e,t,s,r){xe(0),this.W=e,this.H=t||{},s&&void 0!==r&&(this.H.OSID=s,this.H.OAID=r),this.F=this.X,this.J=ss(this,null,this.W),$t(this)},e.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const n=new Ce(this,this.j,e);let i=this.o;if(this.U&&(i?(i=D(i),O(i,this.U)):i=this.U),null!==this.u||this.R||(n.J=i,i=null),this.S)e:{for(var t=0,s=0;s<this.i.length;s++){var r=this.i[s];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if((t+=r)>4096){t=s;break e}if(4096===t||s===this.i.length-1){t=s+1;break e}}t=1e3}else t=1e3;t=Ht(this,n,t),st(s=Xe(this.J),"RID",e),st(s,"CVER",22),this.G&&st(s,"X-HTTP-Session-Id",this.G),Kt(this,s),i&&(this.R?t="headers="+_e(It(i))+"&"+t:this.u&&Ct(s,this.u,i)),Ge(this.h,n),this.Ra&&st(s,"TYPE","init"),this.S?(st(s,"$req",t),st(s,"SID","null"),n.U=!0,Pe(n,s,null)):Pe(n,s,t),this.I=2}}else 3==this.I&&(e?qt(this,e):0==this.i.length||qe(this.h)||qt(this))},e.Da=function(){if(this.v=null,Qt(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=be(l(this.Wa,this),e)}},e.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,xe(10),Bt(this),Qt(this))},e.Va=function(){null!=this.C&&(this.C=null,Bt(this),Wt(this),xe(19))},e.bb=function(e){e?(this.j.info("Successfully pinged google.com"),xe(2)):(this.j.info("Failed to ping google.com"),xe(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=ns.prototype).ra=function(){},e.qa=function(){},e.pa=function(){},e.oa=function(){},e.isActive=function(){return!0},e.Ka=function(){},is.prototype.g=function(e,t){return new as(e,t)},d(as,J),as.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},as.prototype.close=function(){Vt(this.g)},as.prototype.o=function(e){var t=this.g;if("string"==typeof e){var s={};s.__data__=e,e=s}else this.v&&((s={}).__data__=re(e),e=s);t.i.push(new ze(t.Ya++,e)),3==t.I&&$t(t)},as.prototype.N=function(){this.g.l=null,delete this.j,Vt(this.g),delete this.g,as.Z.N.call(this)},d(os,ce),d(ls,de),d(cs,ns),cs.prototype.ra=function(){Q(this.g,"a")},cs.prototype.qa=function(e){Q(this.g,new os(e))},cs.prototype.pa=function(e){Q(this.g,new ls)},cs.prototype.oa=function(){Q(this.g,"b")},is.prototype.createWebChannel=is.prototype.g,as.prototype.send=as.prototype.o,as.prototype.open=as.prototype.m,as.prototype.close=as.prototype.close,Ks=function(){return new is},qs=function(){return me()},$s=ue,zs={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},je.NO_ERROR=0,je.TIMEOUT=8,je.HTTP_ERROR=6,Bs=je,ke.COMPLETE="complete",Vs=ke,oe.EventType=le,le.OPEN="a",le.CLOSE="b",le.ERROR="c",le.MESSAGE="d",J.prototype.listen=J.prototype.J,Us=oe,Et.prototype.listenOnce=Et.prototype.K,Et.prototype.getLastError=Et.prototype.Ha,Et.prototype.getLastErrorCode=Et.prototype.ya,Et.prototype.getStatus=Et.prototype.ca,Et.prototype.getResponseJson=Et.prototype.La,Et.prototype.getResponseText=Et.prototype.la,Et.prototype.send=Et.prototype.ea,Et.prototype.setWithCredentials=Et.prototype.Fa,Ms=Et}).apply(void 0!==Hs?Hs:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const Gs="@firebase/firestore",Ws="4.9.2";
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Js{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Js.UNAUTHENTICATED=new Js(null),Js.GOOGLE_CREDENTIALS=new Js("google-credentials-uid"),Js.FIRST_PARTY=new Js("first-party-uid"),Js.MOCK_USER=new Js("mock-user");
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
let Qs="12.3.0";
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Ys=new ft("@firebase/firestore");function Xs(){return Ys.logLevel}function Zs(e,...t){if(Ys.logLevel<=dt.DEBUG){const s=t.map(sr);Ys.debug(`Firestore (${Qs}): ${e}`,...s)}}function er(e,...t){if(Ys.logLevel<=dt.ERROR){const s=t.map(sr);Ys.error(`Firestore (${Qs}): ${e}`,...s)}}function tr(e,...t){if(Ys.logLevel<=dt.WARN){const s=t.map(sr);Ys.warn(`Firestore (${Qs}): ${e}`,...s)}}function sr(e){if("string"==typeof e)return e;try{
/**
        * @license
        * Copyright 2020 Google LLC
        *
        * Licensed under the Apache License, Version 2.0 (the "License");
        * you may not use this file except in compliance with the License.
        * You may obtain a copy of the License at
        *
        *   http://www.apache.org/licenses/LICENSE-2.0
        *
        * Unless required by applicable law or agreed to in writing, software
        * distributed under the License is distributed on an "AS IS" BASIS,
        * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
        * See the License for the specific language governing permissions and
        * limitations under the License.
        */
return t=e,JSON.stringify(t)}catch(s){return e}var t}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function rr(e,t,s){let r="Unexpected state";"string"==typeof t?r=t:s=t,nr(e,r,s)}function nr(e,t,s){let r=`FIRESTORE (${Qs}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==s)try{r+=" CONTEXT: "+JSON.stringify(s)}catch(n){r+=" CONTEXT: "+s}throw er(r),new Error(r)}function ir(e,t,s,r){let n="Unexpected state";"string"==typeof s?n=s:r=s,e||nr(t,n,r)}function ar(e,t){return e}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const or={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class lr extends Je{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class cr{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class dr{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class ur{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Js.UNAUTHENTICATED))}shutdown(){}}class hr{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class mr{constructor(e){this.t=e,this.currentUser=Js.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){ir(void 0===this.o,42304);let s=this.i;const r=e=>this.i!==s?(s=this.i,t(e)):Promise.resolve();let n=new cr;this.o=()=>{this.i++,this.currentUser=this.u(),n.resolve(),n=new cr,e.enqueueRetryable(()=>r(this.currentUser))};const i=()=>{const t=n;e.enqueueRetryable(()=>g(this,null,function*(){yield t.promise,yield r(this.currentUser)}))},a=e=>{Zs("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),i())};this.t.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?a(e):(Zs("FirebaseAuthCredentialsProvider","Auth not yet detected"),n.resolve(),n=new cr)}},0),i()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(Zs("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(ir("string"==typeof t.accessToken,31837,{l:t}),new dr(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ir(null===e||"string"==typeof e,2055,{h:e}),new Js(e)}}class pr{constructor(e,t,s){this.P=e,this.T=t,this.I=s,this.type="FirstParty",this.user=Js.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class gr{constructor(e,t,s){this.P=e,this.T=t,this.I=s}getToken(){return Promise.resolve(new pr(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(Js.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class fr{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class xr{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,ys(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){ir(void 0===this.o,3512);const s=e=>{null!=e.error&&Zs("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const s=e.token!==this.m;return this.m=e.token,Zs("FirebaseAppCheckTokenProvider",`Received ${s?"new":"existing"} token.`),s?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>s(t))};const r=e=>{Zs("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?r(e):Zs("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new fr(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(ir("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new fr(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function yr(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),s=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(s);else for(let r=0;r<e;r++)s[r]=Math.floor(256*Math.random());return s}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class br{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const s=yr(40);for(let r=0;r<s.length;++r)t.length<20&&s[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(s[r]%62))}return t}}function vr(e,t){return e<t?-1:e>t?1:0}function Nr(e,t){const s=Math.min(e.length,t.length);for(let r=0;r<s;r++){const s=e.charAt(r),n=t.charAt(r);if(s!==n)return wr(s)===wr(n)?vr(s,n):wr(s)?1:-1}return vr(e.length,t.length)}function wr(e){const t=e.charCodeAt(0);return t>=55296&&t<=57343}function jr(e,t,s){return e.length===t.length&&e.every((e,r)=>s(e,t[r]))}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const kr="__name__";class Sr{constructor(e,t,s){void 0===t?t=0:t>e.length&&rr(637,{offset:t,range:e.length}),void 0===s?s=e.length-t:s>e.length-t&&rr(1746,{length:s,range:e.length-t}),this.segments=e,this.offset=t,this.len=s}get length(){return this.len}isEqual(e){return 0===Sr.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Sr?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,s=this.limit();t<s;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const s=Math.min(e.length,t.length);for(let r=0;r<s;r++){const s=Sr.compareSegments(e.get(r),t.get(r));if(0!==s)return s}return vr(e.length,t.length)}static compareSegments(e,t){const s=Sr.isNumericId(e),r=Sr.isNumericId(t);return s&&!r?-1:!s&&r?1:s&&r?Sr.extractNumericId(e).compare(Sr.extractNumericId(t)):Nr(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Os.fromString(e.substring(4,e.length-2))}}class _r extends Sr{construct(e,t,s){return new _r(e,t,s)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const s of e){if(s.indexOf("//")>=0)throw new lr(or.INVALID_ARGUMENT,`Invalid segment (${s}). Paths must not contain // in them.`);t.push(...s.split("/").filter(e=>e.length>0))}return new _r(t)}static emptyPath(){return new _r([])}}const Ir=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Cr extends Sr{construct(e,t,s){return new Cr(e,t,s)}static isValidIdentifier(e){return Ir.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Cr.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===kr}static keyField(){return new Cr([kr])}static fromServerFormat(e){const t=[];let s="",r=0;const n=()=>{if(0===s.length)throw new lr(or.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(s),s=""};let i=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new lr(or.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new lr(or.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);s+=t,r+=2}else"`"===t?(i=!i,r++):"."!==t||i?(s+=t,r++):(n(),r++)}if(n(),i)throw new lr(or.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Cr(t)}static emptyPath(){return new Cr([])}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Er{constructor(e){this.path=e}static fromPath(e){return new Er(_r.fromString(e))}static fromName(e){return new Er(_r.fromString(e).popFirst(5))}static empty(){return new Er(_r.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===_r.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return _r.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Er(new _r(e.slice()))}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Tr(e,t,s){if(!s)throw new lr(or.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Ar(e){if(!Er.isDocumentKey(e))throw new lr(or.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function Pr(e){if(Er.isDocumentKey(e))throw new lr(or.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Dr(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function Rr(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const s=(t=e).constructor?t.constructor.name:null;return s?`a custom ${s} object`:"an object"}}var t;return"function"==typeof e?"a function":rr(12329,{type:typeof e})}function Or(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new lr(or.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const s=Rr(e);throw new lr(or.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${s}`)}}return e}
/**
     * @license
     * Copyright 2025 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Lr(e,t){const s={typeString:e};return t&&(s.value=t),s}function Fr(e,t){if(!Dr(e))throw new lr(or.INVALID_ARGUMENT,"JSON must be an object");let s;for(const r in t)if(t[r]){const n=t[r].typeString,i="value"in t[r]?{value:t[r].value}:void 0;if(!(r in e)){s=`JSON missing required field: '${r}'`;break}const a=e[r];if(n&&typeof a!==n){s=`JSON field '${r}' must be a ${n}.`;break}if(void 0!==i&&a!==i.value){s=`Expected '${r}' field to equal '${i.value}'`;break}}if(s)throw new lr(or.INVALID_ARGUMENT,s);return!0}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Mr=-62135596800,Ur=1e6;class Vr{static now(){return Vr.fromMillis(Date.now())}static fromDate(e){return Vr.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),s=Math.floor((e-1e3*t)*Ur);return new Vr(t,s)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new lr(or.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new lr(or.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Mr)throw new lr(or.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new lr(or.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Ur}_compareTo(e){return this.seconds===e.seconds?vr(this.nanoseconds,e.nanoseconds):vr(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Vr._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Fr(e,Vr._jsonSchema))return new Vr(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Mr;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Vr._jsonSchemaVersion="firestore/timestamp/1.0",Vr._jsonSchema={type:Lr("string",Vr._jsonSchemaVersion),seconds:Lr("number"),nanoseconds:Lr("number")};
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Br{static fromTimestamp(e){return new Br(e)}static min(){return new Br(new Vr(0,0))}static max(){return new Br(new Vr(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function zr(e){return new $r(e.readTime,e.key,-1)}class $r{constructor(e,t,s){this.readTime=e,this.documentKey=t,this.largestBatchId=s}static min(){return new $r(Br.min(),Er.empty(),-1)}static max(){return new $r(Br.max(),Er.empty(),-1)}}function qr(e,t){let s=e.readTime.compareTo(t.readTime);return 0!==s?s:(s=Er.comparator(e.documentKey,t.documentKey),0!==s?s:vr(e.largestBatchId,t.largestBatchId)
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */)}class Kr{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Hr(e){return g(this,null,function*(){if(e.code!==or.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;Zs("LocalStore","Unexpectedly lost primary lease")})}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Gr{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&rr(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Gr((s,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(s,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(s,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof Gr?t:Gr.resolve(t)}catch(t){return Gr.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):Gr.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):Gr.reject(t)}static resolve(e){return new Gr((t,s)=>{t(e)})}static reject(e){return new Gr((t,s)=>{s(e)})}static waitFor(e){return new Gr((t,s)=>{let r=0,n=0,i=!1;e.forEach(e=>{++r,e.next(()=>{++n,i&&n===r&&t()},e=>s(e))}),i=!0,n===r&&t()})}static or(e){let t=Gr.resolve(!1);for(const s of e)t=t.next(e=>e?Gr.resolve(e):s());return t}static forEach(e,t){const s=[];return e.forEach((e,r)=>{s.push(t.call(this,e,r))}),this.waitFor(s)}static mapArray(e,t){return new Gr((s,r)=>{const n=e.length,i=new Array(n);let a=0;for(let o=0;o<n;o++){const l=o;t(e[l]).next(e=>{i[l]=e,++a,a===n&&s(i)},e=>r(e))}})}static doWhile(e,t){return new Gr((s,r)=>{const n=()=>{!0===e()?t().next(()=>{n()},r):s()};n()})}}function Wr(e){return"IndexedDbTransactionError"===e.name}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Jr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}function Qr(e){return null==e}function Yr(e){return 0===e&&1/e==-1/0}function Xr(e,t){let s=t;const r=e.length;for(let n=0;n<r;n++){const t=e.charAt(n);switch(t){case"\0":s+="";break;case"":s+="";break;default:s+=t}}return s}function Zr(e){return e+""}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function en(e){let t=0;for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&t++;return t}function tn(e,t){for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&t(s,e[s])}function sn(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */Jr.ce=-1;class rn{constructor(e,t){this.comparator=e,this.root=t||an.EMPTY}insert(e,t){return new rn(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,an.BLACK,null,null))}remove(e){return new rn(this.comparator,this.root.remove(e,this.comparator).copy(null,null,an.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const s=this.comparator(e,t.key);if(0===s)return t.value;s<0?t=t.left:s>0&&(t=t.right)}return null}indexOf(e){let t=0,s=this.root;for(;!s.isEmpty();){const r=this.comparator(e,s.key);if(0===r)return t+s.left.size;r<0?s=s.left:(t+=s.left.size+1,s=s.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,s)=>(e(t,s),!1))}toString(){const e=[];return this.inorderTraversal((t,s)=>(e.push(`${t}:${s}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new nn(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new nn(this.root,e,this.comparator,!1)}getReverseIterator(){return new nn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new nn(this.root,e,this.comparator,!0)}}class nn{constructor(e,t,s,r){this.isReverse=r,this.nodeStack=[];let n=1;for(;!e.isEmpty();)if(n=t?s(e.key,t):1,t&&r&&(n*=-1),n<0)e=this.isReverse?e.left:e.right;else{if(0===n){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class an{constructor(e,t,s,r,n){this.key=e,this.value=t,this.color=null!=s?s:an.RED,this.left=null!=r?r:an.EMPTY,this.right=null!=n?n:an.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,s,r,n){return new an(null!=e?e:this.key,null!=t?t:this.value,null!=s?s:this.color,null!=r?r:this.left,null!=n?n:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let r=this;const n=s(e,r.key);return r=n<0?r.copy(null,null,null,r.left.insert(e,t,s),null):0===n?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,s)),r.fixUp()}removeMin(){if(this.left.isEmpty())return an.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let s,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return an.EMPTY;s=r.right.min(),r=r.copy(s.key,s.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,an.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,an.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw rr(43730,{key:this.key,value:this.value});if(this.right.isRed())throw rr(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw rr(27949);return e+(this.isRed()?0:1)}}an.EMPTY=null,an.RED=!0,an.BLACK=!1,an.EMPTY=new class{constructor(){this.size=0}get key(){throw rr(57766)}get value(){throw rr(16141)}get color(){throw rr(16727)}get left(){throw rr(29726)}get right(){throw rr(36894)}copy(e,t,s,r,n){return this}insert(e,t,s){return new an(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class on{constructor(e){this.comparator=e,this.data=new rn(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,s)=>(e(t),!1))}forEachInRange(e,t){const s=this.data.getIteratorFrom(e[0]);for(;s.hasNext();){const r=s.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let s;for(s=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();s.hasNext();)if(!e(s.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ln(this.data.getIterator())}getIteratorFrom(e){return new ln(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof on))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),s=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=s.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new on(this.comparator);return t.data=e,t}}class ln{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class cn{constructor(e){this.fields=e,e.sort(Cr.comparator)}static empty(){return new cn([])}unionWith(e){let t=new on(Cr.comparator);for(const s of this.fields)t=t.add(s);for(const s of e)t=t.add(s);return new cn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return jr(this.fields,e.fields,(e,t)=>e.isEqual(t))}}
/**
     * @license
     * Copyright 2023 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class dn extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class un{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new dn("Invalid base64 string: "+t):t}}(e);return new un(t)}static fromUint8Array(e){const t=function(e){let t="";for(let s=0;s<e.length;++s)t+=String.fromCharCode(e[s]);return t}(e);return new un(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let s=0;s<e.length;s++)t[s]=e.charCodeAt(s);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return vr(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}un.EMPTY_BYTE_STRING=new un("");const hn=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function mn(e){if(ir(!!e,39018),"string"==typeof e){let t=0;const s=hn.exec(e);if(ir(!!s,46558,{timestamp:e}),s[1]){let e=s[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:pn(e.seconds),nanos:pn(e.nanos)}}function pn(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function gn(e){return"string"==typeof e?un.fromBase64String(e):un.fromUint8Array(e)}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const fn="server_timestamp",xn="__type__",yn="__previous_value__",bn="__local_write_time__";function vn(e){var t,s;return(null==(s=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[xn])?void 0:s.stringValue)===fn}function Nn(e){const t=e.mapValue.fields[yn];return vn(t)?Nn(t):t}function wn(e){const t=mn(e.mapValue.fields[bn].timestampValue);return new Vr(t.seconds,t.nanos)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class jn{constructor(e,t,s,r,n,i,a,o,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=s,this.host=r,this.ssl=n,this.forceLongPolling=i,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=c}}const kn="(default)";class Sn{constructor(e,t){this.projectId=e,this.database=t||kn}static empty(){return new Sn("","")}get isDefaultDatabase(){return this.database===kn}isEqual(e){return e instanceof Sn&&e.projectId===this.projectId&&e.database===this.database}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const _n="__type__",In="__max__",Cn={},En="__vector__",Tn="value";function An(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?vn(e)?4:function(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===In}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(e)?9007199254740991:function(e){var t,s;const r=null==(s=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[_n])?void 0:s.stringValue;return r===En}(e)?10:11:rr(28295,{value:e})}function Pn(e,t){if(e===t)return!0;const s=An(e);if(s!==An(t))return!1;switch(s){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return wn(e).isEqual(wn(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const s=mn(e.timestampValue),r=mn(t.timestampValue);return s.seconds===r.seconds&&s.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return r=t,gn(e.bytesValue).isEqual(gn(r.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return pn(e.geoPointValue.latitude)===pn(t.geoPointValue.latitude)&&pn(e.geoPointValue.longitude)===pn(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return pn(e.integerValue)===pn(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const s=pn(e.doubleValue),r=pn(t.doubleValue);return s===r?Yr(s)===Yr(r):isNaN(s)&&isNaN(r)}return!1}(e,t);case 9:return jr(e.arrayValue.values||[],t.arrayValue.values||[],Pn);case 10:case 11:return function(e,t){const s=e.mapValue.fields||{},r=t.mapValue.fields||{};if(en(s)!==en(r))return!1;for(const n in s)if(s.hasOwnProperty(n)&&(void 0===r[n]||!Pn(s[n],r[n])))return!1;return!0}(e,t);default:return rr(52216,{left:e})}var r}function Dn(e,t){return void 0!==(e.values||[]).find(e=>Pn(e,t))}function Rn(e,t){if(e===t)return 0;const s=An(e),r=An(t);if(s!==r)return vr(s,r);switch(s){case 0:case 9007199254740991:return 0;case 1:return vr(e.booleanValue,t.booleanValue);case 2:return function(e,t){const s=pn(e.integerValue||e.doubleValue),r=pn(t.integerValue||t.doubleValue);return s<r?-1:s>r?1:s===r?0:isNaN(s)?isNaN(r)?0:-1:1}(e,t);case 3:return On(e.timestampValue,t.timestampValue);case 4:return On(wn(e),wn(t));case 5:return Nr(e.stringValue,t.stringValue);case 6:return function(e,t){const s=gn(e),r=gn(t);return s.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const s=e.split("/"),r=t.split("/");for(let n=0;n<s.length&&n<r.length;n++){const e=vr(s[n],r[n]);if(0!==e)return e}return vr(s.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const s=vr(pn(e.latitude),pn(t.latitude));return 0!==s?s:vr(pn(e.longitude),pn(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return Ln(e.arrayValue,t.arrayValue);case 10:return function(e,t){var s,r,n,i;const a=e.fields||{},o=t.fields||{},l=null==(s=a[Tn])?void 0:s.arrayValue,c=null==(r=o[Tn])?void 0:r.arrayValue,d=vr((null==(n=null==l?void 0:l.values)?void 0:n.length)||0,(null==(i=null==c?void 0:c.values)?void 0:i.length)||0);return 0!==d?d:Ln(l,c)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===Cn&&t===Cn)return 0;if(e===Cn)return 1;if(t===Cn)return-1;const s=e.fields||{},r=Object.keys(s),n=t.fields||{},i=Object.keys(n);r.sort(),i.sort();for(let a=0;a<r.length&&a<i.length;++a){const e=Nr(r[a],i[a]);if(0!==e)return e;const t=Rn(s[r[a]],n[i[a]]);if(0!==t)return t}return vr(r.length,i.length)}(e.mapValue,t.mapValue);default:throw rr(23264,{he:s})}}function On(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return vr(e,t);const s=mn(e),r=mn(t),n=vr(s.seconds,r.seconds);return 0!==n?n:vr(s.nanos,r.nanos)}function Ln(e,t){const s=e.values||[],r=t.values||[];for(let n=0;n<s.length&&n<r.length;++n){const e=Rn(s[n],r[n]);if(e)return e}return vr(s.length,r.length)}function Fn(e){return Mn(e)}function Mn(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=mn(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?gn(e.bytesValue).toBase64():"referenceValue"in e?function(e){return Er.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",s=!0;for(const r of e.values||[])s?s=!1:t+=",",t+=Mn(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let s="{",r=!0;for(const n of t)r?r=!1:s+=",",s+=`${n}:${Mn(e.fields[n])}`;return s+"}"}(e.mapValue):rr(61005,{value:e})}function Un(e){switch(An(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=Nn(e);return t?16+Un(t):16;case 5:return 2*e.stringValue.length;case 6:return gn(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return(e.arrayValue.values||[]).reduce((e,t)=>e+Un(t),0);case 10:case 11:return function(e){let t=0;return tn(e.fields,(e,s)=>{t+=e.length+Un(s)}),t}(e.mapValue);default:throw rr(13486,{value:e})}}function Vn(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Bn(e){return!!e&&"integerValue"in e}function zn(e){return!!e&&"arrayValue"in e}function $n(e){return!!e&&"nullValue"in e}function qn(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Kn(e){return!!e&&"mapValue"in e}function Hn(e){if(e.geoPointValue)return{geoPointValue:d({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:d({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return tn(e.mapValue.fields,(e,s)=>t.mapValue.fields[e]=Hn(s)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let s=0;s<(e.arrayValue.values||[]).length;++s)t.arrayValue.values[s]=Hn(e.arrayValue.values[s]);return t}return d({},e)}class Gn{constructor(e){this.value=e}static empty(){return new Gn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let s=0;s<e.length-1;++s)if(t=(t.mapValue.fields||{})[e.get(s)],!Kn(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Hn(t)}setAll(e){let t=Cr.emptyPath(),s={},r=[];e.forEach((e,n)=>{if(!t.isImmediateParentOf(n)){const e=this.getFieldsMap(t);this.applyChanges(e,s,r),s={},r=[],t=n.popLast()}e?s[n.lastSegment()]=Hn(e):r.push(n.lastSegment())});const n=this.getFieldsMap(t);this.applyChanges(n,s,r)}delete(e){const t=this.field(e.popLast());Kn(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Pn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let s=0;s<e.length;++s){let r=t.mapValue.fields[e.get(s)];Kn(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(s)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,s){tn(t,(t,s)=>e[t]=s);for(const r of s)delete e[r]}clone(){return new Gn(Hn(this.value))}}function Wn(e){const t=[];return tn(e.fields,(e,s)=>{const r=new Cr([e]);if(Kn(s)){const e=Wn(s.mapValue).fields;if(0===e.length)t.push(r);else for(const s of e)t.push(r.child(s))}else t.push(r)}),new cn(t)
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */}class Jn{constructor(e,t,s,r,n,i,a){this.key=e,this.documentType=t,this.version=s,this.readTime=r,this.createTime=n,this.data=i,this.documentState=a}static newInvalidDocument(e){return new Jn(e,0,Br.min(),Br.min(),Br.min(),Gn.empty(),0)}static newFoundDocument(e,t,s,r){return new Jn(e,1,t,Br.min(),s,r,0)}static newNoDocument(e,t){return new Jn(e,2,t,Br.min(),Br.min(),Gn.empty(),0)}static newUnknownDocument(e,t){return new Jn(e,3,t,Br.min(),Br.min(),Gn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Br.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Gn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Gn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Br.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Jn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Jn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Qn{constructor(e,t){this.position=e,this.inclusive=t}}function Yn(e,t,s){let r=0;for(let n=0;n<e.position.length;n++){const i=t[n],a=e.position[n];if(r=i.field.isKeyField()?Er.comparator(Er.fromName(a.referenceValue),s.key):Rn(a,s.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function Xn(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let s=0;s<e.position.length;s++)if(!Pn(e.position[s],t.position[s]))return!1;return!0}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Zn{constructor(e,t="asc"){this.field=e,this.dir=t}}function ei(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class ti{}class si extends ti{constructor(e,t,s){super(),this.field=e,this.op=t,this.value=s}static create(e,t,s){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,s):new ci(e,t,s):"array-contains"===t?new mi(e,s):"in"===t?new pi(e,s):"not-in"===t?new gi(e,s):"array-contains-any"===t?new fi(e,s):new si(e,t,s)}static createKeyFieldInFilter(e,t,s){return"in"===t?new di(e,s):new ui(e,s)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(Rn(t,this.value)):null!==t&&An(this.value)===An(t)&&this.matchesComparison(Rn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return rr(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ri extends ti{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new ri(e,t)}matches(e){return ni(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function ni(e){return"and"===e.op}function ii(e){return function(e){for(const t of e.filters)if(t instanceof ri)return!1;return!0}(e)&&ni(e)}function ai(e){if(e instanceof si)return e.field.canonicalString()+e.op.toString()+Fn(e.value);if(ii(e))return e.filters.map(e=>ai(e)).join(",");{const t=e.filters.map(e=>ai(e)).join(",");return`${e.op}(${t})`}}function oi(e,t){return e instanceof si?(s=e,(r=t)instanceof si&&s.op===r.op&&s.field.isEqual(r.field)&&Pn(s.value,r.value)):e instanceof ri?function(e,t){return t instanceof ri&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,s,r)=>e&&oi(s,t.filters[r]),!0)}(e,t):void rr(19439);var s,r}function li(e){return e instanceof si?`${(t=e).field.canonicalString()} ${t.op} ${Fn(t.value)}`:e instanceof ri?function(e){return e.op.toString()+" {"+e.getFilters().map(li).join(" ,")+"}"}(e):"Filter";var t}class ci extends si{constructor(e,t,s){super(e,t,s),this.key=Er.fromName(s.referenceValue)}matches(e){const t=Er.comparator(e.key,this.key);return this.matchesComparison(t)}}class di extends si{constructor(e,t){super(e,"in",t),this.keys=hi(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class ui extends si{constructor(e,t){super(e,"not-in",t),this.keys=hi(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function hi(e,t){var s;return((null==(s=t.arrayValue)?void 0:s.values)||[]).map(e=>Er.fromName(e.referenceValue))}class mi extends si{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return zn(t)&&Dn(t.arrayValue,this.value)}}class pi extends si{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Dn(this.value.arrayValue,t)}}class gi extends si{constructor(e,t){super(e,"not-in",t)}matches(e){if(Dn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!Dn(this.value.arrayValue,t)}}class fi extends si{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!zn(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>Dn(this.value.arrayValue,e))}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class xi{constructor(e,t=null,s=[],r=[],n=null,i=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=s,this.filters=r,this.limit=n,this.startAt=i,this.endAt=a,this.Te=null}}function yi(e,t=null,s=[],r=[],n=null,i=null,a=null){return new xi(e,t,s,r,n,i,a)}function bi(e){const t=ar(e);if(null===t.Te){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>ai(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>{return(t=e).field.canonicalString()+t.dir;var t}).join(","),Qr(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>Fn(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>Fn(e)).join(",")),t.Te=e}return t.Te}function vi(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let s=0;s<e.orderBy.length;s++)if(!ei(e.orderBy[s],t.orderBy[s]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let s=0;s<e.filters.length;s++)if(!oi(e.filters[s],t.filters[s]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Xn(e.startAt,t.startAt)&&Xn(e.endAt,t.endAt)}function Ni(e){return Er.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class wi{constructor(e,t=null,s=[],r=[],n=null,i="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=s,this.filters=r,this.limit=n,this.limitType=i,this.startAt=a,this.endAt=o,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function ji(e){return new wi(e)}function ki(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Si(e){return null!==e.collectionGroup}function _i(e){const t=ar(e);if(null===t.Ie){t.Ie=[];const e=new Set;for(const r of t.explicitOrderBy)t.Ie.push(r),e.add(r.field.canonicalString());const s=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(e){let t=new on(Cr.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t})(t).forEach(r=>{e.has(r.canonicalString())||r.isKeyField()||t.Ie.push(new Zn(r,s))}),e.has(Cr.keyField().canonicalString())||t.Ie.push(new Zn(Cr.keyField(),s))}return t.Ie}function Ii(e){const t=ar(e);return t.Ee||(t.Ee=function(e,t){if("F"===e.limitType)return yi(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new Zn(e.field,t)});const s=e.endAt?new Qn(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new Qn(e.startAt.position,e.startAt.inclusive):null;return yi(e.path,e.collectionGroup,t,e.filters,e.limit,s,r)}}(t,_i(e))),t.Ee}function Ci(e,t){const s=e.filters.concat([t]);return new wi(e.path,e.collectionGroup,e.explicitOrderBy.slice(),s,e.limit,e.limitType,e.startAt,e.endAt)}function Ei(e,t,s){return new wi(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,s,e.startAt,e.endAt)}function Ti(e,t){return vi(Ii(e),Ii(t))&&e.limitType===t.limitType}function Ai(e){return`${bi(Ii(e))}|lt:${e.limitType}`}function Pi(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>li(e)).join(", ")}]`),Qr(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>{return`${(t=e).field.canonicalString()} (${t.dir})`;var t}).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>Fn(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>Fn(e)).join(",")),`Target(${t})`}(Ii(e))}; limitType=${e.limitType})`}function Di(e,t){return t.isFoundDocument()&&function(e,t){const s=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(s):Er.isDocumentKey(e.path)?e.path.isEqual(s):e.path.isImmediateParentOf(s)}(e,t)&&function(e,t){for(const s of _i(e))if(!s.field.isKeyField()&&null===t.data.field(s.field))return!1;return!0}(e,t)&&function(e,t){for(const s of e.filters)if(!s.matches(t))return!1;return!0}(e,t)&&(r=t,!((s=e).startAt&&!function(e,t,s){const r=Yn(e,t,s);return e.inclusive?r<=0:r<0}(s.startAt,_i(s),r)||s.endAt&&!function(e,t,s){const r=Yn(e,t,s);return e.inclusive?r>=0:r>0}(s.endAt,_i(s),r)));var s,r}function Ri(e){return(t,s)=>{let r=!1;for(const n of _i(e)){const e=Oi(n,t,s);if(0!==e)return e;r=r||n.field.isKeyField()}return 0}}function Oi(e,t,s){const r=e.field.isKeyField()?Er.comparator(t.key,s.key):function(e,t,s){const r=t.data.field(e),n=s.data.field(e);return null!==r&&null!==n?Rn(r,n):rr(42886)}(e.field,t,s);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return rr(19790,{direction:e.dir})}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Li{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),s=this.inner[t];if(void 0!==s)for(const[r,n]of s)if(this.equalsFn(r,e))return n}has(e){return void 0!==this.get(e)}set(e,t){const s=this.mapKeyFn(e),r=this.inner[s];if(void 0===r)return this.inner[s]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),s=this.inner[t];if(void 0===s)return!1;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return 1===s.length?delete this.inner[t]:s.splice(r,1),this.innerSize--,!0;return!1}forEach(e){tn(this.inner,(t,s)=>{for(const[r,n]of s)e(r,n)})}isEmpty(){return sn(this.inner)}size(){return this.innerSize}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Fi=new rn(Er.comparator);function Mi(){return Fi}const Ui=new rn(Er.comparator);function Vi(...e){let t=Ui;for(const s of e)t=t.insert(s.key,s);return t}function Bi(e){let t=Ui;return e.forEach((e,s)=>t=t.insert(e,s.overlayedDocument)),t}function zi(){return qi()}function $i(){return qi()}function qi(){return new Li(e=>e.toString(),(e,t)=>e.isEqual(t))}const Ki=new rn(Er.comparator),Hi=new on(Er.comparator);function Gi(...e){let t=Hi;for(const s of e)t=t.add(s);return t}const Wi=new on(vr);
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function Ji(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Yr(t)?"-0":t}}function Qi(e){return{integerValue:""+e}}function Yi(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!Yr(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(t)?Qi(t):Ji(e,t)}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Xi{constructor(){this._=void 0}}function Zi(e,t,s){return e instanceof sa?function(e,t){const s={fields:{[xn]:{stringValue:fn},[bn]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&vn(t)&&(t=Nn(t)),t&&(s.fields[yn]=t),{mapValue:s}}(s,t):e instanceof ra?na(e,t):e instanceof ia?aa(e,t):function(e,t){const s=ta(e,t),r=la(s)+la(e.Ae);return Bn(s)&&Bn(e.Ae)?Qi(r):Ji(e.serializer,r)}(e,t)}function ea(e,t,s){return e instanceof ra?na(e,t):e instanceof ia?aa(e,t):s}function ta(e,t){return e instanceof oa?Bn(s=t)||(r=s)&&"doubleValue"in r?t:{integerValue:0}:null;var s,r}class sa extends Xi{}class ra extends Xi{constructor(e){super(),this.elements=e}}function na(e,t){const s=ca(t);for(const r of e.elements)s.some(e=>Pn(e,r))||s.push(r);return{arrayValue:{values:s}}}class ia extends Xi{constructor(e){super(),this.elements=e}}function aa(e,t){let s=ca(t);for(const r of e.elements)s=s.filter(e=>!Pn(e,r));return{arrayValue:{values:s}}}class oa extends Xi{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function la(e){return pn(e.integerValue||e.doubleValue)}function ca(e){return zn(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class da{constructor(e,t){this.version=e,this.transformResults=t}}class ua{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ua}static exists(e){return new ua(void 0,e)}static updateTime(e){return new ua(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ha(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class ma{}function pa(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new ka(e.key,ua.none()):new ba(e.key,e.data,ua.none());{const s=e.data,r=Gn.empty();let n=new on(Cr.comparator);for(let e of t.fields)if(!n.has(e)){let t=s.field(e);null===t&&e.length>1&&(e=e.popLast(),t=s.field(e)),null===t?r.delete(e):r.set(e,t),n=n.add(e)}return new va(e.key,r,new cn(n.toArray()),ua.none())}}function ga(e,t,s){var r;e instanceof ba?function(e,t,s){const r=e.value.clone(),n=wa(e.fieldTransforms,t,s.transformResults);r.setAll(n),t.convertToFoundDocument(s.version,r).setHasCommittedMutations()}(e,t,s):e instanceof va?function(e,t,s){if(!ha(e.precondition,t))return void t.convertToUnknownDocument(s.version);const r=wa(e.fieldTransforms,t,s.transformResults),n=t.data;n.setAll(Na(e)),n.setAll(r),t.convertToFoundDocument(s.version,n).setHasCommittedMutations()}(e,t,s):(r=s,t.convertToNoDocument(r.version).setHasCommittedMutations())}function fa(e,t,s,r){return e instanceof ba?function(e,t,s,r){if(!ha(e.precondition,t))return s;const n=e.value.clone(),i=ja(e.fieldTransforms,r,t);return n.setAll(i),t.convertToFoundDocument(t.version,n).setHasLocalMutations(),null}(e,t,s,r):e instanceof va?function(e,t,s,r){if(!ha(e.precondition,t))return s;const n=ja(e.fieldTransforms,r,t),i=t.data;return i.setAll(Na(e)),i.setAll(n),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null===s?null:s.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,s,r):(n=t,i=s,ha(e.precondition,n)?(n.convertToNoDocument(n.version).setHasLocalMutations(),null):i);var n,i}function xa(e,t){let s=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),n=ta(r.transform,e||null);null!=n&&(null===s&&(s=Gn.empty()),s.set(r.field,n))}return s||null}function ya(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(s=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===s&&void 0===r||s&&r&&jr(s,r,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&(s=e.transform,r=t.transform,s instanceof ra&&r instanceof ra||s instanceof ia&&r instanceof ia?jr(s.elements,r.elements,Pn):s instanceof oa&&r instanceof oa?Pn(s.Ae,r.Ae):s instanceof sa&&r instanceof sa);var s,r}(e,t)))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask)));var s,r}class ba extends ma{constructor(e,t,s,r=[]){super(),this.key=e,this.value=t,this.precondition=s,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class va extends ma{constructor(e,t,s,r,n=[]){super(),this.key=e,this.data=t,this.fieldMask=s,this.precondition=r,this.fieldTransforms=n,this.type=1}getFieldMask(){return this.fieldMask}}function Na(e){const t=new Map;return e.fieldMask.fields.forEach(s=>{if(!s.isEmpty()){const r=e.data.field(s);t.set(s,r)}}),t}function wa(e,t,s){const r=new Map;ir(e.length===s.length,32656,{Re:s.length,Ve:e.length});for(let n=0;n<s.length;n++){const i=e[n],a=i.transform,o=t.data.field(i.field);r.set(i.field,ea(a,o,s[n]))}return r}function ja(e,t,s){const r=new Map;for(const n of e){const e=n.transform,i=s.data.field(n.field);r.set(n.field,Zi(e,i,t))}return r}class ka extends ma{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Sa extends ma{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class _a{constructor(e,t,s,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=s,this.mutations=r}applyToRemoteDocument(e,t){const s=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const t=this.mutations[r];t.key.isEqual(e.key)&&ga(t,e,s[r])}}applyToLocalView(e,t){for(const s of this.baseMutations)s.key.isEqual(e.key)&&(t=fa(s,e,t,this.localWriteTime));for(const s of this.mutations)s.key.isEqual(e.key)&&(t=fa(s,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const s=$i();return this.mutations.forEach(r=>{const n=e.get(r.key),i=n.overlayedDocument;let a=this.applyToLocalView(i,n.mutatedFields);a=t.has(r.key)?null:a;const o=pa(i,a);null!==o&&s.set(r.key,o),i.isValidDocument()||i.convertToNoDocument(Br.min())}),s}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Gi())}isEqual(e){return this.batchId===e.batchId&&jr(this.mutations,e.mutations,(e,t)=>ya(e,t))&&jr(this.baseMutations,e.baseMutations,(e,t)=>ya(e,t))}}class Ia{constructor(e,t,s,r){this.batch=e,this.commitVersion=t,this.mutationResults=s,this.docVersions=r}static from(e,t,s){ir(e.mutations.length===s.length,58842,{me:e.mutations.length,fe:s.length});let r=function(){return Ki}();const n=e.mutations;for(let i=0;i<n.length;i++)r=r.insert(n[i].key,s[i].version);return new Ia(e,t,s,r)}}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ca{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ea{constructor(e,t){this.count=e,this.unchangedNames=t}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var Ta,Aa;function Pa(e){if(void 0===e)return er("GRPC error has no .code"),or.UNKNOWN;switch(e){case Ta.OK:return or.OK;case Ta.CANCELLED:return or.CANCELLED;case Ta.UNKNOWN:return or.UNKNOWN;case Ta.DEADLINE_EXCEEDED:return or.DEADLINE_EXCEEDED;case Ta.RESOURCE_EXHAUSTED:return or.RESOURCE_EXHAUSTED;case Ta.INTERNAL:return or.INTERNAL;case Ta.UNAVAILABLE:return or.UNAVAILABLE;case Ta.UNAUTHENTICATED:return or.UNAUTHENTICATED;case Ta.INVALID_ARGUMENT:return or.INVALID_ARGUMENT;case Ta.NOT_FOUND:return or.NOT_FOUND;case Ta.ALREADY_EXISTS:return or.ALREADY_EXISTS;case Ta.PERMISSION_DENIED:return or.PERMISSION_DENIED;case Ta.FAILED_PRECONDITION:return or.FAILED_PRECONDITION;case Ta.ABORTED:return or.ABORTED;case Ta.OUT_OF_RANGE:return or.OUT_OF_RANGE;case Ta.UNIMPLEMENTED:return or.UNIMPLEMENTED;case Ta.DATA_LOSS:return or.DATA_LOSS;default:return rr(39323,{code:e})}}(Aa=Ta||(Ta={}))[Aa.OK=0]="OK",Aa[Aa.CANCELLED=1]="CANCELLED",Aa[Aa.UNKNOWN=2]="UNKNOWN",Aa[Aa.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Aa[Aa.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Aa[Aa.NOT_FOUND=5]="NOT_FOUND",Aa[Aa.ALREADY_EXISTS=6]="ALREADY_EXISTS",Aa[Aa.PERMISSION_DENIED=7]="PERMISSION_DENIED",Aa[Aa.UNAUTHENTICATED=16]="UNAUTHENTICATED",Aa[Aa.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Aa[Aa.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Aa[Aa.ABORTED=10]="ABORTED",Aa[Aa.OUT_OF_RANGE=11]="OUT_OF_RANGE",Aa[Aa.UNIMPLEMENTED=12]="UNIMPLEMENTED",Aa[Aa.INTERNAL=13]="INTERNAL",Aa[Aa.UNAVAILABLE=14]="UNAVAILABLE",Aa[Aa.DATA_LOSS=15]="DATA_LOSS";
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const Da=new Os([4294967295,4294967295],0);function Ra(e){const t=(new TextEncoder).encode(e),s=new Ls;return s.update(t),new Uint8Array(s.digest())}function Oa(e){const t=new DataView(e.buffer),s=t.getUint32(0,!0),r=t.getUint32(4,!0),n=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new Os([s,r],0),new Os([n,i],0)]}class La{constructor(e,t,s){if(this.bitmap=e,this.padding=t,this.hashCount=s,t<0||t>=8)throw new Fa(`Invalid padding: ${t}`);if(s<0)throw new Fa(`Invalid hash count: ${s}`);if(e.length>0&&0===this.hashCount)throw new Fa(`Invalid hash count: ${s}`);if(0===e.length&&0!==t)throw new Fa(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=Os.fromNumber(this.ge)}ye(e,t,s){let r=e.add(t.multiply(Os.fromNumber(s)));return 1===r.compare(Da)&&(r=new Os([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;const t=Ra(e),[s,r]=Oa(t);for(let n=0;n<this.hashCount;n++){const e=this.ye(s,r,n);if(!this.we(e))return!1}return!0}static create(e,t,s){const r=e%8==0?0:8-e%8,n=new Uint8Array(Math.ceil(e/8)),i=new La(n,r,t);return s.forEach(e=>i.insert(e)),i}insert(e){if(0===this.ge)return;const t=Ra(e),[s,r]=Oa(t);for(let n=0;n<this.hashCount;n++){const e=this.ye(s,r,n);this.Se(e)}}Se(e){const t=Math.floor(e/8),s=e%8;this.bitmap[t]|=1<<s}}class Fa extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ma{constructor(e,t,s,r,n){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=s,this.documentUpdates=r,this.resolvedLimboDocuments=n}static createSynthesizedRemoteEventForCurrentChange(e,t,s){const r=new Map;return r.set(e,Ua.createSynthesizedTargetChangeForCurrentChange(e,t,s)),new Ma(Br.min(),r,new rn(vr),Mi(),Gi())}}class Ua{constructor(e,t,s,r,n){this.resumeToken=e,this.current=t,this.addedDocuments=s,this.modifiedDocuments=r,this.removedDocuments=n}static createSynthesizedTargetChangeForCurrentChange(e,t,s){return new Ua(s,t,Gi(),Gi(),Gi())}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Va{constructor(e,t,s,r){this.be=e,this.removedTargetIds=t,this.key=s,this.De=r}}class Ba{constructor(e,t){this.targetId=e,this.Ce=t}}class za{constructor(e,t,s=un.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=s,this.cause=r}}class $a{constructor(){this.ve=0,this.Fe=Ha(),this.Me=un.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Gi(),t=Gi(),s=Gi();return this.Fe.forEach((r,n)=>{switch(n){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:s=s.add(r);break;default:rr(38017,{changeType:n})}}),new Ua(this.Me,this.xe,e,t,s)}qe(){this.Oe=!1,this.Fe=Ha()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,ir(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class qa{constructor(e){this.Ge=e,this.ze=new Map,this.je=Mi(),this.Je=Ka(),this.He=Ka(),this.Ye=new rn(vr)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const s=this.nt(t);switch(e.state){case 0:this.rt(t)&&s.Le(e.resumeToken);break;case 1:s.Ke(),s.Ne||s.qe(),s.Le(e.resumeToken);break;case 2:s.Ke(),s.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(s.We(),s.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),s.Le(e.resumeToken));break;default:rr(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,s)=>{this.rt(s)&&t(s)})}st(e){const t=e.targetId,s=e.Ce.count,r=this.ot(t);if(r){const n=r.target;if(Ni(n))if(0===s){const e=new Er(n.path);this.et(t,e,Jn.newNoDocument(e,Br.min()))}else ir(1===s,20013,{expectedCount:s});else{const r=this._t(t);if(r!==s){const s=this.ut(e),n=s?this.ct(s,e,r):1;if(0!==n){this.it(t);const e=2===n?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,e)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:s="",padding:r=0},hashCount:n=0}=t;let i,a;try{i=gn(s).toUint8Array()}catch(o){if(o instanceof dn)return tr("Decoding the base64 bloom filter in existence filter failed ("+o.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw o}try{a=new La(i,r,n)}catch(o){return tr(o instanceof Fa?"BloomFilter error: ":"Applying bloom filter failed: ",o),null}return 0===a.ge?null:a}ct(e,t,s){return t.Ce.count===s-this.Pt(e,t.targetId)?0:2}Pt(e,t){const s=this.Ge.getRemoteKeysForTarget(t);let r=0;return s.forEach(s=>{const n=this.Ge.ht(),i=`projects/${n.projectId}/databases/${n.database}/documents/${s.path.canonicalString()}`;e.mightContain(i)||(this.et(t,s,null),r++)}),r}Tt(e){const t=new Map;this.ze.forEach((s,r)=>{const n=this.ot(r);if(n){if(s.current&&Ni(n.target)){const t=new Er(n.target.path);this.It(t).has(r)||this.Et(r,t)||this.et(r,t,Jn.newNoDocument(t,e))}s.Be&&(t.set(r,s.ke()),s.qe())}});let s=Gi();this.He.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{const t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(s=s.add(e))}),this.je.forEach((t,s)=>s.setReadTime(e));const r=new Ma(e,t,this.Ye,this.je,s);return this.je=Mi(),this.Je=Ka(),this.He=Ka(),this.Ye=new rn(vr),r}Xe(e,t){if(!this.rt(e))return;const s=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,s),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,s){if(!this.rt(e))return;const r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),s&&(this.je=this.je.insert(t,s))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new $a,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new on(vr),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new on(vr),this.Je=this.Je.insert(e,t)),t}rt(e){const t=null!==this.ot(e);return t||Zs("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new $a),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function Ka(){return new rn(Er.comparator)}function Ha(){return new rn(Er.comparator)}const Ga=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),Wa=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),Ja=(()=>({and:"AND",or:"OR"}))();class Qa{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Ya(e,t){return e.useProto3Json||Qr(t)?t:{value:t}}function Xa(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Za(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function eo(e,t){return Xa(e,t.toTimestamp())}function to(e){return ir(!!e,49232),Br.fromTimestamp(function(e){const t=mn(e);return new Vr(t.seconds,t.nanos)}(e))}function so(e,t){return ro(e,t).canonicalString()}function ro(e,t){const s=(r=e,new _r(["projects",r.projectId,"databases",r.database])).child("documents");var r;return void 0===t?s:s.child(t)}function no(e){const t=_r.fromString(e);return ir(jo(t),10190,{key:t.toString()}),t}function io(e,t){return so(e.databaseId,t.path)}function ao(e,t){const s=no(t);if(s.get(1)!==e.databaseId.projectId)throw new lr(or.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+s.get(1)+" vs "+e.databaseId.projectId);if(s.get(3)!==e.databaseId.database)throw new lr(or.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+s.get(3)+" vs "+e.databaseId.database);return new Er(co(s))}function oo(e,t){return so(e.databaseId,t)}function lo(e){return new _r(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function co(e){return ir(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function uo(e,t,s){return{name:io(e,t),fields:s.value.mapValue.fields}}function ho(e,t){return{documents:[oo(e,t.path)]}}function mo(e,t){const s={structuredQuery:{}},r=t.path;let n;null!==t.collectionGroup?(n=r,s.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n=r.popLast(),s.structuredQuery.from=[{collectionId:r.lastSegment()}]),s.parent=oo(e,n);const i=function(e){if(0!==e.length)return No(ri.create(e,"and"))}(t.filters);i&&(s.structuredQuery.where=i);const a=function(e){if(0!==e.length)return e.map(e=>{return{field:bo((t=e).field),direction:fo(t.dir)};var t})}(t.orderBy);a&&(s.structuredQuery.orderBy=a);const o=Ya(e,t.limit);return null!==o&&(s.structuredQuery.limit=o),t.startAt&&(s.structuredQuery.startAt={before:(l=t.startAt).inclusive,values:l.position}),t.endAt&&(s.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ft:s,parent:n};var l}function po(e){let t=function(e){const t=no(e);return 4===t.length?_r.emptyPath():co(t)}(e.parent);const s=e.structuredQuery,r=s.from?s.from.length:0;let n=null;if(r>0){ir(1===r,65062);const e=s.from[0];e.allDescendants?n=e.collectionId:t=t.child(e.collectionId)}let i=[];s.where&&(i=function(e){const t=go(e);return t instanceof ri&&ii(t)?t.getFilters():[t]}(s.where));let a=[];s.orderBy&&(a=s.orderBy.map(e=>{return new Zn(vo((t=e).field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction));var t}));let o=null;s.limit&&(o=function(e){let t;return t="object"==typeof e?e.value:e,Qr(t)?null:t}(s.limit));let l=null;s.startAt&&(l=function(e){const t=!!e.before,s=e.values||[];return new Qn(s,t)}(s.startAt));let c=null;return s.endAt&&(c=function(e){const t=!e.before,s=e.values||[];return new Qn(s,t)}(s.endAt)),function(e,t,s,r,n,i,a,o){return new wi(e,t,s,r,n,i,a,o)}(t,n,a,i,o,"F",l,c)}function go(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=vo(e.unaryFilter.field);return si.create(t,"==",{doubleValue:NaN});case"IS_NULL":const s=vo(e.unaryFilter.field);return si.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=vo(e.unaryFilter.field);return si.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const n=vo(e.unaryFilter.field);return si.create(n,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return rr(61313);default:return rr(60726)}}(e):void 0!==e.fieldFilter?(t=e,si.create(vo(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return rr(58110);default:return rr(50506)}}(t.fieldFilter.op),t.fieldFilter.value)):void 0!==e.compositeFilter?function(e){return ri.create(e.compositeFilter.filters.map(e=>go(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return rr(1026)}}(e.compositeFilter.op))}(e):rr(30097,{filter:e});var t}function fo(e){return Ga[e]}function xo(e){return Wa[e]}function yo(e){return Ja[e]}function bo(e){return{fieldPath:e.canonicalString()}}function vo(e){return Cr.fromServerFormat(e.fieldPath)}function No(e){return e instanceof si?function(e){if("=="===e.op){if(qn(e.value))return{unaryFilter:{field:bo(e.field),op:"IS_NAN"}};if($n(e.value))return{unaryFilter:{field:bo(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(qn(e.value))return{unaryFilter:{field:bo(e.field),op:"IS_NOT_NAN"}};if($n(e.value))return{unaryFilter:{field:bo(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:bo(e.field),op:xo(e.op),value:e.value}}}(e):e instanceof ri?function(e){const t=e.getFilters().map(e=>No(e));return 1===t.length?t[0]:{compositeFilter:{op:yo(e.op),filters:t}}}(e):rr(54877,{filter:e})}function wo(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function jo(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class ko{constructor(e,t,s,r,n=Br.min(),i=Br.min(),a=un.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=s,this.sequenceNumber=r,this.snapshotVersion=n,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new ko(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ko(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ko(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ko(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class So{constructor(e){this.yt=e}}function _o(e){const t=po({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Ei(t,t.limit,"L"):t}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Io{constructor(){this.Cn=new Co}addToCollectionParentIndex(e,t){return this.Cn.add(t),Gr.resolve()}getCollectionParents(e,t){return Gr.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return Gr.resolve()}deleteFieldIndex(e,t){return Gr.resolve()}deleteAllFieldIndexes(e){return Gr.resolve()}createTargetIndexes(e,t){return Gr.resolve()}getDocumentsMatchingTarget(e,t){return Gr.resolve(null)}getIndexType(e,t){return Gr.resolve(0)}getFieldIndexes(e,t){return Gr.resolve([])}getNextCollectionGroupToUpdate(e){return Gr.resolve(null)}getMinOffset(e,t){return Gr.resolve($r.min())}getMinOffsetFromCollectionGroup(e,t){return Gr.resolve($r.min())}updateCollectionGroup(e,t,s){return Gr.resolve()}updateIndexEntries(e,t){return Gr.resolve()}}class Co{constructor(){this.index={}}add(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t]||new on(_r.comparator),n=!r.has(s);return this.index[t]=r.add(s),n}has(e){const t=e.lastSegment(),s=e.popLast(),r=this.index[t];return r&&r.has(s)}getEntries(e){return(this.index[e]||new on(_r.comparator)).toArray()}}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Eo={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},To=41943040;class Ao{static withCacheSize(e){return new Ao(e,Ao.DEFAULT_COLLECTION_PERCENTILE,Ao.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,s){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=s}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */Ao.DEFAULT_COLLECTION_PERCENTILE=10,Ao.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ao.DEFAULT=new Ao(To,Ao.DEFAULT_COLLECTION_PERCENTILE,Ao.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ao.DISABLED=new Ao(-1,0,0);
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Po{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Po(0)}static cr(){return new Po(-1)}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Do="LruGarbageCollector";function Ro([e,t],[s,r]){const n=vr(e,s);return 0===n?vr(t,r):n}class Oo{constructor(e){this.Ir=e,this.buffer=new on(Ro),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Ro(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Lo{constructor(e,t,s){this.garbageCollector=e,this.asyncQueue=t,this.localStore=s,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){Zs(Do,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>g(this,null,function*(){this.Rr=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){Wr(e)?Zs(Do,"Ignoring IndexedDB error during garbage collection: ",e):yield Hr(e)}yield this.Vr(3e5)}))}}class Fo{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return Gr.resolve(Jr.ce);const s=new Oo(t);return this.mr.forEachTarget(e,e=>s.Ar(e.sequenceNumber)).next(()=>this.mr.pr(e,e=>s.Ar(e))).next(()=>s.maxValue)}removeTargets(e,t,s){return this.mr.removeTargets(e,t,s)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(Zs("LruGarbageCollector","Garbage collection skipped; disabled"),Gr.resolve(Eo)):this.getCacheSize(e).next(s=>s<this.params.cacheSizeCollectionThreshold?(Zs("LruGarbageCollector",`Garbage collection skipped; Cache size ${s} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Eo):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let s,r,n,i,a,o,l;const c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(Zs("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,i=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(s=r,a=Date.now(),this.removeTargets(e,s,t))).next(t=>(n=t,o=Date.now(),this.removeOrphanedDocuments(e,s))).next(e=>(l=Date.now(),Xs()<=dt.DEBUG&&Zs("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-c}ms\n\tDetermined least recently used ${r} in `+(a-i)+`ms\n\tRemoved ${n} targets in `+(o-a)+`ms\n\tRemoved ${e} documents in `+(l-o)+`ms\nTotal Duration: ${l-c}ms`),Gr.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:n,documentsRemoved:e})))}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Mo{constructor(){this.changes=new Li(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Jn.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const s=this.changes.get(t);return void 0!==s?Gr.resolve(s):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Uo{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Vo{constructor(e,t,s,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=s,this.indexManager=r}getDocument(e,t){let s=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(s=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==s&&fa(s.mutation,e,cn.empty(),Vr.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,Gi()).next(()=>t))}getLocalViewOfDocuments(e,t,s=Gi()){const r=zi();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,s).next(e=>{let t=Vi();return e.forEach((e,s)=>{t=t.insert(e,s.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const s=zi();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,Gi()))}populateOverlays(e,t,s){const r=[];return s.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,s)=>{t.set(e,s)})})}computeViews(e,t,s,r){let n=Mi();const i=qi(),a=qi();return t.forEach((e,t)=>{const a=s.get(t.key);r.has(t.key)&&(void 0===a||a.mutation instanceof va)?n=n.insert(t.key,t):void 0!==a?(i.set(t.key,a.mutation.getFieldMask()),fa(a.mutation,t,a.mutation.getFieldMask(),Vr.now())):i.set(t.key,cn.empty())}),this.recalculateAndSaveOverlays(e,n).next(e=>(e.forEach((e,t)=>i.set(e,t)),t.forEach((e,t)=>{var s;return a.set(e,new Uo(t,null!=(s=i.get(e))?s:null))}),a))}recalculateAndSaveOverlays(e,t){const s=qi();let r=new rn((e,t)=>e-t),n=Gi();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const n of e)n.keys().forEach(e=>{const i=t.get(e);if(null===i)return;let a=s.get(e)||cn.empty();a=n.applyToLocalView(i,a),s.set(e,a);const o=(r.get(n.batchId)||Gi()).add(e);r=r.insert(n.batchId,o)})}).next(()=>{const i=[],a=r.getReverseIterator();for(;a.hasNext();){const r=a.getNext(),o=r.key,l=r.value,c=$i();l.forEach(e=>{if(!n.has(e)){const r=pa(t.get(e),s.get(e));null!==r&&c.set(e,r),n=n.add(e)}}),i.push(this.documentOverlayCache.saveOverlays(e,o,c))}return Gr.waitFor(i)}).next(()=>s)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,s,r){return n=t,Er.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Si(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,s,r):this.getDocumentsMatchingCollectionQuery(e,t,s,r);var n}getNextDocuments(e,t,s,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,s,r).next(n=>{const i=r-n.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,s.largestBatchId,r-n.size):Gr.resolve(zi());let a=-1,o=n;return i.next(t=>Gr.forEach(t,(t,s)=>(a<s.largestBatchId&&(a=s.largestBatchId),n.get(t)?Gr.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)}))).next(()=>this.populateOverlays(e,t,n)).next(()=>this.computeViews(e,o,t,Gi())).next(e=>({batchId:a,changes:Bi(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Er(t)).next(e=>{let t=Vi();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,s,r){const n=t.collectionGroup;let i=Vi();return this.indexManager.getCollectionParents(e,n).next(a=>Gr.forEach(a,a=>{const o=(l=t,c=a.child(n),new wi(c,null,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt));var l,c;return this.getDocumentsMatchingCollectionQuery(e,o,s,r).next(e=>{e.forEach((e,t)=>{i=i.insert(e,t)})})}).next(()=>i))}getDocumentsMatchingCollectionQuery(e,t,s,r){let n;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,s.largestBatchId).next(i=>(n=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,s,n,r))).next(e=>{n.forEach((t,s)=>{const r=s.getKey();null===e.get(r)&&(e=e.insert(r,Jn.newInvalidDocument(r)))});let s=Vi();return e.forEach((e,r)=>{const i=n.get(e);void 0!==i&&fa(i.mutation,r,cn.empty(),Vr.now()),Di(t,r)&&(s=s.insert(e,r))}),s})}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Bo{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return Gr.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,{id:(s=t).id,version:s.version,createTime:to(s.createTime)}),Gr.resolve();var s}getNamedQuery(e,t){return Gr.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,{name:(s=t).name,query:_o(s.bundledQuery),readTime:to(s.readTime)}),Gr.resolve();var s}}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class zo{constructor(){this.overlays=new rn(Er.comparator),this.qr=new Map}getOverlay(e,t){return Gr.resolve(this.overlays.get(t))}getOverlays(e,t){const s=zi();return Gr.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&s.set(t,e)})).next(()=>s)}saveOverlays(e,t,s){return s.forEach((s,r)=>{this.St(e,t,r)}),Gr.resolve()}removeOverlaysForBatchId(e,t,s){const r=this.qr.get(s);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(s)),Gr.resolve()}getOverlaysForCollection(e,t,s){const r=zi(),n=t.length+1,i=new Er(t.child("")),a=this.overlays.getIteratorFrom(i);for(;a.hasNext();){const e=a.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===n&&e.largestBatchId>s&&r.set(e.getKey(),e)}return Gr.resolve(r)}getOverlaysForCollectionGroup(e,t,s,r){let n=new rn((e,t)=>e-t);const i=this.overlays.getIterator();for(;i.hasNext();){const e=i.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>s){let t=n.get(e.largestBatchId);null===t&&(t=zi(),n=n.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const a=zi(),o=n.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=r)););return Gr.resolve(a)}St(e,t,s){const r=this.overlays.get(s.key);if(null!==r){const e=this.qr.get(r.largestBatchId).delete(s.key);this.qr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(s.key,new Ca(t,s));let n=this.qr.get(t);void 0===n&&(n=Gi(),this.qr.set(t,n)),this.qr.set(t,n.add(s.key))}}
/**
     * @license
     * Copyright 2024 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class $o{constructor(){this.sessionToken=un.EMPTY_BYTE_STRING}getSessionToken(e){return Gr.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Gr.resolve()}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class qo{constructor(){this.Qr=new on(Ko.$r),this.Ur=new on(Ko.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const s=new Ko(e,t);this.Qr=this.Qr.add(s),this.Ur=this.Ur.add(s)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new Ko(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){const t=new Er(new _r([])),s=new Ko(t,e),r=new Ko(t,e+1),n=[];return this.Ur.forEachInRange([s,r],e=>{this.Gr(e),n.push(e.key)}),n}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new Er(new _r([])),s=new Ko(t,e),r=new Ko(t,e+1);let n=Gi();return this.Ur.forEachInRange([s,r],e=>{n=n.add(e.key)}),n}containsKey(e){const t=new Ko(e,0),s=this.Qr.firstAfterOrEqual(t);return null!==s&&e.isEqual(s.key)}}class Ko{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return Er.comparator(e.key,t.key)||vr(e.Yr,t.Yr)}static Kr(e,t){return vr(e.Yr,t.Yr)||Er.comparator(e.key,t.key)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ho{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new on(Ko.$r)}checkEmpty(e){return Gr.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,s,r){const n=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new _a(n,t,s,r);this.mutationQueue.push(i);for(const a of r)this.Zr=this.Zr.add(new Ko(a.key,n)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return Gr.resolve(i)}lookupMutationBatch(e,t){return Gr.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const s=t+1,r=this.ei(s),n=r<0?0:r;return Gr.resolve(this.mutationQueue.length>n?this.mutationQueue[n]:null)}getHighestUnacknowledgedBatchId(){return Gr.resolve(0===this.mutationQueue.length?-1:this.tr-1)}getAllMutationBatches(e){return Gr.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const s=new Ko(t,0),r=new Ko(t,Number.POSITIVE_INFINITY),n=[];return this.Zr.forEachInRange([s,r],e=>{const t=this.Xr(e.Yr);n.push(t)}),Gr.resolve(n)}getAllMutationBatchesAffectingDocumentKeys(e,t){let s=new on(vr);return t.forEach(e=>{const t=new Ko(e,0),r=new Ko(e,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([t,r],e=>{s=s.add(e.Yr)})}),Gr.resolve(this.ti(s))}getAllMutationBatchesAffectingQuery(e,t){const s=t.path,r=s.length+1;let n=s;Er.isDocumentKey(n)||(n=n.child(""));const i=new Ko(new Er(n),0);let a=new on(vr);return this.Zr.forEachWhile(e=>{const t=e.key.path;return!!s.isPrefixOf(t)&&(t.length===r&&(a=a.add(e.Yr)),!0)},i),Gr.resolve(this.ti(a))}ti(e){const t=[];return e.forEach(e=>{const s=this.Xr(e);null!==s&&t.push(s)}),t}removeMutationBatch(e,t){ir(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let s=this.Zr;return Gr.forEach(t.mutations,r=>{const n=new Ko(r.key,t.batchId);return s=s.delete(n),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Zr=s})}ir(e){}containsKey(e,t){const s=new Ko(t,0),r=this.Zr.firstAfterOrEqual(s);return Gr.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,Gr.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Go{constructor(e){this.ri=e,this.docs=new rn(Er.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const s=t.key,r=this.docs.get(s),n=r?r.size:0,i=this.ri(t);return this.docs=this.docs.insert(s,{document:t.mutableCopy(),size:i}),this.size+=i-n,this.indexManager.addToCollectionParentIndex(e,s.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const s=this.docs.get(t);return Gr.resolve(s?s.document.mutableCopy():Jn.newInvalidDocument(t))}getEntries(e,t){let s=Mi();return t.forEach(e=>{const t=this.docs.get(e);s=s.insert(e,t?t.document.mutableCopy():Jn.newInvalidDocument(e))}),Gr.resolve(s)}getDocumentsMatchingQuery(e,t,s,r){let n=Mi();const i=t.path,a=new Er(i.child("__id-9223372036854775808__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){const{key:e,value:{document:a}}=o.getNext();if(!i.isPrefixOf(e.path))break;e.path.length>i.length+1||qr(zr(a),s)<=0||(r.has(a.key)||Di(t,a))&&(n=n.insert(a.key,a.mutableCopy()))}return Gr.resolve(n)}getAllFromCollectionGroup(e,t,s,r){rr(9500)}ii(e,t){return Gr.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new Wo(this)}getSize(e){return Gr.resolve(this.size)}}class Wo extends Mo{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((s,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(s)}),Gr.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Jo{constructor(e){this.persistence=e,this.si=new Li(e=>bi(e),vi),this.lastRemoteSnapshotVersion=Br.min(),this.highestTargetId=0,this.oi=0,this._i=new qo,this.targetCount=0,this.ai=Po.ur()}forEachTarget(e,t){return this.si.forEach((e,s)=>t(s)),Gr.resolve()}getLastRemoteSnapshotVersion(e){return Gr.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Gr.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),Gr.resolve(this.highestTargetId)}setTargetsMetadata(e,t,s){return s&&(this.lastRemoteSnapshotVersion=s),t>this.oi&&(this.oi=t),Gr.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Po(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,Gr.resolve()}updateTargetData(e,t){return this.Pr(t),Gr.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,Gr.resolve()}removeTargets(e,t,s){let r=0;const n=[];return this.si.forEach((i,a)=>{a.sequenceNumber<=t&&null===s.get(a.targetId)&&(this.si.delete(i),n.push(this.removeMatchingKeysForTargetId(e,a.targetId)),r++)}),Gr.waitFor(n).next(()=>r)}getTargetCount(e){return Gr.resolve(this.targetCount)}getTargetData(e,t){const s=this.si.get(t)||null;return Gr.resolve(s)}addMatchingKeys(e,t,s){return this._i.Wr(t,s),Gr.resolve()}removeMatchingKeys(e,t,s){this._i.zr(t,s);const r=this.persistence.referenceDelegate,n=[];return r&&t.forEach(t=>{n.push(r.markPotentiallyOrphaned(e,t))}),Gr.waitFor(n)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),Gr.resolve()}getMatchingKeysForTargetId(e,t){const s=this._i.Hr(t);return Gr.resolve(s)}containsKey(e,t){return Gr.resolve(this._i.containsKey(t))}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Qo{constructor(e,t){this.ui={},this.overlays={},this.ci=new Jr(0),this.li=!1,this.li=!0,this.hi=new $o,this.referenceDelegate=e(this),this.Pi=new Jo(this),this.indexManager=new Io,this.remoteDocumentCache=new Go(e=>this.referenceDelegate.Ti(e)),this.serializer=new So(t),this.Ii=new Bo(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new zo,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let s=this.ui[e.toKey()];return s||(s=new Ho(t,this.referenceDelegate),this.ui[e.toKey()]=s),s}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,s){Zs("MemoryPersistence","Starting transaction:",e);const r=new Yo(this.ci.next());return this.referenceDelegate.Ei(),s(r).next(e=>this.referenceDelegate.di(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ai(e,t){return Gr.or(Object.values(this.ui).map(s=>()=>s.containsKey(e,t)))}}class Yo extends Kr{constructor(e){super(),this.currentSequenceNumber=e}}class Xo{constructor(e){this.persistence=e,this.Ri=new qo,this.Vi=null}static mi(e){return new Xo(e)}get fi(){if(this.Vi)return this.Vi;throw rr(60996)}addReference(e,t,s){return this.Ri.addReference(s,t),this.fi.delete(s.toString()),Gr.resolve()}removeReference(e,t,s){return this.Ri.removeReference(s,t),this.fi.add(s.toString()),Gr.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),Gr.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));const s=this.persistence.getTargetCache();return s.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>s.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Gr.forEach(this.fi,s=>{const r=Er.fromPath(s);return this.gi(e,r).next(e=>{e||t.removeEntry(r,Br.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return Gr.or([()=>Gr.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Zo{constructor(e,t){this.persistence=e,this.pi=new Li(e=>function(e){let t="";for(let s=0;s<e.length;s++)t.length>0&&(t=Zr(t)),t=Xr(e.get(s),t);return Zr(t)}(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=function(e,t){return new Fo(e,t)}(this,t)}static mi(e,t){return new Zo(e,t)}Ei(){}di(e){return Gr.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}pr(e,t){return Gr.forEach(this.pi,(s,r)=>this.br(e,s,r).next(e=>e?Gr.resolve():t(r)))}removeTargets(e,t,s){return this.persistence.getTargetCache().removeTargets(e,t,s)}removeOrphanedDocuments(e,t){let s=0;const r=this.persistence.getRemoteDocumentCache(),n=r.newChangeBuffer();return r.ii(e,r=>this.br(e,r,t).next(e=>{e||(s++,n.removeEntry(r,Br.min()))})).next(()=>n.apply(e)).next(()=>s)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),Gr.resolve()}removeTarget(e,t){const s=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,s)}addReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),Gr.resolve()}removeReference(e,t,s){return this.pi.set(s,e.currentSequenceNumber),Gr.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),Gr.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Un(e.data.value)),t}br(e,t,s){return Gr.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.pi.get(t);return Gr.resolve(void 0!==e&&e>s)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class el{constructor(e,t,s,r){this.targetId=e,this.fromCache=t,this.Es=s,this.ds=r}static As(e,t){let s=Gi(),r=Gi();for(const n of t.docChanges)switch(n.type){case 0:s=s.add(n.doc.key);break;case 1:r=r.add(n.doc.key)}return new el(e,t.fromCache,s,r)}}
/**
     * @license
     * Copyright 2023 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class tl{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class sl{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=We()?8:function(e){const t=e.match(/Android ([\d.]+)/i),s=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(s)}(Ge())>0?6:4}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,s,r){const n={result:null};return this.ys(e,t).next(e=>{n.result=e}).next(()=>{if(!n.result)return this.ws(e,t,r,s).next(e=>{n.result=e})}).next(()=>{if(n.result)return;const s=new tl;return this.Ss(e,t,s).next(r=>{if(n.result=r,this.Vs)return this.bs(e,t,s,r.size)})}).next(()=>n.result)}bs(e,t,s,r){return s.documentReadCount<this.fs?(Xs()<=dt.DEBUG&&Zs("QueryEngine","SDK will not create cache indexes for query:",Pi(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),Gr.resolve()):(Xs()<=dt.DEBUG&&Zs("QueryEngine","Query:",Pi(t),"scans",s.documentReadCount,"local documents and returns",r,"documents as results."),s.documentReadCount>this.gs*r?(Xs()<=dt.DEBUG&&Zs("QueryEngine","The SDK decides to create cache indexes for query:",Pi(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ii(t))):Gr.resolve())}ys(e,t){if(ki(t))return Gr.resolve(null);let s=Ii(t);return this.indexManager.getIndexType(e,s).next(r=>0===r?null:(null!==t.limit&&1===r&&(t=Ei(t,null,"F"),s=Ii(t)),this.indexManager.getDocumentsMatchingTarget(e,s).next(r=>{const n=Gi(...r);return this.ps.getDocuments(e,n).next(r=>this.indexManager.getMinOffset(e,s).next(s=>{const i=this.Ds(t,r);return this.Cs(t,i,n,s.readTime)?this.ys(e,Ei(t,null,"F")):this.vs(e,i,t,s)}))})))}ws(e,t,s,r){return ki(t)||r.isEqual(Br.min())?Gr.resolve(null):this.ps.getDocuments(e,s).next(n=>{const i=this.Ds(t,n);return this.Cs(t,i,s,r)?Gr.resolve(null):(Xs()<=dt.DEBUG&&Zs("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Pi(t)),this.vs(e,i,t,function(e,t){const s=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,n=Br.fromTimestamp(1e9===r?new Vr(s+1,0):new Vr(s,r));return new $r(n,Er.empty(),t)}(r,-1)).next(e=>e))})}Ds(e,t){let s=new on(Ri(e));return t.forEach((t,r)=>{Di(e,r)&&(s=s.add(r))}),s}Cs(e,t,s,r){if(null===e.limit)return!1;if(s.size!==t.size)return!0;const n="F"===e.limitType?t.last():t.first();return!!n&&(n.hasPendingWrites||n.version.compareTo(r)>0)}Ss(e,t,s){return Xs()<=dt.DEBUG&&Zs("QueryEngine","Using full collection scan to execute query:",Pi(t)),this.ps.getDocumentsMatchingQuery(e,t,$r.min(),s)}vs(e,t,s,r){return this.ps.getDocumentsMatchingQuery(e,s,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const rl="LocalStore";class nl{constructor(e,t,s,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new rn(vr),this.xs=new Li(e=>bi(e),vi),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(s)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Vo(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function il(e,t){return g(this,null,function*(){const s=ar(e);return yield s.persistence.runTransaction("Handle user change","readonly",e=>{let r;return s.mutationQueue.getAllMutationBatches(e).next(n=>(r=n,s.Bs(t),s.mutationQueue.getAllMutationBatches(e))).next(t=>{const n=[],i=[];let a=Gi();for(const e of r){n.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}for(const e of t){i.push(e.batchId);for(const t of e.mutations)a=a.add(t.key)}return s.localDocuments.getDocuments(e,a).next(e=>({Ls:e,removedBatchIds:n,addedBatchIds:i}))})})})}function al(e){const t=ar(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Pi.getLastRemoteSnapshotVersion(e))}function ol(e,t){const s=ar(e),r=t.snapshotVersion;let n=s.Ms;return s.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const i=s.Ns.newChangeBuffer({trackRemovals:!0});n=s.Ms;const a=[];t.targetChanges.forEach((i,o)=>{const l=n.get(o);if(!l)return;a.push(s.Pi.removeMatchingKeys(e,i.removedDocuments,o).next(()=>s.Pi.addMatchingKeys(e,i.addedDocuments,o)));let c=l.withSequenceNumber(e.currentSequenceNumber);var d,u,h;null!==t.targetMismatches.get(o)?c=c.withResumeToken(un.EMPTY_BYTE_STRING,Br.min()).withLastLimboFreeSnapshotVersion(Br.min()):i.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(i.resumeToken,r)),n=n.insert(o,c),u=c,h=i,(0===(d=l).resumeToken.approximateByteSize()||u.snapshotVersion.toMicroseconds()-d.snapshotVersion.toMicroseconds()>=3e8||h.addedDocuments.size+h.modifiedDocuments.size+h.removedDocuments.size>0)&&a.push(s.Pi.updateTargetData(e,c))});let o=Mi(),l=Gi();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&a.push(s.persistence.referenceDelegate.updateLimboDocument(e,r))}),a.push(function(e,t,s){let r=Gi(),n=Gi();return s.forEach(e=>r=r.add(e)),t.getEntries(e,r).next(e=>{let r=Mi();return s.forEach((s,i)=>{const a=e.get(s);i.isFoundDocument()!==a.isFoundDocument()&&(n=n.add(s)),i.isNoDocument()&&i.version.isEqual(Br.min())?(t.removeEntry(s,i.readTime),r=r.insert(s,i)):!a.isValidDocument()||i.version.compareTo(a.version)>0||0===i.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(i),r=r.insert(s,i)):Zs(rl,"Ignoring outdated watch update for ",s,". Current version:",a.version," Watch version:",i.version)}),{ks:r,qs:n}})}(e,i,t.documentUpdates).next(e=>{o=e.ks,l=e.qs})),!r.isEqual(Br.min())){const t=s.Pi.getLastRemoteSnapshotVersion(e).next(t=>s.Pi.setTargetsMetadata(e,e.currentSequenceNumber,r));a.push(t)}return Gr.waitFor(a).next(()=>i.apply(e)).next(()=>s.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(s.Ms=n,e))}function ll(e,t){const s=ar(e);return s.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),s.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function cl(e,t,s){return g(this,null,function*(){const r=ar(e),n=r.Ms.get(t),i=s?"readwrite":"readwrite-primary";try{s||(yield r.persistence.runTransaction("Release target",i,e=>r.persistence.referenceDelegate.removeTarget(e,n)))}catch(a){if(!Wr(a))throw a;Zs(rl,`Failed to update sequence numbers for target ${t}: ${a}`)}r.Ms=r.Ms.remove(t),r.xs.delete(n.target)})}function dl(e,t,s){const r=ar(e);let n=Br.min(),i=Gi();return r.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,s){const r=ar(e),n=r.xs.get(s);return void 0!==n?Gr.resolve(r.Ms.get(n)):r.Pi.getTargetData(t,s)}(r,e,Ii(t)).next(t=>{if(t)return n=t.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(e,t.targetId).next(e=>{i=e})}).next(()=>r.Fs.getDocumentsMatchingQuery(e,t,s?n:Br.min(),s?i:Gi())).next(e=>(function(e,t,s){let r=e.Os.get(t)||Br.min();s.forEach((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)}),e.Os.set(t,r)}(r,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,Qs:i})))}class ul{constructor(){this.activeTargetIds=Wi}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class hl{constructor(){this.Mo=new ul,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,s){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,s){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new ul,Promise.resolve()}handleUserChange(e,t,s){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class ml{Oo(e){}shutdown(){}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const pl="ConnectivityMonitor";class gl{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Zs(pl,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Zs(pl,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}
/**
     * @license
     * Copyright 2023 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */let fl=null;function xl(){return null===fl?fl=268435456+Math.round(2147483648*Math.random()):fl++,"0x"+fl.toString(16)
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */}const yl="RestConnection",bl={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class vl{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",s=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${s}/databases/${r}`,this.Wo=this.databaseId.database===kn?`project_id=${s}`:`project_id=${s}&database_id=${r}`}Go(e,t,s,r,n){const i=xl(),a=this.zo(e,t.toUriEncodedString());Zs(yl,`Sending RPC '${e}' ${i}:`,a,s);const o={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(o,r,n);const{host:l}=new URL(a),c=Be(l);return this.Jo(e,a,o,s,c).then(t=>(Zs(yl,`Received RPC '${e}' ${i}: `,t),t),t=>{throw tr(yl,`RPC '${e}' ${i} failed with error: `,t,"url: ",a,"request:",s),t})}Ho(e,t,s,r,n,i){return this.Go(e,t,s,r,n)}jo(e,t,s){e["X-Goog-Api-Client"]="gl-js/ fire/"+Qs,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,s)=>e[s]=t),s&&s.headers.forEach((t,s)=>e[s]=t)}zo(e,t){const s=bl[e];return`${this.Uo}/v1/${t}:${s}`}terminate(){}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Nl{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const wl="WebChannelConnection";class jl extends vl{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,s,r,n){const i=xl();return new Promise((n,a)=>{const o=new Ms;o.setWithCredentials(!0),o.listenOnce(Vs.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case Bs.NO_ERROR:const t=o.getResponseJson();Zs(wl,`XHR for RPC '${e}' ${i} received:`,JSON.stringify(t)),n(t);break;case Bs.TIMEOUT:Zs(wl,`RPC '${e}' ${i} timed out`),a(new lr(or.DEADLINE_EXCEEDED,"Request time out"));break;case Bs.HTTP_ERROR:const s=o.getStatus();if(Zs(wl,`RPC '${e}' ${i} failed with status:`,s,"response text:",o.getResponseText()),s>0){let e=o.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(or).indexOf(t)>=0?t:or.UNKNOWN}(t.status);a(new lr(e,t.message))}else a(new lr(or.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new lr(or.UNAVAILABLE,"Connection failed."));break;default:rr(9055,{l_:e,streamId:i,h_:o.getLastErrorCode(),P_:o.getLastError()})}}finally{Zs(wl,`RPC '${e}' ${i} completed.`)}});const l=JSON.stringify(r);Zs(wl,`RPC '${e}' ${i} sending request:`,r),o.send(t,"POST",l,s,15)})}T_(e,t,s){const r=xl(),n=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=Ks(),a=qs(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(o.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(o.useFetchStreams=!0),this.jo(o.initMessageHeaders,t,s),o.encodeInitMessageHeaders=!0;const c=n.join("");Zs(wl,`Creating RPC '${e}' stream ${r}: ${c}`,o);const d=i.createWebChannel(c,o);this.I_(d);let u=!1,h=!1;const m=new Nl({Yo:t=>{h?Zs(wl,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(u||(Zs(wl,`Opening RPC '${e}' stream ${r} transport.`),d.open(),u=!0),Zs(wl,`RPC '${e}' stream ${r} sending:`,t),d.send(t))},Zo:()=>d.close()}),p=(e,t,s)=>{e.listen(t,e=>{try{s(e)}catch(t){setTimeout(()=>{throw t},0)}})};return p(d,Us.EventType.OPEN,()=>{h||(Zs(wl,`RPC '${e}' stream ${r} transport opened.`),m.o_())}),p(d,Us.EventType.CLOSE,()=>{h||(h=!0,Zs(wl,`RPC '${e}' stream ${r} transport closed`),m.a_(),this.E_(d))}),p(d,Us.EventType.ERROR,t=>{h||(h=!0,tr(wl,`RPC '${e}' stream ${r} transport errored. Name:`,t.name,"Message:",t.message),m.a_(new lr(or.UNAVAILABLE,"The operation could not be completed")))}),p(d,Us.EventType.MESSAGE,t=>{var s;if(!h){const n=t.data[0];ir(!!n,16349);const i=n,a=(null==i?void 0:i.error)||(null==(s=i[0])?void 0:s.error);if(a){Zs(wl,`RPC '${e}' stream ${r} received error:`,a);const t=a.status;let s=function(e){const t=Ta[e];if(void 0!==t)return Pa(t)}(t),n=a.message;void 0===s&&(s=or.INTERNAL,n="Unknown error status: "+t+" with message "+a.message),h=!0,m.a_(new lr(s,n)),d.close()}else Zs(wl,`RPC '${e}' stream ${r} received:`,n),m.u_(n)}}),p(a,$s.STAT_EVENT,t=>{t.stat===zs.PROXY?Zs(wl,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===zs.NOPROXY&&Zs(wl,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{m.__()},0),m}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function kl(){return"undefined"!=typeof document?document:null}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Sl(e){return new Qa(e,!0)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class _l{constructor(e,t,s=1e3,r=1.5,n=6e4){this.Mi=e,this.timerId=t,this.d_=s,this.A_=r,this.R_=n,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),s=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-s);r>0&&Zs("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${s} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Il="PersistentStream";class Cl{constructor(e,t,s,r,n,i,a,o){this.Mi=e,this.S_=s,this.b_=r,this.connection=n,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new _l(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}stop(){return g(this,null,function*(){this.x_()&&(yield this.close(0))})}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}k_(){return g(this,null,function*(){if(this.O_())return this.close(0)})}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(e,t){return g(this,null,function*(){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===or.RESOURCE_EXHAUSTED?(er(t.toString()),er("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===or.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.r_(t)})}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,s])=>{this.D_===t&&this.G_(e,s)},t=>{e(()=>{const e=new lr(or.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){const s=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{s(()=>this.listener.Xo())}),this.stream.t_(()=>{s(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(e=>{s(()=>this.z_(e))}),this.stream.onMessage(e=>{s(()=>1==++this.F_?this.J_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(()=>g(this,null,function*(){this.state=0,this.start()}))}z_(e){return Zs(Il,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(Zs(Il,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class El extends Cl{constructor(e,t,s,r,n,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,s,r,i),this.serializer=n}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=function(e,t){let s;if("targetChange"in t){t.targetChange;const n="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:rr(39313,{state:r}),i=t.targetChange.targetIds||[],a=function(e,t){return e.useProto3Json?(ir(void 0===t||"string"==typeof t,58123),un.fromBase64String(t||"")):(ir(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),un.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,l=o&&function(e){const t=void 0===e.code?or.UNKNOWN:Pa(e.code);return new lr(t,e.message||"")}(o);s=new za(n,i,a,l||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const n=ao(e,r.document.name),i=to(r.document.updateTime),a=r.document.createTime?to(r.document.createTime):Br.min(),o=new Gn({mapValue:{fields:r.document.fields}}),l=Jn.newFoundDocument(n,i,a,o),c=r.targetIds||[],d=r.removedTargetIds||[];s=new Va(c,d,l.key,l)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const n=ao(e,r.document),i=r.readTime?to(r.readTime):Br.min(),a=Jn.newNoDocument(n,i),o=r.removedTargetIds||[];s=new Va([],o,a.key,a)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const n=ao(e,r.document),i=r.removedTargetIds||[];s=new Va([],i,n,null)}else{if(!("filter"in t))return rr(11601,{Rt:t});{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:n}=e,i=new Ea(r,n),a=e.targetId;s=new Ba(a,i)}}var r;return s}(this.serializer,e),s=function(e){if(!("targetChange"in e))return Br.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Br.min():t.readTime?to(t.readTime):Br.min()}(e);return this.listener.H_(t,s)}Y_(e){const t={};t.database=lo(this.serializer),t.addTarget=function(e,t){let s;const r=t.target;if(s=Ni(r)?{documents:ho(e,r)}:{query:mo(e,r).ft},s.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){s.resumeToken=Za(e,t.resumeToken);const r=Ya(e,t.expectedCount);null!==r&&(s.expectedCount=r)}else if(t.snapshotVersion.compareTo(Br.min())>0){s.readTime=Xa(e,t.snapshotVersion.toTimestamp());const r=Ya(e,t.expectedCount);null!==r&&(s.expectedCount=r)}return s}(this.serializer,e);const s=function(e,t){const s=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return rr(28987,{purpose:e})}}(t.purpose);return null==s?null:{"goog-listen-tags":s}}(this.serializer,e);s&&(t.labels=s),this.q_(t)}Z_(e){const t={};t.database=lo(this.serializer),t.removeTarget=e,this.q_(t)}}class Tl extends Cl{constructor(e,t,s,r,n,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,s,r,i),this.serializer=n}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return ir(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ir(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){ir(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=function(e,t){return e&&e.length>0?(ir(void 0!==t,14353),e.map(e=>function(e,t){let s=e.updateTime?to(e.updateTime):to(t);return s.isEqual(Br.min())&&(s=to(t)),new da(s,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),s=to(e.commitTime);return this.listener.na(s,t)}ra(){const e={};e.database=lo(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>function(e,t){let s;if(t instanceof ba)s={update:uo(e,t.key,t.value)};else if(t instanceof ka)s={delete:io(e,t.key)};else if(t instanceof va)s={update:uo(e,t.key,t.data),updateMask:wo(t.fieldMask)};else{if(!(t instanceof Sa))return rr(16599,{Vt:t.type});s={verify:io(e,t.key)}}return t.fieldTransforms.length>0&&(s.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const s=t.transform;if(s instanceof sa)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(s instanceof ra)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:s.elements}};if(s instanceof ia)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:s.elements}};if(s instanceof oa)return{fieldPath:t.field.canonicalString(),increment:s.Ae};throw rr(20930,{transform:t.transform})}(0,e))),t.precondition.isNone||(s.currentDocument=(r=e,void 0!==(n=t.precondition).updateTime?{updateTime:eo(r,n.updateTime)}:void 0!==n.exists?{exists:n.exists}:rr(27497))),s;var r,n}(this.serializer,e))};this.q_(t)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Al{}class Pl extends Al{constructor(e,t,s,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=s,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new lr(or.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,s,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([n,i])=>this.connection.Go(e,ro(t,s),r,n,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===or.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new lr(or.UNKNOWN,e.toString())})}Ho(e,t,s,r,n){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,a])=>this.connection.Ho(e,ro(t,s),r,i,a,n)).catch(e=>{throw"FirebaseError"===e.name?(e.code===or.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new lr(or.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class Dl{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(er(t),this.aa=!1):Zs("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Rl="RemoteStore";class Ol{constructor(e,t,s,r,n){this.localStore=e,this.datastore=t,this.asyncQueue=s,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=n,this.Aa.Oo(e=>{s.enqueueAndForget(()=>g(this,null,function*(){ql(this)&&(Zs(Rl,"Restarting streams for network reachability change."),yield function(e){return g(this,null,function*(){const t=ar(e);t.Ea.add(4),yield Fl(t),t.Ra.set("Unknown"),t.Ea.delete(4),yield Ll(t)})}(this))}))}),this.Ra=new Dl(s,r)}}function Ll(e){return g(this,null,function*(){if(ql(e))for(const t of e.da)yield t(!0)})}function Fl(e){return g(this,null,function*(){for(const t of e.da)yield t(!1)})}function Ml(e,t){const s=ar(e);s.Ia.has(t.targetId)||(s.Ia.set(t.targetId,t),$l(s)?zl(s):lc(s).O_()&&Vl(s,t))}function Ul(e,t){const s=ar(e),r=lc(s);s.Ia.delete(t),r.O_()&&Bl(s,t),0===s.Ia.size&&(r.O_()?r.L_():ql(s)&&s.Ra.set("Unknown"))}function Vl(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Br.min())>0){const s=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(s)}lc(e).Y_(t)}function Bl(e,t){e.Va.Ue(t),lc(e).Z_(t)}function zl(e){e.Va=new qa({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),lc(e).start(),e.Ra.ua()}function $l(e){return ql(e)&&!lc(e).x_()&&e.Ia.size>0}function ql(e){return 0===ar(e).Ea.size}function Kl(e){e.Va=void 0}function Hl(e){return g(this,null,function*(){e.Ra.set("Online")})}function Gl(e){return g(this,null,function*(){e.Ia.forEach((t,s)=>{Vl(e,t)})})}function Wl(e,t){return g(this,null,function*(){Kl(e),$l(e)?(e.Ra.ha(t),zl(e)):e.Ra.set("Unknown")})}function Jl(e,t,s){return g(this,null,function*(){if(e.Ra.set("Online"),t instanceof za&&2===t.state&&t.cause)try{yield function(e,t){return g(this,null,function*(){const s=t.cause;for(const r of t.targetIds)e.Ia.has(r)&&(yield e.remoteSyncer.rejectListen(r,s),e.Ia.delete(r),e.Va.removeTarget(r))})}(e,t)}catch(r){Zs(Rl,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),yield Ql(e,r)}else if(t instanceof Va?e.Va.Ze(t):t instanceof Ba?e.Va.st(t):e.Va.tt(t),!s.isEqual(Br.min()))try{const t=yield al(e.localStore);s.compareTo(t)>=0&&(yield function(e,t){const s=e.Va.Tt(t);return s.targetChanges.forEach((s,r)=>{if(s.resumeToken.approximateByteSize()>0){const n=e.Ia.get(r);n&&e.Ia.set(r,n.withResumeToken(s.resumeToken,t))}}),s.targetMismatches.forEach((t,s)=>{const r=e.Ia.get(t);if(!r)return;e.Ia.set(t,r.withResumeToken(un.EMPTY_BYTE_STRING,r.snapshotVersion)),Bl(e,t);const n=new ko(r.target,t,s,r.sequenceNumber);Vl(e,n)}),e.remoteSyncer.applyRemoteEvent(s)}(e,s))}catch(n){Zs(Rl,"Failed to raise snapshot:",n),yield Ql(e,n)}})}function Ql(e,t,s){return g(this,null,function*(){if(!Wr(t))throw t;e.Ea.add(1),yield Fl(e),e.Ra.set("Offline"),s||(s=()=>al(e.localStore)),e.asyncQueue.enqueueRetryable(()=>g(this,null,function*(){Zs(Rl,"Retrying IndexedDB access"),yield s(),e.Ea.delete(1),yield Ll(e)}))})}function Yl(e,t){return t().catch(s=>Ql(e,s,t))}function Xl(e){return g(this,null,function*(){const t=ar(e),s=cc(t);let r=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:-1;for(;Zl(t);)try{const e=yield ll(t.localStore,r);if(null===e){0===t.Ta.length&&s.L_();break}r=e.batchId,ec(t,e)}catch(n){yield Ql(t,n)}tc(t)&&sc(t)})}function Zl(e){return ql(e)&&e.Ta.length<10}function ec(e,t){e.Ta.push(t);const s=cc(e);s.O_()&&s.X_&&s.ea(t.mutations)}function tc(e){return ql(e)&&!cc(e).x_()&&e.Ta.length>0}function sc(e){cc(e).start()}function rc(e){return g(this,null,function*(){cc(e).ra()})}function nc(e){return g(this,null,function*(){const t=cc(e);for(const s of e.Ta)t.ea(s.mutations)})}function ic(e,t,s){return g(this,null,function*(){const r=e.Ta.shift(),n=Ia.from(r,t,s);yield Yl(e,()=>e.remoteSyncer.applySuccessfulWrite(n)),yield Xl(e)})}function ac(e,t){return g(this,null,function*(){t&&cc(e).X_&&(yield function(e,t){return g(this,null,function*(){if(function(e){switch(e){case or.OK:return rr(64938);case or.CANCELLED:case or.UNKNOWN:case or.DEADLINE_EXCEEDED:case or.RESOURCE_EXHAUSTED:case or.INTERNAL:case or.UNAVAILABLE:case or.UNAUTHENTICATED:return!1;case or.INVALID_ARGUMENT:case or.NOT_FOUND:case or.ALREADY_EXISTS:case or.PERMISSION_DENIED:case or.FAILED_PRECONDITION:case or.ABORTED:case or.OUT_OF_RANGE:case or.UNIMPLEMENTED:case or.DATA_LOSS:return!0;default:return rr(15467,{code:e})}}(s=t.code)&&s!==or.ABORTED){const s=e.Ta.shift();cc(e).B_(),yield Yl(e,()=>e.remoteSyncer.rejectFailedWrite(s.batchId,t)),yield Xl(e)}var s})}(e,t)),tc(e)&&sc(e)})}function oc(e,t){return g(this,null,function*(){const s=ar(e);s.asyncQueue.verifyOperationInProgress(),Zs(Rl,"RemoteStore received new credentials");const r=ql(s);s.Ea.add(3),yield Fl(s),r&&s.Ra.set("Unknown"),yield s.remoteSyncer.handleCredentialChange(t),s.Ea.delete(3),yield Ll(s)})}function lc(e){return e.ma||(e.ma=function(e,t,s){const r=ar(e);return r.sa(),new El(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,s)}(e.datastore,e.asyncQueue,{Xo:Hl.bind(null,e),t_:Gl.bind(null,e),r_:Wl.bind(null,e),H_:Jl.bind(null,e)}),e.da.push(t=>g(this,null,function*(){t?(e.ma.B_(),$l(e)?zl(e):e.Ra.set("Unknown")):(yield e.ma.stop(),Kl(e))}))),e.ma}function cc(e){return e.fa||(e.fa=function(e,t,s){const r=ar(e);return r.sa(),new Tl(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,s)}(e.datastore,e.asyncQueue,{Xo:()=>Promise.resolve(),t_:rc.bind(null,e),r_:ac.bind(null,e),ta:nc.bind(null,e),na:ic.bind(null,e)}),e.da.push(t=>g(this,null,function*(){t?(e.fa.B_(),yield Xl(e)):(yield e.fa.stop(),e.Ta.length>0&&(Zs(Rl,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))}))),e.fa
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */}class dc{constructor(e,t,s,r,n){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=s,this.op=r,this.removalCallback=n,this.deferred=new cr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,s,r,n){const i=Date.now()+s,a=new dc(e,t,i,r,n);return a.start(s),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new lr(or.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function uc(e,t){if(er("AsyncQueue",`${t}: ${e}`),Wr(e))return new lr(or.UNAVAILABLE,`${t}: ${e}`);throw e}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class hc{static emptySet(e){return new hc(e.comparator)}constructor(e){this.comparator=e?(t,s)=>e(t,s)||Er.comparator(t.key,s.key):(e,t)=>Er.comparator(e.key,t.key),this.keyedMap=Vi(),this.sortedSet=new rn(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,s)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof hc))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),s=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=s.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const s=new hc;return s.comparator=this.comparator,s.keyedMap=e,s.sortedSet=t,s}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class mc{constructor(){this.ga=new rn(Er.comparator)}track(e){const t=e.doc.key,s=this.ga.get(t);s?0!==e.type&&3===s.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==s.type?this.ga=this.ga.insert(t,{type:s.type,doc:e.doc}):2===e.type&&2===s.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===s.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===s.type?this.ga=this.ga.remove(t):1===e.type&&2===s.type?this.ga=this.ga.insert(t,{type:1,doc:s.doc}):0===e.type&&1===s.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):rr(63341,{Rt:e,pa:s}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,s)=>{e.push(s)}),e}}class pc{constructor(e,t,s,r,n,i,a,o,l){this.query=e,this.docs=t,this.oldDocs=s,this.docChanges=r,this.mutatedKeys=n,this.fromCache=i,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,s,r,n){const i=[];return t.forEach(e=>{i.push({type:0,doc:e})}),new pc(e,t,hc.emptySet(t),i,s,r,!0,!1,n)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ti(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,s=e.docChanges;if(t.length!==s.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==s[r].type||!t[r].doc.isEqual(s[r].doc))return!1;return!0}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class gc{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class fc{constructor(){this.queries=xc(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(e,t){const s=ar(e),r=s.queries;s.queries=xc(),r.forEach((e,s)=>{for(const r of s.Sa)r.onError(t)})}(this,new lr(or.ABORTED,"Firestore shutting down"))}}function xc(){return new Li(e=>Ai(e),Ti)}function yc(e,t){return g(this,null,function*(){const s=ar(e);let r=3;const n=t.query;let i=s.queries.get(n);i?!i.ba()&&t.Da()&&(r=2):(i=new gc,r=t.Da()?0:1);try{switch(r){case 0:i.wa=yield s.onListen(n,!0);break;case 1:i.wa=yield s.onListen(n,!1);break;case 2:yield s.onFirstRemoteStoreListen(n)}}catch(a){const e=uc(a,`Initialization of query '${Pi(t.query)}' failed`);return void t.onError(e)}s.queries.set(n,i),i.Sa.push(t),t.va(s.onlineState),i.wa&&t.Fa(i.wa)&&wc(s)})}function bc(e,t){return g(this,null,function*(){const s=ar(e),r=t.query;let n=3;const i=s.queries.get(r);if(i){const e=i.Sa.indexOf(t);e>=0&&(i.Sa.splice(e,1),0===i.Sa.length?n=t.Da()?0:1:!i.ba()&&t.Da()&&(n=2))}switch(n){case 0:return s.queries.delete(r),s.onUnlisten(r,!0);case 1:return s.queries.delete(r),s.onUnlisten(r,!1);case 2:return s.onLastRemoteStoreUnlisten(r);default:return}})}function vc(e,t){const s=ar(e);let r=!1;for(const n of t){const e=n.query,t=s.queries.get(e);if(t){for(const e of t.Sa)e.Fa(n)&&(r=!0);t.wa=n}}r&&wc(s)}function Nc(e,t,s){const r=ar(e),n=r.queries.get(t);if(n)for(const i of n.Sa)i.onError(s);r.queries.delete(t)}function wc(e){e.Ca.forEach(e=>{e.next()})}var jc,kc;(kc=jc||(jc={})).Ma="default",kc.Cache="cache";class Sc{constructor(e,t,s){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=s||{}}Fa(e){if(!this.options.includeMetadataChanges){const t=[];for(const s of e.docChanges)3!==s.type&&t.push(s);e=new pc(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache)return!0;if(!this.Da())return!0;const s="Offline"!==t;return(!this.options.qa||!s)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=pc.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==jc.Cache}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class _c{constructor(e){this.key=e}}class Ic{constructor(e){this.key=e}}class Cc{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Gi(),this.mutatedKeys=Gi(),this.eu=Ri(e),this.tu=new hc(this.eu)}get nu(){return this.Ya}ru(e,t){const s=t?t.iu:new mc,r=t?t.tu:this.tu;let n=t?t.mutatedKeys:this.mutatedKeys,i=r,a=!1;const o="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{const c=r.get(e),d=Di(this.query,t)?t:null,u=!!c&&this.mutatedKeys.has(c.key),h=!!d&&(d.hasLocalMutations||this.mutatedKeys.has(d.key)&&d.hasCommittedMutations);let m=!1;c&&d?c.data.isEqual(d.data)?u!==h&&(s.track({type:3,doc:d}),m=!0):this.su(c,d)||(s.track({type:2,doc:d}),m=!0,(o&&this.eu(d,o)>0||l&&this.eu(d,l)<0)&&(a=!0)):!c&&d?(s.track({type:0,doc:d}),m=!0):c&&!d&&(s.track({type:1,doc:c}),m=!0,(o||l)&&(a=!0)),m&&(d?(i=i.add(d),n=h?n.add(e):n.delete(e)):(i=i.delete(e),n=n.delete(e)))}),null!==this.query.limit)for(;i.size>this.query.limit;){const e="F"===this.query.limitType?i.last():i.first();i=i.delete(e.key),n=n.delete(e.key),s.track({type:1,doc:e})}return{tu:i,iu:s,Cs:a,mutatedKeys:n}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,s,r){const n=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const i=e.iu.ya();i.sort((e,t)=>function(e,t){const s=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return rr(20277,{Rt:e})}};return s(e)-s(t)}(e.type,t.type)||this.eu(e.doc,t.doc)),this.ou(s),r=null!=r&&r;const a=t&&!r?this._u():[],o=0===this.Xa.size&&this.current&&!r?1:0,l=o!==this.Za;return this.Za=o,0!==i.length||l?{snapshot:new pc(this.query,e.tu,n,i,e.mutatedKeys,0===o,l,!1,!!s&&s.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new mc,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Gi(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))});const t=[];return e.forEach(e=>{this.Xa.has(e)||t.push(new Ic(e))}),this.Xa.forEach(s=>{e.has(s)||t.push(new _c(s))}),t}cu(e){this.Ya=e.Qs,this.Xa=Gi();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return pc.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}const Ec="SyncEngine";class Tc{constructor(e,t,s){this.query=e,this.targetId=t,this.view=s}}class Ac{constructor(e){this.key=e,this.hu=!1}}class Pc{constructor(e,t,s,r,n,i){this.localStore=e,this.remoteStore=t,this.eventManager=s,this.sharedClientState=r,this.currentUser=n,this.maxConcurrentLimboResolutions=i,this.Pu={},this.Tu=new Li(e=>Ai(e),Ti),this.Iu=new Map,this.Eu=new Set,this.du=new rn(Er.comparator),this.Au=new Map,this.Ru=new qo,this.Vu={},this.mu=new Map,this.fu=Po.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}function Dc(e,t,s=!0){return g(this,null,function*(){const r=ed(e);let n;const i=r.Tu.get(t);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),n=i.view.lu()):n=yield Oc(r,t,s,!0),n})}function Rc(e,t){return g(this,null,function*(){const s=ed(e);yield Oc(s,t,!0,!1)})}function Oc(e,t,s,r){return g(this,null,function*(){const n=yield function(e,t){const s=ar(e);return s.persistence.runTransaction("Allocate target","readwrite",e=>{let r;return s.Pi.getTargetData(e,t).next(n=>n?(r=n,Gr.resolve(r)):s.Pi.allocateTargetId(e).next(n=>(r=new ko(t,n,"TargetPurposeListen",e.currentSequenceNumber),s.Pi.addTargetData(e,r).next(()=>r))))}).then(e=>{const r=s.Ms.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(s.Ms=s.Ms.insert(e.targetId,e),s.xs.set(t,e.targetId)),e})}(e.localStore,Ii(t)),i=n.targetId,a=e.sharedClientState.addLocalQueryTarget(i,s);let o;return r&&(o=yield function(e,t,s,r,n){return g(this,null,function*(){e.pu=(t,s,r)=>function(e,t,s,r){return g(this,null,function*(){let n=t.view.ru(s);n.Cs&&(n=yield dl(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,n)));const i=r&&r.targetChanges.get(t.targetId),a=r&&null!=r.targetMismatches.get(t.targetId),o=t.view.applyChanges(n,e.isPrimaryClient,i,a);return Wc(e,t.targetId,o.au),o.snapshot})}(e,t,s,r);const i=yield dl(e.localStore,t,!0),a=new Cc(t,i.Qs),o=a.ru(i.documents),l=Ua.createSynthesizedTargetChangeForCurrentChange(s,r&&"Offline"!==e.onlineState,n),c=a.applyChanges(o,e.isPrimaryClient,l);Wc(e,s,c.au);const d=new Tc(t,s,a);return e.Tu.set(t,d),e.Iu.has(s)?e.Iu.get(s).push(t):e.Iu.set(s,[t]),c.snapshot})}(e,t,i,"current"===a,n.resumeToken)),e.isPrimaryClient&&s&&Ml(e.remoteStore,n),o})}function Lc(e,t,s){return g(this,null,function*(){const r=ar(e),n=r.Tu.get(t),i=r.Iu.get(n.targetId);if(i.length>1)return r.Iu.set(n.targetId,i.filter(e=>!Ti(e,t))),void r.Tu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(n.targetId),r.sharedClientState.isActiveQueryTarget(n.targetId)||(yield cl(r.localStore,n.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(n.targetId),s&&Ul(r.remoteStore,n.targetId),Hc(r,n.targetId)}).catch(Hr))):(Hc(r,n.targetId),yield cl(r.localStore,n.targetId,!0))})}function Fc(e,t){return g(this,null,function*(){const s=ar(e),r=s.Tu.get(t),n=s.Iu.get(r.targetId);s.isPrimaryClient&&1===n.length&&(s.sharedClientState.removeLocalQueryTarget(r.targetId),Ul(s.remoteStore,r.targetId))})}function Mc(e,t,s){return g(this,null,function*(){const r=function(e){const t=ar(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=zc.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=$c.bind(null,t),t}(e);try{const e=yield function(e,t){const s=ar(e),r=Vr.now(),n=t.reduce((e,t)=>e.add(t.key),Gi());let i,a;return s.persistence.runTransaction("Locally write mutations","readwrite",e=>{let o=Mi(),l=Gi();return s.Ns.getEntries(e,n).next(e=>{o=e,o.forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>s.localDocuments.getOverlayedDocuments(e,o)).next(n=>{i=n;const a=[];for(const e of t){const t=xa(e,i.get(e.key).overlayedDocument);null!=t&&a.push(new va(e.key,t,Wn(t.value.mapValue),ua.exists(!0)))}return s.mutationQueue.addMutationBatch(e,r,a,t)}).next(t=>{a=t;const r=t.applyToLocalDocumentSet(i,l);return s.documentOverlayCache.saveOverlays(e,t.batchId,r)})}).then(()=>({batchId:a.batchId,changes:Bi(i)}))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,s){let r=e.Vu[e.currentUser.toKey()];r||(r=new rn(vr)),r=r.insert(t,s),e.Vu[e.currentUser.toKey()]=r}(r,e.batchId,s),yield Yc(r,e.changes),yield Xl(r.remoteStore)}catch(n){const e=uc(n,"Failed to persist write");s.reject(e)}})}function Uc(e,t){return g(this,null,function*(){const s=ar(e);try{const e=yield ol(s.localStore,t);t.targetChanges.forEach((e,t)=>{const r=s.Au.get(t);r&&(ir(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?r.hu=!0:e.modifiedDocuments.size>0?ir(r.hu,14607):e.removedDocuments.size>0&&(ir(r.hu,42227),r.hu=!1))}),yield Yc(s,e,t)}catch(r){yield Hr(r)}})}function Vc(e,t,s){const r=ar(e);if(r.isPrimaryClient&&0===s||!r.isPrimaryClient&&1===s){const e=[];r.Tu.forEach((s,r)=>{const n=r.view.va(t);n.snapshot&&e.push(n.snapshot)}),function(e,t){const s=ar(e);s.onlineState=t;let r=!1;s.queries.forEach((e,s)=>{for(const n of s.Sa)n.va(t)&&(r=!0)}),r&&wc(s)}(r.eventManager,t),e.length&&r.Pu.H_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function Bc(e,t,s){return g(this,null,function*(){const r=ar(e);r.sharedClientState.updateQueryState(t,"rejected",s);const n=r.Au.get(t),i=n&&n.key;if(i){let e=new rn(Er.comparator);e=e.insert(i,Jn.newNoDocument(i,Br.min()));const s=Gi().add(i),n=new Ma(Br.min(),new Map,new rn(vr),e,s);yield Uc(r,n),r.du=r.du.remove(i),r.Au.delete(t),Qc(r)}else yield cl(r.localStore,t,!1).then(()=>Hc(r,t,s)).catch(Hr)})}function zc(e,t){return g(this,null,function*(){const s=ar(e),r=t.batch.batchId;try{const e=yield function(e,t){const s=ar(e);return s.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const r=t.batch.keys(),n=s.Ns.newChangeBuffer({trackRemovals:!0});return function(e,t,s,r){const n=s.batch,i=n.keys();let a=Gr.resolve();return i.forEach(e=>{a=a.next(()=>r.getEntry(t,e)).next(t=>{const i=s.docVersions.get(e);ir(null!==i,48541),t.version.compareTo(i)<0&&(n.applyToRemoteDocument(t,s),t.isValidDocument()&&(t.setReadTime(s.commitVersion),r.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,n))}(s,e,t,n).next(()=>n.apply(e)).next(()=>s.mutationQueue.performConsistencyCheck(e)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Gi();for(let s=0;s<e.mutationResults.length;++s)e.mutationResults[s].transformResults.length>0&&(t=t.add(e.batch.mutations[s].key));return t}(t))).next(()=>s.localDocuments.getDocuments(e,r))})}(s.localStore,t);Kc(s,r,null),qc(s,r),s.sharedClientState.updateMutationState(r,"acknowledged"),yield Yc(s,e)}catch(n){yield Hr(n)}})}function $c(e,t,s){return g(this,null,function*(){const r=ar(e);try{const e=yield function(e,t){const s=ar(e);return s.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let r;return s.mutationQueue.lookupMutationBatch(e,t).next(t=>(ir(null!==t,37113),r=t.keys(),s.mutationQueue.removeMutationBatch(e,t))).next(()=>s.mutationQueue.performConsistencyCheck(e)).next(()=>s.documentOverlayCache.removeOverlaysForBatchId(e,r,t)).next(()=>s.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)).next(()=>s.localDocuments.getDocuments(e,r))})}(r.localStore,t);Kc(r,t,s),qc(r,t),r.sharedClientState.updateMutationState(t,"rejected",s),yield Yc(r,e)}catch(n){yield Hr(n)}})}function qc(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function Kc(e,t,s){const r=ar(e);let n=r.Vu[r.currentUser.toKey()];if(n){const e=n.get(t);e&&(s?e.reject(s):e.resolve(),n=n.remove(t)),r.Vu[r.currentUser.toKey()]=n}}function Hc(e,t,s=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Iu.get(t))e.Tu.delete(r),s&&e.Pu.yu(r,s);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach(t=>{e.Ru.containsKey(t)||Gc(e,t)})}function Gc(e,t){e.Eu.delete(t.path.canonicalString());const s=e.du.get(t);null!==s&&(Ul(e.remoteStore,s),e.du=e.du.remove(t),e.Au.delete(s),Qc(e))}function Wc(e,t,s){for(const r of s)r instanceof _c?(e.Ru.addReference(r.key,t),Jc(e,r)):r instanceof Ic?(Zs(Ec,"Document no longer in limbo: "+r.key),e.Ru.removeReference(r.key,t),e.Ru.containsKey(r.key)||Gc(e,r.key)):rr(19791,{wu:r})}function Jc(e,t){const s=t.key,r=s.path.canonicalString();e.du.get(s)||e.Eu.has(r)||(Zs(Ec,"New document in limbo: "+s),e.Eu.add(r),Qc(e))}function Qc(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){const t=e.Eu.values().next().value;e.Eu.delete(t);const s=new Er(_r.fromString(t)),r=e.fu.next();e.Au.set(r,new Ac(s)),e.du=e.du.insert(s,r),Ml(e.remoteStore,new ko(Ii(ji(s.path)),r,"TargetPurposeLimboResolution",Jr.ce))}}function Yc(e,t,s){return g(this,null,function*(){const r=ar(e),n=[],i=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach((e,o)=>{a.push(r.pu(o,t,s).then(e=>{var t;if((e||s)&&r.isPrimaryClient){const n=e?!e.fromCache:null==(t=null==s?void 0:s.targetChanges.get(o.targetId))?void 0:t.current;r.sharedClientState.updateQueryState(o.targetId,n?"current":"not-current")}if(e){n.push(e);const t=el.As(o.targetId,e);i.push(t)}}))}),yield Promise.all(a),r.Pu.H_(n),yield function(e,t){return g(this,null,function*(){const s=ar(e);try{yield s.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>Gr.forEach(t,t=>Gr.forEach(t.Es,r=>s.persistence.referenceDelegate.addReference(e,t.targetId,r)).next(()=>Gr.forEach(t.ds,r=>s.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))}catch(r){if(!Wr(r))throw r;Zs(rl,"Failed to update sequence numbers: "+r)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=s.Ms.get(t),r=e.snapshotVersion,n=e.withLastLimboFreeSnapshotVersion(r);s.Ms=s.Ms.insert(t,n)}}})}(r.localStore,i))})}function Xc(e,t){return g(this,null,function*(){const s=ar(e);if(!s.currentUser.isEqual(t)){Zs(Ec,"User change. New user:",t.toKey());const e=yield il(s.localStore,t);s.currentUser=t,n="'waitForPendingWrites' promise is rejected due to a user change.",(r=s).mu.forEach(e=>{e.forEach(e=>{e.reject(new lr(or.CANCELLED,n))})}),r.mu.clear(),s.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),yield Yc(s,e.Ls)}var r,n})}function Zc(e,t){const s=ar(e),r=s.Au.get(t);if(r&&r.hu)return Gi().add(r.key);{let e=Gi();const r=s.Iu.get(t);if(!r)return e;for(const t of r){const r=s.Tu.get(t);e=e.unionWith(r.view.nu)}return e}}function ed(e){const t=ar(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Uc.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Zc.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Bc.bind(null,t),t.Pu.H_=vc.bind(null,t.eventManager),t.Pu.yu=Nc.bind(null,t.eventManager),t}class td{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(e){return g(this,null,function*(){this.serializer=Sl(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),yield this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)})}Fu(e,t){return null}Mu(e,t){return null}vu(e){return function(e,t,s,r){return new nl(e,t,s,r)}(this.persistence,new sl,e.initialUser,this.serializer)}Cu(e){return new Qo(Xo.mi,this.serializer)}Du(e){return new hl}terminate(){return g(this,null,function*(){var e,t;null==(e=this.gcScheduler)||e.stop(),null==(t=this.indexBackfillerScheduler)||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}td.provider={build:()=>new td};class sd extends td{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){ir(this.persistence.referenceDelegate instanceof Zo,46915);const s=this.persistence.referenceDelegate.garbageCollector;return new Lo(s,e.asyncQueue,t)}Cu(e){const t=void 0!==this.cacheSizeBytes?Ao.withCacheSize(this.cacheSizeBytes):Ao.DEFAULT;return new Qo(e=>Zo.mi(e,t),this.serializer)}}class rd{initialize(e,t){return g(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Vc(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Xc.bind(null,this.syncEngine),yield function(e,t){return g(this,null,function*(){const s=ar(e);t?(s.Ea.delete(2),yield Ll(s)):t||(s.Ea.add(2),yield Fl(s),s.Ra.set("Unknown"))})}(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return new fc}createDatastore(e){const t=Sl(e.databaseInfo.databaseId),s=(r=e.databaseInfo,new jl(r));var r;return function(e,t,s,r){return new Pl(e,t,s,r)}(e.authCredentials,e.appCheckCredentials,s,t)}createRemoteStore(e){return t=this.localStore,s=this.datastore,r=e.asyncQueue,n=e=>Vc(this.syncEngine,e,0),i=gl.v()?new gl:new ml,new Ol(t,s,r,n,i);var t,s,r,n,i}createSyncEngine(e,t){return function(e,t,s,r,n,i,a){const o=new Pc(e,t,s,r,n,i);return a&&(o.gu=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return g(this,null,function*(){var e,t;yield function(e){return g(this,null,function*(){const t=ar(e);Zs(Rl,"RemoteStore shutting down."),t.Ea.add(5),yield Fl(t),t.Aa.shutdown(),t.Ra.set("Unknown")})}(this.remoteStore),null==(e=this.datastore)||e.terminate(),null==(t=this.eventManager)||t.terminate()})}}rd.provider={build:()=>new rd};
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class nd{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):er("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const id="FirestoreClient";class ad{constructor(e,t,s,r,n){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=s,this.databaseInfo=r,this.user=Js.UNAUTHENTICATED,this.clientId=br.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=n,this.authCredentials.start(s,e=>g(this,null,function*(){Zs(id,"Received user=",e.uid),yield this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(s,e=>(Zs(id,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new cr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>g(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const s=uc(t,"Failed to shutdown persistence");e.reject(s)}})),e.promise}}function od(e,t){return g(this,null,function*(){e.asyncQueue.verifyOperationInProgress(),Zs(id,"Initializing OfflineComponentProvider");const s=e.configuration;yield t.initialize(s);let r=s.initialUser;e.setCredentialChangeListener(e=>g(this,null,function*(){r.isEqual(e)||(yield il(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t})}function ld(e,t){return g(this,null,function*(){e.asyncQueue.verifyOperationInProgress();const s=yield function(e){return g(this,null,function*(){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){Zs(id,"Using user provided OfflineComponentProvider");try{yield od(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!("FirebaseError"===(s=n).name?s.code===or.FAILED_PRECONDITION||s.code===or.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&s instanceof DOMException)||22===s.code||20===s.code||11===s.code))throw n;tr("Error using user provided cache. Falling back to memory cache: "+n),yield od(e,new td)}}else Zs(id,"Using default OfflineComponentProvider"),yield od(e,new sd(void 0));var s;return e._offlineComponents})}(e);Zs(id,"Initializing OnlineComponentProvider"),yield t.initialize(s,e.configuration),e.setCredentialChangeListener(e=>oc(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,s)=>oc(t.remoteStore,s)),e._onlineComponents=t})}function cd(e){return g(this,null,function*(){return e._onlineComponents||(e._uninitializedComponentsProvider?(Zs(id,"Using user provided OnlineComponentProvider"),yield ld(e,e._uninitializedComponentsProvider._online)):(Zs(id,"Using default OnlineComponentProvider"),yield ld(e,new rd))),e._onlineComponents})}function dd(e){return g(this,null,function*(){const t=yield cd(e),s=t.eventManager;return s.onListen=Dc.bind(null,t.syncEngine),s.onUnlisten=Lc.bind(null,t.syncEngine),s.onFirstRemoteStoreListen=Rc.bind(null,t.syncEngine),s.onLastRemoteStoreUnlisten=Fc.bind(null,t.syncEngine),s})}
/**
     * @license
     * Copyright 2023 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function ud(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */}const hd=new Map,md="firestore.googleapis.com",pd=!0;
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class gd{constructor(e){var t,s;if(void 0===e.host){if(void 0!==e.ssl)throw new lr(or.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=md,this.ssl=pd}else this.host=e.host,this.ssl=null!=(t=e.ssl)?t:pd;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=To;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new lr(or.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,s,r){if(!0===t&&!0===r)throw new lr(or.INVALID_ARGUMENT,`${e} and ${s} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ud(null!=(s=e.experimentalLongPollingOptions)?s:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new lr(or.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new lr(or.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new lr(or.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,s=e.experimentalLongPollingOptions,t.timeoutSeconds===s.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams;var t,s}}class fd{constructor(e,t,s,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=s,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new gd({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new lr(or.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new lr(or.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new gd(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new ur;switch(e.type){case"firstParty":return new gr(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new lr(or.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return g(this,null,function*(){"notTerminated"===this._terminateTask?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=hd.get(e);t&&(Zs("ComponentProvider","Removing Datastore"),hd.delete(e),t.terminate())}(this),Promise.resolve()}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class xd{constructor(e,t,s){this.converter=t,this._query=s,this.type="query",this.firestore=e}withConverter(e){return new xd(this.firestore,e,this._query)}}class yd{constructor(e,t,s){this.converter=t,this._key=s,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new bd(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new yd(this.firestore,e,this._key)}toJSON(){return{type:yd._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,s){if(Fr(t,yd._jsonSchema))return new yd(e,s||null,new Er(_r.fromString(t.referencePath)))}}yd._jsonSchemaVersion="firestore/documentReference/1.0",yd._jsonSchema={type:Lr("string",yd._jsonSchemaVersion),referencePath:Lr("string")};class bd extends xd{constructor(e,t,s){super(e,t,ji(s)),this._path=s,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new yd(this.firestore,null,new Er(e))}withConverter(e){return new bd(this.firestore,e,this._path)}}function vd(e,t,...s){if(e=it(e),Tr("collection","path",t),e instanceof fd){const r=_r.fromString(t,...s);return Pr(r),new bd(e,null,r)}{if(!(e instanceof yd||e instanceof bd))throw new lr(or.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(_r.fromString(t,...s));return Pr(r),new bd(e.firestore,null,r)}}function Nd(e,t,...s){if(e=it(e),1===arguments.length&&(t=br.newId()),Tr("doc","path",t),e instanceof fd){const r=_r.fromString(t,...s);return Ar(r),new yd(e,null,new Er(r))}{if(!(e instanceof yd||e instanceof bd))throw new lr(or.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(_r.fromString(t,...s));return Ar(r),new yd(e.firestore,e instanceof bd?e.converter:null,new Er(r))}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const wd="AsyncQueue";class jd{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new _l(this,"async_queue_retry"),this._c=()=>{const e=kl();e&&Zs(wd,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=kl();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=kl();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new cr;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}lc(){return g(this,null,function*(){if(0!==this.Xu.length){try{yield this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Wr(e))throw e;Zs(wd,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}})}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,er("INTERNAL UNHANDLED ERROR: ",kd(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,s){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const r=dc.createAndSchedule(this,e,t,s,e=>this.hc(e));return this.tc.push(r),r}uc(){this.nc&&rr(47125,{Pc:kd(this.nc)})}verifyOperationInProgress(){}Tc(){return g(this,null,function*(){let e;do{e=this.ac,yield e}while(e!==this.ac)})}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function kd(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */}function Sd(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const s=e;for(const r of t)if(r in s&&"function"==typeof s[r])return!0;return!1}(e,["next","error","complete"])}class _d extends fd{constructor(e,t,s,r){super(e,t,s,r),this.type="firestore",this._queue=new jd,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return g(this,null,function*(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new jd(e),this._firestoreClient=void 0,yield e}})}}function Id(e){if(e._terminated)throw new lr(or.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,s,r;const n=e._freezeSettings(),i=(a=e._databaseId,o=(null==(t=e._app)?void 0:t.options.appId)||"",l=e._persistenceKey,new jn(a,o,l,(c=n).host,c.ssl,c.experimentalForceLongPolling,c.experimentalAutoDetectLongPolling,ud(c.experimentalLongPollingOptions),c.useFetchStreams,c.isUsingEmulator));var a,o,l,c;e._componentsProvider||(null==(s=n.localCache)?void 0:s._offlineComponentProvider)&&(null==(r=n.localCache)?void 0:r._onlineComponentProvider)&&(e._componentsProvider={_offline:n.localCache._offlineComponentProvider,_online:n.localCache._onlineComponentProvider}),e._firestoreClient=new ad(e._authCredentials,e._appCheckCredentials,e._queue,i,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(e),e._firestoreClient}class Cd{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Cd(un.fromBase64String(e))}catch(t){throw new lr(or.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Cd(un.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Cd._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Fr(e,Cd._jsonSchema))return Cd.fromBase64String(e.bytes)}}Cd._jsonSchemaVersion="firestore/bytes/1.0",Cd._jsonSchema={type:Lr("string",Cd._jsonSchemaVersion),bytes:Lr("string")};
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Ed{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new lr(or.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Cr(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Td{constructor(e){this._methodName=e}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Ad{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new lr(or.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new lr(or.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return vr(this._lat,e._lat)||vr(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ad._jsonSchemaVersion}}static fromJSON(e){if(Fr(e,Ad._jsonSchema))return new Ad(e.latitude,e.longitude)}}Ad._jsonSchemaVersion="firestore/geoPoint/1.0",Ad._jsonSchema={type:Lr("string",Ad._jsonSchemaVersion),latitude:Lr("number"),longitude:Lr("number")};
/**
     * @license
     * Copyright 2024 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Pd{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let s=0;s<e.length;++s)if(e[s]!==t[s])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Pd._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Fr(e,Pd._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new Pd(e.vectorValues);throw new lr(or.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Pd._jsonSchemaVersion="firestore/vectorValue/1.0",Pd._jsonSchema={type:Lr("string",Pd._jsonSchemaVersion),vectorValues:Lr("object")};
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const Dd=/^__.*__$/;class Rd{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return null!==this.fieldMask?new va(e,this.data,this.fieldMask,t,this.fieldTransforms):new ba(e,this.data,t,this.fieldTransforms)}}class Od{constructor(e,t,s){this.data=e,this.fieldMask=t,this.fieldTransforms=s}toMutation(e,t){return new va(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Ld(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw rr(40011,{Ac:e})}}class Fd{constructor(e,t,s,r,n,i){this.settings=e,this.databaseId=t,this.serializer=s,this.ignoreUndefinedProperties=r,void 0===n&&this.Rc(),this.fieldTransforms=n||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Fd(d(d({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var t;const s=null==(t=this.path)?void 0:t.child(e),r=this.Vc({path:s,fc:!1});return r.gc(e),r}yc(e){var t;const s=null==(t=this.path)?void 0:t.child(e),r=this.Vc({path:s,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Jd(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(Ld(this.Ac)&&Dd.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class Md{constructor(e,t,s){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=s||Sl(e)}Cc(e,t,s,r=!1){return new Fd({Ac:e,methodName:t,Dc:s,path:Cr.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Ud(e){const t=e._freezeSettings(),s=Sl(e._databaseId);return new Md(e._databaseId,!!t.ignoreUndefinedProperties,s)}function Vd(e,t,s,r,n,i={}){const a=e.Cc(i.merge||i.mergeFields?2:0,t,s,n);Kd("Data must be an object, but it was:",a,r);const o=$d(r,a);let l,c;if(i.merge)l=new cn(a.fieldMask),c=a.fieldTransforms;else if(i.mergeFields){const e=[];for(const r of i.mergeFields){const n=Hd(t,r,s);if(!a.contains(n))throw new lr(or.INVALID_ARGUMENT,`Field '${n}' is specified in your field mask but missing from your input data.`);Qd(e,n)||e.push(n)}l=new cn(e),c=a.fieldTransforms.filter(e=>l.covers(e.field))}else l=null,c=a.fieldTransforms;return new Rd(new Gn(o),l,c)}class Bd extends Td{_toFieldTransform(e){if(2!==e.Ac)throw 1===e.Ac?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Bd}}function zd(e,t){if(qd(e=it(e)))return Kd("Unsupported field value:",t,e),$d(e,t);if(e instanceof Td)return function(e,t){if(!Ld(t.Ac))throw t.Sc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Sc(`${e._methodName}() is not currently supported inside arrays`);const s=e._toFieldTransform(t);s&&t.fieldTransforms.push(s)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&4!==t.Ac)throw t.Sc("Nested arrays are not supported");return function(e,t){const s=[];let r=0;for(const n of e){let e=zd(n,t.wc(r));null==e&&(e={nullValue:"NULL_VALUE"}),s.push(e),r++}return{arrayValue:{values:s}}}(e,t)}return function(e,t){if(null===(e=it(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Yi(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const s=Vr.fromDate(e);return{timestampValue:Xa(t.serializer,s)}}if(e instanceof Vr){const s=new Vr(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Xa(t.serializer,s)}}if(e instanceof Ad)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Cd)return{bytesValue:Za(t.serializer,e._byteString)};if(e instanceof yd){const s=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(s))throw t.Sc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:so(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof Pd)return s=e,r=t,{mapValue:{fields:{[_n]:{stringValue:En},[Tn]:{arrayValue:{values:s.toArray().map(e=>{if("number"!=typeof e)throw r.Sc("VectorValues must only contain numeric values.");return Ji(r.serializer,e)})}}}}};var s,r;throw t.Sc(`Unsupported field value: ${Rr(e)}`)}(e,t)}function $d(e,t){const s={};return sn(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):tn(e,(e,r)=>{const n=zd(r,t.mc(e));null!=n&&(s[e]=n)}),{mapValue:{fields:s}}}function qd(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Vr||e instanceof Ad||e instanceof Cd||e instanceof yd||e instanceof Td||e instanceof Pd)}function Kd(e,t,s){if(!qd(s)||!Dr(s)){const r=Rr(s);throw"an object"===r?t.Sc(e+" a custom object"):t.Sc(e+" "+r)}}function Hd(e,t,s){if((t=it(t))instanceof Ed)return t._internalPath;if("string"==typeof t)return Wd(e,t);throw Jd("Field path arguments must be of type string or ",e,!1,void 0,s)}const Gd=new RegExp("[~\\*/\\[\\]]");function Wd(e,t,s){if(t.search(Gd)>=0)throw Jd(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,s);try{return new Ed(...t.split("."))._internalPath}catch(r){throw Jd(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,s)}}function Jd(e,t,s,r,n){const i=r&&!r.isEmpty(),a=void 0!==n;let o=`Function ${t}() called with invalid data`;s&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(i||a)&&(l+=" (found",i&&(l+=` in field ${r}`),a&&(l+=` in document ${n}`),l+=")"),new lr(or.INVALID_ARGUMENT,o+e+l)}function Qd(e,t){return e.some(e=>e.isEqual(t))}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Yd{constructor(e,t,s,r,n){this._firestore=e,this._userDataWriter=t,this._key=s,this._document=r,this._converter=n}get id(){return this._key.path.lastSegment()}get ref(){return new yd(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Xd(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Zd("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Xd extends Yd{data(){return super.data()}}function Zd(e,t){return"string"==typeof t?Wd(e,t):t instanceof Ed?t._internalPath:t._delegate._internalPath}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function eu(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new lr(or.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class tu{}class su extends tu{}function ru(e,t,...s){let r=[];t instanceof tu&&r.push(t),r=r.concat(s),function(e){const t=e.filter(e=>e instanceof au).length,s=e.filter(e=>e instanceof nu).length;if(t>1||t>0&&s>0)throw new lr(or.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const n of r)e=n._apply(e);return e}class nu extends su{constructor(e,t,s){super(),this._field=e,this._op=t,this._value=s,this.type="where"}static _create(e,t,s){return new nu(e,t,s)}_apply(e){const t=this._parse(e);return hu(e._query,t),new xd(e.firestore,e.converter,Ci(e._query,t))}_parse(e){const t=Ud(e.firestore),s=function(e,t,s,r,n,i,a){let o;if(n.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new lr(or.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){uu(a,i);const t=[];for(const s of a)t.push(du(r,e,s));o={arrayValue:{values:t}}}else o=du(r,e,a)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||uu(a,i),o=function(e,t,s,r=!1){return zd(s,e.Cc(r?4:3,t))}(s,t,a,"in"===i||"not-in"===i);return si.create(n,i,o)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return s}}function iu(e,t,s){const r=t,n=Zd("where",e);return nu._create(n,r,s)}class au extends tu{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new au(e,t)}_parse(e){const t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:ri.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let s=e;const r=t.getFlattenedFilters();for(const n of r)hu(s,n),s=Ci(s,n)}(e._query,t),new xd(e.firestore,e.converter,Ci(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class ou extends su{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new ou(e,t)}_apply(e){const t=function(e,t,s){if(null!==e.startAt)throw new lr(or.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new lr(or.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Zn(t,s)}(e._query,this._field,this._direction);return new xd(e.firestore,e.converter,function(e,t){const s=e.explicitOrderBy.concat([t]);return new wi(e.path,e.collectionGroup,s,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function lu(e,t="asc"){const s=t,r=Zd("orderBy",e);return ou._create(r,s)}class cu extends su{constructor(e,t,s){super(),this.type=e,this._limit=t,this._limitType=s}static _create(e,t,s){return new cu(e,t,s)}_apply(e){return new xd(e.firestore,e.converter,Ei(e._query,this._limit,this._limitType))}}function du(e,t,s){if("string"==typeof(s=it(s))){if(""===s)throw new lr(or.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Si(t)&&-1!==s.indexOf("/"))throw new lr(or.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${s}' contains a '/' character.`);const r=t.path.child(_r.fromString(s));if(!Er.isDocumentKey(r))throw new lr(or.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Vn(e,new Er(r))}if(s instanceof yd)return Vn(e,s._key);throw new lr(or.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Rr(s)}.`)}function uu(e,t){if(!Array.isArray(e)||0===e.length)throw new lr(or.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function hu(e,t){const s=function(e,t){for(const s of e)for(const e of s.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==s)throw s===t.op?new lr(or.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new lr(or.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${s.toString()}' filters.`)}class mu{convertValue(e,t="none"){switch(An(e)){case 0:return null;case 1:return e.booleanValue;case 2:return pn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(gn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw rr(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const s={};return tn(e,(e,r)=>{s[e]=this.convertValue(r,t)}),s}convertVectorValue(e){var t,s,r;const n=null==(r=null==(s=null==(t=e.fields)?void 0:t[Tn].arrayValue)?void 0:s.values)?void 0:r.map(e=>pn(e.doubleValue));return new Pd(n)}convertGeoPoint(e){return new Ad(pn(e.latitude),pn(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const s=Nn(e);return null==s?null:this.convertValue(s,t);case"estimate":return this.convertTimestamp(wn(e));default:return null}}convertTimestamp(e){const t=mn(e);return new Vr(t.seconds,t.nanos)}convertDocumentKey(e,t){const s=_r.fromString(e);ir(jo(s),9688,{name:e});const r=new Sn(s.get(1),s.get(3)),n=new Er(s.popFirst(5));return r.isEqual(t)||er(`Document ${n} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),n}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function pu(e,t,s){let r;return r=e?s&&(s.merge||s.mergeFields)?e.toFirestore(t,s):e.toFirestore(t):t,r}class gu{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class fu extends Yd{constructor(e,t,s,r,n,i){super(e,t,s,r,i),this._firestore=e,this._firestoreImpl=e,this.metadata=n}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new xu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const s=this._document.data.field(Zd("DocumentSnapshot.get",e));if(null!==s)return this._userDataWriter.convertValue(s,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new lr(or.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=fu._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t):t}}fu._jsonSchemaVersion="firestore/documentSnapshot/1.0",fu._jsonSchema={type:Lr("string",fu._jsonSchemaVersion),bundleSource:Lr("string","DocumentSnapshot"),bundleName:Lr("string"),bundle:Lr("string")};class xu extends fu{data(e={}){return super.data(e)}}class yu{constructor(e,t,s,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new gu(r.hasPendingWrites,r.fromCache),this.query=s}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(s=>{e.call(t,new xu(this._firestore,this._userDataWriter,s.key,s,new gu(this._snapshot.mutatedKeys.has(s.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new lr(or.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(s=>{const r=new xu(e._firestore,e._userDataWriter,s.doc.key,s.doc,new gu(e._snapshot.mutatedKeys.has(s.doc.key),e._snapshot.fromCache),e.query.converter);return s.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let s=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const r=new xu(e._firestore,e._userDataWriter,t.doc.key,t.doc,new gu(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let n=-1,i=-1;return 0!==t.type&&(n=s.indexOf(t.doc.key),s=s.delete(t.doc.key)),1!==t.type&&(s=s.add(t.doc),i=s.indexOf(t.doc.key)),{type:bu(t.type),doc:r,oldIndex:n,newIndex:i}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new lr(or.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=yu._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=br.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],s=[],r=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),s.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),r.push(e.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function bu(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return rr(61501,{type:e})}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function vu(e){e=Or(e,yd);const t=Or(e.firestore,_d);return function(e,t,s={}){const r=new cr;return e.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return function(e,t,s,r,n){const i=new nd({next:o=>{i.Nu(),t.enqueueAndForget(()=>bc(e,a));const l=o.docs.has(s);!l&&o.fromCache?n.reject(new lr(or.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&o.fromCache&&r&&"server"===r.source?n.reject(new lr(or.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):n.resolve(o)},error:e=>n.reject(e)}),a=new Sc(ji(s.path),i,{includeMetadataChanges:!0,qa:!0});return yc(e,a)}(yield dd(e),e.asyncQueue,t,s,r)})),r.promise}(Id(t),e._key).then(s=>Cu(t,e,s))}yu._jsonSchemaVersion="firestore/querySnapshot/1.0",yu._jsonSchema={type:Lr("string",yu._jsonSchemaVersion),bundleSource:Lr("string","QuerySnapshot"),bundleName:Lr("string"),bundle:Lr("string")};class Nu extends mu{constructor(e){super(),this.firestore=e}convertBytes(e){return new Cd(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new yd(this.firestore,null,t)}}function wu(e){e=Or(e,xd);const t=Or(e.firestore,_d),s=Id(t),r=new Nu(t);return eu(e._query),function(e,t,s={}){const r=new cr;return e.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return function(e,t,s,r,n){const i=new nd({next:s=>{i.Nu(),t.enqueueAndForget(()=>bc(e,a)),s.fromCache&&"server"===r.source?n.reject(new lr(or.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):n.resolve(s)},error:e=>n.reject(e)}),a=new Sc(s,i,{includeMetadataChanges:!0,qa:!0});return yc(e,a)}(yield dd(e),e.asyncQueue,t,s,r)})),r.promise}(s,e._query).then(s=>new yu(t,r,e,s))}function ju(e,t,s){e=Or(e,yd);const r=Or(e.firestore,_d),n=pu(e.converter,t,s);return Iu(r,[Vd(Ud(r),"setDoc",e._key,n,null!==e.converter,s).toMutation(e._key,ua.none())])}function ku(e,t,s,...r){e=Or(e,yd);const n=Or(e.firestore,_d),i=Ud(n);let a;return a="string"==typeof(t=it(t))||t instanceof Ed?function(e,t,s,r,n,i){const a=e.Cc(1,t,s),o=[Hd(t,r,s)],l=[n];if(i.length%2!=0)throw new lr(or.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let h=0;h<i.length;h+=2)o.push(Hd(t,i[h])),l.push(i[h+1]);const c=[],d=Gn.empty();for(let h=o.length-1;h>=0;--h)if(!Qd(c,o[h])){const e=o[h];let t=l[h];t=it(t);const s=a.yc(e);if(t instanceof Bd)c.push(e);else{const r=zd(t,s);null!=r&&(c.push(e),d.set(e,r))}}const u=new cn(c);return new Od(d,u,a.fieldTransforms)}(i,"updateDoc",e._key,t,s,r):function(e,t,s,r){const n=e.Cc(1,t,s);Kd("Data must be an object, but it was:",n,r);const i=[],a=Gn.empty();tn(r,(e,r)=>{const o=Wd(t,e,s);r=it(r);const l=n.yc(o);if(r instanceof Bd)i.push(o);else{const e=zd(r,l);null!=e&&(i.push(o),a.set(o,e))}});const o=new cn(i);return new Od(a,o,n.fieldTransforms)}(i,"updateDoc",e._key,t),Iu(n,[a.toMutation(e._key,ua.exists(!0))])}function Su(e){return Iu(Or(e.firestore,_d),[new ka(e._key,ua.none())])}function _u(e,...t){var s,r,n;e=it(e);let i={includeMetadataChanges:!1,source:"default"},a=0;"object"!=typeof t[a]||Sd(t[a])||(i=t[a++]);const o={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if(Sd(t[a])){const e=t[a];t[a]=null==(s=e.next)?void 0:s.bind(e),t[a+1]=null==(r=e.error)?void 0:r.bind(e),t[a+2]=null==(n=e.complete)?void 0:n.bind(e)}let l,c,d;if(e instanceof yd)c=Or(e.firestore,_d),d=ji(e._key.path),l={next:s=>{t[a]&&t[a](Cu(c,e,s))},error:t[a+1],complete:t[a+2]};else{const s=Or(e,xd);c=Or(s.firestore,_d),d=s._query;const r=new Nu(c);l={next:e=>{t[a]&&t[a](new yu(c,r,s,e))},error:t[a+1],complete:t[a+2]},eu(e._query)}return function(e,t,s,r){const n=new nd(r),i=new Sc(t,n,s);return e.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return yc(yield dd(e),i)})),()=>{n.Nu(),e.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return bc(yield dd(e),i)}))}}(Id(c),d,o,l)}function Iu(e,t){return function(e,t){const s=new cr;return e.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){return Mc(yield function(e){return cd(e).then(e=>e.syncEngine)}(e),t,s)})),s.promise}(Id(e),t)}function Cu(e,t,s){const r=s.docs.get(t._key),n=new Nu(e);return new fu(e,n,t._key,r,new gu(s.hasPendingWrites,s.fromCache),t.converter)}!function(e,t=!0){Qs=Ns,fs(new at("firestore",(e,{instanceIdentifier:s,options:r})=>{const n=e.getProvider("app").getImmediate(),i=new _d(new mr(e.getProvider("auth-internal")),new xr(n,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new lr(or.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Sn(e.options.projectId,t)}(n,s),n);return r=d({useFetchStreams:t},r),i._setSettings(r),i},"PUBLIC").setMultipleInstances(!0)),ks(Gs,Ws,e),ks(Gs,Ws,"esm2020")}(),
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
ks("firebase","12.4.0","app");
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const Eu="firebasestorage.googleapis.com";
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Tu extends Je{constructor(e,t,s=0){super(Ou(e),`Firebase Storage: ${t} (${Ou(e)})`),this.status_=s,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Tu.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Ou(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var Au,Pu,Du,Ru;function Ou(e){return"storage/"+e}function Lu(e){return new Tu(Au.INVALID_ARGUMENT,e)}function Fu(){return new Tu(Au.APP_DELETED,"The Firebase app was deleted.")}(Pu=Au||(Au={})).UNKNOWN="unknown",Pu.OBJECT_NOT_FOUND="object-not-found",Pu.BUCKET_NOT_FOUND="bucket-not-found",Pu.PROJECT_NOT_FOUND="project-not-found",Pu.QUOTA_EXCEEDED="quota-exceeded",Pu.UNAUTHENTICATED="unauthenticated",Pu.UNAUTHORIZED="unauthorized",Pu.UNAUTHORIZED_APP="unauthorized-app",Pu.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",Pu.INVALID_CHECKSUM="invalid-checksum",Pu.CANCELED="canceled",Pu.INVALID_EVENT_NAME="invalid-event-name",Pu.INVALID_URL="invalid-url",Pu.INVALID_DEFAULT_BUCKET="invalid-default-bucket",Pu.NO_DEFAULT_BUCKET="no-default-bucket",Pu.CANNOT_SLICE_BLOB="cannot-slice-blob",Pu.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",Pu.NO_DOWNLOAD_URL="no-download-url",Pu.INVALID_ARGUMENT="invalid-argument",Pu.INVALID_ARGUMENT_COUNT="invalid-argument-count",Pu.APP_DELETED="app-deleted",Pu.INVALID_ROOT_OPERATION="invalid-root-operation",Pu.INVALID_FORMAT="invalid-format",Pu.INTERNAL_ERROR="internal-error",Pu.UNSUPPORTED_ENVIRONMENT="unsupported-environment";
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Mu{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let s;try{s=Mu.makeFromUrl(e,t)}catch(n){return new Mu(e,"")}if(""===s.path)return s;throw r=e,new Tu(Au.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.");var r}static makeFromUrl(e,t){let s=null;const r="([A-Za-z0-9.\\-_]+)",n=new RegExp("^gs://"+r+"(/(.*))?$","i");function i(e){e.path_=decodeURIComponent(e.path)}const a=t.replace(/[.]/g,"\\."),o=[{regex:n,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${a}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:i},{regex:new RegExp(`^https?://${t===Eu?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:i}];for(let l=0;l<o.length;l++){const t=o[l],r=t.regex.exec(e);if(r){const e=r[t.indices.bucket];let n=r[t.indices.path];n||(n=""),s=new Mu(e,n),t.postModify(s);break}}if(null==s)throw function(e){return new Tu(Au.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return s}}class Uu{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Vu(e,t,s,r){if(r<t)throw Lu(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>s)throw Lu(`Invalid value for '${e}'. Expected ${s} or less.`)}(Ru=Du||(Du={}))[Ru.NO_ERROR=0]="NO_ERROR",Ru[Ru.NETWORK_ERROR=1]="NETWORK_ERROR",Ru[Ru.ABORT=2]="ABORT";
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Bu{constructor(e,t,s,r,n,i,a,o,l,c,d,u=!0,h=!1){this.url_=e,this.method_=t,this.headers_=s,this.body_=r,this.successCodes_=n,this.additionalRetryCodes_=i,this.callback_=a,this.errorCallback_=o,this.timeout_=l,this.progressCallback_=c,this.connectionFactory_=d,this.retry=u,this.isUsingEmulator=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){const e=(e,t)=>{if(t)return void e(!1,new zu(!1,null,!0));const s=this.connectionFactory_();this.pendingConnection_=s;const r=e=>{const t=e.loaded,s=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,s)};null!==this.progressCallback_&&s.addUploadProgressListener(r),s.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&s.removeUploadProgressListener(r),this.pendingConnection_=null;const t=s.getErrorCode()===Du.NO_ERROR,n=s.getStatus();if(!t||
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function(e,t){const s=e>=500&&e<600,r=-1!==[408,429].indexOf(e),n=-1!==t.indexOf(e);return s||r||n}(n,this.additionalRetryCodes_)&&this.retry){const t=s.getErrorCode()===Du.ABORT;return void e(!1,new zu(!1,null,t))}const i=-1!==this.successCodes_.indexOf(n);e(!0,new zu(i,s))})},t=(e,t)=>{const s=this.resolve_,r=this.reject_,n=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(n,n.getResponse());void 0!==e?s(e):s()}catch(i){r(i)}else if(null!==n){const e=new Tu(Au.UNKNOWN,"An unknown error occurred, please check the error payload for server response.");e.serverResponse=n.getErrorText(),this.errorCallback_?r(this.errorCallback_(n,e)):r(e)}else t.canceled?r(this.appDelete_?Fu():new Tu(Au.CANCELED,"User canceled the upload/download.")):r(new Tu(Au.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))};this.canceled_?t(0,new zu(!1,null,!0)):this.backoffId_=function(e,t,s){let r=1,n=null,i=null,a=!1,o=0;function l(){return 2===o}let c=!1;function d(...e){c||(c=!0,t.apply(null,e))}function u(t){n=setTimeout(()=>{n=null,e(m,l())},t)}function h(){i&&clearTimeout(i)}function m(e,...t){if(c)return void h();if(e)return h(),void d.call(null,e,...t);if(l()||a)return h(),void d.call(null,e,...t);let s;r<64&&(r*=2),1===o?(o=2,s=0):s=1e3*(r+Math.random()),u(s)}let p=!1;function g(e){p||(p=!0,h(),c||(null!==n?(e||(o=2),clearTimeout(n),u(0)):e||(o=1)))}return u(0),i=setTimeout(()=>{a=!0,g(!0)},s),g}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class zu{constructor(e,t,s){this.wasSuccessCode=e,this.connection=t,this.canceled=!!s}}function $u(e,t,s,r,n,i,a=!0,o=!1){const l=function(e){const t=encodeURIComponent;let s="?";for(const r in e)e.hasOwnProperty(r)&&(s=s+(t(r)+"=")+t(e[r])+"&");return s=s.slice(0,-1),s}(e.urlParams),c=e.url+l,d=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(d,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(d,s),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!=t?t:"AppManager")}(d,i),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(d,r),new Bu(c,e.method,d,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,n,a,o)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class qu{constructor(e,t){this._service=e,this._location=t instanceof Mu?t:Mu.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new qu(e,t)}get root(){const e=new Mu(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return function(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new Mu(this._location.bucket,e);return new qu(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new Tu(Au.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function Ku(e,t){const s=null==t?void 0:t.storageBucket;return null==s?null:Mu.makeFromBucketSpec(s,e)}class Hu{constructor(e,t,s,r,n,i=!1){this.app=e,this._authProvider=t,this._appCheckProvider=s,this._url=r,this._firebaseVersion=n,this._isUsingEmulator=i,this._bucket=null,this._host=Eu,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?Mu.makeFromBucketSpec(r,this._host):Ku(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=Mu.makeFromBucketSpec(this._url,e):this._bucket=Ku(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Vu("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Vu("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}_getAuthToken(){return g(this,null,function*(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=yield e.getToken();if(null!==t)return t.accessToken}return null})}_getAppCheckToken(){return g(this,null,function*(){if(ys(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(yield e.getToken()).token:null})}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new qu(this,e)}_makeRequest(e,t,s,r,n=!0){if(this._deleted)return new Uu(Fu());{const i=$u(e,this._appId,s,r,t,this._firebaseVersion,n,this._isUsingEmulator);return this._requests.add(i),i.getPromise().then(()=>this._requests.delete(i),()=>this._requests.delete(i)),i}}makeRequestWithTokens(e,t){return g(this,null,function*(){const[s,r]=yield Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,s,r).getPromise()})}}const Gu="@firebase/storage",Wu="0.14.0",Ju="storage";function Qu(e,{instanceIdentifier:t}){const s=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),n=e.getProvider("app-check-internal");return new Hu(s,r,n,t,Ns)}function Yu(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}fs(new at(Ju,Qu,"PUBLIC").setMultipleInstances(!0)),ks(Gu,Wu,""),ks(Gu,Wu,"esm2020");const Xu=Yu,Zu=new Qe("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),eh=new ft("@firebase/auth");function th(e,...t){eh.logLevel<=dt.ERROR&&eh.error(`Auth (${Ns}): ${e}`,...t)}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function sh(e,...t){throw ah(e,...t)}function rh(e,...t){return ah(e,...t)}function nh(e,t,s){const r=u(d({},Xu()),{[t]:s});return new Qe("auth","Firebase",r).create(t,{appName:e.name})}function ih(e){return nh(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function ah(e,...t){if("string"!=typeof e){const s=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(s,...r)}return Zu.create(e,...t)}function oh(e,t,...s){if(!e)throw ah(t,...s)}function lh(e){const t="INTERNAL ASSERTION FAILED: "+e;throw th(t),new Error(t)}function ch(e,t){e||lh(t)}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function dh(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.href)||""}function uh(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.protocol)||null}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function hh(){return"undefined"==typeof navigator||!navigator||!("onLine"in navigator)||"boolean"!=typeof navigator.onLine||"http:"!==uh()&&"https:"!==uh()&&!function(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()&&!("connection"in navigator)||navigator.onLine}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class mh{constructor(e,t){this.shortDelay=e,this.longDelay=t,ch(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ge())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return hh()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function ph(e,t){ch(e.emulator,"Emulator should always be set here");const{url:s}=e.emulator;return t?`${s}${t.startsWith("/")?t.slice(1):t}`:s}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class gh{static initialize(e,t,s){this.fetchImpl=e,t&&(this.headersImpl=t),s&&(this.responseImpl=s)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void lh("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void lh("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void lh("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const fh={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},xh=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],yh=new mh(3e4,6e4);
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function bh(e,t){return e.tenantId&&!t.tenantId?u(d({},t),{tenantId:e.tenantId}):t}function vh(e,t,s,r){return g(this,arguments,function*(e,t,s,r,n={}){return Nh(e,n,()=>g(this,null,function*(){let n={},i={};r&&("GET"===t?i=r:n={body:JSON.stringify(r)});const a=et(d({key:e.config.apiKey},i)).slice(1),o=yield e._getAdditionalHeaders();o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode);const l=d({method:t,headers:o},n);return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||(l.referrerPolicy="no-referrer"),e.emulatorConfig&&Be(e.emulatorConfig.host)&&(l.credentials="include"),gh.fetch()(yield jh(e,e.config.apiHost,s,a),l)}))})}function Nh(e,t,s){return g(this,null,function*(){e._canInitEmulator=!1;const r=d(d({},fh),t);try{const t=new Sh(e),n=yield Promise.race([s(),t.promise]);t.clearNetworkTimeout();const i=yield n.json();if("needConfirmation"in i)throw _h(e,"account-exists-with-different-credential",i);if(n.ok&&!("errorMessage"in i))return i;{const t=n.ok?i.errorMessage:i.error.message,[s,a]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===s)throw _h(e,"credential-already-in-use",i);if("EMAIL_EXISTS"===s)throw _h(e,"email-already-in-use",i);if("USER_DISABLED"===s)throw _h(e,"user-disabled",i);const o=r[s]||s.toLowerCase().replace(/[_\s]+/g,"-");if(a)throw nh(e,o,a);sh(e,o)}}catch(n){if(n instanceof Je)throw n;sh(e,"network-request-failed",{message:String(n)})}})}function wh(e,t,s,r){return g(this,arguments,function*(e,t,s,r,n={}){const i=yield vh(e,t,s,r,n);return"mfaPendingCredential"in i&&sh(e,"multi-factor-auth-required",{_serverResponse:i}),i})}function jh(e,t,s,r){return g(this,null,function*(){const n=`${t}${s}?${r}`,i=e,a=i.config.emulator?ph(e.config,n):`${e.config.apiScheme}://${n}`;return xh.includes(s)&&(yield i._persistenceManagerAvailable,"COOKIE"===i._getPersistenceType())?i._getPersistence()._getFinalTarget(a).toString():a})}function kh(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Sh{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(rh(this.auth,"network-request-failed")),yh.get())})}}function _h(e,t,s){const r={appName:e.name};s.email&&(r.email=s.email),s.phoneNumber&&(r.phoneNumber=s.phoneNumber);const n=rh(e,t,r);return n.customData._tokenResponse=s,n}function Ih(e){return void 0!==e&&void 0!==e.enterprise}class Ch{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return kh(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}function Eh(e,t){return g(this,null,function*(){return vh(e,"POST","/v1/accounts:lookup",t)})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Th(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(t){}}function Ah(e){return 1e3*Number(e)}function Ph(e){const[t,s,r]=e.split(".");if(void 0===t||void 0===s||void 0===r)return th("JWT malformed, contained fewer than 3 sections"),null;try{const e=De(s);return e?JSON.parse(e):(th("Failed to decode base64 JWT payload"),null)}catch(n){return th("Caught error parsing JWT payload as JSON",null==n?void 0:n.toString()),null}}function Dh(e){const t=Ph(e);return oh(t,"internal-error"),oh(void 0!==t.exp,"internal-error"),oh(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Rh(e,t,s=!1){return g(this,null,function*(){if(s)return t;try{return yield t}catch(r){throw r instanceof Je&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(r)&&e.auth.currentUser===e&&(yield e.auth.signOut()),r}})}class Oh{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!=(t=this.user.stsTokenManager.expirationTime)?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(()=>g(this,null,function*(){yield this.iteration()}),t)}iteration(){return g(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()})}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Lh{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Th(this.lastLoginAt),this.creationTime=Th(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Fh(e){return g(this,null,function*(){var t;const s=e.auth,r=yield e.getIdToken(),n=yield Rh(e,Eh(s,{idToken:r}));oh(null==n?void 0:n.users.length,s,"internal-error");const i=n.users[0];e._notifyReloadListener(i);const a=(null==(t=i.providerUserInfo)?void 0:t.length)?Mh(i.providerUserInfo):[],o=(l=e.providerData,c=a,[...l.filter(e=>!c.some(t=>t.providerId===e.providerId)),...c]);var l,c;const d=e.isAnonymous,u=!(e.email&&i.passwordHash||(null==o?void 0:o.length)),h=!!d&&u,m={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:o,metadata:new Lh(i.createdAt,i.lastLoginAt),isAnonymous:h};Object.assign(e,m)})}function Mh(e){return e.map(e=>{var t=e,{providerId:s}=t,r=h(t,["providerId"]);return{providerId:s,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Uh{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){oh(e.idToken,"internal-error"),oh(void 0!==e.idToken,"internal-error"),oh(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):Dh(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){oh(0!==e.length,"internal-error");const t=Dh(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return g(this,null,function*(){return t||!this.accessToken||this.isExpired?(oh(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return g(this,null,function*(){const{accessToken:s,refreshToken:r,expiresIn:n}=yield function(e,t){return g(this,null,function*(){const s=yield Nh(e,{},()=>g(this,null,function*(){const s=et({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:n}=e.config,i=yield jh(e,r,"/v1/token",`key=${n}`),a=yield e._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const o={method:"POST",headers:a,body:s};return e.emulatorConfig&&Be(e.emulatorConfig.host)&&(o.credentials="include"),gh.fetch()(i,o)}));return{accessToken:s.access_token,expiresIn:s.expires_in,refreshToken:s.refresh_token}})}(e,t);this.updateTokensAndExpiration(s,r,Number(n))})}updateTokensAndExpiration(e,t,s){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*s}static fromJSON(e,t){const{refreshToken:s,accessToken:r,expirationTime:n}=t,i=new Uh;return s&&(oh("string"==typeof s,"internal-error",{appName:e}),i.refreshToken=s),r&&(oh("string"==typeof r,"internal-error",{appName:e}),i.accessToken=r),n&&(oh("number"==typeof n,"internal-error",{appName:e}),i.expirationTime=n),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Uh,this.toJSON())}_performRefresh(){return lh("not implemented")}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Vh(e,t){oh("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Bh{constructor(e){var t=e,{uid:s,auth:r,stsTokenManager:n}=t,i=h(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Oh(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=s,this.auth=r,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Lh(i.createdAt||void 0,i.lastLoginAt||void 0)}getIdToken(e){return g(this,null,function*(){const t=yield Rh(this,this.stsTokenManager.getToken(this.auth,e));return oh(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return function(e,t=!1){return g(this,null,function*(){const s=it(e),r=yield s.getIdToken(t),n=Ph(r);oh(n&&n.exp&&n.auth_time&&n.iat,s.auth,"internal-error");const i="object"==typeof n.firebase?n.firebase:void 0,a=null==i?void 0:i.sign_in_provider;return{claims:n,token:r,authTime:Th(Ah(n.auth_time)),issuedAtTime:Th(Ah(n.iat)),expirationTime:Th(Ah(n.exp)),signInProvider:a||null,signInSecondFactor:(null==i?void 0:i.sign_in_second_factor)||null}})}(this,e)}reload(){return function(e){return g(this,null,function*(){const t=it(e);yield Fh(t),yield t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)})}(this)}_assign(e){this!==e&&(oh(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>d({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Bh(u(d({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){oh(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return g(this,null,function*(){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),t&&(yield Fh(this)),yield this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)})}delete(){return g(this,null,function*(){if(ys(this.auth.app))return Promise.reject(ih(this.auth));const e=yield this.getIdToken();return yield Rh(this,
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function(e,t){return g(this,null,function*(){return vh(e,"POST","/v1/accounts:delete",t)})}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return u(d({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>d({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var s,r,n,i,a,o,l,c;const u=null!=(s=t.displayName)?s:void 0,h=null!=(r=t.email)?r:void 0,m=null!=(n=t.phoneNumber)?n:void 0,p=null!=(i=t.photoURL)?i:void 0,g=null!=(a=t.tenantId)?a:void 0,f=null!=(o=t._redirectEventId)?o:void 0,x=null!=(l=t.createdAt)?l:void 0,y=null!=(c=t.lastLoginAt)?c:void 0,{uid:b,emailVerified:v,isAnonymous:N,providerData:w,stsTokenManager:j}=t;oh(b&&j,e,"internal-error");const k=Uh.fromJSON(this.name,j);oh("string"==typeof b,e,"internal-error"),Vh(u,e.name),Vh(h,e.name),oh("boolean"==typeof v,e,"internal-error"),oh("boolean"==typeof N,e,"internal-error"),Vh(m,e.name),Vh(p,e.name),Vh(g,e.name),Vh(f,e.name),Vh(x,e.name),Vh(y,e.name);const S=new Bh({uid:b,auth:e,email:h,emailVerified:v,displayName:u,isAnonymous:N,photoURL:p,phoneNumber:m,tenantId:g,stsTokenManager:k,createdAt:x,lastLoginAt:y});return w&&Array.isArray(w)&&(S.providerData=w.map(e=>d({},e))),f&&(S._redirectEventId=f),S}static _fromIdTokenResponse(e,t,s=!1){return g(this,null,function*(){const r=new Uh;r.updateFromServerResponse(t);const n=new Bh({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:s});return yield Fh(n),n})}static _fromGetAccountInfoResponse(e,t,s){return g(this,null,function*(){const r=t.users[0];oh(void 0!==r.localId,"internal-error");const n=void 0!==r.providerUserInfo?Mh(r.providerUserInfo):[],i=!(r.email&&r.passwordHash||(null==n?void 0:n.length)),a=new Uh;a.updateFromIdToken(s);const o=new Bh({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:i}),l={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:n,metadata:new Lh(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash||(null==n?void 0:n.length))};return Object.assign(o,l),o})}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const zh=new Map;function $h(e){ch(e instanceof Function,"Expected a class definition");let t=zh.get(e);return t?(ch(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,zh.set(e,t),t)}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class qh{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return g(this,null,function*(){return!0})}_set(e,t){return g(this,null,function*(){this.storage[e]=t})}_get(e){return g(this,null,function*(){const t=this.storage[e];return void 0===t?null:t})}_remove(e){return g(this,null,function*(){delete this.storage[e]})}_addListener(e,t){}_removeListener(e,t){}}qh.type="NONE";const Kh=qh;
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Hh(e,t,s){return`firebase:${e}:${t}:${s}`}class Gh{constructor(e,t,s){this.persistence=e,this.auth=t,this.userKey=s;const{config:r,name:n}=this.auth;this.fullUserKey=Hh(this.userKey,r.apiKey,n),this.fullPersistenceKey=Hh("persistence",r.apiKey,n),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return g(this,null,function*(){const e=yield this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){const t=yield Eh(this.auth,{idToken:e}).catch(()=>{});return t?Bh._fromGetAccountInfoResponse(this.auth,t,e):null}return Bh._fromJSON(this.auth,e)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return g(this,null,function*(){if(this.persistence===e)return;const t=yield this.getCurrentUser();return yield this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,s="authUser"){return g(this,null,function*(){if(!t.length)return new Gh($h(Kh),e,s);const r=(yield Promise.all(t.map(e=>g(this,null,function*(){if(yield e._isAvailable())return e})))).filter(e=>e);let n=r[0]||$h(Kh);const i=Hh(s,e.config.apiKey,e.name);let a=null;for(const s of t)try{const t=yield s._get(i);if(t){let r;if("string"==typeof t){const s=yield Eh(e,{idToken:t}).catch(()=>{});if(!s)break;r=yield Bh._fromGetAccountInfoResponse(e,s,t)}else r=Bh._fromJSON(e,t);s!==n&&(a=r),n=s;break}}catch(l){}const o=r.filter(e=>e._shouldAllowMigration);return n._shouldAllowMigration&&o.length?(n=o[0],a&&(yield n._set(i,a.toJSON())),yield Promise.all(t.map(e=>g(this,null,function*(){if(e!==n)try{yield e._remove(i)}catch(l){}}))),new Gh(n,e,s)):new Gh(n,e,s)})}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Wh(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Xh(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Jh(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(em(t))return"Blackberry";if(tm(t))return"Webos";if(Qh(t))return"Safari";if((t.includes("chrome/")||Yh(t))&&!t.includes("edge/"))return"Chrome";if(Zh(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=e.match(t);if(2===(null==s?void 0:s.length))return s[1]}return"Other"}function Jh(e=Ge()){return/firefox\//i.test(e)}function Qh(e=Ge()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Yh(e=Ge()){return/crios\//i.test(e)}function Xh(e=Ge()){return/iemobile/i.test(e)}function Zh(e=Ge()){return/android/i.test(e)}function em(e=Ge()){return/blackberry/i.test(e)}function tm(e=Ge()){return/webos/i.test(e)}function sm(e=Ge()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function rm(){return function(){const e=Ge();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()&&10===document.documentMode}function nm(e=Ge()){return sm(e)||Zh(e)||tm(e)||em(e)||/windows phone/i.test(e)||Xh(e)}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function im(e,t=[]){let s;switch(e){case"Browser":s=Wh(Ge());break;case"Worker":s=`${Wh(Ge())}-${e}`;break;default:s=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${s}/JsCore/${Ns}/${r}`}
/**
     * @license
     * Copyright 2022 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class am{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const s=t=>new Promise((s,r)=>{try{s(e(t))}catch(n){r(n)}});s.onAbort=t,this.queue.push(s);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}runMiddleware(e){return g(this,null,function*(){if(this.auth.currentUser===e)return;const t=[];try{for(const s of this.queue)yield s(e),s.onAbort&&t.push(s.onAbort)}catch(s){t.reverse();for(const e of t)try{e()}catch(r){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==s?void 0:s.message})}})}}
/**
     * @license
     * Copyright 2023 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class om{constructor(e){var t,s,r,n;const i=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!=(t=i.minPasswordLength)?t:6,i.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=i.maxPasswordLength),void 0!==i.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=i.containsLowercaseCharacter),void 0!==i.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=i.containsUppercaseCharacter),void 0!==i.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=i.containsNumericCharacter),void 0!==i.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=i.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!=(r=null==(s=e.allowedNonAlphanumericCharacters)?void 0:s.join(""))?r:"",this.forceUpgradeOnSignin=null!=(n=e.forceUpgradeOnSignin)&&n,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,s,r,n,i,a;const o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=null==(t=o.meetsMinPasswordLength)||t),o.isValid&&(o.isValid=null==(s=o.meetsMaxPasswordLength)||s),o.isValid&&(o.isValid=null==(r=o.containsLowercaseLetter)||r),o.isValid&&(o.isValid=null==(n=o.containsUppercaseLetter)||n),o.isValid&&(o.isValid=null==(i=o.containsNumericCharacter)||i),o.isValid&&(o.isValid=null==(a=o.containsNonAlphanumericCharacter)||a),o}validatePasswordLengthOptions(e,t){const s=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;s&&(t.meetsMinPasswordLength=e.length>=s),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let s;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)s=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,t,s,r,n){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=n))}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class lm{constructor(e,t,s,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=s,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new dm(this),this.idTokenSubscription=new dm(this),this.beforeStateQueue=new am(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Zu,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=$h(t)),this._initializationPromise=this.queue(()=>g(this,null,function*(){var s,r,n;if(!this._deleted&&(this.persistenceManager=yield Gh.create(this,e),null==(s=this._resolvePersistenceManagerAvailable)||s.call(this),!this._deleted)){if(null==(r=this._popupRedirectResolver)?void 0:r._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch(i){}yield this.initializeCurrentUser(t),this.lastNotifiedUid=(null==(n=this.currentUser)?void 0:n.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return g(this,null,function*(){if(this._deleted)return;const e=yield this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void(yield this.currentUser.getIdToken())):void(yield this._updateCurrentUser(e,!0)):void 0})}initializeCurrentUserFromIdToken(e){return g(this,null,function*(){try{const t=yield Eh(this,{idToken:e}),s=yield Bh._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(s)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return g(this,null,function*(){var t;if(ys(this.app)){const e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}const s=yield this.assertedPersistence.getCurrentUser();let r=s,n=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();const s=null==(t=this.redirectUser)?void 0:t._redirectEventId,i=null==r?void 0:r._redirectEventId,a=yield this.tryRedirectSignIn(e);s&&s!==i||!(null==a?void 0:a.user)||(r=a.user,n=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(n)try{yield this.beforeStateQueue.runMiddleware(r)}catch(i){r=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(i))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return oh(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)})}tryRedirectSignIn(e){return g(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(s){yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return g(this,null,function*(){try{yield Fh(e)}catch(t){if("auth/network-request-failed"!==(null==t?void 0:t.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}_delete(){return g(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return g(this,null,function*(){if(ys(this.app))return Promise.reject(ih(this));const t=e?it(e):null;return t&&oh(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return g(this,null,function*(){if(!this._deleted)return e&&oh(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>g(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return g(this,null,function*(){return ys(this.app)?Promise.reject(ih(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return ys(this.app)?Promise.reject(ih(this)):this.queue(()=>g(this,null,function*(){yield this.assertedPersistence.setPersistence($h(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return g(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return g(this,null,function*(){const e=yield function(e){return g(this,arguments,function*(e,t={}){return vh(e,"GET","/v2/passwordPolicy",bh(e,t))})}
/**
     * @license
     * Copyright 2023 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(this),t=new om(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Qe("auth","Firebase",e())}onAuthStateChanged(e,t,s){return this.registerStateListener(this.authStateSubscription,e,t,s)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,s){return this.registerStateListener(this.idTokenSubscription,e,t,s)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},t)}})}revokeAccessToken(e){return g(this,null,function*(){if(this.currentUser){const t=yield this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};null!=this.tenantId&&(s.tenantId=this.tenantId),yield function(e,t){return g(this,null,function*(){return vh(e,"POST","/v2/accounts:revokeToken",bh(e,t))})}(this,s)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null==(e=this._currentUser)?void 0:e.toJSON()}}_setRedirectUser(e,t){return g(this,null,function*(){const s=yield this.getOrInitRedirectPersistenceManager(t);return null===e?s.removeCurrentUser():s.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return g(this,null,function*(){if(!this.redirectPersistenceManager){const t=e&&$h(e)||this._popupRedirectResolver;oh(t,this,"argument-error"),this.redirectPersistenceManager=yield Gh.create(this,[$h(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return g(this,null,function*(){var t,s;return this._isInitialized&&(yield this.queue(()=>g(this,null,function*(){}))),(null==(t=this._currentUser)?void 0:t._redirectEventId)===e?this._currentUser:(null==(s=this.redirectUser)?void 0:s._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return g(this,null,function*(){if(e===this.currentUser)return this.queue(()=>g(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const s=null!=(t=null==(e=this.currentUser)?void 0:e.uid)?t:null;this.lastNotifiedUid!==s&&(this.lastNotifiedUid=s,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,s,r){if(this._deleted)return()=>{};const n="function"==typeof t?t:t.next.bind(t);let i=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(oh(a,this,"internal-error"),a.then(()=>{i||n(this.currentUser)}),"function"==typeof t){const n=e.addObserver(t,s,r);return()=>{i=!0,n()}}{const s=e.addObserver(t);return()=>{i=!0,s()}}}directlySetCurrentUser(e){return g(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return oh(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=im(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return g(this,null,function*(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const s=yield null==(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))?void 0:e.getHeartbeatsHeader();s&&(t["X-Firebase-Client"]=s);const r=yield this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t})}_getAppCheckToken(){return g(this,null,function*(){var e;if(ys(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=yield null==(e=this.appCheckServiceProvider.getImmediate({optional:!0}))?void 0:e.getToken();return(null==t?void 0:t.error)&&function(e,...t){eh.logLevel<=dt.WARN&&eh.warn(`Auth (${Ns}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token})}}function cm(e){return it(e)}class dm{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const s=new rt(e,t);return s.subscribe.bind(s)}(e=>this.observer=e)}get next(){return oh(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */let um={loadJS(){return g(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function hm(e){return um.loadJS(e)}class mm{constructor(){this.enterprise=new pm}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class pm{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const gm="NO_RECAPTCHA";class fm{constructor(e){this.type="recaptcha-enterprise",this.auth=cm(e)}verify(e="verify",t=!1){return g(this,null,function*(){function s(e){return g(this,null,function*(){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((t,s)=>g(this,null,function*(){(function(e,t){return g(this,null,function*(){return vh(e,"GET","/v2/recaptchaConfig",bh(e,t))})})(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(r=>{if(void 0!==r.recaptchaKey){const s=new Ch(r);return null==e.tenantId?e._agentRecaptchaConfig=s:e._tenantRecaptchaConfigs[e.tenantId]=s,t(s.siteKey)}s(new Error("recaptcha Enterprise site key undefined"))}).catch(e=>{s(e)})}))})}function r(t,s,r){const n=window.grecaptcha;Ih(n)?n.enterprise.ready(()=>{n.enterprise.execute(t,{action:e}).then(e=>{s(e)}).catch(()=>{s(gm)})}):r(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?(new mm).execute("siteKey",{action:"verify"}):new Promise((e,n)=>{s(this.auth).then(s=>{if(!t&&Ih(window.grecaptcha))r(s,e,n);else{if("undefined"==typeof window)return void n(new Error("RecaptchaVerifier is only supported in browser"));let t=um.recaptchaEnterpriseScript;0!==t.length&&(t+=s),hm(t).then(()=>{r(s,e,n)}).catch(e=>{n(e)})}}).catch(e=>{n(e)})})})}}function xm(e,t,s,r=!1,n=!1){return g(this,null,function*(){const i=new fm(e);let a;if(n)a=gm;else try{a=yield i.verify(s)}catch(l){a=yield i.verify(s,!0)}const o=d({},t);if("mfaSmsEnrollment"===s||"mfaSmsSignIn"===s){if("phoneEnrollmentInfo"in o){const e=o.phoneEnrollmentInfo.phoneNumber,t=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){const e=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:a,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return r?Object.assign(o,{captchaResp:a}):Object.assign(o,{captchaResponse:a}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o})}function ym(e,t,s,r,n){return g(this,null,function*(){var n;if(null==(n=e._getRecaptchaConfig())?void 0:n.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const n=yield xm(e,t,s,"getOobCode"===s);return r(e,n)}return r(e,t).catch(n=>g(this,null,function*(){if("auth/missing-recaptcha-token"===n.code){console.log(`${s} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const n=yield xm(e,t,s,"getOobCode"===s);return r(e,n)}return Promise.reject(n)}))})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function bm(e,t,s){const r=cm(e);oh(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const n=vm(t),{host:i,port:a}=function(e){const t=vm(e),s=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!s)return{host:"",port:null};const r=s[2].split("@").pop()||"",n=/^(\[[^\]]+\])(:|$)/.exec(r);if(n){const e=n[1];return{host:e,port:Nm(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:Nm(t)}}}(t),o=null===a?"":`:${a}`,l={url:`${n}//${i}${o}/`},c=Object.freeze({host:i,port:a,protocol:n.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!r._canInitEmulator)return oh(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),void oh(Xe(l,r.config.emulator)&&Xe(c,r.emulatorConfig),r,"emulator-config-failed");r.config.emulator=l,r.emulatorConfig=c,r.settings.appVerificationDisabledForTesting=!0,Be(i)?(ze(`${n}//${i}${o}`),He("Auth",!0)):function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */()}function vm(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Nm(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class wm{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return lh("not implemented")}_getIdTokenResponse(e){return lh("not implemented")}_linkToIdToken(e,t){return lh("not implemented")}_getReauthenticationResolver(e){return lh("not implemented")}}function jm(e,t){return g(this,null,function*(){return vh(e,"POST","/v1/accounts:signUp",t)})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function km(e,t){return g(this,null,function*(){return wh(e,"POST","/v1/accounts:signInWithPassword",bh(e,t))})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Sm extends wm{constructor(e,t,s,r=null){super("password",s),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Sm(e,t,"password")}static _fromEmailAndCode(e,t,s=null){return new Sm(e,t,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}_getIdTokenResponse(e){return g(this,null,function*(){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ym(e,t,"signInWithPassword",km);case"emailLink":return function(e,t){return g(this,null,function*(){return wh(e,"POST","/v1/accounts:signInWithEmailLink",bh(e,t))})}(e,{email:this._email,oobCode:this._password});default:sh(e,"internal-error")}})}_linkToIdToken(e,t){return g(this,null,function*(){switch(this.signInMethod){case"password":const s={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ym(e,s,"signUpPassword",jm);case"emailLink":return function(e,t){return g(this,null,function*(){return wh(e,"POST","/v1/accounts:signInWithEmailLink",bh(e,t))})}(e,{idToken:t,email:this._email,oobCode:this._password});default:sh(e,"internal-error")}})}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function _m(e,t){return g(this,null,function*(){return wh(e,"POST","/v1/accounts:signInWithIdp",bh(e,t))})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Im extends wm{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Im(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):sh("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:s,signInMethod:r}=t,n=h(t,["providerId","signInMethod"]);if(!s||!r)return null;const i=new Im(s,r);return i.idToken=n.idToken||void 0,i.accessToken=n.accessToken||void 0,i.secret=n.secret,i.nonce=n.nonce,i.pendingToken=n.pendingToken||null,i}_getIdTokenResponse(e){return _m(e,this.buildRequest())}_linkToIdToken(e,t){const s=this.buildRequest();return s.idToken=t,_m(e,s)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,_m(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=et(t)}return e}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Cm{constructor(e){var t,s,r,n,i,a;const o=tt(st(e)),l=null!=(t=o.apiKey)?t:null,c=null!=(s=o.oobCode)?s:null,d=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!=(r=o.mode)?r:null);oh(l&&c&&d,"argument-error"),this.apiKey=l,this.operation=d,this.code=c,this.continueUrl=null!=(n=o.continueUrl)?n:null,this.languageCode=null!=(i=o.lang)?i:null,this.tenantId=null!=(a=o.tenantId)?a:null}static parseLink(e){const t=function(e){const t=tt(st(e)).link,s=t?tt(st(t)).deep_link_id:null,r=tt(st(e)).deep_link_id;return(r?tt(st(r)).link:null)||r||s||t||e}(e);try{return new Cm(t)}catch(s){return null}}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Em{constructor(){this.providerId=Em.PROVIDER_ID}static credential(e,t){return Sm._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const s=Cm.parseLink(t);return oh(s,"argument-error"),Sm._fromEmailAndCode(e,s.code,s.tenantId)}}Em.PROVIDER_ID="password",Em.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Em.EMAIL_LINK_SIGN_IN_METHOD="emailLink";
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Tm{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Am extends Tm{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Pm extends Am{constructor(){super("facebook.com")}static credential(e){return Im._fromParams({providerId:Pm.PROVIDER_ID,signInMethod:Pm.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Pm.credentialFromTaggedObject(e)}static credentialFromError(e){return Pm.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Pm.credential(e.oauthAccessToken)}catch(t){return null}}}Pm.FACEBOOK_SIGN_IN_METHOD="facebook.com",Pm.PROVIDER_ID="facebook.com";
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Dm extends Am{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Im._fromParams({providerId:Dm.PROVIDER_ID,signInMethod:Dm.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Dm.credentialFromTaggedObject(e)}static credentialFromError(e){return Dm.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:s}=e;if(!t&&!s)return null;try{return Dm.credential(t,s)}catch(r){return null}}}Dm.GOOGLE_SIGN_IN_METHOD="google.com",Dm.PROVIDER_ID="google.com";
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Rm extends Am{constructor(){super("github.com")}static credential(e){return Im._fromParams({providerId:Rm.PROVIDER_ID,signInMethod:Rm.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Rm.credentialFromTaggedObject(e)}static credentialFromError(e){return Rm.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Rm.credential(e.oauthAccessToken)}catch(t){return null}}}Rm.GITHUB_SIGN_IN_METHOD="github.com",Rm.PROVIDER_ID="github.com";
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Om extends Am{constructor(){super("twitter.com")}static credential(e,t){return Im._fromParams({providerId:Om.PROVIDER_ID,signInMethod:Om.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Om.credentialFromTaggedObject(e)}static credentialFromError(e){return Om.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:s}=e;if(!t||!s)return null;try{return Om.credential(t,s)}catch(r){return null}}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function Lm(e,t){return g(this,null,function*(){return wh(e,"POST","/v1/accounts:signUp",bh(e,t))})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */Om.TWITTER_SIGN_IN_METHOD="twitter.com",Om.PROVIDER_ID="twitter.com";class Fm{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static _fromIdTokenResponse(e,t,s,r=!1){return g(this,null,function*(){const n=yield Bh._fromIdTokenResponse(e,s,r),i=Mm(s);return new Fm({user:n,providerId:i,_tokenResponse:s,operationType:t})})}static _forOperation(e,t,s){return g(this,null,function*(){yield e._updateTokensIfNecessary(s,!0);const r=Mm(s);return new Fm({user:e,providerId:r,_tokenResponse:s,operationType:t})})}}function Mm(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Um extends Je{constructor(e,t,s,r){var n;super(t.code,t.message),this.operationType=s,this.user=r,Object.setPrototypeOf(this,Um.prototype),this.customData={appName:e.name,tenantId:null!=(n=e.tenantId)?n:void 0,_serverResponse:t.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,t,s,r){return new Um(e,t,s,r)}}function Vm(e,t,s,r){return("reauthenticate"===t?s._getReauthenticationResolver(e):s._getIdTokenResponse(e)).catch(s=>{if("auth/multi-factor-auth-required"===s.code)throw Um._fromErrorAndOperation(e,s,t,r);throw s})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function Bm(e,t,s=!1){return g(this,null,function*(){if(ys(e.app))return Promise.reject(ih(e));const r="signIn",n=yield Vm(e,r,t),i=yield Fm._fromIdTokenResponse(e,r,n);return s||(yield e._updateCurrentUser(i.user)),i})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function zm(e){return g(this,null,function*(){const t=cm(e);t._getPasswordPolicyInternal()&&(yield t._updatePasswordPolicy())})}function $m(e,t,s){return ys(e.app)?Promise.reject(ih(e)):function(e,t){return g(this,null,function*(){return Bm(cm(e),t)})}(it(e),Em.credential(t,s)).catch(t=>g(this,null,function*(){throw"auth/password-does-not-meet-requirements"===t.code&&zm(e),t}))}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function qm(e,t){return g(this,arguments,function*(e,{displayName:t,photoURL:s}){if(void 0===t&&void 0===s)return;const r=it(e),n={idToken:yield r.getIdToken(),displayName:t,photoUrl:s,returnSecureToken:!0},i=yield Rh(r,function(e,t){return g(this,null,function*(){return vh(e,"POST","/v1/accounts:update",t)})}(r.auth,n));r.displayName=i.displayName||null,r.photoURL=i.photoUrl||null;const a=r.providerData.find(({providerId:e})=>"password"===e);a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),yield r._updateTokensIfNecessary(i)})}const Km="__sak";
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Hm{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Km,"1"),this.storage.removeItem(Km),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Gm extends Hm{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=nm(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const s=this.storage.getItem(t),r=this.localCache[t];s!==r&&e(t,r,s)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys((e,t,s)=>{this.notifyListeners(e,s)});const s=e.key;t?this.detachListener():this.stopPolling();const r=()=>{const e=this.storage.getItem(s);(t||this.localCache[s]!==e)&&this.notifyListeners(s,e)},n=this.storage.getItem(s);rm()&&n!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:s}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(e,t){return g(this,null,function*(){yield p(Gm.prototype,this,"_set").call(this,e,t),this.localCache[e]=JSON.stringify(t)})}_get(e){return g(this,null,function*(){const t=yield p(Gm.prototype,this,"_get").call(this,e);return this.localCache[e]=JSON.stringify(t),t})}_remove(e){return g(this,null,function*(){yield p(Gm.prototype,this,"_remove").call(this,e),delete this.localCache[e]})}}Gm.type="LOCAL";const Wm=Gm;
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class Jm extends Hm{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Jm.type="SESSION";const Qm=Jm;
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Ym{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;const s=new Ym(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}handleEvent(e){return g(this,null,function*(){const t=e,{eventId:s,eventType:r,data:n}=t.data,i=this.handlersMap[r];if(!(null==i?void 0:i.size))return;t.ports[0].postMessage({status:"ack",eventId:s,eventType:r});const a=Array.from(i).map(e=>g(this,null,function*(){return e(t.origin,n)})),o=yield function(e){return Promise.all(e.map(e=>g(this,null,function*(){try{return{fulfilled:!0,value:yield e}}catch(t){return{fulfilled:!1,reason:t}}})))}(a);t.ports[0].postMessage({status:"done",eventId:s,eventType:r,response:o})})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function Xm(e="",t=10){let s="";for(let r=0;r<t;r++)s+=Math.floor(10*Math.random());return e+s}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */Ym.receivers=[];class Zm{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}_send(e,t,s=50){return g(this,null,function*(){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let n,i;return new Promise((a,o)=>{const l=Xm("",20);r.port1.start();const c=setTimeout(()=>{o(new Error("unsupported_event"))},s);i={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===l)switch(t.data.status){case"ack":clearTimeout(c),n=setTimeout(()=>{o(new Error("timeout"))},3e3);break;case"done":clearTimeout(n),a(t.data.response);break;default:clearTimeout(c),clearTimeout(n),o(new Error("invalid_response"))}}},this.handlers.add(i),r.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[r.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})})}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function ep(){return window}
/**
     * @license
     * Copyright 2020 Google LLC.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function tp(){return void 0!==ep().WorkerGlobalScope&&"function"==typeof ep().importScripts}
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const sp="firebaseLocalStorageDb",rp="firebaseLocalStorage",np="fbase_key";class ip{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function ap(e,t){return e.transaction([rp],t?"readwrite":"readonly").objectStore(rp)}function op(){const e=indexedDB.open(sp,1);return new Promise((t,s)=>{e.addEventListener("error",()=>{s(e.error)}),e.addEventListener("upgradeneeded",()=>{const t=e.result;try{t.createObjectStore(rp,{keyPath:np})}catch(r){s(r)}}),e.addEventListener("success",()=>g(this,null,function*(){const s=e.result;s.objectStoreNames.contains(rp)?t(s):(s.close(),yield function(){const e=indexedDB.deleteDatabase(sp);return new ip(e).toPromise()}(),t(yield op()))}))})}function lp(e,t,s){return g(this,null,function*(){const r=ap(e,!0).put({[np]:t,value:s});return new ip(r).toPromise()})}function cp(e,t){const s=ap(e,!0).delete(t);return new ip(s).toPromise()}class dp{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){return g(this,null,function*(){return this.db||(this.db=yield op()),this.db})}_withRetries(e){return g(this,null,function*(){let t=0;for(;;)try{const t=yield this._openDb();return yield e(t)}catch(s){if(t++>3)throw s;this.db&&(this.db.close(),this.db=void 0)}})}initializeServiceWorkerMessaging(){return g(this,null,function*(){return tp()?this.initializeReceiver():this.initializeSender()})}initializeReceiver(){return g(this,null,function*(){this.receiver=Ym._getInstance(tp()?self:null),this.receiver._subscribe("keyChanged",(e,t)=>g(this,null,function*(){return{keyProcessed:(yield this._poll()).includes(t.key)}})),this.receiver._subscribe("ping",(e,t)=>g(this,null,function*(){return["keyChanged"]}))})}initializeSender(){return g(this,null,function*(){var e,t;if(this.activeServiceWorker=yield function(){return g(this,null,function*(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(yield navigator.serviceWorker.ready).active}catch(e){return null}})}(),!this.activeServiceWorker)return;this.sender=new Zm(this.activeServiceWorker);const s=yield this.sender._send("ping",{},800);s&&(null==(e=s[0])?void 0:e.fulfilled)&&(null==(t=s[0])?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)})}notifyServiceWorker(e){return g(this,null,function*(){var t;if(this.sender&&this.activeServiceWorker&&((null==(t=null==navigator?void 0:navigator.serviceWorker)?void 0:t.controller)||null)===this.activeServiceWorker)try{yield this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(s){}})}_isAvailable(){return g(this,null,function*(){try{if(!indexedDB)return!1;const e=yield op();return yield lp(e,Km,"1"),yield cp(e,Km),!0}catch(e){}return!1})}_withPendingWrite(e){return g(this,null,function*(){this.pendingWrites++;try{yield e()}finally{this.pendingWrites--}})}_set(e,t){return g(this,null,function*(){return this._withPendingWrite(()=>g(this,null,function*(){return yield this._withRetries(s=>lp(s,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)}))})}_get(e){return g(this,null,function*(){const t=yield this._withRetries(t=>function(e,t){return g(this,null,function*(){const s=ap(e,!1).get(t),r=yield new ip(s).toPromise();return void 0===r?null:r.value})}(t,e));return this.localCache[e]=t,t})}_remove(e){return g(this,null,function*(){return this._withPendingWrite(()=>g(this,null,function*(){return yield this._withRetries(t=>cp(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)}))})}_poll(){return g(this,null,function*(){const e=yield this._withRetries(e=>{const t=ap(e,!1).getAll();return new ip(t).toPromise()});if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],s=new Set;if(0!==e.length)for(const{fbase_key:r,value:n}of e)s.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(n)&&(this.notifyListeners(r,n),t.push(r));for(const r of Object.keys(this.localCache))this.localCache[r]&&!s.has(r)&&(this.notifyListeners(r,null),t.push(r));return t})}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const r of Array.from(s))r(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>g(this,null,function*(){return this._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}dp.type="LOCAL";const up=dp;new mh(3e4,6e4);
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class hp extends wm{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return _m(e,this._buildIdpRequest())}_linkToIdToken(e,t){return _m(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return _m(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function mp(e){return Bm(e.auth,new hp(e),e.bypassAuthState)}function pp(e){const{auth:t,user:s}=e;return oh(s,t,"internal-error"),
/**
     * @license
     * Copyright 2019 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function(e,t,s=!1){return g(this,null,function*(){const{auth:r}=e;if(ys(r.app))return Promise.reject(ih(r));const n="reauthenticate";try{const i=yield Rh(e,Vm(r,n,t,e),s);oh(i.idToken,r,"internal-error");const a=Ph(i.idToken);oh(a,r,"internal-error");const{sub:o}=a;return oh(e.uid===o,r,"user-mismatch"),Fm._forOperation(e,n,i)}catch(i){throw"auth/user-not-found"===(null==i?void 0:i.code)&&sh(r,"user-mismatch"),i}})}(s,new hp(e),e.bypassAuthState)}function gp(e){return g(this,null,function*(){const{auth:t,user:s}=e;return oh(s,t,"internal-error"),function(e,t,s=!1){return g(this,null,function*(){const r=yield Rh(e,t._linkToIdToken(e.auth,yield e.getIdToken()),s);return Fm._forOperation(e,"link",r)})}(s,new hp(e),e.bypassAuthState)})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class fp{constructor(e,t,s,r,n=!1){this.auth=e,this.resolver=s,this.user=r,this.bypassAuthState=n,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((e,t)=>g(this,null,function*(){this.pendingPromise={resolve:e,reject:t};try{this.eventManager=yield this.resolver._initialize(this.auth),yield this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}}))}onAuthEvent(e){return g(this,null,function*(){const{urlResponse:t,sessionId:s,postBody:r,tenantId:n,error:i,type:a}=e;if(i)return void this.reject(i);const o={auth:this.auth,requestUri:t,sessionId:s,tenantId:n||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(yield this.getIdpTask(a)(o))}catch(l){this.reject(l)}})}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return mp;case"linkViaPopup":case"linkViaRedirect":return gp;case"reauthViaPopup":case"reauthViaRedirect":return pp;default:sh(this.auth,"internal-error")}}resolve(e){ch(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){ch(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const xp=new mh(2e3,1e4);class yp extends fp{constructor(e,t,s,r,n){super(e,t,r,n),this.provider=s,this.authWindow=null,this.pollId=null,yp.currentPopupAction&&yp.currentPopupAction.cancel(),yp.currentPopupAction=this}executeNotNull(){return g(this,null,function*(){const e=yield this.execute();return oh(e,this.auth,"internal-error"),e})}onExecution(){return g(this,null,function*(){ch(1===this.filter.length,"Popup operations only handle one event");const e=Xm();this.authWindow=yield this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(rh(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()})}get eventId(){var e;return(null==(e=this.authWindow)?void 0:e.associatedEvent)||null}cancel(){this.reject(rh(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,yp.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,s;(null==(s=null==(t=this.authWindow)?void 0:t.window)?void 0:s.closed)?this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(rh(this.auth,"popup-closed-by-user"))},8e3):this.pollId=window.setTimeout(e,xp.get())};e()}}yp.currentPopupAction=null;
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const bp="pendingRedirect",vp=new Map;class Np extends fp{constructor(e,t,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,s),this.eventId=null}execute(){return g(this,null,function*(){let e=vp.get(this.auth._key());if(!e){try{const t=(yield function(e,t){return g(this,null,function*(){const s=function(e){return Hh(bp,e.config.apiKey,e.name)}(t),r=function(e){return $h(e._redirectPersistence)}(e);if(!(yield r._isAvailable()))return!1;const n="true"===(yield r._get(s));return yield r._remove(s),n})}(this.resolver,this.auth))?yield p(Np.prototype,this,"execute").call(this):null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}vp.set(this.auth._key(),e)}return this.bypassAuthState||vp.set(this.auth._key(),()=>Promise.resolve(null)),e()})}onAuthEvent(e){return g(this,null,function*(){if("signInViaRedirect"===e.type)return p(Np.prototype,this,"onAuthEvent").call(this,e);if("unknown"!==e.type){if(e.eventId){const t=yield this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,p(Np.prototype,this,"onAuthEvent").call(this,e);this.resolve(null)}}else this.resolve(null)})}onExecution(){return g(this,null,function*(){})}cleanUp(){}}function wp(e,t){vp.set(e._key(),t)}function jp(e,t,s=!1){return g(this,null,function*(){if(ys(e.app))return Promise.reject(ih(e));const r=cm(e),n=
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function(e,t){return t?$h(t):(oh(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}(r,t),i=new Np(r,n,s),a=yield i.execute();return a&&!s&&(delete a.user._redirectEventId,yield r._persistUserIfCurrent(a.user),yield r._setRedirectUser(null,t)),a})}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */class kp{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(t=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return _p(e);default:return!1}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var s;if(e.error&&!_p(e)){const r=(null==(s=e.error.code)?void 0:s.split("auth/")[1])||"internal-error";t.onError(rh(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const s=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Sp(e))}saveEventToCache(e){this.cachedEventUids.add(Sp(e)),this.lastProcessedEventTime=Date.now()}}function Sp(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function _p({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const Ip=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Cp=/^https?/;function Ep(e){return g(this,null,function*(){if(e.config.emulator)return;const{authorizedDomains:t}=yield function(e){return g(this,arguments,function*(e,t={}){return vh(e,"GET","/v1/projects",t)})}(e);for(const e of t)try{if(Tp(e))return}catch(s){}sh(e,"unauthorized-domain")})}function Tp(e){const t=dh(),{protocol:s,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const n=new URL(e);return""===n.hostname&&""===r?"chrome-extension:"===s&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===s&&n.hostname===r}if(!Cp.test(s))return!1;if(Ip.test(e))return r===e;const n=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+n+"|"+n+")$","i").test(r)}
/**
     * @license
     * Copyright 2020 Google LLC.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Ap=new mh(3e4,6e4);function Pp(){const e=ep().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let s=0;s<e.CP.length;s++)e.CP[s]=null}function Dp(e){return new Promise((t,s)=>{var r,n,i;function a(){Pp(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{Pp(),s(rh(e,"network-request-failed"))},timeout:Ap.get()})}if(null==(n=null==(r=ep().gapi)?void 0:r.iframes)?void 0:n.Iframe)t(gapi.iframes.getContext());else{if(!(null==(i=ep().gapi)?void 0:i.load)){const t=`__iframefcb${Math.floor(1e6*Math.random())}`;return ep()[t]=()=>{gapi.load?a():s(rh(e,"network-request-failed"))},hm(`${um.gapiScript}?onload=${t}`).catch(e=>s(e))}a()}}).catch(e=>{throw Rp=null,e})}let Rp=null;
/**
     * @license
     * Copyright 2020 Google LLC.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const Op=new mh(5e3,15e3),Lp={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Fp=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Mp(e){const t=e.config;oh(t.authDomain,e,"auth-domain-config-required");const s=t.emulator?ph(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:Ns},n=Fp.get(e.config.apiHost);n&&(r.eid=n);const i=e._getFrameworks();return i.length&&(r.fw=i.join(",")),`${s}?${et(r).slice(1)}`}function Up(e){return g(this,null,function*(){const t=yield function(e){return Rp=Rp||Dp(e),Rp}(e),s=ep().gapi;return oh(s,e,"internal-error"),t.open({where:document.body,url:Mp(e),messageHandlersFilter:s.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Lp,dontclear:!0},t=>new Promise((s,r)=>g(this,null,function*(){yield t.restyle({setHideOnLeave:!1});const n=rh(e,"network-request-failed"),i=ep().setTimeout(()=>{r(n)},Op.get());function a(){ep().clearTimeout(i),s(t)}t.ping(a).then(a,()=>{r(n)})})))})}
/**
     * @license
     * Copyright 2020 Google LLC.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */const Vp={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Bp{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function zp(e,t,s,r=500,n=600){const i=Math.max((window.screen.availHeight-n)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let o="";const l=u(d({},Vp),{width:r.toString(),height:n.toString(),top:i,left:a}),c=Ge().toLowerCase();s&&(o=Yh(c)?"_blank":s),Jh(c)&&(t=t||"http://localhost",l.scrollbars="yes");const h=Object.entries(l).reduce((e,[t,s])=>`${e}${t}=${s},`,"");if(function(e=Ge()){var t;return sm(e)&&!!(null==(t=window.navigator)?void 0:t.standalone)}(c)&&"_self"!==o)return function(e,t){const s=document.createElement("a");s.href=e,s.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),s.dispatchEvent(r)}
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(t||"",o),new Bp(null);const m=window.open(t||"",o,h);oh(m,e,"popup-blocked");try{m.focus()}catch(p){}return new Bp(m)}const $p="__/auth/handler",qp="emulator/auth/handler",Kp=encodeURIComponent("fac");function Hp(e,t,s,r,n,i){return g(this,null,function*(){oh(e.config.authDomain,e,"auth-domain-config-required"),oh(e.config.apiKey,e,"invalid-api-key");const i={apiKey:e.config.apiKey,appName:e.name,authType:s,redirectUrl:r,v:Ns,eventId:n};if(t instanceof Tm){t.setDefaultLanguage(e.languageCode),i.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(i.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries({}))i[e]=t}if(t instanceof Am){const e=t.getScopes().filter(e=>""!==e);e.length>0&&(i.scopes=e.join(","))}e.tenantId&&(i.tid=e.tenantId);const a=i;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];const o=yield e._getAppCheckToken(),l=o?`#${Kp}=${encodeURIComponent(o)}`:"";return`${function({config:e}){return e.emulator?ph(e,qp):`https://${e.authDomain}/${$p}`}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(e)}?${et(a).slice(1)}${l}`})}const Gp="webStorageSupport",Wp=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Qm,this._completeRedirectFn=jp,this._overrideRedirectResult=wp}_openPopup(e,t,s,r){return g(this,null,function*(){var n;ch(null==(n=this.eventManagers[e._key()])?void 0:n.manager,"_initialize() not called before _openPopup()");const i=yield Hp(e,t,s,dh(),r);return zp(e,i,Xm())})}_openRedirect(e,t,s,r){return g(this,null,function*(){return yield this._originValidation(e),function(e){ep().location.href=e}(yield Hp(e,t,s,dh(),r)),new Promise(()=>{})})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:s}=this.eventManagers[t];return e?Promise.resolve(e):(ch(s,"If manager is not set, promise should be"),s)}const s=this.initAndGetManager(e);return this.eventManagers[t]={promise:s},s.catch(()=>{delete this.eventManagers[t]}),s}initAndGetManager(e){return g(this,null,function*(){const t=yield Up(e),s=new kp(e);return t.register("authEvent",t=>(oh(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:s.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=t,s})}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Gp,{type:Gp},s=>{var r;const n=null==(r=null==s?void 0:s[0])?void 0:r[Gp];void 0!==n&&t(!!n),sh(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Ep(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return nm()||Qh()||sm()}};var Jp="@firebase/auth",Qp="1.11.0";
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
class Yp{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null==(e=this.auth.currentUser)?void 0:e.uid)||null}getToken(e){return g(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){oh(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2021 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
const Xp=Ue("authIdTokenMaxAge")||300;let Zp=null;function eg(t=js()){const s=xs(t,"auth");if(s.isInitialized())return s.getImmediate();const r=function(e,t){const s=xs(e,"auth");if(s.isInitialized()){const e=s.getImmediate();if(Xe(s.getOptions(),null!=t?t:{}))return e;sh(e,"already-initialized")}return s.initialize({options:t})}(t,{popupRedirectResolver:Wp,persistence:[up,Wm,Qm]}),n=Ue("authTokenSyncURL");if(n&&"boolean"==typeof isSecureContext&&isSecureContext){const t=new URL(n,location.origin);if(location.origin===t.origin){const s=(i=t.toString(),t=>g(e,null,function*(){const e=t&&(yield t.getIdTokenResult()),s=e&&((new Date).getTime()-Date.parse(e.issuedAtTime))/1e3;if(s&&s>Xp)return;const r=null==e?void 0:e.token;Zp!==r&&(Zp=r,yield fetch(i,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))}));!function(e,t,s){it(e).beforeAuthStateChanged(t,s)}(r,s,()=>s(r.currentUser)),function(e,t,s,r){it(e).onIdTokenChanged(t,s,r)}(r,e=>s(e))}}var i;const a=Le("auth");return a&&bm(r,`http://${a}`),r}var tg;um={loadJS:e=>new Promise((t,s)=>{const r=document.createElement("script");var n,i;r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=rh("internal-error");t.customData=e,s(t)},r.type="text/javascript",r.charset="UTF-8",(null!=(i=null==(n=document.getElementsByTagName("head"))?void 0:n[0])?i:document).appendChild(r)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},tg="Browser",fs(new at("auth",(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),n=e.getProvider("app-check-internal"),{apiKey:i,authDomain:a}=s.options;oh(i&&!i.includes(":"),"invalid-api-key",{appName:s.name});const o={apiKey:i,authDomain:a,clientPlatform:tg,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:im(tg)},l=new lm(s,r,n,o);return function(e,t){const s=(null==t?void 0:t.persistence)||[],r=(Array.isArray(s)?s:[s]).map($h);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(l,t),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,s)=>{e.getProvider("auth-internal").initialize()})),fs(new at("auth-internal",e=>{const t=cm(e.getProvider("auth").getImmediate());return new Yp(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),ks(Jp,Qp,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(tg)),ks(Jp,Qp,"esm2020");const sg=ws({apiKey:"AIzaSyDYGOfg7BSk1W8KuqjA0RzVMGOmfKZdOUs",authDomain:"azzahra-fashion-muslim-ab416.firebaseapp.com",projectId:"azzahra-fashion-muslim-ab416",storageBucket:"azzahra-fashion-muslim-ab416.firebasestorage.app",messagingSenderId:"822661485961",appId:"1:822661485961:web:4603488d8bef0119f3fd58",measurementId:"G-NZSXEKPQER"});console.log("âœ… Firebase initialized");const rg=function(e){const t="object"==typeof e?e:js(),s="string"==typeof e?e:kn,r=xs(t,"firestore").getImmediate({identifier:s});if(!r._initialized){const e=Fe("firestore");e&&function(e,t,s,r={}){var n;e=Or(e,fd);const i=Be(t),a=e._getSettings(),o=u(d({},a),{emulatorOptions:e._getEmulatorOptions()}),l=`${t}:${s}`;i&&(ze(`https://${l}`),He("Firestore",!0)),a.host!==md&&a.host!==l&&tr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c=u(d({},a),{host:l,ssl:i,emulatorOptions:r});if(!Xe(c,o)&&(e._setSettings(c),r.mockUserToken)){let t,s;if("string"==typeof r.mockUserToken)t=r.mockUserToken,s=Js.MOCK_USER;else{t=$e(r.mockUserToken,null==(n=e._app)?void 0:n.options.projectId);const i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new lr(or.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");s=new Js(i)}e._authCredentials=new hr(new dr(t,s))}}(r,...e)}return r}(sg);!function(e=js(),t){const s=xs(e=it(e),Ju).getImmediate({identifier:t}),r=Fe("storage");r&&function(e,t,s,r={}){!function(e,t,s,r={}){e.host=`${t}:${s}`;const n=Be(t);n&&(ze(`https://${e.host}/b`),He("Storage",!0)),e._isUsingEmulator=!0,e._protocol=n?"https":"http";const{mockUserToken:i}=r;i&&(e._overrideAuthToken="string"==typeof i?i:$e(i,e.app.options.projectId))}(e,t,s,r)}(s,...r)}(sg);const ng=eg(sg),ig="current-flash-sale",ag=()=>{const[t,s]=f.useState(null),[r,n]=f.useState(""),[i,a]=f.useState(!0),o=()=>g(e,null,function*(){try{console.log("ðŸ§¹ Firebase Flash Sale: Cleaning up flash sale products...");const t=ru(vd(rg,"products"),iu("isFlashSale","==",!0)),s=yield wu(t);console.log(`ðŸ§¹ Firebase Flash Sale: Found ${s.docs.length} flash sale products to clean`);const r=s.docs.map(t=>g(e,null,function*(){const e=Nd(rg,"products",t.id);yield ku(e,{isFlashSale:!1,flashSalePrice:null}),console.log(`ðŸ§¹ Firebase Flash Sale: Cleared flash sale from product ${t.id}`)}));yield Promise.all(r),console.log("âœ… Firebase Flash Sale: All flash sale products cleaned successfully")}catch(t){throw console.error("âŒ Firebase Flash Sale: Error cleaning flash sale products:",t),t}});f.useEffect(()=>{a(!0),console.log("ðŸ”¥ Firebase Flash Sale: Initializing real-time listener");const e=_u(Nd(rg,"flashSales",ig),e=>{if(e.exists()){const t=d({id:e.id},e.data());s(t),console.log("âœ… Firebase Flash Sale: Config loaded from Firebase"),console.log("ðŸ“… Flash sale ends at:",t.endTime),console.log("â° Current time:",(new Date).toISOString()),console.log("ðŸ”¥ Firebase Flash Sale: Active status:",t.isActive)}else console.log("ðŸ“ Firebase Flash Sale: No active flash sale found"),s(null);a(!1)},e=>{console.error("âŒ Firebase Flash Sale: Error listening to config:",e),a(!1)});return()=>{e(),console.log("ðŸ”¥ Firebase Flash Sale: Listener disconnected")}},[]),f.useEffect(()=>{if(!t||!t.isActive)return void n("");const e=setInterval(()=>{const e=(new Date).getTime(),s=new Date(t.endTime).getTime()-e;if(s>0){const e=Math.floor(s/864e5),t=Math.floor(s%864e5/36e5),r=Math.floor(s%36e5/6e4),i=Math.floor(s%6e4/1e3);n(e>0?`${e} hari ${t} jam ${r} menit`:t>0?`${t} jam ${r} menit ${i} detik`:`${r} menit ${i} detik`)}else console.log("â° Firebase Flash Sale: Flash sale has ended!"),t.id&&(c({isActive:!1}),o()),window.dispatchEvent(new CustomEvent("flashSaleEnded",{detail:{timestamp:(new Date).toISOString(),reason:"time_expired",configId:t.id}})),n("Flash Sale Berakhir")},1e3);return()=>clearInterval(e)},[t,o]);const l=t=>g(e,null,function*(){try{const e=Nd(rg,"flashSales",ig),s=u(d({id:ig},t),{createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()});return yield ju(e,s),console.log("âœ… Firebase Flash Sale: Flash sale created successfully"),s}catch(e){throw console.error("âŒ Firebase Flash Sale: Error creating flash sale:",e),e}}),c=s=>g(e,null,function*(){try{if(!(null==t?void 0:t.id))return;const e=Nd(rg,"flashSales",t.id);yield ku(e,u(d({},s),{updatedAt:(new Date).toISOString()})),console.log("âœ… Firebase Flash Sale: Flash sale updated successfully")}catch(e){throw console.error("âŒ Firebase Flash Sale: Error updating flash sale:",e),e}});return{flashSaleConfig:t,timeLeft:r,loading:i,isFlashSaleActive:(null==t?void 0:t.isActive)||!1,createFlashSale:l,updateFlashSale:c,startFlashSale:t=>g(e,null,function*(){try{const e=u(d({},t),{isActive:!0});yield l(e),console.log("âœ… Firebase Flash Sale: Flash sale started successfully")}catch(e){throw console.error("âŒ Firebase Flash Sale: Error starting flash sale:",e),e}}),stopFlashSale:()=>g(e,null,function*(){try{if(!(null==t?void 0:t.id))return;yield c({isActive:!1}),yield o(),console.log("âœ… Firebase Flash Sale: Flash sale stopped successfully")}catch(e){throw console.error("âŒ Firebase Flash Sale: Error stopping flash sale:",e),e}}),isProductInFlashSale:e=>{if(!(null==t?void 0:t.isActive)||!e)return!1;const s=t.products||[],r=t.productIds||[],n=s.includes(e),i=r.includes(e);return n||i}}},og=({product:e,onProductClick:t,onAddToCart:s,isFlashSale:r=!1,isFeatured:n=!1,user:i})=>{var a;const[o,l]=f.useState(!1),{isFlashSaleActive:c,isProductInFlashSale:d}=ag(),u=e=>{e.stopPropagation(),"reseller"!==(null==i?void 0:i.role)&&l(!o)},h=t=>{t.stopPropagation();const s=encodeURIComponent(`Halo Admin, saya tertarik dengan produk ${e.name} dan ingin menanyakan tentang harga reseller. Mohon info lebih lanjut. Terima kasih.`);window.open(`https://wa.me/6287815990944?text=${s}`,"_blank"),l(!1)};return we.jsxs("div",{onClick:()=>t(e),className:"bg-white rounded-lg shadow-md hover:shadow-lg transition-all duration-300 cursor-pointer group overflow-hidden "+(n?"ring-2 ring-yellow-400 shadow-lg":""),children:[we.jsxs("div",{className:"relative",children:[we.jsx("img",{src:e.image||(null==(a=e.images)?void 0:a[0])||"/placeholder-product.jpg",alt:e.name,className:"w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300",onError:e=>{const t=e.target;t.style.display="none";const s=t.parentElement;s&&(s.style.background="linear-gradient(135deg, #667eea 0%, #764ba2 100%)",s.innerHTML='<div class="flex items-center justify-center h-full text-white text-center p-4"><div><div class="text-2xl mb-2">ðŸ“¦</div><div class="text-sm">No Image</div></div></div>')}}),(()=>{const t="ready"===e.status?`Ready (${e.stock})`:`PO (${e.stock})`;return we.jsx("div",{className:"absolute top-2 left-2 text-xs px-2 py-1 rounded font-medium "+("ready"===e.status?"bg-green-500 text-white":"bg-orange-500 text-white"),children:t})})(),n&&we.jsx("div",{className:"absolute top-2 right-2 bg-yellow-400 text-white p-1.5 rounded-full shadow-lg",children:we.jsx(b,{className:"w-4 h-4 fill-current"})}),we.jsx("div",{className:"absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:we.jsx("button",{onClick:t=>{t.stopPropagation(),s(e)},className:"bg-pink-500 text-white p-2 rounded-full hover:bg-pink-600 transition-colors shadow-lg",children:we.jsx(v,{className:"w-4 h-4"})})})]}),we.jsxs("div",{className:"p-4",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-3 line-clamp-2 group-hover:text-pink-600 transition-colors",children:e.name}),(()=>{const t=d(e.id)&&e.isFlashSale&&e.flashSalePrice>0;return console.log("ðŸ·ï¸ ProductCard Debug (Firebase):",{productName:e.name,productId:e.id,isFlashSaleActive:c,isProductInFlashSale:d(e.id),productIsFlashSale:e.isFlashSale,isThisProductInFlashSale:t,isFlashSaleProp:r,retailPrice:e.retailPrice,flashSalePrice:e.flashSalePrice,originalRetailPrice:e.originalRetailPrice,calculatedOriginalPrice:e.originalRetailPrice||e.retailPrice,discountPercent:Math.round(100*(1-e.flashSalePrice/(e.originalRetailPrice||e.retailPrice)))}),t?we.jsxs("div",{className:"space-y-1",children:[we.jsxs("div",{className:"flex items-center space-x-2",children:[we.jsxs("span",{className:"text-lg font-bold text-red-600",children:["Rp ",e.flashSalePrice.toLocaleString("id-ID")]}),we.jsxs("span",{className:"bg-red-100 text-red-600 text-xs px-2 py-1 rounded",children:["-",Math.round(100*(1-e.flashSalePrice/(e.originalRetailPrice||e.retailPrice))),"%"]})]}),we.jsxs("div",{className:"text-sm text-gray-500 line-through",children:["Rp ",(e.originalRetailPrice||e.retailPrice).toLocaleString("id-ID")]})]}):we.jsxs("div",{className:"space-y-1 relative",children:[we.jsxs("div",{className:"text-lg font-bold text-pink-600",children:["Rp ",e.retailPrice.toLocaleString("id-ID")]}),we.jsxs("div",{className:"relative",children:["reseller"===(null==i?void 0:i.role)?we.jsxs("div",{className:"text-sm text-pink-600",children:["Reseller: Rp ",e.resellerPrice.toLocaleString("id-ID")]}):we.jsxs("button",{onClick:u,className:"text-sm text-pink-600 hover:text-pink-700 font-medium transition-colors flex items-center space-x-1",children:[we.jsxs("span",{children:["Reseller: Rp ",e.resellerPrice.toLocaleString("id-ID")]}),we.jsx(N,{className:"w-3 h-3 transition-transform "+(o?"rotate-180":"")})]}),o&&"reseller"!==(null==i?void 0:i.role)&&we.jsxs("div",{className:"absolute bottom-full left-0 right-0 mb-2 bg-white rounded-lg shadow-lg border border-gray-200 z-10",children:[we.jsxs("button",{onClick:h,className:"w-full px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors flex items-center space-x-2 rounded-t-lg",children:[we.jsx(w,{className:"w-4 h-4 text-green-600"}),we.jsx("span",{children:"Info Reseller via WhatsApp"})]}),we.jsx("div",{className:"text-xs text-gray-500 px-3 pb-2 text-center",children:"Hubungi admin untuk harga reseller"})]})]})]})})()]})]})},lg=({onBannerClick:e})=>{const[t,s]=f.useState(0),[r,n]=f.useState([]),i=[];return f.useEffect(()=>{const e=localStorage.getItem("azzahra-banners");if(e)try{const t=JSON.parse(e);n([...i,...t])}catch(t){n(i)}else n(i)},[]),f.useEffect(()=>{if(r.length<=1)return;const e=setInterval(()=>{s(e=>(e+1)%r.length)},3e3);return()=>clearInterval(e)},[r.length]),0===r.length?null:we.jsxs("div",{className:"relative w-full h-48 md:h-56 lg:h-64 overflow-hidden rounded-lg",children:[we.jsx("div",{className:"relative h-full",children:r.map((s,r)=>we.jsx("div",{className:"absolute inset-0 transition-opacity duration-500 "+(r===t?"opacity-100":"opacity-0"),children:we.jsx("div",{className:"w-full h-full cursor-pointer "+("flashsale"===s.type?"bg-gradient-to-r from-red-500 to-pink-500":"bg-gradient-to-r from-purple-500 to-pink-500"),onClick:()=>(t=>{e&&e(t)})(s),children:we.jsx("div",{className:"flex items-center justify-center h-full p-8 text-white",children:we.jsxs("div",{className:"text-center",children:["flashsale"===s.type&&we.jsx(j,{className:"w-8 h-8 mx-auto mb-2"}),we.jsx("h2",{className:"text-2xl md:text-3xl font-bold mb-2",children:s.title}),"flashsale"===s.type&&we.jsx("p",{className:"text-red-100",children:"Diskon terbatas! Buruan sebelum kehabisan!"}),"promo"===s.type&&we.jsx("p",{className:"text-purple-100",children:"Promo spesial untuk Anda!"})]})})})},s.id))}),r.length>1&&we.jsxs(we.Fragment,{children:[we.jsx("button",{onClick:()=>{s(e=>(e-1+r.length)%r.length)},className:"absolute left-4 top-1/2 transform -translate-y-1/2 bg-white/20 hover:bg-white/30 rounded-full p-2 transition-colors",children:we.jsx(k,{className:"w-5 h-5 text-white"})}),we.jsx("button",{onClick:()=>{s(e=>(e+1)%r.length)},className:"absolute right-4 top-1/2 transform -translate-y-1/2 bg-white/20 hover:bg-white/30 rounded-full p-2 transition-colors",children:we.jsx(S,{className:"w-5 h-5 text-white"})})]}),r.length>1&&we.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2",children:r.map((e,r)=>we.jsx("button",{onClick:()=>s(r),className:"w-2 h-2 rounded-full transition-colors "+(r===t?"bg-white":"bg-white/50")},r))})]})};function cg(e){return e&&"object"==typeof e&&e.id&&e.name?d({id:String(e.id),name:String(e.name),description:e.description?String(e.description):"",category:e.category?String(e.category):"other",images:Array.isArray(e.images)?e.images:[],variants:e.variants&&"object"==typeof e.variants?{sizes:Array.isArray(e.variants.sizes)?e.variants.sizes:[],colors:Array.isArray(e.variants.colors)?e.variants.colors:[]}:{sizes:[],colors:[]},retailPrice:"number"==typeof e.retailPrice?e.retailPrice:0,resellerPrice:"number"==typeof e.resellerPrice?e.resellerPrice:0,costPrice:"number"==typeof e.costPrice?e.costPrice:0,stock:"number"==typeof e.stock?e.stock:0,status:"ready"===e.status||"po"===e.status?e.status:"ready",isFlashSale:Boolean(e.isFlashSale),flashSalePrice:"number"==typeof e.flashSalePrice?e.flashSalePrice:0,createdAt:e.createdAt?e.createdAt instanceof Date?e.createdAt:new Date(e.createdAt):new Date,salesCount:"number"==typeof e.salesCount?e.salesCount:0,isFeatured:Boolean(e.isFeatured),featuredOrder:"number"==typeof e.featuredOrder?e.featuredOrder:void 0},Object.keys(e).reduce((t,s)=>(["id","name","description","category","images","variants","retailPrice","resellerPrice","costPrice","stock","status","isFlashSale","flashSalePrice","createdAt","salesCount","isFeatured","featuredOrder"].includes(s)||(t[s]=e[s]),t),{})):null}const dg=new class{constructor(){m(this,"FIREBASE_COLLECTION","user_carts")}getCart(){return g(this,null,function*(){try{const e=ng.currentUser;if(!e)return console.log("âŒ No user logged in - cart requires authentication"),[];console.log("ðŸ”¥ Loading cart from Firebase for user:",e.uid);const t=yield this.getCartFromFirebase(e.uid);return t&&t.length>0?(console.log("âœ… Cart loaded from Firebase:",t.length,"items"),t):(console.log("â„¹ï¸ No cart found in Firebase - returning empty cart"),[])}catch(e){return console.error("âŒ Error getting cart from Firebase:",e),[]}})}onCartChange(e){const t=ng.currentUser;return t?(console.log("ðŸ”„ Setting up real-time cart listener for user:",t.uid),_u(Nd(rg,this.FIREBASE_COLLECTION,t.uid),t=>{if(t.exists()){const s=t.data(),r=(null==s?void 0:s.items)||[];console.log("ðŸ“¦ Real-time cart update:",r.length,"items"),e(r)}else console.log("ðŸ“¦ Real-time cart update: empty cart"),e([])},e=>{console.error("âŒ Real-time cart listener error:",e)})):(console.log("âŒ No user for real-time cart listener"),()=>{})}addToCart(e){return g(this,null,function*(){try{const t=ng.currentUser;if(!t)throw new Error("User not authenticated - cannot add to cart");const s=u(d({},e),{id:this.generateId(),addedAt:(new Date).toISOString()}),r=yield this.getCart(),n=r.findIndex(t=>t.productId===e.productId&&JSON.stringify(t.variant)===JSON.stringify(e.variant));let i;return i=-1!==n?r.map((e,t)=>t===n?u(d({},e),{quantity:e.quantity+s.quantity}):e):[...r,s],yield this.saveCartToFirebase(t.uid,i),console.log("âœ… Cart updated in Firebase:",i.length,"items"),i}catch(t){throw console.error("Error adding to cart:",t),t}})}updateQuantity(e,t){return g(this,null,function*(){try{const s=ng.currentUser;if(!s)throw new Error("User not authenticated - cannot update cart");if(0===t)return this.removeFromCart(e);const r=(yield this.getCart()).map(s=>s.id===e?u(d({},s),{quantity:t}):s);return yield this.saveCartToFirebase(s.uid,r),console.log("âœ… Cart quantity updated in Firebase"),r}catch(s){throw console.error("Error updating quantity:",s),s}})}removeFromCart(e){return g(this,null,function*(){try{const t=ng.currentUser;if(!t)throw new Error("User not authenticated - cannot remove from cart");const s=(yield this.getCart()).filter(t=>t.id!==e);return yield this.saveCartToFirebase(t.uid,s),console.log("âœ… Item removed from Firebase cart:",e),s}catch(t){throw console.error("Error removing from cart:",t),t}})}clearCart(){return g(this,null,function*(){try{console.log("ðŸ—‘ï¸ Clearing cart from Firebase...");const e=ng.currentUser;if(!e)return void console.log("âŒ No user logged in - cannot clear cart");yield this.saveCartToFirebase(e.uid,[]),console.log("ðŸ”¥ Firebase cart cleared for user:",e.uid),yield new Promise(e=>setTimeout(e,300));const t=yield this.getCartFromFirebase(e.uid);t&&t.length>0&&(console.warn("âš ï¸ Firebase still has items, forcing clear again..."),yield this.saveCartToFirebase(e.uid,[])),console.log("âœ… Cart PERMANENTLY cleared from Firebase - all devices")}catch(e){throw console.error("âŒ Error clearing cart:",e),e}})}handleLogout(){return g(this,null,function*(){try{ng.currentUser&&(yield this.clearCart(),console.log("âœ… Cart cleared on logout"))}catch(e){console.error("Error handling logout:",e)}})}getCartTotal(){return g(this,null,function*(){return(yield this.getCart()).reduce((e,t)=>e+t.price*t.quantity,0)})}getCartCount(){return g(this,null,function*(){return(yield this.getCart()).reduce((e,t)=>e+t.quantity,0)})}isInCart(e,t){return g(this,null,function*(){return(yield this.getCart()).some(s=>s.productId===e&&JSON.stringify(s.variant)===JSON.stringify(t))})}getCartFromFirebase(e){return g(this,null,function*(){try{console.log("ðŸ”¥ Loading cart from Firebase for user:",e);const t=Nd(rg,"user_carts",e),s=yield vu(t);if(s.exists()){const e=s.data(),t=(null==e?void 0:e.items)||[];return console.log("âœ… Cart loaded from Firebase:",t.length,"items"),t}return console.log("â„¹ï¸ No cart found in Firebase for user:",e),null}catch(t){return console.error("âŒ Error getting cart from Firebase:",t),null}})}saveCartToFirebase(e,t){return g(this,null,function*(){try{console.log("ðŸ”¥ Saving cart to Firebase for user:",e,"Items:",t.length);const s=Nd(rg,"user_carts",e);yield ju(s,{userId:e,items:t,lastUpdated:(new Date).toISOString()}),console.log("âœ… Cart saved to Firebase successfully")}catch(s){throw console.error("âŒ Error saving cart to Firebase:",s),s}})}generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}},ug=({user:t,products:s,loading:r,onProductClick:n,onLoginRequired:i,onCartClick:a,onAddToCart:o,onNavigateToFlashSale:l})=>{var c;const[h,m]=f.useState(""),[p,x]=f.useState("all"),[N,w]=f.useState("all"),[j,A]=f.useState(0),[P,D]=f.useState("terbaru"),[R,O]=f.useState(1),[L,F]=f.useState(0),[M,U]=f.useState(0),{timeLeft:V,isFlashSaleActive:B}=ag(),[z,$]=f.useState(0),[q,K]=f.useState(""),H=()=>g(e,null,function*(){if(null==t?void 0:t.uid)try{const e=yield dg.getCart(t.uid);A(e.length)}catch(e){console.error("âŒ Failed to load cart count:",e),A(0)}});f.useEffect(()=>{(null==t?void 0:t.uid)?H():A(0)},[t]),f.useEffect(()=>{console.log("ðŸ”„ HomePage: Starting periodic refresh timer");const e=setInterval(()=>{console.log("â° HomePage: Periodic refresh triggered"),$(e=>e+1),K((new Date).toLocaleTimeString("id-ID")),H()},15e3);return K((new Date).toLocaleTimeString("id-ID")),()=>{clearInterval(e),console.log("ðŸ”„ HomePage: Periodic refresh timer stopped")}},[t]);const G=[{id:"all",name:"Semua",icon:"ðŸ›ï¸"},{id:"hijab",name:"Hijab",icon:"ðŸ§•"},{id:"gamis",name:"Gamis",icon:"ðŸ‘—"},{id:"khimar",name:"Khimar",icon:"ðŸ§•"},{id:"tunik",name:"Tunik",icon:"ðŸ‘š"},{id:"abaya",name:"Abaya",icon:"ðŸ¥»"}],W=e=>{o(e)},J=y.useMemo(()=>{const e=function(e){if(!Array.isArray(e))return console.warn("âš ï¸ validateProducts: Input is not an array"),[];const t=e.map(cg).filter(e=>null!==e);return t}(s);return e.map(e=>u(d({},e),{description:e.description||"",category:e.category||"other",images:e.images||[],variants:e.variants||{sizes:[],colors:[]},retailPrice:e.retailPrice||0,resellerPrice:e.resellerPrice||0,costPrice:e.costPrice||0,stock:e.stock||0,status:e.status||"ready",isFlashSale:e.isFlashSale||!1,flashSalePrice:e.flashSalePrice||0,createdAt:e.createdAt||new Date,salesCount:e.salesCount||0,isFeatured:e.isFeatured||!1}))},[s]),Q=J.filter(e=>{const t=e.name.toLowerCase().includes(h.toLowerCase())||e.description.toLowerCase().includes(h.toLowerCase()),s="all"===p||e.category===p,r="all"===N||e.status===N;return t&&s&&r}),Y=[...Q].sort((e,s)=>{switch(P){case"terbaru":return new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime();case"terlama":return new Date(e.createdAt).getTime()-new Date(s.createdAt).getTime();case"terlaris":return(s.salesCount||0)-(e.salesCount||0);case"termurah":return("reseller"===(null==t?void 0:t.role)?e.resellerPrice:e.retailPrice)-("reseller"===(null==t?void 0:t.role)?s.resellerPrice:s.retailPrice);case"termahal":const r="reseller"===(null==t?void 0:t.role)?e.resellerPrice:e.retailPrice;return("reseller"===(null==t?void 0:t.role)?s.resellerPrice:s.retailPrice)-r;default:return 0}}),X=y.useMemo(()=>{const e=J.filter(e=>e.isFeatured);return e},[J,L]),Z=y.useMemo(()=>{try{return Array.isArray(Y)?Y:J||[]}catch(e){return J||[]}},[Y,J]),ee=8*R,te=ee-8,se=Z.slice(te,ee),re=Math.ceil(Z.length/8);return f.useEffect(()=>{O(1)},[h,p,N,P]),f.useEffect(()=>{const e=e=>{F(e=>e+1),setTimeout(()=>{$(e=>e+1)},100)},t=e=>{$(e=>e+1)},s=e=>{U(e=>e+1),setTimeout(()=>{$(e=>e+1)},100)};return window.addEventListener("featuredProductsUpdated",e),window.addEventListener("productsUpdated",t),window.addEventListener("flashSaleUpdated",s),window.addEventListener("productAdded",t),window.addEventListener("productUpdated",t),window.addEventListener("productDeleted",t),()=>{window.removeEventListener("featuredProductsUpdated",e),window.removeEventListener("productsUpdated",t),window.removeEventListener("flashSaleUpdated",s),window.removeEventListener("productAdded",t),window.removeEventListener("productUpdated",t),window.removeEventListener("productDeleted",t)}},[]),f.useEffect(()=>{const e=e=>{var t;console.log("ðŸ”¥ Flash sale ended detected in HomePage:",e.detail),F(e=>e+1),"time_expired"===(null==(t=e.detail)?void 0:t.reason)&&(window.flashSaleRefreshTimer&&clearTimeout(window.flashSaleRefreshTimer),window.flashSaleRefreshTimer=setTimeout(()=>{console.log("ðŸ”„ Auto-refreshing HomePage after flash sale time expired"),window.location.reload()},4e3))};return window.addEventListener("flashSaleEnded",e),()=>{window.removeEventListener("flashSaleEnded",e)}},[]),r?we.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:we.jsxs("div",{className:"text-center",children:[we.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500 mx-auto mb-4"}),we.jsx("p",{className:"text-gray-600",children:"Loading products..."})]})}):we.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[we.jsxs("div",{className:"bg-gradient-to-r from-pink-500 to-purple-600 text-white p-4",children:[we.jsxs("div",{className:"flex items-center justify-between mb-4",children:[we.jsxs("div",{children:[we.jsx("h1",{className:"text-xl font-bold",children:"Azzahra Fashion"}),we.jsx("p",{className:"text-pink-100 text-sm",children:"Muslim Fashion Store"})]}),we.jsx("div",{className:"flex items-center space-x-3",children:t?we.jsxs("div",{className:"flex items-center space-x-2",children:[we.jsx(_,{className:"w-5 h-5"}),we.jsx("span",{className:"text-sm",children:t.name})]}):we.jsx("button",{onClick:i,className:"bg-white/20 px-3 py-1 rounded-full text-sm hover:bg-white/30 transition-colors",children:"Login"})})]}),we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsxs("div",{className:"flex-1 relative",children:[we.jsx(I,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),we.jsx("input",{type:"text",placeholder:"Cari produk...",value:h,onChange:e=>m(e.target.value),className:"w-full pl-10 pr-4 py-3 rounded-lg text-gray-800 focus:outline-none focus:ring-2 focus:ring-white/50"})]}),we.jsxs("button",{onClick:a,className:"relative p-2 bg-white rounded-full shadow-md hover:shadow-lg transition-shadow",children:[we.jsx(v,{className:"w-6 h-6 text-gray-600"}),j>0&&we.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:j})]})]})]}),we.jsx("div",{className:"p-4",children:we.jsx(lg,{onBannerClick:e=>{console.log("Banner clicked:",e),"flashsale"===e.type&&(console.log("Flash sale banner clicked, navigating..."),l&&l())}})}),we.jsx("div",{className:"px-4 mb-6",children:we.jsxs("div",{className:"bg-gradient-to-br from-red-600 via-red-500 to-orange-500 rounded-xl p-5 text-white shadow-xl relative overflow-hidden",children:[we.jsxs("div",{className:"absolute inset-0 opacity-10",children:[we.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white rounded-full -mr-16 -mt-16 animate-pulse"}),we.jsx("div",{className:"absolute bottom-0 left-0 w-24 h-24 bg-white rounded-full -ml-12 -mb-12 animate-pulse delay-75"})]}),we.jsx("div",{className:"relative z-10",children:we.jsxs("div",{className:"flex items-center justify-between mb-4",children:[we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx("div",{className:"bg-white/20 backdrop-blur-sm p-3 rounded-full shadow-lg",children:we.jsx("span",{className:"text-3xl",children:"âš¡"})}),we.jsxs("div",{children:[we.jsx("h2",{className:"text-xl font-bold bg-gradient-to-r from-yellow-200 to-white bg-clip-text text-transparent",children:"Flash Sale"}),we.jsx("p",{className:"text-red-100 text-sm font-medium",children:B?"Diskon Terbatas!":"Nantikan Flash Sale Kami Selanjutnya"}),B&&V&&we.jsxs("div",{className:"flex items-center space-x-2 mt-2 bg-white/20 backdrop-blur-sm rounded-full px-3 py-1",children:[we.jsx(C,{className:"w-4 h-4 text-yellow-200"}),we.jsx("span",{className:"text-sm font-bold text-yellow-200",children:V})]})]})]}),we.jsx("button",{onClick:l,className:"bg-white text-red-500 px-4 py-2 rounded-full text-sm font-bold hover:bg-red-50 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105",children:B?"Lihat Semua":"Lihat Produk"})]})}),r?we.jsx("div",{className:"grid grid-cols-2 gap-3",children:[...Array(2)].map((e,t)=>we.jsxs("div",{className:"bg-white/10 rounded-lg p-3 backdrop-blur-sm",children:[we.jsx("div",{className:"w-full h-24 bg-white/20 rounded animate-pulse mb-2"}),we.jsx("div",{className:"h-3 bg-white/20 rounded animate-pulse mb-1"}),we.jsx("div",{className:"h-3 bg-white/20 rounded w-3/4 animate-pulse"})]},`flash-skeleton-${t}`))}):we.jsx("div",{className:"grid grid-cols-2 gap-3",children:J.filter(e=>e.isFlashSale&&B).slice(0,2).map(e=>{var t;return we.jsxs("div",{onClick:()=>n(e),className:"bg-white/10 rounded-lg p-3 backdrop-blur-sm hover:bg-white/20 transition-colors cursor-pointer",children:[we.jsxs("div",{className:"relative",children:[we.jsx("img",{src:(null==(t=e.images)?void 0:t[0])||"/placeholder-product.jpg",alt:e.name,className:"w-full h-24 object-cover rounded mb-2"}),we.jsxs("div",{className:"absolute top-1 right-1 bg-red-600 text-white text-xs px-2 py-1 rounded-full",children:["-",Math.round((e.retailPrice-e.flashSalePrice)/e.retailPrice*100),"%"]})]}),we.jsx("h3",{className:"text-white font-medium text-sm mb-1 truncate",children:e.name}),we.jsxs("div",{className:"flex items-center space-x-2",children:[we.jsxs("span",{className:"text-white font-bold text-sm",children:["Rp ",e.flashSalePrice.toLocaleString("id-ID")]}),we.jsxs("span",{className:"text-red-200 line-through text-xs",children:["Rp ",e.retailPrice.toLocaleString("id-ID")]})]})]},`flash-${e.id}`)})}),0===J.filter(e=>e.isFlashSale&&B).length&&!r&&we.jsxs("div",{className:"text-center py-4 text-red-100",children:[we.jsx("span",{className:"text-3xl",children:"ðŸš«"}),we.jsx("p",{className:"text-sm mt-1",children:"Tidak ada Flash Sale saat ini"})]})]})}),we.jsxs("div",{className:"px-4 mb-6",children:[we.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[we.jsx(b,{className:"w-5 h-5 text-yellow-500 fill-current"}),we.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"Produk Unggulan"})]}),r?we.jsx("div",{className:"grid grid-cols-2 gap-4",children:[...Array(2)].map((e,t)=>we.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[we.jsx("div",{className:"w-full h-48 bg-gray-200 animate-pulse"}),we.jsxs("div",{className:"p-4",children:[we.jsx("div",{className:"h-4 bg-gray-200 rounded mb-2 animate-pulse"}),we.jsx("div",{className:"h-3 bg-gray-200 rounded mb-3 animate-pulse"}),we.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 animate-pulse"})]})]},`skeleton-${t}`))}):X.length>0?we.jsx("div",{className:"grid grid-cols-2 gap-4",children:X.map(e=>we.jsx(og,{product:e,onProductClick:n,onAddToCart:W,user:t,isFeatured:!0},`featured-${e.id}`))}):we.jsxs("div",{className:"text-center py-8 text-gray-500 bg-white rounded-lg",children:[we.jsx(b,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),we.jsx("p",{children:"Belum ada produk unggulan"})]})]}),we.jsx("div",{className:"px-4",children:we.jsxs("div",{className:"flex flex-col space-y-3",children:[we.jsx("div",{className:"flex space-x-3 overflow-x-auto pb-2",children:G.map(e=>we.jsxs("button",{onClick:()=>x(e.id),className:"flex-shrink-0 flex items-center space-x-2 px-4 py-2 rounded-full transition-colors "+(p===e.id?"bg-pink-500 text-white":"bg-white text-gray-600 hover:bg-gray-100"),children:[we.jsx("span",{children:e.icon}),we.jsx("span",{className:"text-sm font-medium",children:e.name})]},e.id))}),we.jsxs("div",{className:"flex space-x-3 overflow-x-auto pb-2",children:[we.jsx("button",{onClick:()=>w("all"),className:"flex-shrink-0 flex items-center space-x-2 px-4 py-2 rounded-full transition-colors "+("all"===N?"bg-gray-700 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:we.jsx("span",{className:"text-sm font-medium",children:"Semua Status"})}),we.jsxs("button",{onClick:()=>w("ready"),className:"flex-shrink-0 flex items-center space-x-2 px-4 py-2 rounded-full transition-colors "+("ready"===N?"bg-green-500 text-white":"bg-white text-gray-600 hover:bg-gray-100 border border-green-300"),children:[we.jsx("span",{className:"w-2 h-2 bg-current rounded-full"}),we.jsx("span",{className:"text-sm font-medium",children:"Ready"})]}),we.jsxs("button",{onClick:()=>w("po"),className:"flex-shrink-0 flex items-center space-x-2 px-4 py-2 rounded-full transition-colors "+("po"===N?"bg-orange-500 text-white":"bg-white text-gray-600 hover:bg-gray-100 border border-orange-300"),children:[we.jsx("span",{className:"w-2 h-2 bg-current rounded-full"}),we.jsx("span",{className:"text-sm font-medium",children:"PO"})]})]})]})}),we.jsxs("div",{className:"px-4",children:[we.jsxs("div",{className:"flex flex-col space-y-3 mb-4",children:[we.jsxs("div",{className:"flex items-center justify-between",children:[we.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"all"===p?"Semua Produk":null==(c=G.find(e=>e.id===p))?void 0:c.name}),we.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[we.jsx(E,{className:"w-4 h-4 mr-1"}),Q.length," produk"]})]}),we.jsxs("div",{className:"flex items-center space-x-2 overflow-x-auto pb-2",children:[we.jsxs("div",{className:"flex items-center text-sm text-gray-600 mr-2",children:[we.jsx(T,{className:"w-4 h-4 mr-1"}),"Urutkan:"]}),we.jsx("button",{onClick:()=>D("terbaru"),className:"flex-shrink-0 px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+("terbaru"===P?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"Terbaru"}),we.jsx("button",{onClick:()=>D("terlaris"),className:"flex-shrink-0 px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+("terlaris"===P?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"Terlaris"}),we.jsx("button",{onClick:()=>D("termurah"),className:"flex-shrink-0 px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+("termurah"===P?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"Termurah"}),we.jsx("button",{onClick:()=>D("termahal"),className:"flex-shrink-0 px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+("termahal"===P?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"Termahal"}),we.jsx("button",{onClick:()=>D("terlama"),className:"flex-shrink-0 px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+("terlama"===P?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"Terlama"})]})]}),0===Q.length?we.jsxs("div",{className:"text-center py-12",children:[we.jsx("div",{className:"text-gray-400 mb-4",children:we.jsx(I,{className:"w-12 h-12 mx-auto"})}),we.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"Produk tidak ditemukan"}),we.jsx("p",{className:"text-gray-500",children:"Coba kata kunci lain atau pilih kategori berbeda"})]}):we.jsxs(we.Fragment,{children:[we.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:se.map(e=>we.jsx(og,{product:e,onProductClick:n,onAddToCart:W,user:t},e.id))}),re>1&&we.jsxs("div",{className:"flex flex-col items-center mt-8 space-y-4",children:[we.jsxs("div",{className:"flex items-center space-x-2",children:[we.jsxs("button",{onClick:()=>O(e=>Math.max(1,e-1)),disabled:1===R,className:"flex items-center space-x-1 px-3 py-2 rounded-lg transition-colors "+(1===R?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300"),children:[we.jsx(k,{className:"w-4 h-4"}),we.jsx("span",{children:"Sebelumnya"})]}),we.jsx("div",{className:"flex items-center space-x-1",children:[...Array(re)].map((e,t)=>{const s=t+1,r=R===s;return 1===s||s===re||s>=R-1&&s<=R+1?we.jsx("button",{onClick:()=>O(s),className:"w-10 h-10 rounded-lg font-medium transition-colors "+(r?"bg-pink-500 text-white":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300"),children:s},s):2===s&&R>3||s===re-1&&R<re-2?we.jsx("span",{className:"px-2 text-gray-400",children:"..."},s):null})}),we.jsxs("button",{onClick:()=>O(e=>Math.min(re,e+1)),disabled:R===re,className:"flex items-center space-x-1 px-3 py-2 rounded-lg transition-colors "+(R===re?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300"),children:[we.jsx("span",{children:"Selanjutnya"}),we.jsx(S,{className:"w-4 h-4"})]})]}),we.jsxs("div",{className:"text-sm text-gray-600",children:["Menampilkan ",te+1,"-",Math.min(ee,Z.length)," dari ",Z.length," produk"]})]})]})]}),t&&we.jsx("div",{className:"fixed bottom-24 right-4 bg-white rounded-lg shadow-lg p-3 border-l-4 border-pink-500",children:we.jsx("div",{className:"text-xs text-gray-600",children:"reseller"===t.role?we.jsxs("div",{className:"flex items-center space-x-1",children:[we.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full"}),we.jsx("span",{children:"Harga Reseller Aktif"})]}):we.jsxs("div",{className:"flex items-center space-x-1",children:[we.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),we.jsx("span",{children:"Harga Retail"})]})})})]})},hg=({product:e,user:t,onBack:s,onLoginRequired:r,onAddToCart:n,onBuyNow:i,onNavigateToCart:a})=>{var o;const[l,c]=f.useState(""),[d,u]=f.useState(""),[h,m]=f.useState(1),[p,g]=f.useState(0);return we.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[we.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:we.jsxs("div",{className:"flex items-center justify-between p-4",children:[we.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-full",children:we.jsx(A,{className:"w-6 h-6 text-gray-600"})}),we.jsx("h1",{className:"text-lg font-semibold",children:"Detail Produk"}),we.jsxs("div",{className:"flex items-center space-x-2",children:[we.jsx("button",{onClick:a||(()=>{}),className:"p-2 rounded-full transition-colors relative "+(t?"bg-pink-500 text-white hover:bg-pink-600":"bg-gray-100 text-gray-400"),children:we.jsx(v,{className:"w-5 h-5"})}),we.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-full",children:we.jsx(P,{className:"w-5 h-5 text-gray-600"})}),we.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-full",children:we.jsx(D,{className:"w-5 h-5 text-gray-600"})})]})]})}),we.jsxs("div",{className:"bg-white",children:[we.jsxs("div",{className:"relative",children:[we.jsx("img",{src:(null==(o=e.images)?void 0:o[p])||e.image||"/placeholder-product.jpg",alt:e.name,className:"w-full h-96 object-cover",onError:e=>{e.target.src="/placeholder-product.jpg"}}),e.isFlashSale&&we.jsx("div",{className:"absolute top-4 left-4 bg-red-500 text-white px-3 py-1 rounded-full text-sm font-semibold",children:"FLASH SALE"}),"po"===e.status&&we.jsx("div",{className:"absolute top-4 right-4 bg-orange-500 text-white px-3 py-1 rounded-full text-sm font-semibold",children:"PRE ORDER"})]}),e.images&&e.images.length>1&&we.jsx("div",{className:"flex space-x-2 p-4 overflow-x-auto",children:e.images.map((t,s)=>we.jsx("button",{onClick:()=>g(s),className:"flex-shrink-0 w-16 h-16 rounded-lg overflow-hidden border-2 "+(p===s?"border-pink-500":"border-gray-200"),children:we.jsx("img",{src:t,alt:`${e.name} ${s+1}`,className:"w-full h-full object-cover",onError:e=>{e.target.src="/placeholder-product.jpg"}})},s))})]}),we.jsxs("div",{className:"bg-white mt-2 p-4",children:[we.jsx("div",{className:"flex items-start justify-between mb-3",children:we.jsxs("div",{className:"flex-1",children:[we.jsx("h1",{className:"text-xl font-bold text-gray-800 mb-2",children:e.name}),we.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[we.jsxs("div",{className:"flex items-center",children:[[...Array(5)].map((e,t)=>we.jsx(b,{className:"w-4 h-4 text-yellow-400 fill-current"},t)),we.jsx("span",{className:"text-sm text-gray-600 ml-1",children:"(4.8)"})]}),we.jsx("span",{className:"text-sm text-gray-500",children:"â€¢ Terjual 150+"})]})]})}),we.jsx("div",{className:"mb-4",children:e.isFlashSale&&e.flashSalePrice>0?we.jsxs("div",{className:"space-y-1",children:[we.jsxs("div",{className:"flex items-center space-x-2",children:[we.jsxs("span",{className:"text-2xl font-bold text-red-600",children:["Rp ",e.flashSalePrice.toLocaleString("id-ID")]}),we.jsxs("span",{className:"bg-red-100 text-red-600 text-xs px-2 py-1 rounded",children:["-",Math.round(100*(1-e.flashSalePrice/(e.originalRetailPrice||e.retailPrice))),"%"]})]}),we.jsxs("div",{className:"text-lg text-gray-500 line-through",children:["Rp ",(e.originalRetailPrice||e.retailPrice).toLocaleString("id-ID")]})]}):we.jsxs("div",{className:"space-y-1",children:[we.jsxs("div",{className:"text-2xl font-bold text-pink-600",children:["Rp ",(e.isFlashSale&&e.flashSalePrice>0?e.flashSalePrice:"reseller"===(null==t?void 0:t.role)?e.resellerPrice:e.retailPrice).toLocaleString("id-ID")]}),"reseller"===(null==t?void 0:t.role)?we.jsxs("div",{className:"text-sm text-blue-600 font-medium",children:["Harga Reseller (Retail: Rp ",e.retailPrice.toLocaleString("id-ID"),")"]}):we.jsx("button",{onClick:()=>{if("reseller"!==(null==t?void 0:t.role)){const t=encodeURIComponent(`Halo Admin, saya tertarik dengan produk ${e.name} dan ingin menanyakan tentang harga reseller. Mohon info lebih lanjut. Terima kasih.`);window.open(`https://wa.me/6287815990944?text=${t}`,"_blank")}},className:"text-sm text-green-600 font-medium hover:text-green-700 underline transition-colors",children:"ðŸ’¬ Info Harga Reseller?"})]})}),we.jsx("div",{className:"flex items-center justify-between mb-4 p-3 bg-gray-50 rounded-lg",children:we.jsxs("div",{className:"flex items-center space-x-4",children:[we.jsxs("div",{className:"text-sm",children:[we.jsx("span",{className:"text-gray-600",children:"Stok: "}),we.jsx("span",{className:"font-semibold "+(e.stock>10?"text-green-600":e.stock>0?"text-yellow-600":"text-red-600"),children:e.stock})]}),we.jsxs("div",{className:"text-sm",children:[we.jsx("span",{className:"text-gray-600",children:"Status: "}),we.jsx("span",{className:"font-semibold "+("ready"===e.status?"text-green-600":"text-orange-600"),children:"ready"===e.status?"Ready Stock":"Pre Order"})]})]})}),we.jsx("div",{className:"border-t pt-4",children:we.jsx("p",{className:"text-gray-600 leading-relaxed",children:e.description})})]}),we.jsxs("div",{className:"bg-white mt-2 p-4",children:[we.jsxs("div",{className:"mb-6",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Pilih Ukuran"}),we.jsx("div",{className:"flex flex-wrap gap-2",children:e.variants.sizes.map(e=>we.jsx("button",{onClick:()=>c(e),className:"px-4 py-2 border rounded-lg font-medium transition-colors "+(l===e?"border-pink-500 bg-pink-50 text-pink-600":"border-gray-300 text-gray-600 hover:border-gray-400"),children:e},e))})]}),we.jsxs("div",{className:"mb-6",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Pilih Warna"}),we.jsx("div",{className:"flex flex-wrap gap-2",children:e.variants.colors.map(e=>we.jsx("button",{onClick:()=>u(e),className:"px-4 py-2 border rounded-lg font-medium transition-colors "+(d===e?"border-pink-500 bg-pink-50 text-pink-600":"border-gray-300 text-gray-600 hover:border-gray-400"),children:e},e))})]}),we.jsxs("div",{className:"mb-6",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Jumlah"}),we.jsxs("div",{className:"flex items-center space-x-4",children:[we.jsxs("div",{className:"flex items-center space-x-3 bg-gray-100 rounded-lg p-1",children:[we.jsx("button",{onClick:()=>m(Math.max(1,h-1)),className:"w-10 h-10 flex items-center justify-center rounded-md hover:bg-gray-200 transition-colors",children:we.jsx(R,{className:"w-4 h-4"})}),we.jsx("span",{className:"w-12 text-center font-semibold",children:h}),we.jsx("button",{onClick:()=>m(h+1),className:"w-10 h-10 flex items-center justify-center rounded-md hover:bg-gray-200 transition-colors",children:we.jsx(O,{className:"w-4 h-4"})})]}),we.jsxs("div",{className:"text-sm text-gray-600",children:["Stok tersedia: ",we.jsx("span",{className:"font-semibold",children:e.stock})]})]})]})]}),we.jsxs("div",{className:"bg-white mt-2 p-4",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Detail Produk"}),we.jsxs("div",{className:"space-y-2 text-sm",children:[we.jsxs("div",{className:"flex justify-between",children:[we.jsx("span",{className:"text-gray-600",children:"Kategori:"}),we.jsx("span",{className:"font-medium capitalize",children:e.category})]}),"po"===e.status&&e.estimatedReady&&we.jsxs("div",{className:"flex justify-between",children:[we.jsx("span",{className:"text-gray-600",children:"Estimasi Ready:"}),we.jsx("span",{className:"font-medium",children:e.estimatedReady.toLocaleDateString("id-ID")})]}),we.jsxs("div",{className:"flex justify-between",children:[we.jsx("span",{className:"text-gray-600",children:"Berat:"}),we.jsx("span",{className:"font-medium",children:"500 gram"})]}),we.jsxs("div",{className:"flex justify-between",children:[we.jsx("span",{className:"text-gray-600",children:"Kondisi:"}),we.jsx("span",{className:"font-medium text-green-600",children:"Baru"})]}),we.jsxs("div",{className:"flex justify-between",children:[we.jsx("span",{className:"text-gray-600",children:"Garansi:"}),we.jsx("span",{className:"font-medium",children:"Garansi Toko"})]})]})]}),we.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 shadow-lg z-50",children:[we.jsxs("div",{className:"flex space-x-3",children:[we.jsxs("button",{onClick:()=>{t?l&&d?(n(e,{size:l,color:d},h),c(""),u(""),m(1)):alert("Pilih ukuran dan warna terlebih dahulu"):r()},disabled:!l||!d,className:"flex-1 bg-pink-100 text-pink-600 py-4 rounded-lg font-semibold hover:bg-pink-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:[we.jsx(v,{className:"w-5 h-5"}),we.jsx("span",{children:"Tambah ke Keranjang"})]}),we.jsx("button",{onClick:()=>{t?l&&d?i(e,{size:l,color:d},h):alert("Pilih ukuran dan warna terlebih dahulu"):r()},disabled:!l||!d,className:"flex-1 bg-gradient-to-r from-pink-500 to-purple-600 text-white py-4 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"Beli Sekarang"})]}),(!l||!d)&&we.jsx("p",{className:"text-center text-sm text-gray-500 mt-2",children:"Pilih ukuran dan warna terlebih dahulu"})]})]})},mg=()=>{const[t,s]=f.useState([]),[r,n]=f.useState(!0),[i,a]=f.useState(null);return f.useEffect(()=>{let t=null;return g(e,null,function*(){try{n(!0),a(null);const e=ng.currentUser;if(!e)return s([]),void n(!1);console.log("ðŸ”„ Setting up real-time cart listener for user:",e.uid);const r=yield dg.getCart();s(r),t=dg.onCartChange(e=>{console.log("ðŸ“¦ Real-time cart update received:",e.length,"items"),s(e),n(!1),a(null)})}catch(e){console.error("âŒ Error setting up cart listener:",e),a(e instanceof Error?e.message:"Unknown error"),n(!1)}}),()=>{t&&(t(),console.log("ðŸ”„ Cart listener cleaned up"))}},[]),{cartItems:t,loading:r,error:i}},pg=({user:t,onBack:s,onCheckout:r})=>{const{cartItems:n,loading:i,error:a}=mg(),o=(t,s,r)=>g(e,null,function*(){try{const e=n.find(e=>e.productId===t&&JSON.stringify(e.variant)===JSON.stringify(s));if(!e)return void console.error("âŒ Item not found in cart");0===r?yield dg.removeFromCart(e.id):yield dg.updateQuantity(e.id,r)}catch(e){console.error("âŒ Failed to update quantity:",e)}});if(i)return we.jsxs("div",{className:"min-h-screen bg-gray-50",children:[we.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:we.jsxs("div",{className:"flex items-center p-4",children:[we.jsx("button",{onClick:s,className:"mr-4",children:we.jsx(A,{className:"w-6 h-6 text-gray-600"})}),we.jsx("h1",{className:"text-lg font-semibold",children:"Keranjang Belanja"})]})}),we.jsxs("div",{className:"flex flex-col items-center justify-center h-96",children:[we.jsx("div",{className:"w-16 h-16 border-4 border-gray-300 border-t-pink-500 rounded-full animate-spin mb-4"}),we.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"Memuat Keranjang..."})]})]});if(a)return we.jsxs("div",{className:"min-h-screen bg-gray-50",children:[we.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:we.jsxs("div",{className:"flex items-center p-4",children:[we.jsx("button",{onClick:s,className:"mr-4",children:we.jsx(A,{className:"w-6 h-6 text-gray-600"})}),we.jsx("h1",{className:"text-lg font-semibold",children:"Keranjang Belanja"})]})}),we.jsxs("div",{className:"flex flex-col items-center justify-center h-96",children:[we.jsx(L,{className:"w-16 h-16 text-red-300 mb-4"}),we.jsx("h3",{className:"text-lg font-semibold text-red-600 mb-2",children:"Error Loading Cart"}),we.jsx("p",{className:"text-gray-500 text-center mb-6",children:a}),we.jsx("button",{onClick:s,className:"bg-gradient-to-r from-pink-500 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition-all",children:"Kembali"})]})]});if(0===n.length)return we.jsxs("div",{className:"min-h-screen bg-gray-50",children:[we.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:we.jsxs("div",{className:"flex items-center p-4",children:[we.jsx("button",{onClick:s,className:"mr-4",children:we.jsx(A,{className:"w-6 h-6 text-gray-600"})}),we.jsx("h1",{className:"text-lg font-semibold",children:"Keranjang Belanja"})]})}),we.jsxs("div",{className:"flex flex-col items-center justify-center h-96",children:[we.jsx(L,{className:"w-16 h-16 text-gray-300 mb-4"}),we.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"Keranjang Kosong"}),we.jsxs("p",{className:"text-gray-500 text-center mb-6",children:["Belum ada produk di keranjang Anda.",we.jsx("br",{}),"Yuk mulai belanja!"]}),we.jsx("button",{onClick:s,className:"bg-gradient-to-r from-pink-500 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition-all",children:"Mulai Belanja"})]})]});const l=n.reduce((e,t)=>t?e+(t.price||0)*(t.quantity||1):e,0);return we.jsxs("div",{className:"min-h-screen bg-gray-50 pb-32",children:[we.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:we.jsxs("div",{className:"flex items-center p-4",children:[we.jsx("button",{onClick:s,className:"mr-4",children:we.jsx(A,{className:"w-6 h-6 text-gray-600"})}),we.jsx("h1",{className:"text-lg font-semibold",children:"Keranjang Belanja"}),we.jsx("span",{className:"ml-2 bg-pink-100 text-pink-600 text-xs px-2 py-1 rounded-full",children:n.length})]})}),we.jsx("div",{className:"p-4 space-y-4",children:n.map((t,s)=>{if(!t)return console.error("âŒ Cart item is null or undefined at index:",s),null;const r=t.price||0,i=t.quantity||1,a=r*i,l=t.name||"Product",c=t.image||`data:image/svg+xml;base64,${btoa('<svg width="80" height="80" xmlns="http://www.w3.org/2000/svg"><rect width="80" height="80" fill="#f3f4f6"/><text x="40" y="45" text-anchor="middle" fill="#6b7280" font-size="12" font-family="Arial">Product</text></svg>')}`,d=t.productId||t.id||`product-${s}`,u=t.variant||{};return we.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:we.jsxs("div",{className:"flex space-x-4",children:[we.jsx("img",{src:c,alt:l,className:"w-20 h-20 object-cover rounded-lg"}),we.jsxs("div",{className:"flex-1",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-1",children:l}),u&&(u.size||u.color)&&we.jsxs("p",{className:"text-sm text-gray-500 mb-2",children:["Ukuran: ",u.size||"Standard"," | Warna: ",u.color||"Default"]}),we.jsxs("div",{className:"flex items-center justify-between",children:[we.jsx("div",{className:"flex flex-col",children:we.jsxs("span",{className:"text-lg font-bold text-pink-600",children:["Rp ",r.toLocaleString("id-ID")]})}),we.jsx("div",{className:"flex items-center space-x-3",children:we.jsxs("div",{className:"flex items-center space-x-2 bg-gray-100 rounded-lg p-1",children:[i>1?we.jsx("button",{onClick:()=>o(d,u,i-1),className:"w-8 h-8 flex items-center justify-center rounded-md hover:bg-gray-200 transition-colors",children:we.jsx(R,{className:"w-4 h-4"})}):we.jsx("button",{onClick:()=>((t,s)=>g(e,null,function*(){try{const e=n.find(e=>e.productId===t&&JSON.stringify(e.variant)===JSON.stringify(s));if(!e)return void console.error("âŒ Item not found in cart");yield dg.removeFromCart(e.id)}catch(e){console.error("âŒ Failed to remove from cart:",e)}}))(d,u),className:"w-8 h-8 flex items-center justify-center text-red-500 hover:bg-red-50 rounded-md transition-colors",children:we.jsx(F,{className:"w-4 h-4"})}),we.jsx("span",{className:"w-8 text-center font-semibold",children:i}),we.jsx("button",{onClick:()=>o(d,u,i+1),className:"w-8 h-8 flex items-center justify-center rounded-md hover:bg-gray-200 transition-colors",children:we.jsx(O,{className:"w-4 h-4"})})]})})]}),we.jsxs("div",{className:"mt-2 text-right",children:[we.jsx("span",{className:"text-sm text-gray-600",children:"Subtotal: "}),we.jsxs("span",{className:"font-semibold text-gray-800",children:["Rp ",a.toLocaleString("id-ID")]})]})]})]})},`${d}-${u.size||"default"}-${u.color||"default"}`)}).filter(Boolean)}),we.jsxs("div",{className:"fixed bottom-20 left-0 right-0 bg-white border-t border-gray-200 p-4 shadow-lg",children:[we.jsxs("div",{className:"flex items-center justify-between mb-3",children:[we.jsxs("span",{className:"text-gray-600",children:["Total (",n.length," item)"]}),we.jsxs("span",{className:"text-xl font-bold text-pink-600",children:["Rp ",l.toLocaleString("id-ID")]})]}),we.jsx("button",{onClick:r,className:"w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-4 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition-all",children:"Checkout Sekarang"})]})]})},gg=new class{constructor(){m(this,"collection","user_addresses")}getUserAddresses(){return g(this,null,function*(){try{const e=ng.currentUser;if(!e)throw new Error("User not authenticated");console.log("ðŸ  Loading addresses from Firebase for user:",e.uid);const t=ru(vd(rg,this.collection),iu("userId","==",e.uid)),s=yield wu(t),r=[];return s.forEach(e=>{const t=e.data();r.push(u(d({},t),{id:e.id,createdAt:t.createdAt||(new Date).toISOString(),updatedAt:t.updatedAt||t.createdAt||(new Date).toISOString()}))}),console.log("âœ… Addresses loaded from Firebase:",r.length,"addresses"),r}catch(e){return console.error("âŒ Error getting user addresses:",e),[]}})}onAddressesChange(e){const t=ng.currentUser;return t?(console.log("ðŸ”„ Setting up real-time address listener for user:",t.uid),_u(ru(vd(rg,this.collection),iu("userId","==",t.uid)),t=>{const s=[];t.forEach(e=>{const t=e.data();s.push(u(d({},t),{id:e.id,createdAt:t.createdAt||(new Date).toISOString(),updatedAt:t.updatedAt||t.createdAt||(new Date).toISOString()}))}),console.log("ðŸ“¦ Real-time addresses update:",s.length,"addresses"),e(s)},e=>{console.error("âŒ Real-time address listener error:",e)})):(console.log("âŒ No user for real-time address listener"),()=>{})}saveAddress(e){return g(this,null,function*(){try{const t=ng.currentUser;if(!t)throw new Error("User not authenticated");console.log("ðŸ  Saving address to Firebase..."),e.isDefault&&(yield this.unsetAllDefaultAddressesInFirebase(t.uid));const s=u(d({},e),{id:this.generateId(),userId:t.uid,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()}),r=Nd(rg,this.collection,s.id);return yield ju(r,s),console.log("âœ… Address saved to Firebase:",s.id),s}catch(t){throw console.error("âŒ Error saving address:",t),t}})}updateAddress(e,t){return g(this,null,function*(){try{const s=ng.currentUser;if(!s)throw new Error("User not authenticated");const r=Nd(rg,this.collection,e),n=yield vu(r);if(!n.exists()||n.data().userId!==s.uid)throw new Error("Address not found");t.isDefault&&(yield this.unsetAllDefaultAddressesInFirebase(s.uid));const i=u(d(d({},n.data()),t),{updatedAt:(new Date).toISOString()});return yield ju(r,i),console.log("âœ… Address updated in Firebase:",e),i}catch(s){throw console.error("âŒ Error updating address:",s),s}})}deleteAddress(e){return g(this,null,function*(){try{const t=ng.currentUser;if(!t)throw new Error("User not authenticated");console.log("ðŸ—‘ï¸ Deleting address from Firebase:",e);const s=Nd(rg,this.collection,e),r=yield vu(s);if(!r.exists()||r.data().userId!==t.uid)throw new Error("Address not found");const n=r.data().isDefault;if(yield Su(s),console.log("âœ… Address deleted from Firebase:",e),n){const e=yield this.getUserAddresses();e.length>0&&(yield this.setAsDefault(e[0].id))}}catch(t){throw console.error("âŒ Error deleting address:",t),t}})}setAsDefault(e){return g(this,null,function*(){try{const t=ng.currentUser;if(!t)throw new Error("User not authenticated");return yield this.unsetAllDefaultAddressesInFirebase(t.uid),yield this.updateAddress(e,{isDefault:!0})}catch(t){throw console.error("âŒ Error setting default address:",t),t}})}getDefaultAddress(){return g(this,null,function*(){try{return(yield this.getUserAddresses()).find(e=>e.isDefault)||null}catch(e){return console.error("âŒ Error getting default address:",e),null}})}getAddressById(e){return g(this,null,function*(){try{const t=ng.currentUser;if(!t)throw new Error("User not authenticated");const s=Nd(rg,this.collection,e),r=yield vu(s);if(!r.exists()||r.data().userId!==t.uid)return null;const n=r.data();return u(d({},n),{createdAt:n.createdAt||(new Date).toISOString(),updatedAt:n.updatedAt||n.createdAt||(new Date).toISOString()})}catch(t){return console.error("âŒ Error getting address by ID:",t),null}})}unsetAllDefaultAddressesInFirebase(e){return g(this,null,function*(){try{const t=ru(vd(rg,this.collection),iu("userId","==",e),iu("isDefault","==",!0)),s=(yield wu(t)).docs.map(e=>ju(e.ref,{isDefault:!1,updatedAt:(new Date).toISOString()},{merge:!0}));yield Promise.all(s),console.log("âœ… All default addresses unset in Firebase")}catch(t){throw console.error("âŒ Error unsetting default addresses:",t),t}})}generateId(){return Date.now().toString(36)+Math.random().toString(36).substring(2)}formatAddress(e){return[e.fullAddress,e.subdistrict,e.district,e.city,e.province,e.postalCode].filter(Boolean).join(", ")}getShortAddress(e){return[e.subdistrict,e.district,e.city,e.province].filter(Boolean).join(", ")}},fg=({initialData:t,onSave:s,onCancel:r})=>{const[n,i]=f.useState({name:(null==t?void 0:t.name)||"",phone:(null==t?void 0:t.phone)||"",fullAddress:(null==t?void 0:t.fullAddress)||"",province:(null==t?void 0:t.province)||"",provinceId:(null==t?void 0:t.provinceId)||"",city:(null==t?void 0:t.city)||"",cityId:(null==t?void 0:t.cityId)||"",district:(null==t?void 0:t.district)||"",districtId:(null==t?void 0:t.districtId)||"",subdistrict:(null==t?void 0:t.subdistrict)||"",subdistrictId:(null==t?void 0:t.subdistrictId)||"",postalCode:(null==t?void 0:t.postalCode)||"",isDefault:(null==t?void 0:t.isDefault)||!1}),[a,o]=f.useState([]),[l,c]=f.useState([]),[h,m]=f.useState([]),[p,x]=f.useState([]),[y,b]=f.useState(!1),[v,N]=f.useState(!1),[w,j]=f.useState(!1),[k,S]=f.useState(!1),[_,I]=f.useState(""),[C,E]=f.useState({}),[T,A]=f.useState(new Map);f.useEffect(()=>{P(),["11","12","31","34","10","6"].forEach(t=>g(e,null,function*(){try{const e=`cities_${t}`;if(!T.has(e)){const s=yield fetch(`/api/address-cached?type=cities&provinceId=${t}`),r=yield s.json();r.success&&r.data&&A(t=>new Map(t).set(e,r.data))}}catch(e){console.log(`Background preload cities for province ${t} skipped`)}}))},[]),f.useEffect(()=>{n.provinceId&&(D(),m([]),x([]),i(e=>u(d({},e),{city:"",cityId:"",district:"",districtId:"",subdistrict:"",subdistrictId:"",postalCode:""})))},[n.provinceId]),f.useEffect(()=>{n.cityId&&(R(),x([]),i(e=>u(d({},e),{district:"",districtId:"",subdistrict:"",subdistrictId:"",postalCode:""})))},[n.cityId]),f.useEffect(()=>{n.districtId&&(O(),i(e=>u(d({},e),{subdistrict:"",subdistrictId:"",postalCode:""})))},[n.districtId]);const P=()=>g(e,null,function*(){b(!0);try{const e="provinces";if(T.has(e)){const t=T.get(e);return o(t),void console.log("ðŸŽ¯ Provinces loaded from IN-MEMORY cache:",t.length,"items")}console.log("ðŸŒ Loading provinces from API (no cache)...");const t=yield fetch("/api/address-cached?type=provinces"),s=yield t.json();s.success&&s.data?(o(s.data),A(t=>new Map(t).set(e,s.data)),console.log("âœ… Provinces loaded from API & cached in memory:",s.data.length,"items")):console.error("âŒ Failed to load provinces from cache:",s.message)}catch(e){console.error("Error loading provinces from cache:",e)}finally{b(!1)}}),D=()=>g(e,null,function*(){if(n.provinceId){N(!0);try{const e=`cities_${n.provinceId}`;if(T.has(e)){const t=T.get(e);return c(t),void console.log("âš¡ Cities loaded instantly from IN-MEMORY cache:",t.length,"items for province",n.provinceId)}console.log("ðŸŒ Loading cities from API for province:",n.provinceId);const t=yield fetch(`/api/address-cached?type=cities&provinceId=${n.provinceId}`),s=yield t.json();s.success&&s.data?(c(s.data),A(t=>new Map(t).set(e,s.data)),console.log("âœ… Cities loaded from API & cached:",s.data.length,"items for province",n.provinceId)):console.error("âŒ Failed to load cities:",s.message)}catch(e){console.error("Error loading cities:",e)}finally{N(!1)}}}),R=()=>g(e,null,function*(){if(n.cityId){j(!0);try{const e=`districts_${n.cityId}`;if(T.has(e)){const t=T.get(e);return m(t),void console.log("âš¡ Districts loaded instantly from IN-MEMORY cache:",t.length,"items for city",n.cityId)}console.log("ðŸŒ Loading districts from API for city:",n.cityId);const t=yield fetch(`/api/address-cached?type=districts&cityId=${n.cityId}`),s=yield t.json();s.success&&s.data?(m(s.data),A(t=>new Map(t).set(e,s.data)),console.log("âœ… Districts loaded from API & cached:",s.data.length,"items for city",n.cityId)):console.error("âŒ Failed to load districts:",s.message)}catch(e){console.error("Error loading districts:",e)}finally{j(!1)}}}),O=()=>g(e,null,function*(){if(n.districtId){S(!0);try{const e=`subdistricts_${n.districtId}`;if(T.has(e)){const t=T.get(e);return x(t),void console.log("âš¡ Subdistricts loaded instantly from IN-MEMORY cache:",t.length,"items for district",n.districtId)}console.log("ðŸŒ Loading subdistricts from API for district:",n.districtId);const t=yield fetch(`/api/address-cached?type=subdistricts&districtId=${n.districtId}`),s=yield t.json();s.success&&s.data?(x(s.data),A(t=>new Map(t).set(e,s.data)),console.log("âœ… Subdistricts loaded from API & cached:",s.data.length,"items for district",n.districtId)):console.error("âŒ Failed to load subdistricts:",s.message)}catch(e){console.error("Error loading subdistricts:",e)}finally{S(!1)}}}),L=e=>{const{name:t,value:s,type:r}=e.target;let n="checkbox"===r?e.target.checked:s;i(e=>{const r=u(d({},e),{[t]:n});if("provinceId"===t){const e=a.find(e=>e.province_id===s);e&&(r.province=e.province)}if("cityId"===t){const e=l.find(e=>e.city_id===s);e&&(r.city=`${e.type} ${e.city_name}`)}if("districtId"===t){const e=h.find(e=>e.district_id===s);e&&(r.district=e.district_name)}if("subdistrictId"===t){const e=p.find(e=>e.subdistrict_id===s);e&&(r.subdistrict=e.subdistrict_name)}return r}),C[t]&&E(e=>u(d({},e),{[t]:void 0}))};return we.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),(()=>{const e={};return n.name.trim()||(e.name="Nama harus diisi"),n.phone.trim()||(e.phone="Nomor telepon harus diisi"),n.provinceId||(e.provinceId="Provinsi harus diisi"),n.cityId||(e.cityId="Kota harus diisi"),n.districtId||(e.districtId="Kecamatan harus diisi"),n.subdistrictId||(e.subdistrictId="Kelurahan harus diisi"),n.postalCode.trim()||(e.postalCode="Kode pos harus diisi"),E(e),0===Object.keys(e).length})()){const e=`${n.fullAddress}, ${n.subdistrict}, ${n.district}, ${n.city}, ${n.province}`,t=u(d({},n),{fullAddress:e});s(t)}},className:"space-y-4",children:[_&&we.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:we.jsxs("div",{className:"flex items-center text-red-800",children:[we.jsx(M,{className:"w-4 h-4 mr-2"}),we.jsx("span",{className:"text-sm",children:_})]})}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nama Lengkap *"}),we.jsx("input",{type:"text",name:"name",value:n.name,onChange:L,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(C.name?"border-red-500":"border-gray-300"),placeholder:"Masukkan nama lengkap"}),C.name&&we.jsx("p",{className:"text-red-500 text-xs mt-1",children:C.name})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nomor Telepon *"}),we.jsx("input",{type:"tel",name:"phone",value:n.phone,onChange:L,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(C.phone?"border-red-500":"border-gray-300"),placeholder:"Masukkan nomor telepon aktif"}),C.phone&&we.jsx("p",{className:"text-red-500 text-xs mt-1",children:C.phone})]}),we.jsxs("div",{children:[we.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[we.jsx(U,{className:"w-4 h-4 inline mr-1"}),"Provinsi *"]}),we.jsxs("select",{name:"provinceId",value:n.provinceId,onChange:L,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(C.provinceId?"border-red-500":"border-gray-300"),disabled:y,children:[we.jsx("option",{value:"",children:"Pilih provinsi"}),a.map(e=>we.jsx("option",{value:e.province_id,children:e.province},e.province_id))]}),y&&we.jsxs("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:[we.jsx(V,{className:"w-4 h-4 animate-spin mr-1"}),"Memuat provinsi..."]}),C.provinceId&&we.jsx("p",{className:"text-red-500 text-xs mt-1",children:C.provinceId})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kota/Kabupaten *"}),we.jsxs("select",{name:"cityId",value:n.cityId,onChange:L,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(C.cityId?"border-red-500":"border-gray-300"),disabled:!n.provinceId||v,children:[we.jsx("option",{value:"",children:"Pilih kota/kabupaten"}),l.map(e=>we.jsxs("option",{value:e.city_id,children:[e.type," ",e.city_name]},e.city_id))]}),v&&we.jsxs("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:[we.jsx(V,{className:"w-4 h-4 animate-spin mr-1"}),"Memuat kota..."]}),C.cityId&&we.jsx("p",{className:"text-red-500 text-xs mt-1",children:C.cityId})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kecamatan *"}),we.jsxs("select",{name:"districtId",value:n.districtId,onChange:L,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(C.districtId?"border-red-500":"border-gray-300"),disabled:!n.cityId||w,children:[we.jsx("option",{value:"",children:"Pilih kecamatan"}),h.map(e=>we.jsx("option",{value:e.district_id,children:e.district_name},e.district_id))]}),w&&we.jsxs("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:[we.jsx(V,{className:"w-4 h-4 animate-spin mr-1"}),"Memuat kecamatan..."]}),C.districtId&&we.jsx("p",{className:"text-red-500 text-xs mt-1",children:C.districtId})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kelurahan/Desa *"}),we.jsxs("select",{name:"subdistrictId",value:n.subdistrictId,onChange:L,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(C.subdistrictId?"border-red-500":"border-gray-300"),disabled:!n.districtId||k,children:[we.jsx("option",{value:"",children:"Pilih kelurahan/desa"}),p.map(e=>we.jsx("option",{value:e.subdistrict_id,children:e.subdistrict_name},e.subdistrict_id))]}),k&&we.jsxs("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:[we.jsx(V,{className:"w-4 h-4 animate-spin mr-1"}),"Memuat kelurahan/desa..."]}),C.subdistrictId&&we.jsx("p",{className:"text-red-500 text-xs mt-1",children:C.subdistrictId})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kode Pos *"}),we.jsx("input",{type:"text",name:"postalCode",value:n.postalCode,onChange:L,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(C.postalCode?"border-red-500":"border-gray-300"),placeholder:"Masukkan kode pos",maxLength:5}),C.postalCode&&we.jsx("p",{className:"text-red-500 text-xs mt-1",children:C.postalCode})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Alamat Detail (Jalan, RT/RW, No. Rumah) *"}),we.jsx("textarea",{name:"fullAddress",value:n.fullAddress,onChange:L,rows:3,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(C.fullAddress?"border-red-500":"border-gray-300"),placeholder:"Contoh: Jl. Merdeka No. 123, RT 001/RW 002"}),C.fullAddress&&we.jsx("p",{className:"text-red-500 text-xs mt-1",children:C.fullAddress})]}),we.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:we.jsxs("p",{className:"text-sm text-blue-800",children:[we.jsx("strong",{children:"Preview Alamat:"}),we.jsx("br",{}),n.fullAddress&&`${n.fullAddress}, `,n.subdistrict,", ",n.district,", ",n.city,", ",n.province,", ",n.postalCode]})}),we.jsxs("div",{className:"flex items-center",children:[we.jsx("input",{type:"checkbox",name:"isDefault",checked:n.isDefault,onChange:L,className:"w-4 h-4 text-pink-600 border-gray-300 rounded focus:ring-pink-500"}),we.jsx("label",{className:"ml-2 text-sm text-gray-700",children:"Jadikan alamat utama"})]}),we.jsxs("div",{className:"flex space-x-3 pt-4",children:[we.jsx("button",{type:"button",onClick:r,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Batal"}),we.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition-colors font-medium",children:t?"Update":"Simpan"})]})]})},xg=[{code:"jnt",name:"J&T Express"},{code:"jne",name:"Jalur Nugraha Ekakurir (JNE)"},{code:"pos",name:"POS Indonesia"},{code:"tiki",name:"TIKI"},{code:"ide",name:"IDExpress"},{code:"lion",name:"Lion Parcel"}],yg=new class{constructor(){m(this,"baseUrl","/api/rajaongkir"),m(this,"useCache",!0)}calculateShippingCost(e,t,s,r,n="lowest"){return g(this,null,function*(){try{const i=this.useCache?`${this.baseUrl}/cost-cached`:`${this.baseUrl}/cost`;console.log(`ðŸšš Using ${this.useCache?"CACHED":"DIRECT"} endpoint:`,i);const a=yield fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({origin:e,destination:t,weight:s,courier:r,price:n,getAllCouriers:!1})});if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);const o=yield a.json();if("success"===o.meta.status&&o.data)return o.data;throw new Error(o.meta.message)}catch(i){throw i}})}getAllCouriersCost(e,t,s,r="lowest"){return g(this,null,function*(){try{const n=this.useCache?`${this.baseUrl}/cost-cached`:`${this.baseUrl}/cost`;console.log(`ðŸšš Using ${this.useCache?"CACHED":"DIRECT"} endpoint:`,n);const i=yield fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({origin:e,destination:t,weight:s,courier:"all",price:r,getAllCouriers:!0})});if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);const a=yield i.json();if("success"===a.meta.status&&a.data)return a.data;throw new Error(a.meta.message)}catch(n){throw n}})}isCourierSupported(e){return xg.some(t=>t.code===e)}getCourierName(e){const t=xg.find(t=>t.code===e);return(null==t?void 0:t.name)||e.toUpperCase()}formatFullAddress(e){return[e.subdistrict,e.district,e.cityName,e.provinceName].filter(Boolean).join(", ")}},bg=({user:t,clearCart:s,onBack:r})=>{const[n,i]=f.useState([]),[a,o]=f.useState(!0);f.useEffect(()=>{g(e,null,function*(){try{o(!0);const e=yield dg.getCart();i(e||[]),console.log("ðŸ›’ Checkout: Cart loaded from backend:",(null==e?void 0:e.length)||0,"items")}catch(e){console.error("âŒ Failed to load cart for checkout:",e),i([])}finally{o(!1)}})},[t]);const[l,c]=f.useState(!1),[h,m]=f.useState(""),[p,x]=f.useState(null),[y,b]=f.useState([]),[v,N]=f.useState(!0);f.useEffect(()=>{const e=gg.onAddressesChange(e=>{b(e),console.log("ðŸ“¦ Real-time addresses updated:",e.length)});return()=>e()},[]);const w=()=>y.find(e=>e.isDefault)||y[0],[j,k]=f.useState(!1),[S,I]=f.useState([]),[C,E]=f.useState(""),[T,P]=f.useState(null),D=()=>{const e=n.reduce((e,t)=>{var s;const r=(null==(s=t.product)?void 0:s.weight)||1e3;return e+t.quantity*r},0);return console.log("ðŸ“¦ Weight calculation:",{totalGrams:e,items:n.map(e=>{var t,s;return{name:e.name||e.productName,quantity:e.quantity,itemWeight:(null==(t=e.product)?void 0:t.weight)||1e3,totalWeight:e.quantity*((null==(s=e.product)?void 0:s.weight)||1e3)}})}),e},R=(t,s,r)=>g(e,null,function*(){if(t&&s&&r){s&&"undefined"!==s&&""!==s||(s="607");try{k(!0),E(""),console.log("ðŸšš Calculating shipping cost:",{courier:t,destination:s,actualWeight:r,timestamp:(new Date).toISOString()});const e=yield yg.calculateShippingCost("2425",s,r,t);if(e&&e.length>0){I(e);const t=e[0];P(t),U(e=>u(d({},e),{shippingCost:t.cost,shippingService:t.service,shippingETD:t.etd})),console.log("âœ… Shipping cost calculated successfully:",{service:t.service,cost:t.cost,etd:t.etd,cached:e.length>0})}else E("Tidak dapat menghitung ongkir untuk kurir ini"),console.log("âŒ No shipping results found")}catch(e){console.error("âŒ Error calculating shipping cost:",e),E("Gagal menghitung ongkir. Silakan coba lagi.")}finally{k(!1)}}}),[L,U]=f.useState({name:(null==t?void 0:t.name)||"",phone:"",address:"",provinceId:"",cityId:"",isDropship:!1,dropshipName:"",dropshipPhone:"",paymentMethod:"transfer",shippingCourier:"jnt",shippingCost:0,shippingService:"",shippingETD:"",notes:""}),K=[{id:"jnt",name:"J&T Express",code:"jnt",price:0},{id:"jne",name:"JNE",code:"jne",price:0},{id:"pos",name:"POS Indonesia",code:"pos",price:0},{id:"tiki",name:"TIKI",code:"tiki",price:0},{id:"ojek",name:"OJEK",code:null,price:0},{id:"lion",name:"Lion Parcel",code:"lion",price:0},{id:"idexpress",name:"IDExpress",code:"ide",price:0}];f.useEffect(()=>{if(y.length>0&&!h){const e=w();e&&(m(e.id),U(t=>u(d({},t),{name:t.isDropship?t.name:e.name,phone:t.isDropship?t.phone:e.phone,address:e.fullAddress,provinceId:e.provinceId||"607",cityId:e.cityId||"607"})))}const e=K.find(e=>e.code);e&&!L.shippingCourier&&U(t=>u(d({},t),{shippingCourier:e.id}))},[y,h,L.isDropship]),f.useEffect(()=>{const e=w(),t=K.find(e=>e.id===L.shippingCourier);if((null==t?void 0:t.code)&&e&&L.shippingCourier){const s=D(),r=e.subdistrictId||e.cityId||"607";console.log("ðŸšš Auto-calculating shipping:",{courier:t.code,destination:r,destinationType:e.subdistrictId?"subdistrictId":"cityId",weight:s,addressName:e.fullAddress});const n=setTimeout(()=>{R(t.code,r,s)},200);return()=>clearTimeout(n)}},[L.shippingCourier,h,y.length]);const H=e=>{const{name:t,value:s,type:r}=e.target,n="checkbox"===r?e.target.checked:"number"===r?parseInt(s)||0:s;if(U(e=>u(d({},e),{[t]:n})),"shippingCourier"===t){const e=K.find(e=>e.id===s);return U(e=>u(d({},e),{shippingCourier:n,shippingCost:0,shippingService:"",shippingETD:""})),I([]),P(null),void console.log("ðŸšš Courier changed, useEffect will handle calculation:",{courier:null==e?void 0:e.code,newCourierId:n})}};f.useEffect(()=>{const e=w();e&&(m(e.id),U(t=>u(d({},t),{name:e.name,phone:e.phone,address:e.fullAddress})))},[y]);const G=t=>{if(window.confirm("Apakah Anda yakin ingin menghapus alamat ini?")&&((t=>{g(e,null,function*(){try{yield gg.deleteAddress(t),console.log("âœ… Address deleted from Firebase:",t)}catch(e){throw console.error("âŒ Failed to delete address:",e),e}})})(t),h===t)){const e=w();e&&(e=>{m(e);const t=y.find(t=>t.id===e);if(t){U(e=>u(d({},e),{name:L.isDropship?e.name:t.name,phone:L.isDropship?e.phone:t.phone,address:L.isDropship?e.address:t.fullAddress}));const e=K.find(e=>e.id===L.shippingCourier);if(null==e?void 0:e.code){const s=D(),r=t.subdistrictId||t.cityId||"607";console.log("ðŸšš Address changed - recalculating shipping:",{courier:e.code,destination:r,destinationType:t.subdistrictId?"subdistrictId":"cityId",weight:s,addressName:t.fullAddress}),setTimeout(()=>{R(e.code,r,s)},200)}}})(e.id)}},W=(e,t)=>{navigator.clipboard.writeText(e),alert(`âœ… Nomor rekening ${t} berhasil disalin!\n\n${e}\na.n. Fahrin`)},J=n.reduce((e,t)=>t?e+(t.price||0)*(t.quantity||1):e,0),Q=L.shippingCost||0,Y=J+Q,X=K.find(e=>e.id===L.shippingCourier),Z=!!(null==X?void 0:X.code);return we.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[we.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:we.jsxs("div",{className:"flex items-center p-4",children:[we.jsx("button",{onClick:r,className:"mr-4",children:we.jsx(A,{className:"w-6 h-6 text-gray-600"})}),we.jsx("h1",{className:"text-lg font-semibold",children:"Checkout"})]})}),we.jsxs("div",{className:"p-4 space-y-4",children:[we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsx("h3",{className:"font-semibold mb-3",children:"Produk Pesanan"}),we.jsx("div",{className:"space-y-3",children:n.map((e,t)=>{if(!e)return null;const s=e.name||"Product",r=e.image||`data:image/svg+xml;base64,${btoa('<svg width="80" height="80" xmlns="http://www.w3.org/2000/svg"><rect width="80" height="80" fill="#f3f4f6"/><text x="40" y="45" text-anchor="middle" fill="#6b7280" font-size="12" font-family="Arial">Product</text></svg>')}`,n=e.price||0,i=e.quantity||1,a=e.variant||{},o=e.productId||e.id||`product-${t}`;return we.jsxs("div",{className:"flex space-x-3",children:[we.jsx("img",{src:r,alt:s,className:"w-16 h-16 object-cover rounded-lg"}),we.jsxs("div",{className:"flex-1",children:[we.jsx("h4",{className:"font-medium text-sm",children:s}),a&&(a.size||a.color)&&we.jsxs("p",{className:"text-xs text-gray-500",children:[a.size||"Standard"," - ",a.color||"Default"]}),we.jsxs("div",{className:"flex justify-between items-center mt-1",children:[we.jsxs("span",{className:"text-sm font-semibold text-pink-600",children:["Rp ",n.toLocaleString("id-ID")]}),we.jsxs("span",{className:"text-sm text-gray-500",children:["x",i]})]})]})]},`${o}-${a.size||"default"}-${a.color||"default"}`)}).filter(Boolean)})]}),we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsx("h3",{className:"font-semibold mb-3",children:"Informasi Penerima"}),we.jsxs("div",{className:"space-y-4",children:[we.jsxs("div",{children:[we.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[we.jsx(_,{className:"w-4 h-4 inline mr-1"}),"Nama Penerima"]}),we.jsx("input",{type:"text",name:"name",value:L.name,onChange:H,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Masukkan nama penerima"})]}),we.jsxs("div",{children:[we.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[we.jsx(B,{className:"w-4 h-4 inline mr-1"}),"Nomor Telepon"]}),we.jsx("input",{type:"tel",name:"phone",value:L.phone,onChange:H,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Masukkan nomor telepon"})]})]})]}),we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsx("h3",{className:"font-semibold mb-3",children:"Pilih Kurir Pengiriman"}),we.jsxs("div",{className:"space-y-3",children:[we.jsxs("div",{children:[we.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[we.jsx(z,{className:"w-4 h-4 inline mr-1"}),"Kurir"]}),we.jsx("select",{name:"shippingCourier",value:L.shippingCourier,onChange:H,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",children:K.map(e=>we.jsxs("option",{value:e.id,children:[e.name," ",e.code?"(âœ“ Otomatis)":"(Manual)"]},e.id))}),we.jsx("div",{className:"mt-2 text-xs text-gray-500",children:Z?we.jsx("div",{className:"text-green-600",children:"âœ“ Otomatis via RajaOngkir dari Banjarmasin"}):we.jsx("div",{className:"text-amber-600",children:"â„¹ï¸ Kurir lokal - biaya diinput manual"})}),j&&we.jsxs("div",{className:"mt-2 flex items-center text-sm text-blue-600",children:[we.jsx(V,{className:"w-4 h-4 animate-spin mr-1"}),"Menghitung ongkir..."]}),C&&we.jsxs("div",{className:"mt-2 text-sm text-red-600 flex items-center",children:[we.jsx(M,{className:"w-4 h-4 mr-1"}),C]})]}),L.shippingCost>0&&we.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[S.length>1&&we.jsxs("div",{className:"mb-3",children:[we.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Pilih Layanan:"}),we.jsx("select",{value:(null==T?void 0:T.service)||"",onChange:e=>{const t=S.find(t=>t.service===e.target.value);t&&(P(t),U(e=>u(d({},e),{shippingCost:t.cost,shippingService:t.service,shippingETD:t.etd})))},className:"w-full p-2 text-sm border border-gray-300 rounded focus:ring-2 focus:ring-pink-500 focus:border-transparent",children:S.map((e,t)=>we.jsxs("option",{value:e.service,children:[e.service," - Rp ",e.cost.toLocaleString("id-ID")," (",e.etd,")"]},t))})]}),we.jsxs("div",{className:"bg-blue-50 rounded-lg p-3 mb-3",children:[we.jsxs("div",{className:"flex justify-between items-center text-sm",children:[we.jsx("span",{className:"font-medium text-blue-800",children:"Berat Produk:"}),we.jsxs("span",{className:"text-blue-600 font-semibold",children:[(D()/1e3).toFixed(2)," kg"]})]}),we.jsx("div",{className:"text-xs text-blue-600 mt-1",children:"ðŸ’¡ Smart rounding: 0-1.25kg = 1kg, 1.251-2.25kg = 2kg, dst."})]}),we.jsxs("div",{className:"flex justify-between items-center",children:[we.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Biaya Ongkir:"}),we.jsxs("span",{className:"text-sm font-semibold text-pink-600",children:["Rp ",L.shippingCost.toLocaleString("id-ID")]})]}),L.shippingService&&we.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Service: ",L.shippingService," | Estimasi: ",L.shippingETD,S.length>1&&we.jsxs("span",{className:"ml-2 text-blue-600",children:["(",S.length," layanan tersedia)"]})]})]})]})]}),we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsxs("div",{className:"flex justify-between items-center mb-3",children:[we.jsx("h3",{className:"font-semibold",children:"Alamat Pengiriman"}),we.jsxs("button",{onClick:()=>c(!0),className:"text-pink-600 hover:text-pink-700 flex items-center text-sm font-medium",children:[we.jsx(O,{className:"w-4 h-4 mr-1"}),"Tambah Alamat"]})]}),y.length>0&&we.jsx("div",{className:"space-y-2 mb-4",children:y.map(e=>we.jsx("label",{className:"block p-3 border rounded-lg cursor-pointer transition-colors "+(h===e.id?"border-pink-500 bg-pink-50":"border-gray-200 hover:border-gray-300"),children:we.jsxs("div",{className:"flex items-start justify-between",children:[we.jsxs("div",{className:"flex-1",children:[we.jsxs("div",{className:"flex items-center mb-1",children:[we.jsx("input",{type:"radio",name:"savedAddress",checked:h===e.id,onChange:()=>{if(m(e.id),U(t=>u(d({},t),{name:L.isDropship?t.name:e.name,phone:L.isDropship?t.phone:e.phone,address:e.fullAddress,provinceId:e.provinceId||"",cityId:e.cityId||""})),Z&&L.shippingCourier){const t=K.find(e=>e.id===L.shippingCourier);if(null==t?void 0:t.code){const s=D(),r=e.subdistrictId||e.cityId||"607";console.log("ðŸšš Address radio selected - recalculating shipping:",{courier:t.code,destination:r,destinationType:e.subdistrictId?"subdistrictId":"cityId",weight:s,addressName:e.fullAddress}),setTimeout(()=>{R(t.code,r,s)},100)}}},className:"w-4 h-4 text-pink-600 mr-2"}),we.jsx("span",{className:"font-medium",children:e.name}),e.isDefault&&we.jsx("span",{className:"ml-2 text-xs bg-green-100 text-green-600 px-2 py-1 rounded-full",children:"Utama"})]}),we.jsx("p",{className:"text-sm text-gray-600 ml-6",children:e.phone}),we.jsx("p",{className:"text-sm text-gray-600 ml-6",children:e.fullAddress})]}),we.jsxs("div",{className:"flex space-x-2",children:[we.jsx("button",{onClick:t=>{t.stopPropagation(),x(e),c(!0)},className:"text-blue-600 hover:text-blue-700",children:we.jsx($,{className:"w-4 h-4"})}),y.length>1&&we.jsx("button",{onClick:t=>{t.stopPropagation(),G(e.id)},className:"text-red-600 hover:text-red-700",children:we.jsx(F,{className:"w-4 h-4"})})]})]})},e.id))}),we.jsx("div",{className:"border-t pt-4",children:!Z&&we.jsxs("div",{className:"mt-4",children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Biaya Ongkos Kirim (Rp)"}),we.jsx("input",{type:"number",name:"shippingCost",value:L.shippingCost||"",onChange:H,min:"0",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Masukkan biaya ongkos kirim"}),we.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"* Masukkan manual biaya ongkos kirim untuk kurir lokal"})]})})]}),we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsx("h3",{className:"font-semibold mb-3",children:"Opsi Tambahan"}),we.jsx("div",{className:"mb-4",children:we.jsxs("label",{className:"flex items-center space-x-3",children:[we.jsx("input",{type:"checkbox",name:"isDropship",checked:L.isDropship,onChange:H,className:"w-4 h-4 text-pink-600 border-gray-300 rounded focus:ring-pink-500"}),we.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Kirim sebagai dropship"})]})}),L.isDropship&&we.jsxs("div",{className:"border-t pt-4 space-y-3",children:[we.jsx("input",{type:"text",name:"dropshipName",value:L.dropshipName,onChange:H,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Nama pengirim dropship"}),we.jsx("input",{type:"tel",name:"dropshipPhone",value:L.dropshipPhone,onChange:H,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Nomor telepon pengirim"})]}),we.jsxs("div",{className:"border-t pt-4",children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Catatan Pesanan"}),we.jsx("textarea",{name:"notes",value:L.notes,onChange:H,rows:3,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Tambahkan catatan untuk pesanan (opsional)"})]})]}),we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsx("h3",{className:"font-semibold mb-3",children:"Metode Pembayaran"}),we.jsxs("div",{className:"space-y-3",children:[we.jsxs("label",{className:"flex items-center space-x-3",children:[we.jsx("input",{type:"radio",name:"paymentMethod",value:"transfer",checked:"transfer"===L.paymentMethod,onChange:H,className:"w-4 h-4 text-pink-600 border-gray-300 focus:ring-pink-500"}),we.jsx("span",{className:"text-sm font-medium",children:"Transfer Bank"})]}),we.jsxs("label",{className:"flex items-center space-x-3",children:[we.jsx("input",{type:"radio",name:"paymentMethod",value:"cod",checked:"cod"===L.paymentMethod,onChange:H,className:"w-4 h-4 text-pink-600 border-gray-300 focus:ring-pink-500"}),we.jsx("span",{className:"text-sm font-medium",children:"COD (Bayar di Tempat)"})]})]}),"transfer"===L.paymentMethod&&we.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:[we.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Transfer ke:"}),we.jsxs("div",{className:"space-y-2 text-sm",children:[we.jsxs("div",{className:"flex justify-between items-center",children:[we.jsx("span",{children:"BCA: 0511456494"}),we.jsxs("button",{onClick:()=>W("0511456494","BCA"),className:"text-blue-600 hover:text-blue-700 text-xs",children:[we.jsx(q,{className:"w-3 h-3 inline mr-1"}),"Salin"]})]}),we.jsxs("div",{className:"flex justify-between items-center",children:[we.jsx("span",{children:"BRI: 066301000115566"}),we.jsxs("button",{onClick:()=>W("066301000115566","BRI"),className:"text-blue-600 hover:text-blue-700 text-xs",children:[we.jsx(q,{className:"w-3 h-3 inline mr-1"}),"Salin"]})]}),we.jsxs("div",{className:"flex justify-between items-center",children:[we.jsx("span",{children:"MANDIRI: 310011008896"}),we.jsxs("button",{onClick:()=>W("310011008896","MANDIRI"),className:"text-blue-600 hover:text-blue-700 text-xs",children:[we.jsx(q,{className:"w-3 h-3 inline mr-1"}),"Salin"]})]})]}),we.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"a.n. Fahrin"})]})]}),we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsx("h3",{className:"font-semibold mb-3",children:"Ringkasan Pesanan"}),we.jsxs("div",{className:"space-y-2",children:[we.jsxs("div",{className:"flex justify-between",children:[we.jsx("span",{className:"text-sm text-gray-600",children:"Subtotal Produk"}),we.jsxs("span",{className:"text-sm font-medium",children:["Rp ",J.toLocaleString("id-ID")]})]}),we.jsxs("div",{className:"flex justify-between",children:[we.jsx("span",{className:"text-sm text-gray-600",children:"Biaya Ongkir"}),we.jsxs("span",{className:"text-sm font-medium",children:["Rp ",Q.toLocaleString("id-ID")]})]}),we.jsx("div",{className:"border-t pt-2",children:we.jsxs("div",{className:"flex justify-between",children:[we.jsx("span",{className:"font-semibold",children:"Total"}),we.jsxs("span",{className:"font-semibold text-pink-600",children:["Rp ",Y.toLocaleString("id-ID")]})]})})]})]}),we.jsx("button",{onClick:()=>{if(!L.name||!L.phone||!L.address)return void alert("Mohon lengkapi semua data pengiriman");const e=n.filter(e=>{const t=e.product||e;return"po"===t.status||t.stock<=0});if(e.length>0){const t=e.map(e=>(e.product||e).name||"Produk tidak diketahui").join(", ");return void alert(`âš ï¸ TIDAK DAPAT CHECKOUT!\n\nProduk berikut HABIS:\n${t}\n\nHubungi admin WhatsApp:\nðŸ“± 6287815990944\n\nUntuk info ketersediaan produk.`)}if(Z&&(!L.shippingCost||L.shippingCost<=0))return void alert("Mohon tunggu perhitungan ongkir selesai atau pilih kurir lain");if(!Z&&(!L.shippingCost||L.shippingCost<=0))return void alert("Mohon masukkan biaya ongkos kirim untuk kurir lokal");const t={items:n.map(e=>u(d({},e),{price:e.price||0,total:(e.price||0)*(e.quantity||1),productName:e.name||e.productName||"Produk",productId:e.productId||e.id,selectedVariant:e.variant})),shippingInfo:{name:L.name,phone:L.phone,address:L.address,isDropship:L.isDropship,dropshipName:L.dropshipName,dropshipPhone:L.dropshipPhone,courier:L.shippingCourier,shippingCost:L.shippingCost>0?L.shippingCost:null,shippingService:L.shippingService,shippingETD:L.shippingETD},paymentMethod:L.paymentMethod,notes:L.notes,totalAmount:J,shippingCost:Q,finalTotal:Y},i=s(t);"transfer"===L.paymentMethod?alert(`ðŸŽ‰ Pesanan berhasil dibuat!\n\nID Pesanan: ${i}\nTotal: Rp ${Y.toLocaleString("id-ID")}\n\nSilakan transfer ke:\nâ€¢ BCA: 0511456494\nâ€¢ BRI: 066301000115566\nâ€¢ MANDIRI: 310011008896\n\na.n. Fahrin\n\nKemudian upload bukti pembayaran di menu "Pesanan"`):alert(`ðŸŽ‰ Pesanan berhasil dibuat!\n\nID Pesanan: ${i}\nTotal: Rp ${Y.toLocaleString("id-ID")}\n\nPembayaran Cash on Delivery (COD)\nBarang akan dikirim setelah konfirmasi.`),r()},className:"w-full bg-pink-600 text-white py-4 rounded-lg font-semibold hover:bg-pink-700 transition-colors shadow-lg",children:"Buat Pesanan"})]}),l&&we.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:we.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[we.jsx("h3",{className:"text-lg font-semibold mb-4",children:p?"Edit Alamat":"Tambah Alamat Baru"}),we.jsx(fg,{initialData:p,onSave:t=>{var s,r;p?(s=p.id,r=t,g(e,null,function*(){try{yield gg.updateAddress(s,r),console.log("âœ… Address updated in Firebase:",s)}catch(e){throw console.error("âŒ Failed to update address:",e),e}})):(t=>{g(e,null,function*(){try{const e=yield gg.saveAddress(t);console.log("âœ… Address added to Firebase:",e.id)}catch(e){throw console.error("âŒ Failed to add address:",e),e}})})(t),c(!1),x(null)},onCancel:()=>{c(!1),x(null)}})]})})]})},vg=()=>{const[t,s]=f.useState(null),[r,n]=f.useState(!0),[i,a]=f.useState(null);f.useEffect(()=>ng.onAuthStateChanged(e=>{var t;if(n(!1),e){const r={uid:e.uid,email:e.email||"",displayName:e.displayName||(null==(t=e.email)?void 0:t.split("@")[0])||"",role:l(e.email||"")};s(r),console.log("âœ… Firebase user authenticated:",r)}else s(null),console.log("â„¹ï¸ No Firebase user authenticated")}),[]);const o=(t,s)=>g(e,null,function*(){var e;try{const r=Nd(rg,"users",t.uid),n={uid:t.uid,email:t.email,displayName:t.displayName||(null==(e=t.email)?void 0:e.split("@")[0])||"",role:s,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString()};yield ju(r,n,{merge:!0}),console.log("âœ… User profile saved to Firestore:",n)}catch(r){console.error("âŒ Error saving user profile:",r)}}),l=e=>{const t=e.toLowerCase();return"v4hrin@gmail.com"===t||t.includes("owner")?"owner":t.includes("admin")?"admin":t.includes("reseller")?"reseller":"customer"},c=e=>{switch(e){case"auth/user-not-found":return"Email tidak terdaftar. Silakan coba lagi.";case"auth/wrong-password":return"Password salah. Silakan coba lagi.";case"auth/email-already-in-use":return"Email sudah terdaftar. Silakan gunakan email lain.";case"auth/weak-password":return"Password terlalu lemah. Gunakan minimal 6 karakter.";case"auth/invalid-email":return"Format email tidak valid. Silakan coba lagi.";case"auth/too-many-requests":return"Terlalu banyak percobaan login. Silakan coba lagi nanti.";case"auth/user-disabled":return"Akun dinonaktifkan. Hubungi admin.";default:return"Login gagal. Silakan coba lagi."}};return{user:t,loading:r,error:i,login:(t,r)=>g(e,null,function*(){var e;try{a(null),n(!0);const i=(yield $m(ng,t,r)).user;if(i){const t=l(i.email||""),r={uid:i.uid,email:i.email||"",displayName:i.displayName||(null==(e=i.email)?void 0:e.split("@")[0])||"",role:t};return yield o(i,t),s(r),console.log("âœ… Firebase login successful:",r),r}}catch(i){throw console.error("âŒ Firebase login error:",i),a(c(i.code)),i}finally{n(!1)}}),register:(t,r,i,d)=>g(e,null,function*(){var e;try{a(null),n(!0);const c=yield function(e,t,s){return g(this,null,function*(){if(ys(e.app))return Promise.reject(ih(e));const r=cm(e),n=ym(r,{returnSecureToken:!0,email:t,password:s,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Lm),i=yield n.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&zm(e),t}),a=yield Fm._fromIdTokenResponse(r,"signIn",i);return yield r._updateCurrentUser(a.user),a})}(ng,t,r),u=c.user;if(u&&i&&(yield qm(u,{displayName:i})),u){const t=d||l(u.email||""),r={uid:u.uid,email:u.email||"",displayName:i||(null==(e=u.email)?void 0:e.split("@")[0])||"",role:t};return yield o(u,t),s(r),console.log("âœ… Firebase registration successful:",r),r}}catch(u){throw console.error("âŒ Firebase registration error:",u),a(c(u.code)),u}finally{n(!1)}}),logout:()=>g(e,null,function*(){try{yield(e=ng,it(e).signOut()),s(null),console.log("âœ… Firebase logout successful")}catch(t){console.error("âŒ Firebase logout error:",t),a(c(t.code))}var e}),isAuthenticated:!!t}},Ng=({onSuccess:t,onClose:s,onShowRegister:r})=>{const[n,i]=f.useState(""),[a,o]=f.useState(""),[l,c]=f.useState(!1),{login:d,loading:u,error:h}=vg();return we.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:we.jsxs("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[we.jsxs("div",{className:"flex justify-between items-center mb-6",children:[we.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Login"}),we.jsx("button",{onClick:s,className:"text-gray-500 hover:text-gray-700 transition-colors",children:we.jsx(K,{size:24})})]}),we.jsxs("form",{onSubmit:s=>g(e,null,function*(){var e;if(s.preventDefault(),n&&a)try{console.log("ðŸ”„ Firebase login attempt:",n);const s=yield d(n,a);if(s){const r={id:s.uid,name:s.displayName||(null==(e=s.email)?void 0:e.split("@")[0])||"",email:s.email,role:s.role};console.log("âœ… Firebase login successful:",r),t(r)}}catch(r){console.error("âŒ Firebase login error:",r)}}),className:"space-y-4",children:[we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),we.jsxs("div",{className:"relative",children:[we.jsx(H,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),we.jsx("input",{type:"email",value:n,onChange:e=>i(e.target.value),className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"email@example.com",required:!0})]})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),we.jsxs("div",{className:"relative",children:[we.jsx(G,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),we.jsx("input",{type:l?"text":"password",value:a,onChange:e=>o(e.target.value),className:"w-full pl-10 pr-10 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",required:!0}),we.jsx("button",{type:"button",onClick:()=>c(!l),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:l?we.jsx(W,{size:20}):we.jsx(J,{size:20})})]})]}),h&&we.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-3 py-2 rounded",children:h}),we.jsx("button",{type:"submit",disabled:u,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:u?"Loading...":"Login"})]}),r&&we.jsx("div",{className:"mt-4 text-center",children:we.jsx("button",{onClick:r,className:"text-blue-600 hover:text-blue-700 text-sm font-medium transition-colors",children:"Belum punya akun? Daftar di sini"})}),we.jsxs("div",{className:"mt-4 text-center text-sm text-gray-600",children:[we.jsx("p",{className:"font-semibold mb-2",children:"ðŸ”¥ Firebase Authentication"}),we.jsxs("div",{className:"space-y-1 text-xs",children:[we.jsxs("p",{children:[we.jsx("strong",{children:"Owner:"})," v4hrin@gmail.com / (password Anda)"]}),we.jsxs("p",{children:[we.jsx("strong",{children:"Admin:"})," admin@azzahra.com / admin123"]}),we.jsxs("p",{children:[we.jsx("strong",{children:"Reseller:"})," reseller@azzahra.com / reseller123"]}),we.jsxs("p",{children:[we.jsx("strong",{children:"Customer:"})," [email lain] / [password]"]})]}),we.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"* Email harus terdaftar di Firebase Authentication"})]})]})})},wg=({onClose:t,onSuccess:s})=>{const[r,n]=f.useState(""),[i,a]=f.useState(""),[o,l]=f.useState(""),[c,d]=f.useState(""),[u,h]=f.useState("customer"),[m,p]=f.useState(!1),[x,y]=f.useState(!1),[b,v]=f.useState(!1),[N,w]=f.useState(""),[j,k]=f.useState(1),{register:S}=vg(),_=e=>{switch(e){case"owner":return"bg-red-500 hover:bg-red-600 text-white";case"admin":return"bg-purple-500 hover:bg-purple-600 text-white";case"reseller":return"bg-blue-500 hover:bg-blue-600 text-white";default:return"bg-green-500 hover:bg-green-600 text-white"}};return 1===j?we.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:we.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md",children:[we.jsx("div",{className:"p-6 border-b border-gray-100",children:we.jsxs("div",{className:"flex items-center justify-between",children:[we.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Pilih Role Akun"}),we.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:we.jsx(K,{className:"w-5 h-5 text-gray-500"})})]})}),we.jsxs("div",{className:"p-6",children:[we.jsx("p",{className:"text-gray-600 mb-6",children:"Pilih jenis akun yang ingin Anda daftarkan:"}),we.jsx("div",{className:"space-y-3",children:[{role:"owner",title:"Owner",desc:"Pemilik bisnis - Akses penuh"},{role:"admin",title:"Administrator",desc:"Admin - Kelola produk dan pesanan"},{role:"reseller",title:"Reseller",desc:"Penjual reseller - Harga khusus"},{role:"customer",title:"Customer",desc:"Pelanggan - Belanja biasa"}].map(({role:e,title:t,desc:s})=>{const r=(e=>{switch(e){case"owner":return X;case"admin":return Y;default:return Q}})(e);return we.jsx("button",{onClick:()=>{h(e),k(2)},className:"w-full p-4 rounded-lg border-2 transition-all "+(u===e?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300"),children:we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx("div",{className:`p-2 rounded-lg ${_(e)}`,children:we.jsx(r,{className:"w-5 h-5"})}),we.jsxs("div",{className:"text-left",children:[we.jsx("h3",{className:"font-semibold text-gray-800",children:t}),we.jsx("p",{className:"text-sm text-gray-600",children:s})]})]})},e)})})]})]})}):we.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:we.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md",children:[we.jsx("div",{className:"p-6 border-b border-gray-100",children:we.jsxs("div",{className:"flex items-center justify-between",children:[we.jsxs("h2",{className:"text-xl font-bold text-gray-800",children:["Daftar ","owner"===u?"Owner":"admin"===u?"Admin":"reseller"===u?"Reseller":"Customer"]}),we.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:we.jsx(K,{className:"w-5 h-5 text-gray-500"})})]})}),we.jsxs("div",{className:"p-6",children:[N&&we.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:we.jsx("p",{className:"text-red-600 text-sm",children:N})}),we.jsxs("form",{onSubmit:n=>g(e,null,function*(){if(n.preventDefault(),w(""),r&&i&&o&&c)if(i===o)if(i.length<6)w("Password minimal 6 karakter!");else{v(!0);try{console.log("ðŸ”„ Firebase registration attempt:",{email:r,displayName:c,role:u});const e=yield S(r,i,c,u);if(e){const r={id:e.uid,name:e.displayName||c,email:e.email,role:e.role};console.log("âœ… Firebase registration successful:",r),s(r),t()}}catch(e){console.error("âŒ Firebase registration error:",e),w(e.message||"Registrasi gagal. Silakan coba lagi.")}finally{v(!1)}}else w("Password tidak cocok!");else w("Semua field harus diisi!")}),className:"space-y-4",children:[we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nama Lengkap"}),we.jsx("input",{type:"text",value:c,onChange:e=>d(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Masukkan nama lengkap",required:!0})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),we.jsx("input",{type:"email",value:r,onChange:e=>n(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:`contoh: ${u}@azzahra.com`,required:!0})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password"}),we.jsxs("div",{className:"relative",children:[we.jsx("input",{type:m?"text":"password",value:i,onChange:e=>a(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent pr-10",placeholder:"Minimal 6 karakter",required:!0}),we.jsx("button",{type:"button",onClick:()=>p(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:m?we.jsx(W,{className:"w-5 h-5"}):we.jsx(J,{className:"w-5 h-5"})})]})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password"}),we.jsxs("div",{className:"relative",children:[we.jsx("input",{type:x?"text":"password",value:o,onChange:e=>l(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent pr-10",placeholder:"Konfirmasi password",required:!0}),we.jsx("button",{type:"button",onClick:()=>y(!x),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:x?we.jsx(W,{className:"w-5 h-5"}):we.jsx(J,{className:"w-5 h-5"})})]})]}),we.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg",children:[we.jsxs("p",{className:"text-sm text-purple-700",children:[we.jsx("strong",{children:"Role:"})," ",u.charAt(0).toUpperCase()+u.slice(1)]}),we.jsxs("p",{className:"text-xs text-purple-600 mt-1",children:["owner"===u&&"Akses penuh ke semua fitur admin","admin"===u&&"Akses kelola produk dan pesanan","reseller"===u&&"Harga reseller dan poin reward","customer"===u&&"Akses berbelanja biasa"]})]}),we.jsxs("div",{className:"flex space-x-3 pt-4",children:[we.jsx("button",{type:"button",onClick:()=>k(1),className:"flex-1 p-3 border border-gray-300 text-gray-600 rounded-lg hover:bg-gray-50 transition-colors",children:"Kembali"}),we.jsx("button",{type:"submit",disabled:b,className:"flex-1 p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50",children:b?"Mendaftar...":"Daftar"})]})]})]})]})})},jg=({user:e,products:t,loading:s,onProductClick:r,onCartClick:n,onAddToCart:i})=>{const{timeLeft:a,isFlashSaleActive:o,loading:l}=ag(),{cartItems:c}=mg();if(console.log("âš¡ FlashSalePage Debug:",{isFlashSaleActive:o,timeLeft:a,flashSaleLoading:l}),t&&t.length>0){const e=t.filter(e=>e.isFlashSale);console.log("ðŸ” FlashSale products found:",e.length),e.forEach((e,t)=>{console.log(`ðŸ“¦ Product ${t+1}:`,{id:e.id,name:e.name,retailPrice:e.retailPrice,flashSalePrice:e.flashSalePrice,originalRetailPrice:e.originalRetailPrice,isFlashSale:e.isFlashSale,allPriceFields:{retailPrice:e.retailPrice,flashSalePrice:e.flashSalePrice,originalRetailPrice:e.originalRetailPrice,resellerPrice:e.resellerPrice,price:e.price}})})}const d=e=>{i(e)},u=f.useMemo(()=>{try{if(!Array.isArray(t)||0===t.length)return console.warn("âš ï¸ FlashSale: Products array is empty or invalid"),[];const e=t.filter(e=>e&&e.id&&e.name),s=e.filter(e=>e.isFlashSale&&o);return console.log(`ðŸ” FlashSalePage: Found ${s.length} flash sale products (same logic as HomePage)`),s}catch(e){return console.error("ðŸš¨ Error in flashSaleProducts calculation:",e),[]}},[t,o]);return s?we.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center",children:we.jsx("div",{className:"text-white text-xl",children:"Loading flash sale products..."})}):0===u.length?we.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900",children:we.jsxs("div",{className:"container mx-auto px-4 py-8",children:[we.jsxs("div",{className:"flex items-center justify-between mb-8",children:[we.jsx("h1",{className:"text-xl font-bold text-white",children:"Flash Sale âš¡"}),we.jsxs("button",{onClick:n,className:"relative p-2 bg-white/20 rounded-full hover:bg-white/30 transition-colors",children:[we.jsx(v,{className:"w-6 h-6 text-white"}),c.length>0&&we.jsx("span",{className:"absolute -top-2 -right-2 bg-yellow-400 text-gray-800 text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold",children:c.length})]})]}),we.jsxs("div",{className:"bg-gradient-to-br from-gray-700 via-gray-600 to-gray-500 rounded-2xl p-8 text-center max-w-3xl mx-auto shadow-2xl relative overflow-hidden",children:[we.jsxs("div",{className:"absolute inset-0 opacity-10",children:[we.jsx("div",{className:"absolute top-4 left-4 w-32 h-32 bg-white rounded-full -ml-16 -mt-16 animate-pulse"}),we.jsx("div",{className:"absolute bottom-4 right-4 w-24 h-24 bg-white rounded-full -mr-12 -mb-12 animate-pulse delay-100"})]}),we.jsxs("div",{className:"relative z-10",children:[we.jsx("div",{className:"bg-white/20 backdrop-blur-sm p-4 rounded-full w-20 h-20 mx-auto mb-6 shadow-lg",children:we.jsx("span",{className:"text-4xl",children:"â°"})}),we.jsx("h2",{className:"text-3xl font-bold bg-gradient-to-r from-yellow-200 to-white bg-clip-text text-transparent mb-4",children:"Flash Sale Sedang Disiapkan"}),we.jsx("p",{className:"text-gray-200 text-lg mb-2",children:"Nantikan Flash Sale Kami Selanjutnya!"}),we.jsx("p",{className:"text-gray-300 text-sm mb-8",children:"Diskon spesial dan penawaran terbatas akan segera hadir. Pastikan Anda tidak ketinggalan!"}),we.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[we.jsx("button",{onClick:()=>window.history.back(),className:"bg-white text-gray-700 px-6 py-3 rounded-full font-bold hover:bg-gray-50 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105",children:"Kembali"}),we.jsx("button",{onClick:()=>window.location.href="/",className:"bg-purple-600 text-white px-6 py-3 rounded-full font-bold hover:bg-purple-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-105",children:"Lihat Produk Lainnya"})]})]})]})]})}):we.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 pb-20",children:we.jsxs("div",{className:"container mx-auto px-4 py-8",children:[we.jsxs("div",{className:"flex items-center justify-between mb-6",children:[we.jsx("h1",{className:"text-xl font-bold text-white",children:"Flash Sale âš¡"}),we.jsxs("button",{onClick:n,className:"relative p-2 bg-white/20 rounded-full hover:bg-white/30 transition-colors",children:[we.jsx(v,{className:"w-6 h-6 text-white"}),c.length>0&&we.jsx("span",{className:"absolute -top-2 -right-2 bg-yellow-400 text-gray-800 text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold",children:c.length})]})]}),we.jsxs("div",{className:"bg-gradient-to-r from-red-600 to-orange-600 rounded-2xl p-8 mb-6 text-center relative overflow-hidden",children:[we.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-yellow-400 rounded-full -mr-16 -mt-16 opacity-20"}),we.jsx("div",{className:"absolute bottom-0 left-0 w-40 h-40 bg-yellow-400 rounded-full -ml-20 -mb-20 opacity-20"}),we.jsxs("div",{className:"relative z-10",children:[we.jsxs("div",{className:"flex items-center justify-center mb-4",children:[we.jsx(Z,{className:"w-12 h-12 text-yellow-300 mr-3"}),we.jsx("h1",{className:"text-4xl font-bold text-white",children:"FLASH SALE"}),we.jsx(Z,{className:"w-12 h-12 text-yellow-300 ml-3"})]}),we.jsx("p",{className:"text-xl text-white/90 mb-6",children:"Diskon Hingga 70%"}),a&&we.jsxs("div",{className:"bg-black/30 backdrop-blur-sm rounded-xl p-4 mb-4",children:[we.jsx("p",{className:"text-yellow-300 text-sm mb-2",children:"â° Flash Sale Berakhir Dalam"}),we.jsx("div",{className:"text-3xl font-bold text-white tracking-wider",children:a})]}),we.jsxs("div",{className:"flex items-center justify-center space-x-4 text-white/80",children:[we.jsxs("div",{className:"flex items-center",children:[we.jsx(ee,{className:"w-5 h-5 mr-1"}),we.jsx("span",{className:"text-sm",children:"Terbatas"})]}),we.jsxs("div",{className:"flex items-center",children:[we.jsx(te,{className:"w-5 h-5 mr-1"}),we.jsx("span",{className:"text-sm",children:"Diskon Spesial"})]})]})]})]}),we.jsxs("div",{className:"text-center text-white/60 text-sm mb-6",children:[u.length," produk flash sale tersedia"]}),we.jsx("div",{className:"grid grid-cols-2 gap-4",children:u.map(t=>we.jsx(og,{product:t,onProductClick:r,onAddToCart:d,isFlashSale:!0,user:e},t.id))})]})})},kg=new class{constructor(){m(this,"collection","orders")}createOrder(e){return g(this,null,function*(){try{console.log("ðŸ“¦ Creating order in Firebase...");const t=ng.currentUser;if(!t)throw new Error("User not authenticated");const s=u(d({},e),{id:this.generateOrderId(),userId:t.uid,createdAt:(new Date).toISOString(),updatedAt:(new Date).toISOString(),timestamp:Date.now()}),r=Nd(rg,this.collection,s.id);return yield ju(r,s),console.log("âœ… Order created in Firebase:",s.id),s}catch(t){throw console.error("âŒ Error creating order:",t),t}})}getUserOrders(){return g(this,null,function*(){try{console.log("ðŸ“¦ Loading orders from Firebase...");const e=ng.currentUser;if(!e)throw new Error("User not authenticated");const t=ru(vd(rg,this.collection),iu("userId","==",e.uid)),s=yield wu(t),r=[];return s.forEach(e=>{const t=e.data();r.push(u(d({},t),{id:e.id,createdAt:t.createdAt||(new Date).toISOString(),updatedAt:t.updatedAt||t.createdAt||(new Date).toISOString()}))}),console.log("âœ… Orders loaded from Firebase:",r.length,"orders"),r}catch(e){throw console.error("âŒ Error getting user orders:",e),e}})}updateOrderStatus(e,t){return g(this,null,function*(){try{console.log("ðŸ”„ Updating order status in Firebase:",e,"â†’",t);const s=Nd(rg,this.collection,e);return yield ku(s,{status:t,updatedAt:(new Date).toISOString()}),console.log("âœ… Order status updated successfully"),!0}catch(s){return console.error("âŒ Error updating order status:",s),!1}})}updateOrderPayment(e,t,s){return g(this,null,function*(){try{console.log("ðŸ’³ Updating order payment in Firebase Firestore:",e);let n="",i="";if(t instanceof File){n=t.name;try{console.log("ðŸ“¤ Converting payment proof to base64 (FREE storage)...");const e=new FileReader,s=new Promise((s,r)=>{e.onload=()=>{const t=e.result,r=t.split(",")[1]||t;s(r)},e.onerror=r,e.readAsDataURL(t)});i=yield s,console.log("âœ… Payment proof converted to base64, size:",i.length,"characters"),console.log("ðŸ’° FREE storage in Firestore - No Firebase Storage cost!")}catch(r){console.error("âŒ Error converting file to base64:",r),n=t.name,i=""}}else n=t;const a={paymentProof:n,paymentProofData:i,paymentProofUrl:"",updatedAt:(new Date).toISOString()};s&&(a.status=s);const o=Nd(rg,this.collection,e);return yield ku(o,a),console.log("âœ… Order payment updated in Firebase Firestore (FREE storage!)"),!0}catch(n){return console.error("âŒ Error updating order payment in Firebase Firestore:",n),!1}})}deleteOrder(e){return g(this,null,function*(){try{console.log("ðŸ—‘ï¸ Deleting order from Firebase:",e);const t=Nd(rg,this.collection,e);return yield Su(t),console.log("âœ… Order deleted successfully"),!0}catch(t){return console.error("âŒ Error deleting order:",t),!1}})}getAllOrders(){return g(this,null,function*(){try{console.log("ðŸ“¦ Loading all orders from Firebase...");const e=vd(rg,this.collection),t=yield wu(e),s=[];return t.forEach(e=>{const t=e.data();s.push(u(d({},t),{id:e.id,createdAt:t.createdAt||(new Date).toISOString(),updatedAt:t.updatedAt||t.createdAt||(new Date).toISOString()}))}),console.log("âœ… All orders loaded from Firebase:",s.length,"orders"),s}catch(e){throw console.error("âŒ Error getting all orders:",e),e}})}generateOrderId(){return"AZF"+Date.now().toString().slice(-8)}},Sg=({user:t})=>{var s,r;const[n,i]=f.useState("all"),[a,o]=f.useState(null),[l,c]=f.useState(!1),[h,m]=f.useState(null),{orders:p,loading:x,error:y}=(()=>{const[t,s]=f.useState([]),[r,n]=f.useState(!0),[i,a]=f.useState(null);return f.useEffect(()=>{let t=null;return g(e,null,function*(){try{const r=ng.currentUser;if(!r)return s([]),void n(!1);console.log("ðŸ“¦ Setting up orders listener for user:",r.uid);const i=ru(vd(rg,"orders"),iu("userId","==",r.uid));t=_u(i,e=>{const t=[];e.forEach(e=>{const s=e.data();t.push(u(d({},s),{id:e.id,createdAt:s.createdAt||(new Date).toISOString(),updatedAt:s.updatedAt||s.createdAt||(new Date).toISOString()}))}),console.log("âœ… Orders loaded from Firebase:",t.length,"orders"),s(t),n(!1),a(null)},t=>g(e,null,function*(){console.error("âŒ Error listening to orders:",t),a(t.message),n(!1),console.log("ðŸ”„ Falling back to ordersService...");try{const e=yield kg.getUserOrders();s(e),a(null)}catch(e){console.error("âŒ Fallback also failed:",e)}}))}catch(r){console.error("âŒ Error setting up orders listener:",r),a(r instanceof Error?r.message:"Unknown error"),n(!1)}}),()=>{t&&t()}},[]),{orders:t,loading:r,error:i}})(),b=e=>{o(e),c(!0)},v=()=>{c(!1),o(null),m(null)},N=(e,t)=>{navigator.clipboard.writeText(e),alert(`âœ… Nomor rekening ${t} berhasil disalin!\n\n${e}\na.n. Fahrin`)},w="all"===n?p:p.filter(e=>e.status===n),j={pending:{label:"Menunggu Pembayaran",icon:C,color:"text-orange-600 bg-orange-100"},awaiting_verification:{label:"Menunggu Verifikasi",icon:C,color:"text-yellow-600 bg-yellow-100"},paid:{label:"Dibayar",icon:re,color:"text-blue-600 bg-blue-100"},processing:{label:"Dikemas",icon:z,color:"text-blue-600 bg-blue-100"},shipped:{label:"Dikirim",icon:ne,color:"text-purple-600 bg-purple-100"},delivered:{label:"Selesai",icon:re,color:"text-green-600 bg-green-100"},cancelled:{label:"Dibatalkan",icon:se,color:"text-red-600 bg-red-100"}};return we.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[we.jsxs("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:[we.jsx("div",{className:"p-4",children:we.jsx("h1",{className:"text-lg font-semibold text-center",children:"Pesanan Saya"})}),we.jsx("div",{className:"px-4 pb-4",children:we.jsxs("div",{className:"relative",children:[we.jsx(I,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),we.jsx("input",{type:"text",placeholder:"Cari pesanan...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"})]})}),we.jsx("div",{className:"flex overflow-x-auto px-4 pb-2",children:[{id:"all",label:"Semua"},{id:"pending",label:"Belum Bayar"},{id:"awaiting_verification",label:"Menunggu Verifikasi"},{id:"processing",label:"Dikemas"},{id:"shipped",label:"Dikirim"},{id:"delivered",label:"Selesai"}].map(e=>we.jsx("button",{onClick:()=>i(e.id),className:"flex-shrink-0 px-4 py-2 mr-2 rounded-full text-sm font-medium transition-colors "+(n===e.id?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:e.label},e.id))})]}),we.jsx("div",{className:"p-4 space-y-4",children:x?we.jsxs("div",{className:"text-center py-12",children:[we.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500 mx-auto mb-4"}),we.jsx("p",{className:"text-gray-500",children:"Memuat pesanan..."})]}):y?we.jsxs("div",{className:"text-center py-12",children:[we.jsx(z,{className:"w-16 h-16 text-red-300 mx-auto mb-4"}),we.jsx("h3",{className:"text-lg font-semibold text-red-600 mb-2",children:"Error Loading Pesanan"}),we.jsx("p",{className:"text-gray-500",children:y})]}):0===w.length?we.jsxs("div",{className:"text-center py-12",children:[we.jsx(z,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),we.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"Belum Ada Pesanan"}),we.jsx("p",{className:"text-gray-500",children:"Pesanan Anda akan muncul di sini"})]}):w.map(e=>{var t,s;const r=j[e.status],n=r.icon;return we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsxs("div",{className:"flex items-center justify-between mb-3",children:[we.jsxs("div",{children:[we.jsxs("p",{className:"font-semibold text-gray-800",children:["#",e.id]}),we.jsx("p",{className:"text-sm text-gray-500",children:new Date(e.createdAt).toLocaleDateString("id-ID")})]}),we.jsxs("div",{className:`flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium ${r.color}`,children:[we.jsx(n,{className:"w-3 h-3"}),we.jsx("span",{children:r.label})]})]}),we.jsx("div",{className:"space-y-2 mb-3",children:e.items.map((e,t)=>we.jsxs("div",{className:"flex justify-between text-sm",children:[we.jsxs("span",{className:"text-gray-600",children:[e.productName," x",e.quantity]}),we.jsxs("span",{className:"font-medium",children:["Rp ",e.total.toLocaleString("id-ID")]})]},t))}),e.shippingCost&&e.shippingCost>0&&we.jsxs("div",{className:"flex justify-between text-sm py-2 border-t border-dashed border-gray-200",children:[we.jsxs("span",{className:"text-gray-600",children:["Ongkos Kirim (",null==(s=null==(t=e.shippingInfo)?void 0:t.courier)?void 0:s.toUpperCase(),")"]}),we.jsxs("span",{className:"font-medium text-blue-600",children:["Rp ",e.shippingCost.toLocaleString("id-ID")]})]}),we.jsxs("div",{className:"border-t pt-3 flex items-center justify-between",children:[we.jsx("span",{className:"text-sm text-gray-600",children:"Total Pesanan"}),we.jsxs("span",{className:"font-bold text-pink-600",children:["Rp ",e.finalTotal.toLocaleString("id-ID")]})]}),we.jsxs("div",{className:"mt-3 flex space-x-2",children:[we.jsx("button",{onClick:()=>o(e),className:"flex-1 bg-gray-100 text-gray-600 py-2 rounded-lg text-sm font-medium hover:bg-gray-200 transition-colors",children:"Detail"}),"pending"===e.status&&"transfer"===e.paymentMethod&&!e.paymentProof&&we.jsxs("button",{onClick:()=>b(e),className:"flex-1 bg-orange-500 text-white py-2 rounded-lg text-sm font-medium hover:bg-orange-600 transition-colors flex items-center justify-center space-x-1",children:[we.jsx(ie,{className:"w-4 h-4"}),we.jsx("span",{children:"Bayar"})]}),("pending"===e.status||"awaiting_verification"===e.status)&&e.paymentProof&&we.jsxs("div",{className:"flex-1 flex space-x-2",children:[we.jsx("div",{className:"flex-1 bg-yellow-100 text-yellow-700 py-2 rounded-lg text-sm font-medium text-center",children:"â³ Menunggu Verifikasi"}),we.jsxs("button",{onClick:()=>b(e),className:"px-3 py-2 bg-blue-500 text-white rounded-lg text-sm font-medium hover:bg-blue-600 transition-colors flex items-center space-x-1",children:[we.jsx(ae,{className:"w-3 h-3"}),we.jsx("span",{children:"Upload Ulang"})]})]}),"paid"===e.status&&we.jsx("div",{className:"flex-1 bg-blue-100 text-blue-700 py-2 rounded-lg text-sm font-medium text-center",children:"âœ… Pembayaran Terverifikasi"}),"delivered"===e.status&&we.jsx("button",{className:"flex-1 bg-pink-500 text-white py-2 rounded-lg text-sm font-medium hover:bg-pink-600 transition-colors",children:"Beli Lagi"})]})]},e.id)})}),a&&we.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:we.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md relative max-h-[90vh] overflow-y-auto",children:[we.jsx("button",{onClick:()=>o(null),className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600",children:we.jsx(K,{size:24})}),we.jsxs("div",{className:"mb-6",children:[we.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Detail Pesanan"}),we.jsxs("p",{className:"text-sm text-gray-600",children:["#",a.id]}),we.jsx("p",{className:"text-xs text-gray-500",children:new Date(a.createdAt).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})})]}),we.jsxs("div",{className:"mb-6",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Produk Pesanan"}),we.jsx("div",{className:"space-y-3",children:null==(s=a.items)?void 0:s.map((e,t)=>we.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[we.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center overflow-hidden flex-shrink-0",children:e.productImage?we.jsx("img",{src:e.productImage,alt:e.productName,className:"w-full h-full object-cover"}):we.jsx(z,{className:"w-6 h-6 text-gray-400"})}),we.jsxs("div",{className:"flex-1",children:[we.jsx("p",{className:"font-medium text-sm",children:e.productName}),e.selectedVariant&&we.jsxs("p",{className:"text-xs text-gray-500",children:[e.selectedVariant.size&&`Ukuran: ${e.selectedVariant.size}`,e.selectedVariant.size&&e.selectedVariant.color&&" â€¢ ",e.selectedVariant.color&&`Warna: ${e.selectedVariant.color}`]}),we.jsxs("p",{className:"text-xs text-gray-500",children:["x",e.quantity," â€¢ Rp ",e.price.toLocaleString("id-ID")]})]}),we.jsxs("span",{className:"font-medium text-sm",children:["Rp ",e.total.toLocaleString("id-ID")]})]},t))})]}),a.shippingInfo&&we.jsxs("div",{className:"mb-6",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Informasi Pengiriman"}),we.jsxs("div",{className:"space-y-2 text-sm",children:[we.jsxs("div",{children:[we.jsx("span",{className:"text-gray-600",children:"Penerima:"}),we.jsx("span",{className:"font-medium ml-2",children:a.shippingInfo.name})]}),we.jsxs("div",{children:[we.jsx("span",{className:"text-gray-600",children:"Telepon:"}),we.jsx("span",{className:"font-medium ml-2",children:a.shippingInfo.phone})]}),we.jsxs("div",{children:[we.jsx("span",{className:"text-gray-600",children:"Alamat:"}),we.jsx("span",{className:"font-medium ml-2",children:a.shippingInfo.address})]}),we.jsxs("div",{children:[we.jsx("span",{className:"text-gray-600",children:"Kurir:"}),we.jsxs("span",{className:"font-medium ml-2",children:[null==(r=a.shippingInfo.courier)?void 0:r.toUpperCase(),a.shippingInfo.shippingService&&` - ${a.shippingInfo.shippingService}`]})]}),a.shippingInfo.shippingETD&&we.jsxs("div",{children:[we.jsx("span",{className:"text-gray-600",children:"Estimasi:"}),we.jsx("span",{className:"font-medium ml-2",children:a.shippingInfo.shippingETD})]})]})]}),we.jsxs("div",{className:"border-t pt-4",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Ringkasan Pembayaran"}),we.jsxs("div",{className:"space-y-2 text-sm",children:[we.jsxs("div",{className:"flex justify-between",children:[we.jsx("span",{className:"text-gray-600",children:"Subtotal Produk"}),we.jsxs("span",{className:"font-medium",children:["Rp ",(a.totalAmount||0).toLocaleString("id-ID")]})]}),a.shippingCost&&a.shippingCost>0&&we.jsxs("div",{className:"flex justify-between",children:[we.jsx("span",{className:"text-gray-600",children:"Ongkos Kirim"}),we.jsxs("span",{className:"font-medium text-blue-600",children:["Rp ",a.shippingCost.toLocaleString("id-ID")]})]}),we.jsxs("div",{className:"flex justify-between text-lg font-bold pt-2 border-t",children:[we.jsx("span",{children:"Total Pembayaran"}),we.jsxs("span",{className:"text-pink-600",children:["Rp ",a.finalTotal.toLocaleString("id-ID")]})]})]})]}),a.paymentProof&&we.jsxs("div",{className:"mt-4 p-3 bg-green-50 rounded-lg",children:[we.jsx("p",{className:"text-sm text-green-800 font-medium",children:"âœ… Bukti pembayaran telah diupload"}),we.jsx("p",{className:"text-xs text-green-600",children:a.paymentProof})]}),a.notes&&we.jsxs("div",{className:"mt-4 p-3 bg-yellow-50 rounded-lg",children:[we.jsx("p",{className:"text-sm font-medium text-yellow-800 mb-1",children:"Catatan Pesanan:"}),we.jsx("p",{className:"text-sm text-yellow-700",children:a.notes})]}),we.jsx("button",{onClick:()=>o(null),className:"w-full mt-6 bg-gray-100 text-gray-700 py-2 rounded-lg font-medium hover:bg-gray-200 transition-colors",children:"Tutup"})]})}),l&&a&&we.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:we.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md relative max-h-[90vh] overflow-y-auto",children:[we.jsx("button",{onClick:v,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600",children:we.jsx(K,{size:24})}),we.jsxs("div",{className:"text-center mb-6",children:[we.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Pembayaran"}),we.jsxs("p",{className:"text-sm text-gray-600",children:["Pesanan #",a.id]}),we.jsxs("p",{className:"text-lg font-bold text-pink-600 mt-2",children:["Rp ",a.finalTotal.toLocaleString("id-ID")]}),a.paymentProof&&we.jsxs("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[we.jsx("p",{className:"text-yellow-800 text-sm font-medium",children:"ðŸ“„ Upload Ulang Bukti Pembayaran"}),we.jsxs("p",{className:"text-yellow-600 text-xs mt-1",children:["Bukti sebelumnya: ",a.paymentProof]})]})]}),we.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 mb-6",children:[we.jsx("h4",{className:"font-semibold text-blue-800 mb-3",children:"Transfer ke Rekening:"}),we.jsxs("div",{className:"space-y-3 text-sm",children:[we.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded-lg border border-blue-200",children:[we.jsxs("div",{children:[we.jsx("span",{className:"font-medium text-gray-700",children:"BCA"}),we.jsx("div",{className:"font-mono text-xs text-gray-600",children:"0511456494"})]}),we.jsxs("button",{onClick:()=>N("0511456494","BCA"),className:"flex items-center space-x-1 text-blue-600 hover:text-blue-700 text-xs font-medium transition-colors",children:[we.jsx(q,{className:"w-3 h-3"}),we.jsx("span",{children:"Salin"})]})]}),we.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded-lg border border-blue-200",children:[we.jsxs("div",{children:[we.jsx("span",{className:"font-medium text-gray-700",children:"BRI"}),we.jsx("div",{className:"font-mono text-xs text-gray-600",children:"066301000115566"})]}),we.jsxs("button",{onClick:()=>N("066301000115566","BRI"),className:"flex items-center space-x-1 text-blue-600 hover:text-blue-700 text-xs font-medium transition-colors",children:[we.jsx(q,{className:"w-3 h-3"}),we.jsx("span",{children:"Salin"})]})]}),we.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded-lg border border-blue-200",children:[we.jsxs("div",{children:[we.jsx("span",{className:"font-medium text-gray-700",children:"MANDIRI"}),we.jsx("div",{className:"font-mono text-xs text-gray-600",children:"310011008896"})]}),we.jsxs("button",{onClick:()=>N("310011008896","MANDIRI"),className:"flex items-center space-x-1 text-blue-600 hover:text-blue-700 text-xs font-medium transition-colors",children:[we.jsx(q,{className:"w-3 h-3"}),we.jsx("span",{children:"Salin"})]})]}),we.jsx("div",{className:"text-center mt-3 p-2 bg-blue-100 rounded-lg",children:we.jsx("p",{className:"text-blue-700 font-semibold text-sm",children:"a.n. Fahrin"})})]})]}),we.jsxs("div",{className:"mb-6",children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload Bukti Pembayaran"}),we.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[we.jsx("input",{type:"file",accept:"image/*",onChange:e=>{e.target.files&&e.target.files[0]&&m(e.target.files[0])},className:"hidden",id:"payment-proof-modal"}),we.jsxs("label",{htmlFor:"payment-proof-modal",className:"cursor-pointer",children:[we.jsx(ae,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),we.jsx("p",{className:"text-sm text-gray-600",children:h?h.name:"Klik untuk upload bukti transfer"})]})]})]}),we.jsx("button",{onClick:()=>g(e,null,function*(){if(a&&h)try{if(console.log("ðŸ’³ Uploading payment proof to Firebase:",a.id,h.name),yield kg.updateOrderPayment(a.id,h,"awaiting_verification")){v();const e=a.paymentProof?"Bukti pembayaran berhasil diupload ulang! Menunggu verifikasi admin.":"Bukti pembayaran berhasil dikirim! Menunggu verifikasi admin.";alert(e),console.log("âœ… Payment proof uploaded successfully, status changed to awaiting_verification")}else alert("âŒ Gagal mengupload bukti pembayaran. Silakan coba lagi.")}catch(e){console.error("âŒ Error submitting payment:",e),alert("âŒ Gagal mengupload bukti pembayaran. Silakan coba lagi.")}}),disabled:!h,className:"w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 px-4 rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed font-semibold transition-all",children:(null==a?void 0:a.paymentProof)?"Upload Ulang Bukti Pembayaran":"Kirim Bukti Pembayaran"})]})})]})},_g=({user:t,onLogout:s,onNavigateToAdminProducts:r,onNavigateToAdminOrders:n,onNavigateToAdminReports:i,onNavigateToAdminUsers:a,onNavigateToAdminCache:o,onNavigateToAddressManagement:l})=>{const[c,h]=f.useState(!1),[m,p]=f.useState(!1),[x,y]=f.useState(!1),[v,N]=f.useState({currentPassword:"",newPassword:"",confirmPassword:""}),w=t;console.log("ðŸ”¥ AccountPage rendered - user role:",null==w?void 0:w.role),console.log("ðŸ”¥ AccountPage rendered - final user role:",null==w?void 0:w.role),console.log("ðŸ”¥ User object:",w),console.log("ðŸ”¥ AccountPage loaded with complete settings menu!");const j=t=>g(e,null,function*(){if(t.preventDefault(),v.newPassword===v.confirmPassword)if(v.newPassword.length<6)alert("Password minimal 6 karakter!");else try{alert("âœ… Password berhasil diubah!"),N({currentPassword:"",newPassword:"",confirmPassword:""}),h(!1)}catch(e){alert("âŒ Gagal mengubah password: "+e.message)}else alert("Password baru tidak cocok!")});if(!w){console.log("âš ï¸ AccountPage: User is null, checking for stored sessions");try{let e=localStorage.getItem("temp_user_session");if(e||(e=localStorage.getItem("azzahra_current_user")),e)return console.log("ðŸ”„ AccountPage: Found stored user session, reloading page to restore..."),console.log("ðŸ’¡ This should trigger the useSupabaseAuthSimple hook to restore the session properly"),setTimeout(()=>{window.location.reload()},100),we.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:we.jsxs("div",{className:"text-center",children:[we.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600 mx-auto mb-4"}),we.jsx("p",{className:"text-gray-600",children:"Memulihkan sesi pengguna..."})]})});console.log("â„¹ï¸ AccountPage: No stored user session found")}catch(I){console.error("âŒ AccountPage: Failed to restore user session:",I)}return we.jsx("div",{className:"min-h-screen bg-gradient-to-br from-pink-50 to-purple-50 flex items-center justify-center",children:we.jsxs("div",{className:"text-center",children:[we.jsx(_,{className:"w-16 h-16 text-purple-400 mx-auto mb-4"}),we.jsx("p",{className:"text-gray-600 mb-4",children:"Silakan login terlebih dahulu"}),we.jsx("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:"Muat Ulang Halaman"})]})})}const k=(e=>{switch(e){case"owner":return{text:"Owner",icon:X,color:"text-red-600 bg-red-100"};case"admin":return{text:"Administrator",icon:b,color:"text-purple-600 bg-purple-100"};case"reseller":return{text:"Reseller",icon:_,color:"text-blue-600 bg-blue-100"};default:return{text:"Customer",icon:_,color:"text-green-600 bg-green-100"}}})(w.role),S=k.icon;return we.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[we.jsxs("div",{className:"bg-gradient-to-r from-pink-500 to-purple-600 text-white p-6",children:[we.jsxs("div",{className:"flex items-center space-x-4",children:[we.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-full flex items-center justify-center",children:we.jsx(_,{className:"w-8 h-8"})}),we.jsxs("div",{className:"flex-1",children:[we.jsx("h2",{className:"text-xl font-bold",children:w.name}),we.jsx("p",{className:"text-pink-100",children:w.email}),we.jsxs("div",{className:`inline-flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium mt-2 ${k.color}`,children:[we.jsx(S,{className:"w-3 h-3"}),we.jsx("span",{className:"text-gray-800",children:k.text})]})]})]}),"reseller"===w.role&&we.jsx("div",{className:"mt-4 bg-white/10 rounded-lg p-3",children:we.jsxs("div",{className:"flex items-center justify-between",children:[we.jsx("span",{className:"text-sm",children:"Total Poin"}),we.jsxs("span",{className:"text-lg font-bold",children:[w.points||0," pts"]})]})})]}),we.jsx("div",{className:"p-4",children:(()=>{switch(w.role){case"customer":return we.jsxs("div",{className:"space-y-4",children:[we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Informasi Akun"}),we.jsxs("div",{className:"space-y-3",children:[we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx(_,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{children:[we.jsx("p",{className:"text-sm text-gray-500",children:"Username"}),we.jsx("p",{className:"font-medium",children:w.name})]})]}),we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx(H,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{children:[we.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),we.jsx("p",{className:"font-medium",children:w.email})]})]}),we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx(B,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{children:[we.jsx("p",{className:"text-sm text-gray-500",children:"Telepon"}),we.jsx("p",{className:"font-medium",children:w.phone||"Belum diisi"})]})]}),we.jsxs("button",{onClick:l,className:"flex items-center space-x-3 w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:[we.jsx(U,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{className:"flex-1",children:[we.jsx("p",{className:"font-medium",children:"Alamat Saya"}),we.jsx("p",{className:"text-sm text-gray-500",children:"Kelola alamat pengiriman"})]})]})]})]}),we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Keamanan"}),we.jsx("button",{onClick:()=>h(!c),className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx(ue,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{className:"flex-1",children:[we.jsx("p",{className:"font-medium",children:"Ubah Password"}),we.jsx("p",{className:"text-sm text-gray-500",children:"Keamanan akun Anda"})]})]})}),c&&we.jsxs("form",{onSubmit:j,className:"mt-4 space-y-3",children:[we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Saat Ini"}),we.jsxs("div",{className:"relative",children:[we.jsx("input",{type:m?"text":"password",value:v.currentPassword,onChange:e=>N(u(d({},v),{currentPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),we.jsx("button",{type:"button",onClick:()=>p(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:m?we.jsx(W,{className:"w-5 h-5"}):we.jsx(J,{className:"w-5 h-5"})})]})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Baru"}),we.jsxs("div",{className:"relative",children:[we.jsx("input",{type:x?"text":"password",value:v.newPassword,onChange:e=>N(u(d({},v),{newPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),we.jsx("button",{type:"button",onClick:()=>y(!x),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:x?we.jsx(W,{className:"w-5 h-5"}):we.jsx(J,{className:"w-5 h-5"})})]})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password Baru"}),we.jsx("input",{type:"password",value:v.confirmPassword,onChange:e=>N(u(d({},v),{confirmPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg",required:!0})]}),we.jsxs("div",{className:"flex space-x-3",children:[we.jsx("button",{type:"button",onClick:()=>h(!1),className:"flex-1 p-3 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50",children:"Batal"}),we.jsx("button",{type:"submit",className:"flex-1 p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Simpan"})]})]})]}),we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Preferensi"}),we.jsx("div",{className:"space-y-3",children:we.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx(D,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{className:"flex-1",children:[we.jsx("p",{className:"font-medium",children:"Wishlist"}),we.jsx("p",{className:"text-sm text-gray-500",children:"Produk favorit Anda"})]})]})})})]})]});case"reseller":return we.jsxs("div",{className:"space-y-4",children:[we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Informasi Akun"}),we.jsxs("div",{className:"space-y-3",children:[we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx(_,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{children:[we.jsx("p",{className:"text-sm text-gray-500",children:"Username"}),we.jsx("p",{className:"font-medium",children:w.name})]})]}),we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx(H,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{children:[we.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),we.jsx("p",{className:"font-medium",children:w.email})]})]}),we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx(B,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{children:[we.jsx("p",{className:"text-sm text-gray-500",children:"Telepon"}),we.jsx("p",{className:"font-medium",children:w.phone||"Belum diisi"})]})]}),we.jsxs("button",{onClick:l,className:"flex items-center space-x-3 w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:[we.jsx(U,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{className:"flex-1",children:[we.jsx("p",{className:"font-medium",children:"Alamat Saya"}),we.jsx("p",{className:"text-sm text-gray-500",children:"Kelola alamat pengiriman"})]})]})]})]}),we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Point Reseller"}),we.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg p-4 text-white",children:[we.jsxs("div",{className:"flex items-center justify-between mb-2",children:[we.jsx("span",{className:"text-sm opacity-90",children:"Total Poin"}),we.jsx(me,{className:"w-6 h-6"})]}),we.jsxs("div",{className:"text-3xl font-bold",children:[w.points||0," pts"]}),we.jsx("div",{className:"mt-2 text-sm opacity-90",children:"Tukar dengan diskon khusus!"})]})]}),we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Keamanan"}),we.jsx("button",{onClick:()=>h(!c),className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx(ue,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{className:"flex-1",children:[we.jsx("p",{className:"font-medium",children:"Ubah Password"}),we.jsx("p",{className:"text-sm text-gray-500",children:"Keamanan akun Anda"})]})]})}),c&&we.jsxs("form",{onSubmit:j,className:"mt-4 space-y-3",children:[we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Saat Ini"}),we.jsxs("div",{className:"relative",children:[we.jsx("input",{type:m?"text":"password",value:v.currentPassword,onChange:e=>N(u(d({},v),{currentPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),we.jsx("button",{type:"button",onClick:()=>p(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:m?we.jsx(W,{className:"w-5 h-5"}):we.jsx(J,{className:"w-5 h-5"})})]})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Baru"}),we.jsxs("div",{className:"relative",children:[we.jsx("input",{type:x?"text":"password",value:v.newPassword,onChange:e=>N(u(d({},v),{newPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),we.jsx("button",{type:"button",onClick:()=>y(!x),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:x?we.jsx(W,{className:"w-5 h-5"}):we.jsx(J,{className:"w-5 h-5"})})]})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password Baru"}),we.jsx("input",{type:"password",value:v.confirmPassword,onChange:e=>N(u(d({},v),{confirmPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg",required:!0})]}),we.jsxs("div",{className:"flex space-x-3",children:[we.jsx("button",{type:"button",onClick:()=>h(!1),className:"flex-1 p-3 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50",children:"Batal"}),we.jsx("button",{type:"submit",className:"flex-1 p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Simpan"})]})]})]}),we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Preferensi Reseller"}),we.jsxs("div",{className:"space-y-3",children:[we.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx(D,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{className:"flex-1",children:[we.jsx("p",{className:"font-medium",children:"Wishlist"}),we.jsx("p",{className:"text-sm text-gray-500",children:"Produk favorit Anda"})]})]})}),we.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx(me,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{className:"flex-1",children:[we.jsx("p",{className:"font-medium",children:"Riwayat Poin"}),we.jsx("p",{className:"text-sm text-gray-500",children:"Lihat transaksi poin"})]})]})})]})]})]});case"admin":return we.jsxs("div",{className:"space-y-4",children:[we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Informasi Akun Admin"}),we.jsxs("div",{className:"space-y-3",children:[we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx(_,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{children:[we.jsx("p",{className:"text-sm text-gray-500",children:"Username"}),we.jsx("p",{className:"font-medium",children:w.name})]})]}),we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx(H,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{children:[we.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),we.jsx("p",{className:"font-medium",children:w.email})]})]}),we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx(B,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{children:[we.jsx("p",{className:"text-sm text-gray-500",children:"Telepon"}),we.jsx("p",{className:"font-medium",children:w.phone||"Belum diisi"})]})]}),we.jsxs("button",{onClick:l,className:"flex items-center space-x-3 w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:[we.jsx(U,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{className:"flex-1",children:[we.jsx("p",{className:"font-medium",children:"Alamat Saya"}),we.jsx("p",{className:"text-sm text-gray-500",children:"Kelola alamat pengiriman"})]})]})]})]}),we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Fitur Admin"}),we.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[we.jsxs("button",{onClick:r,className:"p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[we.jsx(z,{className:"w-6 h-6 mx-auto mb-2"}),we.jsx("p",{className:"text-sm",children:"Kelola Produk"})]}),we.jsxs("button",{onClick:n,className:"p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[we.jsx(z,{className:"w-6 h-6 mx-auto mb-2"}),we.jsx("p",{className:"text-sm",children:"Kelola Pesanan"})]}),we.jsxs("button",{onClick:i,className:"p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[we.jsx(le,{className:"w-6 h-6 mx-auto mb-2"}),we.jsx("p",{className:"text-sm",children:"Laporan"})]}),we.jsxs("button",{onClick:a,className:"p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[we.jsx(ce,{className:"w-6 h-6 mx-auto mb-2"}),we.jsx("p",{className:"text-sm",children:"Pelanggan"})]})]})]}),we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Statistik Admin"}),we.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[we.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[we.jsx(de,{className:"w-6 h-6 text-blue-600 mx-auto mb-2"}),we.jsx("p",{className:"text-sm text-gray-600",children:"Total Penjualan"}),we.jsx("p",{className:"text-xl font-bold text-blue-600",children:"Rp 0"})]}),we.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[we.jsx(z,{className:"w-6 h-6 text-green-600 mx-auto mb-2"}),we.jsx("p",{className:"text-sm text-gray-600",children:"Total Pesanan"}),we.jsx("p",{className:"text-xl font-bold text-green-600",children:"0"})]})]})]}),we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Keamanan Admin"}),we.jsx("button",{onClick:()=>h(!c),className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx(ue,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{className:"flex-1",children:[we.jsx("p",{className:"font-medium",children:"Ubah Password"}),we.jsx("p",{className:"text-sm text-gray-500",children:"Keamanan akun admin"})]})]})}),c&&we.jsxs("form",{onSubmit:j,className:"mt-4 space-y-3",children:[we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Saat Ini"}),we.jsxs("div",{className:"relative",children:[we.jsx("input",{type:m?"text":"password",value:v.currentPassword,onChange:e=>N(u(d({},v),{currentPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),we.jsx("button",{type:"button",onClick:()=>p(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:m?we.jsx(W,{className:"w-5 h-5"}):we.jsx(J,{className:"w-5 h-5"})})]})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Baru"}),we.jsxs("div",{className:"relative",children:[we.jsx("input",{type:x?"text":"password",value:v.newPassword,onChange:e=>N(u(d({},v),{newPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),we.jsx("button",{type:"button",onClick:()=>y(!x),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:x?we.jsx(W,{className:"w-5 h-5"}):we.jsx(J,{className:"w-5 h-5"})})]})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password Baru"}),we.jsx("input",{type:"password",value:v.confirmPassword,onChange:e=>N(u(d({},v),{confirmPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg",required:!0})]}),we.jsxs("div",{className:"flex space-x-3",children:[we.jsx("button",{type:"button",onClick:()=>h(!1),className:"flex-1 p-3 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50",children:"Batal"}),we.jsx("button",{type:"submit",className:"flex-1 p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Simpan"})]})]})]}),we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Preferensi Admin"}),we.jsxs("div",{className:"space-y-3",children:[we.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx(Y,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{className:"flex-1",children:[we.jsx("p",{className:"font-medium",children:"Keamanan"}),we.jsx("p",{className:"text-sm text-gray-500",children:"Pengaturan keamanan"})]})]})}),we.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx(Y,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{className:"flex-1",children:[we.jsx("p",{className:"font-medium",children:"Pengaturan Sistem"}),we.jsx("p",{className:"text-sm text-gray-500",children:"Konfigurasi aplikasi"})]})]})})]})]})]});case"owner":return we.jsxs("div",{className:"space-y-4",children:[we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Informasi Akun Owner"}),we.jsxs("div",{className:"space-y-3",children:[we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx(_,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{children:[we.jsx("p",{className:"text-sm text-gray-500",children:"Username"}),we.jsx("p",{className:"font-medium",children:w.name})]})]}),we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx(H,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{children:[we.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),we.jsx("p",{className:"font-medium",children:w.email})]})]}),we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx(B,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{children:[we.jsx("p",{className:"text-sm text-gray-500",children:"Telepon"}),we.jsx("p",{className:"font-medium",children:w.phone||"Belum diisi"})]})]}),we.jsxs("button",{onClick:l,className:"flex items-center space-x-3 w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:[we.jsx(U,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{className:"flex-1",children:[we.jsx("p",{className:"font-medium",children:"Alamat Saya"}),we.jsx("p",{className:"text-sm text-gray-500",children:"Kelola alamat pengiriman"})]})]})]})]}),we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Kontrol Owner"}),we.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[we.jsxs("button",{onClick:r,className:"p-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[we.jsx(z,{className:"w-6 h-6 mx-auto mb-2"}),we.jsx("p",{className:"text-sm",children:"Kelola Produk"})]}),we.jsxs("button",{onClick:n,className:"p-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[we.jsx(z,{className:"w-6 h-6 mx-auto mb-2"}),we.jsx("p",{className:"text-sm",children:"Kelola Pesanan"})]}),we.jsxs("button",{onClick:i,className:"p-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[we.jsx(le,{className:"w-6 h-6 mx-auto mb-2"}),we.jsx("p",{className:"text-sm",children:"Laporan"})]}),we.jsxs("button",{onClick:a,className:"p-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[we.jsx(ce,{className:"w-6 h-6 mx-auto mb-2"}),we.jsx("p",{className:"text-sm",children:"Kelola User"})]})]}),"owner"===(null==w?void 0:w.role)&&we.jsxs("div",{className:"mt-4",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Owner Tools"}),we.jsx("button",{onClick:o,className:"w-full p-3 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors mb-3",children:we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:we.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"})}),we.jsxs("div",{className:"flex-1 text-left",children:[we.jsx("p",{className:"font-medium",children:"Cache Management"}),we.jsx("p",{className:"text-sm opacity-90",children:"Kelola cache ongkir & alamat"})]})]})})]})]}),we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Statistik Bisnis"}),we.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[we.jsxs("div",{className:"text-center p-3 bg-red-50 rounded-lg",children:[we.jsx(de,{className:"w-6 h-6 text-red-600 mx-auto mb-2"}),we.jsx("p",{className:"text-sm text-gray-600",children:"Total Revenue"}),we.jsx("p",{className:"text-xl font-bold text-red-600",children:"Rp 0"})]}),we.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[we.jsx(z,{className:"w-6 h-6 text-green-600 mx-auto mb-2"}),we.jsx("p",{className:"text-sm text-gray-600",children:"Total Pesanan"}),we.jsx("p",{className:"text-xl font-bold text-green-600",children:"0"})]})]})]}),we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Keamanan Owner"}),we.jsx("button",{onClick:()=>h(!c),className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx(ue,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{className:"flex-1",children:[we.jsx("p",{className:"font-medium",children:"Ubah Password"}),we.jsx("p",{className:"text-sm text-gray-500",children:"Keamanan akun owner"})]})]})}),c&&we.jsxs("form",{onSubmit:j,className:"mt-4 space-y-3",children:[we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Saat Ini"}),we.jsxs("div",{className:"relative",children:[we.jsx("input",{type:m?"text":"password",value:v.currentPassword,onChange:e=>N(u(d({},v),{currentPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),we.jsx("button",{type:"button",onClick:()=>p(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:m?we.jsx(W,{className:"w-5 h-5"}):we.jsx(J,{className:"w-5 h-5"})})]})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Baru"}),we.jsxs("div",{className:"relative",children:[we.jsx("input",{type:x?"text":"password",value:v.newPassword,onChange:e=>N(u(d({},v),{newPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),we.jsx("button",{type:"button",onClick:()=>y(!x),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:x?we.jsx(W,{className:"w-5 h-5"}):we.jsx(J,{className:"w-5 h-5"})})]})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password Baru"}),we.jsx("input",{type:"password",value:v.confirmPassword,onChange:e=>N(u(d({},v),{confirmPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg",required:!0})]}),we.jsxs("div",{className:"flex space-x-3",children:[we.jsx("button",{type:"button",onClick:()=>h(!1),className:"flex-1 p-3 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50",children:"Batal"}),we.jsx("button",{type:"submit",className:"flex-1 p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Simpan"})]})]})]}),we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Pengaturan Owner"}),we.jsxs("div",{className:"space-y-3",children:[we.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx(Y,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{className:"flex-1",children:[we.jsx("p",{className:"font-medium",children:"Keamanan"}),we.jsx("p",{className:"text-sm text-gray-500",children:"Pengaturan keamanan tingkat lanjut"})]})]})}),we.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx(Y,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{className:"flex-1",children:[we.jsx("p",{className:"font-medium",children:"Sistem"}),we.jsx("p",{className:"text-sm text-gray-500",children:"Konfigurasi aplikasi"})]})]})}),we.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx(he,{className:"w-5 h-5 text-gray-400"}),we.jsxs("div",{className:"flex-1",children:[we.jsx("p",{className:"font-medium",children:"Backup & Restore"}),we.jsx("p",{className:"text-sm text-gray-500",children:"Cadangkan data"})]})]})})]})]})]});default:return null}})()}),we.jsx("div",{className:"p-4",children:we.jsx("div",{className:"bg-white rounded-lg shadow-sm",children:we.jsxs("button",{onClick:()=>{s()},className:"w-full p-4 flex items-center space-x-3 text-red-600 hover:bg-red-50 transition-colors rounded-lg",children:[we.jsx(oe,{className:"w-5 h-5"}),we.jsx("span",{children:"Keluar"})]})})})]})},Ig=({user:t,onBack:s})=>{const[r,n]=f.useState([]),[i,a]=f.useState(!0),[o,l]=f.useState(null),[c,d]=f.useState(!1),[u,h]=f.useState(null);f.useEffect(()=>{const e=gg.onAddressesChange(e=>{n(e),a(!1),l(null)});return()=>e()},[]);const m=t=>g(e,null,function*(){try{u?(yield gg.updateAddress(u.id,{name:t.name,phone:t.phone,fullAddress:t.fullAddress,province:t.province,provinceId:t.provinceId,city:t.city,cityId:t.cityId,district:t.district,districtId:t.districtId,subdistrict:t.subdistrict,subdistrictId:t.subdistrictId,postalCode:t.postalCode,isDefault:t.isDefault,updatedAt:(new Date).toISOString()}),console.log("âœ… Address updated")):(yield gg.saveAddress({name:t.name,phone:t.phone,fullAddress:t.fullAddress,province:t.province,provinceId:t.provinceId,city:t.city,cityId:t.cityId,district:t.district,districtId:t.districtId,subdistrict:t.subdistrict,subdistrictId:t.subdistrictId,postalCode:t.postalCode,isDefault:t.isDefault}),console.log("âœ… Address saved")),d(!1),h(null)}catch(e){console.error("âŒ Error saving address:",e),alert("Gagal menyimpan alamat. Silakan coba lagi.")}}),p=e=>`${e.fullAddress}, ${e.subdistrict}, ${e.district}, ${e.city}, ${e.province} ${e.postalCode}`;return c?we.jsx("div",{className:"min-h-screen bg-gray-50",children:we.jsx(fg,{initialData:u?{name:u.name,phone:u.phone,fullAddress:u.fullAddress,province:u.province,provinceId:u.provinceId,city:u.city,cityId:u.cityId,district:u.district,districtId:u.districtId,subdistrict:u.subdistrict,subdistrictId:u.subdistrictId,postalCode:u.postalCode,isDefault:u.isDefault}:null,onSave:m,onCancel:()=>{d(!1),h(null)}})}):we.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[we.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:we.jsxs("div",{className:"flex items-center p-4",children:[we.jsx("button",{onClick:s,className:"mr-4",children:we.jsx(A,{className:"w-6 h-6 text-gray-600"})}),we.jsx("h1",{className:"text-lg font-semibold",children:"Alamat Saya"})]})}),we.jsxs("div",{className:"p-4",children:[i?we.jsx("div",{className:"flex justify-center py-8",children:we.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-pink-500"})}):o?we.jsx("div",{className:"text-center py-8",children:we.jsxs("p",{className:"text-red-600",children:["Error: ",o]})}):0===r.length?we.jsxs("div",{className:"text-center py-8",children:[we.jsx(U,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),we.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"Belum Ada Alamat"}),we.jsx("p",{className:"text-gray-500 mb-6",children:"Tambahkan alamat pengiriman untuk memudahkan proses checkout"})]}):we.jsx("div",{className:"space-y-4",children:r.map(t=>we.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:we.jsxs("div",{className:"flex items-start justify-between",children:[we.jsxs("div",{className:"flex-1",children:[we.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[we.jsx(pe,{className:"w-4 h-4 text-pink-600"}),t.isDefault&&we.jsx("span",{className:"bg-pink-100 text-pink-600 text-xs px-2 py-1 rounded-full font-medium",children:"Utama"})]}),we.jsx("h3",{className:"font-semibold text-gray-800 mb-1",children:t.name}),we.jsx("p",{className:"text-sm text-gray-600 mb-2",children:t.phone}),we.jsx("p",{className:"text-sm text-gray-700",children:p(t)})]}),we.jsxs("div",{className:"flex space-x-2",children:[we.jsx("button",{onClick:()=>(e=>{h(e),d(!0)})(t),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",children:we.jsx(ge,{className:"w-4 h-4"})}),r.length>1&&we.jsx("button",{onClick:()=>{return s=t.id,g(e,null,function*(){if(window.confirm("Apakah Anda yakin ingin menghapus alamat ini?"))try{yield gg.deleteAddress(s),console.log("âœ… Address deleted")}catch(e){console.error("âŒ Error deleting address:",e),alert("Gagal menghapus alamat. Silakan coba lagi.")}});var s},className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:we.jsx(F,{className:"w-4 h-4"})}),!t.isDefault&&we.jsx("button",{onClick:()=>{return s=t.id,g(e,null,function*(){try{yield gg.setAsDefault(s),console.log("âœ… Default address updated")}catch(e){console.error("âŒ Error setting default address:",e),alert("Gagal mengatur alamat utama. Silakan coba lagi.")}});var s},className:"p-2 text-green-600 hover:bg-green-50 rounded-lg transition-colors",children:we.jsx(fe,{className:"w-4 h-4"})})]})]})},t.id))}),we.jsx("button",{onClick:()=>{d(!0),h(null)},className:"fixed bottom-24 right-4 w-14 h-14 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-full shadow-lg flex items-center justify-center hover:from-pink-600 hover:to-purple-700 transition-all",children:we.jsx(O,{className:"w-6 h-6"})})]})]})},Cg="azzahra_products_cache",Eg="azzahra_products_cache_expiry",Tg=()=>{const[t,s]=f.useState([]),[r,n]=f.useState(!0),[i,a]=f.useState(null),[o,l]=f.useState(!0),{saveToCache:c,getFromCache:d}=(()=>{const e=e=>{try{localStorage.setItem(Cg,JSON.stringify(e)),localStorage.setItem(Eg,Date.now().toString()),console.log("ðŸ’¾ Products cached:",e.length)}catch(i){console.warn("âŒ Failed to cache products:",i)}},t=()=>{try{const e=localStorage.getItem(Cg),t=localStorage.getItem(Eg);return e&&t?Date.now()-parseInt(t)>3e5?(console.log("â° Cache expired, clearing..."),s(),null):(console.log("âš¡ Loading from cache..."),JSON.parse(e)):null}catch(i){return console.warn("âŒ Failed to load from cache:",i),s(),null}},s=()=>{try{localStorage.removeItem(Cg),localStorage.removeItem(Eg),console.log("ðŸ—‘ï¸ Cache cleared")}catch(i){console.warn("âŒ Failed to clear cache:",i)}};return{saveToCache:e,getFromCache:t,clearCache:s,isCacheValid:()=>null!==t(),refreshCache:t=>{s(),e(t)}}})();return f.useEffect(()=>{console.log("âš¡ Loading products with smart cache...");const e=performance.now(),t=d();var r;t&&(console.log("ðŸš€ Instant load from cache -",t.length,"products"),s(t),n(!1),l(!1));const i=_u(ru(vd(rg,"products"),lu("createdAt","desc"),(r=50,cu._create("limit",r,"F"))),t=>{const r=performance.now(),i=t.docs.map(e=>{var t,s;const r=e.data(),n=r.createdAt?"string"==typeof r.createdAt?new Date(r.createdAt):null==(t=r.createdAt)?void 0:t.toDate():new Date,i=Number(r.retailPrice||r.price||0),a=Number(r.stock||0);return{id:e.id,name:r.name||"",description:r.description||"",category:r.category||"uncategorized",retailPrice:i,resellerPrice:Number(r.resellerPrice)||.8*i,costPrice:Number(r.costPrice)||.6*i,stock:a,images:r.images||[],image:(null==(s=r.images)?void 0:s[0])||"/placeholder-product.jpg",variants:{sizes:r.sizes||[],colors:r.colors||[]},isFeatured:Boolean(r.isFeatured),isFlashSale:Boolean(r.isFlashSale),flashSalePrice:Number(r.flashSalePrice)||i,createdAt:n,salesCount:Number(r.salesCount)||0,status:a>0?"ready":"po"}});if(o){const t=performance.now()-r,s=performance.now()-e;console.log("âš¡ Performance:"),console.log(`   - Processing time: ${t.toFixed(2)}ms`),console.log(`   - Total time: ${s.toFixed(2)}ms`),console.log(`ðŸ“Š Initial load complete. Total products: ${i.length}`),l(!1)}else console.log("ðŸ”„ Products updated in real-time");c(i),s(i),n(!1)});return()=>i()},[]),{products:t,loading:r,error:i,addProduct:t=>g(e,null,function*(){try{const e=yield function(e,t){const s=Or(e.firestore,_d),r=Nd(e),n=pu(e.converter,t);return Iu(s,[Vd(Ud(e.firestore),"addDoc",r._key,n,null!==e.converter,{}).toMutation(r._key,ua.exists(!1))]).then(()=>r)}(vd(rg,"products"),{name:t.name,description:t.description||"",category:t.category||"uncategorized",price:t.retailPrice,resellerPrice:t.resellerPrice,costPrice:t.costPrice,stock:t.stock||0,images:t.images||[],sizes:t.sizes||[],colors:t.colors||[],featured:t.isFeatured||!1,isFlashSale:t.isFlashSale||!1,flashSalePrice:t.flashSalePrice||t.retailPrice,salesCount:0,unit:t.unit||"pcs",createdAt:new Date});console.log("âœ… Product added with ID:",e.id)}catch(e){throw console.error("âŒ Error adding product:",e),e}}),updateProduct:(t,s)=>g(e,null,function*(){try{const e=Nd(rg,"products",t);yield ku(e,s),console.log("âœ… Product updated")}catch(e){throw console.error("âŒ Error updating product:",e),e}}),deleteProduct:t=>g(e,null,function*(){try{const e=Nd(rg,"products",t);yield Su(e),console.log("âœ… Product deleted")}catch(e){throw console.error("âŒ Error deleting product:",e),e}}),updateProductStock:(s,r)=>g(e,null,function*(){try{const e=Nd(rg,"products",s),n=t.find(e=>e.id===s);if(n){const t=Math.max(0,n.stock-r);return yield ku(e,{stock:t}),t}return 0}catch(e){throw console.error("âŒ Error updating stock:",e),e}}),setProducts:s}},Ag=()=>we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsxs("div",{className:"flex items-center justify-between mb-4",children:[we.jsx("div",{className:"h-6 bg-gray-200 rounded w-32 animate-pulse"}),we.jsxs("div",{className:"flex space-x-2",children:[we.jsx("div",{className:"h-10 bg-gray-200 rounded w-64 animate-pulse"}),we.jsx("div",{className:"h-10 bg-gray-200 rounded w-32 animate-pulse"}),we.jsx("div",{className:"h-10 bg-gray-200 rounded w-24 animate-pulse"})]})]}),we.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden mb-4",children:[we.jsxs("div",{className:"grid grid-cols-12 gap-4 p-4 bg-gray-50 border-b border-gray-200",children:[we.jsx("div",{className:"col-span-1 h-4 bg-gray-200 rounded animate-pulse"}),we.jsx("div",{className:"col-span-4 h-4 bg-gray-200 rounded animate-pulse"}),we.jsx("div",{className:"col-span-2 h-4 bg-gray-200 rounded animate-pulse"}),we.jsx("div",{className:"col-span-2 h-4 bg-gray-200 rounded animate-pulse"}),we.jsx("div",{className:"col-span-1 h-4 bg-gray-200 rounded animate-pulse"}),we.jsx("div",{className:"col-span-1 h-4 bg-gray-200 rounded animate-pulse"}),we.jsx("div",{className:"col-span-1 h-4 bg-gray-200 rounded animate-pulse"})]}),[...Array(5)].map((e,t)=>we.jsxs("div",{className:"grid grid-cols-12 gap-4 p-4 border-b border-gray-100 hover:bg-gray-50",children:[we.jsx("div",{className:"col-span-1 h-4 bg-gray-100 rounded animate-pulse"}),we.jsxs("div",{className:"col-span-4",children:[we.jsx("div",{className:"h-4 bg-gray-100 rounded w-3/4 mb-2 animate-pulse"}),we.jsx("div",{className:"h-3 bg-gray-50 rounded w-1/2 animate-pulse"})]}),we.jsx("div",{className:"col-span-2 h-4 bg-gray-100 rounded animate-pulse"}),we.jsx("div",{className:"col-span-2 h-4 bg-gray-100 rounded animate-pulse"}),we.jsx("div",{className:"col-span-1 h-4 bg-gray-100 rounded animate-pulse"}),we.jsx("div",{className:"col-span-1 h-4 bg-gray-100 rounded animate-pulse"}),we.jsx("div",{className:"col-span-1 h-8 bg-gray-100 rounded animate-pulse"})]},t))]}),we.jsxs("div",{className:"flex items-center justify-between",children:[we.jsx("div",{className:"h-4 bg-gray-200 rounded w-48 animate-pulse"}),we.jsx("div",{className:"flex space-x-1",children:[...Array(5)].map((e,t)=>we.jsx("div",{className:"h-8 w-8 bg-gray-200 rounded animate-pulse"},t))})]})]}),Pg=({onBack:t,user:s})=>{var r;const{products:n,loading:i,updateProduct:a,addProduct:o,deleteProduct:l}=Tg(),{flashSaleConfig:c,timeLeft:h,isFlashSaleActive:m,startFlashSale:p,stopFlashSale:x}=ag();f.useEffect(()=>{const e=n.filter(e=>e.isFlashSale);console.log("ðŸ” DEBUG AdminProductsPage:"),console.log("ðŸ“Š Total products:",n.length),console.log("ðŸ”¥ Flash sale products:",e.length),console.log("âš¡ Flash sale config active:",m),console.log("â° Time left:",h),console.log("ðŸ“‹ Flash sale config:",c),e.length>0&&console.log("ðŸ”¥ Flash sale product details:",e.map(e=>({name:e.name,id:e.id,isFlashSale:e.isFlashSale,flashSalePrice:e.flashSalePrice}))),e.length>0&&!m&&(console.error("ðŸš¨ INCONSISTENCY DETECTED: Products marked as flash sale but flash sale is not active!"),e.forEach(e=>{console.error(`ðŸš¨ Product "${e.name}" stuck in flash sale mode`)}))},[n,m,c,h]);const[v,N]=f.useState(!1),[w,j]=f.useState(!1),[_,E]=f.useState(!1),[T,P]=f.useState(!1),[D,R]=f.useState(null),[L,M]=f.useState([]),[U,V]=f.useState(""),[B,$]=f.useState(""),[q,H]=f.useState("name"),[G,W]=f.useState(1),[J,Q]=f.useState(10),[Y,X]=f.useState({name:"",description:"",category:"Hijab",retailPrice:0,resellerPrice:0,costPrice:0,stock:0,weight:1e3,images:[],variants:[{sizes:[],colors:[]}]}),[ee,te]=f.useState({category:"",retailPrice:0,discount:0,stock:0,status:"ready",isFeatured:!1}),[se,re]=f.useState({isActive:!1,startTime:"",endTime:"",flashSaleDiscount:0,productIds:[]}),ne=["Hijab","Gamis","Khimar","Tunik","Jaket","Bawahan","Aksesoris","Lainnya"],ie=y.useMemo(()=>{let e=[...n];return U&&(e=e.filter(e=>e.name.toLowerCase().includes(U.toLowerCase())||e.category.toLowerCase().includes(U.toLowerCase()))),B&&(e=e.filter(e=>e.category===B)),e.sort((e,t)=>{switch(q){case"price-asc":return e.retailPrice-t.retailPrice;case"price-desc":return t.retailPrice-e.retailPrice;case"date-newest":return new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime();case"date-oldest":return new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime();default:return e.name.localeCompare(t.name)}}),e},[n,U,B,q]),ae=Math.ceil(ie.length/J),oe=(G-1)*J,le=oe+J,ce=ie.slice(oe,le);f.useEffect(()=>{W(1)},[U,B,q,J]);const de=()=>g(e,null,function*(){try{const e=n.filter(e=>e.isFlashSale);for(const t of e)yield a(t.id,{isFlashSale:!1,flashSalePrice:null});yield x()}catch(e){console.error("Error ending flash sale:",e),alert("Gagal menghentikan flash sale")}});return we.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[we.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4",children:we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx("button",{onClick:t,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:we.jsx(A,{className:"w-5 h-5"})}),we.jsx("h1",{className:"text-xl font-bold",children:"Kelola Produk"})]})}),we.jsxs("div",{className:"p-4 space-y-4",children:[we.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[we.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[we.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-1",children:"Total Produk"}),we.jsx("p",{className:"text-2xl font-bold text-blue-600",children:n.length})]}),we.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[we.jsx("h4",{className:"text-sm font-medium text-green-800 mb-1",children:"Stok Tersedia"}),we.jsx("p",{className:"text-2xl font-bold text-green-600",children:n.reduce((e,t)=>e+t.stock,0)})]}),we.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[we.jsx("h4",{className:"text-sm font-medium text-purple-800 mb-1",children:"Kategori"}),we.jsx("p",{className:"text-2xl font-bold text-purple-600",children:ne.length})]}),we.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[we.jsx("h4",{className:"text-sm font-medium text-orange-800 mb-1",children:"Produk Unggulan"}),we.jsx("p",{className:"text-2xl font-bold text-orange-600",children:n.filter(e=>e.isFeatured).length})]})]}),m&&we.jsxs("div",{className:"bg-gradient-to-r from-red-50 to-orange-50 rounded-lg shadow-sm p-4 border border-red-200",children:[we.jsxs("div",{className:"flex items-center justify-between",children:[we.jsxs("div",{className:"flex items-center space-x-2",children:[we.jsx(Z,{className:"w-5 h-5 text-red-600"}),we.jsx("span",{className:"font-semibold text-red-800",children:"Flash Sale Aktif"})]}),we.jsxs("div",{className:"flex items-center space-x-3",children:[h&&we.jsxs("div",{className:"flex items-center space-x-1 bg-red-600 text-white px-3 py-1 rounded-full text-sm",children:[we.jsx(C,{className:"w-4 h-4"}),we.jsx("span",{className:"font-medium",children:h})]}),we.jsx("button",{onClick:de,className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors text-sm",children:"Stop Flash Sale"})]})]}),we.jsxs("p",{className:"text-sm text-red-700 mt-2",children:[n.filter(e=>e.isFlashSale).length," produk dengan diskon Rp ",(null==(r=null==c?void 0:c.flashSaleDiscount)?void 0:r.toLocaleString("id-ID"))||0]})]}),n.filter(e=>e.isFlashSale).length>0&&!m&&we.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4",children:[we.jsxs("div",{className:"flex items-center justify-between mb-2",children:[we.jsx("h3",{className:"text-sm font-semibold text-yellow-800",children:"âš ï¸ Flash Sale Cleanup Needed"}),we.jsxs("span",{className:"text-xs text-yellow-600",children:[n.filter(e=>e.isFlashSale).length," products stuck"]})]}),we.jsxs("p",{className:"text-xs text-yellow-700 mb-3",children:["Flash sale is not active but ",n.filter(e=>e.isFlashSale).length," products still have flash sale status. This may cause display issues."]}),we.jsxs("div",{className:"flex items-center space-x-2",children:[we.jsx("button",{onClick:de,className:"bg-yellow-600 text-white px-3 py-1 rounded hover:bg-yellow-700 transition-colors text-xs",children:"ðŸ§¹ Force Clean Up"}),we.jsx("button",{onClick:()=>{const e=n.filter(e=>e.isFlashSale);console.log("ðŸš¨ Stuck flash sale products:",e),alert(`Stuck products: ${e.map(e=>e.name).join(", ")}`)},className:"bg-gray-600 text-white px-3 py-1 rounded hover:bg-gray-700 transition-colors text-xs",children:"ðŸ“‹ Show Details"})]})]}),we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsx("div",{className:"flex items-center justify-between mb-4",children:we.jsx("h2",{className:"text-lg font-semibold",children:"Menu Utama"})}),we.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[we.jsxs("button",{onClick:()=>N(!0),className:"bg-blue-600 text-white p-4 rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-3",children:[we.jsx(O,{className:"w-6 h-6"}),we.jsxs("div",{className:"text-left",children:[we.jsx("p",{className:"font-semibold",children:"Tambah Produk"}),we.jsx("p",{className:"text-sm opacity-90",children:"Tambah produk baru"})]})]}),we.jsxs("button",{onClick:()=>{const e=n.filter(e=>e.isFeatured);e.length>0?(M(e.map(e=>e.id)),te(u(d({},ee),{isFeatured:!0})),E(!0)):alert("Belum ada produk unggulan. Pilih produk terlebih dahulu dari daftar produk.")},className:"bg-yellow-500 text-white p-4 rounded-lg hover:bg-yellow-600 transition-colors flex items-center space-x-3",children:[we.jsx(b,{className:"w-6 h-6"}),we.jsxs("div",{className:"text-left",children:[we.jsx("p",{className:"font-semibold",children:"Produk Unggulan"}),we.jsxs("p",{className:"text-sm opacity-90",children:["Kelola produk unggulan (",n.filter(e=>e.isFeatured).length,")"]})]})]}),we.jsxs("button",{onClick:()=>P(!0),className:"bg-red-600 text-white p-4 rounded-lg hover:bg-red-700 transition-colors flex items-center space-x-3",children:[we.jsx(Z,{className:"w-6 h-6"}),we.jsxs("div",{className:"text-left",children:[we.jsx("p",{className:"font-semibold",children:"Flash Sale"}),we.jsxs("p",{className:"text-sm opacity-90",children:["Atur diskon flash sale (",n.filter(e=>e.isFlashSale).length,")"]})]})]})]})]}),we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-4 space-y-4 md:space-y-0",children:[we.jsxs("h2",{className:"text-lg font-semibold",children:["Daftar Produk ",L.length>0&&`(${L.length} dipilih)`]}),we.jsxs("div",{className:"flex flex-col md:flex-row md:items-center space-y-3 md:space-y-0 md:space-x-3",children:[we.jsxs("div",{className:"relative",children:[we.jsx(I,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),we.jsx("input",{type:"text",placeholder:"Cari produk...",value:U,onChange:e=>V(e.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent w-full md:w-64"})]}),we.jsxs("select",{value:B,onChange:e=>$(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[we.jsx("option",{value:"",children:"Semua Kategori"}),ne.map(e=>we.jsx("option",{value:e,children:e},e))]}),we.jsxs("select",{value:q,onChange:e=>H(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[we.jsx("option",{value:"name",children:"Nama"}),we.jsx("option",{value:"price-asc",children:"Harga (Rendah ke Tinggi)"}),we.jsx("option",{value:"price-desc",children:"Harga (Tinggi ke Rendah)"}),we.jsx("option",{value:"date-newest",children:"Terbaru"}),we.jsx("option",{value:"date-oldest",children:"Terlama"})]}),L.length>0&&we.jsxs("button",{onClick:()=>E(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[we.jsx(ge,{className:"w-4 h-4"}),we.jsxs("span",{children:["Edit ",L.length," Produk"]})]})]})]}),i?we.jsx(Ag,{}):0===ce.length?we.jsxs("div",{className:"text-center py-8",children:[we.jsx(z,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),we.jsx("p",{className:"text-gray-500",children:U||B?"Tidak ada produk yang ditemukan":"Belum ada produk"})]}):we.jsxs(we.Fragment,{children:[we.jsx("div",{className:"overflow-x-auto",children:we.jsxs("table",{className:"w-full",children:[we.jsx("thead",{children:we.jsxs("tr",{className:"border-b",children:[we.jsx("th",{className:"text-left p-3",children:we.jsx("input",{type:"checkbox",checked:L.length===ce.length,onChange:e=>{e.target.checked?M(ce.map(e=>e.id)):M([])},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),we.jsx("th",{className:"text-left p-3",children:"Produk"}),we.jsx("th",{className:"text-left p-3",children:"Kategori"}),we.jsx("th",{className:"text-left p-3",children:"Harga"}),we.jsx("th",{className:"text-left p-3",children:"Stok"}),we.jsx("th",{className:"text-left p-3",children:"Status"}),we.jsx("th",{className:"text-left p-3",children:"Aksi"})]})}),we.jsx("tbody",{children:ce.map(t=>{var s;return we.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[we.jsx("td",{className:"p-3",children:we.jsx("input",{type:"checkbox",checked:L.includes(t.id),onChange:e=>{e.target.checked?M([...L,t.id]):M(L.filter(e=>e!==t.id))},className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"})}),we.jsx("td",{className:"p-3",children:we.jsxs("div",{className:"flex items-center space-x-3",children:[t.images.length>0?we.jsx("img",{src:t.image||t.images[0]||"/placeholder-product.jpg",alt:t.name,className:"w-10 h-10 object-cover rounded-lg"}):we.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center",children:we.jsx(z,{className:"w-5 h-5 text-gray-400"})}),we.jsxs("div",{children:[we.jsx("p",{className:"font-medium text-gray-900",children:t.name}),t.isFeatured&&we.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-yellow-100 text-yellow-800",children:"â­ Unggulan"}),t.isFlashSale&&we.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800 ml-2",children:"ðŸ”¥ Flash Sale"})]})]})}),we.jsx("td",{className:"p-3",children:we.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:t.category})}),we.jsx("td",{className:"p-3",children:we.jsx("div",{children:t.isFlashSale?we.jsxs(we.Fragment,{children:[we.jsxs("p",{className:"font-semibold text-red-600",children:["Rp ",null==(s=t.flashSalePrice)?void 0:s.toLocaleString("id-ID")]}),we.jsxs("p",{className:"text-sm text-gray-400 line-through",children:["Rp ",t.retailPrice.toLocaleString("id-ID")]})]}):we.jsxs("p",{className:"font-semibold",children:["Rp ",t.retailPrice.toLocaleString("id-ID")]})})}),we.jsx("td",{className:"p-3",children:we.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(t.stock>10?"bg-green-100 text-green-800":t.stock>0?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:[t.stock," pcs"]})}),we.jsx("td",{className:"p-3",children:we.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+(t.stock>0?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:t.stock>0?"Ready":"Habis"})}),we.jsx("td",{className:"p-3",children:we.jsxs("div",{className:"flex items-center space-x-2",children:[we.jsx("button",{onClick:()=>(e=>{R(e),X({name:e.name,description:e.description,category:e.category,retailPrice:e.retailPrice,resellerPrice:e.resellerPrice,costPrice:e.costPrice,stock:e.stock,weight:e.weight||1e3,images:e.images,variants:e.variants||[{sizes:[],colors:[]}]}),j(!0)})(t),className:"p-1 text-blue-600 hover:bg-blue-100 rounded",children:we.jsx(ge,{className:"w-4 h-4"})}),we.jsx("button",{onClick:()=>{return s=t.id,g(e,null,function*(){if(confirm("Apakah Anda yakin ingin menghapus produk ini?"))try{yield l(s)}catch(e){console.error("Error deleting product:",e),alert("Gagal menghapus produk")}});var s},className:"p-1 text-red-600 hover:bg-red-100 rounded",children:we.jsx(F,{className:"w-4 h-4"})})]})})]},t.id)})})]})}),ae>1&&we.jsxs("div",{className:"flex items-center justify-between mt-4",children:[we.jsxs("div",{className:"text-sm text-gray-700",children:["Menampilkan ",oe+1," hingga ",Math.min(le,ie.length)," dari ",ie.length," produk"]}),we.jsxs("div",{className:"flex items-center space-x-2",children:[we.jsx("button",{onClick:()=>W(Math.max(1,G-1)),disabled:1===G,className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:we.jsx(k,{className:"w-4 h-4"})}),Array.from({length:Math.min(5,ae)},(e,t)=>{let s;return s=ae<=5||G<=3?t+1:G>=ae-2?ae-4+t:G-2+t,we.jsx("button",{onClick:()=>W(s),className:"px-3 py-1 border rounded-lg "+(G===s?"bg-blue-600 text-white border-blue-600":"border-gray-300 hover:bg-gray-50"),children:s},s)}),we.jsx("button",{onClick:()=>W(Math.min(ae,G+1)),disabled:G===ae,className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:we.jsx(S,{className:"w-4 h-4"})})]})]})]})]})]}),v&&we.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:we.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[we.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4",children:we.jsxs("div",{className:"flex items-center justify-between",children:[we.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Tambah Produk Baru"}),we.jsx("button",{onClick:()=>N(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:we.jsx(K,{className:"w-5 h-5 text-gray-500"})})]})}),we.jsxs("form",{onSubmit:t=>g(e,null,function*(){t.preventDefault();try{const e=u(d({},Y),{createdAt:new Date,salesCount:0,isFeatured:!1,isFlashSale:!1,flashSalePrice:Y.retailPrice});yield o(e),X({name:"",description:"",category:"Hijab",retailPrice:0,resellerPrice:0,costPrice:0,stock:0,weight:1e3,images:[],variants:[{sizes:[],colors:[]}]}),N(!1)}catch(e){console.error("Error adding product:",e),alert("Gagal menambahkan produk")}}),className:"p-6 space-y-6",children:[we.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nama Produk *"}),we.jsx("input",{type:"text",required:!0,value:Y.name,onChange:e=>X(u(d({},Y),{name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kategori *"}),we.jsx("select",{required:!0,value:Y.category,onChange:e=>X(u(d({},Y),{category:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:ne.map(e=>we.jsx("option",{value:e,children:e},e))})]})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Deskripsi"}),we.jsx("textarea",{rows:3,value:Y.description,onChange:e=>X(u(d({},Y),{description:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),we.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Harga Jual (Rp) *"}),we.jsx("input",{type:"number",required:!0,min:"0",value:Y.retailPrice,onChange:e=>{const t=parseInt(e.target.value)||0;X(u(d({},Y),{retailPrice:t,resellerPrice:Math.round(.8*t),costPrice:Math.round(.6*t)}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Harga Reseller (Rp)"}),we.jsx("input",{type:"number",value:Y.resellerPrice,onChange:e=>X(u(d({},Y),{resellerPrice:parseInt(e.target.value)||0})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",readOnly:!0})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Harga Modal (Rp)"}),we.jsx("input",{type:"number",value:Y.costPrice,onChange:e=>X(u(d({},Y),{costPrice:parseInt(e.target.value)||0})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",readOnly:!0})]})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stok *"}),we.jsx("input",{type:"number",required:!0,min:"0",value:Y.stock,onChange:e=>X(u(d({},Y),{stock:parseInt(e.target.value)||0})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Berat Produk (gram) *"}),we.jsx("input",{type:"number",required:!0,min:"1",step:"1",value:Y.weight,onChange:e=>X(u(d({},Y),{weight:parseInt(e.target.value)||1e3})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"1000"}),we.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Berat produk dalam gram (contoh: 1000 = 1kg)"})]}),we.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[we.jsx("button",{type:"button",onClick:()=>N(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Batal"}),we.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Tambah Produk"})]})]})]})}),w&&D&&we.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:we.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[we.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4",children:we.jsxs("div",{className:"flex items-center justify-between",children:[we.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Edit Produk"}),we.jsx("button",{onClick:()=>{j(!1),R(null)},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:we.jsx(K,{className:"w-5 h-5 text-gray-500"})})]})}),we.jsxs("form",{onSubmit:t=>g(e,null,function*(){if(t.preventDefault(),D)try{yield a(D.id,Y),j(!1),R(null)}catch(e){console.error("Error updating product:",e),alert("Gagal memperbarui produk")}}),className:"p-6 space-y-6",children:[we.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nama Produk *"}),we.jsx("input",{type:"text",required:!0,value:Y.name,onChange:e=>X(u(d({},Y),{name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kategori *"}),we.jsx("select",{required:!0,value:Y.category,onChange:e=>X(u(d({},Y),{category:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:ne.map(e=>we.jsx("option",{value:e,children:e},e))})]})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Deskripsi"}),we.jsx("textarea",{rows:3,value:Y.description,onChange:e=>X(u(d({},Y),{description:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),we.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Harga Jual (Rp) *"}),we.jsx("input",{type:"number",required:!0,min:"0",value:Y.retailPrice,onChange:e=>{const t=parseInt(e.target.value)||0;X(u(d({},Y),{retailPrice:t,resellerPrice:Math.round(.8*t),costPrice:Math.round(.6*t)}))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Harga Reseller (Rp)"}),we.jsx("input",{type:"number",value:Y.resellerPrice,onChange:e=>X(u(d({},Y),{resellerPrice:parseInt(e.target.value)||0})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",readOnly:!0})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Harga Modal (Rp)"}),we.jsx("input",{type:"number",value:Y.costPrice,onChange:e=>X(u(d({},Y),{costPrice:parseInt(e.target.value)||0})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",readOnly:!0})]})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stok *"}),we.jsx("input",{type:"number",required:!0,min:"0",value:Y.stock,onChange:e=>X(u(d({},Y),{stock:parseInt(e.target.value)||0})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Berat Produk (gram) *"}),we.jsx("input",{type:"number",required:!0,min:"1",step:"1",value:Y.weight,onChange:e=>X(u(d({},Y),{weight:parseInt(e.target.value)||1e3})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"1000"}),we.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Berat produk dalam gram (contoh: 1000 = 1kg)"})]}),we.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[we.jsx("button",{type:"button",onClick:()=>{j(!1),R(null)},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Batal"}),we.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Simpan Perubahan"})]})]})]})}),_&&we.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:we.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[we.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4",children:we.jsxs("div",{className:"flex items-center justify-between",children:[we.jsxs("h2",{className:"text-xl font-bold text-gray-800",children:["Edit ",L.length," Produk Terpilih"]}),we.jsx("button",{onClick:()=>{E(!1),M([])},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:we.jsx(K,{className:"w-5 h-5 text-gray-500"})})]})}),we.jsxs("div",{className:"p-6 space-y-6",children:[we.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[we.jsx("h4",{className:"font-medium text-gray-800 mb-3",children:"Produk yang akan diedit:"}),we.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:L.map(e=>{const t=n.find(t=>t.id===e);return t?we.jsxs("div",{className:"flex items-center justify-between text-sm",children:[we.jsx("span",{className:"font-medium",children:t.name}),we.jsx("span",{className:"text-gray-500",children:t.category})]},t.id):null})})]}),we.jsxs("div",{className:"space-y-4",children:[we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ubah Kategori (kosongkan jika tidak ingin mengubah)"}),we.jsxs("select",{value:ee.category,onChange:e=>te(u(d({},ee),{category:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[we.jsx("option",{value:"",children:"-- Tidak Diubah --"}),ne.map(e=>we.jsx("option",{value:e,children:e},e))]})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ubah Harga Jual (Rp)"}),we.jsx("input",{type:"number",min:"0",value:ee.retailPrice||"",onChange:e=>te(u(d({},ee),{retailPrice:parseInt(e.target.value)||0})),placeholder:"Kosongkan jika tidak ingin mengubah",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ubah Stok"}),we.jsx("input",{type:"number",min:"0",value:ee.stock||"",onChange:e=>te(u(d({},ee),{stock:parseInt(e.target.value)||0})),placeholder:"Kosongkan jika tidak ingin mengubah",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status Produk Unggulan"}),we.jsxs("select",{value:ee.isFeatured?"true":"false",onChange:e=>te(u(d({},ee),{isFeatured:"true"===e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[we.jsx("option",{value:"false",children:"Tidak Unggulan"}),we.jsx("option",{value:"true",children:"Jadikan Unggulan"})]})]})]}),we.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[we.jsx("button",{onClick:()=>{E(!1),M([])},className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Batal"}),we.jsx("button",{onClick:()=>g(e,null,function*(){if(0!==L.length)try{const e={};ee.category&&(e.category=ee.category),ee.retailPrice>0&&(e.retailPrice=ee.retailPrice,e.resellerPrice=Math.round(.8*ee.retailPrice)),ee.stock>=0&&(e.stock=ee.stock),ee.status&&(e.status=ee.status),void 0!==ee.isFeatured&&(e.isFeatured=ee.isFeatured);for(const t of L)yield a(t,e);M([]),E(!1),te({category:"",retailPrice:0,discount:0,stock:0,status:"ready",isFeatured:!1})}catch(e){console.error("Error updating products:",e),alert("Gagal memperbarui produk")}else alert("Pilih setidaknya satu produk")}),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Simpan Perubahan"})]})]})]})}),T&&we.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:we.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[we.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4",children:we.jsxs("div",{className:"flex items-center justify-between",children:[we.jsxs("h2",{className:"text-xl font-bold text-gray-800 flex items-center space-x-2",children:[we.jsx(Z,{className:"w-6 h-6 text-red-600"}),we.jsx("span",{children:"Konfigurasi Flash Sale"})]}),we.jsx("button",{onClick:()=>P(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:we.jsx(K,{className:"w-5 h-5 text-gray-500"})})]})}),we.jsxs("div",{className:"p-6 space-y-6",children:[we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Pilih Produk untuk Flash Sale"}),we.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-60 overflow-y-auto border border-gray-200 rounded-lg p-3",children:n.filter(e=>!e.isFlashSale).map(e=>we.jsxs("label",{className:"flex items-center space-x-3 p-2 hover:bg-gray-50 rounded cursor-pointer",children:[we.jsx("input",{type:"checkbox",checked:se.productIds.includes(e.id),onChange:t=>{t.target.checked?re(u(d({},se),{productIds:[...se.productIds,e.id]})):re(u(d({},se),{productIds:se.productIds.filter(t=>t!==e.id)}))},className:"rounded border-gray-300 text-red-600 focus:ring-red-500"}),we.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.images.length>0?we.jsx("img",{src:e.image||e.images[0]||"/placeholder-product.jpg",alt:e.name,className:"w-8 h-8 object-cover rounded"}):we.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded flex items-center justify-center",children:we.jsx(z,{className:"w-4 h-4 text-gray-400"})}),we.jsxs("div",{className:"flex-1",children:[we.jsx("p",{className:"text-sm font-medium",children:e.name}),we.jsxs("p",{className:"text-xs text-gray-500",children:["Rp ",e.retailPrice.toLocaleString("id-ID")]})]})]})]},e.id))}),we.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:[se.productIds.length," produk dipilih"]})]}),we.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[we.jsxs("div",{children:[we.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[we.jsx(C,{className:"w-4 h-4 inline mr-1"}),"Waktu Mulai"]}),we.jsx("input",{type:"datetime-local",value:se.startTime,onChange:e=>re(u(d({},se),{startTime:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"})]}),we.jsxs("div",{children:[we.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[we.jsx(C,{className:"w-4 h-4 inline mr-1"}),"Waktu Berakhir"]}),we.jsx("input",{type:"datetime-local",value:se.endTime,onChange:e=>re(u(d({},se),{endTime:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"})]})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Diskon Flash Sale (Rp)"}),we.jsx("input",{type:"number",value:se.flashSaleDiscount||"",onChange:e=>re(u(d({},se),{flashSaleDiscount:parseInt(e.target.value)||0})),placeholder:"Masukkan jumlah diskon",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"})]}),we.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[we.jsx("button",{onClick:()=>P(!1),className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Batal"}),we.jsxs("div",{className:"flex items-center space-x-2",children:[m&&we.jsxs("button",{onClick:de,className:"bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors flex items-center space-x-2",children:[we.jsx(Z,{className:"w-4 h-4"}),we.jsx("span",{children:"Stop Flash Sale"})]}),se.productIds.length>0&&we.jsxs("button",{onClick:()=>g(e,null,function*(){if(0!==se.productIds.length)try{for(const e of se.productIds){const t=n.find(t=>t.id===e);if(t){const s=Math.round(t.retailPrice-se.flashSaleDiscount);yield a(e,{isFlashSale:!0,flashSalePrice:Math.max(s,1e3)})}}yield p(se),P(!1),re({isActive:!1,startTime:"",endTime:"",flashSaleDiscount:0,productIds:[]})}catch(e){console.error("Error starting flash sale:",e),alert("Gagal memulai flash sale")}else alert("Pilih setidaknya satu produk untuk flash sale")}),className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors flex items-center space-x-2",children:[we.jsx(Z,{className:"w-4 h-4"}),we.jsx("span",{children:"Mulai Flash Sale"})]})]})]})]})]})})]})},Dg=({onBack:t,user:s})=>{var r,n,i,a,o,l,c,h,m,p;const{orders:x}=(()=>{const[t,s]=f.useState([]),[r,n]=f.useState(!0),[i,a]=f.useState(null);return f.useEffect(()=>{let t=null;return g(e,null,function*(){try{if(!ng.currentUser)return s([]),void n(!1);console.log("ðŸ“¦ Setting up admin orders listener for all orders");const r=ru(vd(rg,"orders"),lu("timestamp","desc"));t=_u(r,e=>{const t=[];e.forEach(e=>{const s=e.data();t.push(u(d({},s),{id:e.id,createdAt:s.createdAt||(new Date).toISOString(),updatedAt:s.updatedAt||s.createdAt||(new Date).toISOString()}))}),console.log("âœ… All orders loaded from Firebase for admin:",t.length,"orders"),s(t),n(!1),a(null)},t=>g(e,null,function*(){console.error("âŒ Error listening to admin orders:",t),a(t.message),n(!1),console.log("ðŸ”„ Falling back to ordersService...");try{const e=yield kg.getAllOrders();s(e),a(null)}catch(e){console.error("âŒ Fallback also failed:",e)}}))}catch(r){console.error("âŒ Error setting up admin orders listener:",r),a(r instanceof Error?r.message:"Unknown error"),n(!1)}}),()=>{t&&t()}},[]),{orders:t,loading:r,error:i}})(),[y,b]=f.useState(""),[v,N]=f.useState("all"),[w,j]=f.useState("all"),[k,S]=f.useState("all"),[E,T]=f.useState(!1),[P,D]=f.useState(null),[R,O]=f.useState(!1),[L,F]=f.useState(""),[M,V]=f.useState(""),[$,q]=f.useState(""),[H,G]=f.useState(!1),[W,Q]=f.useState(!1),[Y,X]=f.useState(null),Z=(t,s)=>g(e,null,function*(){return yield kg.updateOrderStatus(t,s)}),ee=(t,s,r)=>g(e,null,function*(){return yield kg.updateOrderPayment(t,s,r)}),te=e=>x.filter(t=>t.status===e);f.useEffect(()=>{const e=e=>{console.log("AdminOrdersPage: Order update received",e.detail),b(e=>e+" "),setTimeout(()=>b(e=>e.trim()),100)};return window.addEventListener("orderUpdated",e),()=>window.removeEventListener("orderUpdated",e)},[]);const oe={pending:{label:"Menunggu Pembayaran",icon:C,color:"text-orange-600 bg-orange-100"},awaiting_verification:{label:"Menunggu Verifikasi",icon:C,color:"text-yellow-600 bg-yellow-100"},paid:{label:"Dibayar",icon:re,color:"text-blue-600 bg-blue-100"},processing:{label:"Diproses",icon:z,color:"text-purple-600 bg-purple-100"},shipped:{label:"Dikirim",icon:ne,color:"text-indigo-600 bg-indigo-100"},delivered:{label:"Selesai",icon:re,color:"text-green-600 bg-green-100"},cancelled:{label:"Dibatalkan",icon:se,color:"text-red-600 bg-red-100"}},le=x.filter(e=>{const t=""===y||e.id.toLowerCase().includes(y.toLowerCase())||e.userName.toLowerCase().includes(y.toLowerCase())||e.userEmail.toLowerCase().includes(y.toLowerCase()),s="all"===v||e.status===v,r="all"===w||`${e.userName} (${e.userEmail})`===w,n="all"===k||e.items&&e.items.some(e=>e.productName===k);return t&&s&&r&&n}),ce=e=>{D(e),O(!0)},de=(e,t,s="")=>{let r="",n="";switch(t){case"processing":n="Proses Pesanan",r=`Apakah barang sudah datang dan siap untuk diproses?\n\nPesanan #${s} akan diproses.`;break;case"shipped":n="Kirim Pesanan",r=`Apakah barang sudah dikirim ke pelanggan?\n\nPesanan #${s} akan ditandai sebagai terkirim.`;break;case"delivered":n="Selesaikan Pesanan",r=`Apakah barang sudah diterima pelanggan dan selesai?\n\nPesanan #${s} akan ditandai sebagai selesai.`;break;default:r=`Apakah Anda yakin ingin mengubah status pesanan #${s}?`}window.confirm(`${n}\n\n${r}`)&&Z(e,t)},ue=t=>g(e,null,function*(){if(P)try{"paid"===t?yield ee(P.id,L||"payment_verified","paid"):yield Z(P.id,t),O(!1),D(null),F(""),V("")}catch(e){console.error("âŒ Error confirming verification:",e),alert("Gagal memperbarui verifikasi pesanan")}}),he=t=>{window.confirm("Apakah Anda yakin ingin menghapus pesanan ini?")&&(t=>{g(e,null,function*(){return yield kg.deleteOrder(t)})})(t)};return we.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[we.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4",children:we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx("button",{onClick:t,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:we.jsx(A,{className:"w-5 h-5"})}),we.jsx("h1",{className:"text-xl font-bold",children:"Kelola Pesanan"})]})}),we.jsxs("div",{className:"p-4 space-y-4",children:[we.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[we.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[we.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-1",children:"Total Pesanan"}),we.jsx("p",{className:"text-2xl font-bold text-blue-600",children:x.length})]}),we.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[we.jsx("h4",{className:"text-sm font-medium text-orange-800 mb-1",children:"Menunggu"}),we.jsx("p",{className:"text-2xl font-bold text-orange-600",children:te("pending").length+te("awaiting_verification").length})]}),we.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[we.jsx("h4",{className:"text-sm font-medium text-green-800 mb-1",children:"Selesai"}),we.jsx("p",{className:"text-2xl font-bold text-green-600",children:te("delivered").length})]}),we.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[we.jsx("h4",{className:"text-sm font-medium text-purple-800 mb-1",children:"Total Revenue"}),we.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[Math.round(x.reduce((e,t)=>e+t.finalTotal,0)/1e3),"K"]})]})]}),we.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:we.jsxs("div",{className:"space-y-3",children:[we.jsx("div",{className:"flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3",children:we.jsxs("div",{className:"flex-1 relative",children:[we.jsx(I,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),we.jsx("input",{type:"text",placeholder:"Cari pesanan...",value:y,onChange:e=>b(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),we.jsxs("div",{className:"flex flex-wrap gap-2",children:[we.jsxs("select",{value:v,onChange:e=>N(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[we.jsx("option",{value:"all",children:"Semua Status"}),Object.entries(oe).map(([e,t])=>we.jsx("option",{value:e,children:t.label},e))]}),we.jsxs("select",{value:w,onChange:e=>j(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm min-w-[200px]",children:[we.jsx("option",{value:"all",children:"Semua Pelanggan"}),(()=>{const e=new Set;return x.forEach(t=>{t.userName&&t.userEmail&&e.add(`${t.userName} (${t.userEmail})`)}),Array.from(e).sort()})().map((e,t)=>we.jsx("option",{value:e,children:e},t))]}),we.jsxs("select",{value:k,onChange:e=>S(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm min-w-[150px]",children:[we.jsx("option",{value:"all",children:"Semua Produk"}),(()=>{const e=new Set;return x.forEach(t=>{t.items&&t.items.forEach(t=>{t.productName&&e.add(t.productName)})}),Array.from(e).sort()})().map((e,t)=>we.jsx("option",{value:e,children:e},t))]}),we.jsx("input",{type:"date",value:$,onChange:e=>q(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"}),we.jsx("button",{className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:we.jsx(xe,{className:"w-4 h-4"})}),("all"!==v||"all"!==w||"all"!==k||y||$)&&we.jsx("button",{onClick:()=>{b(""),N("all"),j("all"),S("all"),q("")},className:"px-3 py-2 bg-red-50 text-red-600 border border-red-200 rounded-lg hover:bg-red-100 transition-colors text-sm font-medium",children:"Reset Filter"})]})]})}),we.jsx("div",{className:"space-y-3",children:0===le.length?we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-8 text-center",children:[we.jsx(z,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),we.jsx("p",{className:"text-gray-500",children:"Belum ada pesanan"}),we.jsx("p",{className:"text-sm text-gray-400",children:"Pesanan akan muncul di sini ketika ada checkout"})]}):le.map(e=>{const t=oe[e.status],r=t.icon;return we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 hover:shadow-md transition-shadow",children:[we.jsxs("div",{className:"flex items-center justify-between mb-3",children:[we.jsxs("div",{children:[we.jsxs("p",{className:"font-semibold text-lg",children:["#",e.id]}),we.jsxs("p",{className:"text-sm text-gray-600",children:[e.userName," â€¢ ",e.userEmail]}),we.jsx("p",{className:"text-xs text-gray-500",children:new Date(e.createdAt).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})})]}),we.jsxs("div",{className:"text-right",children:[we.jsxs("div",{className:`inline-flex items-center space-x-1 px-3 py-1 rounded-full text-xs font-medium ${t.color}`,children:[we.jsx(r,{className:"w-3 h-3"}),we.jsx("span",{children:t.label})]}),we.jsxs("p",{className:"text-lg font-semibold text-pink-600 mt-1",children:["Rp ",e.finalTotal.toLocaleString("id-ID")]})]})]}),we.jsxs("div",{className:"flex items-center justify-between",children:[we.jsxs("div",{className:"text-sm text-gray-600",children:[e.items.length," item â€¢ ","transfer"===e.paymentMethod?"Transfer Bank":"COD"]}),we.jsxs("div",{className:"flex items-center space-x-2",children:[we.jsxs("button",{onClick:()=>(e=>{D(e),T(!0)})(e),className:"flex items-center space-x-1 text-blue-600 hover:text-blue-700 text-sm font-medium",children:[we.jsx(J,{className:"w-4 h-4"}),we.jsx("span",{children:"Detail"})]}),"pending"===e.status||"awaiting_verification"===e.status?"owner"===(null==s?void 0:s.role)?we.jsxs("button",{onClick:()=>ce(e),className:"flex items-center space-x-1 text-green-600 hover:text-green-700 text-sm font-medium",children:[we.jsx(re,{className:"w-4 h-4"}),we.jsx("span",{children:"Verifikasi"})]}):we.jsxs("div",{className:"flex items-center space-x-1 text-gray-400 text-sm font-medium",children:[we.jsx(re,{className:"w-4 h-4"}),we.jsx("span",{children:"Verifikasi (Owner Only)"})]}):"paid"===e.status&&(e.paymentProof||e.paymentProofData)?we.jsxs("div",{className:"flex items-center space-x-1 text-blue-600 text-sm font-medium",children:[we.jsx(ie,{className:"w-4 h-4"}),we.jsx("span",{children:"Sudah Diverifikasi"})]}):null,"paid"===e.status&&we.jsxs("button",{onClick:()=>de(e.id,"processing",e.id),className:"flex items-center space-x-1 text-purple-600 hover:text-purple-700 text-sm font-medium",children:[we.jsx(z,{className:"w-4 h-4"}),we.jsx("span",{children:"Proses"})]}),"processing"===e.status&&we.jsxs("button",{onClick:()=>de(e.id,"shipped",e.id),className:"flex items-center space-x-1 text-indigo-600 hover:text-indigo-700 text-sm font-medium",children:[we.jsx(ne,{className:"w-4 h-4"}),we.jsx("span",{children:"Kirim"})]}),"shipped"===e.status&&we.jsxs("button",{onClick:()=>de(e.id,"delivered",e.id),className:"flex items-center space-x-1 text-green-600 hover:text-green-700 text-sm font-medium",children:[we.jsx(re,{className:"w-4 h-4"}),we.jsx("span",{children:"Selesai"})]}),"owner"===(null==s?void 0:s.role)&&we.jsxs("button",{onClick:()=>he(e.id),className:"flex items-center space-x-1 text-red-600 hover:text-red-700 text-sm font-medium",children:[we.jsx(se,{className:"w-4 h-4"}),we.jsx("span",{children:"Batal"})]})]})]})]},e.id)})})]}),E&&P&&we.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:we.jsxs("div",{className:"bg-white rounded-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[we.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4",children:we.jsxs("div",{className:"flex items-center justify-between",children:[we.jsxs("h2",{className:"text-xl font-bold text-gray-800",children:["Detail Pesanan #",P.id]}),we.jsx("button",{onClick:()=>T(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:we.jsx(K,{className:"w-5 h-5 text-gray-500"})})]})}),we.jsxs("div",{className:"p-6 space-y-6",children:[we.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[we.jsxs("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center",children:[we.jsx(_,{className:"w-4 h-4 mr-2"}),"Informasi Pelanggan"]}),we.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[we.jsxs("div",{children:[we.jsx("p",{className:"text-gray-600",children:"Nama"}),we.jsx("p",{className:"font-medium",children:P.userName})]}),we.jsxs("div",{children:[we.jsx("p",{className:"text-gray-600",children:"Email"}),we.jsx("p",{className:"font-medium",children:P.userEmail})]})]})]}),we.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[we.jsxs("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center",children:[we.jsx(U,{className:"w-4 h-4 mr-2"}),"Informasi Pengiriman"]}),we.jsxs("div",{className:"space-y-2 text-sm",children:[we.jsxs("div",{children:[we.jsx("p",{className:"text-gray-600",children:"Nama Penerima"}),we.jsx("p",{className:"font-medium",children:(null==(r=P.shippingInfo)?void 0:r.name)||"-"})]}),we.jsxs("div",{children:[we.jsx("p",{className:"text-gray-600",children:"No. Telepon"}),we.jsxs("p",{className:"font-medium flex items-center",children:[we.jsx(B,{className:"w-3 h-3 mr-1"}),(null==(n=P.shippingInfo)?void 0:n.phone)||"-"]})]}),we.jsxs("div",{children:[we.jsx("p",{className:"text-gray-600",children:"Alamat"}),we.jsx("p",{className:"font-medium",children:(null==(i=P.shippingInfo)?void 0:i.address)||"-"})]}),(null==(a=P.shippingInfo)?void 0:a.isDropship)&&we.jsx("div",{className:"mt-2 p-2 bg-yellow-100 rounded",children:we.jsxs("p",{className:"text-xs text-yellow-800",children:[we.jsx("strong",{children:"Dropship:"})," ",P.shippingInfo.dropshipName," (",P.shippingInfo.dropshipPhone,")"]})})]})]}),we.jsxs("div",{children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Detail Produk"}),we.jsx("div",{className:"space-y-3",children:null==(o=P.items)?void 0:o.map((e,t)=>{var s,r;return we.jsxs("div",{className:"flex items-center space-x-4 p-3 bg-gray-50 rounded-lg",children:[we.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center overflow-hidden",children:e.productImage?we.jsx("img",{src:e.productImage,alt:e.productName,className:"w-full h-full object-cover"}):we.jsx(z,{className:"w-8 h-8 text-gray-400"})}),we.jsxs("div",{className:"flex-1",children:[we.jsx("p",{className:"font-medium",children:e.productName}),we.jsxs("p",{className:"text-sm text-gray-600",children:[null==(s=e.selectedVariant)?void 0:s.size,", ",null==(r=e.selectedVariant)?void 0:r.color," â€¢ ",e.quantity," pcs"]}),we.jsxs("p",{className:"text-xs text-gray-500",children:["Rp ",e.price.toLocaleString("id-ID")," Ã— ",e.quantity]})]}),we.jsxs("div",{className:"text-right",children:[we.jsxs("p",{className:"font-medium text-lg",children:["Rp ",e.total.toLocaleString("id-ID")]}),we.jsx("p",{className:"text-sm text-gray-600",children:"Subtotal"})]})]},t)})})]}),we.jsx("div",{className:"border-t pt-4",children:we.jsxs("div",{className:"space-y-2 text-sm",children:[we.jsxs("div",{className:"flex justify-between",children:[we.jsx("span",{className:"text-gray-600",children:"Subtotal"}),we.jsxs("span",{className:"font-medium",children:["Rp ",null==(l=P.totalAmount)?void 0:l.toLocaleString("id-ID")]})]}),we.jsxs("div",{className:"flex justify-between",children:[we.jsx("span",{className:"text-gray-600",children:"Ongkos Kirim"}),we.jsxs("span",{className:"font-medium",children:["Rp ",null==(c=P.shippingCost)?void 0:c.toLocaleString("id-ID")]})]}),we.jsxs("div",{className:"flex justify-between text-lg font-bold pt-2 border-t",children:[we.jsx("span",{children:"Total"}),we.jsxs("span",{className:"text-pink-600",children:["Rp ",null==(h=P.finalTotal)?void 0:h.toLocaleString("id-ID")]})]})]})}),we.jsxs("div",{className:(P.paymentProof||P.paymentProofData?"paid"===P.status?"bg-blue-50":"bg-green-50":"bg-gray-50")+" rounded-lg p-4",children:[we.jsxs("div",{className:"flex items-center justify-between mb-3",children:[we.jsxs("h3",{className:"font-semibold text-gray-800 flex items-center",children:[we.jsx(ie,{className:"w-4 h-4 mr-2"}),"Bukti Pembayaran ","paid"===P.status&&"(Terverifikasi)"]}),!P.paymentProof&&!P.paymentProofData&&we.jsxs("button",{onClick:()=>(X(P),void Q(!0)),className:"flex items-center space-x-1 text-blue-600 hover:text-blue-700 text-sm font-medium",children:[we.jsx(ae,{className:"w-4 h-4"}),we.jsx("span",{children:"Upload"})]})]}),P.paymentProof||P.paymentProofData?we.jsx("div",{children:P.paymentProofData||P.paymentProofUrl?we.jsx("div",{children:P.paymentProofData?we.jsxs("div",{children:[we.jsx("img",{src:`data:image/*;base64,${P.paymentProofData}`,alt:"Payment Proof",className:"w-full max-w-md rounded-lg border-2 border-green-200",onClick:()=>{const e=window.open("","_blank");e&&e.document.write(`\n                                    <html>\n                                      <body style="margin:0;padding:20px;background:#f3f4f6;">\n                                        <img src="data:image/*;base64,${P.paymentProofData}"\n                                             style="max-width:100%;height:auto;display:block;margin:0 auto;"\n                                             alt="Payment Proof" />\n                                      </body>\n                                    </html>\n                                  `)},style:{cursor:"pointer"}}),we.jsx("p",{className:"text-xs text-gray-600 mt-2 text-center",children:"ðŸ’¡ Klik gambar untuk memperbesar (Base64 FREE Storage)"})]}):we.jsxs("div",{children:[we.jsx("img",{src:P.paymentProofUrl,alt:"Payment Proof",className:"w-full max-w-md rounded-lg border-2 border-green-200",onClick:()=>window.open(P.paymentProofUrl,"_blank"),style:{cursor:"pointer"}}),we.jsx("p",{className:"text-xs text-gray-600 mt-2 text-center",children:"ðŸ’¡ Klik gambar untuk memperbesar"})]})}):we.jsxs("div",{className:"text-sm text-green-800",children:[we.jsx("p",{className:"font-medium",children:"ðŸ“Ž File Bukti Pembayaran:"}),we.jsx("p",{className:"bg-white p-2 rounded border border-green-200 mt-1",children:P.paymentProof}),we.jsx("p",{className:"text-xs mt-2 text-gray-600",children:"(File tersimpan di Firebase Firestore - Gratis!)"})]})}):we.jsxs("div",{className:"text-sm text-gray-600 text-center py-4",children:[we.jsx(ae,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),we.jsx("p",{children:"Belum ada bukti pembayaran"}),we.jsx("p",{className:"text-xs",children:'Klik tombol "Upload" untuk menambahkan bukti pembayaran'})]})]}),"paid"===P.status&&we.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[we.jsxs("h3",{className:"font-semibold text-gray-800 mb-2 flex items-center",children:[we.jsx(re,{className:"w-4 h-4 mr-2 text-blue-600"}),"Status Pembayaran"]}),we.jsxs("p",{className:"text-sm text-blue-800",children:["âœ… Pembayaran telah diverifikasi pada ",new Date(P.updatedAt).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})]})]}),P.notes&&we.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4",children:[we.jsx("h3",{className:"font-semibold text-gray-800 mb-2",children:"Catatan"}),we.jsx("p",{className:"text-sm text-gray-700",children:P.notes})]}),we.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t",children:[we.jsx("button",{onClick:()=>T(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"Tutup"}),("pending"===P.status||"awaiting_verification"===P.status)&&"owner"===(null==s?void 0:s.role)&&we.jsxs("button",{onClick:()=>{T(!1),ce(P)},className:"px-4 py-2 bg-green-600 text-white hover:bg-green-700 rounded-lg transition-colors flex items-center space-x-2",children:[we.jsx(re,{className:"w-4 h-4"}),we.jsx("span",{children:"Verifikasi Pembayaran"})]})]})]})]})}),R&&P&&we.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:we.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full",children:[we.jsx("div",{className:"border-b border-gray-200 px-6 py-4",children:we.jsxs("div",{className:"flex items-center justify-between",children:[we.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Verifikasi Pembayaran"}),we.jsx("button",{onClick:()=>O(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:we.jsx(K,{className:"w-5 h-5 text-gray-500"})})]})}),we.jsxs("div",{className:"p-6 space-y-4",children:[we.jsxs("div",{className:"text-center",children:[we.jsx(re,{className:"w-12 h-12 text-green-600 mx-auto mb-3"}),we.jsxs("h3",{className:"font-medium text-gray-800 mb-2",children:["Pesanan #",P.id]}),we.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Total: Rp ",null==(m=P.finalTotal)?void 0:m.toLocaleString("id-ID")]})]}),we.jsx("div",{className:"space-y-3",children:we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Catatan Verifikasi"}),we.jsx("textarea",{value:M,onChange:e=>V(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Tambahkan catatan jika diperlukan..."})]})}),we.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:we.jsxs("p",{className:"text-sm text-blue-800",children:[we.jsx("strong",{children:"Periksa:"})," Pastikan bukti pembayaran sudah sesuai dengan jumlah yang dibayarkan."]})}),we.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t",children:[we.jsx("button",{onClick:()=>ue("cancelled"),className:"px-4 py-2 text-red-700 bg-red-100 hover:bg-red-200 rounded-lg transition-colors",children:"Tolak"}),we.jsxs("button",{onClick:()=>ue("paid"),className:"px-4 py-2 bg-green-600 text-white hover:bg-green-700 rounded-lg transition-colors flex items-center space-x-2",children:[we.jsx(fe,{className:"w-4 h-4"}),we.jsx("span",{children:"Konfirmasi"})]})]})]})]})}),W&&Y&&we.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:we.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full",children:[we.jsx("div",{className:"border-b border-gray-200 px-6 py-4",children:we.jsxs("div",{className:"flex items-center justify-between",children:[we.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Upload Bukti Pembayaran"}),we.jsx("button",{onClick:()=>Q(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",disabled:H,children:we.jsx(K,{className:"w-5 h-5 text-gray-500"})})]})}),we.jsxs("div",{className:"p-6 space-y-4",children:[we.jsxs("div",{className:"text-center",children:[we.jsx(ae,{className:"w-12 h-12 text-blue-600 mx-auto mb-3"}),we.jsxs("h3",{className:"font-medium text-gray-800 mb-2",children:["Pesanan #",Y.id]}),we.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Total: Rp ",null==(p=Y.finalTotal)?void 0:p.toLocaleString("id-ID")]})]}),we.jsx("div",{className:"space-y-3",children:we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pilih File Bukti Pembayaran"}),we.jsx("input",{id:"payment-proof-file",type:"file",accept:"image/*",onChange:t=>g(e,null,function*(){var s;const r=null==(s=t.target.files)?void 0:s[0];if(r&&Y)if(r.type.startsWith("image/"))if(r.size>5242880)alert("Ukuran file maksimal 5MB");else{G(!0);try{const t=new FileReader;t.onload=t=>g(e,null,function*(){var e;const s=null==(e=t.target)?void 0:e.result;try{yield ee(Y.id,s,Y.status),alert("âœ… Bukti pembayaran berhasil diupload!"),Q(!1),X(null),b(e=>e+" "),setTimeout(()=>b(e=>e.trim()),100)}catch(r){console.error("âŒ Error uploading payment proof:",r),alert("Gagal mengupload bukti pembayaran")}finally{G(!1)}}),t.readAsDataURL(r)}catch(n){console.error("âŒ Error reading file:",n),alert("Gagal membaca file"),G(!1)}}else alert("Harap upload file gambar (JPG, PNG, dll)")}),disabled:H,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed"}),we.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Format: JPG, PNG, maksimal 5MB"})]})}),we.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:we.jsxs("p",{className:"text-sm text-blue-800",children:[we.jsx("strong",{children:"Informasi:"})," Upload bukti pembayaran dari pelanggan jika belum ada."]})}),we.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t",children:[we.jsx("button",{onClick:()=>Q(!1),disabled:H,className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Batal"}),we.jsx("button",{onClick:()=>{var e;return null==(e=document.getElementById("payment-proof-file"))?void 0:e.click()},disabled:H,className:"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 rounded-lg transition-colors flex items-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed",children:H?we.jsxs(we.Fragment,{children:[we.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),we.jsx("span",{children:"Uploading..."})]}):we.jsxs(we.Fragment,{children:[we.jsx(ae,{className:"w-4 h-4"}),we.jsx("span",{children:"Upload"})]})})]})]})]})})]})},Rg=({onBack:e,user:t})=>{const[s,r]=f.useState("sales"),[n,i]=f.useState("today"),[a,o]=f.useState((new Date).toISOString().split("T")[0]),[l,c]=f.useState((new Date).toISOString().split("T")[0]),d={sales:{totalSales:25e5,totalOrders:45,avgOrderValue:55555,topProduct:"Hijab Segi Empat Premium",topCategory:"Hijab",growth:15.5},products:{totalProducts:12,lowStock:3,outOfStock:0,topSelling:"Gamis Syari Elegant",worstSelling:"Khimar Basic",avgPrice:125e3},customers:{totalCustomers:234,newCustomers:28,activeCustomers:189,topCustomer:"Siti Nurhaliza",avgOrdersPerCustomer:2.3}},u=d[s]||d.sales;return we.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[we.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4",children:we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx("button",{onClick:e,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:we.jsx(A,{className:"w-5 h-5"})}),we.jsx("h1",{className:"text-xl font-bold",children:"Laporan"})]})}),we.jsxs("div",{className:"p-4 space-y-4",children:[we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Jenis Laporan"}),we.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[we.jsxs("button",{onClick:()=>r("sales"),className:"p-3 rounded-lg border-2 transition-colors "+("sales"===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"),children:[we.jsx(le,{className:"w-6 h-6 mx-auto mb-2"}),we.jsx("p",{className:"text-sm font-medium",children:"Penjualan"})]}),we.jsxs("button",{onClick:()=>r("products"),className:"p-3 rounded-lg border-2 transition-colors "+("products"===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"),children:[we.jsx(z,{className:"w-6 h-6 mx-auto mb-2"}),we.jsx("p",{className:"text-sm font-medium",children:"Produk"})]}),we.jsxs("button",{onClick:()=>r("customers"),className:"p-3 rounded-lg border-2 transition-colors "+("customers"===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"),children:[we.jsx(ce,{className:"w-6 h-6 mx-auto mb-2"}),we.jsx("p",{className:"text-sm font-medium",children:"Pelanggan"})]}),we.jsxs("button",{onClick:()=>r("financial"),className:"p-3 rounded-lg border-2 transition-colors "+("financial"===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"),children:[we.jsx(de,{className:"w-6 h-6 mx-auto mb-2"}),we.jsx("p",{className:"text-sm font-medium",children:"Keuangan"})]})]})]}),we.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:we.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:space-x-4 space-y-3 md:space-y-0",children:[we.jsxs("div",{className:"flex-1",children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Periode"}),we.jsxs("select",{value:n,onChange:e=>i(e.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[we.jsx("option",{value:"today",children:"Hari Ini"}),we.jsx("option",{value:"week",children:"Minggu Ini"}),we.jsx("option",{value:"month",children:"Bulan Ini"}),we.jsx("option",{value:"year",children:"Tahun Ini"}),we.jsx("option",{value:"custom",children:"Custom"})]})]}),"custom"===n&&we.jsxs(we.Fragment,{children:[we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dari"}),we.jsx("input",{type:"date",value:a,onChange:e=>o(e.target.value),className:"p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sampai"}),we.jsx("input",{type:"date",value:l,onChange:e=>c(e.target.value),className:"p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),we.jsxs("button",{className:"p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[we.jsx(ye,{className:"w-4 h-4"}),we.jsx("span",{children:"Generate"})]}),we.jsx("button",{className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:we.jsx(xe,{className:"w-4 h-4"})})]})}),we.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsxs("div",{className:"flex items-center justify-between mb-2",children:[we.jsxs("h3",{className:"text-sm font-medium text-gray-600",children:["Total ","sales"===s?"Penjualan":"products"===s?"Produk":"Pelanggan"]}),we.jsx(de,{className:"w-4 h-4 text-green-500"})]}),we.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["sales"===s&&`Rp ${u.totalSales.toLocaleString("id-ID")}`,"products"===s&&u.totalProducts,"customers"===s&&u.totalCustomers,"financial"===s&&"Rp 5.2M"]}),we.jsx("p",{className:"text-xs text-green-600",children:"+15.5% dari periode lalu"})]}),we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsxs("div",{className:"flex items-center justify-between mb-2",children:[we.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Transaksi"}),we.jsx(z,{className:"w-4 h-4 text-blue-500"})]}),we.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["sales"===s&&u.totalOrders,"products"===s&&u.lowStock,"customers"===s&&u.newCustomers,"financial"===s&&"142"]}),we.jsxs("p",{className:"text-xs text-gray-500",children:["sales"===s&&"Total pesanan","products"===s&&"Stok rendah","customers"===s&&"Pelanggan baru","financial"===s&&"Total transaksi"]})]}),we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsxs("div",{className:"flex items-center justify-between mb-2",children:[we.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Rata-rata"}),we.jsx(be,{className:"w-4 h-4 text-purple-500"})]}),we.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["sales"===s&&`Rp ${u.avgOrderValue.toLocaleString("id-ID")}`,"products"===s&&`Rp ${u.avgPrice.toLocaleString("id-ID")}`,"customers"===s&&u.avgOrdersPerCustomer,"financial"===s&&"Rp 36K"]}),we.jsxs("p",{className:"text-xs text-gray-500",children:["sales"===s&&"Nilai per order","products"===s&&"Harga rata-rata","customers"===s&&"Order per pelanggan","financial"===s&&"Transaksi rata-rata"]})]}),we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsxs("div",{className:"flex items-center justify-between mb-2",children:[we.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Terbaik"}),we.jsx(le,{className:"w-4 h-4 text-orange-500"})]}),we.jsx("p",{className:"text-lg font-bold text-gray-800 truncate",children:u.topProduct||u.topCustomer||"Hijab"}),we.jsxs("p",{className:"text-xs text-gray-500 truncate",children:["sales"===s&&"Produk terlaris","products"===s&&"Produk terlaris","customers"===s&&"Pelanggan terbaik","financial"===s&&"Kategori terlaris"]})]})]}),we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[we.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Grafik ","sales"===s?"Penjualan":"products"===s?"Produk":"Pelanggan"]}),we.jsx("div",{className:"h-64 bg-gray-100 rounded-lg flex items-center justify-center",children:we.jsxs("div",{className:"text-center",children:[we.jsx(le,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),we.jsx("p",{className:"text-gray-500",children:"Grafik akan ditampilkan di sini"}),we.jsx("p",{className:"text-sm text-gray-400",children:"Integrasi chart library diperlukan"})]})})]}),we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsxs("div",{className:"flex items-center justify-between mb-4",children:[we.jsxs("h3",{className:"text-lg font-semibold",children:["Detail ","sales"===s?"Penjualan":"Data"]}),we.jsx("button",{className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:we.jsx(xe,{className:"w-4 h-4"})})]}),we.jsx("div",{className:"overflow-x-auto",children:we.jsxs("table",{className:"w-full text-sm",children:[we.jsx("thead",{children:we.jsxs("tr",{className:"border-b",children:[we.jsx("th",{className:"text-left py-2",children:"Tanggal"}),we.jsx("th",{className:"text-left py-2",children:"Deskripsi"}),we.jsx("th",{className:"text-right py-2",children:"Jumlah"}),we.jsx("th",{className:"text-right py-2",children:"Total"})]})}),we.jsxs("tbody",{children:[we.jsxs("tr",{className:"border-b",children:[we.jsx("td",{className:"py-2",children:"15 Jan 2024"}),we.jsx("td",{className:"py-2",children:"Penjualan Hijab Premium"}),we.jsx("td",{className:"text-right",children:"5"}),we.jsx("td",{className:"text-right font-medium",children:"Rp 425.000"})]}),we.jsxs("tr",{className:"border-b",children:[we.jsx("td",{className:"py-2",children:"14 Jan 2024"}),we.jsx("td",{className:"py-2",children:"Penjualan Gamis Syari"}),we.jsx("td",{className:"text-right",children:"3"}),we.jsx("td",{className:"text-right font-medium",children:"Rp 495.000"})]})]})]})})]})]})]})},Og=({onBack:e,user:t})=>{const[s,r]=f.useState(""),[n,i]=f.useState("all"),[a,o]=f.useState("all"),l=[{id:"USR001",name:"Siti Nurhaliza",email:"siti@email.com",phone:"08123456789",role:"customer",status:"active",joinDate:"2024-01-10",totalOrders:5,totalSpent:125e4},{id:"USR002",name:"Ahmad Fauzi",email:"ahmad@email.com",phone:"08234567890",role:"reseller",status:"active",joinDate:"2024-01-05",totalOrders:12,totalSpent:24e5,points:450},{id:"USR003",name:"Ratna Dewi",email:"ratna@email.com",phone:"08345678901",role:"customer",status:"active",joinDate:"2024-01-08",totalOrders:3,totalSpent:675e3},{id:"USR004",name:"Budi Santoso",email:"budi@email.com",phone:"08456789012",role:"admin",status:"active",joinDate:"2024-01-01",totalOrders:0,totalSpent:0}],c={owner:{label:"Owner",color:"text-red-600 bg-red-100",icon:Y},admin:{label:"Administrator",color:"text-purple-600 bg-purple-100",icon:Y},reseller:{label:"Reseller",color:"text-blue-600 bg-blue-100",icon:me},customer:{label:"Customer",color:"text-green-600 bg-green-100",icon:ce}},d=l.filter(e=>{const t=e.name.toLowerCase().includes(s.toLowerCase())||e.email.toLowerCase().includes(s.toLowerCase()),r="all"===n||e.role===n,i="all"===a||e.status===a;return t&&r&&i});return we.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[we.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4",children:we.jsxs("div",{className:"flex items-center justify-between",children:[we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx("button",{onClick:e,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:we.jsx(A,{className:"w-5 h-5"})}),we.jsx("h1",{className:"text-xl font-bold",children:"Kelola Pengguna"})]}),we.jsxs("button",{className:"bg-white text-blue-600 px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors flex items-center space-x-2",children:[we.jsx(O,{className:"w-4 h-4"}),we.jsx("span",{children:"Tambah User"})]})]})}),we.jsxs("div",{className:"p-4 space-y-4",children:[we.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[we.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[we.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-1",children:"Total User"}),we.jsx("p",{className:"text-2xl font-bold text-blue-600",children:l.length}),we.jsx("p",{className:"text-xs text-blue-600",children:"Semua role"})]}),we.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[we.jsx("h4",{className:"text-sm font-medium text-green-800 mb-1",children:"User Aktif"}),we.jsx("p",{className:"text-2xl font-bold text-green-600",children:l.filter(e=>"active"===e.status).length}),we.jsxs("p",{className:"text-xs text-green-600",children:[Math.round(l.filter(e=>"active"===e.status).length/l.length*100),"% aktivasi"]})]}),we.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[we.jsx("h4",{className:"text-sm font-medium text-purple-800 mb-1",children:"Reseller"}),we.jsx("p",{className:"text-2xl font-bold text-purple-600",children:l.filter(e=>"reseller"===e.role).length}),we.jsx("p",{className:"text-xs text-purple-600",children:"Partner bisnis"})]}),we.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[we.jsx("h4",{className:"text-sm font-medium text-orange-800 mb-1",children:"User Baru"}),we.jsx("p",{className:"text-2xl font-bold text-orange-600",children:"2"}),we.jsx("p",{className:"text-xs text-orange-600",children:"Bulan ini"})]})]}),we.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:we.jsxs("div",{className:"flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3",children:[we.jsxs("div",{className:"flex-1 relative",children:[we.jsx(I,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),we.jsx("input",{type:"text",placeholder:"Cari user...",value:s,onChange:e=>r(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),we.jsxs("select",{value:n,onChange:e=>i(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[we.jsx("option",{value:"all",children:"Semua Role"}),we.jsx("option",{value:"customer",children:"Customer"}),we.jsx("option",{value:"reseller",children:"Reseller"}),we.jsx("option",{value:"admin",children:"Admin"}),we.jsx("option",{value:"owner",children:"Owner"})]}),we.jsxs("select",{value:a,onChange:e=>o(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[we.jsx("option",{value:"all",children:"Semua Status"}),we.jsx("option",{value:"active",children:"Aktif"}),we.jsx("option",{value:"inactive",children:"Non-aktif"}),we.jsx("option",{value:"banned",children:"Banned"})]}),we.jsx("button",{className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:we.jsx(E,{className:"w-4 h-4"})})]})}),we.jsx("div",{className:"space-y-3",children:d.map(e=>{const s=c[e.role],r=s.icon;return we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[we.jsxs("div",{className:"flex items-center justify-between mb-3",children:[we.jsxs("div",{className:"flex items-center space-x-3",children:[we.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-100 to-purple-100 rounded-full flex items-center justify-center",children:we.jsx(ce,{className:"w-6 h-6 text-blue-600"})}),we.jsxs("div",{children:[we.jsx("p",{className:"font-semibold text-lg",children:e.name}),we.jsx("p",{className:"text-sm text-gray-600",children:e.email}),we.jsxs("p",{className:"text-xs text-gray-500",children:[e.phone," â€¢ Bergabung: ",e.joinDate]})]})]}),we.jsxs("div",{className:"text-right",children:[we.jsxs("div",{className:`inline-flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium ${s.color}`,children:[we.jsx(r,{className:"w-3 h-3"}),we.jsx("span",{children:s.label})]}),we.jsx("div",{className:"mt-1",children:we.jsxs("span",{className:"inline-flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium "+("active"===e.status?"text-green-600 bg-green-100":"text-gray-600 bg-gray-100"),children:[we.jsx("span",{className:"w-2 h-2 bg-current rounded-full"}),we.jsx("span",{children:"active"===e.status?"Aktif":"Non-aktif"})]})})]})]}),we.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-3",children:[we.jsxs("div",{className:"text-center p-2 bg-gray-50 rounded",children:[we.jsx("p",{className:"text-xs text-gray-600",children:"Total Order"}),we.jsx("p",{className:"font-semibold",children:e.totalOrders})]}),we.jsxs("div",{className:"text-center p-2 bg-gray-50 rounded",children:[we.jsx("p",{className:"text-xs text-gray-600",children:"Total Belanja"}),we.jsxs("p",{className:"font-semibold",children:["Rp ",e.totalSpent.toLocaleString("id-ID")]})]}),"reseller"===e.role&&we.jsxs("div",{className:"text-center p-2 bg-blue-50 rounded",children:[we.jsx("p",{className:"text-xs text-blue-600",children:"Poin Reseller"}),we.jsxs("p",{className:"font-semibold text-blue-600",children:[e.points||0," pts"]})]}),we.jsxs("div",{className:"text-center p-2 bg-gray-50 rounded",children:[we.jsx("p",{className:"text-xs text-gray-600",children:"User ID"}),we.jsx("p",{className:"font-semibold text-xs",children:e.id})]})]}),we.jsxs("div",{className:"flex items-center justify-between",children:[we.jsx("div",{className:"text-xs text-gray-500",children:"Terakhir login: 2 hari yang lalu"}),we.jsxs("div",{className:"flex items-center space-x-2",children:[we.jsx("button",{className:"p-1 text-blue-600 hover:text-blue-700 transition-colors",children:we.jsx(J,{className:"w-4 h-4"})}),we.jsx("button",{className:"p-1 text-green-600 hover:text-green-700 transition-colors",children:we.jsx(ge,{className:"w-4 h-4"})}),"owner"===(null==t?void 0:t.role)&&we.jsx("button",{className:"p-1 text-red-600 hover:text-red-700 transition-colors",children:we.jsx(F,{className:"w-4 h-4"})})]})]})]},e.id)})})]})]})},Lg=({user:t,onBack:s})=>{const[r,n]=f.useState("shipping-settings"),[i,a]=f.useState(!1),[o,l]=f.useState(null),[c,h]=f.useState("shipping"),[m,p]=f.useState({auto_check_days:30,auto_check_enabled:!0,next_auto_check:new Date(Date.now()+2592e6).toISOString().split("T")[0],cache_ttl_hours:720,max_cache_age_days:60,auto_cleanup_expired:!0,refresh_all_couriers:!0,notify_on_price_change:!1}),[x,y]=f.useState([]),[b,v]=f.useState(null),[N,w]=f.useState({origin:"",destination:"",weight:1e3,courier:"all"}),j=()=>g(e,null,function*(){try{const e=eg().currentUser;if(e){const t=yield e.getIdToken();return console.log("ðŸ” Firebase auth token obtained for cache management"),t}return console.error("âŒ No Firebase user found"),""}catch(e){return console.error("âŒ Error getting Firebase auth token:",e),""}}),k=()=>g(e,null,function*(){a(!0);try{const e=yield j(),t=yield fetch("/api/admin/cache-settings?action=list",{headers:{Authorization:`Bearer ${e}`}}),s=yield t.json();s.success?(y(s.data.caches),v(s.data.summary),l({type:"success",text:`Found ${s.data.caches.length} cache entries`})):l({type:"error",text:s.message})}catch(e){l({type:"error",text:"Failed to load cache list"})}finally{a(!1)}}),S=t=>g(e,null,function*(){a(!0);try{const e=yield j(),s=yield fetch("/api/admin/cache-settings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({action:"update_settings",settings:t})}),r=yield s.json();if(r.success){const e=r.data.settings||r.data.updated_settings||t;p(t=>d(d({},t),e)),l({type:"success",text:"Cache settings updated successfully"})}else l({type:"error",text:r.message})}catch(e){l({type:"error",text:"Failed to update settings"})}finally{a(!1)}}),_=t=>g(e,null,function*(){if(confirm(`Hapus cache entry: ${t}?`))try{const e=yield j(),s=yield fetch(`/api/admin/cache-settings-temp?action=clear_specific&cache_key=${encodeURIComponent(t)}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`}}),r=yield s.json();r.success?(l({type:"success",text:`Cache entry ${t} deleted`}),k()):l({type:"error",text:r.message})}catch(e){l({type:"error",text:"Failed to delete cache entry"})}});return f.useEffect(()=>{"owner"===(null==t?void 0:t.role)&&g(e,null,function*(){a(!0);try{const e=yield j(),t=yield fetch("/api/admin/cache-settings?action=settings",{headers:{Authorization:`Bearer ${e}`}}),s=yield t.json();s.success?(p(s.data.settings),l({type:"success",text:"Cache settings loaded"})):l({type:"error",text:s.message})}catch(e){l({type:"error",text:"Failed to load cache settings"})}finally{a(!1)}})},[t]),f.useEffect(()=>{"shipping-list"!==r&&"address-list"!==r||"owner"!==(null==t?void 0:t.role)||k()},[r,t]),"owner"!==(null==t?void 0:t.role)?we.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:we.jsx("div",{className:"max-w-4xl mx-auto",children:we.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:[we.jsx("h2",{className:"text-red-800 text-xl font-semibold mb-2",children:"Akses Ditolak"}),we.jsx("p",{className:"text-red-600",children:"Hanya pengguna dengan role 'owner' yang bisa mengakses manajemen cache."}),we.jsx("button",{onClick:s,className:"mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700",children:"Go Back"})]})})}):we.jsx("div",{className:"min-h-screen bg-gray-50 p-4",children:we.jsxs("div",{className:"max-w-6xl mx-auto",children:[we.jsx("div",{className:"bg-white rounded-lg shadow-sm p-6 mb-6",children:we.jsxs("div",{className:"flex justify-between items-center",children:[we.jsxs("div",{children:[we.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ðŸ—„ï¸ Manajemen Cache"}),we.jsx("p",{className:"text-gray-600 mt-1",children:"Kelola pengaturan cache biaya pengiriman dan pantau performa"})]}),we.jsx("button",{onClick:s,className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700",children:"â† Kembali ke Admin"})]})}),o&&we.jsx("div",{className:"mb-6 p-4 rounded-lg "+("success"===o.type?"bg-green-50 text-green-800 border border-green-200":"error"===o.type?"bg-red-50 text-red-800 border border-red-200":"bg-blue-50 text-blue-800 border border-blue-200"),children:o.text}),we.jsx("div",{className:"bg-white rounded-lg shadow-sm mb-4",children:we.jsx("div",{className:"border-b border-gray-200",children:we.jsxs("nav",{className:"flex space-x-1 px-6",children:[we.jsx("button",{onClick:()=>h("shipping"),className:"py-3 px-4 border-b-2 font-medium text-sm rounded-t-lg "+("shipping"===c?"border-purple-500 text-purple-600 bg-purple-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"),children:"ðŸ“¦ Cache Ongkir"}),we.jsx("button",{onClick:()=>h("address"),className:"py-3 px-4 border-b-2 font-medium text-sm rounded-t-lg "+("address"===c?"border-orange-500 text-orange-600 bg-orange-50":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:bg-gray-50"),children:"ðŸ  Cache Alamat"})]})})}),we.jsx("div",{className:"bg-white rounded-lg shadow-sm mb-6",children:we.jsx("div",{className:"border-b border-gray-200",children:we.jsx("nav",{className:"flex space-x-8 px-6",children:"shipping"===c?we.jsxs(we.Fragment,{children:[we.jsx("button",{onClick:()=>n("shipping-settings"),className:"py-4 px-1 border-b-2 font-medium text-sm "+("shipping-settings"===r?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"âš™ï¸ Auto Check"}),we.jsx("button",{onClick:()=>n("shipping-list"),className:"py-4 px-1 border-b-2 font-medium text-sm "+("shipping-list"===r?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"ðŸ“‹ Daftar Cache Ongkir"}),we.jsx("button",{onClick:()=>n("shipping-actions"),className:"py-4 px-1 border-b-2 font-medium text-sm "+("shipping-actions"===r?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"ðŸ”„ Aksi Ongkir"})]}):we.jsxs(we.Fragment,{children:[we.jsx("button",{onClick:()=>n("address-settings"),className:"py-4 px-1 border-b-2 font-medium text-sm "+("address-settings"===r?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"âš™ï¸ Pengaturan Alamat"}),we.jsx("button",{onClick:()=>n("address-list"),className:"py-4 px-1 border-b-2 font-medium text-sm "+("address-list"===r?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"ðŸ“‹ Daftar Cache Alamat"})]})})})}),"shipping-settings"===r&&"shipping"===c&&we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[we.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Pengaturan Cache Otomatis"}),we.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"Sistem akan otomatis mengecek harga ongkir setiap beberapa bulan. Jika harga masih sama, cache akan diperpanjang."}),we.jsxs("div",{className:"max-w-md",children:[we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cek Otomatis Setiap"}),we.jsxs("div",{className:"flex items-center space-x-2",children:[we.jsx("input",{type:"number",min:"1",max:"365",value:m.auto_check_days||30,onChange:e=>p(u(d({},m),{auto_check_days:parseInt(e.target.value)||30})),className:"w-24 px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500 text-center"}),we.jsx("span",{className:"text-sm text-gray-600",children:"hari sekali"})]}),we.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Setiap ",m.auto_check_days||30," hari, sistem otomatis cek harga ongkir untuk semua kurir"]})]}),m.last_auto_check&&we.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded",children:[we.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Status Auto Check"}),we.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[we.jsxs("p",{children:["Terakhir cek: ",new Date(m.last_auto_check).toLocaleDateString("id-ID")]}),m.next_auto_check&&we.jsxs("p",{children:["Cek berikutnya: ",new Date(m.next_auto_check).toLocaleDateString("id-ID")]}),we.jsxs("p",{children:["Status: ",m.auto_check_enabled?"âœ… Aktif":"âŒ Nonaktif"]})]})]})]}),we.jsx("div",{className:"mt-6 flex justify-end",children:we.jsx("button",{onClick:()=>S(m),disabled:i,className:"px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:i?"Menyimpan...":"Simpan Pengaturan"})})]}),"address-settings"===r&&"address"===c&&we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[we.jsx("h2",{className:"text-lg font-semibold mb-6",children:"Pengaturan Cache Alamat"}),we.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cache TTL Provinsi"}),we.jsxs("div",{className:"flex items-center space-x-2",children:[we.jsx("input",{type:"number",min:"24",max:"8760",value:m.address_provinces_ttl_hours||4320,onChange:e=>p(u(d({},m),{address_provinces_ttl_hours:parseInt(e.target.value)})),className:"flex-1 px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"}),we.jsx("span",{className:"text-sm text-gray-600",children:"jam"})]}),we.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Default: 4320 jam (6 bulan) - provinsi jarang berubah"})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cache TTL Kota/Kabupaten"}),we.jsxs("div",{className:"flex items-center space-x-2",children:[we.jsx("input",{type:"number",min:"24",max:"8760",value:m.address_cities_ttl_hours||720,onChange:e=>p(u(d({},m),{address_cities_ttl_hours:parseInt(e.target.value)})),className:"flex-1 px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"}),we.jsx("span",{className:"text-sm text-gray-600",children:"jam"})]}),we.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Default: 720 jam (30 hari)"})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cache TTL Kecamatan"}),we.jsxs("div",{className:"flex items-center space-x-2",children:[we.jsx("input",{type:"number",min:"24",max:"8760",value:m.address_districts_ttl_hours||720,onChange:e=>p(u(d({},m),{address_districts_ttl_hours:parseInt(e.target.value)})),className:"flex-1 px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"}),we.jsx("span",{className:"text-sm text-gray-600",children:"jam"})]}),we.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Default: 720 jam (30 hari)"})]}),we.jsxs("div",{children:[we.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Cache TTL Kelurahan/Desa"}),we.jsxs("div",{className:"flex items-center space-x-2",children:[we.jsx("input",{type:"number",min:"24",max:"8760",value:m.address_subdistricts_ttl_hours||720,onChange:e=>p(u(d({},m),{address_subdistricts_ttl_hours:parseInt(e.target.value)})),className:"flex-1 px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"}),we.jsx("span",{className:"text-sm text-gray-600",children:"jam"})]}),we.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Default: 720 jam (30 hari)"})]}),we.jsx("div",{className:"md:col-span-2 space-y-3",children:we.jsxs("label",{className:"flex items-center space-x-3",children:[we.jsx("input",{type:"checkbox",checked:!1!==m.address_auto_cleanup_expired,onChange:e=>p(u(d({},m),{address_auto_cleanup_expired:e.target.checked})),className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),we.jsx("span",{className:"text-sm text-gray-700",children:"Otomatis Hapus Cache Alamat Kadaluarsa"})]})})]}),we.jsx("div",{className:"mt-6 flex justify-end",children:we.jsx("button",{onClick:()=>S(m),disabled:i,className:"px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:i?"Menyimpan...":"Simpan Pengaturan Alamat"})})]}),"shipping-list"===r&&"shipping"===c&&we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[we.jsxs("div",{className:"flex justify-between items-center mb-6",children:[we.jsx("h2",{className:"text-lg font-semibold",children:"ðŸ“¦ Cache Ongkir"}),we.jsx("button",{onClick:k,disabled:i,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:i?"Memuat...":"ðŸ”„ Refresh"})]}),b&&we.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[we.jsxs("div",{className:"bg-purple-50 p-4 rounded",children:[we.jsx("div",{className:"text-2xl font-bold text-purple-600",children:b.shipping_total||0}),we.jsx("div",{className:"text-sm text-purple-800",children:"Total Ongkir Cache"})]}),we.jsxs("div",{className:"bg-green-50 p-4 rounded",children:[we.jsx("div",{className:"text-2xl font-bold text-green-600",children:(b.shipping_total||0)-(b.shipping_expired||0)}),we.jsx("div",{className:"text-sm text-green-800",children:"Active"})]}),we.jsxs("div",{className:"bg-red-50 p-4 rounded",children:[we.jsx("div",{className:"text-2xl font-bold text-red-600",children:b.shipping_expired||0}),we.jsx("div",{className:"text-sm text-red-800",children:"Expired"})]}),we.jsxs("div",{className:"bg-gray-50 p-4 rounded",children:[we.jsx("div",{className:"text-2xl font-bold text-gray-600",children:b.oldest_cache}),we.jsx("div",{className:"text-sm text-gray-800",children:"Oldest (days)"})]})]}),we.jsxs("div",{className:"overflow-x-auto",children:[we.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[we.jsx("thead",{className:"bg-gray-50",children:we.jsxs("tr",{children:[we.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Route"}),we.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Weight"}),we.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Courier"}),we.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Age"}),we.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),we.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),we.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.filter(e=>"shipping"===e.type).map(e=>{var t;return we.jsxs("tr",{className:e.is_expired?"bg-red-50":"",children:[we.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.origin," â†’ ",e.destination]}),we.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.weight,"g"]}),we.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:(null==(t=e.courier)?void 0:t.toUpperCase())||"N/A"}),we.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.age_days," days"]}),we.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:we.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full "+(e.is_expired?"bg-red-100 text-red-800":"bg-green-100 text-green-800"),children:e.is_expired?"Expired":"Active"})}),we.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:we.jsx("button",{onClick:()=>_(e.cacheKey),className:"text-red-600 hover:text-red-900",children:"Hapus"})})]},e.cacheKey)})})]}),0===x.filter(e=>"shipping"===e.type).length&&we.jsx("div",{className:"text-center py-8 text-gray-500",children:"Tidak ada cache ongkir yang ditemukan"})]})]}),"address-list"===r&&"address"===c&&we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[we.jsxs("div",{className:"flex justify-between items-center mb-6",children:[we.jsx("h2",{className:"text-lg font-semibold",children:"ðŸ  Cache Alamat"}),we.jsx("button",{onClick:k,disabled:i,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:i?"Memuat...":"ðŸ”„ Refresh"})]}),b&&we.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[we.jsxs("div",{className:"bg-orange-50 p-4 rounded",children:[we.jsx("div",{className:"text-2xl font-bold text-orange-600",children:b.address_total||0}),we.jsx("div",{className:"text-sm text-orange-800",children:"Total Address Cache"})]}),we.jsxs("div",{className:"bg-green-50 p-4 rounded",children:[we.jsx("div",{className:"text-2xl font-bold text-green-600",children:(b.address_total||0)-(b.address_expired||0)}),we.jsx("div",{className:"text-sm text-green-800",children:"Active"})]}),we.jsxs("div",{className:"bg-red-50 p-4 rounded",children:[we.jsx("div",{className:"text-2xl font-bold text-red-600",children:b.address_expired||0}),we.jsx("div",{className:"text-sm text-red-800",children:"Expired"})]}),we.jsxs("div",{className:"bg-gray-50 p-4 rounded",children:[we.jsx("div",{className:"text-2xl font-bold text-gray-600",children:b.newest_cache}),we.jsx("div",{className:"text-sm text-gray-800",children:"Newest (days)"})]})]}),we.jsxs("div",{className:"overflow-x-auto",children:[we.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[we.jsx("thead",{className:"bg-gray-50",children:we.jsxs("tr",{children:[we.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cache Key"}),we.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),we.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data Count"}),we.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Age"}),we.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),we.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),we.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:x.filter(e=>"address"===e.type).map(e=>we.jsxs("tr",{className:e.is_expired?"bg-red-50":"",children:[we.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.cacheKey}),we.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:we.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded bg-orange-100 text-orange-800",children:e.data_type})}),we.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.data_count||0," items"]}),we.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.age_days," days"]}),we.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:we.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full "+(e.is_expired?"bg-red-100 text-red-800":"bg-green-100 text-green-800"),children:e.is_expired?"Expired":"Active"})}),we.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:we.jsx("button",{onClick:()=>_(e.cacheKey),className:"text-red-600 hover:text-red-900",children:"Hapus"})})]},e.cacheKey))})]}),0===x.filter(e=>"address"===e.type).length&&we.jsx("div",{className:"text-center py-8 text-gray-500",children:"Tidak ada cache alamat yang ditemukan"})]})]}),"shipping-actions"===r&&"shipping"===c&&we.jsxs("div",{className:"space-y-6",children:[we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[we.jsx("h2",{className:"text-lg font-semibold mb-6",children:"ðŸ”„ Refresh Cache Ongkir"}),we.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Paksa refresh cache ongkir untuk rute dan berat tertentu. Berguna jika ada perubahan harga kurir."}),we.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[we.jsx("input",{type:"text",placeholder:"Origin (city ID)",value:N.origin,onChange:e=>w(u(d({},N),{origin:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"}),we.jsx("input",{type:"text",placeholder:"Destination (city ID)",value:N.destination,onChange:e=>w(u(d({},N),{destination:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"}),we.jsx("input",{type:"number",placeholder:"Weight (grams)",value:N.weight,onChange:e=>w(u(d({},N),{weight:parseInt(e.target.value)})),className:"px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500"}),we.jsxs("select",{value:N.courier,onChange:e=>w(u(d({},N),{courier:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded focus:ring-blue-500 focus:border-blue-500",children:[we.jsx("option",{value:"all",children:"All Couriers"}),we.jsx("option",{value:"jne",children:"JNE"}),we.jsx("option",{value:"jnt",children:"J&T"}),we.jsx("option",{value:"pos",children:"POS"}),we.jsx("option",{value:"tiki",children:"TIKI"}),we.jsx("option",{value:"ide",children:"IDExpress"}),we.jsx("option",{value:"lion",children:"Lion Parcel"})]})]}),we.jsx("button",{onClick:()=>g(e,null,function*(){if(N.origin&&N.destination){a(!0);try{const e=yield j(),t=yield fetch("/api/admin/cache-settings",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(d({action:"refresh_cache"},N))}),s=yield t.json();s.success?(l({type:"success",text:"Cache refresh initiated successfully"}),w({origin:"",destination:"",weight:1e3,courier:"all"}),"shipping-list"!==r&&"address-list"!==r||k()):l({type:"error",text:s.message})}catch(e){l({type:"error",text:"Failed to refresh cache"})}finally{a(!1)}}else l({type:"error",text:"Origin and destination are required"})}),disabled:i,className:"px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:i?"Refreshing...":"ðŸ”„ Refresh Cache Ongkir"})]}),we.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[we.jsx("h2",{className:"text-lg font-semibold mb-6",children:"ðŸ§¹ Cache Cleanup Ongkir"}),we.jsxs("div",{className:"space-y-4",children:[we.jsxs("div",{className:"flex items-center justify-between p-4 bg-yellow-50 border border-yellow-200 rounded",children:[we.jsxs("div",{children:[we.jsx("h3",{className:"font-medium text-yellow-800",children:"Hapus Cache Ongkir Kadaluarsa"}),we.jsx("p",{className:"text-sm text-yellow-600",children:"Hapus cache ongkir yang sudah kadaluarsa"})]}),we.jsx("button",{onClick:()=>g(e,null,function*(){if(confirm("Apakah Anda yakin ingin menghapus semua cache yang kadaluarsa?")){a(!0);try{const e=yield j(),t=yield fetch("/api/admin/cache-settings-temp?action=clear_expired",{method:"DELETE",headers:{Authorization:`Bearer ${e}`}}),s=yield t.json();s.success?(l({type:"success",text:`Cleared ${s.data.deleted} expired cache entries`}),k()):l({type:"error",text:s.message})}catch(e){l({type:"error",text:"Failed to clear expired cache"})}finally{a(!1)}}}),disabled:i,className:"px-4 py-2 bg-yellow-600 text-white rounded hover:bg-yellow-700 disabled:opacity-50",children:"Hapus Kadaluarsa"})]}),we.jsxs("div",{className:"flex items-center justify-between p-4 bg-red-50 border border-red-200 rounded",children:[we.jsxs("div",{children:[we.jsx("h3",{className:"font-medium text-red-800",children:"âš ï¸ Hapus Semua Cache Ongkir"}),we.jsx("p",{className:"text-sm text-red-600",children:"BAHAYA: Hapus SEMUA cache ongkir. Ini akan memaksa panggilan API baru!"})]}),we.jsx("button",{onClick:()=>g(e,null,function*(){if(confirm("âš ï¸ BAHAYA: Ini akan menghapus SEMUA cache dan memaksa panggilan API baru. Lanjutkan?")){a(!0);try{const e=yield j(),t=yield fetch("/api/admin/cache-settings-temp?action=clear_all",{method:"DELETE",headers:{Authorization:`Bearer ${e}`}}),s=yield t.json();s.success?(l({type:"success",text:`Cleared all ${s.data.deleted} cache entries`}),k()):l({type:"error",text:s.message})}catch(e){l({type:"error",text:"Failed to clear all cache"})}finally{a(!1)}}}),disabled:i,className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 disabled:opacity-50",children:"Hapus Semua"})]})]})]})]})]})})},Fg=({currentPage:e,onPageChange:t})=>{const s=[{id:"home",label:"Beranda",icon:pe},{id:"flash-sale",label:"Flash Sale",icon:ee},{id:"orders",label:"Pesanan",icon:z},{id:"account",label:"Pengaturan",icon:_}];return we.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg",children:we.jsx("div",{className:"flex",children:s.map(s=>{const r=s.icon,n=e===s.id;return we.jsxs("button",{onClick:()=>t(s.id),className:"flex-1 flex flex-col items-center py-3 px-2 transition-colors "+(n?"text-pink-600 bg-pink-50":"text-gray-600 hover:text-pink-600 hover:bg-gray-50"),children:[we.jsx(r,{className:"w-6 h-6 mb-1 "+(n?"text-pink-600":"text-gray-600")}),we.jsx("span",{className:"text-xs font-medium "+(n?"text-pink-600":"text-gray-600"),children:s.label})]},s.id)})})})},Mg=({className:e=""})=>we.jsxs("div",{className:`bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg p-8 text-center ${e}`,children:[we.jsx(z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),we.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"Kalkulator Ongkir"}),we.jsx("p",{className:"text-gray-500 text-sm",children:"Fitur kalkulator ongkir sedang dalam perbaikan. Silakan gunakan fitur checkout untuk menghitung ongkir otomatis."})]}),Ug=({onBack:e})=>{const[t,s]=f.useState(null);return we.jsxs("div",{className:"min-h-screen bg-gray-50",children:[we.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200",children:we.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4",children:we.jsxs("div",{className:"flex items-center",children:[we.jsx("button",{onClick:e,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors duration-200 mr-3",children:we.jsx(A,{className:"w-5 h-5"})}),we.jsxs("div",{className:"flex items-center",children:[we.jsx(ve,{className:"w-6 h-6 text-blue-500 mr-3"}),we.jsx("h1",{className:"text-xl font-bold text-gray-800",children:"Cek Ongkos Kirim"})]})]})})}),we.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-6",children:[we.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[we.jsx("div",{className:"lg:col-span-2",children:we.jsx(Mg,{originCityId:"152",weight:1e3,onCostSelected:(e,t,r,n)=>{s({courier:e,service:t,cost:r,etd:n})}})}),we.jsx("div",{className:"lg:col-span-1",children:we.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 sticky top-6",children:[we.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center",children:[we.jsx(z,{className:"w-5 h-5 mr-2"}),"Info Pengiriman"]}),t?we.jsxs("div",{className:"space-y-4",children:[we.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[we.jsx("p",{className:"text-sm font-medium text-green-800 mb-2",children:"âœ… Pengiriman Terpilih"}),we.jsxs("div",{className:"space-y-2",children:[we.jsxs("div",{children:[we.jsx("p",{className:"text-sm text-gray-600",children:"Kurir"}),we.jsx("p",{className:"font-medium text-gray-800",children:(r=t.courier,{jne:"JNE",tiki:"TIKI",pos:"POS Indonesia",jnt:"J&T Express",sicepat:"SiCepat",wahana:"Wahana",anteraja:"AnterAja"}[r]||r.toUpperCase())})]}),we.jsxs("div",{children:[we.jsx("p",{className:"text-sm text-gray-600",children:"Layanan"}),we.jsx("p",{className:"font-medium text-gray-800",children:t.service})]}),we.jsxs("div",{children:[we.jsx("p",{className:"text-sm text-gray-600",children:"Estimasi"}),we.jsx("p",{className:"font-medium text-gray-800",children:t.etd})]}),we.jsxs("div",{children:[we.jsx("p",{className:"text-sm text-gray-600",children:"Biaya"}),we.jsxs("p",{className:"font-bold text-lg text-green-600",children:["Rp ",t.cost.toLocaleString("id-ID")]})]})]})]}),we.jsx("button",{className:"w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-4 rounded-lg transition-colors duration-200",children:"Lanjut ke Pembayaran"})]}):we.jsxs("div",{className:"text-center py-8",children:[we.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:we.jsx(z,{className:"w-8 h-8 text-gray-400"})}),we.jsx("p",{className:"text-gray-500 text-sm mb-4",children:"Belum ada metode pengiriman yang dipilih"}),we.jsx("p",{className:"text-gray-400 text-xs",children:"Pilih kurir dan layanan di form sebelah kiri"})]}),we.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[we.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"Informasi Tambahan"}),we.jsxs("div",{className:"space-y-2 text-xs text-gray-500",children:[we.jsxs("div",{className:"flex items-start",children:[we.jsx("span",{className:"mr-2",children:"â€¢"}),we.jsx("span",{children:"Estimasi waktu pengiriman dapat berubah tergantung kondisi"})]}),we.jsxs("div",{className:"flex items-start",children:[we.jsx("span",{className:"mr-2",children:"â€¢"}),we.jsx("span",{children:"Biaya yang tertera adalah estimasi dan belum termasuk asuransi"})]}),we.jsxs("div",{className:"flex items-start",children:[we.jsx("span",{className:"mr-2",children:"â€¢"}),we.jsx("span",{children:"Proses pengiriman akan dilakukan pada hari kerja"})]})]})]})]})})]}),we.jsxs("div",{className:"mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6",children:[we.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-4",children:"Cara Penggunaan"}),we.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[we.jsxs("div",{className:"text-center",children:[we.jsx("div",{className:"w-12 h-12 bg-blue-500 text-white rounded-full flex items-center justify-center mx-auto mb-2 font-bold",children:"1"}),we.jsx("p",{className:"text-sm text-blue-700",children:"Pilih provinsi tujuan"})]}),we.jsxs("div",{className:"text-center",children:[we.jsx("div",{className:"w-12 h-12 bg-blue-500 text-white rounded-full flex items-center justify-center mx-auto mb-2 font-bold",children:"2"}),we.jsx("p",{className:"text-sm text-blue-700",children:"Pilih kota/kabupaten"})]}),we.jsxs("div",{className:"text-center",children:[we.jsx("div",{className:"w-12 h-12 bg-blue-500 text-white rounded-full flex items-center justify-center mx-auto mb-2 font-bold",children:"3"}),we.jsx("p",{className:"text-sm text-blue-700",children:"Pilih kurir"})]}),we.jsxs("div",{className:"text-center",children:[we.jsx("div",{className:"w-12 h-12 bg-blue-500 text-white rounded-full flex items-center justify-center mx-auto mb-2 font-bold",children:"4"}),we.jsx("p",{className:"text-sm text-blue-700",children:'Klik "Cek Ongkir"'})]})]})]})]})]});var r};function Vg(){const[e,t]=f.useState("home"),[s,r]=f.useState(null),[n,i]=f.useState(!1),[a,o]=f.useState(!1),{user:l,logout:c}=vg(),{products:h,loading:m,updateProductStock:p}=Tg(),{addOrder:x}=(()=>{const e=f.useContext(Se);if(void 0===e)throw new Error("useAdmin must be used within an AdminProvider");return e})();f.useEffect(()=>{console.log("ðŸš€ App initializing... Checking localStorage"),ke.initializeApp(),ke.validateAndSyncFeaturedProducts(),console.log("ðŸš€ App initialized with featured products validation"),"/ongkir-test"===window.location.pathname&&t("ongkir-test")},[]);const y=e=>{r(e),t("product-detail")},b=()=>{i(!0)},v=e=>{i(!1),console.log("âœ… Firebase user logged in:",e.name,e.role)},N=()=>{console.log("ðŸ”ƒ User logging out from Firebase"),c(),t("home"),dg.clearCart().catch(e=>{console.error("âŒ Error clearing cart on logout:",e)}),localStorage.removeItem("azzahra_cart"),console.log("âœ… Firebase logout successful"),console.log("ðŸ“¦ Cart cleared from cartService and localStorage")},w=(e,t,s)=>g(this,null,function*(){var r;if(!(null==l?void 0:l.uid))return console.log("âŒ Cannot add to cart: User not logged in"),void b();try{const n="reseller"===(null==l?void 0:l.role)?e.resellerPrice:e.retailPrice;yield dg.addToCart({productId:e.id,name:e.name,price:n,image:(null==(r=e.images)?void 0:r[0])||"",variant:t,quantity:s}),console.log("âœ… Product added to cart:",e.name,"Price:",n),alert("Produk berhasil ditambahkan ke keranjang!")}catch(n){console.error("âŒ Failed to add to cart:",n),alert("Gagal menambahkan produk ke keranjang")}}),j=e=>g(this,null,function*(){if(!(null==l?void 0:l.uid))return void b();const t={size:e.variants.sizes[0],color:e.variants.colors[0]};yield w(e,t,1)}),k=(e,s,r)=>g(this,null,function*(){(null==l?void 0:l.uid)?(yield w(e,s,r),setTimeout(()=>{t("checkout")},500)):b()}),S=e=>g(this,null,function*(){if(!(null==l?void 0:l.uid))return console.error("âŒ Cannot complete order: User not logged in"),null;const t="AZF"+Date.now().toString().slice(-8);try{const r=yield dg.getCart(),n=r.reduce((e,t)=>e+(t.price||0)*(t.quantity||1),0),i=e.shippingCost||0,a=n+i;x({id:t,userId:l.uid,userName:l.displayName||"User",userEmail:l.email||"user@example.com",items:r.map(e=>({productId:e.productId,productName:e.name||"Product",selectedVariant:e.variant||{size:"",color:""},quantity:e.quantity,price:e.price||0,total:(e.price||0)*e.quantity})),shippingInfo:e.shippingInfo,paymentMethod:e.paymentMethod,status:"pending",totalAmount:n,shippingCost:i,finalTotal:a,notes:e.notes}),r.forEach(e=>{p(e.productId,e.quantity)}),yield dg.clearCart();const o={items:r.map(e=>({productId:e.productId,productName:e.name||"Product",selectedVariant:e.variant||{size:"",color:""},quantity:e.quantity,price:e.price||0,total:(e.price||0)*e.quantity})),shippingInfo:e.shippingInfo,paymentMethod:e.paymentMethod,status:"pending",totalAmount:n,shippingCost:i,finalTotal:a,notes:e.notes||"",userName:l.displayName||"User",userEmail:l.email||"user@example.com",userId:l.uid,timestamp:Date.now()};try{yield kg.createOrder(o),console.log("ðŸ”¥ Order saved to Firebase via OrdersService:",t),ke.saveOrder(u(d({},o),{createdAt:(new Date).toISOString(),timestamp:Date.now()})),console.log("ðŸ’¾ Order saved to AppStorage as backup:",t)}catch(s){console.error("âŒ Error saving order via OrdersService:",s),ke.saveOrder(u(d({},o),{createdAt:(new Date).toISOString(),timestamp:Date.now()})),console.log("ðŸ’¾ Order saved to AppStorage (fallback):",t)}return console.log("âœ… Order completed and cart cleared:",t),t}catch(r){return console.error("âŒ Error completing order:",r),null}}),_=()=>{t("cart")},I=()=>{t("checkout")},C=()=>{t("flash-sale")},E=()=>{t("ongkir-test")},T=()=>{t("admin-products")},A=()=>{t("admin-orders")},P=()=>{t("admin-reports")},D=()=>{t("admin-users")},R=()=>{t("admin-cache")};return we.jsx(Ie,{children:we.jsxs("div",{className:"min-h-screen bg-gray-50",children:[(()=>{if(n)return we.jsx(Ng,{onSuccess:v,onClose:()=>i(!1)});switch(e){case"home":return we.jsx(ug,{user:l,products:h,loading:m,onProductClick:y,onLoginRequired:b,onCartClick:_,onAddToCart:j,onNavigateToFlashSale:C,onNavigateToOngkirTest:E});case"flash-sale":return we.jsx(jg,{user:l,products:h,loading:m,onProductClick:y,onLoginRequired:b,onCartClick:_,onAddToCart:j});case"orders":return we.jsx(Sg,{user:l});case"account":return console.log("App: Rendering AccountPage with user:",l),we.jsx(_g,{user:l,onLogout:N,onNavigateToAdminProducts:T,onNavigateToAdminOrders:A,onNavigateToAdminReports:P,onNavigateToAdminUsers:D,onNavigateToAdminCache:R,onNavigateToAddressManagement:()=>t("address-management")});case"address-management":return console.log("App: Rendering AddressManagementPage with user:",l),we.jsx(Ig,{user:l,onBack:()=>t("account")});case"admin-products":return console.log("App: Rendering AdminProductsPage with user:",l),we.jsx(Pg,{onBack:()=>t("account"),user:l});case"admin-orders":return console.log("App: Rendering AdminOrdersPage with user:",l),we.jsx(Dg,{onBack:()=>t("account"),user:l});case"admin-reports":return console.log("App: Rendering AdminReportsPage with user:",l),we.jsx(Rg,{onBack:()=>t("account"),user:l});case"admin-users":return console.log("App: Rendering AdminUsersPage with user:",l),we.jsx(Og,{onBack:()=>t("account"),user:l});case"admin-cache":return console.log("App: Rendering AdminCacheManagement with user:",l),we.jsx(Lg,{onBack:()=>t("account"),user:l});case"ongkir-test":return we.jsx(Ug,{onBack:()=>t("home")});case"product-detail":return we.jsx(hg,{product:s,user:l,onBack:()=>t("home"),onLoginRequired:b,onAddToCart:w,onBuyNow:k,onNavigateToCart:()=>t("cart")});case"cart":return we.jsx(pg,{user:l,onBack:()=>t("home"),onCheckout:I});case"checkout":return we.jsx(bg,{user:l,clearCart:S,onBack:()=>t("cart")});default:return we.jsx(ug,{user:l,products:h,loading:m,onProductClick:y,onLoginRequired:b,onCartClick:_,onAddToCart:j,onNavigateToFlashSale:C})}})(),!n&&!e.startsWith("admin-")&&we.jsx(Fg,{currentPage:e,onPageChange:t}),n&&we.jsx(Ng,{onSuccess:v,onClose:()=>i(!1),onShowRegister:()=>{i(!1),o(!0)}}),a&&we.jsx(wg,{onSuccess:e=>{o(!1),console.log("âœ… Firebase user registered:",e.name,e.role)},onClose:()=>o(!1)})]})})}function Bg(){return we.jsx(_e,{children:we.jsx(Vg,{})})}Ne(document.getElementById("root")).render(we.jsx(f.StrictMode,{children:we.jsx(Bg,{})}))}},function(){return we||(0,Ne[r(Ne)[0]])((we={exports:{}}).exports,we),we.exports});export default je();
