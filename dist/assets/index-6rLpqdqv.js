var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertyNames,a=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,l=(t,s,r)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r,o=(e,t)=>{for(var s in t||(t={}))n.call(t,s)&&l(e,s,t[s]);if(a)for(var s of a(t))i.call(t,s)&&l(e,s,t[s]);return e},c=(e,r)=>t(e,s(r)),d=(e,t,s)=>new Promise((r,a)=>{var n=e=>{try{l(s.next(e))}catch(t){a(t)}},i=e=>{try{l(s.throw(e))}catch(t){a(t)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(n,i);l((s=s.apply(e,t)).next())});import{r as u,a as h,R as m,g as p,c as g}from"./vendor-DBR9_dkd.js";import{S as x,a as f,C as b,M as y,T as v,b as j,c as w,U as N,d as k,F as S,A as _,e as P,f as E,H as C,g as T,P as O,h as A,i as R,j as I,k as D,l as $,m as L,n as U,X as F,o as B,Z as z,p as M,q as K,r as q,s as J,t as W,u as H,v as V,L as G,w as Y,x as X,B as Q,y as Z,z as ee,K as te,E as se,D as re,G as ae,I as ne,R as ie,J as le,N as oe,O as ce,Q as de,V as ue,W as he,Y as me,_ as pe}from"./ui-CmEyt1c7.js";var ge,xe,fe=(ge={"assets/index-6rLpqdqv.js"(e){!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var t={exports:{}},s={},r=u,a=Symbol.for("react.element"),n=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,ge=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,xe={key:!0,ref:!0,__self:!0,__source:!0};function fe(e,t,s){var r,n={},l=null,o=null;for(r in void 0!==s&&(l=""+s),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(o=t.ref),t)i.call(t,r)&&!xe.hasOwnProperty(r)&&(n[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===n[r]&&(n[r]=t[r]);return{$$typeof:a,type:e,key:l,ref:o,props:n,_owner:ge.current}}s.Fragment=n,s.jsx=fe,s.jsxs=fe,t.exports=s;var be,ye,ve=t.exports,je=h;be=je.createRoot,je.hydrateRoot;class we{static initializeApp(){console.log("ðŸš€ Initializing Azzahra Fashion Muslim App..."),localStorage.getItem(this.KEYS.PRODUCTS)||this.initializeProducts(),localStorage.getItem(this.KEYS.USERS)||this.initializeUsers(),localStorage.getItem(this.KEYS.ORDERS)||this.initializeOrders(),localStorage.getItem(this.KEYS.CART)||localStorage.setItem(this.KEYS.CART,JSON.stringify([])),console.log("âœ… App initialized successfully!")}static initializeProducts(){const e=[{id:"1",name:"Hijab Segi Empat Premium",description:"Hijab segi empat berbahan premium dengan kualitas terbaik. Nyaman dipakai sehari-hari.",category:"hijab",images:["https://images.pexels.com/photos/3184291/pexels-photo-3184291.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["Regular"],colors:["Navy","Maroon","Black","Cream","Pink","Mint","Gray"]},retailPrice:85e3,resellerPrice:7e4,costPrice:55e3,stock:50,status:"ready",salesCount:15,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"2",name:"Gamis Syari Elegant",description:"Gamis syari dengan desain elegant dan bahan adem. Cocok untuk acara formal maupun casual.",category:"gamis",images:["https://images.pexels.com/photos/3184338/pexels-photo-3184338.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["S","M","L","XL","XXL"],colors:["Black","Navy","Maroon","Army","Dusty"]},retailPrice:285e3,resellerPrice:25e4,costPrice:2e5,stock:25,status:"ready",salesCount:8,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"3",name:"Khimar Instant Modern",description:"Khimar instant dengan pad antem dan material berkualitas. Praktis dan syari.",category:"khimar",images:["https://images.pexels.com/photos/3184461/pexels-photo-3184461.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["Regular","Jumbo"],colors:["Black","White","Cream","Silver","Pink"]},retailPrice:95e3,resellerPrice:8e4,costPrice:65e3,stock:40,status:"ready",salesCount:12,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"4",name:"Tunik Kasual Modern",description:"Tunik dengan desain modern yang cocok untuk OOTD harian. Nyaman dan stylish.",category:"tunik",images:["https://images.pexels.com/photos/3184315/pexels-photo-3184315.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["S","M","L","XL"],colors:["Blue","Pink","White","Black","Mustard"]},retailPrice:165e3,resellerPrice:14e4,costPrice:11e4,stock:30,status:"ready",salesCount:6,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"5",name:"Setelan Celana Kulot",description:"Setelan atasan dengan celana kulot yang nyaman. Modern dan syari.",category:"setelan",images:["https://images.pexels.com/photos/3184339/pexels-photo-3184339.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["S","M","L","XL"],colors:["Army","Navy","Maroon","Gray","Beige"]},retailPrice:225e3,resellerPrice:19e4,costPrice:15e4,stock:20,status:"ready",salesCount:4,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"6",name:"Rok Plisket Premium",description:"Rok plisket dengan bahan premium yang jatuh dan nyaman. Elegan dan modis.",category:"rok",images:["https://images.pexels.com/photos/3184340/pexels-photo-3184340.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["S","M","L","XL"],colors:["Black","Navy","Maroon","Gray","Cream"]},retailPrice:145e3,resellerPrice:12e4,costPrice:95e3,stock:35,status:"ready",salesCount:9,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"7",name:"Blouse Kekinian",description:"Blouse dengan desain kekinian yang nyaman dipakai sehari-hari.",category:"atasan",images:["https://images.pexels.com/photos/3184359/pexels-photo-3184359.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["S","M","L","XL"],colors:["Pink","Blue","White","Yellow","Green"]},retailPrice:125e3,resellerPrice:105e3,costPrice:85e3,stock:28,status:"ready",salesCount:7,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0},{id:"8",name:"Abaya Simple Elegant",description:"Abaya dengan desain simple namun elegant. Cocok untuk acara formal.",category:"abaya",images:["https://images.pexels.com/photos/3184365/pexels-photo-3184365.jpeg?auto=compress&cs=tinysrgb&w=400"],variants:{sizes:["S","M","L","XL"],colors:["Black","Navy","Gray","Maroon"]},retailPrice:325e3,resellerPrice:28e4,costPrice:22e4,stock:15,status:"ready",salesCount:3,isFeatured:!1,featuredOrder:0,createdAt:new Date,isFlashSale:!1,flashSalePrice:0}];this.saveData(this.KEYS.PRODUCTS,e),console.log("ðŸ“¦ Products initialized:",e.length)}static initializeUsers(){const e=[{id:"1",name:"Customer",email:"customer@azzahra.com",phone:"08123456789",role:"customer",createdAt:new Date},{id:"2",name:"Admin",email:"admin@azzahra.com",phone:"08123456780",role:"admin",createdAt:new Date},{id:"3",name:"Owner",email:"owner@azzahra.com",phone:"08123456781",role:"owner",createdAt:new Date}];this.saveData(this.KEYS.USERS,e),console.log("ðŸ‘¥ Users initialized:",e.length)}static initializeOrders(){this.saveData(this.KEYS.ORDERS,[]),console.log("ðŸ“‹ Orders initialized: 0")}static saveData(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(s){console.error(`âŒ Error saving data to ${e}:`,s)}}static loadData(e){try{const t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(t){return console.error(`âŒ Error loading data from ${e}:`,t),null}}static getProducts(){return(this.loadData(this.KEYS.PRODUCTS)||[]).map(e=>c(o({},e),{createdAt:new Date(e.createdAt)}))}static saveProducts(e){this.saveData(this.KEYS.PRODUCTS,e)}static getFeaturedProducts(){try{const e=this.getProducts().filter(e=>!0===e.isFeatured).sort((e,t)=>(e.featuredOrder||0)-(t.featuredOrder||0));return console.log(`ðŸŒŸ AppStorage: Found ${e.length} featured products`),e.forEach((e,t)=>{console.log(`  ${t+1}. ${e.name} (Order: ${e.featuredOrder})`)}),e}catch(e){return console.error("ðŸš¨ AppStorage: Error getting featured products:",e),[]}}static reorderFeatured(e,t){const s=this.getProducts(),r=s.filter(e=>e.isFeatured).sort((e,t)=>(e.featuredOrder||0)-(t.featuredOrder||0)),a=r.findIndex(t=>t.id===e);if(-1===a)return s;const n="up"===t?a-1:a+1;if(n<0||n>=r.length)return s;const[i]=r.splice(a,1);r.splice(n,0,i);const l=s.map(e=>{const t=r.findIndex(t=>t.id===e.id);return-1!==t?c(o({},e),{featuredOrder:t+1}):e});return this.saveProducts(l),l}static toggleFeatured(e){const t=this.getProducts(),s=t.find(t=>t.id===e);if(!s)return t;let r;if(s.isFeatured)r=t.map(t=>t.id===e?c(o({},t),{isFeatured:!1,featuredOrder:0}):t.isFeatured&&t.featuredOrder>s.featuredOrder?c(o({},t),{featuredOrder:t.featuredOrder-1}):t);else{const s=t.filter(e=>e.isFeatured);if(s.length>=4)return alert("Maksimal 4 produk unggulan!"),t;r=t.map(t=>t.id===e?c(o({},t),{isFeatured:!0,featuredOrder:s.length+1}):t)}return this.saveProducts(r),"undefined"!=typeof window&&window.dispatchEvent(new CustomEvent("featuredProductsUpdated",{detail:{action:s.isFeatured?"removed":"added",productId:e,featuredProducts:r.filter(e=>e.isFeatured)}})),r}static validateAndSyncFeaturedProducts(){try{const e=this.getProducts(),t=e.filter(e=>e.isFeatured).sort((e,t)=>(e.featuredOrder||0)-(t.featuredOrder||0)),s=e.map(e=>{const s=t.findIndex(t=>t.id===e.id);return-1!==s?c(o({},e),{featuredOrder:s+1}):e});return JSON.stringify(e)!==JSON.stringify(s)&&(this.saveProducts(s),console.log("ðŸ”§ AppStorage: Fixed featured products order consistency")),s}catch(e){return console.error("ðŸš¨ AppStorage: Error validating featured products:",e),this.getProducts()}}static refreshFeaturedProductsCache(){this.getFeaturedProducts(),"undefined"!=typeof window&&window.dispatchEvent(new CustomEvent("featuredProductsRefreshed",{detail:{timestamp:(new Date).toISOString()}}))}static getOrders(){return(this.loadData(this.KEYS.ORDERS)||[]).map(e=>c(o({},e),{createdAt:new Date(e.createdAt),updatedAt:new Date(e.updatedAt)}))}static saveOrder(e){const t=this.getOrders();t.push(e),this.saveData(this.KEYS.ORDERS,t),console.log("ðŸ’¾ Order saved:",e.id)}static updateOrderStatus(e,t){const s=this.getOrders().map(s=>s.id===e?c(o({},s),{status:t,updatedAt:new Date}):s);this.saveData(this.KEYS.ORDERS,s),console.log("ðŸ“‹ Order status updated:",e,"â†’",t)}static getUsers(){return(this.loadData(this.KEYS.USERS)||[]).map(e=>c(o({},e),{createdAt:new Date(e.createdAt)}))}static saveUser(e){const t=this.getUsers(),s=t.findIndex(t=>t.id===e.id);s>=0?t[s]=e:t.push(e),this.saveData(this.KEYS.USERS,t)}static getCart(){return this.loadData(this.KEYS.CART)||[]}static saveCart(e){this.saveData(this.KEYS.CART,e)}static exportAllData(){const e={products:this.getProducts(),orders:this.getOrders(),users:this.getUsers(),cart:this.getCart(),exportedAt:(new Date).toISOString()};return JSON.stringify(e,null,2)}static importAllData(e){try{const t=JSON.parse(e);return t.products&&this.saveData(this.KEYS.PRODUCTS,t.products),t.orders&&this.saveData(this.KEYS.ORDERS,t.orders),t.users&&this.saveData(this.KEYS.USERS,t.users),t.cart&&this.saveData(this.KEYS.CART,t.cart),console.log("ðŸ“¥ Data imported successfully"),!0}catch(t){return console.error("âŒ Error importing data:",t),!1}}static clearAllData(){Object.values(this.KEYS).forEach(e=>{localStorage.removeItem(e)}),console.log("ðŸ—‘ï¸ All data cleared"),this.initializeApp()}static getStorageInfo(){const e={};return Object.entries(this.KEYS).forEach(([t,s])=>{const r=localStorage.getItem(s);e[t]={size:r?r.length:0,items:r?JSON.parse(r).length:0}}),e}}l(we,"symbol"!=typeof(ye="KEYS")?ye+"":ye,{PRODUCTS:"azzahra_products",ORDERS:"azzahra_orders",USERS:"azzahra_users",CART:"azzahra_cart",FLASH_SALES:"azzahra_flash_sales",APP_STATE:"azzahra_app_state"}),"undefined"!=typeof window&&(window.AppStorage=we);const Ne=u.createContext(void 0),ke=({children:e})=>{const[t,s]=u.useState([]),[r,a]=u.useState([]);return u.useEffect(()=>{const e=we.getOrders();s(e),console.log("ðŸ“‹ Orders loaded from AppStorage:",e.length)},[]),u.useEffect(()=>{const e=()=>{const e=we.getOrders();s(e),console.log("ðŸ“‹ Orders updated:",e.length)};return window.addEventListener("orderUpdated",e),()=>window.removeEventListener("orderUpdated",e)},[]),ve.jsx(Ne.Provider,{value:{orders:t,flashSales:r,addOrder:e=>{const t=c(o({},e),{createdAt:new Date,updatedAt:new Date});we.saveOrder(t),s(e=>[t,...e]),console.log("ðŸ’¾ Order saved permanently:",t.id),window.dispatchEvent(new CustomEvent("orderUpdated",{detail:t}))},updateOrderStatus:(e,t)=>{we.updateOrderStatus(e,t),s(s=>s.map(s=>s.id===e?c(o({},s),{status:t,updatedAt:new Date}):s)),console.log("ðŸ“‹ Order status updated:",e,"â†’",t),window.dispatchEvent(new CustomEvent("orderUpdated",{detail:{orderId:e,status:t}}))},updateOrderPayment:(e,r,a="pending")=>{const n=t.map(t=>t.id===e?c(o({},t),{paymentProof:r,paymentProofUrl:"https://images.pexels.com/photos/4386321/pexels-photo-4386321.jpeg?auto=compress&cs=tinysrgb&w=400",status:a,updatedAt:new Date}):t);localStorage.setItem("azzahra_orders",JSON.stringify(n)),s(n),console.log("ðŸ’³ Order payment updated:",e),window.dispatchEvent(new CustomEvent("orderUpdated",{detail:{orderId:e,paymentProof:r,status:a}}))},deleteOrder:e=>{const r=t.filter(t=>t.id!==e);localStorage.setItem("azzahra_orders",JSON.stringify(r)),s(r),console.log("ðŸ—‘ï¸ Order deleted permanently:",e),window.dispatchEvent(new CustomEvent("orderUpdated",{detail:{orderId:e,deleted:!0}}))},getOrdersByStatus:e=>t.filter(t=>t.status===e),getTotalRevenue:()=>t.filter(e=>"delivered"===e.status).reduce((e,t)=>e+t.finalTotal,0),getTodayOrders:()=>{const e=new Date;return e.setHours(0,0,0,0),t.filter(t=>t.createdAt>=e)},createFlashSale:e=>{const t=c(o({},e),{id:"FS"+Date.now().toString(),createdAt:new Date});console.log("Creating flash sale:",t),console.log("Flash sale products:",e.productIds),console.log("Discount:",e.discountType,e.discountValue),a(e=>{const s=[t,...e];return console.log("Updated flash sales:",s),s}),setTimeout(()=>{console.log("Dispatching flashSaleCreated event");const e=new CustomEvent("flashSaleCreated",{detail:t,bubbles:!0});window.dispatchEvent(e),console.log("Event dispatched")},100)},updateFlashSale:(e,t)=>{a(s=>s.map(s=>s.id===e?o(o({},s),t):s)),console.log("Updating flash sale:",e,t);const s=r.find(t=>t.id===e);s&&window.dispatchEvent(new CustomEvent("flashSaleUpdated",{detail:o(o({},s),t)}))},deleteFlashSale:e=>{const t=r.find(t=>t.id===e);t&&(console.log("Deleting flash sale:",t),window.dispatchEvent(new CustomEvent("flashSaleDeleted",{detail:t}))),a(t=>t.filter(t=>t.id!==e))},getActiveFlashSales:()=>{const e=new Date;return r.filter(t=>t.isActive&&t.startDate<=e&&t.endDate>=e)}},children:e})},Se=()=>{const e=u.useContext(Ne);if(void 0===e)throw new Error("useAdmin must be used within an AdminProvider");return e};class _e extends m.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e,t)}render(){return this.state.hasError?this.props.fallback||ve.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:ve.jsxs("div",{className:"text-center",children:[ve.jsx("div",{className:"text-red-500 mb-4",children:ve.jsx("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:ve.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),ve.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Terjadi Kesalahan"}),ve.jsx("p",{className:"text-gray-600 mb-4",children:"Mohon muat ulang halaman atau coba lagi nanti."}),ve.jsx("button",{onClick:()=>window.location.reload(),className:"bg-pink-500 text-white px-6 py-2 rounded-lg hover:bg-pink-600 transition-colors",children:"Muat Ulang"})]})}):this.props.children}}const Pe=({product:e,onProductClick:t,onAddToCart:s,isFlashSale:r=!1,isFeatured:a=!1,user:n})=>{const[i,l]=u.useState(!1),[o,c]=u.useState(e.isFlashSale);u.useEffect(()=>{const t=()=>{const t=localStorage.getItem("azzahra-flashsale");if(t)try{const s=JSON.parse(t),r=(new Date).getTime(),a=new Date(s.endTime).getTime(),n=e.isFlashSale&&s.isActive&&r<a;c(n)}catch(s){console.error("Error checking flash sale status:",s),c(!1)}else c(!1)};t();const s=setInterval(t,2e3),r=()=>{console.log("ðŸ”¥ ProductCard received flash sale ended event"),c(!1)};return window.addEventListener("flashSaleEnded",r),()=>{clearInterval(s),window.removeEventListener("flashSaleEnded",r)}},[e.isFlashSale]);const d=e=>{e.stopPropagation(),"reseller"!==(null==n?void 0:n.role)&&l(!i)},h=t=>{t.stopPropagation();const s=encodeURIComponent(`Halo Admin, saya tertarik dengan produk ${e.name} dan ingin menanyakan tentang harga reseller. Mohon info lebih lanjut. Terima kasih.`);window.open(`https://wa.me/6287815990944?text=${s}`,"_blank"),l(!1)};return ve.jsxs("div",{onClick:()=>t(e),className:"bg-white rounded-lg shadow-md hover:shadow-lg transition-all duration-300 cursor-pointer group overflow-hidden "+(a?"ring-2 ring-yellow-400 shadow-lg":""),children:[ve.jsxs("div",{className:"relative",children:[ve.jsx("img",{src:e.images[0],alt:e.name,className:"w-full h-48 object-cover group-hover:scale-105 transition-transform duration-300"}),(()=>{const t="ready"===e.status?`Ready (${e.stock})`:`PO (${e.stock})`;return ve.jsx("div",{className:"absolute top-2 left-2 text-xs px-2 py-1 rounded font-medium "+("ready"===e.status?"bg-green-500 text-white":"bg-orange-500 text-white"),children:t})})(),a&&ve.jsx("div",{className:"absolute top-2 right-2 bg-yellow-400 text-white p-1.5 rounded-full shadow-lg",children:ve.jsx(x,{className:"w-4 h-4 fill-current"})}),ve.jsx("div",{className:"absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:ve.jsx("button",{onClick:t=>{t.stopPropagation(),s(e)},className:"bg-pink-500 text-white p-2 rounded-full hover:bg-pink-600 transition-colors shadow-lg",children:ve.jsx(f,{className:"w-4 h-4"})})})]}),ve.jsxs("div",{className:"p-4",children:[ve.jsx("h3",{className:"font-semibold text-gray-800 mb-2 line-clamp-2 group-hover:text-pink-600 transition-colors",children:e.name}),ve.jsx("p",{className:"text-sm text-gray-600 mb-3 line-clamp-2",children:e.description}),o&&e.flashSalePrice>0?ve.jsxs("div",{className:"space-y-1",children:[ve.jsxs("div",{className:"flex items-center space-x-2",children:[ve.jsxs("span",{className:"text-lg font-bold text-red-600",children:["Rp ",e.flashSalePrice.toLocaleString("id-ID")]}),ve.jsxs("span",{className:"bg-red-100 text-red-600 text-xs px-2 py-1 rounded",children:["-",Math.round(100*(1-e.flashSalePrice/(e.originalRetailPrice||e.retailPrice))),"%"]})]}),ve.jsxs("div",{className:"text-sm text-gray-500 line-through",children:["Rp ",(e.originalRetailPrice||e.retailPrice).toLocaleString("id-ID")]})]}):ve.jsxs("div",{className:"space-y-1 relative",children:[ve.jsxs("div",{className:"text-lg font-bold text-pink-600",children:["Rp ",e.retailPrice.toLocaleString("id-ID")]}),ve.jsxs("div",{className:"relative",children:["reseller"===(null==n?void 0:n.role)?ve.jsxs("div",{className:"text-sm text-pink-600",children:["Reseller: Rp ",e.resellerPrice.toLocaleString("id-ID")]}):ve.jsxs("button",{onClick:d,className:"text-sm text-pink-600 hover:text-pink-700 font-medium transition-colors flex items-center space-x-1",children:[ve.jsxs("span",{children:["Reseller: Rp ",e.resellerPrice.toLocaleString("id-ID")]}),ve.jsx(b,{className:"w-3 h-3 transition-transform "+(i?"rotate-180":"")})]}),i&&"reseller"!==(null==n?void 0:n.role)&&ve.jsxs("div",{className:"absolute bottom-full left-0 right-0 mb-2 bg-white rounded-lg shadow-lg border border-gray-200 z-10",children:[ve.jsxs("button",{onClick:h,className:"w-full px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors flex items-center space-x-2 rounded-t-lg",children:[ve.jsx(y,{className:"w-4 h-4 text-green-600"}),ve.jsx("span",{children:"Info Reseller via WhatsApp"})]}),ve.jsx("div",{className:"text-xs text-gray-500 px-3 pb-2 text-center",children:"Hubungi admin untuk harga reseller"})]})]})]})]})]})},Ee=({onBannerClick:e})=>{const[t,s]=u.useState(0),[r,a]=u.useState([]),n=[{id:"flashsale-default",title:"Flash Sale âš¡",image:"/api/placeholder/400/200",link:"/flash-sale",type:"flashsale"}];return u.useEffect(()=>{const e=localStorage.getItem("azzahra-banners");if(e)try{const t=JSON.parse(e);a([...n,...t])}catch(t){a(n)}else a(n)},[]),u.useEffect(()=>{if(r.length<=1)return;const e=setInterval(()=>{s(e=>(e+1)%r.length)},3e3);return()=>clearInterval(e)},[r.length]),0===r.length?null:ve.jsxs("div",{className:"relative w-full h-48 md:h-56 lg:h-64 overflow-hidden rounded-lg",children:[ve.jsx("div",{className:"relative h-full",children:r.map((s,r)=>ve.jsx("div",{className:"absolute inset-0 transition-opacity duration-500 "+(r===t?"opacity-100":"opacity-0"),children:ve.jsx("div",{className:"w-full h-full cursor-pointer "+("flashsale"===s.type?"bg-gradient-to-r from-red-500 to-pink-500":"bg-gradient-to-r from-purple-500 to-pink-500"),onClick:()=>(t=>{e&&e(t)})(s),children:ve.jsx("div",{className:"flex items-center justify-center h-full p-8 text-white",children:ve.jsxs("div",{className:"text-center",children:["flashsale"===s.type&&ve.jsx(v,{className:"w-8 h-8 mx-auto mb-2"}),ve.jsx("h2",{className:"text-2xl md:text-3xl font-bold mb-2",children:s.title}),"flashsale"===s.type&&ve.jsx("p",{className:"text-red-100",children:"Diskon terbatas! Buruan sebelum kehabisan!"}),"promo"===s.type&&ve.jsx("p",{className:"text-purple-100",children:"Promo spesial untuk Anda!"})]})})})},s.id))}),r.length>1&&ve.jsxs(ve.Fragment,{children:[ve.jsx("button",{onClick:()=>{s(e=>(e-1+r.length)%r.length)},className:"absolute left-4 top-1/2 transform -translate-y-1/2 bg-white/20 hover:bg-white/30 rounded-full p-2 transition-colors",children:ve.jsx(j,{className:"w-5 h-5 text-white"})}),ve.jsx("button",{onClick:()=>{s(e=>(e+1)%r.length)},className:"absolute right-4 top-1/2 transform -translate-y-1/2 bg-white/20 hover:bg-white/30 rounded-full p-2 transition-colors",children:ve.jsx(w,{className:"w-5 h-5 text-white"})})]}),r.length>1&&ve.jsx("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2",children:r.map((e,r)=>ve.jsx("button",{onClick:()=>s(r),className:"w-2 h-2 rounded-full transition-colors "+(r===t?"bg-white":"bg-white/50")},r))})]})};function Ce(e){return e&&"object"==typeof e&&e.id&&e.name?o({id:String(e.id),name:String(e.name),description:e.description?String(e.description):"",category:e.category?String(e.category):"other",images:Array.isArray(e.images)?e.images:[],variants:e.variants&&"object"==typeof e.variants?{sizes:Array.isArray(e.variants.sizes)?e.variants.sizes:[],colors:Array.isArray(e.variants.colors)?e.variants.colors:[]}:{sizes:[],colors:[]},retailPrice:"number"==typeof e.retailPrice?e.retailPrice:0,resellerPrice:"number"==typeof e.resellerPrice?e.resellerPrice:0,costPrice:"number"==typeof e.costPrice?e.costPrice:0,stock:"number"==typeof e.stock?e.stock:0,status:"ready"===e.status||"po"===e.status?e.status:"ready",isFlashSale:Boolean(e.isFlashSale),flashSalePrice:"number"==typeof e.flashSalePrice?e.flashSalePrice:0,createdAt:e.createdAt?e.createdAt instanceof Date?e.createdAt:new Date(e.createdAt):new Date,salesCount:"number"==typeof e.salesCount?e.salesCount:0,isFeatured:Boolean(e.isFeatured),featuredOrder:"number"==typeof e.featuredOrder?e.featuredOrder:void 0},Object.keys(e).reduce((t,s)=>(["id","name","description","category","images","variants","retailPrice","resellerPrice","costPrice","stock","status","isFlashSale","flashSalePrice","createdAt","salesCount","isFeatured","featuredOrder"].includes(s)||(t[s]=e[s]),t),{})):null}const Te=({user:e,cartItems:t,products:s,loading:r,onProductClick:a,onLoginRequired:n,onCartClick:i,onAddToCart:l,onNavigateToFlashSale:d})=>{var h;const[p,g]=u.useState(""),[b,y]=u.useState("all"),[v,P]=u.useState("all"),[E,C]=u.useState("terbaru"),[T,O]=u.useState(1),[A,R]=u.useState(0),I=[{id:"all",name:"Semua",icon:"ðŸ›ï¸"},{id:"hijab",name:"Hijab",icon:"ðŸ§•"},{id:"gamis",name:"Gamis",icon:"ðŸ‘—"},{id:"khimar",name:"Khimar",icon:"ðŸ§•"},{id:"tunik",name:"Tunik",icon:"ðŸ‘š"},{id:"abaya",name:"Abaya",icon:"ðŸ¥»"}],D=e=>{l(e)},$=m.useMemo(()=>{const e=function(e){if(!Array.isArray(e))return console.warn("âš ï¸ validateProducts: Input is not an array"),[];const t=e.map(Ce).filter(e=>null!==e);return console.log(`âœ… validateProducts: ${t.length}/${e.length} products are valid`),t}(s);return e.map(e=>c(o({},e),{description:e.description||"",category:e.category||"other",images:e.images||[],variants:e.variants||{sizes:[],colors:[]},retailPrice:e.retailPrice||0,resellerPrice:e.resellerPrice||0,costPrice:e.costPrice||0,stock:e.stock||0,status:e.status||"ready",isFlashSale:e.isFlashSale||!1,flashSalePrice:e.flashSalePrice||0,createdAt:e.createdAt||new Date,salesCount:e.salesCount||0,isFeatured:e.isFeatured||!1}))},[s]),L=$.filter(e=>{const t=e.name.toLowerCase().includes(p.toLowerCase())||e.description.toLowerCase().includes(p.toLowerCase()),s="all"===b||e.category===b,r="all"===v||e.status===v;return t&&s&&r}),U=[...L].sort((t,s)=>{switch(E){case"terbaru":return new Date(s.createdAt).getTime()-new Date(t.createdAt).getTime();case"terlama":return new Date(t.createdAt).getTime()-new Date(s.createdAt).getTime();case"terlaris":return(s.salesCount||0)-(t.salesCount||0);case"termurah":return("reseller"===(null==e?void 0:e.role)?t.resellerPrice:t.retailPrice)-("reseller"===(null==e?void 0:e.role)?s.resellerPrice:s.retailPrice);case"termahal":const r="reseller"===(null==e?void 0:e.role)?t.resellerPrice:t.retailPrice;return("reseller"===(null==e?void 0:e.role)?s.resellerPrice:s.retailPrice)-r;default:return 0}}),F=m.useMemo(()=>(we.validateAndSyncFeaturedProducts(),we.getFeaturedProducts()),[s,A]),B=m.useMemo(()=>{try{if(!Array.isArray(U)||!Array.isArray(F))return console.warn("âš ï¸ Invalid product arrays for regular products calculation"),U||[];const e=new Set(F.map(e=>e.id).filter(Boolean));return U.filter(t=>t&&t.id&&!e.has(t.id))}catch(e){return console.error("ðŸš¨ Error in regularProducts calculation:",e),U||[]}},[U,F]),z=8*T,M=z-8,K=B.slice(M,z),q=Math.ceil(B.length/8);return u.useEffect(()=>{O(1)},[p,b,v,E]),u.useEffect(()=>{const e=e=>{console.log("Featured products updated in HomePage:",e.detail),R(e=>e+1)};return window.addEventListener("featuredProductsUpdated",e),()=>{window.removeEventListener("featuredProductsUpdated",e)}},[]),u.useEffect(()=>{const e=e=>{console.log("Products updated in HomePage:",e.detail),R(e=>e+1)};return window.addEventListener("productsUpdated",e),()=>{window.removeEventListener("productsUpdated",e)}},[]),u.useEffect(()=>{const e=e=>{var t;console.log("ðŸ”¥ Flash sale ended detected in HomePage:",e.detail),R(e=>e+1),we.refreshFeaturedProductsCache(),"time_expired"===(null==(t=e.detail)?void 0:t.reason)&&(window.flashSaleRefreshTimer&&clearTimeout(window.flashSaleRefreshTimer),window.flashSaleRefreshTimer=setTimeout(()=>{console.log("ðŸ”„ Auto-refreshing HomePage after flash sale time expired"),window.location.reload()},4e3))};return window.addEventListener("flashSaleEnded",e),()=>{window.removeEventListener("flashSaleEnded",e)}},[]),r?ve.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:ve.jsxs("div",{className:"text-center",children:[ve.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-pink-500 mx-auto mb-4"}),ve.jsx("p",{className:"text-gray-600",children:"Loading products..."})]})}):ve.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[ve.jsxs("div",{className:"bg-gradient-to-r from-pink-500 to-purple-600 text-white p-4",children:[ve.jsxs("div",{className:"flex items-center justify-between mb-4",children:[ve.jsxs("div",{children:[ve.jsx("h1",{className:"text-xl font-bold",children:"Azzahra Fashion"}),ve.jsx("p",{className:"text-pink-100 text-sm",children:"Muslim Fashion Store"})]}),ve.jsx("div",{className:"flex items-center space-x-3",children:e?ve.jsxs("div",{className:"flex items-center space-x-2",children:[ve.jsx(N,{className:"w-5 h-5"}),ve.jsx("span",{className:"text-sm",children:e.name})]}):ve.jsx("button",{onClick:n,className:"bg-white/20 px-3 py-1 rounded-full text-sm hover:bg-white/30 transition-colors",children:"Login"})})]}),ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsxs("div",{className:"flex-1 relative",children:[ve.jsx(k,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),ve.jsx("input",{type:"text",placeholder:"Cari produk...",value:p,onChange:e=>g(e.target.value),className:"w-full pl-10 pr-4 py-3 rounded-lg text-gray-800 focus:outline-none focus:ring-2 focus:ring-white/50"})]}),ve.jsxs("button",{onClick:i,className:"relative p-2 bg-white rounded-full shadow-md hover:shadow-lg transition-shadow",children:[ve.jsx(f,{className:"w-6 h-6 text-gray-600"}),t.length>0&&ve.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center",children:t.length})]})]})]}),ve.jsx("div",{className:"p-4",children:ve.jsx(Ee,{onBannerClick:e=>{console.log("Banner clicked:",e),"flashsale"===e.type&&(console.log("Flash sale banner clicked, navigating..."),d&&d())}})}),ve.jsxs("div",{className:"px-4 mb-6",children:[ve.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[ve.jsx(x,{className:"w-5 h-5 text-yellow-500 fill-current"}),ve.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"Produk Unggulan"})]}),r?ve.jsx("div",{className:"grid grid-cols-2 gap-4",children:[...Array(2)].map((e,t)=>ve.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[ve.jsx("div",{className:"w-full h-48 bg-gray-200 animate-pulse"}),ve.jsxs("div",{className:"p-4",children:[ve.jsx("div",{className:"h-4 bg-gray-200 rounded mb-2 animate-pulse"}),ve.jsx("div",{className:"h-3 bg-gray-200 rounded mb-3 animate-pulse"}),ve.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 animate-pulse"})]})]},`skeleton-${t}`))}):F.length>0?ve.jsx("div",{className:"grid grid-cols-2 gap-4",children:F.map(t=>ve.jsx(Pe,{product:t,onProductClick:a,onAddToCart:D,user:e,isFeatured:!0},`featured-${t.id}`))}):ve.jsxs("div",{className:"text-center py-8 text-gray-500 bg-white rounded-lg",children:[ve.jsx(x,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),ve.jsx("p",{children:"Belum ada produk unggulan"})]})]}),ve.jsx("div",{className:"px-4",children:ve.jsxs("div",{className:"flex flex-col space-y-3",children:[ve.jsx("div",{className:"flex space-x-3 overflow-x-auto pb-2",children:I.map(e=>ve.jsxs("button",{onClick:()=>y(e.id),className:"flex-shrink-0 flex items-center space-x-2 px-4 py-2 rounded-full transition-colors "+(b===e.id?"bg-pink-500 text-white":"bg-white text-gray-600 hover:bg-gray-100"),children:[ve.jsx("span",{children:e.icon}),ve.jsx("span",{className:"text-sm font-medium",children:e.name})]},e.id))}),ve.jsxs("div",{className:"flex space-x-3 overflow-x-auto pb-2",children:[ve.jsx("button",{onClick:()=>P("all"),className:"flex-shrink-0 flex items-center space-x-2 px-4 py-2 rounded-full transition-colors "+("all"===v?"bg-gray-700 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:ve.jsx("span",{className:"text-sm font-medium",children:"Semua Status"})}),ve.jsxs("button",{onClick:()=>P("ready"),className:"flex-shrink-0 flex items-center space-x-2 px-4 py-2 rounded-full transition-colors "+("ready"===v?"bg-green-500 text-white":"bg-white text-gray-600 hover:bg-gray-100 border border-green-300"),children:[ve.jsx("span",{className:"w-2 h-2 bg-current rounded-full"}),ve.jsx("span",{className:"text-sm font-medium",children:"Ready"})]}),ve.jsxs("button",{onClick:()=>P("po"),className:"flex-shrink-0 flex items-center space-x-2 px-4 py-2 rounded-full transition-colors "+("po"===v?"bg-orange-500 text-white":"bg-white text-gray-600 hover:bg-gray-100 border border-orange-300"),children:[ve.jsx("span",{className:"w-2 h-2 bg-current rounded-full"}),ve.jsx("span",{className:"text-sm font-medium",children:"PO"})]})]})]})}),ve.jsxs("div",{className:"px-4",children:[ve.jsxs("div",{className:"flex flex-col space-y-3 mb-4",children:[ve.jsxs("div",{className:"flex items-center justify-between",children:[ve.jsx("h2",{className:"text-lg font-bold text-gray-800",children:"all"===b?"Semua Produk":null==(h=I.find(e=>e.id===b))?void 0:h.name}),ve.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[ve.jsx(S,{className:"w-4 h-4 mr-1"}),L.length," produk"]})]}),ve.jsxs("div",{className:"flex items-center space-x-2 overflow-x-auto pb-2",children:[ve.jsxs("div",{className:"flex items-center text-sm text-gray-600 mr-2",children:[ve.jsx(_,{className:"w-4 h-4 mr-1"}),"Urutkan:"]}),ve.jsx("button",{onClick:()=>C("terbaru"),className:"flex-shrink-0 px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+("terbaru"===E?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"Terbaru"}),ve.jsx("button",{onClick:()=>C("terlaris"),className:"flex-shrink-0 px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+("terlaris"===E?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"Terlaris"}),ve.jsx("button",{onClick:()=>C("termurah"),className:"flex-shrink-0 px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+("termurah"===E?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"Termurah"}),ve.jsx("button",{onClick:()=>C("termahal"),className:"flex-shrink-0 px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+("termahal"===E?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"Termahal"}),ve.jsx("button",{onClick:()=>C("terlama"),className:"flex-shrink-0 px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+("terlama"===E?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:"Terlama"})]})]}),0===L.length?ve.jsxs("div",{className:"text-center py-12",children:[ve.jsx("div",{className:"text-gray-400 mb-4",children:ve.jsx(k,{className:"w-12 h-12 mx-auto"})}),ve.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"Produk tidak ditemukan"}),ve.jsx("p",{className:"text-gray-500",children:"Coba kata kunci lain atau pilih kategori berbeda"})]}):ve.jsxs(ve.Fragment,{children:[ve.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:K.map(t=>ve.jsx(Pe,{product:t,onProductClick:a,onAddToCart:D,user:e},t.id))}),q>1&&ve.jsxs("div",{className:"flex flex-col items-center mt-8 space-y-4",children:[ve.jsxs("div",{className:"flex items-center space-x-2",children:[ve.jsxs("button",{onClick:()=>O(e=>Math.max(1,e-1)),disabled:1===T,className:"flex items-center space-x-1 px-3 py-2 rounded-lg transition-colors "+(1===T?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300"),children:[ve.jsx(j,{className:"w-4 h-4"}),ve.jsx("span",{children:"Sebelumnya"})]}),ve.jsx("div",{className:"flex items-center space-x-1",children:[...Array(q)].map((e,t)=>{const s=t+1,r=T===s;return 1===s||s===q||s>=T-1&&s<=T+1?ve.jsx("button",{onClick:()=>O(s),className:"w-10 h-10 rounded-lg font-medium transition-colors "+(r?"bg-pink-500 text-white":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300"),children:s},s):2===s&&T>3||s===q-1&&T<q-2?ve.jsx("span",{className:"px-2 text-gray-400",children:"..."},s):null})}),ve.jsxs("button",{onClick:()=>O(e=>Math.min(q,e+1)),disabled:T===q,className:"flex items-center space-x-1 px-3 py-2 rounded-lg transition-colors "+(T===q?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50 border border-gray-300"),children:[ve.jsx("span",{children:"Selanjutnya"}),ve.jsx(w,{className:"w-4 h-4"})]})]}),ve.jsxs("div",{className:"text-sm text-gray-600",children:["Menampilkan ",M+1,"-",Math.min(z,B.length)," dari ",B.length," produk"]})]})]})]}),e&&ve.jsx("div",{className:"fixed bottom-24 right-4 bg-white rounded-lg shadow-lg p-3 border-l-4 border-pink-500",children:ve.jsx("div",{className:"text-xs text-gray-600",children:"reseller"===e.role?ve.jsxs("div",{className:"flex items-center space-x-1",children:[ve.jsx("span",{className:"w-2 h-2 bg-blue-500 rounded-full"}),ve.jsx("span",{children:"Harga Reseller Aktif"})]}):ve.jsxs("div",{className:"flex items-center space-x-1",children:[ve.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),ve.jsx("span",{children:"Harga Retail"})]})})})]})},Oe=({product:e,user:t,onBack:s,onLoginRequired:r,onAddToCart:a,onBuyNow:n,onNavigateToCart:i})=>{const[l,o]=u.useState(""),[c,d]=u.useState(""),[h,m]=u.useState(1),[p,g]=u.useState(0);return ve.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[ve.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:ve.jsxs("div",{className:"flex items-center justify-between p-4",children:[ve.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-full",children:ve.jsx(P,{className:"w-6 h-6 text-gray-600"})}),ve.jsx("h1",{className:"text-lg font-semibold",children:"Detail Produk"}),ve.jsxs("div",{className:"flex items-center space-x-2",children:[ve.jsx("button",{onClick:i||(()=>{}),className:"p-2 rounded-full transition-colors relative "+(t?"bg-pink-500 text-white hover:bg-pink-600":"bg-gray-100 text-gray-400"),children:ve.jsx(f,{className:"w-5 h-5"})}),ve.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-full",children:ve.jsx(E,{className:"w-5 h-5 text-gray-600"})}),ve.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-full",children:ve.jsx(C,{className:"w-5 h-5 text-gray-600"})})]})]})}),ve.jsxs("div",{className:"bg-white",children:[ve.jsxs("div",{className:"relative",children:[ve.jsx("img",{src:e.images[p],alt:e.name,className:"w-full h-96 object-cover"}),e.isFlashSale&&ve.jsx("div",{className:"absolute top-4 left-4 bg-red-500 text-white px-3 py-1 rounded-full text-sm font-semibold",children:"FLASH SALE"}),"po"===e.status&&ve.jsx("div",{className:"absolute top-4 right-4 bg-orange-500 text-white px-3 py-1 rounded-full text-sm font-semibold",children:"PRE ORDER"})]}),e.images.length>1&&ve.jsx("div",{className:"flex space-x-2 p-4 overflow-x-auto",children:e.images.map((t,s)=>ve.jsx("button",{onClick:()=>g(s),className:"flex-shrink-0 w-16 h-16 rounded-lg overflow-hidden border-2 "+(p===s?"border-pink-500":"border-gray-200"),children:ve.jsx("img",{src:t,alt:`${e.name} ${s+1}`,className:"w-full h-full object-cover"})},s))})]}),ve.jsxs("div",{className:"bg-white mt-2 p-4",children:[ve.jsx("div",{className:"flex items-start justify-between mb-3",children:ve.jsxs("div",{className:"flex-1",children:[ve.jsx("h1",{className:"text-xl font-bold text-gray-800 mb-2",children:e.name}),ve.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[ve.jsxs("div",{className:"flex items-center",children:[[...Array(5)].map((e,t)=>ve.jsx(x,{className:"w-4 h-4 text-yellow-400 fill-current"},t)),ve.jsx("span",{className:"text-sm text-gray-600 ml-1",children:"(4.8)"})]}),ve.jsx("span",{className:"text-sm text-gray-500",children:"â€¢ Terjual 150+"})]})]})}),ve.jsx("div",{className:"mb-4",children:e.isFlashSale&&e.flashSalePrice>0?ve.jsxs("div",{className:"space-y-1",children:[ve.jsxs("div",{className:"flex items-center space-x-2",children:[ve.jsxs("span",{className:"text-2xl font-bold text-red-600",children:["Rp ",e.flashSalePrice.toLocaleString("id-ID")]}),ve.jsxs("span",{className:"bg-red-100 text-red-600 text-xs px-2 py-1 rounded",children:["-",Math.round(100*(1-e.flashSalePrice/(e.originalRetailPrice||e.retailPrice))),"%"]})]}),ve.jsxs("div",{className:"text-lg text-gray-500 line-through",children:["Rp ",(e.originalRetailPrice||e.retailPrice).toLocaleString("id-ID")]})]}):ve.jsxs("div",{className:"space-y-1",children:[ve.jsxs("div",{className:"text-2xl font-bold text-pink-600",children:["Rp ",(e.isFlashSale&&e.flashSalePrice>0?e.flashSalePrice:"reseller"===(null==t?void 0:t.role)?e.resellerPrice:e.retailPrice).toLocaleString("id-ID")]}),"reseller"===(null==t?void 0:t.role)?ve.jsxs("div",{className:"text-sm text-blue-600 font-medium",children:["Harga Reseller (Retail: Rp ",e.retailPrice.toLocaleString("id-ID"),")"]}):ve.jsx("button",{onClick:()=>{if("reseller"!==(null==t?void 0:t.role)){const t=encodeURIComponent(`Halo Admin, saya tertarik dengan produk ${e.name} dan ingin menanyakan tentang harga reseller. Mohon info lebih lanjut. Terima kasih.`);window.open(`https://wa.me/6287815990944?text=${t}`,"_blank")}},className:"text-sm text-green-600 font-medium hover:text-green-700 underline transition-colors",children:"ðŸ’¬ Info Harga Reseller?"})]})}),ve.jsx("div",{className:"flex items-center justify-between mb-4 p-3 bg-gray-50 rounded-lg",children:ve.jsxs("div",{className:"flex items-center space-x-4",children:[ve.jsxs("div",{className:"text-sm",children:[ve.jsx("span",{className:"text-gray-600",children:"Stok: "}),ve.jsx("span",{className:"font-semibold "+(e.stock>10?"text-green-600":e.stock>0?"text-yellow-600":"text-red-600"),children:e.stock})]}),ve.jsxs("div",{className:"text-sm",children:[ve.jsx("span",{className:"text-gray-600",children:"Status: "}),ve.jsx("span",{className:"font-semibold "+("ready"===e.status?"text-green-600":"text-orange-600"),children:"ready"===e.status?"Ready Stock":"Pre Order"})]})]})}),ve.jsx("div",{className:"border-t pt-4",children:ve.jsx("p",{className:"text-gray-600 leading-relaxed",children:e.description})})]}),ve.jsxs("div",{className:"bg-white mt-2 p-4",children:[ve.jsxs("div",{className:"mb-6",children:[ve.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Pilih Ukuran"}),ve.jsx("div",{className:"flex flex-wrap gap-2",children:e.variants.sizes.map(e=>ve.jsx("button",{onClick:()=>o(e),className:"px-4 py-2 border rounded-lg font-medium transition-colors "+(l===e?"border-pink-500 bg-pink-50 text-pink-600":"border-gray-300 text-gray-600 hover:border-gray-400"),children:e},e))})]}),ve.jsxs("div",{className:"mb-6",children:[ve.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Pilih Warna"}),ve.jsx("div",{className:"flex flex-wrap gap-2",children:e.variants.colors.map(e=>ve.jsx("button",{onClick:()=>d(e),className:"px-4 py-2 border rounded-lg font-medium transition-colors "+(c===e?"border-pink-500 bg-pink-50 text-pink-600":"border-gray-300 text-gray-600 hover:border-gray-400"),children:e},e))})]}),ve.jsxs("div",{className:"mb-6",children:[ve.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Jumlah"}),ve.jsxs("div",{className:"flex items-center space-x-4",children:[ve.jsxs("div",{className:"flex items-center space-x-3 bg-gray-100 rounded-lg p-1",children:[ve.jsx("button",{onClick:()=>m(Math.max(1,h-1)),className:"w-10 h-10 flex items-center justify-center rounded-md hover:bg-gray-200 transition-colors",children:ve.jsx(T,{className:"w-4 h-4"})}),ve.jsx("span",{className:"w-12 text-center font-semibold",children:h}),ve.jsx("button",{onClick:()=>m(h+1),className:"w-10 h-10 flex items-center justify-center rounded-md hover:bg-gray-200 transition-colors",children:ve.jsx(O,{className:"w-4 h-4"})})]}),ve.jsxs("div",{className:"text-sm text-gray-600",children:["Stok tersedia: ",ve.jsx("span",{className:"font-semibold",children:e.stock})]})]})]})]}),ve.jsxs("div",{className:"bg-white mt-2 p-4",children:[ve.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Detail Produk"}),ve.jsxs("div",{className:"space-y-2 text-sm",children:[ve.jsxs("div",{className:"flex justify-between",children:[ve.jsx("span",{className:"text-gray-600",children:"Kategori:"}),ve.jsx("span",{className:"font-medium capitalize",children:e.category})]}),"po"===e.status&&e.estimatedReady&&ve.jsxs("div",{className:"flex justify-between",children:[ve.jsx("span",{className:"text-gray-600",children:"Estimasi Ready:"}),ve.jsx("span",{className:"font-medium",children:e.estimatedReady.toLocaleDateString("id-ID")})]}),ve.jsxs("div",{className:"flex justify-between",children:[ve.jsx("span",{className:"text-gray-600",children:"Berat:"}),ve.jsx("span",{className:"font-medium",children:"500 gram"})]}),ve.jsxs("div",{className:"flex justify-between",children:[ve.jsx("span",{className:"text-gray-600",children:"Kondisi:"}),ve.jsx("span",{className:"font-medium text-green-600",children:"Baru"})]}),ve.jsxs("div",{className:"flex justify-between",children:[ve.jsx("span",{className:"text-gray-600",children:"Garansi:"}),ve.jsx("span",{className:"font-medium",children:"Garansi Toko"})]})]})]}),ve.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 shadow-lg z-50",children:[ve.jsxs("div",{className:"flex space-x-3",children:[ve.jsxs("button",{onClick:()=>{t?l&&c?(a(e,{size:l,color:c},h),o(""),d(""),m(1)):alert("Pilih ukuran dan warna terlebih dahulu"):r()},disabled:!l||!c,className:"flex-1 bg-pink-100 text-pink-600 py-4 rounded-lg font-semibold hover:bg-pink-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:[ve.jsx(f,{className:"w-5 h-5"}),ve.jsx("span",{children:"Tambah ke Keranjang"})]}),ve.jsx("button",{onClick:()=>{t?l&&c?n(e,{size:l,color:c},h):alert("Pilih ukuran dan warna terlebih dahulu"):r()},disabled:!l||!c,className:"flex-1 bg-gradient-to-r from-pink-500 to-purple-600 text-white py-4 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"Beli Sekarang"})]}),(!l||!c)&&ve.jsx("p",{className:"text-center text-sm text-gray-500 mt-2",children:"Pilih ukuran dan warna terlebih dahulu"})]})]})},Ae=({cartItems:e,user:t,updateQuantity:s,removeFromCart:r,getTotalPrice:a,onBack:n,onCheckout:i})=>{if(0===e.length)return ve.jsxs("div",{className:"min-h-screen bg-gray-50",children:[ve.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:ve.jsxs("div",{className:"flex items-center p-4",children:[ve.jsx("button",{onClick:n,className:"mr-4",children:ve.jsx(P,{className:"w-6 h-6 text-gray-600"})}),ve.jsx("h1",{className:"text-lg font-semibold",children:"Keranjang Belanja"})]})}),ve.jsxs("div",{className:"flex flex-col items-center justify-center h-96",children:[ve.jsx(A,{className:"w-16 h-16 text-gray-300 mb-4"}),ve.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"Keranjang Kosong"}),ve.jsxs("p",{className:"text-gray-500 text-center mb-6",children:["Belum ada produk di keranjang Anda.",ve.jsx("br",{}),"Yuk mulai belanja!"]}),ve.jsx("button",{onClick:n,className:"bg-gradient-to-r from-pink-500 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition-all",children:"Mulai Belanja"})]})]});const l=a();return ve.jsxs("div",{className:"min-h-screen bg-gray-50 pb-32",children:[ve.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:ve.jsxs("div",{className:"flex items-center p-4",children:[ve.jsx("button",{onClick:n,className:"mr-4",children:ve.jsx(P,{className:"w-6 h-6 text-gray-600"})}),ve.jsx("h1",{className:"text-lg font-semibold",children:"Keranjang Belanja"}),ve.jsx("span",{className:"ml-2 bg-pink-100 text-pink-600 text-xs px-2 py-1 rounded-full",children:e.length})]})}),ve.jsx("div",{className:"p-4 space-y-4",children:e.map(e=>{var a,n;const i="reseller"===(null==t?void 0:t.role)?e.resellerPrice:e.retailPrice,l=i*e.quantity;return ve.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:ve.jsxs("div",{className:"flex space-x-4",children:[ve.jsx("img",{src:e.images[0],alt:e.name,className:"w-20 h-20 object-cover rounded-lg"}),ve.jsxs("div",{className:"flex-1",children:[ve.jsx("h3",{className:"font-semibold text-gray-800 mb-1",children:e.name}),e.selectedVariant&&ve.jsxs("p",{className:"text-sm text-gray-500 mb-2",children:["Ukuran: ",e.selectedVariant.size," | Warna: ",e.selectedVariant.color]}),ve.jsxs("div",{className:"flex items-center justify-between",children:[ve.jsxs("div",{className:"flex flex-col",children:[ve.jsxs("span",{className:"text-lg font-bold text-pink-600",children:["Rp ",i.toLocaleString("id-ID")]}),"reseller"===(null==t?void 0:t.role)&&ve.jsx("span",{className:"text-xs text-blue-600 font-medium",children:"Harga Reseller"})]}),ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsxs("div",{className:"flex items-center space-x-2 bg-gray-100 rounded-lg p-1",children:[ve.jsx("button",{onClick:()=>s(e.id,e.selectedVariant,Math.max(1,e.quantity-1)),className:"w-8 h-8 flex items-center justify-center rounded-md hover:bg-gray-200 transition-colors",children:ve.jsx(T,{className:"w-4 h-4"})}),ve.jsx("span",{className:"w-8 text-center font-semibold",children:e.quantity}),ve.jsx("button",{onClick:()=>s(e.id,e.selectedVariant,e.quantity+1),className:"w-8 h-8 flex items-center justify-center rounded-md hover:bg-gray-200 transition-colors",children:ve.jsx(O,{className:"w-4 h-4"})})]}),ve.jsx("button",{onClick:()=>r(e.id,e.selectedVariant),className:"w-8 h-8 flex items-center justify-center text-red-500 hover:bg-red-50 rounded-md transition-colors",children:ve.jsx(R,{className:"w-4 h-4"})})]})]}),ve.jsxs("div",{className:"mt-2 text-right",children:[ve.jsx("span",{className:"text-sm text-gray-600",children:"Subtotal: "}),ve.jsxs("span",{className:"font-semibold text-gray-800",children:["Rp ",l.toLocaleString("id-ID")]})]})]})]})},`${e.id}-${null==(a=e.selectedVariant)?void 0:a.size}-${null==(n=e.selectedVariant)?void 0:n.color}`)})}),ve.jsxs("div",{className:"fixed bottom-20 left-0 right-0 bg-white border-t border-gray-200 p-4 shadow-lg",children:[ve.jsxs("div",{className:"flex items-center justify-between mb-3",children:[ve.jsxs("span",{className:"text-gray-600",children:["Total (",e.length," item)"]}),ve.jsxs("span",{className:"text-xl font-bold text-pink-600",children:["Rp ",l.toLocaleString("id-ID")]})]}),ve.jsx("button",{onClick:i,className:"w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-4 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition-all",children:"Checkout Sekarang"})]})]})},Re="azzahra-addresses",Ie=({initialData:e,onSave:t,onCancel:s})=>{const[r,a]=u.useState({name:(null==e?void 0:e.name)||"",phone:(null==e?void 0:e.phone)||"",fullAddress:(null==e?void 0:e.fullAddress)||"",province:(null==e?void 0:e.province)||"",city:(null==e?void 0:e.city)||"",postalCode:(null==e?void 0:e.postalCode)||"",isDefault:(null==e?void 0:e.isDefault)||!1}),[n,i]=u.useState({}),l=e=>{const{name:t,value:s,type:r}=e.target;a(a=>c(o({},a),{[t]:"checkbox"===r?e.target.checked:s})),n[t]&&i(e=>c(o({},e),{[t]:void 0}))};return ve.jsxs("form",{onSubmit:e=>{e.preventDefault(),(()=>{const e={};return r.name.trim()||(e.name="Nama harus diisi"),r.phone.trim()||(e.phone="Nomor telepon harus diisi"),r.fullAddress.trim()||(e.fullAddress="Alamat harus diisi"),r.province.trim()||(e.province="Provinsi harus diisi"),r.city.trim()||(e.city="Kota harus diisi"),r.postalCode.trim()||(e.postalCode="Kode pos harus diisi"),i(e),0===Object.keys(e).length})()&&t(r)},className:"space-y-4",children:[ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nama Lengkap *"}),ve.jsx("input",{type:"text",name:"name",value:r.name,onChange:l,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(n.name?"border-red-500":"border-gray-300"),placeholder:"Masukkan nama lengkap"}),n.name&&ve.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.name})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nomor Telepon *"}),ve.jsx("input",{type:"tel",name:"phone",value:r.phone,onChange:l,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(n.phone?"border-red-500":"border-gray-300"),placeholder:"Masukkan nomor telepon aktif"}),n.phone&&ve.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.phone})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Provinsi *"}),ve.jsxs("select",{name:"province",value:r.province,onChange:l,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(n.province?"border-red-500":"border-gray-300"),children:[ve.jsx("option",{value:"",children:"Pilih provinsi"}),["Aceh","Sumatera Utara","Sumatera Barat","Sumatera Selatan","Riau","Kepulauan Riau","Jambi","Bengkulu","Lampung","Banten","DKI Jakarta","Jawa Barat","Jawa Tengah","DI Yogyakarta","Jawa Timur","Bali","Nusa Tenggara Barat","Nusa Tenggara Timur","Kalimantan Barat","Kalimantan Tengah","Kalimantan Selatan","Kalimantan Timur","Kalimantan Utara","Sulawesi Utara","Sulawesi Tengah","Sulawesi Selatan","Sulawesi Tenggara","Sulawesi Barat","Gorontalo","Sulawesi Selatan","Maluku","Maluku Utara","Papua","Papua Barat","Papua Selatan","Papua Tengah"].map(e=>ve.jsx("option",{value:e,children:e},e))]}),n.province&&ve.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.province})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kota/Kabupaten *"}),ve.jsx("input",{type:"text",name:"city",value:r.city,onChange:l,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(n.city?"border-red-500":"border-gray-300"),placeholder:"Masukkan kota/kabupaten"}),n.city&&ve.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.city})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Kode Pos *"}),ve.jsx("input",{type:"text",name:"postalCode",value:r.postalCode,onChange:l,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(n.postalCode?"border-red-500":"border-gray-300"),placeholder:"Masukkan kode pos",maxLength:5}),n.postalCode&&ve.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.postalCode})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Alamat Lengkap *"}),ve.jsx("textarea",{name:"fullAddress",value:r.fullAddress,onChange:l,rows:3,className:"w-full p-3 border rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent "+(n.fullAddress?"border-red-500":"border-gray-300"),placeholder:"Jalan, nomor rumah, RT/RW, kelurahan/desa"}),n.fullAddress&&ve.jsx("p",{className:"text-red-500 text-xs mt-1",children:n.fullAddress})]}),ve.jsxs("div",{className:"flex items-center",children:[ve.jsx("input",{type:"checkbox",name:"isDefault",checked:r.isDefault,onChange:l,className:"w-4 h-4 text-pink-600 border-gray-300 rounded focus:ring-pink-500"}),ve.jsx("label",{className:"ml-2 text-sm text-gray-700",children:"Jadikan alamat utama"})]}),ve.jsxs("div",{className:"flex space-x-3 pt-4",children:[ve.jsx("button",{type:"button",onClick:s,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"Batal"}),ve.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-pink-600 text-white rounded-lg hover:bg-pink-700 transition-colors font-medium",children:e?"Update":"Simpan"})]})]})},De=({cartItems:e,user:t,getTotalPrice:s,clearCart:r,onBack:a})=>{var n;const[i,l]=u.useState(!1),[d,h]=u.useState(""),[m,p]=u.useState(null),{addresses:g,addAddress:x,updateAddress:f,deleteAddress:b,getDefaultAddress:y}=(()=>{const[e,t]=u.useState([]),[s,r]=u.useState(!0);u.useEffect(()=>{a()},[]);const a=()=>{try{const e=localStorage.getItem(Re);e&&t(JSON.parse(e))}catch(e){console.error("Failed to load addresses:",e)}finally{r(!1)}},n=e=>{localStorage.setItem(Re,JSON.stringify(e)),t(e)};return{addresses:e,loading:s,addAddress:t=>{const s=c(o({},t),{id:Date.now().toString()});if(0===e.length||t.isDefault){const t=e.map(e=>c(o({},e),{isDefault:!1}));n([...t,s])}else n([...e,s])},updateAddress:(t,s)=>{const r=e.map(e=>e.id===t?o(o({},e),s):s.isDefault?c(o({},e),{isDefault:!1}):e),a=r.find(e=>e.id===t&&s.isDefault);n(a?r.map(e=>e.id===t?e:c(o({},e),{isDefault:!1})):r)},deleteAddress:t=>{const s=e.find(e=>e.id===t);if(e.length<=1)alert("Tidak dapat menghapus alamat. Minimal harus ada satu alamat.");else if(null==s?void 0:s.isDefault){const s=e.filter(e=>e.id!==t);s.length>0&&(s[0].isDefault=!0),n(s)}else n(e.filter(e=>e.id!==t))},setDefaultAddress:t=>{n(e.map(e=>c(o({},e),{isDefault:e.id===t})))},getDefaultAddress:()=>e.find(e=>e.isDefault)||e[0],refresh:a}})(),[v,j]=u.useState({name:(null==t?void 0:t.name)||"",phone:"",address:"",isDropship:!1,dropshipName:"",dropshipPhone:"",paymentMethod:"transfer",shippingCourier:"jnt",shippingCost:0,notes:""}),w=[{id:"ojek",name:"OJEK",price:0},{id:"jnt",name:"J&T",price:0},{id:"jne",name:"JNE",price:0},{id:"pos",name:"POS Indonesia",price:0},{id:"tiki",name:"TIKI",price:0},{id:"lion",name:"Lion Parcel",price:0},{id:"idexpress",name:"ID Express",price:0}],k=e=>{const{name:t,value:s,type:r}=e.target;j(a=>c(o({},a),{[t]:"checkbox"===r?e.target.checked:"number"===r?parseInt(s)||0:s}))};u.useEffect(()=>{const e=y();e&&(h(e.id),j(t=>c(o({},t),{name:e.name,phone:e.phone,address:e.fullAddress})))},[g]);const S=e=>{h(e);const t=g.find(t=>t.id===e);t&&j(e=>c(o({},e),{name:v.isDropship?e.name:t.name,phone:v.isDropship?e.phone:t.phone,address:v.isDropship?e.address:t.fullAddress}))},_=s(),E=v.shippingCost||0,C=_+E;return ve.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[ve.jsx("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:ve.jsxs("div",{className:"flex items-center p-4",children:[ve.jsx("button",{onClick:a,className:"mr-4",children:ve.jsx(P,{className:"w-6 h-6 text-gray-600"})}),ve.jsx("h1",{className:"text-lg font-semibold",children:"Checkout"})]})}),ve.jsxs("div",{className:"p-4 space-y-4",children:[ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsx("h3",{className:"font-semibold mb-3",children:"Produk Pesanan"}),ve.jsx("div",{className:"space-y-3",children:e.map(e=>{var s,r;return ve.jsxs("div",{className:"flex space-x-3",children:[ve.jsx("img",{src:e.images[0],alt:e.name,className:"w-16 h-16 object-cover rounded-lg"}),ve.jsxs("div",{className:"flex-1",children:[ve.jsx("h4",{className:"font-medium text-sm",children:e.name}),e.selectedVariant&&ve.jsxs("p",{className:"text-xs text-gray-500",children:[e.selectedVariant.size," - ",e.selectedVariant.color]}),ve.jsxs("div",{className:"flex justify-between items-center mt-1",children:[ve.jsxs("span",{className:"text-sm font-semibold text-pink-600",children:["Rp ",("reseller"===(null==t?void 0:t.role)?e.resellerPrice:e.retailPrice).toLocaleString("id-ID")]}),ve.jsxs("span",{className:"text-sm text-gray-500",children:["x",e.quantity]})]})]})]},`${e.id}-${null==(s=e.selectedVariant)?void 0:s.size}-${null==(r=e.selectedVariant)?void 0:r.color}`)})})]}),ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsxs("div",{className:"flex justify-between items-center mb-3",children:[ve.jsx("h3",{className:"font-semibold",children:"Informasi Pengiriman"}),ve.jsxs("button",{onClick:()=>l(!0),className:"text-pink-600 hover:text-pink-700 flex items-center text-sm font-medium",children:[ve.jsx(O,{className:"w-4 h-4 mr-1"}),"Tambah Alamat"]})]}),g.length>0&&ve.jsx("div",{className:"space-y-2 mb-4",children:g.map(e=>ve.jsx("label",{className:"block p-3 border rounded-lg cursor-pointer transition-colors "+(d===e.id?"border-pink-500 bg-pink-50":"border-gray-200 hover:border-gray-300"),children:ve.jsxs("div",{className:"flex items-start justify-between",children:[ve.jsxs("div",{className:"flex-1",children:[ve.jsxs("div",{className:"flex items-center mb-1",children:[ve.jsx("input",{type:"radio",name:"address",checked:d===e.id,onChange:()=>S(e.id),className:"w-4 h-4 text-pink-600 mr-2"}),ve.jsx("span",{className:"font-medium",children:e.name}),e.isDefault&&ve.jsx("span",{className:"ml-2 text-xs bg-green-100 text-green-600 px-2 py-1 rounded-full",children:"Utama"})]}),ve.jsx("p",{className:"text-sm text-gray-600 ml-6",children:e.phone}),ve.jsx("p",{className:"text-sm text-gray-600 ml-6",children:e.fullAddress})]}),ve.jsxs("div",{className:"flex space-x-2",children:[ve.jsx("button",{onClick:t=>{t.stopPropagation(),p(e),l(!0)},className:"text-blue-600 hover:text-blue-700",children:ve.jsx(I,{className:"w-4 h-4"})}),g.length>1&&ve.jsx("button",{onClick:t=>{t.stopPropagation(),(e=>{if(window.confirm("Apakah Anda yakin ingin menghapus alamat ini?")&&(b(e),d===e)){const e=y();e&&S(e.id)}})(e.id)},className:"text-red-600 hover:text-red-700",children:ve.jsx(R,{className:"w-4 h-4"})})]})]})},e.id))}),v.isDropship&&ve.jsxs("div",{className:"border-t pt-4",children:[ve.jsx("h4",{className:"font-medium text-sm text-gray-700 mb-3",children:"Informasi Pengirim (Dropship)"}),ve.jsxs("div",{className:"space-y-3",children:[ve.jsx("input",{type:"text",name:"dropshipName",value:v.dropshipName,onChange:k,className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Nama pengirim dropship"}),ve.jsx("input",{type:"tel",name:"dropshipPhone",value:v.dropshipPhone,onChange:k,className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Nomor telepon pengirim"})]})]})]}),i&&ve.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:ve.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-md w-full max-h-[90vh] overflow-y-auto",children:[ve.jsx("h3",{className:"text-lg font-semibold mb-4",children:m?"Edit Alamat":"Tambah Alamat Baru"}),ve.jsx(Ie,{initialData:m,onSave:e=>{m?f(m.id,e):x(e),l(!1),p(null)},onCancel:()=>{l(!1),p(null)}})]})}),ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsx("h3",{className:"font-semibold mb-3",children:"Kurir Pengiriman"}),ve.jsxs("div",{className:"space-y-4",children:[ve.jsxs("div",{children:[ve.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[ve.jsx(N,{className:"w-4 h-4 inline mr-1"}),"Nama Penerima"]}),ve.jsx("input",{type:"text",name:"name",value:v.name,onChange:k,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Masukkan nama penerima"})]}),ve.jsxs("div",{children:[ve.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[ve.jsx(D,{className:"w-4 h-4 inline mr-1"}),"Nomor Telepon"]}),ve.jsx("input",{type:"tel",name:"phone",value:v.phone,onChange:k,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Masukkan nomor telepon"})]}),ve.jsxs("div",{children:[ve.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[ve.jsx($,{className:"w-4 h-4 inline mr-1"}),"Alamat Lengkap"]}),ve.jsx("textarea",{name:"address",value:v.address,onChange:k,rows:3,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Masukkan alamat lengkap"})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pilih Kurir Pengiriman"}),ve.jsx("select",{name:"shippingCourier",value:v.shippingCourier,onChange:k,className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",children:w.map(e=>ve.jsx("option",{value:e.id,children:e.name},e.id))})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Biaya Ongkos Kirim (Rp)"}),ve.jsx("input",{type:"number",name:"shippingCost",value:v.shippingCost||"",onChange:k,min:"0",className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Masukkan biaya ongkos kirim"}),ve.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"* Masukkan 0 jika gratis ongkir"})]}),ve.jsxs("div",{className:"border-t pt-4",children:[ve.jsxs("label",{className:"flex items-center space-x-3",children:[ve.jsx("input",{type:"checkbox",name:"isDropship",checked:v.isDropship,onChange:k,className:"w-4 h-4 text-pink-600 border-gray-300 rounded focus:ring-pink-500"}),ve.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Kirim sebagai dropship"})]}),v.isDropship&&ve.jsxs("div",{className:"mt-3 space-y-3 pl-7",children:[ve.jsx("input",{type:"text",name:"dropshipName",value:v.dropshipName,onChange:k,className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Nama pengirim dropship"}),ve.jsx("input",{type:"tel",name:"dropshipPhone",value:v.dropshipPhone,onChange:k,className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent",placeholder:"Nomor telepon pengirim"})]})]})]})]}),ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsx("h3",{className:"font-semibold mb-3",children:"Metode Pembayaran"}),ve.jsxs("div",{className:"space-y-3",children:[ve.jsxs("label",{className:"flex items-center space-x-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50",children:[ve.jsx("input",{type:"radio",name:"paymentMethod",value:"transfer",checked:"transfer"===v.paymentMethod,onChange:k,className:"w-4 h-4 text-pink-600"}),ve.jsx(L,{className:"w-5 h-5 text-gray-400"}),ve.jsx("span",{children:"Transfer Bank"})]}),ve.jsxs("label",{className:"flex items-center space-x-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50",children:[ve.jsx("input",{type:"radio",name:"paymentMethod",value:"cash",checked:"cash"===v.paymentMethod,onChange:k,className:"w-4 h-4 text-pink-600"}),ve.jsx(U,{className:"w-5 h-5 text-gray-400"}),ve.jsx("span",{children:"Cash on Delivery (COD)"})]})]})]}),ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsx("h3",{className:"font-semibold mb-3",children:"Ringkasan Pembayaran"}),ve.jsxs("div",{className:"space-y-2 text-sm",children:[ve.jsxs("div",{className:"flex justify-between",children:[ve.jsxs("span",{children:["Subtotal (",e.length," item)"]}),ve.jsxs("span",{children:["Rp ",_.toLocaleString("id-ID")]})]}),ve.jsxs("div",{className:"flex justify-between",children:[ve.jsxs("span",{children:["Ongkos Kirim (",null==(n=w.find(e=>e.id===v.shippingCourier))?void 0:n.name,")"]}),ve.jsxs("span",{children:["Rp ",E.toLocaleString("id-ID")]})]}),ve.jsx("div",{className:"border-t pt-2 mt-2",children:ve.jsxs("div",{className:"flex justify-between font-semibold text-lg",children:[ve.jsx("span",{children:"Total Pembayaran"}),ve.jsxs("span",{className:"text-pink-600",children:["Rp ",C.toLocaleString("id-ID")]})]})})]})]}),ve.jsx("button",{onClick:()=>{if(!v.name||!v.phone||!v.address)return void alert("Mohon lengkapi semua data pengiriman");const e={shippingInfo:{name:v.name,phone:v.phone,address:v.address,isDropship:v.isDropship,dropshipName:v.dropshipName,dropshipPhone:v.dropshipPhone,courier:v.shippingCourier},paymentMethod:v.paymentMethod,notes:v.notes},t=r(e);"transfer"===v.paymentMethod?alert(`ðŸŽ‰ Pesanan berhasil dibuat!\n\nID Pesanan: ${t}\nTotal: Rp ${C.toLocaleString("id-ID")}\n\nSilakan transfer ke:\nâ€¢ BCA: 0511456494\nâ€¢ BRI: 066301000115566\nâ€¢ MANDIRI: 310011008896\n\na.n. Fahrin\n\nKemudian upload bukti pembayaran di menu "Pesanan"`):alert(`ðŸŽ‰ Pesanan berhasil dibuat!\n\nID Pesanan: ${t}\nTotal: Rp ${C.toLocaleString("id-ID")}\n\nPembayaran Cash on Delivery (COD)\nBarang akan dikirim setelah konfirmasi.`),a()},disabled:!v.name||!v.phone||!v.address,className:"w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-4 rounded-lg font-semibold hover:from-pink-600 hover:to-purple-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:"Buat Pesanan"})]})]})},$e=({onSuccess:t,onClose:s})=>{const[r,a]=u.useState("customer"),[n,i]=u.useState(!1),l={customer:{id:"1",name:"Siti Aminah",email:"customer@azzahrafashion.com",role:"customer",points:0},reseller:{id:"2",name:"Fatimah Zahra",email:"reseller@azzahrafashion.com",role:"reseller",points:1250},admin:{id:"3",name:"Admin Azzahra",email:"admin@azzahrafashion.com",role:"admin",points:0},owner:{id:"4",name:"Admin Azzahra",email:"owner@azzahrafashion.com",role:"owner",points:0}};return ve.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:ve.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md relative",children:[ve.jsx("button",{onClick:s,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600",children:ve.jsx(F,{size:24})}),ve.jsxs("div",{className:"text-center mb-6",children:[ve.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Login Demo"}),ve.jsx("p",{className:"text-sm text-gray-600",children:"Pilih role untuk testing"})]}),ve.jsxs("div",{className:"space-y-3 mb-6",children:[ve.jsx("button",{onClick:()=>a("customer"),className:"w-full p-4 border-2 rounded-lg text-left transition-all "+("customer"===r?"border-green-500 bg-green-50":"border-gray-200 hover:border-gray-300"),children:ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center",children:ve.jsx(N,{className:"w-5 h-5 text-green-600"})}),ve.jsxs("div",{className:"flex-1",children:[ve.jsx("h3",{className:"font-semibold text-gray-800",children:"Customer"}),ve.jsx("p",{className:"text-sm text-gray-600",children:"Siti Aminah - Harga Retail"}),ve.jsx("p",{className:"text-xs text-gray-500",children:"customer@azzahrafashion.com"})]}),"customer"===r&&ve.jsx("div",{className:"w-4 h-4 bg-green-500 rounded-full"})]})}),ve.jsx("button",{onClick:()=>a("reseller"),className:"w-full p-4 border-2 rounded-lg text-left transition-all "+("reseller"===r?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),children:ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:ve.jsx(N,{className:"w-5 h-5 text-blue-600"})}),ve.jsxs("div",{className:"flex-1",children:[ve.jsx("h3",{className:"font-semibold text-gray-800",children:"Reseller"}),ve.jsx("p",{className:"text-sm text-gray-600",children:"Fatimah Zahra - Harga Reseller"}),ve.jsx("p",{className:"text-xs text-gray-500",children:"reseller@azzahrafashion.com"}),ve.jsx("p",{className:"text-xs text-blue-600 font-medium",children:"Points: 1,250"})]}),"reseller"===r&&ve.jsx("div",{className:"w-4 h-4 bg-blue-500 rounded-full"})]})}),ve.jsx("button",{onClick:()=>a("admin"),className:"w-full p-4 border-2 rounded-lg text-left transition-all "+("admin"===r?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300"),children:ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center",children:ve.jsx(N,{className:"w-5 h-5 text-purple-600"})}),ve.jsxs("div",{className:"flex-1",children:[ve.jsx("h3",{className:"font-semibold text-gray-800",children:"Admin"}),ve.jsx("p",{className:"text-sm text-gray-600",children:"Admin Azzahra - Limited Access"}),ve.jsx("p",{className:"text-xs text-gray-500",children:"admin@azzahrafashion.com"}),ve.jsx("p",{className:"text-xs text-purple-600 font-medium",children:"Order Management"})]}),"admin"===r&&ve.jsx("div",{className:"w-4 h-4 bg-purple-500 rounded-full"})]})}),ve.jsx("button",{onClick:()=>a("owner"),className:"w-full p-4 border-2 rounded-lg text-left transition-all "+("owner"===r?"border-red-500 bg-red-50":"border-gray-200 hover:border-gray-300"),children:ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-full flex items-center justify-center",children:ve.jsx(N,{className:"w-5 h-5 text-red-600"})}),ve.jsxs("div",{className:"flex-1",children:[ve.jsx("h3",{className:"font-semibold text-gray-800",children:"Owner"}),ve.jsx("p",{className:"text-sm text-gray-600",children:"Owner Azzahra - Full Access"}),ve.jsx("p",{className:"text-xs text-gray-500",children:"owner@azzahrafashion.com"}),ve.jsx("p",{className:"text-xs text-red-600 font-medium",children:"Full Dashboard Access"})]}),"owner"===r&&ve.jsx("div",{className:"w-4 h-4 bg-red-500 rounded-full"})]})})]}),ve.jsx("button",{onClick:()=>{return s=r,d(e,null,function*(){i(!0),yield new Promise(e=>setTimeout(e,1e3)),t(l[s]),i(!1)});var s},disabled:n,className:"w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 px-4 rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed font-semibold transition-all",children:n?"Memproses...":"Login sebagai "+("customer"===r?"Customer":"reseller"===r?"Reseller":"admin"===r?"Admin":"Owner")}),ve.jsx("div",{className:"mt-4 p-3 bg-gray-50 rounded-lg",children:ve.jsxs("p",{className:"text-xs text-gray-600 text-center",children:[ve.jsx("strong",{children:"Demo Mode:"})," Pilih role untuk test fitur berbeda"]})})]})})},Le="azzahra-flashsale",Ue=({user:e,cartItems:t,products:s,loading:r,onProductClick:a,onCartClick:n,onAddToCart:i})=>{const{timeLeft:l}=(()=>{const[e,t]=u.useState(null),[s,r]=u.useState(""),[a,n]=u.useState(!1);return u.useEffect(()=>{if(!a)try{const s=localStorage.getItem(Le);if(s)try{const e=JSON.parse(s);if(!(e&&"object"==typeof e&&"isActive"in e&&"endTime"in e))throw console.warn("âš ï¸ Invalid flash sale config structure, using default"),new Error("Invalid config structure");t(e),console.log("âœ… Flash sale config loaded successfully from localStorage"),console.log("ðŸ“… Flash sale ends at:",e.endTime),console.log("â° Current time:",(new Date).toISOString())}catch(e){throw console.warn("âš ï¸ Failed to parse flash sale config:",e),e}else console.log("ðŸ“ No flash sale config found in localStorage"),console.log("â„¹ï¸ Please create flash sale from admin dashboard first")}catch(e){console.error("ðŸš¨ Error initializing flash sale:",e)}finally{n(!0)}},[a]),u.useEffect(()=>{if(!e||!e.isActive)return;const s=setInterval(()=>{const s=(new Date).getTime(),a=new Date(e.endTime).getTime()-s;if(!(a>0)){console.log("â° Flash sale has ended!"),t(e=>e?c(o({},e),{isActive:!1}):null),localStorage.removeItem(Le);const e=localStorage.getItem("azzahra_products");if(e)try{const t=JSON.parse(e).map(e=>c(o({},e),{isFlashSale:!1,flashSalePrice:void 0,flashSaleDiscount:void 0,originalRetailPrice:e.originalRetailPrice||e.retailPrice,retailPrice:e.originalRetailPrice||e.retailPrice}));localStorage.setItem("azzahra_products",JSON.stringify(t)),console.log("ðŸ§¹ Cleaned flash sale from products:",t.length,"products")}catch(n){console.error("Error cleaning products after flash sale:",n)}return window.dispatchEvent(new CustomEvent("flashSaleEnded",{detail:{timestamp:(new Date).toISOString(),reason:"time_expired"}})),void(window.flashSaleRefreshTimer||(window.flashSaleRefreshTimer=setTimeout(()=>{console.log("ðŸ”„ Auto-refreshing page after flash sale cleanup"),window.location.reload()},2e3)))}{const e=Math.floor(a/864e5),t=Math.floor(a%864e5/36e5),s=Math.floor(a%36e5/6e4),n=Math.floor(a%6e4/1e3);r(e>0?`${e} hari ${t} jam ${s} menit`:t>0?`${t} jam ${s} menit ${n} detik`:`${s} menit ${n} detik`)}},1e3);return()=>clearInterval(s)},[e]),{flashSaleConfig:e,timeLeft:s,isFlashSaleActive:(null==e?void 0:e.isActive)||!1,startFlashSale:e=>{const s=c(o({},e),{isActive:!0});t(s),localStorage.setItem(Le,JSON.stringify(s))},stopFlashSale:()=>{if(e){const s=c(o({},e),{isActive:!1});t(s),localStorage.removeItem(Le)}},isProductInFlashSale:t=>{var s;if(!(null==e?void 0:e.isActive))return!1;const r=e.products.includes(t),a=(null==(s=e.productIds)?void 0:s.includes(t))||!1;return r||a}}})(),[d,h]=u.useState(0);u.useEffect(()=>{const e=e=>{var t;console.log("ðŸ”„ Flash sale ended event received:",e.detail),console.log("ðŸ”„ Updating FlashSalePage..."),h(e=>e+1),"time_expired"===(null==(t=e.detail)?void 0:t.reason)&&(window.flashSaleRefreshTimer&&clearTimeout(window.flashSaleRefreshTimer),window.flashSaleRefreshTimer=setTimeout(()=>{console.log("ðŸ”„ Auto-refreshing FlashSalePage after time expired"),window.location.reload()},3e3))};window.addEventListener("flashSaleEnded",e);const t=()=>{console.log("ðŸ”„ Flash sale updated event received"),h(e=>e+1)};return window.addEventListener("flashSaleUpdated",t),()=>{window.removeEventListener("flashSaleEnded",e),window.removeEventListener("flashSaleUpdated",t)}},[]),u.useEffect(()=>{const e=()=>{try{const e=localStorage.getItem("azzahra-flashsale");if(e){const t=JSON.parse(e);if(t&&t.isActive){const e=(new Date).getTime();e>=new Date(t.endTime).getTime()&&(console.log("â° FlashSalePage: Flash sale ended, triggering cleanup"),window.dispatchEvent(new CustomEvent("flashSaleEnded",{detail:{timestamp:(new Date).toISOString(),reason:"time_expired_page_check",source:"FlashSalePage"}})),localStorage.removeItem("azzahra-flashsale"),t.isActive=!1,h(e=>e+1))}}}catch(e){console.error("Error in FlashSalePage real-time check:",e)}};e();const t=setInterval(e,2e3);return()=>clearInterval(t)},[]),u.useEffect(()=>{const e=e=>{console.log("Products updated in FlashSalePage:",e.detail),h(e=>e+1)};return window.addEventListener("productsUpdated",e),()=>{window.removeEventListener("productsUpdated",e)}},[]);const m=e=>{i(e)},p=u.useMemo(()=>{try{if(!Array.isArray(s)||0===s.length)return console.warn("âš ï¸ FlashSale: Products array is empty or invalid"),[];const t=s.filter(e=>e&&e.id&&e.name);let r;try{const e=localStorage.getItem("azzahra-flashsale");if(r=e?JSON.parse(e):null,r&&r.isActive){const e=(new Date).getTime(),t=new Date(r.endTime).getTime();e<new Date(r.startTime).getTime()?(console.log("â° Flash sale has not started yet"),r.isActive=!1):e>=t&&(console.log("â° Flash sale has ended! Deactivating..."),r.isActive=!1,localStorage.removeItem("azzahra-flashsale"))}}catch(e){console.warn("âš ï¸ Error parsing flash sale config:",e),r=null}return t.filter(t=>{try{if(!t||!t.id)return console.warn("âš ï¸ Invalid product found:",t),!1;let e=!1;if(!0===t.isFlashSale&&(e=!0),r&&!0===r.isActive){const s=Array.isArray(r.products)&&r.products.includes(t.id),a=Array.isArray(r.productIds)&&r.productIds.includes(t.id);(s||a)&&(e=!0)}return e&&console.log(`âœ… Product ${t.name} (${t.id}) is in flash sale`),e}catch(e){return console.warn("âš ï¸ Error checking flash sale for product:",t.id,e),!1}})}catch(t){return console.error("ðŸš¨ Error in flashSaleProducts calculation:",t),[]}},[s,d,l]);return r?ve.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 flex items-center justify-center",children:ve.jsx("div",{className:"text-white text-xl",children:"Loading flash sale products..."})}):0===p.length?ve.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900",children:ve.jsxs("div",{className:"container mx-auto px-4 py-8",children:[ve.jsxs("div",{className:"flex items-center justify-between mb-8",children:[ve.jsx("h1",{className:"text-xl font-bold text-white",children:"Flash Sale âš¡"}),ve.jsxs("button",{onClick:n,className:"relative p-2 bg-white/20 rounded-full hover:bg-white/30 transition-colors",children:[ve.jsx(f,{className:"w-6 h-6 text-white"}),t.length>0&&ve.jsx("span",{className:"absolute -top-2 -right-2 bg-yellow-400 text-gray-800 text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold",children:t.length})]})]}),ve.jsx("div",{className:"text-center py-20",children:ve.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-2xl p-12 max-w-2xl mx-auto",children:[ve.jsx("div",{className:"text-6xl mb-6",children:"âš¡"}),ve.jsx("h2",{className:"text-4xl font-bold text-white mb-4",children:"Flash Sale Segera Hadir!"}),ve.jsx("p",{className:"text-xl text-white/80 mb-8",children:"Tunggu flash sale kami selanjutnya dengan diskon hingga 70%"}),ve.jsx("div",{className:"bg-yellow-400 text-gray-800 px-8 py-4 rounded-full inline-block font-bold text-lg",children:"ðŸ”¥ Coming Soon ðŸ”¥"})]})})]})}):ve.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 pb-20",children:ve.jsxs("div",{className:"container mx-auto px-4 py-8",children:[ve.jsxs("div",{className:"flex items-center justify-between mb-6",children:[ve.jsx("h1",{className:"text-xl font-bold text-white",children:"Flash Sale âš¡"}),ve.jsxs("button",{onClick:n,className:"relative p-2 bg-white/20 rounded-full hover:bg-white/30 transition-colors",children:[ve.jsx(f,{className:"w-6 h-6 text-white"}),t.length>0&&ve.jsx("span",{className:"absolute -top-2 -right-2 bg-yellow-400 text-gray-800 text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold",children:t.length})]})]}),ve.jsxs("div",{className:"bg-gradient-to-r from-red-600 to-orange-600 rounded-2xl p-8 mb-6 text-center relative overflow-hidden",children:[ve.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-yellow-400 rounded-full -mr-16 -mt-16 opacity-20"}),ve.jsx("div",{className:"absolute bottom-0 left-0 w-40 h-40 bg-yellow-400 rounded-full -ml-20 -mb-20 opacity-20"}),ve.jsxs("div",{className:"relative z-10",children:[ve.jsxs("div",{className:"flex items-center justify-center mb-4",children:[ve.jsx(B,{className:"w-12 h-12 text-yellow-300 mr-3"}),ve.jsx("h1",{className:"text-4xl font-bold text-white",children:"FLASH SALE"}),ve.jsx(B,{className:"w-12 h-12 text-yellow-300 ml-3"})]}),ve.jsx("p",{className:"text-xl text-white/90 mb-6",children:"Diskon Hingga 70%"}),l&&ve.jsxs("div",{className:"bg-black/30 backdrop-blur-sm rounded-xl p-4 mb-4",children:[ve.jsx("p",{className:"text-yellow-300 text-sm mb-2",children:"â° Flash Sale Berakhir Dalam"}),ve.jsx("div",{className:"text-3xl font-bold text-white tracking-wider",children:l})]}),ve.jsxs("div",{className:"flex items-center justify-center space-x-4 text-white/80",children:[ve.jsxs("div",{className:"flex items-center",children:[ve.jsx(z,{className:"w-5 h-5 mr-1"}),ve.jsx("span",{className:"text-sm",children:"Terbatas"})]}),ve.jsxs("div",{className:"flex items-center",children:[ve.jsx(M,{className:"w-5 h-5 mr-1"}),ve.jsx("span",{className:"text-sm",children:"Diskon Spesial"})]})]})]})]}),ve.jsxs("div",{className:"text-center text-white/60 text-sm mb-6",children:[p.length," produk flash sale tersedia"]}),ve.jsx("div",{className:"grid grid-cols-2 gap-4",children:p.map(t=>ve.jsx(Pe,{product:t,onProductClick:a,onAddToCart:m,isFlashSale:!0,user:e},t.id))})]})})},Fe=({user:t})=>{const[s,r]=u.useState("all"),[a,n]=u.useState(null),[i,l]=u.useState(!1),[o,c]=u.useState(null),{orders:h,updateOrderPayment:m}=Se(),p=e=>{n(e),l(!0)},g=()=>{l(!1),n(null),c(null)},x=(e,t)=>{navigator.clipboard.writeText(e),alert(`âœ… Nomor rekening ${t} berhasil disalin!\n\n${e}\na.n. Fahrin`)},f=h.filter(e=>e.userId===(null==t?void 0:t.id)),b="all"===s?f:f.filter(e=>e.status===s),y={pending:{label:"Menunggu Pembayaran",icon:W,color:"text-orange-600 bg-orange-100"},awaiting_verification:{label:"Menunggu Verifikasi",icon:W,color:"text-yellow-600 bg-yellow-100"},paid:{label:"Dibayar",icon:q,color:"text-blue-600 bg-blue-100"},processing:{label:"Dikemas",icon:U,color:"text-blue-600 bg-blue-100"},shipped:{label:"Dikirim",icon:J,color:"text-purple-600 bg-purple-100"},delivered:{label:"Selesai",icon:q,color:"text-green-600 bg-green-100"},cancelled:{label:"Dibatalkan",icon:K,color:"text-red-600 bg-red-100"}};return ve.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[ve.jsxs("div",{className:"bg-white shadow-sm sticky top-0 z-10",children:[ve.jsx("div",{className:"p-4",children:ve.jsx("h1",{className:"text-lg font-semibold text-center",children:"Pesanan Saya"})}),ve.jsx("div",{className:"px-4 pb-4",children:ve.jsxs("div",{className:"relative",children:[ve.jsx(k,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),ve.jsx("input",{type:"text",placeholder:"Cari pesanan...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent"})]})}),ve.jsx("div",{className:"flex overflow-x-auto px-4 pb-2",children:[{id:"all",label:"Semua"},{id:"pending",label:"Belum Bayar"},{id:"awaiting_verification",label:"Menunggu Verifikasi"},{id:"processing",label:"Dikemas"},{id:"shipped",label:"Dikirim"},{id:"delivered",label:"Selesai"}].map(e=>ve.jsx("button",{onClick:()=>r(e.id),className:"flex-shrink-0 px-4 py-2 mr-2 rounded-full text-sm font-medium transition-colors "+(s===e.id?"bg-pink-500 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:e.label},e.id))})]}),ve.jsx("div",{className:"p-4 space-y-4",children:0===b.length?ve.jsxs("div",{className:"text-center py-12",children:[ve.jsx(U,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),ve.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"Belum Ada Pesanan"}),ve.jsx("p",{className:"text-gray-500",children:"Pesanan Anda akan muncul di sini"})]}):b.map(e=>{const t=y[e.status],s=t.icon;return ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsxs("div",{className:"flex items-center justify-between mb-3",children:[ve.jsxs("div",{children:[ve.jsxs("p",{className:"font-semibold text-gray-800",children:["#",e.id]}),ve.jsx("p",{className:"text-sm text-gray-500",children:e.createdAt.toLocaleDateString("id-ID")})]}),ve.jsxs("div",{className:`flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium ${t.color}`,children:[ve.jsx(s,{className:"w-3 h-3"}),ve.jsx("span",{children:t.label})]})]}),ve.jsx("div",{className:"space-y-2 mb-3",children:e.items.map((e,t)=>ve.jsxs("div",{className:"flex justify-between text-sm",children:[ve.jsxs("span",{className:"text-gray-600",children:[e.productName," x",e.quantity]}),ve.jsxs("span",{className:"font-medium",children:["Rp ",e.total.toLocaleString("id-ID")]})]},t))}),ve.jsxs("div",{className:"border-t pt-3 flex items-center justify-between",children:[ve.jsx("span",{className:"text-sm text-gray-600",children:"Total Pesanan"}),ve.jsxs("span",{className:"font-bold text-pink-600",children:["Rp ",e.finalTotal.toLocaleString("id-ID")]})]}),ve.jsxs("div",{className:"mt-3 flex space-x-2",children:[ve.jsx("button",{className:"flex-1 bg-gray-100 text-gray-600 py-2 rounded-lg text-sm font-medium hover:bg-gray-200 transition-colors",children:"Detail"}),"pending"===e.status&&"transfer"===e.paymentMethod&&!e.paymentProof&&ve.jsxs("button",{onClick:()=>p(e),className:"flex-1 bg-orange-500 text-white py-2 rounded-lg text-sm font-medium hover:bg-orange-600 transition-colors flex items-center justify-center space-x-1",children:[ve.jsx(L,{className:"w-4 h-4"}),ve.jsx("span",{children:"Bayar"})]}),("pending"===e.status||"awaiting_verification"===e.status)&&e.paymentProof&&ve.jsxs("div",{className:"flex-1 flex space-x-2",children:[ve.jsx("div",{className:"flex-1 bg-yellow-100 text-yellow-700 py-2 rounded-lg text-sm font-medium text-center",children:"â³ Menunggu Verifikasi"}),ve.jsxs("button",{onClick:()=>p(e),className:"px-3 py-2 bg-blue-500 text-white rounded-lg text-sm font-medium hover:bg-blue-600 transition-colors flex items-center space-x-1",children:[ve.jsx(H,{className:"w-3 h-3"}),ve.jsx("span",{children:"Upload Ulang"})]})]}),"paid"===e.status&&ve.jsx("div",{className:"flex-1 bg-blue-100 text-blue-700 py-2 rounded-lg text-sm font-medium text-center",children:"âœ… Pembayaran Terverifikasi"}),"delivered"===e.status&&ve.jsx("button",{className:"flex-1 bg-pink-500 text-white py-2 rounded-lg text-sm font-medium hover:bg-pink-600 transition-colors",children:"Beli Lagi"})]})]},e.id)})}),i&&a&&ve.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:ve.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-md relative max-h-[90vh] overflow-y-auto",children:[ve.jsx("button",{onClick:g,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600",children:ve.jsx(F,{size:24})}),ve.jsxs("div",{className:"text-center mb-6",children:[ve.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-2",children:"Pembayaran"}),ve.jsxs("p",{className:"text-sm text-gray-600",children:["Pesanan #",a.id]}),ve.jsxs("p",{className:"text-lg font-bold text-pink-600 mt-2",children:["Rp ",a.finalTotal.toLocaleString("id-ID")]}),a.paymentProof&&ve.jsxs("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:[ve.jsx("p",{className:"text-yellow-800 text-sm font-medium",children:"ðŸ“„ Upload Ulang Bukti Pembayaran"}),ve.jsxs("p",{className:"text-yellow-600 text-xs mt-1",children:["Bukti sebelumnya: ",a.paymentProof]})]})]}),ve.jsxs("div",{className:"bg-blue-50 rounded-lg p-4 mb-6",children:[ve.jsx("h4",{className:"font-semibold text-blue-800 mb-3",children:"Transfer ke Rekening:"}),ve.jsxs("div",{className:"space-y-3 text-sm",children:[ve.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded-lg border border-blue-200",children:[ve.jsxs("div",{children:[ve.jsx("span",{className:"font-medium text-gray-700",children:"BCA"}),ve.jsx("div",{className:"font-mono text-xs text-gray-600",children:"0511456494"})]}),ve.jsxs("button",{onClick:()=>x("0511456494","BCA"),className:"flex items-center space-x-1 text-blue-600 hover:text-blue-700 text-xs font-medium transition-colors",children:[ve.jsx(V,{className:"w-3 h-3"}),ve.jsx("span",{children:"Salin"})]})]}),ve.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded-lg border border-blue-200",children:[ve.jsxs("div",{children:[ve.jsx("span",{className:"font-medium text-gray-700",children:"BRI"}),ve.jsx("div",{className:"font-mono text-xs text-gray-600",children:"066301000115566"})]}),ve.jsxs("button",{onClick:()=>x("066301000115566","BRI"),className:"flex items-center space-x-1 text-blue-600 hover:text-blue-700 text-xs font-medium transition-colors",children:[ve.jsx(V,{className:"w-3 h-3"}),ve.jsx("span",{children:"Salin"})]})]}),ve.jsxs("div",{className:"flex items-center justify-between p-2 bg-white rounded-lg border border-blue-200",children:[ve.jsxs("div",{children:[ve.jsx("span",{className:"font-medium text-gray-700",children:"MANDIRI"}),ve.jsx("div",{className:"font-mono text-xs text-gray-600",children:"310011008896"})]}),ve.jsxs("button",{onClick:()=>x("310011008896","MANDIRI"),className:"flex items-center space-x-1 text-blue-600 hover:text-blue-700 text-xs font-medium transition-colors",children:[ve.jsx(V,{className:"w-3 h-3"}),ve.jsx("span",{children:"Salin"})]})]}),ve.jsx("div",{className:"text-center mt-3 p-2 bg-blue-100 rounded-lg",children:ve.jsx("p",{className:"text-blue-700 font-semibold text-sm",children:"a.n. Fahrin"})})]})]}),ve.jsxs("div",{className:"mb-6",children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload Bukti Pembayaran"}),ve.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[ve.jsx("input",{type:"file",accept:"image/*",onChange:e=>{e.target.files&&e.target.files[0]&&c(e.target.files[0])},className:"hidden",id:"payment-proof-modal"}),ve.jsxs("label",{htmlFor:"payment-proof-modal",className:"cursor-pointer",children:[ve.jsx(H,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),ve.jsx("p",{className:"text-sm text-gray-600",children:o?o.name:"Klik untuk upload bukti transfer"})]})]})]}),ve.jsx("button",{onClick:()=>d(e,null,function*(){if(a&&o)try{yield m(a.id,o.name,"awaiting_verification"),g();const e=a.paymentProof?"Bukti pembayaran berhasil diupload ulang! Menunggu verifikasi admin.":"Bukti pembayaran berhasil dikirim! Menunggu verifikasi admin.";alert(e)}catch(e){console.error("Error submitting payment:",e)}}),disabled:!o,className:"w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 px-4 rounded-lg hover:from-pink-600 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed font-semibold transition-all",children:(null==a?void 0:a.paymentProof)?"Upload Ulang Bukti Pembayaran":"Kirim Bukti Pembayaran"})]})})]})},Be={},ze=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),s=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));r=Promise.allSettled(t.map(e=>{if((e=function(e){return"/"+e}(e))in Be)return;Be[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const a=document.createElement("link");return a.rel=t?"stylesheet":"modulepreload",t||(a.as="script"),a.crossOrigin="",a.href=e,s&&a.setAttribute("nonce",s),document.head.appendChild(a),t?new Promise((t,s)=>{a.addEventListener("load",t),a.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function a(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then(t=>{for(const e of t||[])"rejected"===e.status&&a(e.reason);return e().catch(a)})};class Me extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class Ke extends Me{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class qe extends Me{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Je extends Me{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var We,He;(He=We||(We={})).Any="any",He.ApNortheast1="ap-northeast-1",He.ApNortheast2="ap-northeast-2",He.ApSouth1="ap-south-1",He.ApSoutheast1="ap-southeast-1",He.ApSoutheast2="ap-southeast-2",He.CaCentral1="ca-central-1",He.EuCentral1="eu-central-1",He.EuWest1="eu-west-1",He.EuWest2="eu-west-2",He.EuWest3="eu-west-3",He.SaEast1="sa-east-1",He.UsEast1="us-east-1",He.UsWest1="us-west-1",He.UsWest2="us-west-2";var Ve=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{o(r.next(e))}catch(t){n(t)}}function l(e){try{o(r.throw(e))}catch(t){n(t)}}function o(e){e.done?a(e.value):function(e){return e instanceof s?e:new s(function(t){t(e)})}(e.value).then(i,l)}o((r=r.apply(e,t||[])).next())})};class Ge{constructor(t,{headers:s={},customFetch:r,region:a=We.Any}={}){this.url=t,this.headers=s,this.region=a,this.fetch=(t=>{let s;return s=t||("undefined"==typeof fetch?(...t)=>ze(()=>d(e,null,function*(){const{default:e}=yield Promise.resolve().then(()=>ot);return{default:e}}),void 0).then(({default:e})=>e(...t)):fetch),(...e)=>s(...e)})(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return Ve(this,arguments,void 0,function*(e,t={}){var s;try{const{headers:r,method:a,body:n,signal:i}=t;let l={},{region:o}=t;o||(o=this.region);const c=new URL(`${this.url}/${e}`);let d;o&&"any"!==o&&(l["x-region"]=o,c.searchParams.set("forceFunctionRegion",o)),n&&(r&&!Object.prototype.hasOwnProperty.call(r,"Content-Type")||!r)&&("undefined"!=typeof Blob&&n instanceof Blob||n instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",d=n):"string"==typeof n?(l["Content-Type"]="text/plain",d=n):"undefined"!=typeof FormData&&n instanceof FormData?d=n:(l["Content-Type"]="application/json",d=JSON.stringify(n)));const u=yield this.fetch(c.toString(),{method:a||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),r),body:d,signal:i}).catch(e=>{if("AbortError"===e.name)throw e;throw new Ke(e)}),h=u.headers.get("x-relay-error");if(h&&"true"===h)throw new qe(u);if(!u.ok)throw new Je(u);let m,p=(null!==(s=u.headers.get("Content-Type"))&&void 0!==s?s:"text/plain").split(";")[0].trim();return m="application/json"===p?yield u.json():"application/octet-stream"===p?yield u.blob():"text/event-stream"===p?u:"multipart/form-data"===p?yield u.formData():yield u.text(),{data:m,error:null,response:u}}catch(r){return r instanceof Error&&"AbortError"===r.name?{data:null,error:new Ke(r)}:{data:null,error:r,response:r instanceof Je||r instanceof qe?r.context:void 0}}})}}var Ye={},Xe={},Qe={},Ze={},et={},tt={},st=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();const rt=st.fetch,at=st.fetch.bind(st),nt=st.Headers,it=st.Request,lt=st.Response,ot=Object.freeze(Object.defineProperty({__proto__:null,Headers:nt,Request:it,Response:lt,default:at,fetch:rt},Symbol.toStringTag,{value:"Module"})),ct=p(ot);var dt={};Object.defineProperty(dt,"__esModule",{value:!0});let ut=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};dt.default=ut;var ht=g&&g.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(tt,"__esModule",{value:!0});const mt=ht(ct),pt=ht(dt);tt.default=class{constructor(e){var t,s;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=null!==(t=e.shouldThrowOnError)&&void 0!==t&&t,this.signal=e.signal,this.isMaybeSingle=null!==(s=e.isMaybeSingle)&&void 0!==s&&s,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=mt.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),"GET"!==this.method&&"HEAD"!==this.method&&this.headers.set("Content-Type","application/json");let s=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(e=>d(this,null,function*(){var t,s,r,a;let n=null,i=null,l=null,o=e.status,c=e.statusText;if(e.ok){if("HEAD"!==this.method){const s=yield e.text();""===s||(i="text/csv"===this.headers.get("Accept")||this.headers.get("Accept")&&(null===(t=this.headers.get("Accept"))||void 0===t?void 0:t.includes("application/vnd.pgrst.plan+text"))?s:JSON.parse(s))}const a=null===(s=this.headers.get("Prefer"))||void 0===s?void 0:s.match(/count=(exact|planned|estimated)/),d=null===(r=e.headers.get("content-range"))||void 0===r?void 0:r.split("/");a&&d&&d.length>1&&(l=parseInt(d[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(i)&&(i.length>1?(n={code:"PGRST116",details:`Results contain ${i.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},i=null,l=null,o=406,c="Not Acceptable"):i=1===i.length?i[0]:null)}else{const t=yield e.text();try{n=JSON.parse(t),Array.isArray(n)&&404===e.status&&(i=[],n=null,o=200,c="OK")}catch(d){404===e.status&&""===t?(o=204,c="No Content"):n={message:t}}if(n&&this.isMaybeSingle&&(null===(a=null==n?void 0:n.details)||void 0===a?void 0:a.includes("0 rows"))&&(n=null,o=200,c="OK"),n&&this.shouldThrowOnError)throw new pt.default(n)}return{error:n,data:i,count:l,status:o,statusText:c}}));return this.shouldThrowOnError||(s=s.catch(e=>{var t,s,r;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(s=null==e?void 0:e.stack)&&void 0!==s?s:""}`,hint:"",code:`${null!==(r=null==e?void 0:e.code)&&void 0!==r?r:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}returns(){return this}overrideTypes(){return this}};var gt=g&&g.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(et,"__esModule",{value:!0});const xt=gt(tt);let ft=class extends xt.default{select(e){let t=!1;const s=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",s),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:r,referencedTable:a=r}={}){const n=a?`${a}.order`:"order",i=this.url.searchParams.get(n);return this.url.searchParams.set(n,`${i?`${i},`:""}${e}.${t?"asc":"desc"}${void 0===s?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const r=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:r=s}={}){const a=void 0===r?"offset":`${r}.offset`,n=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(a,`${e}`),this.url.searchParams.set(n,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return"GET"===this.method?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:r=!1,wal:a=!1,format:n="text"}={}){var i;const l=[e?"analyze":null,t?"verbose":null,s?"settings":null,r?"buffers":null,a?"wal":null].filter(Boolean).join("|"),o=null!==(i=this.headers.get("Accept"))&&void 0!==i?i:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${n}; for="${o}"; options=${l};`),this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};et.default=ft;var bt=g&&g.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ze,"__esModule",{value:!0});const yt=bt(et);let vt=class extends yt.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:r}={}){let a="";"plain"===r?a="pl":"phrase"===r?a="ph":"websearch"===r&&(a="w");const n=void 0===s?"":`(${s})`;return this.url.searchParams.append(e,`${a}fts${n}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const r=s?`${s}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};Ze.default=vt;var jt=g&&g.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Qe,"__esModule",{value:!0});const wt=jt(Ze);Qe.default=class{constructor(e,{headers:t={},schema:s,fetch:r}){this.url=e,this.headers=new Headers(t),this.schema=s,this.fetch=r}select(e,t){const{head:s=!1,count:r}=null!=t?t:{},a=s?"HEAD":"GET";let n=!1;const i=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!n?"":('"'===e&&(n=!n),e)).join("");return this.url.searchParams.set("select",i),r&&this.headers.append("Prefer",`count=${r}`),new wt.default({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:s=!0}={}){var r;if(t&&this.headers.append("Prefer",`count=${t}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new wt.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(r=this.fetch)&&void 0!==r?r:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:r,defaultToNull:a=!0}={}){var n;if(this.headers.append("Prefer",`resolution=${s?"ignore":"merge"}-duplicates`),void 0!==t&&this.url.searchParams.set("on_conflict",t),r&&this.headers.append("Prefer",`count=${r}`),a||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new wt.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(n=this.fetch)&&void 0!==n?n:fetch})}update(e,{count:t}={}){var s;return t&&this.headers.append("Prefer",`count=${t}`),new wt.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:null!==(s=this.fetch)&&void 0!==s?s:fetch})}delete({count:e}={}){var t;return e&&this.headers.append("Prefer",`count=${e}`),new wt.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:null!==(t=this.fetch)&&void 0!==t?t:fetch})}};var Nt=g&&g.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Xe,"__esModule",{value:!0});const kt=Nt(Qe),St=Nt(Ze);Xe.default=class e{constructor(e,{headers:t={},schema:s,fetch:r}={}){this.url=e,this.headers=new Headers(t),this.schemaName=s,this.fetch=r}from(e){const t=new URL(`${this.url}/${e}`);return new kt.default(t,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:r=!1,count:a}={}){var n;let i;const l=new URL(`${this.url}/rpc/${e}`);let o;s||r?(i=s?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{l.searchParams.append(e,t)})):(i="POST",o=t);const c=new Headers(this.headers);return a&&c.set("Prefer",`count=${a}`),new St.default({method:i,url:l,headers:c,schema:this.schemaName,body:o,fetch:null!==(n=this.fetch)&&void 0!==n?n:fetch})}};var _t=g&&g.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.PostgrestError=Ye.PostgrestBuilder=Ye.PostgrestTransformBuilder=Ye.PostgrestFilterBuilder=Ye.PostgrestQueryBuilder=Ye.PostgrestClient=void 0;const Pt=_t(Xe);Ye.PostgrestClient=Pt.default;const Et=_t(Qe);Ye.PostgrestQueryBuilder=Et.default;const Ct=_t(Ze);Ye.PostgrestFilterBuilder=Ct.default;const Tt=_t(et);Ye.PostgrestTransformBuilder=Tt.default;const Ot=_t(tt);Ye.PostgrestBuilder=Ot.default;const At=_t(dt);Ye.PostgrestError=At.default;var Rt=Ye.default={PostgrestClient:Pt.default,PostgrestQueryBuilder:Et.default,PostgrestFilterBuilder:Ct.default,PostgrestTransformBuilder:Tt.default,PostgrestBuilder:Ot.default,PostgrestError:At.default};const{PostgrestClient:It,PostgrestQueryBuilder:Dt,PostgrestFilterBuilder:$t,PostgrestTransformBuilder:Lt,PostgrestBuilder:Ut,PostgrestError:Ft}=Rt;class Bt{static detectEnvironment(){var e;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!=typeof global&&void 0!==global.WebSocket)return{type:"native",constructor:global.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if("undefined"!=typeof process){const e=process.versions;if(e&&e.node){const t=e.node,s=parseInt(t.replace(/^v/,"").split(".")[0]);return s>=22?void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`\n\nSuggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(e){return!1}}}const zt=1e4;var Mt,Kt,qt,Jt,Wt,Ht,Vt,Gt,Yt,Xt,Qt;(Kt=Mt||(Mt={}))[Kt.connecting=0]="connecting",Kt[Kt.open=1]="open",Kt[Kt.closing=2]="closing",Kt[Kt.closed=3]="closed",(Jt=qt||(qt={})).closed="closed",Jt.errored="errored",Jt.joined="joined",Jt.joining="joining",Jt.leaving="leaving",(Ht=Wt||(Wt={})).close="phx_close",Ht.error="phx_error",Ht.join="phx_join",Ht.reply="phx_reply",Ht.leave="phx_leave",Ht.access_token="access_token",(Vt||(Vt={})).websocket="websocket",(Yt=Gt||(Gt={})).Connecting="connecting",Yt.Open="open",Yt.Closing="closing",Yt.Closed="closed";class Zt{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const r=t.getUint8(1),a=t.getUint8(2);let n=this.HEADER_LENGTH+2;const i=s.decode(e.slice(n,n+r));n+=r;const l=s.decode(e.slice(n,n+a));return n+=a,{ref:null,topic:i,event:l,payload:JSON.parse(s.decode(e.slice(n,e.byteLength)))}}}class es{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(Qt=Xt||(Xt={})).abstime="abstime",Qt.bool="bool",Qt.date="date",Qt.daterange="daterange",Qt.float4="float4",Qt.float8="float8",Qt.int2="int2",Qt.int4="int4",Qt.int4range="int4range",Qt.int8="int8",Qt.int8range="int8range",Qt.json="json",Qt.jsonb="jsonb",Qt.money="money",Qt.numeric="numeric",Qt.oid="oid",Qt.reltime="reltime",Qt.text="text",Qt.time="time",Qt.timestamp="timestamp",Qt.timestamptz="timestamptz",Qt.timetz="timetz",Qt.tsrange="tsrange",Qt.tstzrange="tstzrange";const ts=(e,t,s={})=>{var r;const a=null!==(r=s.skipTypes)&&void 0!==r?r:[];return t?Object.keys(t).reduce((s,r)=>(s[r]=ss(r,e,t,a),s),{}):{}},ss=(e,t,s,r)=>{const a=t.find(t=>t.name===e),n=null==a?void 0:a.type,i=s[e];return n&&!r.includes(n)?rs(n,i):as(i)},rs=(e,t)=>{if("_"===e.charAt(0)){const s=e.slice(1,e.length);return os(t,s)}switch(e){case Xt.bool:return ns(t);case Xt.float4:case Xt.float8:case Xt.int2:case Xt.int4:case Xt.int8:case Xt.numeric:case Xt.oid:return is(t);case Xt.json:case Xt.jsonb:return ls(t);case Xt.timestamp:return cs(t);case Xt.abstime:case Xt.date:case Xt.daterange:case Xt.int4range:case Xt.int8range:case Xt.money:case Xt.reltime:case Xt.text:case Xt.time:case Xt.timestamptz:case Xt.timetz:case Xt.tsrange:case Xt.tstzrange:default:return as(t)}},as=e=>e,ns=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},is=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},ls=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},os=(e,t)=>{if("string"!=typeof e)return e;const s=e.length-1,r=e[s];if("{"===e[0]&&"}"===r){let r;const n=e.slice(1,s);try{r=JSON.parse("["+n+"]")}catch(a){r=n?n.split(","):[]}return r.map(e=>rs(t,e))}return e},cs=e=>"string"==typeof e?e.replace(" ","T"):e,ds=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")+"/api/broadcast"};class us{constructor(e,t,s={},r=1e4){this.channel=e,this.event=t,this.payload=s,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t(null===(s=this.receivedResp)||void 0===s?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref),this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout))}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var hs,ms,ps,gs,xs,fs,bs,ys;(ms=hs||(hs={})).SYNC="sync",ms.JOIN="join",ms.LEAVE="leave";class vs{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},e=>{const{onJoin:t,onLeave:s,onSync:r}=this.caller;this.joinRef=this.channel._joinRef(),this.state=vs.syncState(this.state,e,t,s),this.pendingDiffs.forEach(e=>{this.state=vs.syncDiff(this.state,e,t,s)}),this.pendingDiffs=[],r()}),this.channel._on(s.diff,{},e=>{const{onJoin:t,onLeave:s,onSync:r}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=vs.syncDiff(this.state,e,t,s),r())}),this.onJoin((e,t,s)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:s})}),this.onLeave((e,t,s)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:s})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,r){const a=this.cloneDeep(e),n=this.transformState(t),i={},l={};return this.map(a,(e,t)=>{n[e]||(l[e]=t)}),this.map(n,(e,t)=>{const s=a[e];if(s){const r=t.map(e=>e.presence_ref),a=s.map(e=>e.presence_ref),n=t.filter(e=>a.indexOf(e.presence_ref)<0),o=s.filter(e=>r.indexOf(e.presence_ref)<0);n.length>0&&(i[e]=n),o.length>0&&(l[e]=o)}else i[e]=t}),this.syncDiff(a,{joins:i,leaves:l},s,r)}static syncDiff(e,t,s,r){const{joins:a,leaves:n}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),r||(r=()=>{}),this.map(a,(t,r)=>{var a;const n=null!==(a=e[t])&&void 0!==a?a:[];if(e[t]=this.cloneDeep(r),n.length>0){const s=e[t].map(e=>e.presence_ref),r=n.filter(e=>s.indexOf(e.presence_ref)<0);e[t].unshift(...r)}s(t,n,r)}),this.map(n,(t,s)=>{let a=e[t];if(!a)return;const n=s.map(e=>e.presence_ref);a=a.filter(e=>n.indexOf(e.presence_ref)<0),e[t]=a,r(t,a,s),0===a.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const r=e[s];return t[s]="metas"in r?r.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(gs=ps||(ps={})).ALL="*",gs.INSERT="INSERT",gs.UPDATE="UPDATE",gs.DELETE="DELETE",(fs=xs||(xs={})).BROADCAST="broadcast",fs.PRESENCE="presence",fs.POSTGRES_CHANGES="postgres_changes",fs.SYSTEM="system",(ys=bs||(bs={})).SUBSCRIBED="SUBSCRIBED",ys.TIMED_OUT="TIMED_OUT",ys.CLOSED="CLOSED",ys.CHANNEL_ERROR="CHANNEL_ERROR";class js{constructor(e,t={config:{}},s){var r,a;if(this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=qt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new us(this,Wt.join,this.params,this.timeout),this.rejoinTimer=new es(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=qt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=qt.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=qt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=qt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=qt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Wt.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new vs(this),this.broadcastEndpointURL=ds(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(null===(a=null===(r=this.params.config)||void 0===r?void 0:r.broadcast)||void 0===a?void 0:a.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var s,r,a;if(this.socket.isConnected()||this.socket.connect(),this.state==qt.closed){const{config:{broadcast:n,presence:i,private:l}}=this.params,o=null!==(r=null===(s=this.bindings.postgres_changes)||void 0===s?void 0:s.map(e=>e.filter))&&void 0!==r?r:[],c=!!this.bindings[xs.PRESENCE]&&this.bindings[xs.PRESENCE].length>0||!0===(null===(a=this.params.config.presence)||void 0===a?void 0:a.enabled),u={},h={broadcast:n,presence:Object.assign(Object.assign({},i),{enabled:c}),postgres_changes:o,private:l};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this._onError(t=>null==e?void 0:e(bs.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e(bs.CLOSED)),this.updateJoinPayload(Object.assign({config:h},u)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",t=>d(this,[t],function*({postgres_changes:t}){var s;if(this.socket.setAuth(),void 0!==t){const r=this.bindings.postgres_changes,a=null!==(s=null==r?void 0:r.length)&&void 0!==s?s:0,n=[];for(let s=0;s<a;s++){const a=r[s],{filter:{event:i,schema:l,table:o,filter:c}}=a,d=t&&t[s];if(!d||d.event!==i||d.schema!==l||d.table!==o||d.filter!==c)return this.unsubscribe(),this.state=qt.errored,void(null==e||e(bs.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));n.push(Object.assign(Object.assign({},a),{id:d.id}))}return this.bindings.postgres_changes=n,void(e&&e(bs.SUBSCRIBED))}null==e||e(bs.SUBSCRIBED)})).receive("error",t=>{this.state=qt.errored,null==e||e(bs.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null==e||e(bs.TIMED_OUT)})}return this}presenceState(){return this.presence.state}track(e){return d(this,arguments,function*(e,t={}){return yield this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)})}untrack(){return d(this,arguments,function*(e={}){return yield this.send({type:"presence",event:"untrack"},e)})}on(e,t,s){return this.state===qt.joined&&e===xs.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,s)}send(e){return d(this,arguments,function*(e,t={}){var s,r;if(this._canPush()||"broadcast"!==e.type)return new Promise(s=>{var r,a,n;const i=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(n=null===(a=null===(r=this.params)||void 0===r?void 0:r.config)||void 0===a?void 0:a.broadcast)||void 0===n?void 0:n.ack)||s("ok"),i.receive("ok",()=>s("ok")),i.receive("error",()=>s("error")),i.receive("timeout",()=>s("timed out"))});{const{event:n,payload:i}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:i,private:this.private}]})};try{const e=yield this._fetchWithTimeout(this.broadcastEndpointURL,l,null!==(s=t.timeout)&&void 0!==s?s:this.timeout);return yield null===(r=e.body)||void 0===r?void 0:r.cancel(),e.ok?"ok":"error"}catch(a){return"AbortError"===a.name?"timed out":"error"}}})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=qt.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Wt.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(r=>{s=new us(this,Wt.leave,{},e),s.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{null==s||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=qt.closed,this.bindings={}}_fetchWithTimeout(e,t,s){return d(this,null,function*(){const r=new AbortController,a=setTimeout(()=>r.abort(),s),n=yield this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(a),n})}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new us(this,e,t,s);return this._canPush()?r.send():this._addToPushBuffer(r),r}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var r,a;const n=e.toLocaleLowerCase(),{close:i,error:l,leave:o,join:c}=Wt;if(s&&[i,l,o,c].indexOf(n)>=0&&s!==this._joinRef())return;let d=this._onMessage(n,t,s);if(t&&!d)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(n)?null===(r=this.bindings.postgres_changes)||void 0===r||r.filter(e=>{var t,s,r;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(r=null===(s=e.filter)||void 0===s?void 0:s.event)||void 0===r?void 0:r.toLocaleLowerCase())===n}).map(e=>e.callback(d,s)):null===(a=this.bindings[n])||void 0===a||a.filter(e=>{var s,r,a,i,l,o;if(["broadcast","presence","postgres_changes"].includes(n)){if("id"in e){const n=e.id,i=null===(s=e.filter)||void 0===s?void 0:s.event;return n&&(null===(r=t.ids)||void 0===r?void 0:r.includes(n))&&("*"===i||(null==i?void 0:i.toLocaleLowerCase())===(null===(a=t.data)||void 0===a?void 0:a.type.toLocaleLowerCase()))}{const s=null===(l=null===(i=null==e?void 0:e.filter)||void 0===i?void 0:i.event)||void 0===l?void 0:l.toLocaleLowerCase();return"*"===s||s===(null===(o=null==t?void 0:t.event)||void 0===o?void 0:o.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===n}).map(e=>{if("object"==typeof d&&"ids"in d){const e=d.data,{schema:t,table:s,commit_timestamp:r,type:a,errors:n}=e,i={schema:t,table:s,commit_timestamp:r,eventType:a,new:{},old:{},errors:n};d=Object.assign(Object.assign({},i),this._getPayloadRecords(e))}e.callback(d,s)})}_isClosed(){return this.state===qt.closed}_isJoined(){return this.state===qt.joined}_isJoining(){return this.state===qt.joining}_isLeaving(){return this.state===qt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const r=e.toLocaleLowerCase(),a={type:r,filter:t,callback:s};return this.bindings[r]?this.bindings[r].push(a):this.bindings[r]=[a],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(e=>{var r;return!((null===(r=e.type)||void 0===r?void 0:r.toLocaleLowerCase())===s&&js.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Wt.close,{},e)}_onError(e){this._on(Wt.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=qt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=ts(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=ts(e.columns,e.old_record)),t}}const ws=()=>{},Ns=25e3,ks=10,Ss=100,_s=[1e3,2e3,5e3,1e4];class Ps{constructor(e,t){var s;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=zt,this.transport=null,this.heartbeatIntervalMs=Ns,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=ws,this.ref=0,this.reconnectTimer=null,this.logger=ws,this.conn=null,this.sendBuffer=[],this.serializer=new Zt,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>ze(()=>d(this,null,function*(){const{default:e}=yield Promise.resolve().then(()=>ot);return{default:e}}),void 0).then(({default:t})=>t(...e)).catch(e=>{throw new Error(`Failed to load @supabase/node-fetch: ${e.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):fetch),(...e)=>t(...e)},!(null===(s=null==t?void 0:t.params)||void 0===s?void 0:s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${Vt.websocket}`,this.httpEndpoint=ds(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null==t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=Bt.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;if(t.includes("Node.js"))throw new Error(`${t}\n\nTo use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })`);throw new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}removeChannel(e){return d(this,null,function*(){const t=yield e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t})}removeAllChannels(){return d(this,null,function*(){const e=yield Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e})}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case Mt.connecting:return Gt.Connecting;case Mt.open:return Gt.Open;case Mt.closing:return Gt.Closing;default:return Gt.Closed}}isConnected(){return this.connectionState()===Gt.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e,t={config:{}}){const s=`realtime:${e}`,r=this.getChannels().find(e=>e.topic===s);if(r)return r;{const s=new js(`realtime:${e}`,t,this);return this.channels.push(s),s}}push(e){const{topic:t,event:s,payload:r,ref:a}=e,n=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push",`${t} ${s} (${a})`,r),this.isConnected()?n():this.sendBuffer.push(n)}setAuth(e=null){return d(this,null,function*(){this._authPromise=this._performAuth(e);try{yield this._authPromise}finally{this._authPromise=null}})}sendHeartbeat(){return d(this,null,function*(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}return this._wasManualDisconnect=!1,null===(e=this.conn)||void 0===e||e.close(1e3,"heartbeat timeout"),void setTimeout(()=>{var e;this.isConnected()||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout()},Ss)}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}else try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}})}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{if("phoenix"===e.topic&&"phx_reply"===e.event)try{this.heartbeatCallback("ok"===e.payload.status?"ok":"error")}catch(l){this.log("error","error in heartbeat callback",l)}e.ref&&e.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:t,event:s,payload:r,ref:a}=e,n=a?`(${a})`:"",i=r.status||"";this.log("receive",`${i} ${t} ${s} ${n}`.trim(),r),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(s,r,a)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null===(t=this.reconnectTimer)||void 0===t||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Wt.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const s=e.match(/\?/)?"&":"?";return`${e}${s}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e,t=!1){this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}_performAuth(e=null){return d(this,null,function*(){let t;t=e||(this.accessToken?yield this.accessToken():this.accessTokenValue),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(e=>{const s={access_token:t,version:"realtime-js/2.75.1"};t&&e.updateJoinPayload(s),e.joinedOnce&&e._isJoined()&&e._push(Wt.access_token,{access_token:t})}))})}_waitForAuthIfNeeded(){return d(this,null,function*(){this._authPromise&&(yield this._authPromise)})}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(t)}catch(r){this.log("error",`error in ${e} callback`,r)}})}catch(s){this.log("error",`error triggering ${e} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new es(()=>d(this,null,function*(){setTimeout(()=>d(this,null,function*(){yield this._waitForAuthIfNeeded(),this.isConnected()||this.connect()}),ks)}),this.reconnectAfterMs)}_initializeOptions(e){var t,s,r,a,n,i,l,o,c;if(this.transport=null!==(t=null==e?void 0:e.transport)&&void 0!==t?t:null,this.timeout=null!==(s=null==e?void 0:e.timeout)&&void 0!==s?s:zt,this.heartbeatIntervalMs=null!==(r=null==e?void 0:e.heartbeatIntervalMs)&&void 0!==r?r:Ns,this.worker=null!==(a=null==e?void 0:e.worker)&&void 0!==a&&a,this.accessToken=null!==(n=null==e?void 0:e.accessToken)&&void 0!==n?n:null,this.heartbeatCallback=null!==(i=null==e?void 0:e.heartbeatCallback)&&void 0!==i?i:ws,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.logger)&&(this.logger=e.logger),((null==e?void 0:e.logLevel)||(null==e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(l=null==e?void 0:e.reconnectAfterMs)&&void 0!==l?l:e=>_s[e-1]||1e4,this.encode=null!==(o=null==e?void 0:e.encode)&&void 0!==o?o:(e,t)=>t(JSON.stringify(e)),this.decode=null!==(c=null==e?void 0:e.decode)&&void 0!==c?c:this.serializer.decode.bind(this.serializer),this.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=null==e?void 0:e.workerUrl}}}class Es extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Cs(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class Ts extends Es{constructor(e,t,s){super(e),this.name="StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Os extends Es{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var As=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{o(r.next(e))}catch(t){n(t)}}function l(e){try{o(r.throw(e))}catch(t){n(t)}}function o(e){e.done?a(e.value):function(e){return e instanceof s?e:new s(function(t){t(e)})}(e.value).then(i,l)}o((r=r.apply(e,t||[])).next())})};const Rs=t=>{let s;return s=t||("undefined"==typeof fetch?(...t)=>ze(()=>d(e,null,function*(){const{default:e}=yield Promise.resolve().then(()=>ot);return{default:e}}),void 0).then(({default:e})=>e(...t)):fetch),(...e)=>s(...e)},Is=e=>{if(Array.isArray(e))return e.map(e=>Is(e));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([e,s])=>{const r=e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[r]=Is(s)}),t};var Ds=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{o(r.next(e))}catch(t){n(t)}}function l(e){try{o(r.throw(e))}catch(t){n(t)}}function o(e){e.done?a(e.value):function(e){return e instanceof s?e:new s(function(t){t(e)})}(e.value).then(i,l)}o((r=r.apply(e,t||[])).next())})};const $s=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Ls=(e,t,s)=>Ds(void 0,void 0,void 0,function*(){const r=yield As(void 0,void 0,void 0,function*(){return"undefined"==typeof Response?(yield ze(()=>Promise.resolve().then(()=>ot),void 0)).Response:Response});e instanceof r&&!(null==s?void 0:s.noResolveJson)?e.json().then(s=>{const r=e.status||500,a=(null==s?void 0:s.statusCode)||r+"";t(new Ts($s(s),r,a))}).catch(e=>{t(new Os($s(e),e))}):t(new Os($s(e),e))}),Us=(e,t,s,r)=>{const a={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"!==e&&r?((e=>{if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)})(r)?(a.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),a.body=JSON.stringify(r)):a.body=r,(null==t?void 0:t.duplex)&&(a.duplex=t.duplex),Object.assign(Object.assign({},a),s)):a};function Fs(e,t,s,r,a,n){return Ds(this,void 0,void 0,function*(){return new Promise((i,l)=>{e(s,Us(t,r,a,n)).then(e=>{if(!e.ok)throw e;return(null==r?void 0:r.noResolveJson)?e:e.json()}).then(e=>i(e)).catch(e=>Ls(e,l,r))})})}function Bs(e,t,s,r){return Ds(this,void 0,void 0,function*(){return Fs(e,"GET",t,s,r)})}function zs(e,t,s,r,a){return Ds(this,void 0,void 0,function*(){return Fs(e,"POST",t,r,a,s)})}function Ms(e,t,s,r,a){return Ds(this,void 0,void 0,function*(){return Fs(e,"PUT",t,r,a,s)})}function Ks(e,t,s,r,a){return Ds(this,void 0,void 0,function*(){return Fs(e,"DELETE",t,r,a,s)})}var qs=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{o(r.next(e))}catch(t){n(t)}}function l(e){try{o(r.throw(e))}catch(t){n(t)}}function o(e){e.done?a(e.value):function(e){return e instanceof s?e:new s(function(t){t(e)})}(e.value).then(i,l)}o((r=r.apply(e,t||[])).next())})};class Js{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return qs(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Cs(e))return{data:null,error:e};throw e}})}}var Ws,Hs=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{o(r.next(e))}catch(t){n(t)}}function l(e){try{o(r.throw(e))}catch(t){n(t)}}function o(e){e.done?a(e.value):function(e){return e instanceof s?e:new s(function(t){t(e)})}(e.value).then(i,l)}o((r=r.apply(e,t||[])).next())})};class Vs{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t,this[Ws]="BlobDownloadBuilder",this.promise=null}asStream(){return new Js(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.getPromise().then(e,t)}catch(e){return this.getPromise().catch(e)}finally(e){return this.getPromise().finally(e)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}execute(){return Hs(this,void 0,void 0,function*(){try{const e=yield this.downloadFn();return{data:yield e.blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Cs(e))return{data:null,error:e};throw e}})}}Ws=Symbol.toStringTag;var Gs=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{o(r.next(e))}catch(t){n(t)}}function l(e){try{o(r.throw(e))}catch(t){n(t)}}function o(e){e.done?a(e.value):function(e){return e instanceof s?e:new s(function(t){t(e)})}(e.value).then(i,l)}o((r=r.apply(e,t||[])).next())})};const Ys={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Xs={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Qs{constructor(e,t={},s,r){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=s,this.fetch=Rs(r)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,s,r){return Gs(this,void 0,void 0,function*(){try{let a;const n=Object.assign(Object.assign({},Xs),r);let i=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(n.upsert)});const l=n.metadata;"undefined"!=typeof Blob&&s instanceof Blob?(a=new FormData,a.append("cacheControl",n.cacheControl),l&&a.append("metadata",this.encodeMetadata(l)),a.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(a=s,a.append("cacheControl",n.cacheControl),l&&a.append("metadata",this.encodeMetadata(l))):(a=s,i["cache-control"]=`max-age=${n.cacheControl}`,i["content-type"]=n.contentType,l&&(i["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),(null==r?void 0:r.headers)&&(i=Object.assign(Object.assign({},i),r.headers));const o=this._removeEmptyFolders(t),c=this._getFinalPath(o),d=yield("PUT"==e?Ms:zs)(this.fetch,`${this.url}/object/${c}`,a,Object.assign({headers:i},(null==n?void 0:n.duplex)?{duplex:n.duplex}:{}));return{data:{path:o,id:d.Id,fullPath:d.Key},error:null}}catch(a){if(this.shouldThrowOnError)throw a;if(Cs(a))return{data:null,error:a};throw a}})}upload(e,t,s){return Gs(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,r){return Gs(this,void 0,void 0,function*(){const a=this._removeEmptyFolders(e),n=this._getFinalPath(a),i=new URL(this.url+`/object/upload/sign/${n}`);i.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:Xs.upsert},r),n=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});return"undefined"!=typeof Blob&&s instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(e=s,e.append("cacheControl",t.cacheControl)):(e=s,n["cache-control"]=`max-age=${t.cacheControl}`,n["content-type"]=t.contentType),{data:{path:a,fullPath:(yield Ms(this.fetch,i.toString(),e,{headers:n})).Key},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(Cs(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return Gs(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const r=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(r["x-upsert"]="true");const a=yield zs(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:r}),n=new URL(this.url+a.url),i=n.searchParams.get("token");if(!i)throw new Es("No token returned by API");return{data:{signedUrl:n.toString(),path:e,token:i},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Cs(s))return{data:null,error:s};throw s}})}update(e,t,s){return Gs(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return Gs(this,void 0,void 0,function*(){try{return{data:yield zs(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Cs(r))return{data:null,error:r};throw r}})}copy(e,t,s){return Gs(this,void 0,void 0,function*(){try{return{data:{path:(yield zs(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Cs(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,s){return Gs(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),a=yield zs(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:t},(null==s?void 0:s.transform)?{transform:s.transform}:{}),{headers:this.headers});const n=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return a={signedUrl:encodeURI(`${this.url}${a.signedURL}${n}`)},{data:a,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Cs(r))return{data:null,error:r};throw r}})}createSignedUrls(e,t,s){return Gs(this,void 0,void 0,function*(){try{const r=yield zs(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),a=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return{data:r.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${a}`):null})),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Cs(r))return{data:null,error:r};throw r}})}download(e,t){const s=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",r=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),a=r?`?${r}`:"",n=this._getFinalPath(e);return new Vs(()=>Bs(this.fetch,`${this.url}/${s}/${n}${a}`,{headers:this.headers,noResolveJson:!0}),this.shouldThrowOnError)}info(e){return Gs(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const e=yield Bs(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Is(e),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Cs(s))return{data:null,error:s};throw s}})}exists(e){return Gs(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield function(e,t,s,r){return Ds(this,void 0,void 0,function*(){return Fs(e,"HEAD",t,Object.assign(Object.assign({},s),{noResolveJson:!0}),r)})}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Cs(s)&&s instanceof Os){const e=s.originalError;if([400,404].includes(null==e?void 0:e.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),r=[],a=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==a&&r.push(a);const n=void 0!==(null==t?void 0:t.transform)?"render/image":"object",i=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==i&&r.push(i);let l=r.join("&");return""!==l&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${n}/public/${s}${l}`)}}}remove(e){return Gs(this,void 0,void 0,function*(){try{return{data:yield Ks(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Cs(t))return{data:null,error:t};throw t}})}list(e,t,s){return Gs(this,void 0,void 0,function*(){try{const r=Object.assign(Object.assign(Object.assign({},Ys),t),{prefix:e||""});return{data:yield zs(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},s),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(Cs(r))return{data:null,error:r};throw r}})}listV2(e,t){return Gs(this,void 0,void 0,function*(){try{const s=Object.assign({},e);return{data:yield zs(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,s,{headers:this.headers},t),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Cs(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Zs={"X-Client-Info":"storage-js/2.75.1"};var er=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{o(r.next(e))}catch(t){n(t)}}function l(e){try{o(r.throw(e))}catch(t){n(t)}}function o(e){e.done?a(e.value):function(e){return e instanceof s?e:new s(function(t){t(e)})}(e.value).then(i,l)}o((r=r.apply(e,t||[])).next())})};class tr{constructor(e,t={},s,r){this.shouldThrowOnError=!1;const a=new URL(e);(null==r?void 0:r.useNewHostname)&&/supabase\.(co|in|red)$/.test(a.hostname)&&!a.hostname.includes("storage.supabase.")&&(a.hostname=a.hostname.replace("supabase.","storage.supabase.")),this.url=a.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},Zs),t),this.fetch=Rs(s)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return er(this,void 0,void 0,function*(){try{return{data:yield Bs(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(Cs(e))return{data:null,error:e};throw e}})}getBucket(e){return er(this,void 0,void 0,function*(){try{return{data:yield Bs(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Cs(t))return{data:null,error:t};throw t}})}createBucket(e){return er(this,arguments,void 0,function*(e,t={public:!1}){try{return{data:yield zs(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Cs(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return er(this,void 0,void 0,function*(){try{return{data:yield Ms(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(Cs(s))return{data:null,error:s};throw s}})}emptyBucket(e){return er(this,void 0,void 0,function*(){try{return{data:yield zs(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Cs(t))return{data:null,error:t};throw t}})}deleteBucket(e){return er(this,void 0,void 0,function*(){try{return{data:yield Ks(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(Cs(t))return{data:null,error:t};throw t}})}}class sr extends tr{constructor(e,t={},s,r){super(e,t,s,r)}from(e){return new Qs(this.url,this.headers,e,this.fetch)}}let rr="";rr="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const ar={headers:{"X-Client-Info":`supabase-js-${rr}/2.75.1`}},nr={schema:"public"},ir={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},lr={};var or=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{o(r.next(e))}catch(t){n(t)}}function l(e){try{o(r.throw(e))}catch(t){n(t)}}function o(e){e.done?a(e.value):function(e){return e instanceof s?e:new s(function(t){t(e)})}(e.value).then(i,l)}o((r=r.apply(e,t||[])).next())})};const cr=(e,t,s)=>{const r=(e=>{let t;return t=e||("undefined"==typeof fetch?at:fetch),(...e)=>t(...e)})(s),a="undefined"==typeof Headers?nt:Headers;return(s,n)=>or(void 0,void 0,void 0,function*(){var i;const l=null!==(i=yield t())&&void 0!==i?i:e;let o=new a(null==n?void 0:n.headers);return o.has("apikey")||o.set("apikey",e),o.has("Authorization")||o.set("Authorization",`Bearer ${l}`),r(s,Object.assign(Object.assign({},n),{headers:o}))})};var dr=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{o(r.next(e))}catch(t){n(t)}}function l(e){try{o(r.throw(e))}catch(t){n(t)}}function o(e){e.done?a(e.value):function(e){return e instanceof s?e:new s(function(t){t(e)})}(e.value).then(i,l)}o((r=r.apply(e,t||[])).next())})};const ur="2.75.1",hr=3e4,mr=9e4,pr={"X-Client-Info":`gotrue-js/${ur}`},gr="X-Supabase-Api-Version",xr={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},fr=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class br extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function yr(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class vr extends br{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}class jr extends br{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class wr extends br{constructor(e,t,s,r){super(e,s,r),this.name=t,this.status=s}}class Nr extends wr{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class kr extends wr{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Sr extends wr{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class _r extends wr{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Pr extends wr{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Er extends wr{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Cr(e){return yr(e)&&"AuthRetryableFetchError"===e.name}class Tr extends wr{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class Or extends wr{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Ar="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Rr=" \t\n\r=".split(""),Ir=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<Rr.length;t+=1)e[Rr[t].charCodeAt(0)]=-2;for(let t=0;t<Ar.length;t+=1)e[Ar[t].charCodeAt(0)]=t;return e})();function Dr(e,t,s){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(Ar[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(Ar[e]),t.queuedBits-=6}}function $r(e,t,s){const r=Ir[e];if(!(r>-1)){if(-2===r)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function Lr(e){const t=[],s=e=>{t.push(String.fromCodePoint(e))},r={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},n=e=>{!function(e,t,s){if(0===t.utf8seq){if(e<=127)return void s(e);for(let s=1;s<6;s+=1)if(!(e>>7-s&1)){t.utf8seq=s;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&s(t.codepoint)}}(e,r,s)};for(let i=0;i<e.length;i+=1)$r(e.charCodeAt(i),a,n);return t.join("")}function Ur(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}t(e)}function Fr(e){const t=[],s={queue:0,queuedBits:0},r=e=>{t.push(e)};for(let a=0;a<e.length;a+=1)$r(e.charCodeAt(a),s,r);return new Uint8Array(t)}function Br(e){const t=[];return function(e,t){for(let s=0;s<e.length;s+=1){let r=e.charCodeAt(s);if(r>55295&&r<=56319){const t=1024*(r-55296)&65535;r=65536+(e.charCodeAt(s+1)-56320&65535|t),s+=1}Ur(r,t)}}(e,e=>t.push(e)),new Uint8Array(t)}function zr(e){const t=[],s={queue:0,queuedBits:0},r=e=>{t.push(e)};return e.forEach(e=>Dr(e,s,r)),Dr(null,s,r),t.join("")}const Mr=()=>"undefined"!=typeof window&&"undefined"!=typeof document,Kr={tested:!1,writable:!1},qr=()=>{if(!Mr())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(t){return!1}if(Kr.tested)return Kr.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Kr.tested=!0,Kr.writable=!0}catch(t){Kr.tested=!0,Kr.writable=!1}return Kr.writable},Jr=t=>{let s;return s=t||("undefined"==typeof fetch?(...t)=>ze(()=>d(e,null,function*(){const{default:e}=yield Promise.resolve().then(()=>ot);return{default:e}}),void 0).then(({default:e})=>e(...t)):fetch),(...e)=>s(...e)},Wr=(t,s,r)=>d(e,null,function*(){yield t.setItem(s,JSON.stringify(r))}),Hr=(t,s)=>d(e,null,function*(){const e=yield t.getItem(s);if(!e)return null;try{return JSON.parse(e)}catch(r){return e}}),Vr=(t,s)=>d(e,null,function*(){yield t.removeItem(s)});class Gr{constructor(){this.promise=new Gr.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function Yr(e){const t=e.split(".");if(3!==t.length)throw new Or("Invalid JWT structure");for(let s=0;s<t.length;s++)if(!fr.test(t[s]))throw new Or("JWT not in base64url format");return{header:JSON.parse(Lr(t[0])),payload:JSON.parse(Lr(t[1])),signature:Fr(t[2]),raw:{header:t[0],payload:t[1]}}}function Xr(e){return("0"+e.toString(16)).substr(-2)}function Qr(e){return d(this,null,function*(){if("undefined"==typeof crypto||void 0===crypto.subtle||"undefined"==typeof TextEncoder)return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=yield function(e){return d(this,null,function*(){const t=(new TextEncoder).encode(e),s=yield crypto.subtle.digest("SHA-256",t),r=new Uint8Array(s);return Array.from(r).map(e=>String.fromCharCode(e)).join("")})}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")})}function Zr(e,t,s=!1){return d(this,null,function*(){const r=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let s="";for(let r=0;r<56;r++)s+=e.charAt(Math.floor(Math.random()*t));return s}return crypto.getRandomValues(e),Array.from(e,Xr).join("")}();let a=r;s&&(a+="/PASSWORD_RECOVERY"),yield Wr(e,`${t}-code-verifier`,a);const n=yield Qr(r);return[n,r===n?"plain":"s256"]})}Gr.promiseConstructor=Promise;const ea=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i,ta=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function sa(e){if(!ta.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function ra(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"==typeof t){const e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function aa(e){return JSON.parse(JSON.stringify(e))}const na=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),ia=[502,503,504];function la(e){return d(this,null,function*(){var t,s;if(!("object"==typeof(s=e)&&null!==s&&"status"in s&&"ok"in s&&"json"in s&&"function"==typeof s.json))throw new Er(na(e),0);if(ia.includes(e.status))throw new Er(na(e),e.status);let r,a;try{r=yield e.json()}catch(i){throw new jr(na(i),i)}const n=function(e){const t=e.headers.get(gr);if(!t)return null;if(!t.match(ea))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(i){return null}}(e);if(n&&n.getTime()>=xr.timestamp&&"object"==typeof r&&r&&"string"==typeof r.code?a=r.code:"object"==typeof r&&r&&"string"==typeof r.error_code&&(a=r.error_code),a){if("weak_password"===a)throw new Tr(na(r),e.status,(null===(t=r.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===a)throw new Nr}else if("object"==typeof r&&r&&"object"==typeof r.weak_password&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0))throw new Tr(na(r),e.status,r.weak_password.reasons);throw new vr(na(r),e.status||500,a)})}function oa(e,t,s,r){return d(this,null,function*(){var a;const n=Object.assign({},null==r?void 0:r.headers);n[gr]||(n[gr]=xr.name),(null==r?void 0:r.jwt)&&(n.Authorization=`Bearer ${r.jwt}`);const i=null!==(a=null==r?void 0:r.query)&&void 0!==a?a:{};(null==r?void 0:r.redirectTo)&&(i.redirect_to=r.redirectTo);const l=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",o=yield function(e,t,s,r,a,n){return d(this,null,function*(){const i=((e,t,s,r)=>{const a={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),a.body=JSON.stringify(r),Object.assign(Object.assign({},a),s))})(t,r,a,n);let l;try{l=yield e(s,Object.assign({},i))}catch(o){throw console.error(o),new Er(na(o),0)}if(l.ok||(yield la(l)),null==r?void 0:r.noResolveJson)return l;try{return yield l.json()}catch(o){yield la(o)}})}(e,t,s+l,{headers:n,noResolveJson:null==r?void 0:r.noResolveJson},{},null==r?void 0:r.body);return(null==r?void 0:r.xform)?null==r?void 0:r.xform(o):{data:Object.assign({},o),error:null}})}function ca(e){var t;let s=null;var r;return function(e){return e.access_token&&e.refresh_token&&e.expires_in}(e)&&(s=Object.assign({},e),e.expires_at||(s.expires_at=(r=e.expires_in,Math.round(Date.now()/1e3)+r))),{data:{session:s,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function da(e){const t=ca(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function ua(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function ha(e){return{data:e,error:null}}function ma(e){const{action_link:t,email_otp:s,hashed_token:r,redirect_to:a,verification_type:n}=e,i=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(s[r[a]]=e[r[a]])}return s}(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:s,hashed_token:r,redirect_to:a,verification_type:n},user:Object.assign({},i)},error:null}}function pa(e){return e}const ga=["global","local","others"];class xa{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Jr(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}signOut(e){return d(this,arguments,function*(e,t=ga[0]){if(ga.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${ga.join(", ")}`);try{return yield oa(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(yr(s))return{data:null,error:s};throw s}})}inviteUserByEmail(e){return d(this,arguments,function*(e,t={}){try{return yield oa(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:ua})}catch(s){if(yr(s))return{data:{user:null},error:s};throw s}})}generateLink(e){return d(this,null,function*(){try{const{options:t}=e,s=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(s[r[a]]=e[r[a]])}return s}(e,["options"]),r=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(r.new_email=null==s?void 0:s.newEmail,delete r.newEmail),yield oa(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:ma,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(yr(t))return{data:{properties:null,user:null},error:t};throw t}})}createUser(e){return d(this,null,function*(){try{return yield oa(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ua})}catch(t){if(yr(t))return{data:{user:null},error:t};throw t}})}listUsers(e){return d(this,null,function*(){var t,s,r,a,n,i,l;try{const o={nextPage:null,lastPage:0,total:0},c=yield oa(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(s=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==s?s:"",per_page:null!==(a=null===(r=null==e?void 0:e.perPage)||void 0===r?void 0:r.toString())&&void 0!==a?a:""},xform:pa});if(c.error)throw c.error;const d=yield c.json(),u=null!==(n=c.headers.get("x-total-count"))&&void 0!==n?n:0,h=null!==(l=null===(i=c.headers.get("link"))||void 0===i?void 0:i.split(","))&&void 0!==l?l:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),s=JSON.parse(e.split(";")[1].split("=")[1]);o[`${s}Page`]=t}),o.total=parseInt(u)),{data:Object.assign(Object.assign({},d),o),error:null}}catch(o){if(yr(o))return{data:{users:[]},error:o};throw o}})}getUserById(e){return d(this,null,function*(){sa(e);try{return yield oa(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ua})}catch(t){if(yr(t))return{data:{user:null},error:t};throw t}})}updateUserById(e,t){return d(this,null,function*(){sa(e);try{return yield oa(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:ua})}catch(s){if(yr(s))return{data:{user:null},error:s};throw s}})}deleteUser(e,t=!1){return d(this,null,function*(){sa(e);try{return yield oa(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:ua})}catch(s){if(yr(s))return{data:{user:null},error:s};throw s}})}_listFactors(e){return d(this,null,function*(){sa(e.userId);try{const{data:t,error:s}=yield oa(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:s}}catch(t){if(yr(t))return{data:null,error:t};throw t}})}_deleteFactor(e){return d(this,null,function*(){sa(e.userId),sa(e.id);try{return{data:yield oa(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(yr(t))return{data:null,error:t};throw t}})}_listOAuthClients(e){return d(this,null,function*(){var t,s,r,a,n,i,l;try{const o={nextPage:null,lastPage:0,total:0},c=yield oa(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(s=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==s?s:"",per_page:null!==(a=null===(r=null==e?void 0:e.perPage)||void 0===r?void 0:r.toString())&&void 0!==a?a:""},xform:pa});if(c.error)throw c.error;const d=yield c.json(),u=null!==(n=c.headers.get("x-total-count"))&&void 0!==n?n:0,h=null!==(l=null===(i=c.headers.get("link"))||void 0===i?void 0:i.split(","))&&void 0!==l?l:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),s=JSON.parse(e.split(";")[1].split("=")[1]);o[`${s}Page`]=t}),o.total=parseInt(u)),{data:Object.assign(Object.assign({},d),o),error:null}}catch(o){if(yr(o))return{data:{clients:[]},error:o};throw o}})}_createOAuthClient(e){return d(this,null,function*(){try{return yield oa(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(yr(t))return{data:null,error:t};throw t}})}_getOAuthClient(e){return d(this,null,function*(){try{return yield oa(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(yr(t))return{data:null,error:t};throw t}})}_deleteOAuthClient(e){return d(this,null,function*(){try{return yield oa(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(yr(t))return{data:null,error:t};throw t}})}_regenerateOAuthClientSecret(e){return d(this,null,function*(){try{return yield oa(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:e=>({data:e,error:null})})}catch(t){if(yr(t))return{data:null,error:t};throw t}})}}function fa(e={}){return{getItem:t=>e[t]||null,setItem:(t,s)=>{e[t]=s},removeItem:t=>{delete e[t]}}}const ba=!!(globalThis&&qr()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class ya extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class va extends ya{}function ja(e,t,s){return d(this,null,function*(){ba&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const r=new globalThis.AbortController;return t>0&&setTimeout(()=>{r.abort(),ba&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),yield Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},r=>d(this,null,function*(){if(!r){if(0===t)throw ba&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new va(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(ba)try{const e=yield globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(a){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",a)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),yield s()}ba&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,r.name);try{return yield s()}finally{ba&&console.log("@supabase/gotrue-js: navigatorLock: released",e,r.name)}})))})}function wa(e){if(!/^0x[a-fA-F0-9]{40}$/.test(e))throw new Error(`@supabase/auth-js: Address "${e}" is invalid.`);return e.toLowerCase()}function Na(e){const t=(new TextEncoder).encode(e);return"0x"+Array.from(t,e=>e.toString(16).padStart(2,"0")).join("")}class ka extends Error{constructor({message:e,code:t,cause:s,name:r}){var a;super(e,{cause:s}),this.__isWebAuthnError=!0,this.name=null!==(a=null!=r?r:s instanceof Error?s.name:void 0)&&void 0!==a?a:"Unknown Error",this.code=t}}class Sa extends ka{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function _a({error:e,options:t}){var s,r,a;const{publicKey:n}=t;if(!n)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new ka({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else if("ConstraintError"===e.name){if(!0===(null===(s=n.authenticatorSelection)||void 0===s?void 0:s.requireResidentKey))return new ka({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:e});if("conditional"===t.mediation&&"required"===(null===(r=n.authenticatorSelection)||void 0===r?void 0:r.userVerification))return new ka({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:e});if("required"===(null===(a=n.authenticatorSelection)||void 0===a?void 0:a.userVerification))return new ka({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:e})}else{if("InvalidStateError"===e.name)return new ka({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:e});if("NotAllowedError"===e.name)return new ka({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if("NotSupportedError"===e.name)return 0===n.pubKeyCredParams.filter(e=>"public-key"===e.type).length?new ka({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:e}):new ka({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:e});if("SecurityError"===e.name){const t=window.location.hostname;if(!Ia(t))return new ka({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(n.rp.id!==t)return new ka({message:`The RP ID "${n.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("TypeError"===e.name){if(n.user.id.byteLength<1||n.user.id.byteLength>64)return new ka({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:e})}else if("UnknownError"===e.name)return new ka({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new ka({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}function Pa({error:e,options:t}){const{publicKey:s}=t;if(!s)throw Error("options was missing required publicKey property");if("AbortError"===e.name){if(t.signal instanceof AbortSignal)return new ka({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:e})}else{if("NotAllowedError"===e.name)return new ka({message:e.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e});if("SecurityError"===e.name){const t=window.location.hostname;if(!Ia(t))return new ka({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:e});if(s.rpId!==t)return new ka({message:`The RP ID "${s.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:e})}else if("UnknownError"===e.name)return new ka({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:e})}return new ka({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:e})}var Ea=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(s[r[a]]=e[r[a]])}return s};const Ca=new class{createNewAbortSignal(){if(this.controller){const e=new Error("Cancelling existing WebAuthn API call for new one");e.name="AbortError",this.controller.abort(e)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}};function Ta(e){if(!e)throw new Error("Credential creation options are required");if("undefined"!=typeof PublicKeyCredential&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseCreationOptionsFromJSON)return PublicKeyCredential.parseCreationOptionsFromJSON(e);const{challenge:t,user:s,excludeCredentials:r}=e,a=Ea(e,["challenge","user","excludeCredentials"]),n=Fr(t).buffer,i=Object.assign(Object.assign({},s),{id:Fr(s.id).buffer}),l=Object.assign(Object.assign({},a),{challenge:n,user:i});if(r&&r.length>0){l.excludeCredentials=new Array(r.length);for(let e=0;e<r.length;e++){const t=r[e];l.excludeCredentials[e]=Object.assign(Object.assign({},t),{id:Fr(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return l}function Oa(e){if(!e)throw new Error("Credential request options are required");if("undefined"!=typeof PublicKeyCredential&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&"function"==typeof PublicKeyCredential.parseRequestOptionsFromJSON)return PublicKeyCredential.parseRequestOptionsFromJSON(e);const{challenge:t,allowCredentials:s}=e,r=Ea(e,["challenge","allowCredentials"]),a=Fr(t).buffer,n=Object.assign(Object.assign({},r),{challenge:a});if(s&&s.length>0){n.allowCredentials=new Array(s.length);for(let e=0;e<s.length;e++){const t=s[e];n.allowCredentials[e]=Object.assign(Object.assign({},t),{id:Fr(t.id).buffer,type:t.type||"public-key",transports:t.transports})}}return n}function Aa(e){var t;if("toJSON"in e&&"function"==typeof e.toJSON)return e.toJSON();const s=e;return{id:e.id,rawId:e.id,response:{attestationObject:zr(new Uint8Array(e.response.attestationObject)),clientDataJSON:zr(new Uint8Array(e.response.clientDataJSON))},type:"public-key",clientExtensionResults:e.getClientExtensionResults(),authenticatorAttachment:null!==(t=s.authenticatorAttachment)&&void 0!==t?t:void 0}}function Ra(e){var t;if("toJSON"in e&&"function"==typeof e.toJSON)return e.toJSON();const s=e,r=e.getClientExtensionResults(),a=e.response;return{id:e.id,rawId:e.id,response:{authenticatorData:zr(new Uint8Array(a.authenticatorData)),clientDataJSON:zr(new Uint8Array(a.clientDataJSON)),signature:zr(new Uint8Array(a.signature)),userHandle:a.userHandle?zr(new Uint8Array(a.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:null!==(t=s.authenticatorAttachment)&&void 0!==t?t:void 0}}function Ia(e){return"localhost"===e||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}function Da(){var e,t;return!!(Mr()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&"function"==typeof(null===(e=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===e?void 0:e.create)&&"function"==typeof(null===(t=null===navigator||void 0===navigator?void 0:navigator.credentials)||void 0===t?void 0:t.get))}const $a={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},La={userVerification:"preferred",hints:["security-key"]};function Ua(...e){const t=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),s=e=>e instanceof ArrayBuffer||ArrayBuffer.isView(e),r={};for(const a of e)if(a)for(const e in a){const n=a[e];if(void 0!==n)if(Array.isArray(n))r[e]=n;else if(s(n))r[e]=n;else if(t(n)){const s=r[e];t(s)?r[e]=Ua(s,n):r[e]=Ua(n)}else r[e]=n}return r}class Fa{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}_enroll(e){return d(this,null,function*(){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))})}_challenge(e,t){return d(this,arguments,function*({factorId:e,webauthn:t,friendlyName:s,signal:r},a){try{const{data:n,error:i}=yield this.client.mfa.challenge({factorId:e,webauthn:t});if(!n)return{data:null,error:i};const l=null!=r?r:Ca.createNewAbortSignal();if("create"===n.webauthn.type){const{user:e}=n.webauthn.credential_options.publicKey;e.name||(e.name=`${e.id}:${s}`),e.displayName||(e.displayName=e.name)}switch(n.webauthn.type){case"create":{const t=function(e,t){return Ua($a,e,t||{})}(n.webauthn.credential_options.publicKey,null==a?void 0:a.create),{data:s,error:r}=yield function(e){return d(this,null,function*(){try{const t=yield navigator.credentials.create(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Sa("Browser returned unexpected credential type",t)}:{data:null,error:new Sa("Empty credential response",t)}}catch(t){return{data:null,error:_a({error:t,options:e})}}})}({publicKey:t,signal:l});return s?{data:{factorId:e,challengeId:n.id,webauthn:{type:n.webauthn.type,credential_response:s}},error:null}:{data:null,error:r}}case"request":{const t=function(e,t){return Ua(La,e,t||{})}(n.webauthn.credential_options.publicKey,null==a?void 0:a.request),{data:s,error:r}=yield function(e){return d(this,null,function*(){try{const t=yield navigator.credentials.get(e);return t?t instanceof PublicKeyCredential?{data:t,error:null}:{data:null,error:new Sa("Browser returned unexpected credential type",t)}:{data:null,error:new Sa("Empty credential response",t)}}catch(t){return{data:null,error:Pa({error:t,options:e})}}})}(Object.assign(Object.assign({},n.webauthn.credential_options),{publicKey:t,signal:l}));return s?{data:{factorId:e,challengeId:n.id,webauthn:{type:n.webauthn.type,credential_response:s}},error:null}:{data:null,error:r}}}}catch(n){return yr(n)?{data:null,error:n}:{data:null,error:new jr("Unexpected error in challenge",n)}}})}_verify(e){return d(this,arguments,function*({challengeId:e,factorId:t,webauthn:s}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:s})})}_authenticate(e,t){return d(this,arguments,function*({factorId:e,webauthn:{rpId:t=("undefined"!=typeof window?window.location.hostname:void 0),rpOrigins:s=("undefined"!=typeof window?[window.location.origin]:void 0),signal:r}},a){if(!t)return{data:null,error:new br("rpId is required for WebAuthn authentication")};try{if(!Da())return{data:null,error:new jr("Browser does not support WebAuthn",null)};const{data:n,error:i}=yield this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:s},signal:r},{request:a});if(!n)return{data:null,error:i};const{webauthn:l}=n;return this._verify({factorId:e,challengeId:n.challengeId,webauthn:{type:l.type,rpId:t,rpOrigins:s,credential_response:l.credential_response}})}catch(n){return yr(n)?{data:null,error:n}:{data:null,error:new jr("Unexpected error in authenticate",n)}}})}_register(e,t){return d(this,arguments,function*({friendlyName:e,rpId:t=("undefined"!=typeof window?window.location.hostname:void 0),rpOrigins:s=("undefined"!=typeof window?[window.location.origin]:void 0),signal:r},a){if(!t)return{data:null,error:new br("rpId is required for WebAuthn registration")};try{if(!Da())return{data:null,error:new jr("Browser does not support WebAuthn",null)};const{data:n,error:i}=yield this._enroll({friendlyName:e});if(!n)return yield this.client.mfa.listFactors().then(t=>{var s;return null===(s=t.data)||void 0===s?void 0:s.all.find(t=>"webauthn"===t.factor_type&&t.friendly_name===e&&"unverified"!==t.status)}).then(e=>e?this.client.mfa.unenroll({factorId:null==e?void 0:e.id}):void 0),{data:null,error:i};const{data:l,error:o}=yield this._challenge({factorId:n.id,friendlyName:n.friendly_name,webauthn:{rpId:t,rpOrigins:s},signal:r},{create:a});return l?this._verify({factorId:n.id,challengeId:l.challengeId,webauthn:{rpId:t,rpOrigins:s,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:o}}catch(n){return yr(n)?{data:null,error:n}:{data:null,error:new jr("Unexpected error in register",n)}}})}}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const Ba={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:pr,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};function za(e,t,s){return d(this,null,function*(){return yield s()})}const Ma={};class Ka{get jwks(){var e,t;return null!==(t=null===(e=Ma[this.storageKey])||void 0===e?void 0:e.jwks)&&void 0!==t?t:{keys:[]}}set jwks(e){Ma[this.storageKey]=Object.assign(Object.assign({},Ma[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!==(t=null===(e=Ma[this.storageKey])||void 0===e?void 0:e.cachedAt)&&void 0!==t?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Ma[this.storageKey]=Object.assign(Object.assign({},Ma[this.storageKey]),{cachedAt:e})}constructor(e){var t,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Ka.nextInstanceID,Ka.nextInstanceID+=1,this.instanceID>0&&Mr()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},Ba),e);if(this.logDebugMessages=!!r.debug,"function"==typeof r.debug&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new xa({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=Jr(r.fetch),this.lock=r.lock||za,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,r.lock?this.lock=r.lock:Mr()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=ja:this.lock=za,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new Fa(this)},this.persistSession?(r.storage?this.storage=r.storage:qr()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=fa(this.memoryStorage)),r.userStorage&&(this.userStorage=r.userStorage)):(this.memoryStorage={},this.storage=fa(this.memoryStorage)),Mr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(a){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",a)}null===(s=this.broadcastChannel)||void 0===s||s.addEventListener("message",e=>d(this,null,function*(){this._debug("received broadcast notification from other tab or client",e),yield this._notifyAllSubscribers(e.data.event,e.data.session,!1)}))}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${ur}) ${(new Date).toISOString()}`,...e),this}initialize(){return d(this,null,function*(){return this.initializePromise||(this.initializePromise=(()=>d(this,null,function*(){return yield this._acquireLock(-1,()=>d(this,null,function*(){return yield this._initialize()}))}))()),yield this.initializePromise})}_initialize(){return d(this,null,function*(){var e;try{const t=function(e){const t={},s=new URL(e);if(s.hash&&"#"===s.hash[0])try{new URLSearchParams(s.hash.substring(1)).forEach((e,s)=>{t[s]=e})}catch(r){}return s.searchParams.forEach((e,s)=>{t[s]=e}),t}(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":(yield this._isPKCECallback(t))&&(s="pkce"),Mr()&&this.detectSessionInUrl&&"none"!==s){const{data:r,error:a}=yield this._getSessionFromURL(t,s);if(a){if(this._debug("#_initialize()","error detecting session from URL",a),function(e){return yr(e)&&"AuthImplicitGrantRedirectError"===e.name}(a)){const t=null===(e=a.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:a}}return yield this._removeSession(),{error:a}}const{session:n,redirectType:i}=r;return this._debug("#_initialize()","detected session in URL",n,"redirect type",i),yield this._saveSession(n),setTimeout(()=>d(this,null,function*(){"recovery"===i?yield this._notifyAllSubscribers("PASSWORD_RECOVERY",n):yield this._notifyAllSubscribers("SIGNED_IN",n)}),0),{error:null}}return yield this._recoverAndRefresh(),{error:null}}catch(t){return yr(t)?{error:t}:{error:new jr("Unexpected error during initialization",t)}}finally{yield this._handleVisibilityChange(),this._debug("#_initialize()","end")}})}signInAnonymously(e){return d(this,null,function*(){var t,s,r;try{const a=yield oa(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(s=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==s?s:{},gotrue_meta_security:{captcha_token:null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken}},xform:ca}),{data:n,error:i}=a;if(i||!n)return{data:{user:null,session:null},error:i};const l=n.session,o=n.user;return n.session&&(yield this._saveSession(n.session),yield this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:o,session:l},error:null}}catch(a){if(yr(a))return{data:{user:null,session:null},error:a};throw a}})}signUp(e){return d(this,null,function*(){var t,s,r;try{let a;if("email"in e){const{email:s,password:r,options:n}=e;let i=null,l=null;"pkce"===this.flowType&&([i,l]=yield Zr(this.storage,this.storageKey)),a=yield oa(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==n?void 0:n.emailRedirectTo,body:{email:s,password:r,data:null!==(t=null==n?void 0:n.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:i,code_challenge_method:l},xform:ca})}else{if(!("phone"in e))throw new Sr("You must provide either an email or phone number and a password");{const{phone:t,password:n,options:i}=e;a=yield oa(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:n,data:null!==(s=null==i?void 0:i.data)&&void 0!==s?s:{},channel:null!==(r=null==i?void 0:i.channel)&&void 0!==r?r:"sms",gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:ca})}}const{data:n,error:i}=a;if(i||!n)return{data:{user:null,session:null},error:i};const l=n.session,o=n.user;return n.session&&(yield this._saveSession(n.session),yield this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:o,session:l},error:null}}catch(a){if(yr(a))return{data:{user:null,session:null},error:a};throw a}})}signInWithPassword(e){return d(this,null,function*(){try{let t;if("email"in e){const{email:s,password:r,options:a}=e;t=yield oa(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:r,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},xform:da})}else{if(!("phone"in e))throw new Sr("You must provide either an email or phone number and a password");{const{phone:s,password:r,options:a}=e;t=yield oa(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:r,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},xform:da})}}const{data:s,error:r}=t;return r?{data:{user:null,session:null},error:r}:s&&s.session&&s.user?(s.session&&(yield this._saveSession(s.session),yield this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:r}):{data:{user:null,session:null},error:new kr}}catch(t){if(yr(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOAuth(e){return d(this,null,function*(){var t,s,r,a;return yield this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(r=e.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:null===(a=e.options)||void 0===a?void 0:a.skipBrowserRedirect})})}exchangeCodeForSession(e){return d(this,null,function*(){return yield this.initializePromise,this._acquireLock(-1,()=>d(this,null,function*(){return this._exchangeCodeForSession(e)}))})}signInWithWeb3(e){return d(this,null,function*(){const{chain:t}=e;switch(t){case"ethereum":return yield this.signInWithEthereum(e);case"solana":return yield this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}})}signInWithEthereum(e){return d(this,null,function*(){var t,s,r,a,n,i,l,o,c,d,u;let h,m;if("message"in e)h=e.message,m=e.signature;else{const{chain:d,wallet:u,statement:p,options:g}=e;let x;if(Mr())if("object"==typeof u)x=u;else{const e=window;if(!("ethereum"in e)||"object"!=typeof e.ethereum||!("request"in e.ethereum)||"function"!=typeof e.ethereum.request)throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.");x=e.ethereum}else{if("object"!=typeof u||!(null==g?void 0:g.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");x=u}const f=new URL(null!==(t=null==g?void 0:g.url)&&void 0!==t?t:window.location.href),b=yield x.request({method:"eth_requestAccounts"}).then(e=>e).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!b||0===b.length)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const y=wa(b[0]);let v=null===(s=null==g?void 0:g.signInWithEthereum)||void 0===s?void 0:s.chainId;if(!v){const e=yield x.request({method:"eth_chainId"});v=parseInt(e,16)}h=function(e){var t;const{chainId:s,domain:r,expirationTime:a,issuedAt:n=new Date,nonce:i,notBefore:l,requestId:o,resources:c,scheme:d,uri:u,version:h}=e;if(!Number.isInteger(s))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${s}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(i&&i.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${i}`);if(!u)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if("1"!==h)throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(null===(t=e.statement)||void 0===t?void 0:t.includes("\n"))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${e.statement}`);const m=`${d?`${d}://${r}`:r} wants you to sign in with your Ethereum account:\n${wa(e.address)}\n\n${e.statement?`${e.statement}\n`:""}`;let p=`URI: ${u}\nVersion: ${h}\nChain ID: ${s}${i?`\nNonce: ${i}`:""}\nIssued At: ${n.toISOString()}`;if(a&&(p+=`\nExpiration Time: ${a.toISOString()}`),l&&(p+=`\nNot Before: ${l.toISOString()}`),o&&(p+=`\nRequest ID: ${o}`),c){let e="\nResources:";for(const t of c){if(!t||"string"!=typeof t)throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${t}`);e+=`\n- ${t}`}p+=e}return`${m}\n${p}`}({domain:f.host,address:y,statement:p,uri:f.href,version:"1",chainId:v,nonce:null===(r=null==g?void 0:g.signInWithEthereum)||void 0===r?void 0:r.nonce,issuedAt:null!==(n=null===(a=null==g?void 0:g.signInWithEthereum)||void 0===a?void 0:a.issuedAt)&&void 0!==n?n:new Date,expirationTime:null===(i=null==g?void 0:g.signInWithEthereum)||void 0===i?void 0:i.expirationTime,notBefore:null===(l=null==g?void 0:g.signInWithEthereum)||void 0===l?void 0:l.notBefore,requestId:null===(o=null==g?void 0:g.signInWithEthereum)||void 0===o?void 0:o.requestId,resources:null===(c=null==g?void 0:g.signInWithEthereum)||void 0===c?void 0:c.resources}),m=yield x.request({method:"personal_sign",params:[Na(h),y]})}try{const{data:t,error:s}=yield oa(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:h,signature:m},(null===(d=e.options)||void 0===d?void 0:d.captchaToken)?{gotrue_meta_security:{captcha_token:null===(u=e.options)||void 0===u?void 0:u.captchaToken}}:null),xform:ca});if(s)throw s;return t&&t.session&&t.user?(t.session&&(yield this._saveSession(t.session),yield this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign({},t),error:s}):{data:{user:null,session:null},error:new kr}}catch(p){if(yr(p))return{data:{user:null,session:null},error:p};throw p}})}signInWithSolana(e){return d(this,null,function*(){var t,s,r,a,n,i,l,o,c,d,u,h;let m,p;if("message"in e)m=e.message,p=e.signature;else{const{chain:u,wallet:h,statement:g,options:x}=e;let f;if(Mr())if("object"==typeof h)f=h;else{const e=window;if(!("solana"in e)||"object"!=typeof e.solana||!("signIn"in e.solana&&"function"==typeof e.solana.signIn||"signMessage"in e.solana&&"function"==typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");f=e.solana}else{if("object"!=typeof h||!(null==x?void 0:x.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");f=h}const b=new URL(null!==(t=null==x?void 0:x.url)&&void 0!==t?t:window.location.href);if("signIn"in f&&f.signIn){const e=yield f.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==x?void 0:x.signInWithSolana),{version:"1",domain:b.host,uri:b.href}),g?{statement:g}:null));let t;if(Array.isArray(e)&&e[0]&&"object"==typeof e[0])t=e[0];else{if(!(e&&"object"==typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"==typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");m="string"==typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),p=t.signature}else{if(!("signMessage"in f&&"function"==typeof f.signMessage&&"publicKey"in f&&"object"==typeof f&&f.publicKey&&"toBase58"in f.publicKey&&"function"==typeof f.publicKey.toBase58))throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");m=[`${b.host} wants you to sign in with your Solana account:`,f.publicKey.toBase58(),...g?["",g,""]:[""],"Version: 1",`URI: ${b.href}`,`Issued At: ${null!==(r=null===(s=null==x?void 0:x.signInWithSolana)||void 0===s?void 0:s.issuedAt)&&void 0!==r?r:(new Date).toISOString()}`,...(null===(a=null==x?void 0:x.signInWithSolana)||void 0===a?void 0:a.notBefore)?[`Not Before: ${x.signInWithSolana.notBefore}`]:[],...(null===(n=null==x?void 0:x.signInWithSolana)||void 0===n?void 0:n.expirationTime)?[`Expiration Time: ${x.signInWithSolana.expirationTime}`]:[],...(null===(i=null==x?void 0:x.signInWithSolana)||void 0===i?void 0:i.chainId)?[`Chain ID: ${x.signInWithSolana.chainId}`]:[],...(null===(l=null==x?void 0:x.signInWithSolana)||void 0===l?void 0:l.nonce)?[`Nonce: ${x.signInWithSolana.nonce}`]:[],...(null===(o=null==x?void 0:x.signInWithSolana)||void 0===o?void 0:o.requestId)?[`Request ID: ${x.signInWithSolana.requestId}`]:[],...(null===(d=null===(c=null==x?void 0:x.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===d?void 0:d.length)?["Resources",...x.signInWithSolana.resources.map(e=>`- ${e}`)]:[]].join("\n");const e=yield f.signMessage((new TextEncoder).encode(m),"utf8");if(!(e&&e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");p=e}}try{const{data:t,error:s}=yield oa(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:m,signature:zr(p)},(null===(u=e.options)||void 0===u?void 0:u.captchaToken)?{gotrue_meta_security:{captcha_token:null===(h=e.options)||void 0===h?void 0:h.captchaToken}}:null),xform:ca});if(s)throw s;return t&&t.session&&t.user?(t.session&&(yield this._saveSession(t.session),yield this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign({},t),error:s}):{data:{user:null,session:null},error:new kr}}catch(g){if(yr(g))return{data:{user:null,session:null},error:g};throw g}})}_exchangeCodeForSession(e){return d(this,null,function*(){const t=yield Hr(this.storage,`${this.storageKey}-code-verifier`),[s,r]=(null!=t?t:"").split("/");try{const{data:t,error:a}=yield oa(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:ca});if(yield Vr(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return t&&t.session&&t.user?(t.session&&(yield this._saveSession(t.session),yield this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!=r?r:null}),error:a}):{data:{user:null,session:null,redirectType:null},error:new kr}}catch(a){if(yr(a))return{data:{user:null,session:null,redirectType:null},error:a};throw a}})}signInWithIdToken(e){return d(this,null,function*(){try{const{options:t,provider:s,token:r,access_token:a,nonce:n}=e,i=yield oa(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:r,access_token:a,nonce:n,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:ca}),{data:l,error:o}=i;return o?{data:{user:null,session:null},error:o}:l&&l.session&&l.user?(l.session&&(yield this._saveSession(l.session),yield this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:o}):{data:{user:null,session:null},error:new kr}}catch(t){if(yr(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOtp(e){return d(this,null,function*(){var t,s,r,a,n;try{if("email"in e){const{email:r,options:a}=e;let n=null,i=null;"pkce"===this.flowType&&([n,i]=yield Zr(this.storage,this.storageKey));const{error:l}=yield oa(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:r,data:null!==(t=null==a?void 0:a.data)&&void 0!==t?t:{},create_user:null===(s=null==a?void 0:a.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken},code_challenge:n,code_challenge_method:i},redirectTo:null==a?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:l}}if("phone"in e){const{phone:t,options:s}=e,{data:i,error:l}=yield oa(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(r=null==s?void 0:s.data)&&void 0!==r?r:{},create_user:null===(a=null==s?void 0:s.shouldCreateUser)||void 0===a||a,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},channel:null!==(n=null==s?void 0:s.channel)&&void 0!==n?n:"sms"}});return{data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:l}}throw new Sr("You must provide either an email or phone number.")}catch(i){if(yr(i))return{data:{user:null,session:null},error:i};throw i}})}verifyOtp(e){return d(this,null,function*(){var t,s;try{let r,a;"options"in e&&(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo,a=null===(s=e.options)||void 0===s?void 0:s.captchaToken);const{data:n,error:i}=yield oa(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:a}}),redirectTo:r,xform:ca});if(i)throw i;if(!n)throw new Error("An error occurred on token verification.");const l=n.session,o=n.user;return(null==l?void 0:l.access_token)&&(yield this._saveSession(l),yield this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:o,session:l},error:null}}catch(r){if(yr(r))return{data:{user:null,session:null},error:r};throw r}})}signInWithSSO(e){return d(this,null,function*(){var t,s,r;try{let a=null,n=null;return"pkce"===this.flowType&&([a,n]=yield Zr(this.storage,this.storageKey)),yield oa(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==s?s:void 0}),(null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:n}),headers:this.headers,xform:ha})}catch(a){if(yr(a))return{data:null,error:a};throw a}})}reauthenticate(){return d(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>d(this,null,function*(){return yield this._reauthenticate()}))})}_reauthenticate(){return d(this,null,function*(){try{return yield this._useSession(e=>d(this,null,function*(){const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new Nr;const{error:r}=yield oa(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:r}}))}catch(e){if(yr(e))return{data:{user:null,session:null},error:e};throw e}})}resend(e){return d(this,null,function*(){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:r,options:a}=e,{error:n}=yield oa(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:r,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},redirectTo:null==a?void 0:a.emailRedirectTo});return{data:{user:null,session:null},error:n}}if("phone"in e){const{phone:s,type:r,options:a}=e,{data:n,error:i}=yield oa(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:r,gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}}});return{data:{user:null,session:null,messageId:null==n?void 0:n.message_id},error:i}}throw new Sr("You must provide either an email or phone number and a type")}catch(t){if(yr(t))return{data:{user:null,session:null},error:t};throw t}})}getSession(){return d(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>d(this,null,function*(){return this._useSession(e=>d(this,null,function*(){return e}))}))})}_acquireLock(e,t){return d(this,null,function*(){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(()=>d(this,null,function*(){return yield e,yield t()}))();return this.pendingInLock.push((()=>d(this,null,function*(){try{yield s}catch(e){}}))()),s}return yield this.lock(`lock:${this.storageKey}`,e,()=>d(this,null,function*(){this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((()=>d(this,null,function*(){try{yield e}catch(t){}}))()),yield e;this.pendingInLock.length;){const e=[...this.pendingInLock];yield Promise.all(e),this.pendingInLock.splice(0,e.length)}return yield e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this._debug("#_acquireLock","end")}})}_useSession(e){return d(this,null,function*(){this._debug("#_useSession","begin");try{const t=yield this.__loadSession();return yield e(t)}finally{this._debug("#_useSession","end")}})}__loadSession(){return d(this,null,function*(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=yield Hr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),yield this._removeSession())),!e)return{data:{session:null},error:null};const s=!!e.expires_at&&1e3*e.expires_at-Date.now()<mr;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const t=yield Hr(this.userStorage,this.storageKey+"-user");(null==t?void 0:t.user)?e.user=t.user:e.user=ra()}if(this.storage.isServer&&e.user){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,s,r)=>(t||"user"!==s||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,s,r))})}return{data:{session:e},error:null}}const{data:r,error:a}=yield this._callRefreshToken(e.refresh_token);return a?{data:{session:null},error:a}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}})}getUser(e){return d(this,null,function*(){return e?yield this._getUser(e):(yield this.initializePromise,yield this._acquireLock(-1,()=>d(this,null,function*(){return yield this._getUser()})))})}_getUser(e){return d(this,null,function*(){try{return e?yield oa(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ua}):yield this._useSession(e=>d(this,null,function*(){var t,s,r;const{data:a,error:n}=e;if(n)throw n;return(null===(t=a.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?yield oa(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(r=null===(s=a.session)||void 0===s?void 0:s.access_token)&&void 0!==r?r:void 0,xform:ua}):{data:{user:null},error:new Nr}}))}catch(t){if(yr(t))return function(e){return yr(e)&&"AuthSessionMissingError"===e.name}(t)&&(yield this._removeSession(),yield Vr(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}})}updateUser(e){return d(this,arguments,function*(e,t={}){return yield this.initializePromise,yield this._acquireLock(-1,()=>d(this,null,function*(){return yield this._updateUser(e,t)}))})}_updateUser(e){return d(this,arguments,function*(e,t={}){try{return yield this._useSession(s=>d(this,null,function*(){const{data:r,error:a}=s;if(a)throw a;if(!r.session)throw new Nr;const n=r.session;let i=null,l=null;"pkce"===this.flowType&&null!=e.email&&([i,l]=yield Zr(this.storage,this.storageKey));const{data:o,error:c}=yield oa(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:i,code_challenge_method:l}),jwt:n.access_token,xform:ua});if(c)throw c;return n.user=o.user,yield this._saveSession(n),yield this._notifyAllSubscribers("USER_UPDATED",n),{data:{user:n.user},error:null}}))}catch(s){if(yr(s))return{data:{user:null},error:s};throw s}})}setSession(e){return d(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>d(this,null,function*(){return yield this._setSession(e)}))})}_setSession(e){return d(this,null,function*(){try{if(!e.access_token||!e.refresh_token)throw new Nr;const t=Date.now()/1e3;let s=t,r=!0,a=null;const{payload:n}=Yr(e.access_token);if(n.exp&&(s=n.exp,r=s<=t),r){const{data:t,error:s}=yield this._callRefreshToken(e.refresh_token);if(s)return{data:{user:null,session:null},error:s};if(!t)return{data:{user:null,session:null},error:null};a=t}else{const{data:r,error:n}=yield this._getUser(e.access_token);if(n)throw n;a={access_token:e.access_token,refresh_token:e.refresh_token,user:r.user,token_type:"bearer",expires_in:s-t,expires_at:s},yield this._saveSession(a),yield this._notifyAllSubscribers("SIGNED_IN",a)}return{data:{user:a.user,session:a},error:null}}catch(t){if(yr(t))return{data:{session:null,user:null},error:t};throw t}})}refreshSession(e){return d(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>d(this,null,function*(){return yield this._refreshSession(e)}))})}_refreshSession(e){return d(this,null,function*(){try{return yield this._useSession(t=>d(this,null,function*(){var s;if(!e){const{data:r,error:a}=t;if(a)throw a;e=null!==(s=r.session)&&void 0!==s?s:void 0}if(!(null==e?void 0:e.refresh_token))throw new Nr;const{data:r,error:a}=yield this._callRefreshToken(e.refresh_token);return a?{data:{user:null,session:null},error:a}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}}))}catch(t){if(yr(t))return{data:{user:null,session:null},error:t};throw t}})}_getSessionFromURL(e,t){return d(this,null,function*(){try{if(!Mr())throw new _r("No browser detected.");if(e.error||e.error_description||e.error_code)throw new _r(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new Pr("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new _r("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Pr("No code detected.");const{data:t,error:s}=yield this._exchangeCodeForSession(e.code);if(s)throw s;const r=new URL(window.location.href);return r.searchParams.delete("code"),window.history.replaceState(window.history.state,"",r.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:r,access_token:a,refresh_token:n,expires_in:i,expires_at:l,token_type:o}=e;if(!(a&&i&&n&&o))throw new _r("No session defined in URL");const c=Math.round(Date.now()/1e3),d=parseInt(i);let u=c+d;l&&(u=parseInt(l));const h=u-c;1e3*h<=hr&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${d}s`);const m=u-d;c-m>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",m,u,c):c-m<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",m,u,c);const{data:p,error:g}=yield this._getUser(a);if(g)throw g;const x={provider_token:s,provider_refresh_token:r,access_token:a,expires_in:d,expires_at:u,refresh_token:n,token_type:o,user:p.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:x,redirectType:e.type},error:null}}catch(s){if(yr(s))return{data:{session:null,redirectType:null},error:s};throw s}})}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}_isPKCECallback(e){return d(this,null,function*(){const t=yield Hr(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)})}signOut(){return d(this,arguments,function*(e={scope:"global"}){return yield this.initializePromise,yield this._acquireLock(-1,()=>d(this,null,function*(){return yield this._signOut(e)}))})}_signOut(){return d(this,arguments,function*({scope:e}={scope:"global"}){return yield this._useSession(t=>d(this,null,function*(){var s;const{data:r,error:a}=t;if(a)return{error:a};const n=null===(s=r.session)||void 0===s?void 0:s.access_token;if(n){const{error:t}=yield this.admin.signOut(n,e);if(t&&(!function(e){return yr(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return{error:t}}return"others"!==e&&(yield this._removeSession(),yield Vr(this.storage,`${this.storageKey}-code-verifier`)),{error:null}}))})}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(()=>{d(this,null,function*(){yield this.initializePromise,yield this._acquireLock(-1,()=>d(this,null,function*(){this._emitInitialSession(t)}))})})(),{data:{subscription:s}}}_emitInitialSession(e){return d(this,null,function*(){return yield this._useSession(t=>d(this,null,function*(){var s,r;try{const{data:{session:r},error:a}=t;if(a)throw a;yield null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",r),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(a){yield null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",null),this._debug("INITIAL_SESSION","callback id",e,"error",a),console.error(a)}}))})}resetPasswordForEmail(e){return d(this,arguments,function*(e,t={}){let s=null,r=null;"pkce"===this.flowType&&([s,r]=yield Zr(this.storage,this.storageKey,!0));try{return yield oa(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(a){if(yr(a))return{data:null,error:a};throw a}})}getUserIdentities(){return d(this,null,function*(){var e;try{const{data:t,error:s}=yield this.getUser();if(s)throw s;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(t){if(yr(t))return{data:null,error:t};throw t}})}linkIdentity(e){return d(this,null,function*(){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)})}linkIdentityOAuth(e){return d(this,null,function*(){var t;try{const{data:s,error:r}=yield this._useSession(t=>d(this,null,function*(){var s,r,a,n,i;const{data:l,error:o}=t;if(o)throw o;const c=yield this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(s=e.options)||void 0===s?void 0:s.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(a=e.options)||void 0===a?void 0:a.queryParams,skipBrowserRedirect:!0});return yield oa(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(i=null===(n=l.session)||void 0===n?void 0:n.access_token)&&void 0!==i?i:void 0})}));if(r)throw r;return Mr()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==s?void 0:s.url),{data:{provider:e.provider,url:null==s?void 0:s.url},error:null}}catch(s){if(yr(s))return{data:{provider:e.provider,url:null},error:s};throw s}})}linkIdentityIdToken(e){return d(this,null,function*(){return yield this._useSession(t=>d(this,null,function*(){var s;try{const{error:r,data:{session:a}}=t;if(r)throw r;const{options:n,provider:i,token:l,access_token:o,nonce:c}=e,d=yield oa(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:null!==(s=null==a?void 0:a.access_token)&&void 0!==s?s:void 0,body:{provider:i,id_token:l,access_token:o,nonce:c,link_identity:!0,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:ca}),{data:u,error:h}=d;return h?{data:{user:null,session:null},error:h}:u&&u.session&&u.user?(u.session&&(yield this._saveSession(u.session),yield this._notifyAllSubscribers("USER_UPDATED",u.session)),{data:u,error:h}):{data:{user:null,session:null},error:new kr}}catch(r){if(yr(r))return{data:{user:null,session:null},error:r};throw r}}))})}unlinkIdentity(e){return d(this,null,function*(){try{return yield this._useSession(t=>d(this,null,function*(){var s,r;const{data:a,error:n}=t;if(n)throw n;return yield oa(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(r=null===(s=a.session)||void 0===s?void 0:s.access_token)&&void 0!==r?r:void 0})}))}catch(t){if(yr(t))return{data:null,error:t};throw t}})}_refreshAccessToken(e){return d(this,null,function*(){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return yield function(e,t){return new Promise((s,r)=>{(()=>{d(this,null,function*(){for(let n=0;n<1/0;n++)try{const r=yield e(n);if(!t(n,null,r))return void s(r)}catch(a){if(!t(n,a))return void r(a)}})})()})}(s=>d(this,null,function*(){return s>0&&(yield function(e){return d(this,null,function*(){return yield new Promise(t=>{setTimeout(()=>t(null),e)})})}(200*Math.pow(2,s-1))),this._debug(t,"refreshing attempt",s),yield oa(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:ca})}),(e,t)=>{const r=200*Math.pow(2,e);return t&&Cr(t)&&Date.now()+r-s<hr})}catch(s){if(this._debug(t,"error",s),yr(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}})}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}_handleProviderSignIn(e,t){return d(this,null,function*(){const s=yield this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),Mr()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}})}_recoverAndRefresh(){return d(this,null,function*(){var e,t;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const a=yield Hr(this.storage,this.storageKey);if(a&&this.userStorage){let t=yield Hr(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||t||(t={user:a.user},yield Wr(this.userStorage,this.storageKey+"-user",t)),a.user=null!==(e=null==t?void 0:t.user)&&void 0!==e?e:ra()}else if(a&&!a.user&&!a.user){const e=yield Hr(this.storage,this.storageKey+"-user");e&&(null==e?void 0:e.user)?(a.user=e.user,yield Vr(this.storage,this.storageKey+"-user"),yield Wr(this.storage,this.storageKey,a)):a.user=ra()}if(this._debug(s,"session from storage",a),!this._isValidSession(a))return this._debug(s,"session is not valid"),void(null!==a&&(yield this._removeSession()));const n=1e3*(null!==(t=a.expires_at)&&void 0!==t?t:1/0)-Date.now()<mr;if(this._debug(s,`session has${n?"":" not"} expired with margin of 90000s`),n){if(this.autoRefreshToken&&a.refresh_token){const{error:e}=yield this._callRefreshToken(a.refresh_token);e&&(console.error(e),Cr(e)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",e),yield this._removeSession()))}}else if(a.user&&!0===a.user.__isUserNotAvailableProxy)try{const{data:e,error:t}=yield this._getUser(a.access_token);!t&&(null==e?void 0:e.user)?(a.user=e.user,yield this._saveSession(a),yield this._notifyAllSubscribers("SIGNED_IN",a)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(r){console.error("Error getting user data:",r),this._debug(s,"error getting user data, skipping SIGNED_IN notification",r)}else yield this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){return this._debug(s,"error",a),void console.error(a)}finally{this._debug(s,"end")}})}_callRefreshToken(e){return d(this,null,function*(){var t,s;if(!e)throw new Nr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new Gr;const{data:t,error:s}=yield this._refreshAccessToken(e);if(s)throw s;if(!t.session)throw new Nr;yield this._saveSession(t.session),yield this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const r={data:t.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(a){if(this._debug(r,"error",a),yr(a)){const e={data:null,error:a};return Cr(a)||(yield this._removeSession()),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(s=this.refreshingDeferred)||void 0===s||s.reject(a),a}finally{this.refreshingDeferred=null,this._debug(r,"end")}})}_notifyAllSubscribers(e,t,s=!0){return d(this,null,function*(){const r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const r=[],a=Array.from(this.stateChangeEmitters.values()).map(s=>d(this,null,function*(){try{yield s.callback(e,t)}catch(a){r.push(a)}}));if(yield Promise.all(a),r.length>0){for(let e=0;e<r.length;e+=1)console.error(r[e]);throw r[0]}}finally{this._debug(r,"end")}})}_saveSession(e){return d(this,null,function*(){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),s=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!s&&t.user&&(yield Wr(this.userStorage,this.storageKey+"-user",{user:t.user}));const e=Object.assign({},t);delete e.user;const r=aa(e);yield Wr(this.storage,this.storageKey,r)}else{const e=aa(t);yield Wr(this.storage,this.storageKey,e)}})}_removeSession(){return d(this,null,function*(){this._debug("#_removeSession()"),yield Vr(this.storage,this.storageKey),yield Vr(this.storage,this.storageKey+"-code-verifier"),yield Vr(this.storage,this.storageKey+"-user"),this.userStorage&&(yield Vr(this.userStorage,this.storageKey+"-user")),yield this._notifyAllSubscribers("SIGNED_OUT",null)})}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Mr()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}_startAutoRefresh(){return d(this,null,function*(){yield this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),hr);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout(()=>d(this,null,function*(){yield this.initializePromise,yield this._autoRefreshTokenTick()}),0)})}_stopAutoRefresh(){return d(this,null,function*(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)})}startAutoRefresh(){return d(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._startAutoRefresh()})}stopAutoRefresh(){return d(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._stopAutoRefresh()})}_autoRefreshTokenTick(){return d(this,null,function*(){this._debug("#_autoRefreshTokenTick()","begin");try{yield this._acquireLock(0,()=>d(this,null,function*(){try{const t=Date.now();try{return yield this._useSession(e=>d(this,null,function*(){const{data:{session:s}}=e;if(!s||!s.refresh_token||!s.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const r=Math.floor((1e3*s.expires_at-t)/hr);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),r<=3&&(yield this._callRefreshToken(s.refresh_token))}))}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}catch(e){if(!(e.isAcquireTimeout||e instanceof ya))throw e;this._debug("auto refresh token tick lock not available")}})}_handleVisibilityChange(){return d(this,null,function*(){if(this._debug("#_handleVisibilityChange()"),!Mr()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=()=>d(this,null,function*(){return yield this._onVisibilityChanged(!1)}),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),yield this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}})}_onVisibilityChanged(e){return d(this,null,function*(){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(yield this.initializePromise,yield this._acquireLock(-1,()=>d(this,null,function*(){"visible"===document.visibilityState?yield this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")})))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()})}_getUrlForProvider(e,t,s){return d(this,null,function*(){const r=[`provider=${encodeURIComponent(t)}`];if((null==s?void 0:s.redirectTo)&&r.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),(null==s?void 0:s.scopes)&&r.push(`scopes=${encodeURIComponent(s.scopes)}`),"pkce"===this.flowType){const[e,t]=yield Zr(this.storage,this.storageKey),s=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});r.push(s.toString())}if(null==s?void 0:s.queryParams){const e=new URLSearchParams(s.queryParams);r.push(e.toString())}return(null==s?void 0:s.skipBrowserRedirect)&&r.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${r.join("&")}`})}_unenroll(e){return d(this,null,function*(){try{return yield this._useSession(t=>d(this,null,function*(){var s;const{data:r,error:a}=t;return a?{data:null,error:a}:yield oa(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token})}))}catch(t){if(yr(t))return{data:null,error:t};throw t}})}_enroll(e){return d(this,null,function*(){try{return yield this._useSession(t=>d(this,null,function*(){var s,r;const{data:a,error:n}=t;if(n)return{data:null,error:n};const i=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:"totp"===e.factorType?{issuer:e.issuer}:{}),{data:l,error:o}=yield oa(this.fetch,"POST",`${this.url}/factors`,{body:i,headers:this.headers,jwt:null===(s=null==a?void 0:a.session)||void 0===s?void 0:s.access_token});return o?{data:null,error:o}:("totp"===e.factorType&&"totp"===l.type&&(null===(r=null==l?void 0:l.totp)||void 0===r?void 0:r.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})}))}catch(t){if(yr(t))return{data:null,error:t};throw t}})}_verify(e){return d(this,null,function*(){return this._acquireLock(-1,()=>d(this,null,function*(){try{return yield this._useSession(t=>d(this,null,function*(){var s;const{data:r,error:a}=t;if(a)return{data:null,error:a};const n=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:"create"===e.webauthn.type?Aa(e.webauthn.credential_response):Ra(e.webauthn.credential_response)})}:{code:e.code}),{data:i,error:l}=yield oa(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:n,headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token});return l?{data:null,error:l}:(yield this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),yield this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:l})}))}catch(t){if(yr(t))return{data:null,error:t};throw t}}))})}_challenge(e){return d(this,null,function*(){return this._acquireLock(-1,()=>d(this,null,function*(){try{return yield this._useSession(t=>d(this,null,function*(){var s;const{data:r,error:a}=t;if(a)return{data:null,error:a};const n=yield oa(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token});if(n.error)return n;const{data:i}=n;if("webauthn"!==i.type)return{data:i,error:null};switch(i.webauthn.type){case"create":return{data:Object.assign(Object.assign({},i),{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_options:Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:Ta(i.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},i),{webauthn:Object.assign(Object.assign({},i.webauthn),{credential_options:Object.assign(Object.assign({},i.webauthn.credential_options),{publicKey:Oa(i.webauthn.credential_options.publicKey)})})}),error:null}}}))}catch(t){if(yr(t))return{data:null,error:t};throw t}}))})}_challengeAndVerify(e){return d(this,null,function*(){const{data:t,error:s}=yield this._challenge({factorId:e.factorId});return s?{data:null,error:s}:yield this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})})}_listFactors(){return d(this,null,function*(){var e;const{data:{user:t},error:s}=yield this.getUser();if(s)return{data:null,error:s};const r={all:[],phone:[],totp:[],webauthn:[]};for(const a of null!==(e=null==t?void 0:t.factors)&&void 0!==e?e:[])r.all.push(a),"verified"===a.status&&r[a.factor_type].push(a);return{data:r,error:null}})}_getAuthenticatorAssuranceLevel(){return d(this,null,function*(){return this._acquireLock(-1,()=>d(this,null,function*(){return yield this._useSession(e=>d(this,null,function*(){var t,s;const{data:{session:r},error:a}=e;if(a)return{data:null,error:a};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:n}=Yr(r.access_token);let i=null;n.aal&&(i=n.aal);let l=i;return(null!==(s=null===(t=r.user.factors)||void 0===t?void 0:t.filter(e=>"verified"===e.status))&&void 0!==s?s:[]).length>0&&(l="aal2"),{data:{currentLevel:i,nextLevel:l,currentAuthenticationMethods:n.amr||[]},error:null}}))}))})}fetchJwk(e){return d(this,arguments,function*(e,t={keys:[]}){let s=t.keys.find(t=>t.kid===e);if(s)return s;const r=Date.now();if(s=this.jwks.keys.find(t=>t.kid===e),s&&this.jwks_cached_at+6e5>r)return s;const{data:a,error:n}=yield oa(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(n)throw n;return a.keys&&0!==a.keys.length?(this.jwks=a,this.jwks_cached_at=r,s=a.keys.find(t=>t.kid===e),s||null):null})}getClaims(e){return d(this,arguments,function*(e,t={}){try{let s=e;if(!s){const{data:e,error:t}=yield this.getSession();if(t||!e.session)return{data:null,error:t};s=e.session.access_token}const{header:r,payload:a,signature:n,raw:{header:i,payload:l}}=Yr(s);(null==t?void 0:t.allowExpired)||function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(a.exp);const o=r.alg&&!r.alg.startsWith("HS")&&r.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?yield this.fetchJwk(r.kid,(null==t?void 0:t.keys)?{keys:t.keys}:null==t?void 0:t.jwks):null;if(!o){const{error:e}=yield this.getUser(s);if(e)throw e;return{data:{claims:a,header:r,signature:n},error:null}}const c=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(r.alg),d=yield crypto.subtle.importKey("jwk",o,c,!0,["verify"]);if(!(yield crypto.subtle.verify(c,d,n,Br(`${i}.${l}`))))throw new Or("Invalid JWT signature");return{data:{claims:a,header:r,signature:n},error:null}}catch(s){if(yr(s))return{data:null,error:s};throw s}})}}Ka.nextInstanceID=0;const qa=Ka;class Ja extends qa{constructor(e){super(e)}}var Wa=function(e,t,s,r){return new(s||(s=Promise))(function(a,n){function i(e){try{o(r.next(e))}catch(t){n(t)}}function l(e){try{o(r.throw(e))}catch(t){n(t)}}function o(e){e.done?a(e.value):function(e){return e instanceof s?e:new s(function(t){t(e)})}(e.value).then(i,l)}o((r=r.apply(e,t||[])).next())})};class Ha{constructor(e,t,s){var r,a,n;this.supabaseUrl=e,this.supabaseKey=t;const i=function(e){const t=null==e?void 0:e.trim();if(!t)throw new Error("supabaseUrl is required.");if(!t.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL((s=t).endsWith("/")?s:s+"/")}catch(r){throw Error("Invalid supabaseUrl: Provided URL is malformed.")}var s}(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const l=`sb-${i.hostname.split(".")[0]}-auth-token`,o=function(e,t){var s,r;const{db:a,auth:n,realtime:i,global:l}=e,{db:o,auth:c,realtime:d,global:u}=t,h={db:Object.assign(Object.assign({},o),a),auth:Object.assign(Object.assign({},c),n),realtime:Object.assign(Object.assign({},d),i),storage:{},global:Object.assign(Object.assign(Object.assign({},u),l),{headers:Object.assign(Object.assign({},null!==(s=null==u?void 0:u.headers)&&void 0!==s?s:{}),null!==(r=null==l?void 0:l.headers)&&void 0!==r?r:{})}),accessToken:()=>dr(this,void 0,void 0,function*(){return""})};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}(null!=s?s:{},{db:nr,realtime:lr,auth:Object.assign(Object.assign({},ir),{storageKey:l}),global:ar});this.storageKey=null!==(r=o.auth.storageKey)&&void 0!==r?r:"",this.headers=null!==(a=o.global.headers)&&void 0!==a?a:{},o.accessToken?(this.accessToken=o.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(n=o.auth)&&void 0!==n?n:{},this.headers,o.global.fetch),this.fetch=cr(t,this._getAccessToken.bind(this),o.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},o.realtime)),this.rest=new It(new URL("rest/v1",i).href,{headers:this.headers,schema:o.db.schema,fetch:this.fetch}),this.storage=new sr(this.storageUrl.href,this.headers,this.fetch,null==s?void 0:s.storage),o.accessToken||this._listenForAuthEvents()}get functions(){return new Ge(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){return Wa(this,void 0,void 0,function*(){var e,t;if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return null!==(t=null===(e=s.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,userStorage:a,storageKey:n,flowType:i,lock:l,debug:o},c,d){const u={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Ja({url:this.authUrl.href,headers:Object.assign(Object.assign({},u),c),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,userStorage:a,flowType:i,lock:l,debug:o,fetch:d,hasCustomAuthorizationHeader:Object.keys(this.headers).some(e=>"authorization"===e.toLowerCase())})}_initRealtimeClient(e){return new Ps(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,s){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===s?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):(this.changedAccessToken=s,this.realtime.setAuth(s))}}(function(){if("undefined"!=typeof window)return!1;if("undefined"==typeof process)return!1;const e=process.version;if(null==e)return!1;const t=e.match(/^v(\d+)\./);return!!t&&parseInt(t[1],10)<=18})()&&console.warn("âš ï¸  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Va=new Ha("https://your-project-ref.supabase.co","your-anon-key",Ga);var Ga;const Ya=({user:t,onLogout:s,onNavigateToAdminProducts:r,onNavigateToAdminOrders:a,onNavigateToAdminReports:n,onNavigateToAdminUsers:i})=>{const[l,h]=u.useState(!1),[m,p]=u.useState(!1),[g,f]=u.useState(!1),[b,y]=u.useState({currentPassword:"",newPassword:"",confirmPassword:""});console.log("AccountPage rendered - User role:",null==t?void 0:t.role),console.log("User:",t),(()=>{const[t,s]=u.useState(null),[r,a]=u.useState(!0);u.useEffect(()=>{d(e,null,function*(){try{const{data:{session:e}}=yield Va.auth.getSession();if(null==e?void 0:e.user){const{data:t}=yield Va.from("profiles").select("*").eq("id",e.user.id).single();t&&s(t)}}catch(e){console.error("Error getting session:",e)}finally{a(!1)}});const{data:{subscription:t}}=Va.auth.onAuthStateChange((t,r)=>d(e,null,function*(){if(null==r?void 0:r.user){const{data:e}=yield Va.from("profiles").select("*").eq("id",r.user.id).single();e&&s(e)}else s(null);a(!1)}));return()=>t.unsubscribe()},[])})();const v=t=>d(e,null,function*(){if(t.preventDefault(),b.newPassword===b.confirmPassword)if(b.newPassword.length<6)alert("Password minimal 6 karakter!");else try{alert("âœ… Password berhasil diubah!"),y({currentPassword:"",newPassword:"",confirmPassword:""}),h(!1)}catch(e){alert("âŒ Gagal mengubah password: "+e.message)}else alert("Password baru tidak cocok!")});if(!t)return ve.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:ve.jsxs("div",{className:"text-center",children:[ve.jsx(N,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),ve.jsx("p",{className:"text-gray-600",children:"Silakan login terlebih dahulu"})]})});const j=(e=>{switch(e){case"owner":return{text:"Owner",icon:Y,color:"text-red-600 bg-red-100"};case"admin":return{text:"Administrator",icon:x,color:"text-purple-600 bg-purple-100"};case"reseller":return{text:"Reseller",icon:N,color:"text-blue-600 bg-blue-100"};default:return{text:"Customer",icon:N,color:"text-green-600 bg-green-100"}}})(t.role),w=j.icon;return ve.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[ve.jsxs("div",{className:"bg-gradient-to-r from-pink-500 to-purple-600 text-white p-6",children:[ve.jsxs("div",{className:"flex items-center space-x-4",children:[ve.jsx("div",{className:"w-16 h-16 bg-white/20 rounded-full flex items-center justify-center",children:ve.jsx(N,{className:"w-8 h-8"})}),ve.jsxs("div",{className:"flex-1",children:[ve.jsx("h2",{className:"text-xl font-bold",children:t.name}),ve.jsx("p",{className:"text-pink-100",children:t.email}),ve.jsxs("div",{className:`inline-flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium mt-2 ${j.color}`,children:[ve.jsx(w,{className:"w-3 h-3"}),ve.jsx("span",{className:"text-gray-800",children:j.text})]})]})]}),"reseller"===t.role&&ve.jsx("div",{className:"mt-4 bg-white/10 rounded-lg p-3",children:ve.jsxs("div",{className:"flex items-center justify-between",children:[ve.jsx("span",{className:"text-sm",children:"Total Poin"}),ve.jsxs("span",{className:"text-lg font-bold",children:[t.points||0," pts"]})]})})]}),ve.jsx("div",{className:"p-4",children:(()=>{switch(t.role){case"customer":return ve.jsxs("div",{className:"space-y-4",children:[ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Informasi Akun"}),ve.jsxs("div",{className:"space-y-3",children:[ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx(N,{className:"w-5 h-5 text-gray-400"}),ve.jsxs("div",{children:[ve.jsx("p",{className:"text-sm text-gray-500",children:"Username"}),ve.jsx("p",{className:"font-medium",children:t.name})]})]}),ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx(X,{className:"w-5 h-5 text-gray-400"}),ve.jsxs("div",{children:[ve.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),ve.jsx("p",{className:"font-medium",children:t.email})]})]}),ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx(D,{className:"w-5 h-5 text-gray-400"}),ve.jsxs("div",{children:[ve.jsx("p",{className:"text-sm text-gray-500",children:"Telepon"}),ve.jsx("p",{className:"font-medium",children:t.phone||"Belum diisi"})]})]})]})]}),ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Keamanan"}),ve.jsx("button",{onClick:()=>h(!l),className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx(te,{className:"w-5 h-5 text-gray-400"}),ve.jsxs("div",{className:"flex-1",children:[ve.jsx("p",{className:"font-medium",children:"Ubah Password"}),ve.jsx("p",{className:"text-sm text-gray-500",children:"Keamanan akun Anda"})]})]})}),l&&ve.jsxs("form",{onSubmit:v,className:"mt-4 space-y-3",children:[ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Saat Ini"}),ve.jsxs("div",{className:"relative",children:[ve.jsx("input",{type:m?"text":"password",value:b.currentPassword,onChange:e=>y(c(o({},b),{currentPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),ve.jsx("button",{type:"button",onClick:()=>p(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:m?ve.jsx(se,{className:"w-5 h-5"}):ve.jsx(re,{className:"w-5 h-5"})})]})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Baru"}),ve.jsxs("div",{className:"relative",children:[ve.jsx("input",{type:g?"text":"password",value:b.newPassword,onChange:e=>y(c(o({},b),{newPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),ve.jsx("button",{type:"button",onClick:()=>f(!g),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:g?ve.jsx(se,{className:"w-5 h-5"}):ve.jsx(re,{className:"w-5 h-5"})})]})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password Baru"}),ve.jsx("input",{type:"password",value:b.confirmPassword,onChange:e=>y(c(o({},b),{confirmPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg",required:!0})]}),ve.jsxs("div",{className:"flex space-x-3",children:[ve.jsx("button",{type:"button",onClick:()=>h(!1),className:"flex-1 p-3 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50",children:"Batal"}),ve.jsx("button",{type:"submit",className:"flex-1 p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Simpan"})]})]})]}),ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Preferensi"}),ve.jsxs("div",{className:"space-y-3",children:[ve.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx(C,{className:"w-5 h-5 text-gray-400"}),ve.jsxs("div",{className:"flex-1",children:[ve.jsx("p",{className:"font-medium",children:"Wishlist"}),ve.jsx("p",{className:"text-sm text-gray-500",children:"Produk favorit Anda"})]})]})}),ve.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx($,{className:"w-5 h-5 text-gray-400"}),ve.jsxs("div",{className:"flex-1",children:[ve.jsx("p",{className:"font-medium",children:"Alamat Pengiriman"}),ve.jsx("p",{className:"text-sm text-gray-500",children:"Kelola alamat Anda"})]})]})})]})]})]});case"reseller":return ve.jsxs("div",{className:"space-y-4",children:[ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Informasi Akun"}),ve.jsxs("div",{className:"space-y-3",children:[ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx(N,{className:"w-5 h-5 text-gray-400"}),ve.jsxs("div",{children:[ve.jsx("p",{className:"text-sm text-gray-500",children:"Username"}),ve.jsx("p",{className:"font-medium",children:t.name})]})]}),ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx(X,{className:"w-5 h-5 text-gray-400"}),ve.jsxs("div",{children:[ve.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),ve.jsx("p",{className:"font-medium",children:t.email})]})]}),ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx(D,{className:"w-5 h-5 text-gray-400"}),ve.jsxs("div",{children:[ve.jsx("p",{className:"text-sm text-gray-500",children:"Telepon"}),ve.jsx("p",{className:"font-medium",children:t.phone||"Belum diisi"})]})]})]})]}),ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Point Reseller"}),ve.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg p-4 text-white",children:[ve.jsxs("div",{className:"flex items-center justify-between mb-2",children:[ve.jsx("span",{className:"text-sm opacity-90",children:"Total Poin"}),ve.jsx(le,{className:"w-6 h-6"})]}),ve.jsxs("div",{className:"text-3xl font-bold",children:[t.points||0," pts"]}),ve.jsx("div",{className:"mt-2 text-sm opacity-90",children:"Tukar dengan diskon khusus!"})]})]}),ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Keamanan"}),ve.jsx("button",{onClick:()=>h(!l),className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx(te,{className:"w-5 h-5 text-gray-400"}),ve.jsxs("div",{className:"flex-1",children:[ve.jsx("p",{className:"font-medium",children:"Ubah Password"}),ve.jsx("p",{className:"text-sm text-gray-500",children:"Keamanan akun Anda"})]})]})}),l&&ve.jsxs("form",{onSubmit:v,className:"mt-4 space-y-3",children:[ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Saat Ini"}),ve.jsxs("div",{className:"relative",children:[ve.jsx("input",{type:m?"text":"password",value:b.currentPassword,onChange:e=>y(c(o({},b),{currentPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),ve.jsx("button",{type:"button",onClick:()=>p(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:m?ve.jsx(se,{className:"w-5 h-5"}):ve.jsx(re,{className:"w-5 h-5"})})]})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Baru"}),ve.jsxs("div",{className:"relative",children:[ve.jsx("input",{type:g?"text":"password",value:b.newPassword,onChange:e=>y(c(o({},b),{newPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),ve.jsx("button",{type:"button",onClick:()=>f(!g),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:g?ve.jsx(se,{className:"w-5 h-5"}):ve.jsx(re,{className:"w-5 h-5"})})]})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password Baru"}),ve.jsx("input",{type:"password",value:b.confirmPassword,onChange:e=>y(c(o({},b),{confirmPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg",required:!0})]}),ve.jsxs("div",{className:"flex space-x-3",children:[ve.jsx("button",{type:"button",onClick:()=>h(!1),className:"flex-1 p-3 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50",children:"Batal"}),ve.jsx("button",{type:"submit",className:"flex-1 p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Simpan"})]})]})]}),ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Preferensi Reseller"}),ve.jsxs("div",{className:"space-y-3",children:[ve.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx(C,{className:"w-5 h-5 text-gray-400"}),ve.jsxs("div",{className:"flex-1",children:[ve.jsx("p",{className:"font-medium",children:"Wishlist"}),ve.jsx("p",{className:"text-sm text-gray-500",children:"Produk favorit Anda"})]})]})}),ve.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx($,{className:"w-5 h-5 text-gray-400"}),ve.jsxs("div",{className:"flex-1",children:[ve.jsx("p",{className:"font-medium",children:"Alamat Pengiriman"}),ve.jsx("p",{className:"text-sm text-gray-500",children:"Kelola alamat Anda"})]})]})}),ve.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx(le,{className:"w-5 h-5 text-gray-400"}),ve.jsxs("div",{className:"flex-1",children:[ve.jsx("p",{className:"font-medium",children:"Riwayat Poin"}),ve.jsx("p",{className:"text-sm text-gray-500",children:"Lihat transaksi poin"})]})]})})]})]})]});case"admin":return ve.jsxs("div",{className:"space-y-4",children:[ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Informasi Akun Admin"}),ve.jsxs("div",{className:"space-y-3",children:[ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx(N,{className:"w-5 h-5 text-gray-400"}),ve.jsxs("div",{children:[ve.jsx("p",{className:"text-sm text-gray-500",children:"Username"}),ve.jsx("p",{className:"font-medium",children:t.name})]})]}),ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx(X,{className:"w-5 h-5 text-gray-400"}),ve.jsxs("div",{children:[ve.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),ve.jsx("p",{className:"font-medium",children:t.email})]})]}),ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx(D,{className:"w-5 h-5 text-gray-400"}),ve.jsxs("div",{children:[ve.jsx("p",{className:"text-sm text-gray-500",children:"Telepon"}),ve.jsx("p",{className:"font-medium",children:t.phone||"Belum diisi"})]})]})]})]}),ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Fitur Admin"}),ve.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[ve.jsxs("button",{onClick:r,className:"p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[ve.jsx(U,{className:"w-6 h-6 mx-auto mb-2"}),ve.jsx("p",{className:"text-sm",children:"Kelola Produk"})]}),ve.jsxs("button",{onClick:a,className:"p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[ve.jsx(U,{className:"w-6 h-6 mx-auto mb-2"}),ve.jsx("p",{className:"text-sm",children:"Kelola Pesanan"})]}),ve.jsxs("button",{onClick:n,className:"p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[ve.jsx(Q,{className:"w-6 h-6 mx-auto mb-2"}),ve.jsx("p",{className:"text-sm",children:"Laporan"})]}),ve.jsxs("button",{onClick:i,className:"p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[ve.jsx(Z,{className:"w-6 h-6 mx-auto mb-2"}),ve.jsx("p",{className:"text-sm",children:"Pelanggan"})]})]})]}),ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Statistik Admin"}),ve.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[ve.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[ve.jsx(ee,{className:"w-6 h-6 text-blue-600 mx-auto mb-2"}),ve.jsx("p",{className:"text-sm text-gray-600",children:"Total Penjualan"}),ve.jsx("p",{className:"text-xl font-bold text-blue-600",children:"Rp 0"})]}),ve.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[ve.jsx(U,{className:"w-6 h-6 text-green-600 mx-auto mb-2"}),ve.jsx("p",{className:"text-sm text-gray-600",children:"Total Pesanan"}),ve.jsx("p",{className:"text-xl font-bold text-green-600",children:"0"})]})]})]}),ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Keamanan Admin"}),ve.jsx("button",{onClick:()=>h(!l),className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx(te,{className:"w-5 h-5 text-gray-400"}),ve.jsxs("div",{className:"flex-1",children:[ve.jsx("p",{className:"font-medium",children:"Ubah Password"}),ve.jsx("p",{className:"text-sm text-gray-500",children:"Keamanan akun admin"})]})]})}),l&&ve.jsxs("form",{onSubmit:v,className:"mt-4 space-y-3",children:[ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Saat Ini"}),ve.jsxs("div",{className:"relative",children:[ve.jsx("input",{type:m?"text":"password",value:b.currentPassword,onChange:e=>y(c(o({},b),{currentPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),ve.jsx("button",{type:"button",onClick:()=>p(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:m?ve.jsx(se,{className:"w-5 h-5"}):ve.jsx(re,{className:"w-5 h-5"})})]})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Baru"}),ve.jsxs("div",{className:"relative",children:[ve.jsx("input",{type:g?"text":"password",value:b.newPassword,onChange:e=>y(c(o({},b),{newPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),ve.jsx("button",{type:"button",onClick:()=>f(!g),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:g?ve.jsx(se,{className:"w-5 h-5"}):ve.jsx(re,{className:"w-5 h-5"})})]})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password Baru"}),ve.jsx("input",{type:"password",value:b.confirmPassword,onChange:e=>y(c(o({},b),{confirmPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg",required:!0})]}),ve.jsxs("div",{className:"flex space-x-3",children:[ve.jsx("button",{type:"button",onClick:()=>h(!1),className:"flex-1 p-3 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50",children:"Batal"}),ve.jsx("button",{type:"submit",className:"flex-1 p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Simpan"})]})]})]}),ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Preferensi Admin"}),ve.jsxs("div",{className:"space-y-3",children:[ve.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx(ae,{className:"w-5 h-5 text-gray-400"}),ve.jsxs("div",{className:"flex-1",children:[ve.jsx("p",{className:"font-medium",children:"Keamanan"}),ve.jsx("p",{className:"text-sm text-gray-500",children:"Pengaturan keamanan"})]})]})}),ve.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx(ne,{className:"w-5 h-5 text-gray-400"}),ve.jsxs("div",{className:"flex-1",children:[ve.jsx("p",{className:"font-medium",children:"Pengaturan Sistem"}),ve.jsx("p",{className:"text-sm text-gray-500",children:"Konfigurasi aplikasi"})]})]})})]})]})]});case"owner":return ve.jsxs("div",{className:"space-y-4",children:[ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Informasi Akun Owner"}),ve.jsxs("div",{className:"space-y-3",children:[ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx(N,{className:"w-5 h-5 text-gray-400"}),ve.jsxs("div",{children:[ve.jsx("p",{className:"text-sm text-gray-500",children:"Username"}),ve.jsx("p",{className:"font-medium",children:t.name})]})]}),ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx(X,{className:"w-5 h-5 text-gray-400"}),ve.jsxs("div",{children:[ve.jsx("p",{className:"text-sm text-gray-500",children:"Email"}),ve.jsx("p",{className:"font-medium",children:t.email})]})]}),ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx(D,{className:"w-5 h-5 text-gray-400"}),ve.jsxs("div",{children:[ve.jsx("p",{className:"text-sm text-gray-500",children:"Telepon"}),ve.jsx("p",{className:"font-medium",children:t.phone||"Belum diisi"})]})]})]})]}),ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Kontrol Owner"}),ve.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[ve.jsxs("button",{onClick:r,className:"p-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[ve.jsx(U,{className:"w-6 h-6 mx-auto mb-2"}),ve.jsx("p",{className:"text-sm",children:"Kelola Produk"})]}),ve.jsxs("button",{onClick:a,className:"p-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[ve.jsx(U,{className:"w-6 h-6 mx-auto mb-2"}),ve.jsx("p",{className:"text-sm",children:"Kelola Pesanan"})]}),ve.jsxs("button",{onClick:n,className:"p-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[ve.jsx(Q,{className:"w-6 h-6 mx-auto mb-2"}),ve.jsx("p",{className:"text-sm",children:"Laporan"})]}),ve.jsxs("button",{onClick:i,className:"p-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:[ve.jsx(Z,{className:"w-6 h-6 mx-auto mb-2"}),ve.jsx("p",{className:"text-sm",children:"Kelola User"})]})]})]}),ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Statistik Bisnis"}),ve.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[ve.jsxs("div",{className:"text-center p-3 bg-red-50 rounded-lg",children:[ve.jsx(ee,{className:"w-6 h-6 text-red-600 mx-auto mb-2"}),ve.jsx("p",{className:"text-sm text-gray-600",children:"Total Revenue"}),ve.jsx("p",{className:"text-xl font-bold text-red-600",children:"Rp 0"})]}),ve.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[ve.jsx(U,{className:"w-6 h-6 text-green-600 mx-auto mb-2"}),ve.jsx("p",{className:"text-sm text-gray-600",children:"Total Pesanan"}),ve.jsx("p",{className:"text-xl font-bold text-green-600",children:"0"})]})]})]}),ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Keamanan Owner"}),ve.jsx("button",{onClick:()=>h(!l),className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx(te,{className:"w-5 h-5 text-gray-400"}),ve.jsxs("div",{className:"flex-1",children:[ve.jsx("p",{className:"font-medium",children:"Ubah Password"}),ve.jsx("p",{className:"text-sm text-gray-500",children:"Keamanan akun owner"})]})]})}),l&&ve.jsxs("form",{onSubmit:v,className:"mt-4 space-y-3",children:[ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Saat Ini"}),ve.jsxs("div",{className:"relative",children:[ve.jsx("input",{type:m?"text":"password",value:b.currentPassword,onChange:e=>y(c(o({},b),{currentPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),ve.jsx("button",{type:"button",onClick:()=>p(!m),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:m?ve.jsx(se,{className:"w-5 h-5"}):ve.jsx(re,{className:"w-5 h-5"})})]})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Password Baru"}),ve.jsxs("div",{className:"relative",children:[ve.jsx("input",{type:g?"text":"password",value:b.newPassword,onChange:e=>y(c(o({},b),{newPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg pr-10",required:!0}),ve.jsx("button",{type:"button",onClick:()=>f(!g),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",children:g?ve.jsx(se,{className:"w-5 h-5"}):ve.jsx(re,{className:"w-5 h-5"})})]})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Konfirmasi Password Baru"}),ve.jsx("input",{type:"password",value:b.confirmPassword,onChange:e=>y(c(o({},b),{confirmPassword:e.target.value})),className:"w-full p-3 border border-gray-300 rounded-lg",required:!0})]}),ve.jsxs("div",{className:"flex space-x-3",children:[ve.jsx("button",{type:"button",onClick:()=>h(!1),className:"flex-1 p-3 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50",children:"Batal"}),ve.jsx("button",{type:"submit",className:"flex-1 p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Simpan"})]})]})]}),ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsx("h3",{className:"font-semibold text-gray-800 mb-4",children:"Pengaturan Owner"}),ve.jsxs("div",{className:"space-y-3",children:[ve.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx(ae,{className:"w-5 h-5 text-gray-400"}),ve.jsxs("div",{className:"flex-1",children:[ve.jsx("p",{className:"font-medium",children:"Keamanan"}),ve.jsx("p",{className:"text-sm text-gray-500",children:"Pengaturan keamanan tingkat lanjut"})]})]})}),ve.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx(ne,{className:"w-5 h-5 text-gray-400"}),ve.jsxs("div",{className:"flex-1",children:[ve.jsx("p",{className:"font-medium",children:"Sistem"}),ve.jsx("p",{className:"text-sm text-gray-500",children:"Konfigurasi aplikasi"})]})]})}),ve.jsx("button",{className:"w-full p-3 border border-gray-300 rounded-lg text-left hover:bg-gray-50 transition-colors",children:ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx(ie,{className:"w-5 h-5 text-gray-400"}),ve.jsxs("div",{className:"flex-1",children:[ve.jsx("p",{className:"font-medium",children:"Backup & Restore"}),ve.jsx("p",{className:"text-sm text-gray-500",children:"Cadangkan data"})]})]})})]})]})]});default:return null}})()}),ve.jsx("div",{className:"p-4",children:ve.jsx("div",{className:"bg-white rounded-lg shadow-sm",children:ve.jsxs("button",{onClick:()=>{s()},className:"w-full p-4 flex items-center space-x-3 text-red-600 hover:bg-red-50 transition-colors rounded-lg",children:[ve.jsx(G,{className:"w-5 h-5"}),ve.jsx("span",{children:"Keluar"})]})})})]})},Xa=({onBack:e,user:t})=>{const[s,r]=u.useState(!1),[a,n]=u.useState(!1),[i,l]=u.useState(!1),[d,h]=u.useState(null),[p,g]=u.useState([]),[x,f]=u.useState({isActive:!1,startTime:"",endTime:"",flashSaleDiscount:0,productIds:[]}),[b,y]=u.useState(""),[v,j]=u.useState({category:"",retailPrice:0,discount:0,stock:0,status:"ready",isFeatured:!1,isFlashSale:!1}),[w,N]=u.useState(""),[S,_]=u.useState(""),[E,C]=u.useState("name"),[T,A]=u.useState(50),[I,D]=u.useState(1),[$,L]=u.useState([]),[K,q]=u.useState({name:"",category:"",variants:[{sizes:[],colors:[]}],purchasePrice:0,sellingPrice:0,discount:0,unit:"",description:"",condition:"Ready Stock",images:[],stock:0});u.useEffect(()=>{const e=we.getProducts();L(e);const t=localStorage.getItem("azzahra-flashsale");if(t)try{const e=JSON.parse(t);f(e),console.log("ðŸ”¥ Flash sale config loaded:",e)}catch(s){console.error("âš ï¸ Error loading flash sale config:",s)}},[]),u.useEffect(()=>{$.length>0&&we.saveProducts($)},[$]),u.useEffect(()=>{const e=()=>{try{const e=localStorage.getItem("azzahra-flashsale");if(e){const t=JSON.parse(e);if(t.isActive&&t.endTime){const e=(new Date).getTime(),s=new Date(t.endTime).getTime()-e;if(console.log("â° Flash sale check - Time left:",s,"ms"),s<=0){console.log("ðŸ”¥ FLASH SALE ENDED - Starting cleanup and refresh"),localStorage.removeItem("azzahra-flashsale");const e=we.getProducts().map(e=>c(o({},e),{isFlashSale:!1,flashSalePrice:e.retailPrice}));return we.saveProducts(e),window.dispatchEvent(new CustomEvent("flashSaleEnded")),window.dispatchEvent(new CustomEvent("productsUpdated",{detail:e})),setTimeout(()=>{console.log("ðŸ”„ FORCING PAGE REFRESH AFTER FLASH SALE END"),window.location.reload()},500),!0}}}}catch(e){console.error("Error in global flash sale checker:",e)}return!1};let t;return e()||(t=setInterval(e,1e3)),()=>{t&&clearInterval(t)}},[]),u.useEffect(()=>{const e=()=>{if(!x.isActive||!x.endTime)return void y("");const e=(new Date).getTime(),t=new Date(x.endTime).getTime()-e;if(t<0)return ee(),void y("");const s=Math.floor(t/864e5),r=Math.floor(t%864e5/36e5),a=Math.floor(t%36e5/6e4),n=Math.floor(t%6e4/1e3);y(s>0?`${s} hari ${r} jam ${a} menit`:`${r} jam ${a} menit ${n} detik`)};e();const t=setInterval(e,1e3);return()=>clearInterval(t)},[x]);const J=["Hijab","Gamis","Khimar","Tunik","Jaket","Bawahan","Aksesoris","Lainnya"],V=e=>{const{name:t,value:s,type:r}=e.target;if("number"===r){const e=s.replace(/^0+/,"")||"0";q(s=>c(o({},s),{[t]:parseFloat(e)||0}))}else q(e=>c(o({},e),{[t]:s}))},G=(e,t,s)=>{const r=[...K.variants];if("sizes"===t){const t=s.split(",").map(e=>e.trim()).filter(e=>e);r[e]=c(o({},r[e]),{sizes:t})}else if("colors"===t){const t=s.split(",").map(e=>e.trim()).filter(e=>e);r[e]=c(o({},r[e]),{colors:t})}q(e=>c(o({},e),{variants:r}))},Y=e=>{const t=e.target.files;if(t){const e=Array.from(t).map(e=>URL.createObjectURL(e));q(t=>c(o({},t),{images:[...t.images,...e]}))}},X=e=>{const t=K.images.filter((t,s)=>s!==e);q(e=>c(o({},e),{images:t}))},Z=e=>{const{name:t,value:s,type:r}=e.target;if("number"===r){const e=s.replace(/^0+/,"")||"0";j(s=>c(o({},s),{[t]:parseFloat(e)||0}))}else if("checkbox"===r){const s=e.target;j(e=>c(o({},e),{[t]:s.checked}))}else j(e=>c(o({},e),{[t]:s}))},ee=()=>{console.log("â° Flash sale ended, restoring prices...");const e=$.map(e=>e.isFlashSale?c(o({},e),{isFlashSale:!1,flashSalePrice:e.retailPrice}):e);L(e),we.saveProducts(e),localStorage.removeItem("azzahra-flashsale"),f({isActive:!1,startTime:"",endTime:"",flashSaleDiscount:0,productIds:[]}),setTimeout(()=>{window.dispatchEvent(new CustomEvent("flashSaleEnded")),window.dispatchEvent(new CustomEvent("productsUpdated",{detail:e})),console.log("ðŸ”„ Auto refreshing page after flash sale ended"),window.location.reload()},1e3),console.log("âœ… Flash sale ended and prices restored")},te=(e,t)=>{f(s=>c(o({},s),{[e]:t}))},se=m.useMemo(()=>{let e=[...$];return w&&(e=e.filter(e=>e.name.toLowerCase().includes(w.toLowerCase())||e.category.toLowerCase().includes(w.toLowerCase())||e.description.toLowerCase().includes(w.toLowerCase()))),S&&(e=e.filter(e=>e.category===S)),e.sort((e,t)=>{switch(E){case"price-asc":return e.retailPrice-t.retailPrice;case"price-desc":return t.retailPrice-e.retailPrice;case"date-newest":return new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime();case"date-oldest":return new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime();default:return e.name.localeCompare(t.name)}}),e},[$,w,S,E]),re=Math.ceil(se.length/T),ae=(I-1)*T,ne=ae+T,ie=se.slice(ae,ne);return u.useEffect(()=>{D(1)},[w,S,E,T]),ve.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[ve.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4",children:ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx("button",{onClick:e,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:ve.jsx(P,{className:"w-5 h-5"})}),ve.jsx("h1",{className:"text-xl font-bold",children:"Kelola Produk"})]})}),ve.jsxs("div",{className:"p-4 space-y-4",children:[ve.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[ve.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[ve.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-1",children:"Total Produk"}),ve.jsx("p",{className:"text-2xl font-bold text-blue-600",children:$.length})]}),ve.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[ve.jsx("h4",{className:"text-sm font-medium text-green-800 mb-1",children:"Stok Tersedia"}),ve.jsx("p",{className:"text-2xl font-bold text-green-600",children:$.reduce((e,t)=>e+t.stock,0)})]}),ve.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[ve.jsx("h4",{className:"text-sm font-medium text-purple-800 mb-1",children:"Kategori"}),ve.jsx("p",{className:"text-2xl font-bold text-purple-600",children:J.length})]}),ve.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[ve.jsx("h4",{className:"text-sm font-medium text-orange-800 mb-1",children:"Harga Rata-rata"}),ve.jsx("p",{className:"text-2xl font-bold text-orange-600",children:$.length>0?Math.round($.reduce((e,t)=>e+t.retailPrice,0)/$.length/1e3)+"K":"0K"})]})]}),x.isActive&&ve.jsxs("div",{className:"bg-gradient-to-r from-red-50 to-orange-50 rounded-lg shadow-sm p-4 border border-red-200",children:[ve.jsxs("div",{className:"flex items-center justify-between",children:[ve.jsxs("div",{className:"flex items-center space-x-2",children:[ve.jsx(B,{className:"w-5 h-5 text-red-600"}),ve.jsx("span",{className:"font-semibold text-red-800",children:"Flash Sale Aktif"})]}),ve.jsxs("div",{className:"flex items-center space-x-3",children:[b&&ve.jsxs("div",{className:"flex items-center space-x-1 bg-red-600 text-white px-3 py-1 rounded-full text-sm",children:[ve.jsx(W,{className:"w-4 h-4"}),ve.jsx("span",{className:"font-medium",children:b})]}),ve.jsx("button",{onClick:ee,className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors text-sm",children:"Stop Flash Sale"}),ve.jsx("button",{onClick:()=>{console.log("ðŸ”¥ DEBUG: Manual flash sale end trigger"),ee()},className:"bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors text-xs",children:"DEBUG: Force End"})]})]}),ve.jsxs("p",{className:"text-sm text-red-700 mt-2",children:[$.filter(e=>e.isFlashSale).length," produk dengan diskon Rp ",x.flashSaleDiscount.toLocaleString("id-ID")]})]}),ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsxs("div",{className:"flex items-center justify-between mb-4",children:[ve.jsx("h2",{className:"text-lg font-semibold",children:"Aksi Produk"}),ve.jsxs("button",{onClick:()=>r(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[ve.jsx(O,{className:"w-4 h-4"}),ve.jsx("span",{children:"Tambah Produk"})]})]}),ve.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[ve.jsxs("button",{className:"p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors flex flex-col items-center space-y-2",children:[ve.jsx(U,{className:"w-6 h-6 text-blue-600"}),ve.jsx("span",{className:"text-sm font-medium",children:"Lihat Semua"})]}),ve.jsxs("button",{className:"p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors flex flex-col items-center space-y-2",children:[ve.jsx(Q,{className:"w-6 h-6 text-green-600"}),ve.jsx("span",{className:"text-sm font-medium",children:"Statistik"})]}),ve.jsxs("button",{onClick:()=>l(!0),className:"p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors flex flex-col items-center space-y-2",children:[ve.jsx(oe,{className:"w-6 h-6 text-purple-600"}),ve.jsx("span",{className:"text-sm font-medium",children:"Batch Edit"})]}),ve.jsxs("button",{className:"p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors flex flex-col items-center space-y-2",children:[ve.jsx(ce,{className:"w-6 h-6 text-orange-600"}),ve.jsx("span",{className:"text-sm font-medium",children:"Export"})]})]})]}),ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsxs("div",{className:"flex items-center justify-between mb-4",children:[ve.jsx("h2",{className:"text-lg font-semibold",children:"Produk Unggulan"}),ve.jsx("button",{onClick:()=>{g($.filter(e=>e.isFeatured).map(e=>e.id)),l(!0),j(e=>c(o({},e),{isFeatured:!0}))},className:"text-purple-600 hover:text-purple-700 text-sm font-medium",children:"Edit Massal"})]}),ve.jsx("div",{className:"space-y-2",children:0===$.filter(e=>e.isFeatured).length?ve.jsxs("div",{className:"text-center py-4",children:[ve.jsx("p",{className:"text-gray-500",children:"Belum ada produk unggulan"}),ve.jsx("p",{className:"text-sm text-gray-400",children:'Pilih produk dan centang "Jadikan Produk Unggulan"'})]}):$.filter(e=>e.isFeatured).map(e=>ve.jsxs("div",{className:"flex items-center justify-between p-3 bg-purple-50 rounded-lg border border-purple-200",children:[ve.jsxs("div",{className:"flex items-center space-x-3",children:[e.images.length>0?ve.jsx("img",{src:e.images[0],alt:e.name,className:"w-10 h-10 object-cover rounded-lg"}):ve.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:ve.jsx(U,{className:"w-5 h-5 text-purple-600"})}),ve.jsxs("div",{children:[ve.jsx("p",{className:"font-medium text-purple-800",children:e.name}),ve.jsx("p",{className:"text-sm text-purple-600",children:e.category})]})]}),ve.jsxs("div",{className:"text-right",children:[ve.jsxs("p",{className:"font-semibold text-purple-800",children:["Rp ",e.retailPrice.toLocaleString("id-ID")]}),ve.jsxs("p",{className:"text-sm text-purple-600",children:["Stok: ",e.stock]})]})]},e.id))})]}),ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsxs("div",{className:"flex items-center justify-between mb-4",children:[ve.jsx("h2",{className:"text-lg font-semibold",children:"Produk Flash Sale"}),ve.jsx("button",{onClick:()=>{g($.filter(e=>e.isFlashSale).map(e=>e.id)),l(!0),j(e=>c(o({},e),{isFlashSale:!0}))},className:"text-red-600 hover:text-red-700 text-sm font-medium",children:"Edit Massal"})]}),ve.jsx("div",{className:"space-y-2",children:0===$.filter(e=>e.isFlashSale).length?ve.jsxs("div",{className:"text-center py-4",children:[ve.jsx("p",{className:"text-gray-500",children:"Belum ada produk flash sale"}),ve.jsx("p",{className:"text-sm text-gray-400",children:'Pilih produk dan centang "Jadikan Flash Sale"'})]}):$.filter(e=>e.isFlashSale).map(e=>ve.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg border border-red-200",children:[ve.jsxs("div",{className:"flex items-center space-x-3",children:[e.images.length>0?ve.jsx("img",{src:e.images[0],alt:e.name,className:"w-10 h-10 object-cover rounded-lg"}):ve.jsx("div",{className:"w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center",children:ve.jsx(U,{className:"w-5 h-5 text-red-600"})}),ve.jsxs("div",{children:[ve.jsx("p",{className:"font-medium text-red-800",children:e.name}),ve.jsx("p",{className:"text-sm text-red-600",children:e.category})]})]}),ve.jsxs("div",{className:"text-right",children:[ve.jsx("p",{className:"font-semibold text-red-800",children:e.flashSalePrice<e.retailPrice?ve.jsxs(ve.Fragment,{children:[ve.jsxs("span",{className:"line-through text-gray-400 text-sm",children:["Rp ",e.retailPrice.toLocaleString("id-ID")]}),ve.jsx("br",{}),"Rp ",e.flashSalePrice.toLocaleString("id-ID")]}):`Rp ${e.retailPrice.toLocaleString("id-ID")}`}),ve.jsxs("p",{className:"text-sm text-red-600",children:["Stok: ",e.stock]})]})]},e.id))})]}),ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Kategori Produk"}),ve.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[ve.jsxs("div",{className:"p-3 bg-gradient-to-r from-pink-50 to-purple-50 rounded-lg border border-pink-200",children:[ve.jsx("p",{className:"font-medium text-pink-800",children:"Hijab"}),ve.jsx("p",{className:"text-sm text-pink-600",children:"4 produk â€¢ 45 stok"})]}),ve.jsxs("div",{className:"p-3 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200",children:[ve.jsx("p",{className:"font-medium text-blue-800",children:"Gamis"}),ve.jsx("p",{className:"text-sm text-blue-600",children:"3 produk â€¢ 28 stok"})]}),ve.jsxs("div",{className:"p-3 bg-gradient-to-r from-green-50 to-emerald-50 rounded-lg border border-green-200",children:[ve.jsx("p",{className:"font-medium text-green-800",children:"Khimar"}),ve.jsx("p",{className:"text-sm text-green-600",children:"3 produk â€¢ 38 stok"})]}),ve.jsxs("div",{className:"p-3 bg-gradient-to-r from-orange-50 to-yellow-50 rounded-lg border border-orange-200",children:[ve.jsx("p",{className:"font-medium text-orange-800",children:"Lainnya"}),ve.jsx("p",{className:"text-sm text-orange-600",children:"2 produk â€¢ 45 stok"})]})]})]}),ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-4 space-y-4 md:space-y-0",children:[ve.jsx("h2",{className:"text-lg font-semibold",children:"Daftar Produk"}),ve.jsxs("div",{className:"flex flex-col md:flex-row md:items-center space-y-3 md:space-y-0 md:space-x-3",children:[ve.jsxs("div",{className:"relative",children:[ve.jsx(k,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),ve.jsx("input",{type:"text",placeholder:"Cari produk...",value:w,onChange:e=>N(e.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent w-full md:w-64"})]}),ve.jsxs("select",{value:S,onChange:e=>_(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[ve.jsx("option",{value:"",children:"Semua Kategori"}),J.map(e=>ve.jsx("option",{value:e,children:e},e))]}),ve.jsxs("select",{value:E,onChange:e=>C(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[ve.jsx("option",{value:"name",children:"Urutkan: Nama"}),ve.jsx("option",{value:"price-asc",children:"Harga: Terendah"}),ve.jsx("option",{value:"price-desc",children:"Harga: Tertinggi"}),ve.jsx("option",{value:"date-newest",children:"Terbaru"}),ve.jsx("option",{value:"date-oldest",children:"Terlama"})]}),ve.jsxs("select",{value:T,onChange:e=>A(parseInt(e.target.value)),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[ve.jsx("option",{value:"25",children:"25 / halaman"}),ve.jsx("option",{value:"50",children:"50 / halaman"}),ve.jsx("option",{value:"100",children:"100 / halaman"}),ve.jsx("option",{value:$.length,children:"Semua"})]})]})]}),ve.jsxs("div",{className:"flex items-center justify-between mb-4 text-sm text-gray-600",children:[ve.jsxs("span",{children:["Menampilkan ",ae+1,"-",Math.min(ne,se.length)," dari ",se.length," produk",w&&` untuk "${w}"`,S&&` di kategori ${S}`]}),w||S?ve.jsx("button",{onClick:()=>{N(""),_("")},className:"text-blue-600 hover:text-blue-700",children:"Reset Filter"}):null]}),ve.jsx("div",{className:"space-y-3",children:0===ie.length?ve.jsxs("div",{className:"text-center py-8",children:[ve.jsx(U,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),ve.jsx("p",{className:"text-gray-500",children:0===se.length?"Tidak ada produk yang cocok dengan filter":"Tidak ada produk"}),0===se.length&&(w||S)?ve.jsx("p",{className:"text-sm text-gray-400",children:"Coba ubah filter atau kata kunci pencarian"}):ve.jsx("p",{className:"text-sm text-gray-400",children:'Klik "Tambah Produk" untuk memulai'})]}):ve.jsxs(ve.Fragment,{children:[p.length>0&&ve.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-3",children:ve.jsxs("div",{className:"flex items-center justify-between",children:[ve.jsxs("span",{className:"text-sm text-blue-800 font-medium",children:[p.length," produk dipilih"]}),ve.jsxs("div",{className:"flex items-center space-x-2",children:[ve.jsx("button",{onClick:()=>l(!0),className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700",children:"Edit Massal"}),ve.jsx("button",{onClick:()=>{if(window.confirm(`Apakah Anda yakin ingin menghapus ${p.length} produk?`)){const e=$.filter(e=>!p.includes(e.id));L(e),we.saveProducts(e),g([]),window.dispatchEvent(new CustomEvent("productsUpdated",{detail:e})),l(!1)}},className:"px-3 py-1 bg-red-600 text-white text-sm rounded hover:bg-red-700",children:"Hapus Massal"}),ve.jsx("button",{onClick:()=>g([]),className:"px-3 py-1 bg-gray-500 text-white text-sm rounded hover:bg-gray-600",children:"Batal"})]})]})}),ve.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[ve.jsx("input",{type:"checkbox",checked:p.length===ie.length&&ie.length>0,onChange:()=>{p.length===ie.length?g([]):g(ie.map(e=>e.id))},className:"w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"}),ve.jsxs("span",{className:"text-sm text-gray-600",children:["Pilih Semua (",ie.length," produk)"]})]}),ie.map(e=>ve.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 "+(p.includes(e.id)?"border-blue-500 bg-blue-50":"border-gray-100"),children:[ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx("input",{type:"checkbox",checked:p.includes(e.id),onChange:()=>{return t=e.id,void g(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},className:"w-4 h-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"}),e.images.length>0?ve.jsx("img",{src:e.images[0],alt:e.name,className:"w-12 h-12 object-cover rounded-lg"}):ve.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-100 to-purple-100 rounded-lg flex items-center justify-center",children:ve.jsx(U,{className:"w-6 h-6 text-blue-600"})}),ve.jsxs("div",{children:[ve.jsx("p",{className:"font-medium",children:e.name}),ve.jsxs("p",{className:"text-sm text-gray-500",children:[e.category," â€¢ ","ready"===e.status?"Ready Stock":"PO"]})]})]}),ve.jsxs("div",{className:"flex items-center space-x-4",children:[ve.jsxs("div",{className:"text-right",children:[ve.jsxs("p",{className:"font-semibold text-gray-800",children:["Rp ",e.retailPrice.toLocaleString("id-ID")]}),ve.jsxs("p",{className:"text-sm text-gray-500",children:["Stok: ",e.stock]})]}),ve.jsxs("div",{className:"flex items-center space-x-1",children:[ve.jsx("button",{onClick:()=>(e=>{h(e),q({name:e.name,category:e.category,variants:[{sizes:e.variants.sizes,colors:e.variants.colors}],purchasePrice:e.costPrice||0,sellingPrice:e.retailPrice,discount:0,unit:"pcs",description:e.description,condition:"ready"===e.status?"Ready Stock":"PO",images:e.images,stock:e.stock}),n(!0)})(e),className:"p-2 text-blue-600 hover:bg-blue-100 rounded-lg transition-colors",title:"Edit Produk",children:ve.jsx(oe,{className:"w-4 h-4"})}),ve.jsx("button",{onClick:()=>(e=>{if(window.confirm("Apakah Anda yakin ingin menghapus produk ini?")){const t=$.filter(t=>t.id!==e);L(t),we.saveProducts(t),window.dispatchEvent(new CustomEvent("productsUpdated",{detail:t}))}})(e.id),className:"p-2 text-red-600 hover:bg-red-100 rounded-lg transition-colors",title:"Hapus Produk",children:ve.jsx(R,{className:"w-4 h-4"})})]})]})]},e.id)),re>1&&ve.jsxs("div",{className:"flex items-center justify-center space-x-2 mt-6 pt-4 border-t border-gray-200",children:[ve.jsx("button",{onClick:()=>D(e=>Math.max(1,e-1)),disabled:1===I,className:"px-3 py-1 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Â«"}),Array.from({length:Math.min(5,re)},(e,t)=>{let s;return s=re<=5||I<=3?t+1:I>=re-2?re-4+t:I-2+t,ve.jsx("button",{onClick:()=>D(s),className:"px-3 py-1 border rounded-lg "+(I===s?"bg-blue-600 text-white border-blue-600":"border-gray-300 hover:bg-gray-50"),children:s},s)}),ve.jsx("button",{onClick:()=>D(e=>Math.min(re,e+1)),disabled:I===re,className:"px-3 py-1 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:"Â»"})]})]})})]})]}),s&&ve.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:ve.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[ve.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4",children:ve.jsxs("div",{className:"flex items-center justify-between",children:[ve.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Tambah Produk Baru"}),ve.jsx("button",{onClick:()=>r(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:ve.jsx(F,{className:"w-5 h-5 text-gray-500"})})]})}),ve.jsxs("form",{onSubmit:e=>{e.preventDefault();const t=K.sellingPrice-K.discount,s=K.variants.flatMap(e=>e.sizes),a=K.variants.flatMap(e=>e.colors),n=[...new Set(s)],i=[...new Set(a)],l={id:Date.now().toString(),name:K.name,description:K.description,category:K.category,images:K.images,variants:{sizes:n,colors:i},retailPrice:Math.round(t),resellerPrice:Math.round(.8*t),costPrice:K.purchasePrice,stock:K.stock,status:"Ready Stock"===K.condition?"ready":"po",isFlashSale:!1,flashSalePrice:Math.round(t),createdAt:new Date,salesCount:0,isFeatured:!1},o=[...$,l];L(o),we.saveProducts(o),window.dispatchEvent(new CustomEvent("productsUpdated",{detail:o})),q({name:"",category:"",variants:[{sizes:[],colors:[]}],purchasePrice:0,sellingPrice:0,discount:0,unit:"",description:"",condition:"Ready Stock",images:[],stock:0}),r(!1)},className:"p-6 space-y-6",children:[ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Upload Gambar Produk"}),ve.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[ve.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:Y,className:"hidden",id:"image-upload"}),ve.jsxs("label",{htmlFor:"image-upload",className:"cursor-pointer",children:[ve.jsx(H,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),ve.jsx("p",{className:"text-sm text-gray-600",children:"Klik untuk upload gambar"}),ve.jsx("p",{className:"text-xs text-gray-400",children:"Mendukung multiple files"})]})]}),K.images.length>0&&ve.jsx("div",{className:"mt-3 grid grid-cols-4 gap-2",children:K.images.map((e,t)=>ve.jsxs("div",{className:"relative",children:[ve.jsx("img",{src:e,alt:`Preview ${t+1}`,className:"w-full h-20 object-cover rounded-lg"}),ve.jsx("button",{type:"button",onClick:()=>X(t),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1",children:ve.jsx(F,{className:"w-3 h-3"})})]},t))})]}),ve.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nama Produk *"}),ve.jsx("input",{type:"text",name:"name",value:K.name,onChange:V,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Contoh: Hijab Segi Empat Premium"})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kategori Produk *"}),ve.jsxs("select",{name:"category",value:K.category,onChange:V,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[ve.jsx("option",{value:"",children:"Pilih Kategori"}),J.map(e=>ve.jsx("option",{value:e,children:e},e))]})]})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Varian Produk"}),K.variants.map((e,t)=>ve.jsxs("div",{className:"space-y-2 mb-4 p-4 border border-gray-200 rounded-lg",children:[ve.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Ukuran (pisahkan dengan koma)"}),ve.jsx("input",{type:"text",value:e.sizes.join(", "),onChange:e=>G(t,"sizes",e.target.value),placeholder:"contoh: S, M, L, XL",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Warna (pisahkan dengan koma)"}),ve.jsx("input",{type:"text",value:e.colors.join(", "),onChange:e=>G(t,"colors",e.target.value),placeholder:"contoh: Hitam, Putih, Biru, Merah",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),K.variants.length>1&&ve.jsxs("button",{type:"button",onClick:()=>(e=>{if(K.variants.length>1){const t=K.variants.filter((t,s)=>s!==e);q(e=>c(o({},e),{variants:t}))}})(t),className:"text-red-500 hover:text-red-700 text-sm flex items-center space-x-1",children:[ve.jsx(R,{className:"w-3 h-3"}),ve.jsx("span",{children:"Hapus Varian"})]})]},t)),ve.jsxs("button",{type:"button",onClick:()=>{q(e=>c(o({},e),{variants:[...e.variants,{sizes:[],colors:[]}]}))},className:"text-blue-600 hover:text-blue-700 text-sm font-medium flex items-center space-x-1",children:[ve.jsx(O,{className:"w-4 h-4"}),ve.jsx("span",{children:"Tambah Varian"})]})]}),ve.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Harga Beli"}),ve.jsx("input",{type:"number",name:"purchasePrice",value:K.purchasePrice,onChange:V,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0"})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Harga Jual *"}),ve.jsx("input",{type:"number",name:"sellingPrice",value:K.sellingPrice,onChange:V,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0"})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Diskon (Rp)"}),ve.jsx("input",{type:"number",name:"discount",value:K.discount,onChange:V,min:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0"})]})]}),ve.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Satuan"}),ve.jsxs("select",{name:"unit",value:K.unit,onChange:V,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[ve.jsx("option",{value:"",children:"Pilih Satuan"}),["pcs","pasang","box","lusin","rim","gross"].map(e=>ve.jsx("option",{value:e,children:e},e))]})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stok *"}),ve.jsx("input",{type:"number",name:"stock",value:K.stock,onChange:V,required:!0,min:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0"})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kondisi Produk *"}),ve.jsxs("select",{name:"condition",value:K.condition,onChange:V,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[ve.jsx("option",{value:"Ready Stock",children:"Ready Stock"}),ve.jsx("option",{value:"PO",children:"PO (Pre Order)"})]})]})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Keterangan"}),ve.jsx("textarea",{name:"description",value:K.description,onChange:V,rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Deskripsi produk, bahan, ukuran, dll..."})]}),ve.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[ve.jsx("h3",{className:"font-medium text-blue-800 mb-2",children:"Ringkasan Produk"}),ve.jsxs("div",{className:"space-y-1 text-sm",children:[ve.jsxs("p",{className:"text-blue-700",children:["Total Stok: ",ve.jsxs("span",{className:"font-medium",children:[K.stock," ",K.unit||"pcs"]})]}),ve.jsxs("p",{className:"text-blue-700",children:["Total Variants: ",ve.jsx("span",{className:"font-medium",children:K.variants.length})]}),K.sellingPrice>0&&K.discount>0&&ve.jsxs("p",{className:"text-blue-700",children:["Harga Setelah Diskon: ",ve.jsxs("span",{className:"font-medium",children:["Rp ",Math.round(K.sellingPrice-K.discount).toLocaleString("id-ID")]})]}),ve.jsxs("p",{className:"text-blue-700",children:["Harga Reseller: ",ve.jsxs("span",{className:"font-medium",children:["Rp ",Math.round(.8*K.sellingPrice).toLocaleString("id-ID")]})]})]})]}),ve.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[ve.jsx("button",{type:"button",onClick:()=>r(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"Batal"}),ve.jsxs("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 rounded-lg transition-colors flex items-center space-x-2",children:[ve.jsx(de,{className:"w-4 h-4"}),ve.jsx("span",{children:"Simpan Produk"})]})]})]})]})}),a&&d&&ve.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:ve.jsxs("div",{className:"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[ve.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4",children:ve.jsxs("div",{className:"flex items-center justify-between",children:[ve.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Edit Produk"}),ve.jsx("button",{onClick:()=>{n(!1),h(null)},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:ve.jsx(F,{className:"w-5 h-5 text-gray-500"})})]})}),ve.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),!d)return;const t=K.sellingPrice-K.discount,s=K.variants.flatMap(e=>e.sizes),r=K.variants.flatMap(e=>e.colors),a=[...new Set(s)],i=[...new Set(r)],l=c(o({},d),{name:K.name,description:K.description,category:K.category,images:K.images,variants:{sizes:a,colors:i},retailPrice:Math.round(t),resellerPrice:Math.round(.8*t),costPrice:K.purchasePrice,stock:K.stock,status:"Ready Stock"===K.condition?"ready":"po",flashSalePrice:Math.round(t)}),u=$.map(e=>e.id===d.id?l:e);L(u),we.saveProducts(u),window.dispatchEvent(new CustomEvent("productsUpdated",{detail:u})),q({name:"",category:"",variants:[{sizes:[],colors:[]}],purchasePrice:0,sellingPrice:0,discount:0,unit:"",description:"",condition:"Ready Stock",images:[],stock:0}),h(null),n(!1)},className:"p-6 space-y-6",children:[ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Upload Gambar Produk"}),ve.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[ve.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:Y,className:"hidden",id:"edit-image-upload"}),ve.jsxs("label",{htmlFor:"edit-image-upload",className:"cursor-pointer",children:[ve.jsx(H,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),ve.jsx("p",{className:"text-sm text-gray-600",children:"Klik untuk upload gambar"}),ve.jsx("p",{className:"text-xs text-gray-400",children:"Mendukung multiple files"})]})]}),K.images.length>0&&ve.jsx("div",{className:"mt-3 grid grid-cols-4 gap-2",children:K.images.map((e,t)=>ve.jsxs("div",{className:"relative",children:[ve.jsx("img",{src:e,alt:`Preview ${t+1}`,className:"w-full h-20 object-cover rounded-lg"}),ve.jsx("button",{type:"button",onClick:()=>X(t),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1",children:ve.jsx(F,{className:"w-3 h-3"})})]},t))})]}),ve.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nama Produk *"}),ve.jsx("input",{type:"text",name:"name",value:K.name,onChange:V,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Contoh: Hijab Segi Empat Premium"})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kategori Produk *"}),ve.jsxs("select",{name:"category",value:K.category,onChange:V,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[ve.jsx("option",{value:"",children:"Pilih Kategori"}),J.map(e=>ve.jsx("option",{value:e,children:e},e))]})]})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Varian Produk"}),K.variants.map((e,t)=>ve.jsx("div",{className:"space-y-2 mb-4 p-4 border border-gray-200 rounded-lg",children:ve.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Ukuran (pisahkan dengan koma)"}),ve.jsx("input",{type:"text",value:e.sizes.join(", "),onChange:e=>G(t,"sizes",e.target.value),placeholder:"contoh: S, M, L, XL",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"Warna (pisahkan dengan koma)"}),ve.jsx("input",{type:"text",value:e.colors.join(", "),onChange:e=>G(t,"colors",e.target.value),placeholder:"contoh: Hitam, Putih, Biru, Merah",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})},t))]}),ve.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Harga Beli"}),ve.jsx("input",{type:"number",name:"purchasePrice",value:K.purchasePrice,onChange:V,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0"})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Harga Jual *"}),ve.jsx("input",{type:"number",name:"sellingPrice",value:K.sellingPrice,onChange:V,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0"})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Diskon (Rp)"}),ve.jsx("input",{type:"number",name:"discount",value:K.discount,onChange:V,min:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0"})]})]}),ve.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stok *"}),ve.jsx("input",{type:"number",name:"stock",value:K.stock,onChange:V,required:!0,min:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"0"})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kondisi Produk *"}),ve.jsxs("select",{name:"condition",value:K.condition,onChange:V,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[ve.jsx("option",{value:"Ready Stock",children:"Ready Stock"}),ve.jsx("option",{value:"PO",children:"PO (Pre Order)"})]})]})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Keterangan"}),ve.jsx("textarea",{name:"description",value:K.description,onChange:V,rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Deskripsi produk, bahan, ukuran, dll..."})]}),ve.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[ve.jsx("button",{type:"button",onClick:()=>{n(!1),h(null)},className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"Batal"}),ve.jsxs("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 rounded-lg transition-colors flex items-center space-x-2",children:[ve.jsx(de,{className:"w-4 h-4"}),ve.jsx("span",{children:"Update Produk"})]})]})]})]})}),i&&ve.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:ve.jsxs("div",{className:"bg-white rounded-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[ve.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4",children:ve.jsxs("div",{className:"flex items-center justify-between",children:[ve.jsxs("h2",{className:"text-xl font-bold text-gray-800",children:["Edit Massal (",p.length," produk)"]}),ve.jsx("button",{onClick:()=>l(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:ve.jsx(F,{className:"w-5 h-5 text-gray-500"})})]})}),ve.jsxs("div",{className:"p-6 space-y-6",children:[ve.jsxs("div",{className:"text-center",children:[ve.jsx(oe,{className:"w-12 h-12 text-purple-600 mx-auto mb-3"}),ve.jsx("h3",{className:"font-medium text-gray-800 mb-2",children:"Edit Massal Produk"}),ve.jsxs("p",{className:"text-sm text-gray-600",children:[p.length," produk akan diedit secara bersamaan. Isi field yang ingin diubah."]})]}),ve.jsxs("div",{className:"bg-gradient-to-r from-red-50 to-orange-50 rounded-lg p-4 border border-red-200",children:[ve.jsxs("h4",{className:"font-semibold text-red-800 mb-3 flex items-center space-x-2",children:[ve.jsx(B,{className:"w-5 h-5"}),ve.jsx("span",{children:"ðŸ”¥ Konfigurasi Flash Sale"}),x.isActive&&ve.jsx("span",{className:"ml-2 px-2 py-1 bg-red-600 text-white text-xs rounded-full",children:"AKTIF"})]}),x.isActive&&ve.jsxs("div",{className:"mb-4 p-3 bg-red-100 border border-red-300 rounded-lg",children:[ve.jsxs("p",{className:"text-sm text-red-800",children:[ve.jsx("strong",{children:"Flash Sale Sedang Aktif!"})," Berlaku hingga: ",new Date(x.endTime).toLocaleString("id-ID")]}),ve.jsxs("p",{className:"text-sm text-red-700 mt-1",children:[x.productIds.length," produk terdaftar dengan diskon Rp ",x.flashSaleDiscount.toLocaleString("id-ID")]})]}),ve.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[ve.jsxs("div",{children:[ve.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[ve.jsx(W,{className:"w-4 h-4 inline mr-1"}),"Waktu Mulai"]}),ve.jsx("input",{type:"datetime-local",value:x.startTime,onChange:e=>te("startTime",e.target.value),disabled:x.isActive,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),ve.jsxs("div",{children:[ve.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[ve.jsx(W,{className:"w-4 h-4 inline mr-1"}),"Waktu Berakhir"]}),ve.jsx("input",{type:"datetime-local",value:x.endTime,onChange:e=>te("endTime",e.target.value),disabled:x.isActive,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed"})]}),ve.jsxs("div",{children:[ve.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[ve.jsx(M,{className:"w-4 h-4 inline mr-1"}),"Diskon Flash Sale (Rp)"]}),ve.jsx("input",{type:"number",min:"0",value:x.flashSaleDiscount,onChange:e=>te("flashSaleDiscount",parseInt(e.target.value)||0),disabled:x.isActive,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent disabled:bg-gray-100 disabled:cursor-not-allowed",placeholder:"Contoh: 5000"})]})]}),ve.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[ve.jsx("p",{className:"text-sm text-red-700",children:x.isActive?"Flash sale sedang aktif. Anda dapat menambahkan produk atau menghentikan flash sale.":"Centang 'Jadikan Flash Sale' di bawah untuk memilih produk yang ikut flash sale"}),ve.jsxs("div",{className:"flex items-center space-x-2",children:[x.isActive&&ve.jsxs("button",{onClick:ee,className:"bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors flex items-center space-x-2",children:[ve.jsx(B,{className:"w-4 h-4"}),ve.jsx("span",{children:"Stop Flash Sale"})]}),!x.isActive&&ve.jsxs("button",{onClick:()=>{if(!x.startTime||!x.endTime||x.flashSaleDiscount<=0)return void alert("Mohon lengkapi pengaturan flash sale terlebih dahulu");const e=p;0!==e.length?((e=>{localStorage.setItem("azzahra-flashsale",JSON.stringify(e)),f(e);const t=$.map(t=>{if(e.productIds.includes(t.id)){const s=Math.round(t.retailPrice-e.flashSaleDiscount);return c(o({},t),{isFlashSale:!0,flashSalePrice:Math.max(s,1e3)})}return t});L(t),we.saveProducts(t),window.dispatchEvent(new CustomEvent("flashSaleStarted",{detail:e})),window.dispatchEvent(new CustomEvent("productsUpdated",{detail:t})),console.log("ðŸ”¥ Flash sale started with config:",e)})(c(o({},x),{isActive:!0,productIds:e})),l(!1)):alert("Pilih setidaknya satu produk untuk flash sale")},className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors flex items-center space-x-2",children:[ve.jsx(z,{className:"w-4 h-4"}),ve.jsx("span",{children:"Mulai Flash Sale"})]})]})]})]}),ve.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kategori Produk"}),ve.jsxs("select",{name:"category",value:v.category,onChange:Z,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[ve.jsx("option",{value:"",children:"Tidak ubah"}),J.map(e=>ve.jsx("option",{value:e,children:e},e))]})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Harga Jual"}),ve.jsx("input",{type:"number",name:"retailPrice",value:v.retailPrice,onChange:Z,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Kosongkan jika tidak ingin diubah"})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Diskon (Rp)"}),ve.jsx("input",{type:"number",name:"discount",value:v.discount,onChange:Z,min:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"0 = tidak ada diskon"})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stok"}),ve.jsx("input",{type:"number",name:"stock",value:v.stock,onChange:Z,min:"0",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:"Kosongkan jika tidak ingin diubah"})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Kondisi Produk"}),ve.jsxs("select",{name:"status",value:v.status,onChange:Z,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",children:[ve.jsx("option",{value:"",children:"Tidak ubah"}),ve.jsx("option",{value:"ready",children:"Ready Stock"}),ve.jsx("option",{value:"po",children:"PO (Pre Order)"})]})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Jadikan Produk Unggulan"}),ve.jsxs("div",{className:"flex items-center space-x-3 mt-2",children:[ve.jsx("input",{type:"checkbox",name:"isFeatured",checked:v.isFeatured,onChange:Z,className:"w-4 h-4 text-purple-600 rounded border-gray-300 focus:ring-purple-500"}),ve.jsx("span",{className:"text-sm text-gray-600",children:"Tandai sebagai produk unggulan"})]})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Jadikan Flash Sale"}),ve.jsxs("div",{className:"flex items-center space-x-3 mt-2",children:[ve.jsx("input",{type:"checkbox",name:"isFlashSale",checked:v.isFlashSale,onChange:Z,className:"w-4 h-4 text-red-600 rounded border-gray-300 focus:ring-red-500"}),ve.jsx("span",{className:"text-sm text-gray-600",children:"Tandai sebagai produk flash sale"})]})]})]}),ve.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[ve.jsx("h4",{className:"font-medium text-gray-800 mb-3",children:"Produk yang akan diedit:"}),ve.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:p.map(e=>{const t=$.find(t=>t.id===e);return t?ve.jsxs("div",{className:"flex items-center justify-between text-sm",children:[ve.jsx("span",{className:"font-medium",children:t.name}),ve.jsx("span",{className:"text-gray-500",children:t.category})]},t.id):null})})]}),ve.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:ve.jsxs("p",{className:"text-sm text-blue-800",children:[ve.jsx("strong",{children:"Informasi:"})," Hanya field yang diisi akan diperbarui. Field yang kosong akan dibiarkan tetap."]})}),ve.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t border-gray-200",children:[ve.jsx("button",{onClick:()=>{l(!1),j({category:"",retailPrice:0,discount:0,stock:0,status:"ready",isFeatured:!1,isFlashSale:!1})},className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"Batal"}),ve.jsxs("button",{onClick:()=>{if(0===p.length)return void alert("Pilih setidaknya satu produk untuk diedit");const e={};if(v.category&&(e.category=v.category),v.retailPrice>0&&(e.retailPrice=v.retailPrice,e.resellerPrice=Math.round(.8*v.retailPrice)),v.discount>0){const e=$.map(e=>{if(p.includes(e.id)&&v.discount>0){const t=e.retailPrice-v.discount;return c(o({},e),{retailPrice:Math.round(t),resellerPrice:Math.round(.8*t),flashSalePrice:Math.round(t)})}return e});L(e),we.saveProducts(e)}v.stock>=0&&(e.stock=v.stock),v.status&&(e.status=v.status),void 0!==v.isFeatured&&(e.isFeatured=v.isFeatured),void 0!==v.isFlashSale&&(e.isFlashSale=v.isFlashSale);const t=$.map(t=>p.includes(t.id)?o(o({},t),e):t);L(t),we.saveProducts(t),window.dispatchEvent(new CustomEvent("productsUpdated",{detail:t})),j({category:"",retailPrice:0,discount:0,stock:0,status:"ready",isFeatured:!1,isFlashSale:!1}),l(!1),g([])},className:"px-4 py-2 bg-purple-600 text-white hover:bg-purple-700 rounded-lg transition-colors flex items-center space-x-2",children:[ve.jsx(oe,{className:"w-4 h-4"}),ve.jsxs("span",{children:["Update ",p.length," Produk"]})]})]})]})]})})]})},Qa=({onBack:e,user:t})=>{var s,r,a,n,i,l,o,c,d;const{orders:h,updateOrderStatus:m,updateOrderPayment:p,deleteOrder:g,getOrdersByStatus:x,getTotalRevenue:f,getTodayOrders:b}=Se(),[y,v]=u.useState(""),[j,w]=u.useState("all"),[S,_]=u.useState(""),[E,C]=u.useState(!1),[T,O]=u.useState(null),[A,R]=u.useState(!1),[I,B]=u.useState(""),[z,M]=u.useState("");u.useEffect(()=>{const e=e=>{console.log("AdminOrdersPage: Order update received",e.detail),v(e=>e+" "),setTimeout(()=>v(e=>e.trim()),100)};return window.addEventListener("orderUpdated",e),()=>window.removeEventListener("orderUpdated",e)},[]);const H={pending:{label:"Menunggu Pembayaran",icon:W,color:"text-orange-600 bg-orange-100"},awaiting_verification:{label:"Menunggu Verifikasi",icon:W,color:"text-yellow-600 bg-yellow-100"},paid:{label:"Dibayar",icon:q,color:"text-blue-600 bg-blue-100"},processing:{label:"Diproses",icon:U,color:"text-purple-600 bg-purple-100"},shipped:{label:"Dikirim",icon:J,color:"text-indigo-600 bg-indigo-100"},delivered:{label:"Selesai",icon:q,color:"text-green-600 bg-green-100"},cancelled:{label:"Dibatalkan",icon:K,color:"text-red-600 bg-red-100"}},V=h.filter(e=>{const t=""===y||e.id.toLowerCase().includes(y.toLowerCase())||e.userName.toLowerCase().includes(y.toLowerCase())||e.userEmail.toLowerCase().includes(y.toLowerCase()),s="all"===j||e.status===j,r=""===S||new Date(e.createdAt).toISOString().split("T")[0]===S;return t&&s&&r}),G=e=>{O(e),R(!0)},Y=(e,t)=>{m(e,t)},X=e=>{T&&("paid"===e?p(T.id,I||"payment_verified",e):m(T.id,e),R(!1),O(null),B(""),M(""))};return ve.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[ve.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4",children:ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx("button",{onClick:e,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:ve.jsx(P,{className:"w-5 h-5"})}),ve.jsx("h1",{className:"text-xl font-bold",children:"Kelola Pesanan"})]})}),ve.jsxs("div",{className:"p-4 space-y-4",children:[ve.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[ve.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[ve.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-1",children:"Total Pesanan"}),ve.jsx("p",{className:"text-2xl font-bold text-blue-600",children:h.length})]}),ve.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[ve.jsx("h4",{className:"text-sm font-medium text-orange-800 mb-1",children:"Menunggu"}),ve.jsx("p",{className:"text-2xl font-bold text-orange-600",children:x("pending").length+x("awaiting_verification").length})]}),ve.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[ve.jsx("h4",{className:"text-sm font-medium text-green-800 mb-1",children:"Selesai"}),ve.jsx("p",{className:"text-2xl font-bold text-green-600",children:x("delivered").length})]}),ve.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[ve.jsx("h4",{className:"text-sm font-medium text-purple-800 mb-1",children:"Total Revenue"}),ve.jsxs("p",{className:"text-2xl font-bold text-purple-600",children:[Math.round(f()/1e3),"K"]})]})]}),ve.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:ve.jsxs("div",{className:"flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3",children:[ve.jsxs("div",{className:"flex-1 relative",children:[ve.jsx(k,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),ve.jsx("input",{type:"text",placeholder:"Cari pesanan...",value:y,onChange:e=>v(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),ve.jsxs("select",{value:j,onChange:e=>w(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[ve.jsx("option",{value:"all",children:"Semua Status"}),Object.entries(H).map(([e,t])=>ve.jsx("option",{value:e,children:t.label},e))]}),ve.jsx("input",{type:"date",value:S,onChange:e=>_(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),ve.jsx("button",{className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:ve.jsx(ce,{className:"w-4 h-4"})})]})}),ve.jsx("div",{className:"space-y-3",children:0===V.length?ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-8 text-center",children:[ve.jsx(U,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),ve.jsx("p",{className:"text-gray-500",children:"Belum ada pesanan"}),ve.jsx("p",{className:"text-sm text-gray-400",children:"Pesanan akan muncul di sini ketika ada checkout"})]}):V.map(e=>{const s=H[e.status],r=s.icon;return ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4 hover:shadow-md transition-shadow",children:[ve.jsxs("div",{className:"flex items-center justify-between mb-3",children:[ve.jsxs("div",{children:[ve.jsxs("p",{className:"font-semibold text-lg",children:["#",e.id]}),ve.jsxs("p",{className:"text-sm text-gray-600",children:[e.userName," â€¢ ",e.userEmail]}),ve.jsx("p",{className:"text-xs text-gray-500",children:new Date(e.createdAt).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"})})]}),ve.jsxs("div",{className:"text-right",children:[ve.jsxs("div",{className:`inline-flex items-center space-x-1 px-3 py-1 rounded-full text-xs font-medium ${s.color}`,children:[ve.jsx(r,{className:"w-3 h-3"}),ve.jsx("span",{children:s.label})]}),ve.jsxs("p",{className:"text-lg font-semibold text-pink-600 mt-1",children:["Rp ",e.finalTotal.toLocaleString("id-ID")]})]})]}),ve.jsxs("div",{className:"flex items-center justify-between",children:[ve.jsxs("div",{className:"text-sm text-gray-600",children:[e.items.length," item â€¢ ","transfer"===e.paymentMethod?"Transfer Bank":"COD"]}),ve.jsxs("div",{className:"flex items-center space-x-2",children:[ve.jsxs("button",{onClick:()=>(e=>{O(e),C(!0)})(e),className:"flex items-center space-x-1 text-blue-600 hover:text-blue-700 text-sm font-medium",children:[ve.jsx(re,{className:"w-4 h-4"}),ve.jsx("span",{children:"Detail"})]}),"pending"===e.status||"awaiting_verification"===e.status?ve.jsxs("button",{onClick:()=>G(e),className:"flex items-center space-x-1 text-green-600 hover:text-green-700 text-sm font-medium",children:[ve.jsx(q,{className:"w-4 h-4"}),ve.jsx("span",{children:"Verifikasi"})]}):null,"paid"===e.status&&ve.jsxs("button",{onClick:()=>Y(e.id,"processing"),className:"flex items-center space-x-1 text-purple-600 hover:text-purple-700 text-sm font-medium",children:[ve.jsx(U,{className:"w-4 h-4"}),ve.jsx("span",{children:"Proses"})]}),"processing"===e.status&&ve.jsxs("button",{onClick:()=>Y(e.id,"shipped"),className:"flex items-center space-x-1 text-indigo-600 hover:text-indigo-700 text-sm font-medium",children:[ve.jsx(J,{className:"w-4 h-4"}),ve.jsx("span",{children:"Kirim"})]}),"shipped"===e.status&&ve.jsxs("button",{onClick:()=>Y(e.id,"delivered"),className:"flex items-center space-x-1 text-green-600 hover:text-green-700 text-sm font-medium",children:[ve.jsx(q,{className:"w-4 h-4"}),ve.jsx("span",{children:"Selesai"})]}),("owner"===(null==t?void 0:t.role)||"admin"===(null==t?void 0:t.role))&&ve.jsxs("button",{onClick:()=>{return t=e.id,void(window.confirm("Apakah Anda yakin ingin menghapus pesanan ini?")&&g(t));var t},className:"flex items-center space-x-1 text-red-600 hover:text-red-700 text-sm font-medium",children:[ve.jsx(K,{className:"w-4 h-4"}),ve.jsx("span",{children:"Batal"})]})]})]})]},e.id)})})]}),E&&T&&ve.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:ve.jsxs("div",{className:"bg-white rounded-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[ve.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4",children:ve.jsxs("div",{className:"flex items-center justify-between",children:[ve.jsxs("h2",{className:"text-xl font-bold text-gray-800",children:["Detail Pesanan #",T.id]}),ve.jsx("button",{onClick:()=>C(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:ve.jsx(F,{className:"w-5 h-5 text-gray-500"})})]})}),ve.jsxs("div",{className:"p-6 space-y-6",children:[ve.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[ve.jsxs("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center",children:[ve.jsx(N,{className:"w-4 h-4 mr-2"}),"Informasi Pelanggan"]}),ve.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[ve.jsxs("div",{children:[ve.jsx("p",{className:"text-gray-600",children:"Nama"}),ve.jsx("p",{className:"font-medium",children:T.userName})]}),ve.jsxs("div",{children:[ve.jsx("p",{className:"text-gray-600",children:"Email"}),ve.jsx("p",{className:"font-medium",children:T.userEmail})]})]})]}),ve.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[ve.jsxs("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center",children:[ve.jsx($,{className:"w-4 h-4 mr-2"}),"Informasi Pengiriman"]}),ve.jsxs("div",{className:"space-y-2 text-sm",children:[ve.jsxs("div",{children:[ve.jsx("p",{className:"text-gray-600",children:"Nama Penerima"}),ve.jsx("p",{className:"font-medium",children:(null==(s=T.shippingInfo)?void 0:s.name)||"-"})]}),ve.jsxs("div",{children:[ve.jsx("p",{className:"text-gray-600",children:"No. Telepon"}),ve.jsxs("p",{className:"font-medium flex items-center",children:[ve.jsx(D,{className:"w-3 h-3 mr-1"}),(null==(r=T.shippingInfo)?void 0:r.phone)||"-"]})]}),ve.jsxs("div",{children:[ve.jsx("p",{className:"text-gray-600",children:"Alamat"}),ve.jsx("p",{className:"font-medium",children:(null==(a=T.shippingInfo)?void 0:a.address)||"-"})]}),(null==(n=T.shippingInfo)?void 0:n.isDropship)&&ve.jsx("div",{className:"mt-2 p-2 bg-yellow-100 rounded",children:ve.jsxs("p",{className:"text-xs text-yellow-800",children:[ve.jsx("strong",{children:"Dropship:"})," ",T.shippingInfo.dropshipName," (",T.shippingInfo.dropshipPhone,")"]})})]})]}),ve.jsxs("div",{children:[ve.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Detail Produk"}),ve.jsx("div",{className:"space-y-3",children:null==(i=T.items)?void 0:i.map((e,t)=>{var s,r;return ve.jsxs("div",{className:"flex items-center space-x-4 p-3 bg-gray-50 rounded-lg",children:[ve.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-lg flex items-center justify-center",children:ve.jsx(U,{className:"w-6 h-6 text-gray-400"})}),ve.jsxs("div",{className:"flex-1",children:[ve.jsx("p",{className:"font-medium",children:e.productName}),ve.jsxs("p",{className:"text-sm text-gray-600",children:[null==(s=e.selectedVariant)?void 0:s.size,", ",null==(r=e.selectedVariant)?void 0:r.color," â€¢ ",e.quantity," pcs"]})]}),ve.jsxs("div",{className:"text-right",children:[ve.jsxs("p",{className:"font-medium",children:["Rp ",e.price.toLocaleString("id-ID")]}),ve.jsxs("p",{className:"text-sm text-gray-600",children:["Total: Rp ",e.total.toLocaleString("id-ID")]})]})]},t)})})]}),ve.jsx("div",{className:"border-t pt-4",children:ve.jsxs("div",{className:"space-y-2 text-sm",children:[ve.jsxs("div",{className:"flex justify-between",children:[ve.jsx("span",{className:"text-gray-600",children:"Subtotal"}),ve.jsxs("span",{className:"font-medium",children:["Rp ",null==(l=T.totalAmount)?void 0:l.toLocaleString("id-ID")]})]}),ve.jsxs("div",{className:"flex justify-between",children:[ve.jsx("span",{className:"text-gray-600",children:"Ongkos Kirim"}),ve.jsxs("span",{className:"font-medium",children:["Rp ",null==(o=T.shippingCost)?void 0:o.toLocaleString("id-ID")]})]}),ve.jsxs("div",{className:"flex justify-between text-lg font-bold pt-2 border-t",children:[ve.jsx("span",{children:"Total"}),ve.jsxs("span",{className:"text-pink-600",children:["Rp ",null==(c=T.finalTotal)?void 0:c.toLocaleString("id-ID")]})]})]})}),T.paymentProof&&ve.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[ve.jsxs("h3",{className:"font-semibold text-gray-800 mb-3 flex items-center",children:[ve.jsx(L,{className:"w-4 h-4 mr-2"}),"Bukti Pembayaran"]}),T.paymentProofUrl?ve.jsx("img",{src:T.paymentProofUrl,alt:"Payment Proof",className:"w-full max-w-md rounded-lg border-2 border-green-200"}):ve.jsx("p",{className:"text-sm text-green-800",children:"Bukti pembayaran telah tersimpan"})]}),T.notes&&ve.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4",children:[ve.jsx("h3",{className:"font-semibold text-gray-800 mb-2",children:"Catatan"}),ve.jsx("p",{className:"text-sm text-gray-700",children:T.notes})]}),ve.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t",children:[ve.jsx("button",{onClick:()=>C(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"Tutup"}),("pending"===T.status||"awaiting_verification"===T.status)&&ve.jsxs("button",{onClick:()=>{C(!1),G(T)},className:"px-4 py-2 bg-green-600 text-white hover:bg-green-700 rounded-lg transition-colors flex items-center space-x-2",children:[ve.jsx(q,{className:"w-4 h-4"}),ve.jsx("span",{children:"Verifikasi Pembayaran"})]})]})]})]})}),A&&T&&ve.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:ve.jsxs("div",{className:"bg-white rounded-xl max-w-md w-full",children:[ve.jsx("div",{className:"border-b border-gray-200 px-6 py-4",children:ve.jsxs("div",{className:"flex items-center justify-between",children:[ve.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"Verifikasi Pembayaran"}),ve.jsx("button",{onClick:()=>R(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:ve.jsx(F,{className:"w-5 h-5 text-gray-500"})})]})}),ve.jsxs("div",{className:"p-6 space-y-4",children:[ve.jsxs("div",{className:"text-center",children:[ve.jsx(q,{className:"w-12 h-12 text-green-600 mx-auto mb-3"}),ve.jsxs("h3",{className:"font-medium text-gray-800 mb-2",children:["Pesanan #",T.id]}),ve.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Total: Rp ",null==(d=T.finalTotal)?void 0:d.toLocaleString("id-ID")]})]}),ve.jsx("div",{className:"space-y-3",children:ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Catatan Verifikasi"}),ve.jsx("textarea",{value:z,onChange:e=>M(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Tambahkan catatan jika diperlukan..."})]})}),ve.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:ve.jsxs("p",{className:"text-sm text-blue-800",children:[ve.jsx("strong",{children:"Periksa:"})," Pastikan bukti pembayaran sudah sesuai dengan jumlah yang dibayarkan."]})}),ve.jsxs("div",{className:"flex items-center justify-end space-x-3 pt-4 border-t",children:[ve.jsx("button",{onClick:()=>X("cancelled"),className:"px-4 py-2 text-red-700 bg-red-100 hover:bg-red-200 rounded-lg transition-colors",children:"Tolak"}),ve.jsxs("button",{onClick:()=>X("paid"),className:"px-4 py-2 bg-green-600 text-white hover:bg-green-700 rounded-lg transition-colors flex items-center space-x-2",children:[ve.jsx(ue,{className:"w-4 h-4"}),ve.jsx("span",{children:"Konfirmasi"})]})]})]})]})})]})},Za=({onBack:e,user:t})=>{const[s,r]=u.useState("sales"),[a,n]=u.useState("today"),[i,l]=u.useState((new Date).toISOString().split("T")[0]),[o,c]=u.useState((new Date).toISOString().split("T")[0]),d={sales:{totalSales:25e5,totalOrders:45,avgOrderValue:55555,topProduct:"Hijab Segi Empat Premium",topCategory:"Hijab",growth:15.5},products:{totalProducts:12,lowStock:3,outOfStock:0,topSelling:"Gamis Syari Elegant",worstSelling:"Khimar Basic",avgPrice:125e3},customers:{totalCustomers:234,newCustomers:28,activeCustomers:189,topCustomer:"Siti Nurhaliza",avgOrdersPerCustomer:2.3}},h=d[s]||d.sales;return ve.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[ve.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4",children:ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx("button",{onClick:e,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:ve.jsx(P,{className:"w-5 h-5"})}),ve.jsx("h1",{className:"text-xl font-bold",children:"Laporan"})]})}),ve.jsxs("div",{className:"p-4 space-y-4",children:[ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Jenis Laporan"}),ve.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[ve.jsxs("button",{onClick:()=>r("sales"),className:"p-3 rounded-lg border-2 transition-colors "+("sales"===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"),children:[ve.jsx(Q,{className:"w-6 h-6 mx-auto mb-2"}),ve.jsx("p",{className:"text-sm font-medium",children:"Penjualan"})]}),ve.jsxs("button",{onClick:()=>r("products"),className:"p-3 rounded-lg border-2 transition-colors "+("products"===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"),children:[ve.jsx(U,{className:"w-6 h-6 mx-auto mb-2"}),ve.jsx("p",{className:"text-sm font-medium",children:"Produk"})]}),ve.jsxs("button",{onClick:()=>r("customers"),className:"p-3 rounded-lg border-2 transition-colors "+("customers"===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"),children:[ve.jsx(Z,{className:"w-6 h-6 mx-auto mb-2"}),ve.jsx("p",{className:"text-sm font-medium",children:"Pelanggan"})]}),ve.jsxs("button",{onClick:()=>r("financial"),className:"p-3 rounded-lg border-2 transition-colors "+("financial"===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300"),children:[ve.jsx(ee,{className:"w-6 h-6 mx-auto mb-2"}),ve.jsx("p",{className:"text-sm font-medium",children:"Keuangan"})]})]})]}),ve.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:ve.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:space-x-4 space-y-3 md:space-y-0",children:[ve.jsxs("div",{className:"flex-1",children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Periode"}),ve.jsxs("select",{value:a,onChange:e=>n(e.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[ve.jsx("option",{value:"today",children:"Hari Ini"}),ve.jsx("option",{value:"week",children:"Minggu Ini"}),ve.jsx("option",{value:"month",children:"Bulan Ini"}),ve.jsx("option",{value:"year",children:"Tahun Ini"}),ve.jsx("option",{value:"custom",children:"Custom"})]})]}),"custom"===a&&ve.jsxs(ve.Fragment,{children:[ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dari"}),ve.jsx("input",{type:"date",value:i,onChange:e=>l(e.target.value),className:"p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),ve.jsxs("div",{children:[ve.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sampai"}),ve.jsx("input",{type:"date",value:o,onChange:e=>c(e.target.value),className:"p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),ve.jsxs("button",{className:"p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2",children:[ve.jsx(he,{className:"w-4 h-4"}),ve.jsx("span",{children:"Generate"})]}),ve.jsx("button",{className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:ve.jsx(ce,{className:"w-4 h-4"})})]})}),ve.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsxs("div",{className:"flex items-center justify-between mb-2",children:[ve.jsxs("h3",{className:"text-sm font-medium text-gray-600",children:["Total ","sales"===s?"Penjualan":"products"===s?"Produk":"Pelanggan"]}),ve.jsx(ee,{className:"w-4 h-4 text-green-500"})]}),ve.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["sales"===s&&`Rp ${h.totalSales.toLocaleString("id-ID")}`,"products"===s&&h.totalProducts,"customers"===s&&h.totalCustomers,"financial"===s&&"Rp 5.2M"]}),ve.jsx("p",{className:"text-xs text-green-600",children:"+15.5% dari periode lalu"})]}),ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsxs("div",{className:"flex items-center justify-between mb-2",children:[ve.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Transaksi"}),ve.jsx(U,{className:"w-4 h-4 text-blue-500"})]}),ve.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["sales"===s&&h.totalOrders,"products"===s&&h.lowStock,"customers"===s&&h.newCustomers,"financial"===s&&"142"]}),ve.jsxs("p",{className:"text-xs text-gray-500",children:["sales"===s&&"Total pesanan","products"===s&&"Stok rendah","customers"===s&&"Pelanggan baru","financial"===s&&"Total transaksi"]})]}),ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsxs("div",{className:"flex items-center justify-between mb-2",children:[ve.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Rata-rata"}),ve.jsx(me,{className:"w-4 h-4 text-purple-500"})]}),ve.jsxs("p",{className:"text-2xl font-bold text-gray-800",children:["sales"===s&&`Rp ${h.avgOrderValue.toLocaleString("id-ID")}`,"products"===s&&`Rp ${h.avgPrice.toLocaleString("id-ID")}`,"customers"===s&&h.avgOrdersPerCustomer,"financial"===s&&"Rp 36K"]}),ve.jsxs("p",{className:"text-xs text-gray-500",children:["sales"===s&&"Nilai per order","products"===s&&"Harga rata-rata","customers"===s&&"Order per pelanggan","financial"===s&&"Transaksi rata-rata"]})]}),ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsxs("div",{className:"flex items-center justify-between mb-2",children:[ve.jsx("h3",{className:"text-sm font-medium text-gray-600",children:"Terbaik"}),ve.jsx(Q,{className:"w-4 h-4 text-orange-500"})]}),ve.jsx("p",{className:"text-lg font-bold text-gray-800 truncate",children:h.topProduct||h.topCustomer||"Hijab"}),ve.jsxs("p",{className:"text-xs text-gray-500 truncate",children:["sales"===s&&"Produk terlaris","products"===s&&"Produk terlaris","customers"===s&&"Pelanggan terbaik","financial"===s&&"Kategori terlaris"]})]})]}),ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[ve.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Grafik ","sales"===s?"Penjualan":"products"===s?"Produk":"Pelanggan"]}),ve.jsx("div",{className:"h-64 bg-gray-100 rounded-lg flex items-center justify-center",children:ve.jsxs("div",{className:"text-center",children:[ve.jsx(Q,{className:"w-12 h-12 text-gray-400 mx-auto mb-2"}),ve.jsx("p",{className:"text-gray-500",children:"Grafik akan ditampilkan di sini"}),ve.jsx("p",{className:"text-sm text-gray-400",children:"Integrasi chart library diperlukan"})]})})]}),ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsxs("div",{className:"flex items-center justify-between mb-4",children:[ve.jsxs("h3",{className:"text-lg font-semibold",children:["Detail ","sales"===s?"Penjualan":"Data"]}),ve.jsx("button",{className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50",children:ve.jsx(ce,{className:"w-4 h-4"})})]}),ve.jsx("div",{className:"overflow-x-auto",children:ve.jsxs("table",{className:"w-full text-sm",children:[ve.jsx("thead",{children:ve.jsxs("tr",{className:"border-b",children:[ve.jsx("th",{className:"text-left py-2",children:"Tanggal"}),ve.jsx("th",{className:"text-left py-2",children:"Deskripsi"}),ve.jsx("th",{className:"text-right py-2",children:"Jumlah"}),ve.jsx("th",{className:"text-right py-2",children:"Total"})]})}),ve.jsxs("tbody",{children:[ve.jsxs("tr",{className:"border-b",children:[ve.jsx("td",{className:"py-2",children:"15 Jan 2024"}),ve.jsx("td",{className:"py-2",children:"Penjualan Hijab Premium"}),ve.jsx("td",{className:"text-right",children:"5"}),ve.jsx("td",{className:"text-right font-medium",children:"Rp 425.000"})]}),ve.jsxs("tr",{className:"border-b",children:[ve.jsx("td",{className:"py-2",children:"14 Jan 2024"}),ve.jsx("td",{className:"py-2",children:"Penjualan Gamis Syari"}),ve.jsx("td",{className:"text-right",children:"3"}),ve.jsx("td",{className:"text-right font-medium",children:"Rp 495.000"})]})]})]})})]})]})]})},en=({onBack:e,user:t})=>{const[s,r]=u.useState(""),[a,n]=u.useState("all"),[i,l]=u.useState("all"),o=[{id:"USR001",name:"Siti Nurhaliza",email:"siti@email.com",phone:"08123456789",role:"customer",status:"active",joinDate:"2024-01-10",totalOrders:5,totalSpent:125e4},{id:"USR002",name:"Ahmad Fauzi",email:"ahmad@email.com",phone:"08234567890",role:"reseller",status:"active",joinDate:"2024-01-05",totalOrders:12,totalSpent:24e5,points:450},{id:"USR003",name:"Ratna Dewi",email:"ratna@email.com",phone:"08345678901",role:"customer",status:"active",joinDate:"2024-01-08",totalOrders:3,totalSpent:675e3},{id:"USR004",name:"Budi Santoso",email:"budi@email.com",phone:"08456789012",role:"admin",status:"active",joinDate:"2024-01-01",totalOrders:0,totalSpent:0}],c={owner:{label:"Owner",color:"text-red-600 bg-red-100",icon:ae},admin:{label:"Administrator",color:"text-purple-600 bg-purple-100",icon:ae},reseller:{label:"Reseller",color:"text-blue-600 bg-blue-100",icon:le},customer:{label:"Customer",color:"text-green-600 bg-green-100",icon:Z}},d=o.filter(e=>{const t=e.name.toLowerCase().includes(s.toLowerCase())||e.email.toLowerCase().includes(s.toLowerCase()),r="all"===a||e.role===a,n="all"===i||e.status===i;return t&&r&&n});return ve.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[ve.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4",children:ve.jsxs("div",{className:"flex items-center justify-between",children:[ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx("button",{onClick:e,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:ve.jsx(P,{className:"w-5 h-5"})}),ve.jsx("h1",{className:"text-xl font-bold",children:"Kelola Pengguna"})]}),ve.jsxs("button",{className:"bg-white text-blue-600 px-4 py-2 rounded-lg hover:bg-gray-100 transition-colors flex items-center space-x-2",children:[ve.jsx(O,{className:"w-4 h-4"}),ve.jsx("span",{children:"Tambah User"})]})]})}),ve.jsxs("div",{className:"p-4 space-y-4",children:[ve.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[ve.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[ve.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-1",children:"Total User"}),ve.jsx("p",{className:"text-2xl font-bold text-blue-600",children:o.length}),ve.jsx("p",{className:"text-xs text-blue-600",children:"Semua role"})]}),ve.jsxs("div",{className:"bg-green-50 rounded-lg p-4",children:[ve.jsx("h4",{className:"text-sm font-medium text-green-800 mb-1",children:"User Aktif"}),ve.jsx("p",{className:"text-2xl font-bold text-green-600",children:o.filter(e=>"active"===e.status).length}),ve.jsxs("p",{className:"text-xs text-green-600",children:[Math.round(o.filter(e=>"active"===e.status).length/o.length*100),"% aktivasi"]})]}),ve.jsxs("div",{className:"bg-purple-50 rounded-lg p-4",children:[ve.jsx("h4",{className:"text-sm font-medium text-purple-800 mb-1",children:"Reseller"}),ve.jsx("p",{className:"text-2xl font-bold text-purple-600",children:o.filter(e=>"reseller"===e.role).length}),ve.jsx("p",{className:"text-xs text-purple-600",children:"Partner bisnis"})]}),ve.jsxs("div",{className:"bg-orange-50 rounded-lg p-4",children:[ve.jsx("h4",{className:"text-sm font-medium text-orange-800 mb-1",children:"User Baru"}),ve.jsx("p",{className:"text-2xl font-bold text-orange-600",children:"2"}),ve.jsx("p",{className:"text-xs text-orange-600",children:"Bulan ini"})]})]}),ve.jsx("div",{className:"bg-white rounded-lg shadow-sm p-4",children:ve.jsxs("div",{className:"flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3",children:[ve.jsxs("div",{className:"flex-1 relative",children:[ve.jsx(k,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),ve.jsx("input",{type:"text",placeholder:"Cari user...",value:s,onChange:e=>r(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),ve.jsxs("select",{value:a,onChange:e=>n(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[ve.jsx("option",{value:"all",children:"Semua Role"}),ve.jsx("option",{value:"customer",children:"Customer"}),ve.jsx("option",{value:"reseller",children:"Reseller"}),ve.jsx("option",{value:"admin",children:"Admin"}),ve.jsx("option",{value:"owner",children:"Owner"})]}),ve.jsxs("select",{value:i,onChange:e=>l(e.target.value),className:"px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[ve.jsx("option",{value:"all",children:"Semua Status"}),ve.jsx("option",{value:"active",children:"Aktif"}),ve.jsx("option",{value:"inactive",children:"Non-aktif"}),ve.jsx("option",{value:"banned",children:"Banned"})]}),ve.jsx("button",{className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:ve.jsx(S,{className:"w-4 h-4"})})]})}),ve.jsx("div",{className:"space-y-3",children:d.map(e=>{const s=c[e.role],r=s.icon;return ve.jsxs("div",{className:"bg-white rounded-lg shadow-sm p-4",children:[ve.jsxs("div",{className:"flex items-center justify-between mb-3",children:[ve.jsxs("div",{className:"flex items-center space-x-3",children:[ve.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-100 to-purple-100 rounded-full flex items-center justify-center",children:ve.jsx(Z,{className:"w-6 h-6 text-blue-600"})}),ve.jsxs("div",{children:[ve.jsx("p",{className:"font-semibold text-lg",children:e.name}),ve.jsx("p",{className:"text-sm text-gray-600",children:e.email}),ve.jsxs("p",{className:"text-xs text-gray-500",children:[e.phone," â€¢ Bergabung: ",e.joinDate]})]})]}),ve.jsxs("div",{className:"text-right",children:[ve.jsxs("div",{className:`inline-flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium ${s.color}`,children:[ve.jsx(r,{className:"w-3 h-3"}),ve.jsx("span",{children:s.label})]}),ve.jsx("div",{className:"mt-1",children:ve.jsxs("span",{className:"inline-flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-medium "+("active"===e.status?"text-green-600 bg-green-100":"text-gray-600 bg-gray-100"),children:[ve.jsx("span",{className:"w-2 h-2 bg-current rounded-full"}),ve.jsx("span",{children:"active"===e.status?"Aktif":"Non-aktif"})]})})]})]}),ve.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-3",children:[ve.jsxs("div",{className:"text-center p-2 bg-gray-50 rounded",children:[ve.jsx("p",{className:"text-xs text-gray-600",children:"Total Order"}),ve.jsx("p",{className:"font-semibold",children:e.totalOrders})]}),ve.jsxs("div",{className:"text-center p-2 bg-gray-50 rounded",children:[ve.jsx("p",{className:"text-xs text-gray-600",children:"Total Belanja"}),ve.jsxs("p",{className:"font-semibold",children:["Rp ",e.totalSpent.toLocaleString("id-ID")]})]}),"reseller"===e.role&&ve.jsxs("div",{className:"text-center p-2 bg-blue-50 rounded",children:[ve.jsx("p",{className:"text-xs text-blue-600",children:"Poin Reseller"}),ve.jsxs("p",{className:"font-semibold text-blue-600",children:[e.points||0," pts"]})]}),ve.jsxs("div",{className:"text-center p-2 bg-gray-50 rounded",children:[ve.jsx("p",{className:"text-xs text-gray-600",children:"User ID"}),ve.jsx("p",{className:"font-semibold text-xs",children:e.id})]})]}),ve.jsxs("div",{className:"flex items-center justify-between",children:[ve.jsx("div",{className:"text-xs text-gray-500",children:"Terakhir login: 2 hari yang lalu"}),ve.jsxs("div",{className:"flex items-center space-x-2",children:[ve.jsx("button",{className:"p-1 text-blue-600 hover:text-blue-700 transition-colors",children:ve.jsx(re,{className:"w-4 h-4"})}),ve.jsx("button",{className:"p-1 text-green-600 hover:text-green-700 transition-colors",children:ve.jsx(oe,{className:"w-4 h-4"})}),"owner"===(null==t?void 0:t.role)&&ve.jsx("button",{className:"p-1 text-red-600 hover:text-red-700 transition-colors",children:ve.jsx(R,{className:"w-4 h-4"})})]})]})]},e.id)})})]})]})},tn=({currentPage:e,onPageChange:t})=>{const s=[{id:"home",label:"Beranda",icon:pe},{id:"flash-sale",label:"Flash Sale",icon:z},{id:"orders",label:"Pesanan",icon:U},{id:"account",label:"âš™ï¸ Pengaturan",icon:N}];return ve.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg",children:ve.jsx("div",{className:"flex",children:s.map(s=>{const r=s.icon,a=e===s.id;return ve.jsxs("button",{onClick:()=>t(s.id),className:"flex-1 flex flex-col items-center py-3 px-2 transition-colors "+(a?"text-pink-600 bg-pink-50":"text-gray-600 hover:text-pink-600 hover:bg-gray-50"),children:[ve.jsx(r,{className:"w-6 h-6 mb-1 "+(a?"text-pink-600":"text-gray-600")}),ve.jsx("span",{className:"text-xs font-medium "+(a?"text-pink-600":"text-gray-600"),children:s.label})]},s.id)})})})};function sn(){console.log("ðŸš¨ URGENT VERSION 6.0 - PLEASE UPDATE NOW! ðŸš¨");const[t,s]=u.useState("home"),[r,a]=u.useState(null),[n,i]=u.useState(!1),[l,h]=u.useState(null),[m,p]=u.useState([]),{products:g,loading:x,updateProductStock:f}=(()=>{const[t,s]=u.useState(()=>we.getProducts()),[r,a]=u.useState(!0);return u.useEffect(()=>{d(e,null,function*(){a(!0),yield new Promise(e=>setTimeout(e,500));const e=we.getProducts();s(e),a(!1)})},[]),u.useEffect(()=>{const e=e=>{console.log("Featured products updated event received:",e.detail);const t=we.getProducts();s(t)};return window.addEventListener("featuredProductsUpdated",e),()=>{window.removeEventListener("featuredProductsUpdated",e)}},[]),u.useEffect(()=>{const e=e=>{console.log("Products updated event received:",e.detail);const t=we.getProducts();s(t)};return window.addEventListener("productsUpdated",e),()=>{window.removeEventListener("productsUpdated",e)}},[]),{products:t,loading:r,updateProducts:e=>{s(e),we.saveProducts(e)},updateProductStock:(e,t)=>{s(s=>{const r=s.map(s=>s.id===e?c(o({},s),{stock:Math.max(0,s.stock-t)}):s);return we.saveProducts(r),r})},applyFlashSaleToProducts:(e,t=!1)=>{console.log("ðŸ”¥ Applying flash sale to products:",e.name),console.log("ðŸ“¦ Product IDs affected:",e.productIds),console.log("ðŸ’° Discount:",e.discountType,e.discountValue),s(t=>{const s=t.map(t=>{if(e.productIds.includes(t.id)){const s=t.originalRetailPrice||t.retailPrice;let r=t.retailPrice;return"fixed"===e.discountType?r=Math.max(0,t.retailPrice-e.discountValue):"percentage"===e.discountType&&(r=t.retailPrice*(1-e.discountValue/100)),console.log(`ðŸ’¸ Product ${t.name}: Rp${t.retailPrice.toLocaleString("id-ID")} â†’ Rp${r.toLocaleString("id-ID")}`),c(o({},t),{isFlashSale:!0,flashSalePrice:Math.round(r),originalRetailPrice:s})}return t});return we.saveProducts(s),console.log("âœ… Flash sale applied and products saved to AppStorage"),s})},removeFlashSaleFromProducts:e=>{console.log("ðŸ›‘ Removing flash sale from products:",e),s(t=>{const s=t.map(t=>{var s;return e.includes(t.id)&&t.isFlashSale?(console.log(`â†©ï¸ Restoring original price for ${t.name}: Rp${(null==(s=t.originalRetailPrice)?void 0:s.toLocaleString("id-ID"))||t.retailPrice.toLocaleString("id-ID")}`),c(o({},t),{isFlashSale:!1,flashSalePrice:void 0,retailPrice:t.originalRetailPrice||t.retailPrice,originalRetailPrice:void 0})):t});return we.saveProducts(s),console.log("âœ… Flash sale removed and products saved to AppStorage"),s})},flashSaleEvents:[]}})(),{addOrder:b}=Se();u.useEffect(()=>{console.log("ðŸš€ App initializing... Checking localStorage"),we.initializeApp(),we.validateAndSyncFeaturedProducts(),console.log("ðŸš€ App initialized with featured products validation");const e=localStorage.getItem("azzahra_current_user"),t=localStorage.getItem("azzahra_cart");if(console.log("ðŸ“¦ Found in localStorage:",{savedUser:e?"YES":"NO",savedCart:t?"YES":"NO",allKeys:Object.keys(localStorage)}),e)try{const t=JSON.parse(e);h(t),console.log("âœ… User session restored:",t.name,t.role)}catch(s){console.error("âŒ Error restoring user session:",s),localStorage.removeItem("azzahra_current_user")}else console.log("â„¹ï¸ No saved user session found");if(t)try{const e=JSON.parse(t);p(e),console.log("âœ… Cart restored:",e.length,"items")}catch(s){console.error("âŒ Error restoring cart:",s),localStorage.removeItem("azzahra_cart")}else console.log("â„¹ï¸ No saved cart found")},[]);const y=e=>{a(e),s("product-detail")},v=()=>{i(!0)},j=e=>{i(!1),h(e),localStorage.setItem("azzahra_current_user",JSON.stringify(e)),console.log("âœ… User logged in and session saved:",e.name,e.role),console.log("ðŸ“¦ Current localStorage keys:",Object.keys(localStorage))},w=()=>{console.log("ðŸ”ƒ User logging out"),h(null),p([]),s("home"),localStorage.removeItem("azzahra_current_user"),localStorage.removeItem("azzahra_cart"),console.log("âœ… User session cleared from localStorage"),console.log("ðŸ“¦ Remaining localStorage keys:",Object.keys(localStorage))},N=(e,t,s)=>{const r=c(o({},e),{selectedVariant:t,quantity:s,cartId:`${e.id}-${null==t?void 0:t.size}-${null==t?void 0:t.color}`,addedAt:(new Date).toISOString()});p(a=>{const n=a.findIndex(s=>{var r,a;return s.id===e.id&&(null==(r=s.selectedVariant)?void 0:r.size)===(null==t?void 0:t.size)&&(null==(a=s.selectedVariant)?void 0:a.color)===(null==t?void 0:t.color)});let i;return n>=0?(i=[...a],i[n].quantity+=s,i[n].addedAt=(new Date).toISOString()):i=[...a,r],localStorage.setItem("azzahra_cart",JSON.stringify(i)),console.log("ðŸ’¾ Cart saved to localStorage:",i.length,"items"),i}),alert("Produk berhasil ditambahkan ke keranjang!")},k=e=>{if(!l)return void v();const t={size:e.variants.sizes[0],color:e.variants.colors[0]};N(e,t,1)},S=(e,t,r)=>{l?(N(e,t,r),setTimeout(()=>{s("checkout")},500)):v()},_=(e,t,s)=>{p(r=>{const a=r.map(r=>{var a,n;return r.id===e&&(null==(a=r.selectedVariant)?void 0:a.size)===(null==t?void 0:t.size)&&(null==(n=r.selectedVariant)?void 0:n.color)===(null==t?void 0:t.color)?c(o({},r),{quantity:Math.max(1,s)}):r});return localStorage.setItem("azzahra_cart",JSON.stringify(a)),a})},P=(e,t)=>{p(s=>{const r=s.filter(s=>{var r,a;return!(s.id===e&&(null==(r=s.selectedVariant)?void 0:r.size)===(null==t?void 0:t.size)&&(null==(a=s.selectedVariant)?void 0:a.color)===(null==t?void 0:t.color))});return localStorage.setItem("azzahra_cart",JSON.stringify(r)),r})},E=e=>{const t="AZF"+Date.now().toString().slice(-8);return b({id:t,userId:l.id,userName:l.name,userEmail:l.email,items:m.map(e=>({productId:e.id,productName:e.name,selectedVariant:e.selectedVariant,quantity:e.quantity,price:"reseller"===(null==l?void 0:l.role)?e.resellerPrice:e.retailPrice,total:("reseller"===(null==l?void 0:l.role)?e.resellerPrice:e.retailPrice)*e.quantity})),shippingInfo:e.shippingInfo,paymentMethod:e.paymentMethod,status:"pending",totalAmount:C(),shippingCost:15e3,finalTotal:C()+15e3,notes:e.notes}),m.forEach(e=>{f(e.id,e.quantity)}),p([]),localStorage.removeItem("azzahra_cart"),console.log("Cart cleared after order completion"),t},C=()=>m.reduce((e,t)=>e+("reseller"===(null==l?void 0:l.role)?t.resellerPrice:t.retailPrice)*t.quantity,0),T=()=>{s("cart")},O=()=>{s("checkout")},A=()=>{s("flash-sale")},R=()=>{s("admin-products")},I=()=>{s("admin-orders")},D=()=>{s("admin-reports")},$=()=>{s("admin-users")};return ve.jsx(_e,{children:ve.jsxs("div",{className:"min-h-screen bg-gray-50",children:[(()=>{if(n)return ve.jsx($e,{onSuccess:j,onClose:()=>i(!1)});switch(t){case"home":default:return ve.jsx(Te,{user:l,cartItems:m,products:g,loading:x,onProductClick:y,onLoginRequired:v,onCartClick:T,onAddToCart:k,onNavigateToFlashSale:A});case"flash-sale":return ve.jsx(Ue,{user:l,cartItems:m,products:g,loading:x,onProductClick:y,onLoginRequired:v,onCartClick:T,onAddToCart:k});case"orders":return ve.jsx(Fe,{user:l});case"account":return console.log("App: Rendering AccountPage with user:",l),ve.jsx(Ya,{user:l,onLogout:w,onNavigateToAdminProducts:R,onNavigateToAdminOrders:I,onNavigateToAdminReports:D,onNavigateToAdminUsers:$});case"admin-products":return console.log("App: Rendering AdminProductsPage with user:",l),ve.jsx(Xa,{onBack:()=>s("account"),user:l});case"admin-orders":return console.log("App: Rendering AdminOrdersPage with user:",l),ve.jsx(Qa,{onBack:()=>s("account"),user:l});case"admin-reports":return console.log("App: Rendering AdminReportsPage with user:",l),ve.jsx(Za,{onBack:()=>s("account"),user:l});case"admin-users":return console.log("App: Rendering AdminUsersPage with user:",l),ve.jsx(en,{onBack:()=>s("account"),user:l});case"product-detail":return ve.jsx(Oe,{product:r,user:l,onBack:()=>s("home"),onLoginRequired:v,onAddToCart:N,onBuyNow:S,onNavigateToCart:()=>s("cart")});case"cart":return ve.jsx(Ae,{cartItems:m,user:l,updateQuantity:_,removeFromCart:P,getTotalPrice:C,onBack:()=>s("home"),onCheckout:O});case"checkout":return ve.jsx(De,{cartItems:m,user:l,getTotalPrice:C,clearCart:E,onBack:()=>s("cart")})}})(),!n&&!t.startsWith("admin-")&&ve.jsx(tn,{currentPage:t,onPageChange:s})]})})}function rn(){return ve.jsx(ke,{children:ve.jsx(sn,{})})}be(document.getElementById("root")).render(ve.jsx(u.StrictMode,{children:ve.jsx(rn,{})}))}},function(){return xe||(0,ge[r(ge)[0]])((xe={exports:{}}).exports,xe),xe.exports});export default fe();
